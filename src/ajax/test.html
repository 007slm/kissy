<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Ajax Test</title>
<script src="../../build/kissy.js"></script>
</head>
<body>

<h2>Test Data</h2>

<button id="GET">GET</button>
<button id="POST">POST</button>
<button id="JSONP1">JSONP</button>
<button id="JSONP2">从YQL获取数据</button>
<button id="SYNC">同步获取数据</button>

<div id="loading"></div>

<!-- Test Cases -->
<script>

    KISSY.add({
        'ajax':{
            fullpath:'ajax.js'
        }
    }).use('ajax', function(S) {

        S.io.onStart(function() {
            S.Node('<p><img src="http://img04.taobaocdn.com/tps/i4/T1CntDXh8hXXXXXXXX-32-32.gif" /></p>').appendTo('#loading');
        });
        S.io.onComplete(function() {
            S.one('#loading').html('');
        });

        //普通 get 请求
        S.one('#GET').on('click', function() {
            S.io.get('interface.php?t=get', function(o, args) {
                S.log('GET ' + o.responseText);
            });
        });

        //普通post请求
        S.one('#POST').on('click', function(e) {
            S.io.post('interface.php?t=post', {
                type:'post',
                name:'jayli',
                company:'cn.yahoo.com',
                countru:'china'
            }, function(o, args) {
                S.log('POST ' + o.responseText);
            });
        });

        //JSONP
        S.one('#JSONP1').on('click', function(e) {
            S.io.jsonp('interface.php?callback=?', function(data, args) {
                S.log(data.toString() + 'Simple Jsonp callback');
            });

        });

        S.one('#JSONP2').on('click', function(e) {

            //自定义jsonp
            S.io({
                url:'http://query.yahooapis.com/v1/public/yql?q=select%20title%2Clink%2Cdescription%20from%20rss%20where%20url%3D%22http%3A%2F%2Fued.taobao.com%2Fblog%2Ffeed%2F%22&format=json&diagnostics=true&callback=?',
                dataType:'jsonp',
                jsonp:'my_callback',
                complete:function(id, data, args) {
                    S.log(S.JSON.stringify(data));
                }
            });

        });

        S.one('#SYNC').on('click', function(e) {
            var str = S.io({
                type:'get',
                url:'interface.php?t=get',
                async:false,
                complete:function(id, o, args) {
                    //this will not exec in firefox
                    S.log(o.responseText);
                }
            }).responseText;
            S.log('ASYN block the thread :' + str, 'yellow');

        });

    });
</script>
</body>
</html>