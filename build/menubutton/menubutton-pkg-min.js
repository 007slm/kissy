/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("menubutton/menubutton",function(k,f,i,c,g,j){var h=f.create(c,{_hideMenu:function(){this.get("view").get("el");this.get("menu").hide();this.get("view").set("collapsed",true)},_showMenu:function(){var a=this.get("view"),b=a.get("el"),d=this.get("menu");if(!d.get("visible")){d.set("align",{node:b,points:["bl","tl"]});d.render();b.attr("aria-haspopup",d.get("view").get("el").attr("id"));d.show();a.set("collapsed",false)}},bindUI:function(){var a=this;this.get("menu").on("afterActiveItemChange",
function(b){a.set("activeItem",b.newVal)})},_handleKeydown:function(a){var b=this.get("menu");b&&b.get("visible")&&b._handleKeydown(a);if(a.keyCode==27){a.preventDefault();this._hideMenu()}else if(a.keyCode==38||a.keyCode==40)if(!b.get("visible")){a.preventDefault();this._showMenu()}},_handleBlur:function(){var a=h.superclass._handleBlur.call(this);if(a===false)return a;this._hideMenu()},_handleClick:function(){var a=h.superclass._handleClick.call(this);if(a===false)return a;this.get("menu").get("visible")?
this._hideMenu():this._showMenu()}},{ATTRS:{activeItem:{view:true},menu:{setter:function(a){a.set("focusable",false)}}}});h.decorateSelect=function(a,b){b=b||{};a=k.one(a);var d=new j({prefixCls:b.prefixCls}),m,n=a.val();a.all("option").each(function(e){if(n==e.val())m=e.text();d.addChild(new j.Item({content:e.text(),prefixCls:b.prefixCls,value:e.val()}))});var l=new h({content:m,describedby:"describe",menu:d,prefixCls:b.prefixCls,autoRender:true});l.get("el").insertBefore(a);var o=(new i("<input type='hidden' name='"+
a.getDOMNode().name+"' value='"+n+"'>")).insertBefore(a);d.on("menuItemClick",function(e){o.val(e.menuItem.get("value"));l.set("content",e.menuItem.get("content"));d.hide()});a.remove();return l};h.DefaultRender=g;return h},{requires:["uibase","node","button","./menubuttonrender","menu"]});
KISSY.add("menubutton/menubuttonrender",function(k,f,i){return f.create(i.Render,{renderUI:function(){var c=this.get("el");c.one("div").one("div").html(k.substitute('<div class="{prefixCls}inline-block {prefixCls}menu-button-caption"></div><div class="{prefixCls}inline-block {prefixCls}menu-button-dropdown">&nbsp;</div>',{prefixCls:this.get("prefixCls")}));c.attr("aria-haspopup",true)},_uiSetContent:function(c){c!=undefined&&this.get("el").one("."+this.get("prefixCls")+"menu-button-caption").html(c)},
_uiSetCollapsed:function(c){var g=this.get("el"),j=this.get("prefixCls")+"menu-button";if(c){g.removeClass(j+"menu-button-open");g.attr("aria-expanded",false)}else{g.addClass(j+"menu-button-open");g.attr("aria-expanded",true)}},_uiSetActiveItem:function(c){this.get("el").attr("aria-activedescendant",c&&c.get("view").get("el").attr("id")||"")}},{ATTRS:{activeItem:{},collapsed:{value:true}}})},{requires:["uibase","button"]});
KISSY.add("menubutton",function(k,f,i){f.Render=i;return f},{requires:["menubutton/menubutton","menubutton/menubuttonrender"]});
