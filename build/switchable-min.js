/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("switchable/base",function(h,f,k,m){function i(a,b){b=b||{};if(!("markupType"in b))if(b.panelCls)b.markupType=1;else if(b.panels)b.markupType=2;b=h.merge(i.Config,b);this.container=f.get(a);this.config=b;this.activeIndex=b.activeIndex;this._init()}var c=h.require("event/target");i.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,
activeIndex:0,activeTriggerCls:"ks-active",steps:1,viewSize:[]};i.Plugins=[];h.augment(i,c,{_init:function(){var a=this,b=a.config;a._parseMarkup();b.switchTo&&a.switchTo(b.switchTo);b.hasTriggers&&a._bindTriggers();h.each(i.Plugins,function(d){d.init&&d.init(a)});a.fire("init")},_parseMarkup:function(){var a=this.container,b=this.config,d,e=[],j=[];switch(b.markupType){case 0:if(d=f.get("."+b.navCls,a))e=f.children(d);d=f.get("."+b.contentCls,a);j=f.children(d);break;case 1:e=f.query("."+b.triggerCls,
a);j=f.query("."+b.panelCls,a);break;case 2:e=b.triggers;j=b.panels}a=j.length;this.length=a/b.steps;if(b.hasTriggers&&a>0&&e.length===0)e=this._generateTriggersMarkup(this.length);this.triggers=h.makeArray(e);this.panels=h.makeArray(j);this.content=d||j[0].parentNode},_generateTriggersMarkup:function(a){var b=this.config,d=f.create("<ul>"),e,j;d.className=b.navCls;for(j=0;j<a;j++){e=f.create("<li>");if(j===this.activeIndex)e.className=b.activeTriggerCls;e.innerHTML=j+1;d.appendChild(e)}this.container.appendChild(d);
return f.children(d)},_bindTriggers:function(){var a=this,b=a.config,d=a.triggers,e,j,g=d.length;for(j=0;j<g;j++)(function(l){e=d[l];k.on(e,"click",function(){a._onFocusTrigger(l)});if(b.triggerType==="mouse"){k.on(e,"mouseenter",function(){a._onMouseEnterTrigger(l)});k.on(e,"mouseleave",function(){a._onMouseLeaveTrigger(l)})}})(j)},_onFocusTrigger:function(a){if(this._triggerIsValid(a)){this._cancelSwitchTimer();this.switchTo(a)}},_onMouseEnterTrigger:function(a){var b=this;if(b._triggerIsValid(a))b.switchTimer=
h.later(function(){b.switchTo(a)},b.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(a){return this.activeIndex!==a},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=m}},switchTo:function(a,b){var d=this.config,e=this.triggers,j=this.panels,g=this.activeIndex,l=d.steps,n=g*l,r=a*l;if(!this._triggerIsValid(a))return this;if(this.fire("beforeSwitch",{toIndex:a})===false)return this;if(d.hasTriggers)this._switchTrigger(g>
-1?e[g]:null,e[a]);if(b===m)b=a>g?"forward":"backward";this._switchView(j.slice(n,n+l),j.slice(r,r+l),a,b);this.activeIndex=a;return this},_switchTrigger:function(a,b){var d=this.config.activeTriggerCls;a&&f.removeClass(a,d);f.addClass(b,d)},_switchView:function(a,b,d){f.css(a,"display","none");f.css(b,"display","block");this._fireOnSwitch(d)},_fireOnSwitch:function(a){this.fire("switch",{currentIndex:a})},prev:function(){var a=this.activeIndex;this.switchTo(a>0?a-1:this.length-1,"backward")},next:function(){var a=
this.activeIndex;this.switchTo(a<this.length-1?a+1:0,"forward")}});return i},{requires:["dom","event"]});
KISSY.add("switchable/accordion",function(h,f,k){function m(c,a){if(!(this instanceof m))return new m(c,a);m.superclass.constructor.call(this,c,h.merge(i,a));if(this.config.multiple)this._switchTrigger=function(){};return 0}var i={markupType:1,triggerType:"click",multiple:false};h.extend(m,k);h.augment(m,{_triggerIsValid:function(c){return this.activeIndex!==c||this.config.multiple},_switchView:function(c,a,b){var d=this.config,e=a[0];if(d.multiple){f.toggleClass(this.triggers[b],d.activeTriggerCls);
f.css(e,"display",e.style.display=="none"?"block":"none");this._fireOnSwitch(b)}else m.superclass._switchView.call(this,c,a,b)}});return m},{requires:["dom","switchable/base"]});
KISSY.add("switchable/autoplay",function(h,f,k,m){h.mix(k.Config,{autoplay:false,interval:5,pauseOnHover:true});k.Plugins.push({name:"autoplay",init:function(i){function c(){d=h.later(function(){i.paused||i.switchTo(i.activeIndex<i.length-1?i.activeIndex+1:0,"forward")},b,true)}var a=i.config,b=a.interval*1E3,d;if(a.autoplay){if(a.pauseOnHover){f.on(i.container,"mouseenter",function(){i.stop();i.paused=true});f.on(i.container,"mouseleave",function(){i.paused=false;c()})}c();i.stop=function(){if(d){d.cancel();
d=m}}}}});return k},{requires:["event","switchable/base"]});KISSY.add("switchable/autorender",function(h,f,k,m){m.autoRender=function(i,c){i="."+(i||"KS_Widget");f.query(i,c).each(function(a){var b=a.getAttribute("data-widget-type"),d;if(b&&"Switchable Tabs Slide Carousel Accordion".indexOf(b)>-1)try{if(d=a.getAttribute("data-widget-config"))d=d.replace(/'/g,'"');new h[b](a,k.parse(d))}catch(e){}})}},{requires:["dom","json","switchable/base"]});
KISSY.add("switchable/carousel",function(h,f,k,m,i){function c(g,l){var n=this;if(!(n instanceof c))return new c(g,l);n.on("init",function(){a(n)});c.superclass.constructor.call(n,g,h.merge(j,l));return 0}function a(g){var l=g.config,n=l.disableBtnCls,r=false;h.each(["prev","next"],function(o){var p=g[o+"Btn"]=f.get(b+l[o+"BtnCls"],g.container);k.on(p,"click",function(s){s.preventDefault();r||f.hasClass(p,n)||g[o]()})});if(!l.circular){g.on("beforeSwitch",function(){r=true});g.on("switch",function(o){o=
o.currentIndex;o=o===0?g[d]:o===g.length-1?g[e]:i;f.removeClass([g[d],g[e]],n);o&&f.addClass(o,n);r=false})}k.on(g.panels,"click focus",function(){g.fire("itemSelected",{item:this})})}var b=".",d="prevBtn",e="nextBtn",j={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};h.extend(c,m);return c},{requires:["dom","event","switchable/base"]});
KISSY.add("switchable/effect",function(h,f,k,m,i,c){var a;h.mix(i.Config,{effect:"none",duration:0.5,easing:"easeNone",nativeAnim:true});i.Effects={none:function(b,d,e){f.css(b,"display","none");f.css(d,"display","block");e()},fade:function(b,d,e){b.length!==1&&h.error("fade effect only supports steps == 1.");var j=this,g=j.config,l=b[0],n=d[0];j.anim&&j.anim.stop(true);f.css(n,"opacity",1);j.anim=(new m(l,{opacity:0},g.duration,g.easing,function(){j.anim=c;f.css(n,"z-index",9);f.css(l,"z-index",
1);e()},g.nativeAnim)).run()},scroll:function(b,d,e,j){var g=this;b=g.config;d=b.effect==="scrollx";var l={};l[d?"left":"top"]=-(g.viewSize[d?0:1]*j)+"px";g.anim&&g.anim.stop();g.anim=(new m(g.content,l,b.duration,b.easing,function(){g.anim=c;e()},b.nativeAnim)).run()}};a=i.Effects;a.scrollx=a.scrolly=a.scroll;i.Plugins.push({name:"effect",init:function(b){var d=b.config,e=d.effect,j=b.panels,g=b.content,l=d.steps,n=b.activeIndex,r=j.length;b.viewSize=[d.viewSize[0]||j[0].offsetWidth*l,d.viewSize[1]||
j[0].offsetHeight*l];if(e!=="none"){h.each(j,function(u){f.css(u,"display","block")});switch(e){case "scrollx":case "scrolly":f.css(g,"position","absolute");f.css(g.parentNode,"position","relative");if(e==="scrollx"){f.css(j,"float","left");f.width(g,b.viewSize[0]*(r/l))}break;case "fade":var o=n*l,p=o+l-1,s;h.each(j,function(u,t){s=t>=o&&t<=p;f.css(u,{opacity:s?1:0,position:"absolute",zIndex:s?9:1})})}}}});h.augment(i,{_switchView:function(b,d,e,j){var g=this,l=g.config.effect;(h.isFunction(l)?l:
a[l]).call(g,b,d,function(){g._fireOnSwitch(e)},e,j)}});return i},{requires:["dom","event","anim","switchable/base"]});
KISSY.add("switchable/circular",function(h,f,k,m){function i(p,s,u,t,w){var q=this;p=q.config;s=q.length;var x=q.activeIndex,v=p.scrollType===o,y=v?e:j,z=q.viewSize[v?0:1];v=-z*t;var B={},C,A=w===r;if(C=A&&x===0&&t===s-1||w===n&&x===s-1&&t===0)v=c.call(q,q.panels,t,A,y,z);B[y]=v+l;q.anim&&q.anim.stop();q.anim=(new k(q.content,B,p.duration,p.easing,function(){C&&a.call(q,q.panels,t,A,y,z);q.anim=undefined;u()},p.nativeAnim)).run()}function c(p,s,u,t,w){var q=this.config.steps;s=this.length;var x=u?
s-1:0,v=(x+1)*q;for(q=x*q;q<v;q++){f.css(p[q],b,d);f.css(p[q],t,(u?-1:1)*w*s)}return u?w:-w*s}function a(p,s,u,t,w){var q=this.config.steps;s=this.length;var x=u?s-1:0,v=(x+1)*q;for(q=x*q;q<v;q++){f.css(p[q],b,g);f.css(p[q],t,g)}f.css(this.content,t,u?-w*(s-1):g)}var b="position",d="relative",e="left",j="top",g="",l="px",n="forward",r="backward",o="scrollx";h.mix(m.Config,{circular:false});m.Plugins.push({name:"circular",init:function(p){p=p.config;if(p.circular&&(p.effect===o||p.effect==="scrolly")){p.scrollType=
p.effect;p.effect=i}}})},{requires:["dom","anim","switchable/base","switchable/effect"]});
KISSY.add("switchable/countdown",function(h,f,k,m,i,c){h.mix(i.Config,{countdown:false,countdownFromStyle:"",countdownToStyle:"width: 0"});i.Plugins.push({name:"countdown",init:function(a){function b(){d();r=(new m(g[a.activeIndex],n,j-1)).run()}function d(){if(r){r.stop();r=c}}var e=a.config,j=e.interval,g=[],l=e.countdownFromStyle,n=e.countdownToStyle,r;if(!(!e.autoplay||!e.hasTriggers||!e.countdown)){h.each(a.triggers,function(o,p){o.innerHTML='<div class="ks-switchable-trigger-mask"></div><div class="ks-switchable-trigger-content">'+
o.innerHTML+"</div>";g[p]=o.firstChild});if(e.pauseOnHover){k.on(a.container,"mouseenter",function(){d();var o=g[a.activeIndex];if(l)r=(new m(o,l,0.2,"easeOut")).run();else f.removeAttr(o,"style")});k.on(a.container,"mouseleave",function(){d();f.removeAttr(g[a.activeIndex],"style");h.later(b,200)})}a.on("beforeSwitch",function(){d();f.removeAttr(g[a.activeIndex],"style")});a.on("switch",function(){a.paused||b()});b(a.activeIndex)}}});return i},{requires:["dom","event","anim","switchable/base"]});
KISSY.add("switchable/lazyload",function(h,f,k){var m="beforeSwitch",i="img-src",c="area-data",a={};a[i]="data-ks-lazyload-custom";a[c]="ks-datalazyload-custom";h.mix(k.Config,{lazyDataType:c});k.Plugins.push({name:"lazyload",init:function(b){function d(n){var r=j.steps;n=n.toIndex*r;e.loadCustomLazyData(b.panels.slice(n,n+r),g);a:{var o,p;if(n=(r=g===i)?"img":g===c?"textarea":""){n=f.query(n,b.container);o=0;for(p=n.length;o<p;o++)if(r?f.attr(n[o],l):f.hasClass(n[o],l)){r=false;break a}}r=true}r&&
b.detach(m,d)}var e=h.require("datalazyload"),j=b.config,g=j.lazyDataType,l=a[g];!e||!g||!l||b.on(m,d)}});return k},{requires:["dom","switchable/base"]});KISSY.add("switchable/slide",function(h,f){function k(i,c){if(!(this instanceof k))return new k(i,c);k.superclass.constructor.call(this,i,h.merge(m,c));return 0}var m={autoplay:true,circular:true};h.extend(k,f);return k},{requires:["switchable/base"]});
KISSY.add("switchable/tabs",function(h,f){function k(c,a){if(!(this instanceof k))return new k(c,a);k.superclass.constructor.call(this,c,a);return 0}var m=h.Event,i=h.DOM;h.extend(k,f,{_init:function(){k.superclass._init.call(this);var c=this.activeIndex;this.lastActiveIndex=c;var a=this.triggers,b=this.panels,d=0;h.each(a,function(e){e.setAttribute("role","tab");e.tabIndex=d==c?"0":"-1";if(!e.id)e.id=h.guid("ks-switchable");d++});d=0;h.each(b,function(e){e.setAttribute("role","tabpanel");e.setAttribute("aria-hidden",
d==c?"false":"true");e.setAttribute("aria-labelledby",a[d].id);d++});this.on("switch",this._tabSwitch,this);b=this.container;m.on(b,"keydown",this._tabKeydown,this);m.on(b,"keypress",this._tabKeypress,this)},_currentTabFromEvent:function(c){var a;h.each(this.triggers,function(b){if(b==c||i.contains(b,c))a=b});return a},_currentPanelFromEvent:function(c){var a;h.each(this.panels,function(b){if(b==c||i.contains(b,c))a=b});return a},_tabKeypress:function(c){switch(c.keyCode){case 33:case 34:c.ctrlKey&&
!c.altKey&&!c.shiftKey&&c.stopPropagation();break;case 9:c.ctrlKey&&!c.altKey&&c.stopPropagation()}},_tabKeydown:function(c){var a=c.target,b=this.triggers,d=!c.ctrlKey&&!c.shiftKey&&!c.altKey,e=c.ctrlKey&&!c.shiftKey&&!c.altKey;switch(c.keyCode){case 37:case 38:if(this._currentTabFromEvent(a)&&d){this.prev();c.stopPropagation()}break;case 39:case 40:if(this._currentTabFromEvent(a)&&d){this.next();c.stopPropagation()}break;case 34:if(e){c.stopPropagation();c.preventDefault();this.next()}break;case 33:if(e){c.stopPropagation();
this.prev()}break;case 36:if(d){this.switchTo(0);c.stopPropagation()}break;case 35:if(d){this.switchTo(b.length-1);c.stopPropagation()}break;case 9:if(c.ctrlKey&&!c.altKey){c.stopPropagation();c.shiftKey?this.prev():this.next()}}},_tabSwitch:function(c){var a=this.lastActiveIndex;c=c.currentIndex;if(!(a===undefined||a==c)){var b=this.triggers[c],d=this.panels[a],e=this.panels[c];this.triggers[a].tabIndex="-1";b.tabIndex="0";b.focus();d.setAttribute("aria-hidden","true");e.setAttribute("aria-hidden",
"false");this.lastActiveIndex=c}}});return k},{requires:["switchable/base"]});KISSY.add("switchable",function(h,f,k,m,i,c,a,b,d,e,j,g){h.Switchable=f;k={Accordion:k,Carousel:c,Slide:j,Tabs:g};h.mix(h,k);h.mix(f,k);return f},{requires:["switchable/base","switchable/accordion","switchable/autoplay","switchable/autorender","switchable/carousel","switchable/circular","switchable/countdown","switchable/effect","switchable/lazyload","switchable/slide","switchable/tabs"]});
