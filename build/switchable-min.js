/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("switchable/base",function(h,e,k,n){function j(b,a){a=a||{};if(!("markupType"in a))if(a.panelCls)a.markupType=1;else if(a.panels)a.markupType=2;for(var c=this.constructor;c;){a=h.merge(c.Config,a);c=c.superclass?c.superclass.constructor:null}this.container=e.get(b);this.config=a;this.activeIndex=a.activeIndex;this._init()}var o=h.require("event/target");j.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",
triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,activeTriggerCls:"ks-active",steps:1,viewSize:[]};j.Plugins=[];h.augment(j,o,{_init:function(){var b=this,a=b.config;b._parseMarkup();a.switchTo&&b.switchTo(a.switchTo);a.hasTriggers&&b._bindTriggers();for(a=this.constructor;a;){h.each(a.Plugins,function(c){c.init&&c.init(b)});a=a.superclass?a.superclass.constructor:null}b.fire("init")},_parseMarkup:function(){var b=this.container,a=this.config,c,g=[],i=[];switch(a.markupType){case 0:if(c=
e.get("."+a.navCls,b))g=e.children(c);c=e.get("."+a.contentCls,b);i=e.children(c);break;case 1:g=e.query("."+a.triggerCls,b);i=e.query("."+a.panelCls,b);break;case 2:g=a.triggers;i=a.panels}b=i.length;this.length=b/a.steps;if(a.hasTriggers&&b>0&&g.length===0)g=this._generateTriggersMarkup(this.length);this.triggers=h.makeArray(g);this.panels=h.makeArray(i);this.content=c||i[0].parentNode},_generateTriggersMarkup:function(b){var a=this.config,c=e.create("<ul>"),g,i;c.className=a.navCls;for(i=0;i<b;i++){g=
e.create("<li>");if(i===this.activeIndex)g.className=a.activeTriggerCls;g.innerHTML=i+1;c.appendChild(g)}this.container.appendChild(c);return e.children(c)},_bindTriggers:function(){var b=this,a=b.config,c=b.triggers,g,i,f=c.length;for(i=0;i<f;i++)(function(l){g=c[l];k.on(g,"click",function(){b._onFocusTrigger(l)});if(a.triggerType==="mouse"){k.on(g,"mouseenter",function(){b._onMouseEnterTrigger(l)});k.on(g,"mouseleave",function(){b._onMouseLeaveTrigger(l)})}})(i)},_onFocusTrigger:function(b){if(this._triggerIsValid(b)){this._cancelSwitchTimer();
this.switchTo(b)}},_onMouseEnterTrigger:function(b){var a=this;if(a._triggerIsValid(b))a.switchTimer=h.later(function(){a.switchTo(b)},a.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(b){return this.activeIndex!==b},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=n}},switchTo:function(b,a){var c=this.config,g=this.triggers,i=this.panels,f=this.activeIndex,l=c.steps,p=f*l,t=b*l;if(!this._triggerIsValid(b))return this;
if(this.fire("beforeSwitch",{toIndex:b})===false)return this;if(c.hasTriggers)this._switchTrigger(f>-1?g[f]:null,g[b]);if(a===n)a=b>f?"forward":"backward";this._switchView(i.slice(p,p+l),i.slice(t,t+l),b,a);this.activeIndex=b;return this},_switchTrigger:function(b,a){var c=this.config.activeTriggerCls;b&&e.removeClass(b,c);e.addClass(a,c)},_switchView:function(b,a,c){e.css(b,"display","none");e.css(a,"display","block");this._fireOnSwitch(c)},_fireOnSwitch:function(b){this.fire("switch",{currentIndex:b})},
prev:function(){var b=this.activeIndex;this.switchTo(b>0?b-1:this.length-1,"backward")},next:function(){var b=this.activeIndex;this.switchTo(b<this.length-1?b+1:0,"forward")}});return j},{requires:["dom","event"]});
KISSY.add("switchable/accordion",function(h,e,k){function n(o,b){if(!(this instanceof n))return new n(o,b);n.superclass.constructor.call(this,o,h.merge(j,b));if(this.config.multiple)this._switchTrigger=function(){};return 0}var j={markupType:1,triggerType:"click",multiple:false};h.extend(n,k);h.augment(n,{_triggerIsValid:function(o){return this.activeIndex!==o||this.config.multiple},_switchView:function(o,b,a){var c=this.config,g=b[0];if(c.multiple){e.toggleClass(this.triggers[a],c.activeTriggerCls);
e.css(g,"display",g.style.display=="none"?"block":"none");this._fireOnSwitch(a)}else n.superclass._switchView.call(this,o,b,a)}});return n},{requires:["dom","switchable/base"]});
KISSY.add("switchable/autoplay",function(h,e,k,n){h.mix(k.Config,{autoplay:false,interval:5,pauseOnHover:true});k.Plugins.push({name:"autoplay",init:function(j){function o(){c=h.later(function(){j.paused||j.switchTo(j.activeIndex<j.length-1?j.activeIndex+1:0,"forward")},a,true)}var b=j.config,a=b.interval*1E3,c;if(b.autoplay){if(b.pauseOnHover){e.on(j.container,"mouseenter",function(){j.stop();j.paused=true});e.on(j.container,"mouseleave",function(){j.paused=false;o()})}o();j.stop=function(){if(c){c.cancel();
c=n}}}}});return k},{requires:["event","switchable/base"]});KISSY.add("switchable/autorender",function(h,e,k,n){n.autoRender=function(j,o){j="."+(j||"KS_Widget");e.query(j,o).each(function(b){var a=b.getAttribute("data-widget-type"),c;if(a&&"Switchable Tabs Slide Carousel Accordion".indexOf(a)>-1)try{if(c=b.getAttribute("data-widget-config"))c=c.replace(/'/g,'"');new h[a](b,k.parse(c))}catch(g){}})}},{requires:["dom","json","switchable/base"]});
KISSY.add("switchable/carousel",function(h,e,k,n,j){function o(f,l){var p=this;if(!(p instanceof o))return new o(f,l);p.on("init",function(){b(p)});o.superclass.constructor.call(p,f,h.merge(i,l));return 0}function b(f){var l=f.config,p=l.disableBtnCls,t=false;h.each(["prev","next"],function(q){var r=f[q+"Btn"]=e.get(a+l[q+"BtnCls"],f.container);k.on(r,"click",function(v){v.preventDefault();t||e.hasClass(r,p)||f[q]()})});if(!l.circular){f.on("beforeSwitch",function(){t=true});f.on("switch",function(q){q=
q.currentIndex;q=q===0?f[c]:q===f.length-1?f[g]:j;e.removeClass([f[c],f[g]],p);q&&e.addClass(q,p);t=false})}k.on(f.panels,"click focus",function(){f.fire("itemSelected",{item:this})})}var a=".",c="prevBtn",g="nextBtn",i={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};h.extend(o,n);return o},{requires:["dom","event","switchable/base"]});
KISSY.add("switchable/effect",function(h,e,k,n,j,o){var b;h.mix(j.Config,{effect:"none",duration:0.5,easing:"easeNone",nativeAnim:true});j.Effects={none:function(a,c,g){e.css(a,"display","none");e.css(c,"display","block");g()},fade:function(a,c,g){a.length!==1&&h.error("fade effect only supports steps == 1.");var i=this,f=i.config,l=a[0],p=c[0];i.anim&&i.anim.stop(true);e.css(p,"opacity",1);i.anim=(new n(l,{opacity:0},f.duration,f.easing,function(){i.anim=o;e.css(p,"z-index",9);e.css(l,"z-index",
1);g()},f.nativeAnim)).run()},scroll:function(a,c,g,i){var f=this;a=f.config;c=a.effect==="scrollx";var l={};l[c?"left":"top"]=-(f.viewSize[c?0:1]*i)+"px";f.anim&&f.anim.stop();f.anim=(new n(f.content,l,a.duration,a.easing,function(){f.anim=o;g()},a.nativeAnim)).run()}};b=j.Effects;b.scrollx=b.scrolly=b.scroll;j.Plugins.push({name:"effect",init:function(a){var c=a.config,g=c.effect,i=a.panels,f=a.content,l=c.steps,p=a.activeIndex,t=i.length;a.viewSize=[c.viewSize[0]||i[0].offsetWidth*l,c.viewSize[1]||
i[0].offsetHeight*l];if(g!=="none"){h.each(i,function(d){e.css(d,"display","block")});switch(g){case "scrollx":case "scrolly":e.css(f,"position","absolute");e.css(f.parentNode,"position","relative");if(g==="scrollx"){e.css(i,"float","left");e.width(f,a.viewSize[0]*(t/l))}break;case "fade":var q=p*l,r=q+l-1,v;h.each(i,function(d,s){v=s>=q&&s<=r;e.css(d,{opacity:v?1:0,position:"absolute",zIndex:v?9:1})})}}}});h.augment(j,{_switchView:function(a,c,g,i){var f=this,l=f.config.effect;(h.isFunction(l)?l:
b[l]).call(f,a,c,function(){f._fireOnSwitch(g)},g,i)}});return j},{requires:["dom","event","anim","switchable/base"]});
KISSY.add("switchable/circular",function(h,e,k,n){function j(r,v,d,s,u){var m=this;r=m.config;v=m.length;var w=m.activeIndex,x=r.scrollType===q,y=x?g:i,z=m.viewSize[x?0:1];x=-z*s;var B={},C,A=u===t;if(C=A&&w===0&&s===v-1||u===p&&w===v-1&&s===0)x=o.call(m,m.panels,s,A,y,z);B[y]=x+l;m.anim&&m.anim.stop();m.anim=(new k(m.content,B,r.duration,r.easing,function(){C&&b.call(m,m.panels,s,A,y,z);m.anim=undefined;d()},r.nativeAnim)).run()}function o(r,v,d,s,u){var m=this.config.steps;v=this.length;var w=d?
v-1:0,x=(w+1)*m;for(m=w*m;m<x;m++){e.css(r[m],a,c);e.css(r[m],s,(d?-1:1)*u*v)}return d?u:-u*v}function b(r,v,d,s,u){var m=this.config.steps;v=this.length;var w=d?v-1:0,x=(w+1)*m;for(m=w*m;m<x;m++){e.css(r[m],a,f);e.css(r[m],s,f)}e.css(this.content,s,d?-u*(v-1):f)}var a="position",c="relative",g="left",i="top",f="",l="px",p="forward",t="backward",q="scrollx";h.mix(n.Config,{circular:false});n.Plugins.push({name:"circular",init:function(r){r=r.config;if(r.circular&&(r.effect===q||r.effect==="scrolly")){r.scrollType=
r.effect;r.effect=j}}})},{requires:["dom","anim","switchable/base","switchable/effect"]});
KISSY.add("switchable/countdown",function(h,e,k,n,j,o){h.mix(j.Config,{countdown:false,countdownFromStyle:"",countdownToStyle:"width: 0"});j.Plugins.push({name:"countdown",init:function(b){function a(){c();t=(new n(f[b.activeIndex],p,i-1)).run()}function c(){if(t){t.stop();t=o}}var g=b.config,i=g.interval,f=[],l=g.countdownFromStyle,p=g.countdownToStyle,t;if(!(!g.autoplay||!g.hasTriggers||!g.countdown)){h.each(b.triggers,function(q,r){q.innerHTML='<div class="ks-switchable-trigger-mask"></div><div class="ks-switchable-trigger-content">'+
q.innerHTML+"</div>";f[r]=q.firstChild});if(g.pauseOnHover){k.on(b.container,"mouseenter",function(){c();var q=f[b.activeIndex];if(l)t=(new n(q,l,0.2,"easeOut")).run();else e.removeAttr(q,"style")});k.on(b.container,"mouseleave",function(){c();e.removeAttr(f[b.activeIndex],"style");h.later(a,200)})}b.on("beforeSwitch",function(){c();e.removeAttr(f[b.activeIndex],"style")});b.on("switch",function(){b.paused||a()});a(b.activeIndex)}}});return j},{requires:["dom","event","anim","switchable/base"]});
KISSY.add("switchable/lazyload",function(h,e,k){var n="beforeSwitch",j="img-src",o="area-data",b={};b[j]="data-ks-lazyload-custom";b[o]="ks-datalazyload-custom";h.mix(k.Config,{lazyDataType:o});k.Plugins.push({name:"lazyload",init:function(a){function c(p){var t=i.steps;p=p.toIndex*t;g.loadCustomLazyData(a.panels.slice(p,p+t),f);a:{var q,r;if(p=(t=f===j)?"img":f===o?"textarea":""){p=e.query(p,a.container);q=0;for(r=p.length;q<r;q++)if(t?e.attr(p[q],l):e.hasClass(p[q],l)){t=false;break a}}t=true}t&&
a.detach(n,c)}var g=h.require("datalazyload"),i=a.config,f=i.lazyDataType,l=b[f];!g||!f||!l||a.on(n,c)}});return k},{requires:["dom","switchable/base"]});KISSY.add("switchable/slide",function(h,e){function k(j,o){if(!(this instanceof k))return new k(j,o);k.superclass.constructor.call(this,j,h.merge(n,o));return 0}var n={autoplay:true,circular:true};h.extend(k,e);return k},{requires:["switchable/base"]});
KISSY.add("switchable/tabs",function(h,e){function k(n,j){if(!(this instanceof k))return new k(n,j);k.superclass.constructor.call(this,n,j);return 0}k.Config={};k.Plugins=[];h.extend(k,e);h.Tabs=k;k.Config={};return k},{requires:["./base"]});
KISSY.add("switchable/tabs-aria",function(h,e){function k(d,s){d.tabIndex=s;c.query("*",d).each(function(u){u.tabIndex=s})}function n(d){var s;h.each(this.triggers,function(u){if(u==d||c.contains(u,d))s=u});return s}function j(d){switch(d.keyCode){case g:case i:d.ctrlKey&&!d.altKey&&!d.shiftKey&&d.halt();break;case v:d.ctrlKey&&!d.altKey&&d.halt()}}function o(d){var s=d.target,u=this.triggers,m=!d.ctrlKey&&!d.shiftKey&&!d.altKey,w=d.ctrlKey&&!d.shiftKey&&!d.altKey;switch(d.keyCode){case p:case t:if(n.call(this,
s)){this.prev();d.halt()}break;case q:case r:if(n.call(this,s)){this.next();d.halt()}break;case i:if(w){d.halt();d.preventDefault();this.next()}break;case g:if(w){d.halt();this.prev()}break;case l:if(m){this.switchTo(0);d.halt()}break;case f:if(m){this.switchTo(u.length-1);d.halt()}break;case v:if(d.ctrlKey&&!d.altKey){d.halt();d.shiftKey?this.prev():this.next()}}}function b(d){var s=this.lastActiveIndex;d=d.currentIndex;if(!(s===undefined||s==d)){var u=this.triggers[d],m=this.panels[s],w=this.panels[d];
k(this.triggers[s],"-1");k(u,"0");u.focus();m.setAttribute("aria-hidden","true");w.setAttribute("aria-hidden","false");this.lastActiveIndex=d}}var a=h.Event,c=h.DOM,g=33,i=34,f=35,l=36,p=37,t=38,q=39,r=40,v=9;h.mix(e.Config,{aria:true});e.Plugins.push({name:"aria",init:function(d){if(d.config.aria){var s=d.activeIndex;d.lastActiveIndex=s;var u=d.triggers,m=d.panels,w=0;h.each(u,function(x){x.setAttribute("role","tab");k(x,w==s?"0":"-1");if(!x.id)x.id=h.guid("ks-switchable");w++});w=0;h.each(m,function(x){var y=
u[w];x.setAttribute("role","tabpanel");x.setAttribute("aria-hidden",w==s?"false":"true");x.setAttribute("aria-labelledby",y.id);w++});d.on("switch",b,d);m=d.container;a.on(m,"keydown",o,d);a.on(m,"keypress",j,d)}}})},{requires:["./tabs"]});
KISSY.add("switchable",function(h,e,k,n,j,o,b,a,c,g,i,f){h.Switchable=e;k={Accordion:k,Carousel:o,Slide:i,Tabs:f};h.mix(h,k);h.mix(e,k);return e},{requires:["switchable/base","switchable/accordion","switchable/autoplay","switchable/autorender","switchable/carousel","switchable/circular","switchable/countdown","switchable/effect","switchable/lazyload","switchable/slide","switchable/tabs","switchable/tabs-aria"]});
