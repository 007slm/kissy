/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("switchable/base",function(i,d,k,m){function g(a,b){b=b||{};if(!("markupType"in b))if(b.panelCls)b.markupType=1;else if(b.panels)b.markupType=2;b=i.merge(g.Config,b);this.container=d.get(a);this.config=b;this.activeIndex=b.activeIndex;this._init()}var l=i.require("event/target");g.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,
activeIndex:0,activeTriggerCls:"ks-active",steps:1,viewSize:[]};g.Plugins=[];i.augment(g,l,{_init:function(){var a=this,b=a.config;a._parseMarkup();b.switchTo&&a.switchTo(b.switchTo);b.hasTriggers&&a._bindTriggers();i.each(g.Plugins,function(c){c.init&&c.init(a)});a.fire("init")},_parseMarkup:function(){var a=this.container,b=this.config,c,f=[],h=[];switch(b.markupType){case 0:if(c=d.get("."+b.navCls,a))f=d.children(c);c=d.get("."+b.contentCls,a);h=d.children(c);break;case 1:f=d.query("."+b.triggerCls,
a);h=d.query("."+b.panelCls,a);break;case 2:f=b.triggers;h=b.panels;break}a=h.length;this.length=a/b.steps;if(b.hasTriggers&&a>0&&f.length===0)f=this._generateTriggersMarkup(this.length);this.triggers=i.makeArray(f);this.panels=i.makeArray(h);this.content=c||h[0].parentNode},_generateTriggersMarkup:function(a){var b=this.config,c=d.create("<ul>"),f,h;c.className=b.navCls;for(h=0;h<a;h++){f=d.create("<li>");if(h===this.activeIndex)f.className=b.activeTriggerCls;f.innerHTML=h+1;c.appendChild(f)}this.container.appendChild(c);
return d.children(c)},_bindTriggers:function(){var a=this,b=a.config,c=a.triggers,f,h,e=c.length;for(h=0;h<e;h++)(function(j){f=c[j];k.on(f,"click",function(){a._onFocusTrigger(j)});if(b.triggerType==="mouse"){k.on(f,"mouseenter",function(){a._onMouseEnterTrigger(j)});k.on(f,"mouseleave",function(){a._onMouseLeaveTrigger(j)})}})(h)},_onFocusTrigger:function(a){if(this._triggerIsValid(a)){this._cancelSwitchTimer();this.switchTo(a)}},_onMouseEnterTrigger:function(a){var b=this;if(b._triggerIsValid(a))b.switchTimer=
i.later(function(){b.switchTo(a)},b.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(a){return this.activeIndex!==a},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=m}},switchTo:function(a,b){var c=this.config,f=this.triggers,h=this.panels,e=this.activeIndex,j=c.steps,r=e*j,q=a*j;if(!this._triggerIsValid(a))return this;if(this.fire("beforeSwitch",{toIndex:a})===false)return this;if(c.hasTriggers)this._switchTrigger(e>
-1?f[e]:null,f[a]);if(b===m)b=a>e?"forward":"backward";this._switchView(h.slice(r,r+j),h.slice(q,q+j),a,b);this.activeIndex=a;return this},_switchTrigger:function(a,b){var c=this.config.activeTriggerCls;a&&d.removeClass(a,c);d.addClass(b,c)},_switchView:function(a,b,c){d.css(a,"display","none");d.css(b,"display","block");this._fireOnSwitch(c)},_fireOnSwitch:function(a){this.fire("switch",{currentIndex:a})},prev:function(){var a=this.activeIndex;this.switchTo(a>0?a-1:this.length-1,"backward")},next:function(){var a=
this.activeIndex;this.switchTo(a<this.length-1?a+1:0,"forward")}});return g},{requires:["dom","event"]});
KISSY.add("switchable/accordion",function(i,d,k){function m(l,a){if(!(this instanceof m))return new m(l,a);m.superclass.constructor.call(this,l,i.merge(g,a));if(this.config.multiple)this._switchTrigger=function(){};return 0}var g={markupType:1,triggerType:"click",multiple:false};i.extend(m,k);i.augment(m,{_triggerIsValid:function(l){return this.activeIndex!==l||this.config.multiple},_switchView:function(l,a,b){var c=this.config,f=a[0];if(c.multiple){d.toggleClass(this.triggers[b],c.activeTriggerCls);
d.css(f,"display",f.style.display=="none"?"block":"none");this._fireOnSwitch(b)}else m.superclass._switchView.call(this,l,a,b)}});return m},{requires:["dom","switchable/base"]});
KISSY.add("switchable/autoplay",function(i,d,k,m){i.mix(k.Config,{autoplay:false,interval:5,pauseOnHover:true});k.Plugins.push({name:"autoplay",init:function(g){function l(){c=i.later(function(){g.paused||g.switchTo(g.activeIndex<g.length-1?g.activeIndex+1:0,"forward")},b,true)}var a=g.config,b=a.interval*1E3,c;if(a.autoplay){if(a.pauseOnHover){d.on(g.container,"mouseenter",function(){g.stop();g.paused=true});d.on(g.container,"mouseleave",function(){g.paused=false;l()})}l();g.stop=function(){if(c){c.cancel();
c=m}}}}});return k},{requires:["event","switchable/base"]});KISSY.add("switchable/autorender",function(i,d,k,m){m.autoRender=function(g,l){g="."+(g||"KS_Widget");d.query(g,l).each(function(a){var b=a.getAttribute("data-widget-type"),c;if(b&&"Switchable Tabs Slide Carousel Accordion".indexOf(b)>-1)try{if(c=a.getAttribute("data-widget-config"))c=c.replace(/'/g,'"');new i[b](a,k.parse(c))}catch(f){}})}},{requires:["dom","json","switchable/base"]});
KISSY.add("switchable/carousel",function(i,d,k,m,g){function l(e,j){var r=this;if(!(r instanceof l))return new l(e,j);r.on("init",function(){a(r)});l.superclass.constructor.call(r,e,i.merge(h,j));return 0}function a(e){var j=e.config,r=j.disableBtnCls,q=false;i.each(["prev","next"],function(n){var o=e[n+"Btn"]=d.get(b+j[n+"BtnCls"],e.container);k.on(o,"click",function(s){s.preventDefault();q||d.hasClass(o,r)||e[n]()})});if(!j.circular){e.on("beforeSwitch",function(){q=true});e.on("switch",function(n){n=
n.currentIndex;n=n===0?e[c]:n===e.length-1?e[f]:g;d.removeClass([e[c],e[f]],r);n&&d.addClass(n,r);q=false})}k.on(e.panels,"click focus",function(){e.fire("itemSelected",{item:this})})}var b=".",c="prevBtn",f="nextBtn",h={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};i.extend(l,m);return l},{requires:["dom","event","switchable/base"]});
KISSY.add("switchable/effect",function(i,d,k,m,g,l){var a;i.mix(g.Config,{effect:"none",duration:0.5,easing:"easeNone",nativeAnim:true});g.Effects={none:function(b,c,f){d.css(b,"display","none");d.css(c,"display","block");f()},fade:function(b,c,f){b.length!==1&&i.error("fade effect only supports steps == 1.");var h=this,e=h.config,j=b[0],r=c[0];h.anim&&h.anim.stop(true);d.css(r,"opacity",1);h.anim=(new m(j,{opacity:0},e.duration,e.easing,function(){h.anim=l;d.css(r,"z-index",9);d.css(j,"z-index",
1);f()},e.nativeAnim)).run()},scroll:function(b,c,f,h){var e=this;b=e.config;c=b.effect==="scrollx";var j={};j[c?"left":"top"]=-(e.viewSize[c?0:1]*h)+"px";e.anim&&e.anim.stop();e.anim=(new m(e.content,j,b.duration,b.easing,function(){e.anim=l;f()},b.nativeAnim)).run()}};a=g.Effects;a.scrollx=a.scrolly=a.scroll;g.Plugins.push({name:"effect",init:function(b){var c=b.config,f=c.effect,h=b.panels,e=b.content,j=c.steps,r=b.activeIndex,q=h.length;b.viewSize=[c.viewSize[0]||h[0].offsetWidth*j,c.viewSize[1]||
h[0].offsetHeight*j];if(f!=="none"){i.each(h,function(u){d.css(u,"display","block")});switch(f){case "scrollx":case "scrolly":d.css(e,"position","absolute");d.css(e.parentNode,"position","relative");if(f==="scrollx"){d.css(h,"float","left");d.width(e,b.viewSize[0]*(q/j))}break;case "fade":var n=r*j,o=n+j-1,s;i.each(h,function(u,t){s=t>=n&&t<=o;d.css(u,{opacity:s?1:0,position:"absolute",zIndex:s?9:1})});break}}}});i.augment(g,{_switchView:function(b,c,f,h){var e=this,j=e.config.effect;(i.isFunction(j)?
j:a[j]).call(e,b,c,function(){e._fireOnSwitch(f)},f,h)}});return g},{requires:["dom","event","anim","switchable/base"]});
KISSY.add("switchable/circular",function(i,d,k,m){function g(o,s,u,t,w){var p=this;o=p.config;s=p.length;var x=p.activeIndex,v=o.scrollType===n,y=v?f:h,z=p.viewSize[v?0:1];v=-z*t;var B={},C,A=w===q;if(C=A&&x===0&&t===s-1||w===r&&x===s-1&&t===0)v=l.call(p,p.panels,t,A,y,z);B[y]=v+j;p.anim&&p.anim.stop();p.anim=(new k(p.content,B,o.duration,o.easing,function(){C&&a.call(p,p.panels,t,A,y,z);p.anim=undefined;u()},o.nativeAnim)).run()}function l(o,s,u,t,w){var p=this.config.steps;s=this.length;var x=u?
s-1:0,v=(x+1)*p;for(p=x*p;p<v;p++){d.css(o[p],b,c);d.css(o[p],t,(u?-1:1)*w*s)}return u?w:-w*s}function a(o,s,u,t,w){var p=this.config.steps;s=this.length;var x=u?s-1:0,v=(x+1)*p;for(p=x*p;p<v;p++){d.css(o[p],b,e);d.css(o[p],t,e)}d.css(this.content,t,u?-w*(s-1):e)}var b="position",c="relative",f="left",h="top",e="",j="px",r="forward",q="backward",n="scrollx";i.mix(m.Config,{circular:false});m.Plugins.push({name:"circular",init:function(o){o=o.config;if(o.circular&&(o.effect===n||o.effect==="scrolly")){o.scrollType=
o.effect;o.effect=g}}})},{requires:["dom","anim","switchable/base","switchable/effect"]});
KISSY.add("switchable/countdown",function(i,d,k,m,g,l){i.mix(g.Config,{countdown:false,countdownFromStyle:"",countdownToStyle:"width: 0"});g.Plugins.push({name:"countdown",init:function(a){function b(){c();q=(new m(e[a.activeIndex],r,h-1)).run()}function c(){if(q){q.stop();q=l}}var f=a.config,h=f.interval,e=[],j=f.countdownFromStyle,r=f.countdownToStyle,q;if(!(!f.autoplay||!f.hasTriggers||!f.countdown)){i.each(a.triggers,function(n,o){n.innerHTML='<div class="ks-switchable-trigger-mask"></div><div class="ks-switchable-trigger-content">'+
n.innerHTML+"</div>";e[o]=n.firstChild});if(f.pauseOnHover){k.on(a.container,"mouseenter",function(){c();var n=e[a.activeIndex];if(j)q=(new m(n,j,0.2,"easeOut")).run();else d.removeAttr(n,"style")});k.on(a.container,"mouseleave",function(){c();d.removeAttr(e[a.activeIndex],"style");i.later(b,200)})}a.on("beforeSwitch",function(){c();d.removeAttr(e[a.activeIndex],"style")});a.on("switch",function(){a.paused||b()});b(a.activeIndex)}}});return g},{requires:["dom","event","anim","switchable/base"]});
KISSY.add("switchable/lazyload",function(i,d,k){var m="beforeSwitch",g="img-src",l="area-data",a={};a[g]="data-ks-lazyload-custom";a[l]="ks-datalazyload-custom";i.mix(k.Config,{lazyDataType:l});k.Plugins.push({name:"lazyload",init:function(b){function c(q){var n=e.steps;q=q.toIndex*n;h.loadCustomLazyData(b.panels.slice(q,q+n),j);f()&&b.detach(m,c)}function f(){var q,n,o,s=j===g;if(q=s?"img":j===l?"textarea":""){q=d.query(q,b.container);n=0;for(o=q.length;n<o;n++)if(s?d.attr(q[n],r):d.hasClass(q[n],
r))return false}return true}var h=i.require("datalazyload"),e=b.config,j=e.lazyDataType,r=a[j];!h||!j||!r||b.on(m,c)}});return k},{requires:["dom","switchable/base"]});KISSY.add("switchable/slide",function(i,d){function k(g,l){if(!(this instanceof k))return new k(g,l);k.superclass.constructor.call(this,g,i.merge(m,l));return 0}var m={autoplay:true,circular:true};i.extend(k,d);return k},{requires:["switchable/base"]});
KISSY.add("switchable/tabs",function(i,d){function k(m,g){if(!(this instanceof k))return new k(m,g);k.superclass.constructor.call(this,m,g);return 0}i.extend(k,d);return k},{requires:["switchable/base"]});
KISSY.add("switchable",function(i,d,k,m,g,l,a,b,c,f,h,e){i.Switchable=d;k={Accordion:k,Carousel:l,Slide:h,Tabs:e};i.mix(i,k);i.mix(d,k);return d},{requires:["switchable/base","switchable/accordion","switchable/autoplay","switchable/autorender","switchable/carousel","switchable/circular","switchable/countdown","switchable/effect","switchable/lazyload","switchable/slide","switchable/tabs"]});
