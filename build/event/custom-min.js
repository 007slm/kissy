/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 25 00:37
*/
KISSY.add("event/custom/custom-event",function(f,i,d,l){function h(){h.superclass.constructor.apply(this,arguments);this.defaultFn=null;this.defaultTargetOnly=!1}var m=l._Utils;f.extend(h,l._BaseCustomEvent,{constructor:h,on:function(a){a=new i(a);-1==this.findSubscriber(a)&&this.subscribers.push(a)},fire:function(a){if(this.hasSubscriber()||this.bubbles){var a=a||{},b=this.type,g=this.defaultFn,c,k,j;c=this.currentTarget;var e=a,f;a.type=b;e instanceof d||(e.target=c,e=new d(e));e.currentTarget=
c;a=this.notify(e);if(this.bubbles){j=(k=c.getTargets())&&k.length||0;for(c=0;c<j&&!e.isPropagationStopped();c++)f=k[c].fire(b,e),!1!==a&&(a=f)}g&&!e.isDefaultPrevented()&&(b=e.target.__getCustomEvent(e.type),(!this.defaultTargetOnly&&!b.defaultTargetOnly||this==e.target)&&g.call(this));return a}},notify:function(a){var b=this.subscribers,g,c,k=b.length,j;for(j=0;j<k&&!a.isImmediatePropagationStopped();j++)g=b[j].notify(a,this),!1!==c&&(c=g),!1===g&&a.halt();return c},detach:function(a){var b,g=a.fn,
c=this.context,k=this.currentTarget,j=this.subscribers,a=a.groups;if(j.length){a&&(b=m.getGroupsRe(a));var e,f,d,h,i=j.length;if(g||b){c=c||k;e=a=0;for(f=[];a<i;++a)if(d=j[a],h=d.context||k,c!=h||g&&g!=d.fn||b&&!d.groups.match(b))f[e++]=d;this.subscribers=f}else this.reset()}}});return h},{requires:["./subscriber","./object","event/base"]});KISSY.add("event/custom",function(f,i,d){f.EventTarget=i.Target=d;return{Target:d}},{requires:["./base","./custom/target"]});
KISSY.add("event/custom/object",function(f,i){function d(d){f.mix(this,d)}f.extend(d,i._Object);return d},{requires:["event/base"]});KISSY.add("event/custom/subscriber",function(f,i){function d(){d.superclass.constructor.apply(this,arguments)}f.extend(d,i._Subscriber,{keys:["fn","context"]});return d},{requires:["event/base"]});
KISSY.add("event/custom/target",function(f,i,d){var l=f.trim,h=i._Utils,m=h.splitAndRun;return{__getCustomEvent:function(a,b){var g,c=this["__~ks_custom_events"];g=c&&c[a];!g&&b&&(c=this["__~ks_custom_events"]=c||{},g=c[a]=new d({currentTarget:this,type:a}));return g},fire:function(a,b){var g=this,c=void 0,b=b||{};m(a,function(a){var d,e,a=h.getTypedGroups(a);e=a[1];a=a[0];e&&(e=h.getGroupsRe(e),b._ks_groups=e);(e=g.__getCustomEvent(a))&&(d=e.fire(b));!1!==c&&(c=d)});return c},publish:function(a,
b){var d=this,c;m(a,function(a){c=d.__getCustomEvent(a,1);f.mix(c,b)})},addTarget:function(a){var b=this.getTargets();f.inArray(a,b)||b.push(a)},removeTarget:function(a){var b=this.getTargets(),a=f.indexOf(a,b);-1!=a&&b.splice(a,1)},getTargets:function(){self["__~ks_bubble_targets"]=self["__~ks_bubble_targets"]||[];return self["__~ks_bubble_targets"]},on:function(a,b,d){var c=this,a=l(a);h.batchForType(function(a,b,d){b=h.normalizeParam(a,b,d);a=b.type;if(a=c.__getCustomEvent(a,1))a.on(b)},0,a,b,
d);return c},detach:function(a,b,d){var c=this,a=l(a);h.batchForType(function(a,b,d){var g=h.normalizeParam(a,b,d);(a=g.type)?(a=c.__getCustomEvent(a,1))&&a.detach(g):f.each(c["__~ks_custom_events"]||{},function(a){a.detach(g)})},0,a,b,d);return c}}},{requires:["event/base","./custom-event"]});
