/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 8 19:16
*/
KISSY.add("event/dom/touch/double-tap",function(g,a,e,h){function b(){}g.extend(b,h,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var i=this.lastEndTime,b=a.timeStamp,d=a.target,f=a.changedTouches[0],c=b-this.startTime;this.lastEndTime=b;if(i&&(c=b-i,300>c)){this.lastEndTime=0;e.fire(d,"doubleTap",
{touch:f,duration:c});return}c=b-this.startTime;300<c?e.fire(d,"singleTap",{touch:f,duration:c}):this.singleTapTimer=setTimeout(function(){e.fire(d,"singleTap",{touch:f,duration:c})},300)}});return a.singleTap=a.doubleTap=b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(g,a){var e=a.Gesture,h=g.Features,b,j,i;h.isTouchSupported?(b="touchstart",j="touchmove",i="touchend"):h.isMsPointerEnabled&&(b="MSPointerDown",j="MSPointerMove",i="MSPointerUp");b&&(e.start=b,e.move=j,e.end=i,e.tap="tap");return e},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(g,a,e,h,b){function j(f){this.doc=f;this.eventHandle={};this.init()}var i=g.guid("touch-handle"),k=g.Features,d={};d[b.start]="onTouchStart";d[b.move]="onTouchMove";d[b.end]="onTouchEnd";"mousedown"!==b.start&&(d.touchcancel="onTouchEnd");j.prototype={init:function(){var f=this.doc,c,a;this.onTouchMove=g.throttle(this.onTouchMove,30);for(c in d){a=d[c];h.on(f,c,this[a],this)}},normalize:function(f){var c=f.type,a;if(!k.isTouchSupported){if(c.indexOf("mouse")!=
-1&&f.which!=1)return;a=[f];c=!c.match(/up$/i);f.touches=c?a:[];f.targetTouches=c?a:[];f.changedTouches=a}return f},onTouchStart:function(f){var c,a;for(c in this.eventHandle){a=this.eventHandle[c];a.isActive=true}this.callEventHandle("onTouchStart",f)},onTouchMove:function(f){this.callEventHandle("onTouchMove",f)},onTouchEnd:function(f){this.callEventHandle("onTouchEnd",f)},callEventHandle:function(f,c){var a,b;if(c=this.normalize(c))for(a in this.eventHandle){b=this.eventHandle[a];if(b.isActive&&
b[f](c)===false)b.isActive=false}},addEventHandle:function(a){var c=e[a];if(!this.eventHandle[a]&&!c.used){this.eventHandle[a]=new c;c.used=1}},removeEventHandle:function(a){delete this.eventHandle[a]},destroy:function(){var a=this.doc,c,b;for(c in d){b=d[c];h.detach(a,c,this[b],this)}}};return{addDocumentHandle:function(b,c){var d=a._getWin(b.ownerDocument||b).document,e=a.data(d,i);e||a.data(d,i,e=new j(d));e.addEventHandle(c)},removeDocumentHandle:function(b,c){var d=a._getWin(b.ownerDocument||
b).document,e=a.data(d,i);if(e){e.removeEventHandle(c);if(g.isEmptyObject(eventHandle)){e.destroy();a.removeData(d,i)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap".split(",")});KISSY.add("event/dom/touch/single-touch",function(g){function a(){}a.prototype={onTouchStart:function(a){if(1<a.touches.length)return!1},onTouchMove:g.noop,onTouchEnd:g.noop};return a});
KISSY.add("event/dom/touch/swipe",function(g,a,e,h){function b(){this.event=j}var j="swipe";g.extend(b,h,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;var e=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=e.pageX;this.startY=e.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],d=b.pageY,b=Math.abs(b.pageX-this.startX),d=Math.abs(d-this.startY);if(1E3<a.timeStamp-
this.startTime)return!1;this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<d&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],d=b.pageX-this.startX,f=b.pageY-this.startY,c=Math.abs(d),g=Math.abs(f);this.isVertical&&50>g&&(this.isVertical=0);this.isHorizontal&&50>c&&(this.isHorizontal=0);if(this.isHorizontal)d=0>d?"left":"right";else if(this.isVertical)d=0>f?"up":"down",c=g;else return!1;
e.fire(a.target,this.event,{touch:b,direction:d,distance:c,duration:a.timeStamp-this.startTime})}});return a[j]=b},{requires:["./handle-map","event/dom/base","./single-touch"]});KISSY.add("event/dom/touch/tap",function(g,a,e,h){function b(){}g.extend(b,h,{onTouchMove:function(){return!1},onTouchEnd:function(a){e.fire(a.target,"tap",{touch:a.changedTouches[0]})}});return a.tap=b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(g,a,e,h){var g=a._Special,a={setup:function(a){h.addDocumentHandle(this,a)},tearDown:function(a){h.removeDocumentHandle(this,a)}},b;for(b in e)g[b]=a},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
