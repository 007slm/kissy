/*
Copyright 2013, KISSY UI Library v1.30
MIT Licensed
build time: Apr 2 11:09
*/
KISSY.add("event/dom/touch/double-tap",function(f,c,d,b){function a(){}f.extend(a,b,{onTouchStart:function(e){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=e.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,i=a.timeStamp,c=a.target,f=a.changedTouches[0],g=i-this.startTime;this.lastEndTime=i;if(b&&(g=i-b,300>g)){this.lastEndTime=0;d.fire(c,"doubleTap",
{touch:f,duration:g/1E3});return}g=i-this.startTime;300<g?d.fire(c,"singleTap",{touch:f,duration:g/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(c,"singleTap",{touch:f,duration:g/1E3})},300)}});c.singleTap=c.doubleTap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(f,c){var d=c.Gesture,b,a,e;f.Features.isTouchSupported()&&(b="touchstart",a="touchmove",e="touchend");b&&(d.start=b,d.move=a,d.end=e,d.tap="tap",d.doubleTap="doubleTap");return d},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(f,c,d,b,a){function e(g){this.doc=g;this.eventHandle={};this.init()}var h=f.guid("touch-handle"),i=f.Features,k={};k[a.start]="onTouchStart";k[a.move]="onTouchMove";k[a.end]="onTouchEnd";"mousedown"!==a.start&&(k.touchcancel="onTouchEnd");var j=f.throttle(function(g){this.callEventHandle("onTouchMove",g)},30);e.prototype={init:function(){var g=this.doc,l,a;for(l in k){a=k[l];b.on(g,l,this[a],this)}},normalize:function(g){var l=g.type,a;if(!i.isTouchSupported()){if(l.indexOf("mouse")!=
-1&&g.which!=1)return;a=[g];l=!l.match(/up$/i);g.touches=l?a:[];g.targetTouches=l?a:[];g.changedTouches=a}return g},onTouchMove:function(g){j.call(this,g)},onTouchStart:function(g){var a,b,e=this.eventHandle;for(a in e){b=e[a].handle;b.isActive=1}this.callEventHandle("onTouchStart",g)},onTouchEnd:function(g){this.callEventHandle("onTouchEnd",g)},callEventHandle:function(g,a){var b=this.eventHandle,e,c;if(a=this.normalize(a)){for(e in b){c=b[e].handle;if(!c.processed){c.processed=1;if(c.isActive&&
c[g](a)===false)c.isActive=0}}for(e in b){c=b[e].handle;c.processed=0}}},addEventHandle:function(a){var b=this.eventHandle,e=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:e}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;b[a].count||delete b[a]}},destroy:function(){var a=this.doc,e,c;for(e in k){c=k[e];b.detach(a,e,this[c],this)}}};return{addDocumentHandle:function(a,b){var i=c.getWindow(a.ownerDocument||a).document,f=d[b].setup,j=c.data(i,h);j||c.data(i,h,j=new e(i));
f&&f.call(a,b);j.addEventHandle(b)},removeDocumentHandle:function(a,b){var e=c.getWindow(a.ownerDocument||a).document,i=d[b].tearDown,j=c.data(e,h);i&&i.call(a,b);if(j){j.removeEventHandle(b);if(f.isEmptyObject(j.eventHandle)){j.destroy();c.removeData(e,h)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(f,c){function d(){}d.prototype={requiredTouchCount:2,onTouchStart:function(b){var a=this.requiredTouchCount,e=b.touches.length;e===a?this.start():e>a&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(b){var a=b.touches,b=a[0].target,a=a[1].target;if(b==a||c.contains(b,a))return b;for(;;){if(c.contains(a,b))return a;a=a.parentNode}},end:function(b){this.isTracking&&
(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(b)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,c,d,b,a){function e(){}function h(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}f.extend(e,b,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,e,c=b[0],h=b[1];e=c.pageX-h.pageX;c=c.pageY-h.pageY;e=Math.sqrt(e*e+c*c);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",f.mix(a,{distance:e,scale:e/this.startDistance})):(this.isStarted=!0,this.startDistance=e,b=this.target=this.getCommonTarget(a),d.fire(b,"pinchStart",f.mix(a,
{distance:e,scale:1})))}},fireEnd:function(a){d.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});b=new e;c.pinchStart=c.pinchEnd={handle:b};c.pinch={handle:b,setup:function(){d.on(this,a.move,h)},tearDown:function(){d.detach(this,a.move,h)}};return e},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(f,c,d,b,a,e){function h(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var k=180/Math.PI;f.extend(h,d,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,d=c[0],i=c[1],h=this.lastAngle,d=Math.atan2(i.pageY-d.pageY,i.pageX-d.pageX)*k;if(h!==e){var i=Math.abs(d-h),m=(d+360)%360,n=(d-360)%360;Math.abs(m-h)<i?d=m:Math.abs(n-h)<i&&(d=n)}this.lastTouches=c;this.lastAngle=d;this.isStarted?b.fire(this.target,"rotate",f.mix(a,{angle:d,
rotation:d-this.startAngle})):(this.isStarted=!0,this.startAngle=d,this.target=this.getCommonTarget(a),b.fire(this.target,"rotateStart",f.mix(a,{angle:d,rotation:0})))}},end:function(){this.lastAngle=e;h.superclass.end.apply(this,arguments)},fireEnd:function(a){b.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});d=new h;c.rotateEnd=c.rotateStart={handle:d};c.rotate={handle:d,setup:function(){b.on(this,a.move,i)},tearDown:function(){b.detach(this,a.move,i)}};return h},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch",function(f){function c(){}c.prototype={requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return c});
KISSY.add("event/dom/touch/swipe",function(f,c,d,b){function a(){}f.extend(a,b,{onTouchStart:function(b){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;var c=b.touches[0];this.startTime=b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=c.pageX;this.startY=c.pageY;-1!=b.type.indexOf("mouse")&&b.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;
this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,f=b.pageY-this.startY,j=Math.abs(c),g=Math.abs(f);this.isVertical&&50>g&&(this.isVertical=0);this.isHorizontal&&50>j&&(this.isHorizontal=0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=0>f?"up":"down",j=g;else return!1;d.fire(a.target,
"swipe",{touch:b,direction:c,distance:j,duration:(a.timeStamp-this.startTime)/1E3})}});c.swipe={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(f,c,d,b,a){function e(){}function h(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}f.extend(e,d,{onTouchStart:function(a){if(!1===e.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){b.fire(a.target,"tapHold",{touch:a.touches[0],duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold={setup:function(){b.on(this,
a.start,h)},tearDown:function(){b.detach(this,a.start,h)},handle:new e};return e},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/tap",function(f,c,d,b){function a(){}f.extend(a,b,{onTouchMove:function(){return!1},onTouchEnd:function(a){d.fire(a.target,"tap",{touch:a.changedTouches[0]})}});c.tap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(f,c,d,b){var f=c._Special,c={setup:function(a){b.addDocumentHandle(this,a)},tearDown:function(a){b.removeDocumentHandle(this,a)}},a;for(a in d)f[a]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
