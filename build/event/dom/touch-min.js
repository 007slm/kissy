/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 2 00:02
*/
KISSY.add("event/dom/touch/double-tap",function(g,c,e,b){function a(){}g.extend(a,b,{onTouchStart:function(b){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=b.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(b){var h=this.lastEndTime,a=b.timeStamp,f=b.target,c=b.changedTouches[0],d=a-this.startTime;this.lastEndTime=a;if(h&&(d=a-h,300>d)){this.lastEndTime=0;e.fire(f,"doubleTap",
{touch:c,duration:d/1E3});return}d=a-this.startTime;300<d?e.fire(f,"singleTap",{touch:c,duration:d/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(f,"singleTap",{touch:c,duration:d/1E3})},300)}});c.singleTap=c.doubleTap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(g,c){var e=c.Gesture,b,a,i;g.Features.isTouchSupported()&&(b="touchstart",a="touchmove",i="touchend");b&&(e.start=b,e.move=a,e.end=i,e.tap="tap",e.doubleTap="doubleTap");return e},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(g,c,e,b,a){function i(d){this.doc=d;this.eventHandle={};this.init()}var h=g.guid("touch-handle"),k=g.Features,f={};f[a.start]="onTouchStart";f[a.move]="onTouchMove";f[a.end]="onTouchEnd";f.touchcancel="onTouchEnd";var j=g.throttle(function(d){this.callEventHandle("onTouchMove",d)},30);i.prototype={constructor:i,init:function(){var d=this.doc,a,h;for(a in f)h=f[a],b.on(d,a,this[h],this)},normalize:function(d){var a=d.type,b;if(!k.isTouchSupported()){if(-1!=
a.indexOf("mouse")&&1!=d.which)return;b=[d];a=!a.match(/up$/i);d.touches=a?b:[];d.targetTouches=a?b:[];d.changedTouches=b}return d},onTouchMove:function(d){j.call(this,d)},onTouchStart:function(d){var a,b,h=this.eventHandle;for(a in h)b=h[a].handle,b.isActive=1;this.callEventHandle("onTouchStart",d)},onTouchEnd:function(d){this.callEventHandle("onTouchEnd",d)},callEventHandle:function(d,a){var b=this.eventHandle,h,f;if(a=this.normalize(a)){for(h in b)f=b[h].handle,f.processed||(f.processed=1,f.isActive&&
!1===f[d](a)&&(f.isActive=0));for(h in b)f=b[h].handle,f.processed=0}},addEventHandle:function(d){var a=this.eventHandle,b=e[d].handle;a[d]?a[d].count++:a[d]={count:1,handle:b}},removeEventHandle:function(d){var a=this.eventHandle;a[d]&&(a[d].count--,a[d].count||delete a[d])},destroy:function(){var a=this.doc,h,c;for(h in f)c=f[h],b.detach(a,h,this[c],this)}};return{addDocumentHandle:function(a,b){var f=c.getWindow(a.ownerDocument||a).document,e=c.data(f,h);e||c.data(f,h,e=new i(f));e.addEventHandle(b)},
removeDocumentHandle:function(a,b){var f=c.getWindow(a.ownerDocument||a).document,e=c.data(f,h);e&&(e.removeEventHandle(b),g.isEmptyObject(e.eventHandle)&&(e.destroy(),c.removeData(f,h)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(g,c){function e(){}e.prototype={constructor:e,requiredTouchCount:2,onTouchStart:function(b){var a=this.requiredTouchCount,e=b.touches.length;e===a?this.start():e>a&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:g.noop,getCommonTarget:function(b){var a=b.touches,b=a[0].target,a=a[1].target;if(b==a||c.contains(b,a))return b;for(;;){if(c.contains(a,b))return a;a=a.parentNode}},
end:function(b){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(b)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(g,c,e,b,a){function i(){}g.extend(i,b,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,f,c=b[0],d=b[1];f=c.pageX-d.pageX;c=c.pageY-d.pageY;f=Math.sqrt(f*f+c*c);this.lastTouches=b;this.isStarted?e.fire(this.target,"pinch",g.mix(a,{distance:f,scale:f/this.startDistance})):(this.isStarted=!0,this.startDistance=f,b=this.target=this.getCommonTarget(a),e.fire(b,"pinchStart",g.mix(a,{distance:f,scale:1})))}},fireEnd:function(a){e.fire(this.target,"pinchEnd",
g.mix(a,{touches:this.lastTouches}))}});b=new i;c.pinchStart=c.pinchEnd={handle:b};c.pinch={handle:b,add:function(b){if(!1!==b.preventDefaultMove)e.on(this,a.move,b.__preventPinchDefault=function(a){(!a.touches||2==a.touches.length)&&a.preventDefault()})},remove:function(b){b.__preventPinchDefault&&e.detach(this,a.move,b.__preventPinchDefault)}};return i},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(g,c,e,b,a,i){function h(){}var k=180/Math.PI;g.extend(h,e,{onTouchMove:function(a){if(this.isTracking){var e=a.touches,d=e[0],c=e[1],h=this.lastAngle,d=Math.atan2(c.pageY-d.pageY,c.pageX-d.pageX)*k;if(h!==i){var c=Math.abs(d-h),l=(d+360)%360,m=(d-360)%360;Math.abs(l-h)<c?d=l:Math.abs(m-h)<c&&(d=m)}this.lastTouches=e;this.lastAngle=d;this.isStarted?b.fire(this.target,"rotate",g.mix(a,{angle:d,rotation:d-this.startAngle})):(this.isStarted=!0,this.startAngle=
d,this.target=this.getCommonTarget(a),b.fire(this.target,"rotateStart",g.mix(a,{angle:d,rotation:0})))}},end:function(){this.lastAngle=i;h.superclass.end.apply(this,arguments)},fireEnd:function(a){b.fire(this.target,"rotateEnd",g.mix(a,{touches:this.lastTouches}))}});e=new h;c.rotateEnd=c.rotateStart={handle:e};c.rotate={handle:e,add:function(c){if(!1!==c.preventDefaultMove)b.on(this,a.move,c.__preventRotateDefault=function(a){(!a.touches||2==a.touches.length)&&a.preventDefault()})},remove:function(c){c.__preventRotateDefault&&
b.detach(this,a.move,c.__preventRotateDefault)}};return h},{requires:["./handle-map","./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(g,c,e,b){function a(){}g.extend(a,b,{onTouchStart:function(b){if(!1!==a.superclass.onTouchStart.apply(this,arguments))e.fire(b.target,"singleTouchStart",{touch:b.touches[0],touches:b.touches});else return!1}});c.singleTouchStart={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/single-touch",function(g){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:g.noop,onTouchEnd:g.noop};return c});
KISSY.add("event/dom/touch/swipe",function(g,c,e,b,a){function i(){}g.extend(i,b,{onTouchStart:function(a){if(!1===i.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;
this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,g=b.pageY-this.startY,d=Math.abs(c),i=Math.abs(g);this.isVertical&&50>i&&(this.isVertical=0);this.isHorizontal&&50>d&&(this.isHorizontal=0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=0>g?"up":"down",d=i;else return!1;e.fire(a.target,
"swipe",{touch:b,direction:c,distance:d,duration:(a.timeStamp-this.startTime)/1E3})}});c.swipe={add:function(b){if(!1!==b.preventDefaultMove)e.on(this,a.move,b.__preventSwipeDefault=function(a){(!a.touches||1==a.touches.length)&&a.preventDefault()})},remove:function(b){b.__preventSwipeDefault&&e.detach(this,a.move,b.__preventSwipeDefault)},handle:new i};return i},{requires:["./handle-map","event/dom/base","./single-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(g,c,e,b,a){function i(){}function h(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}g.extend(i,e,{onTouchStart:function(a){if(!1===i.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){b.fire(a.target,"tapHold",{touch:a.touches[0],duration:(g.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold={setup:function(){b.on(this,
a.start,h)},tearDown:function(){b.detach(this,a.start,h)},handle:new i};return i},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/tap",function(g,c,e,b){function a(){}g.extend(a,b,{onTouchMove:function(){return!1},onTouchEnd:function(a){e.fire(a.target,"tap",{touch:a.changedTouches[0]})}});c.tap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(g,c,e,b){function a(a){b.addDocumentHandle(this,a);e[a].setup.apply(this,arguments)}function i(a){b.addDocumentHandle(this,a)}function h(a){b.removeDocumentHandle(this,a);e[a].tearDown.apply(this,arguments)}function k(a){b.removeDocumentHandle(this,a)}var g=c._Special,f,j;for(f in e)c={},j=e[f],c.setup=j.setup?a:i,c.tearDown=j.tearDown?h:k,j.add&&(c.add=j.add),j.remove&&(c.remove=j.remove),g[f]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
