/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 2 11:37
*/
KISSY.add("event/dom/touch/double-tap",function(f,c,d,a){function b(){}f.extend(b,a,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,g=a.timeStamp,c=a.target,k=a.changedTouches[0],e=g-this.startTime;this.lastEndTime=g;if(b&&(e=g-b,300>e)){this.lastEndTime=0;d.fire(c,"doubleTap",
{touch:k,duration:e/1E3});return}e=g-this.startTime;300<e?d.fire(c,"singleTap",{touch:k,duration:e/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(c,"singleTap",{touch:k,duration:e/1E3})},300)}});c.singleTap=c.doubleTap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(f,c){var d=c.Gesture,a,b,h;f.Features.isTouchSupported()&&(a="touchstart",b="touchmove",h="touchend");a&&(d.start=a,d.move=b,d.end=h,d.tap="tap",d.doubleTap="doubleTap");return d},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(f,c,d,a,b){function h(e){this.doc=e;this.eventHandle={};this.init()}var i=f.guid("touch-handle"),g=f.Features,j={};j[b.start]="onTouchStart";j[b.move]="onTouchMove";j[b.end]="onTouchEnd";j.touchcancel="onTouchEnd";var k=f.throttle(function(e){this.callEventHandle("onTouchMove",e)},30);h.prototype={constructor:h,init:function(){var e=this.doc,l,b;for(l in j)b=j[l],a.on(e,l,this[b],this)},normalize:function(e){var a=e.type,b;if(!g.isTouchSupported()){if(-1!=
a.indexOf("mouse")&&1!=e.which)return;b=[e];a=!a.match(/up$/i);e.touches=a?b:[];e.targetTouches=a?b:[];e.changedTouches=b}return e},onTouchMove:function(e){k.call(this,e)},onTouchStart:function(e){var a,b,g=this.eventHandle;for(a in g)b=g[a].handle,b.isActive=1;this.callEventHandle("onTouchStart",e)},onTouchEnd:function(e){this.callEventHandle("onTouchEnd",e)},callEventHandle:function(e,a){var b=this.eventHandle,g,c;if(a=this.normalize(a)){for(g in b)c=b[g].handle,c.processed||(c.processed=1,c.isActive&&
!1===c[e](a)&&(c.isActive=0));for(g in b)c=b[g].handle,c.processed=0}},addEventHandle:function(e){var a=this.eventHandle,b=d[e].handle;a[e]?a[e].count++:a[e]={count:1,handle:b}},removeEventHandle:function(a){var b=this.eventHandle;b[a]&&(b[a].count--,b[a].count||delete b[a])},destroy:function(){var b=this.doc,c,g;for(c in j)g=j[c],a.detach(b,c,this[g],this)}};return{addDocumentHandle:function(a,b){var g=c.getWindow(a.ownerDocument||a).document,d=c.data(g,i);d||c.data(g,i,d=new h(g));d.addEventHandle(b)},
removeDocumentHandle:function(a,b){var g=c.getWindow(a.ownerDocument||a).document,d=c.data(g,i);d&&(d.removeEventHandle(b),f.isEmptyObject(d.eventHandle)&&(d.destroy(),c.removeData(g,i)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(f,c){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,c=a.touches.length;c===b?this.start():c>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a==b||c.contains(a,b))return a;for(;;){if(c.contains(b,a))return b;b=b.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,c,d,a,b){function h(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}f.extend(h,a,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,c,e=b[0],i=b[1];c=e.pageX-i.pageX;e=e.pageY-i.pageY;c=Math.sqrt(c*c+e*e);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",f.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,b=this.target=this.getCommonTarget(a),d.fire(b,"pinchStart",f.mix(a,
{distance:c,scale:1})))}},fireEnd:function(a){d.fire(this.target,"pinchEnd",f.mix(a,{touches:this.lastTouches}))}});a=new h;c.pinchStart=c.pinchEnd={handle:a};c.pinch={handle:a,add:function(){d.on(this,b.move,i)},remove:function(){d.detach(this,b.move,i)}};return h},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(f,c,d,a,b,h){function i(){}function g(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var j=180/Math.PI;f.extend(i,d,{onTouchMove:function(b){if(this.isTracking){var c=b.touches,d=c[0],g=c[1],i=this.lastAngle,d=Math.atan2(g.pageY-d.pageY,g.pageX-d.pageX)*j;if(i!==h){var g=Math.abs(d-i),m=(d+360)%360,n=(d-360)%360;Math.abs(m-i)<g?d=m:Math.abs(n-i)<g&&(d=n)}this.lastTouches=c;this.lastAngle=d;this.isStarted?a.fire(this.target,"rotate",f.mix(b,{angle:d,
rotation:d-this.startAngle})):(this.isStarted=!0,this.startAngle=d,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",f.mix(b,{angle:d,rotation:0})))}},end:function(){this.lastAngle=h;i.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",f.mix(b,{touches:this.lastTouches}))}});d=new i;c.rotateEnd=c.rotateStart={handle:d};c.rotate={handle:d,add:function(){a.on(this,b.move,g)},remove:function(){a.detach(this,b.move,g)}};return i},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(f,c,d,a){function b(){}f.extend(b,a,{onTouchStart:function(a){if(!1!==b.superclass.onTouchStart.apply(this,arguments))d.fire(a.target,"singleTouchStart",{touch:a.touches[0],touches:a.touches});else return!1}});c.singleTouchStart={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/single-touch",function(f){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(c){if(c.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=c.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return c});
KISSY.add("event/dom/touch/swipe",function(f,c,d,a,b){function h(){}f.extend(h,a,{onTouchStart:function(a){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;
this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,f=b.pageY-this.startY,e=Math.abs(c),h=Math.abs(f);this.isVertical&&50>h&&(this.isVertical=0);this.isHorizontal&&50>e&&(this.isHorizontal=0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=0>f?"up":"down",e=h;else return!1;d.fire(a.target,
"swipe",{touch:b,direction:c,distance:e,duration:(a.timeStamp-this.startTime)/1E3})}});c.swipe={add:function(a){if(!0===a.preventDefaultMove)d.on(this,b.move,a.__preventSwipeDefault=function(a){(!a.touches||1==a.touches.length)&&a.preventDefault()})},remove:function(a){a.__preventSwipeDefault&&d.detach(this,b.move,a.__preventSwipeDefault)},handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(f,c,d,a,b){function h(){}function i(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}f.extend(h,d,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){a.fire(b.target,"tapHold",{touch:b.touches[0],duration:(f.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold={setup:function(){a.on(this,
b.start,i)},tearDown:function(){a.detach(this,b.start,i)},handle:new h};return h},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/tap",function(f,c,d,a){function b(){}f.extend(b,a,{onTouchMove:function(){return!1},onTouchEnd:function(a){d.fire(a.target,"tap",{touch:a.changedTouches[0]})}});c.tap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(f,c,d,a){function b(b){a.addDocumentHandle(this,b);d[b].setup.apply(this,arguments)}function h(b){a.addDocumentHandle(this,b)}function i(b){a.removeDocumentHandle(this,b);d[b].tearDown.apply(this,arguments)}function g(b){a.removeDocumentHandle(this,b)}var f=c._Special,j,k;for(j in d)c={},k=d[j],c.setup=k.setup?b:h,c.tearDown=k.tearDown?i:g,k.add&&(c.add=k.add),k.remove&&(c.remove=k.remove),f[j]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
