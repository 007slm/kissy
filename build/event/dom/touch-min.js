/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jan 11 03:06
*/
KISSY.add("event/dom/touch/double-tap",function(f,b,e,c){function a(){}f.extend(a,c,{onTouchStart:function(d){if(!1===a.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=d.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var c=this.lastEndTime,b=a.timeStamp,f=a.target,l=a.changedTouches[0],h=b-this.startTime;this.lastEndTime=b;if(c&&(h=b-c,300>h)){this.lastEndTime=0;e.fire(f,"doubleTap",
{touch:l,duration:h/1E3});return}h=b-this.startTime;300<h?e.fire(f,"singleTap",{touch:l,duration:h/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(f,"singleTap",{touch:l,duration:h/1E3})},300)}});b.singleTap=b.doubleTap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/gesture",function(f,b){var e=b.Gesture,c,a,d;f.Features.isTouchSupported()&&(c="touchstart",a="touchmove",d="touchend");c&&(e.start=c,e.move=a,e.end=d,e.tap="tap",e.doubleTap="doubleTap");return e},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(f,b,e,c,a){function d(a){this.doc=a;this.eventHandle={};this.init()}var k=f.guid("touch-handle"),i=f.Features,g={};g[a.start]="onTouchStart";g[a.move]="onTouchMove";g[a.end]="onTouchEnd";"mousedown"!==a.start&&(g.touchcancel="onTouchEnd");d.prototype={init:function(){var a=this.doc,h,b;if(!i.isTouchSupported())this.onTouchMove=f.throttle(this.onTouchMove,30);for(h in g){b=g[h];c.on(a,h,this[b],this)}},normalize:function(a){var b=a.type,c;if(!i.isTouchSupported()){if(b.indexOf("mouse")!=
-1&&a.which!=1)return;c=[a];b=!b.match(/up$/i);a.touches=b?c:[];a.targetTouches=b?c:[];a.changedTouches=c}return a},onTouchStart:function(a){var b,c,e=this.eventHandle;for(b in e){c=e[b];c.isActive=1}this.callEventHandle("onTouchStart",a)},onTouchMove:function(a){this.callEventHandle("onTouchMove",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a)},callEventHandle:function(a,b){var c=this.eventHandle,e,d;if(b=this.normalize(b)){for(e in c){d=c[e];if(!d.processed){d.processed=1;if(d.isActive&&
d[a](b)===false)d.isActive=0}}for(e in c){d=c[e];d.processed=0}}},addEventHandle:function(a){var b=e[a].handle;this.eventHandle[a]||(this.eventHandle[a]=b)},removeEventHandle:function(a){delete this.eventHandle[a]},destroy:function(){var a=this.doc,b,d;for(b in g){d=g[b];c.detach(a,b,this[d],this)}}};return{addDocumentHandle:function(a,c){var f=b.getWindow(a.ownerDocument||a).document,i=e[c].setup,g=b.data(f,k);g||b.data(f,k,g=new d(f));i&&i.call(a,c);g.addEventHandle(c)},removeDocumentHandle:function(a,
c){var d=b.getWindow(a.ownerDocument||a).document,i=e[c].tearDown,g=b.data(d,k);i&&i.call(a,c);if(g){g.removeEventHandle(c);if(f.isEmptyObject(g.eventHandle)){g.destroy();b.removeData(d,k)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch/multi-touch",function(f,b){function e(){}e.prototype={requiredTouchCount:2,onTouchStart:function(b){var a=this.requiredTouchCount,d=b.touches.length;d===a?this.start():d>a&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(c){var a=c.touches,c=a[0].target,a=a[1].target;if(c==a||b.contains(c,a))return c;for(;;){if(b.contains(a,c))return a;a=a.parentNode}},end:function(b){this.isTracking&&
(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(b)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,b,e,c){function a(){}f.extend(a,c,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,c,g=b[0],l=b[1];c=g.pageX-l.pageX;g=g.pageY-l.pageY;c=Math.sqrt(c*c+g*g);this.lastTouches=b;this.isStarted?e.fire(this.target,"pinch",f.mix(a,{distance:c,scale:c/this.startDistance})):(this.isStarted=!0,this.startDistance=c,b=this.target=this.getCommonTarget(a),e.fire(b,"pinchStart",f.mix(a,{distance:c,scale:1})))}},fireEnd:function(a){e.fire(this.target,"pinchEnd",
f.mix(a,{touches:this.lastTouches}))}});b.pinch=b.pinchEnd=b.pinchEnd={handle:new a};return a},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/rotate",function(f,b,e,c,a){function d(){}var k=180/Math.PI;f.extend(d,e,{onTouchMove:function(b){if(this.isTracking){var e=b.touches,d=e[0],h=e[1],j=this.lastAngle,d=Math.atan2(h.pageY-d.pageY,h.pageX-d.pageX)*k;if(j!==a){var h=Math.abs(d-j),m=(d+360)%360,n=(d-360)%360;Math.abs(m-j)<h?d=m:Math.abs(n-j)<h&&(d=n)}this.lastTouches=e;this.lastAngle=d;this.isStarted?c.fire(this.target,"rotate",f.mix(b,{angle:d,rotation:d-this.startAngle})):(this.isStarted=!0,this.startAngle=
d,this.target=this.getCommonTarget(b),c.fire(this.target,"rotateStart",f.mix(b,{angle:d,rotation:0})))}},end:function(){this.lastAngle=a;d.superclass.end.apply(this,arguments)},fireEnd:function(a){c.fire(this.target,"rotateEnd",f.mix(a,{touches:this.lastTouches}))}});b.rotate=b.rotateEnd=b.rotateStart={handle:new d};return d},{requires:["./handle-map","./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(f){function b(){}b.prototype={requiredTouchCount:1,onTouchStart:function(b){if(b.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=b.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return b});
KISSY.add("event/dom/touch/swipe",function(f,b,e,c,a){function d(){}f.extend(d,c,{onTouchStart:function(a){if(!1===d.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],c=b.pageY,b=Math.abs(b.pageX-this.startX),c=Math.abs(c-this.startY);if(1E3<a.timeStamp-this.startTime)return!1;
this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<c&&(this.isHorizontal=0);if(!this.isHorizontal&&!this.isVertical)return!1},onTouchEnd:function(a){if(!1===this.onTouchMove(a))return!1;var b=a.changedTouches[0],c=b.pageX-this.startX,d=b.pageY-this.startY,f=Math.abs(c),j=Math.abs(d);this.isVertical&&50>j&&(this.isVertical=0);this.isHorizontal&&50>f&&(this.isHorizontal=0);if(this.isHorizontal)c=0>c?"left":"right";else if(this.isVertical)c=0>d?"up":"down",f=j;else return!1;e.fire(a.target,
"swipe",{touch:b,direction:c,distance:f,duration:(a.timeStamp-this.startTime)/1E3})}});b.swipe={setup:function(){a.preventDefaultMove(this)},tearDown:function(){a.allowDefaultMove(this)},handle:new d};return d},{requires:["./handle-map","event/dom/base","./single-touch","./utils"]});
KISSY.add("event/dom/touch/tap-hold",function(f,b,e,c,a){function d(){}f.extend(d,e,{onTouchStart:function(a){if(!1===d.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){c.fire(a.target,"tapHold",{touch:a.touches[0],duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});b.tapHold={setup:function(){a.preventDefaultStart(this)},tearDown:function(){a.allowDefaultStart(this)},
handle:new d};return d},{requires:["./handle-map","./single-touch","event/dom/base","./utils"]});KISSY.add("event/dom/touch/tap",function(f,b,e,c){function a(){}f.extend(a,c,{onTouchMove:function(){return!1},onTouchEnd:function(a){e.fire(a.target,"tap",{touch:a.changedTouches[0]})}});b.tap={handle:new a};return a},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch",function(f,b,e,c){var f=b._Special,b={setup:function(a){c.addDocumentHandle(this,a)},tearDown:function(a){c.removeDocumentHandle(this,a)}},a;for(a in e)f[a]=b},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
KISSY.add("event/dom/touch/utils",function(f,b,e){function c(a){a.preventDefault()}return{preventDefaultMove:function(a){b.on(a,e.move,c)},allowDefaultMove:function(a){b.detach(a,e.move,c)},preventDefaultStart:function(a){b.on(a,e.start,c)},allowDefaultStart:function(a){b.detach(a,e.start,c)}}},{requires:["event/dom/base","./gesture"]});
