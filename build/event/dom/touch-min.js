/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 8 21:37
*/
KISSY.add("event/dom/touch/base-touch",function(e){function a(){this.requiredTouchCount=1}a.prototype={onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1},onTouchMove:function(a){if(a.touches.length!=this.requiredTouchCount)return!1},onTouchEnd:e.noop};return a});
KISSY.add("event/dom/touch/double-tap",function(e,a,h,i){function f(){this.requiredTouchCount=1}e.extend(f,i,{onTouchStart:function(a){if(!1===f.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var f=this.lastEndTime,e=a.timeStamp,d=a.target,b=a.changedTouches[0],c=e-this.startTime;this.lastEndTime=e;if(f&&(c=e-f,300>c)){this.lastEndTime=
0;h.fire(d,"doubleTap",{touch:b,duration:c});return}c=e-this.startTime;300<c?h.fire(d,"singleTap",{touch:b,duration:c}):this.singleTapTimer=setTimeout(function(){h.fire(d,"singleTap",{touch:b,duration:c})},300)}});return a.singleTap=a.doubleTap=f},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch/gesture",function(e,a){var h=a.Gesture,i=e.Features,f,k,j;i.isTouchSupported?(f="touchstart",k="touchmove",j="touchend"):i.isMsPointerEnabled&&(f="MSPointerDown",k="MSPointerMove",j="MSPointerUp");f&&(h.start=f,h.move=k,h.end=j,h.tap="tap");return h},{requires:["event/dom/base"]});KISSY.add("event/dom/touch/handle-map",function(){return{}});
KISSY.add("event/dom/touch/handle",function(e,a,h,i,f){function k(b){this.doc=b;this.eventHandle={};this.init()}var j=e.guid("touch-handle"),l=e.Features,d={};d[f.start]="onTouchStart";d[f.move]="onTouchMove";d[f.end]="onTouchEnd";"mousedown"!==f.start&&(d.touchcancel="onTouchEnd");k.prototype={init:function(){var b=this.doc,c,g;this.onTouchMove=e.throttle(this.onTouchMove,30);for(c in d){g=d[c];i.on(b,c,this[g],this)}},normalize:function(b){var c=b.type,g;if(!l.isTouchSupported){if(c.indexOf("mouse")!=
-1&&b.which!=1)return;g=[b];c=!c.match(/up$/i);b.touches=c?g:[];b.targetTouches=c?g:[];b.changedTouches=g}return b},onTouchStart:function(b){var c,g;for(c in this.eventHandle){g=this.eventHandle[c];g.isActive=true}this.callEventHandle("onTouchStart",b)},onTouchMove:function(b){this.callEventHandle("onTouchMove",b)},onTouchEnd:function(b){this.callEventHandle("onTouchEnd",b)},callEventHandle:function(b,c){var g,a;if(c=this.normalize(c))for(g in this.eventHandle){a=this.eventHandle[g];if(a.isActive&&
a[b](c)===false)a.isActive=false}},addEventHandle:function(b){var c=h[b];if(!this.eventHandle[b]&&!c.used){this.eventHandle[b]=new c;c.used=1}},removeEventHandle:function(b){delete this.eventHandle[b]},destroy:function(){var b=this.doc,c,a;for(c in d){a=d[c];i.detach(b,c,this[a],this)}}};return{addDocumentHandle:function(b,c){var g=a._getWin(b.ownerDocument||b).document,d=a.data(g,j);d||a.data(g,j,d=new k(g));d.addEventHandle(c)},removeDocumentHandle:function(b,c){var g=a._getWin(b.ownerDocument||
b).document,d=a.data(g,j);if(d){d.removeEventHandle(c);if(e.isEmptyObject(eventHandle)){d.destroy();a.removeData(g,j)}}}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch".split(",")});
KISSY.add("event/dom/touch/pinch",function(e,a,h,i,f){function k(a,d){var b=a.pageX-d.pageX,c=a.pageY-d.pageY;return Math.sqrt(b*b+c*c)}function j(){this.requiredTouchCount=2;this.event=event}e.extend(j,i,{onTouchStart:function(a){if(!1===j.superclass.onTouchStart.apply(this,arguments))return!1;var d=a.touches,b=k(d[0],d[1]);this.startDistance=b;var c;a:{var g=d[0].target,e=d[1].target;if(g==e||f.contains(g,e))c=g;else for(;;){if(f.contains(e,g)){c=e;break a}e=e.parentNode}}c=this.target=c;h.fire(c,
"pinchStart",{touches:d,distance:b,scale:1})},onTouchMove:function(a){var d=j.superclass.onTouchMove.apply(this,arguments);if(!1===d)return!1;if(!0!==d){var d=a.touches,b=k(d[0],d[1]);h.fire(this.target,"pinch",{touches:d,distance:b,scale:b/this.startDistance});this.lastTouches=d}},onTouchEnd:function(){h.fire(this.target,"pinchEnd",{touches:this.lastTouches})}});return a.pinch=a.pinchEnd=a.pinchEnd=j},{requires:["./handle-map","event/dom/base","./base-touch","dom"]});
KISSY.add("event/dom/touch/swipe",function(e,a,h,i){function f(){this.requiredTouchCount=1;this.event=j}function k(b,c,a){var e=a[0],a=e.pageY,e=Math.abs(e.pageX-b.startX),a=Math.abs(a-b.startY);if(c.timeStamp-b.startTime>l)return!1;b.isVertical&&e>d&&(b.isVertical=0);b.isHorizontal&&a>d&&(b.isHorizontal=0);if(!b.isHorizontal&&!b.isVertical)return!1}var j="swipe",l=1E3,d=35;e.extend(f,i,{onTouchStart:function(b){if(!1===f.superclass.onTouchStart.apply(this,arguments))return!1;var a=b.touches[0];this.startTime=
b.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=a.pageX;this.startY=a.pageY;-1!=b.type.indexOf("mouse")&&b.preventDefault()},onTouchMove:function(b){if(!0!==f.superclass.onTouchMove.apply(this,arguments)&&!1==k(this,b,b.touches))return!1},onTouchEnd:function(b){if(!1==k(this,b,b.changedTouches))return!1;var a=b.changedTouches[0],d=a.pageX-this.startX,e=a.pageY-this.startY,f=Math.abs(d),i=Math.abs(e);this.isVertical&&50>i&&(this.isVertical=0);this.isHorizontal&&50>f&&(this.isHorizontal=
0);if(this.isHorizontal)d=0>d?"left":"right";else if(this.isVertical)d=0>e?"up":"down",f=i;else return!1;h.fire(b.target,this.event,{touch:a,direction:d,distance:f,duration:b.timeStamp-this.startTime})}});return a[j]=f},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch/tap",function(e,a,h,i){function f(){this.requiredTouchCount=1}e.extend(f,i,{onTouchMove:function(){return!1},onTouchEnd:function(a){h.fire(a.target,"tap",{touch:a.changedTouches[0]})}});return a.tap=f},{requires:["./handle-map","event/dom/base","./base-touch"]});
KISSY.add("event/dom/touch",function(e,a,h,i){var e=a._Special,a={setup:function(a){i.addDocumentHandle(this,a)},tearDown:function(a){i.removeDocumentHandle(this,a)}},f;for(f in h)e[f]=a},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
