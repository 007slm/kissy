/*
Copyright 2011, KISSY UI Library v1.1.8dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event",function(e,l){function i(a,b,d,j,g){if(e.isString(b))b=e.query(b);if(e.isArray(b)){e.each(b,function(k){m[a](k,d,j,g)});return true}if((d=e.trim(d))&&d.indexOf(z)>0){e.each(d.split(z),function(k){m[a](b,k,j,g)});return true}}function f(a){return h(a)?p.data(a,y):-1}function n(a,b){h(a)&&p.data(a,y,b)}function c(a){p.removeData(a,y)}function h(a){return a&&a.nodeType!==3&&a.nodeType!==8}var t=document,p=e.DOM,A=t.addEventListener?function(a,b,d,j){a.addEventListener&&a.addEventListener(b,
d,!!j)}:function(a,b,d){a.attachEvent&&a.attachEvent("on"+b,d)},B=t.removeEventListener?function(a,b,d,j){a.removeEventListener&&a.removeEventListener(b,d,!!j)}:function(a,b,d){a.detachEvent&&a.detachEvent("on"+b,d)},y="ksEventTargetId",z=" ",C=e.now(),x={},m={EVENT_GUID:y,special:{},add:function(a,b,d,j){if(!i("add",a,b,d,j)){var g=f(a),k,q,r,u,s;if(!(g===-1||!b||!e.isFunction(d))){if(!g){n(a,g=C++);x[g]={target:a,events:{}}}q=x[g].events;if(!q[b]){k=((g=!a.isCustomEventTarget)||a._supportSpecialEvent)&&
m.special[b]||{};r=function(o,v){if(!o||!o.fixed)o=new e.EventObject(a,o,b);if(e.isPlainObject(v)){var w=o.type;e.mix(o,v);o.type=w}k.setup&&k.setup(o);return(k.handle||m._handle)(a,o)};q[b]={handle:r,listeners:[]};u=k.fix||b;s=k.capture;k.init&&k.init.apply(null,e.makeArray(arguments));g&&k.fix!==false&&A(a,u,r,s)}q[b].listeners.push({fn:d,scope:j||a})}}},__getListeners:function(a,b){var d=[];if(a=(m.__getEvents(a)||{})[b])d=a.listeners;return d},__getEvents:function(a){var b=f(a),d;if(b!==-1)if(b&&
(d=x[b]))if(d.target===a)return d.events||{}},remove:function(a,b,d,j){if(!i("remove",a,b,d,j)){var g=m.__getEvents(a),k=f(a),q,r,u,s,o,v,w=(!a.isCustomEventTarget||a._supportSpecialEvent)&&m.special[b]||{};if(g!==undefined){j=j||a;if(q=g[b]){r=q.listeners;u=r.length;if(e.isFunction(d)&&u){o=s=0;for(v=[];s<u;++s)if(d!==r[s].fn||j!==r[s].scope)v[o++]=r[s];q.listeners=v;u=v.length}if(d===l||u===0){if(!a.isCustomEventTarget){w=m.special[b]||{};if(w.fix!==false)B(a,w.fix||b,q.handle)}delete g[b]}}w.destroy&&
w.destroy.apply(null,e.makeArray(arguments));if(b===l||e.isEmptyObject(g)){for(b in g)m.remove(a,b);delete x[k];c(a)}}}},_handle:function(a,b){a=m.__getListeners(a,b.type);a=a.slice(0);for(var d,j,g=0,k=a.length;g<k;++g){d=a[g];d=d.fn.call(d.scope,b);if(j!==false)j=d;if(d!==undefined){b.result=d;d===false&&b.halt()}if(b.isImmediatePropagationStopped)break}return j},_getCache:function(a){return x[a]},__getID:f,_simpleAdd:A,_simpleRemove:B};m.on=m.add;e.Event=m});
KISSY.add("event-object",function(e,l){function i(c,h,t){this.currentTarget=c;this.originalEvent=h||{};if(h){this.type=h.type;this._fix()}else{this.type=t;this.target=c}this.currentTarget=c;this.fixed=true}var f=document,n="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
e.augment(i,{_fix:function(){var c=this.originalEvent,h=n.length,t,p=this.currentTarget;for(p=p.nodeType===9?p:p.ownerDocument||f;h;){t=n[--h];this[t]=c[t]}if(!this.target)this.target=this.srcElement||f;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===l&&this.clientX!==l){c=p.documentElement;h=p.body;this.pageX=this.clientX+(c&&c.scrollLeft||h&&h.scrollLeft||
0)-(c&&c.clientLeft||h&&h.clientLeft||0);this.pageY=this.clientY+(c&&c.scrollTop||h&&h.scrollTop||0)-(c&&c.clientTop||h&&h.clientTop||0)}if(this.which===l)this.which=this.charCode!==l?this.charCode:this.keyCode;if(this.metaKey===l)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==l)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var c=this.originalEvent;if(c.preventDefault)c.preventDefault();else c.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var c=
this.originalEvent;if(c.stopPropagation)c.stopPropagation();else c.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var c=this.originalEvent;c.stopImmediatePropagation?c.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(c){c?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});e.EventObject=i});
KISSY.add("event-target",function(e,l){var i=e.Event;e.EventTarget={isCustomEventTarget:true,fire:function(f,n){var c=e.DOM.data(this,i.EVENT_GUID)||-1;if((f=((i._getCache(c)||{}).events||{})[f])&&e.isFunction(f.handle))return f.handle(l,n)},on:function(f,n,c){i.add(this,f,n,c);return this},detach:function(f,n,c){i.remove(this,f,n,c);return this}}});
KISSY.add("event-mouseenter",function(e){var l=e.Event;e.UA.ie||e.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(i){l.special[i.name]={fix:i.fix,setup:function(f){f.type=i.name},handle:function(f,n){if(e.DOM._isKSNode(f))f=f[0];var c=n.relatedTarget;try{for(;c&&c!==f;)c=c.parentNode;c!==f&&l._handle(f,n)}catch(h){}}}})});
KISSY.add("event-focusin",function(e){var l=e.Event;document.addEventListener&&e.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(i){l.special[i.name]={fix:i.fix,capture:true,setup:function(f){f.type=i.name}}})});
