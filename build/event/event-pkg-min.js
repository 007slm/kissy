/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event/base",function(p,c,l,i){function m(f,d,a,e,b){if((a=p.trim(a))&&a.indexOf(y)>0){p.each(a.split(y),function(j){o[f](d,j,e,b)});return true}return i}function g(f){return f&&f.nodeType!==3&&f.nodeType!==8}var k=document,n=k.addEventListener?function(f,d,a,e){f.addEventListener&&f.addEventListener(d,a,!!e)}:function(f,d,a){f.attachEvent&&f.attachEvent("on"+d,a)},t=k.removeEventListener?function(f,d,a,e){f.removeEventListener&&f.removeEventListener(d,a,!!e)}:function(f,d,a){f.detachEvent&&
f.detachEvent("on"+d,a)},y=" ",u="ksEventTargetId"+p.now(),o={EVENT_GUID:u,special:{},add:function(f,d,a,e){if(!m("add",f,d,a,e)){c.query(f).each(function(b){var j=!b.isCustomEventTarget,h,q,r;if(!(!b||!d||!p.isFunction(a)||!j&&!g(b))){(h=c.data(b,u))||c.data(b,u,h={});q=h.events=h.events||{};r=h.handler;if(!r){r=h.handler=function(v,w){var x=r.target;if(!v||!v.fixed)v=new l(x,v);p.isPlainObject(w)&&p.mix(v,w);return o._handle(x,v)};r.target=b}var s=q[d];h=o.special[d]||{};if(!s){s=q[d]=[];if((!h.setup||
h.setup.call(b)===false)&&j)n(b,d,r)}s.push({fn:a,scope:e||b});b=null}});a=e=f=null}},__getListeners:function(f,d){return(o.__getEvents(f)||{})[d]||[]},__getEvents:function(f){return(f=c.data(f,u))&&f.events},remove:function(f,d,a,e){m("remove",f,d,a,e)||c.query(f).each(function(b){var j=c.data(b,u),h=j&&j.events,q,r,s,v,w,x=!b.isCustomEventTarget,z=x&&o.special[d]||{};if(!(!b||!x&&!g(b)||h===i))if(d===i)for(d in h)o.remove(b,d,i,i);else{e=e||b;if(q=h[d]){r=q.length;if(p.isFunction(a)&&r){v=s=0;for(w=
[];s<r;++s)if(a!==q[s].fn||e!==q[s].scope)w[v++]=q[s];h[d]=w;r=w.length}if(a===i||r===0){if(x)if(!z.tearDown||z.tearDown.call(b)===false)t(b,d,j.handler);delete h[d]}}if(p.isEmptyObject(h))if(j){j.handler.target=null;delete j.handler;delete j.events;c.removeData(b,u)}}})},_handle:function(f,d){for(var a=o.__getListeners(f,d.type).slice(0),e,b,j=0,h=a.length;j<h;++j){e=a[j];e=e.fn.call(e.scope,d);if(b!==false)b=e;e!==i&&e===false&&d.halt();if(d.isImmediatePropagationStopped)break}return b},fire:function(f,
d,a){var e;c.query(f).each(function(b){var j=!b.isCustomEventTarget;a=a||{};a.type=d;if(j){if(g(b)){j=new l(b,a);var h=j.target=b,q="on"+d;do{var r=(c.data(h,u)||{}).handler;j.currentTarget=h;r&&r.call(h,j);if(h[q]&&h[q].call(h)===false){e=false;j.preventDefault()}h=h.parentNode||h.ownerDocument||h===b.ownerDocument&&window}while(h&&!j.isPropagationStopped);if(!j.isDefaultPrevented)if(!(d!=="click"&&b.nodeName.toLowerCase()=="a")){var s;try{if(q&&b[d]){if(s=b[q])b[q]=null;b[d]()}}catch(v){}if(s)b[q]=
s}}}else if((b=c.data(this,o.EVENT_GUID))&&p.isFunction(b.handler))e=b.handler(i,a)});return e},_simpleAdd:n,_simpleRemove:t};o.on=o.add;o.detach=o.remove;return o},{requires:["dom","event/object"]});
KISSY.add("event/focusin",function(p,c){document.addEventListener&&p.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(l){function i(g){c.fire(g.target,l.name)}var m=0;c.special[l.name]={setup:function(){m++===0&&document.addEventListener(l.fix,i,true)},tearDown:function(){--m===0&&document.removeEventListener(l.fix,i,true)}}});return c},{requires:["./base","./object"]});
KISSY.add("event/mouseenter",function(p,c,l,i){i.ie||p.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(m){function g(k){var n=k.relatedTarget;k.type=m.name;try{if(!(n&&n!==document&&!n.parentNode)){for(;n&&n!==this;)n=n.parentNode;n!==this&&c._handle(this,k)}}catch(t){}}c.special[m.name]={setup:function(){c.add(this,m.fix,g)},tearDown:function(){c.remove(this,m.fix,g)}}});return c},{requires:["./base","dom","ua"]});
KISSY.add("event/object",function(p,c){function l(g,k,n){this.currentTarget=g;this.originalEvent=k||{};if(k){this.type=k.type;this._fix()}else{this.type=n;this.target=g}this.currentTarget=g;this.fixed=true}var i=document,m="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
p.augment(l,{_fix:function(){var g=this.originalEvent,k=m.length,n,t=this.currentTarget;for(t=t.nodeType===9?t:t.ownerDocument||i;k;){n=m[--k];this[n]=g[n]}if(!this.target)this.target=this.srcElement||i;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===c&&this.clientX!==c){g=t.documentElement;k=t.body;this.pageX=this.clientX+(g&&g.scrollLeft||k&&k.scrollLeft||
0)-(g&&g.clientLeft||k&&k.clientLeft||0);this.pageY=this.clientY+(g&&g.scrollTop||k&&k.scrollTop||0)-(g&&g.clientTop||k&&k.clientTop||0)}if(this.which===c)this.which=this.charCode!==c?this.charCode:this.keyCode;if(this.metaKey===c)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==c)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var g=this.originalEvent;if(g.preventDefault)g.preventDefault();else g.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var g=
this.originalEvent;if(g.stopPropagation)g.stopPropagation();else g.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var g=this.originalEvent;g.stopImmediatePropagation?g.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(g){g?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});return l});
KISSY.add("event/target",function(p,c){return{isCustomEventTarget:true,fire:function(l,i){return c.fire(this,l,i)},on:function(l,i,m){c.add(this,l,i,m);return this},detach:function(l,i,m){c.remove(this,l,i,m);return this}}},{requires:["event/base","dom"]});
KISSY.add("event/valuechange",function(p,c,l){function i(a){var e=l.data(a,u);if(!e){e=+new Date;l.data(a,u,e)}return e}function m(a){a=i(a);delete o[a];if(f[a]){clearTimeout(f[a]);delete f[a]}}function g(a){m(a.target)}function k(a){var e=i(a);f[e]||(f[e]=setTimeout(function(){var b=a.value;if(b!==o[e]){c._handle(a,{type:y,prevVal:o[e],newVal:b});o[e]=b}f[e]=setTimeout(arguments.callee,d)},d))}function n(a){var e=a.target;if(a.type=="focus"){a=i(e);o[a]=e.value}k(e)}function t(a){m(a);c.remove(a,
"blur",g);c.remove(a,"mousedown keyup keydown focus",n);l.removeData(a,u)}var y="valueChange",u="event/valuechange",o={},f={},d=50;c.special[y]={fix:false,setup:function(){var a=this.nodeName.toLowerCase();if("input"==a||"textarea"==a){t(this);c.on(this,"blur",g);c.on(this,"mousedown keyup keydown focus",n)}},tearDown:function(a){a=this;t(a)}};return c},{requires:["./base","dom"]});
KISSY.add("event",function(p,c,l){c.Target=l;return c},{requires:["event/base","event/target","event/object","event/focusin","event/mouseenter"]});
