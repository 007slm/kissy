/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 13 14:40
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(g,i,j){i=j.Controller.extend({initializer:function(){this.__commands={};this.__controls={}},use:function(e,f){var b=this,d=b.__CORE_PLUGINS||["htmlDataProcessor","enterKey","clipboard","selection"];g.isString(e)&&(e=e.split(","));for(var c=e.length-1;0<=c;c--)e[c]||e.splice(c,1);for(c=0;c<d.length;c++){var a=d[c];g.inArray(a,e)||e.unshift(a)}g.each(e,function(d,a){e[a]&&(e[a]="editor/plugin/"+d+"/")});g.use(e,function(){var d=g.makeArray(arguments);d.shift();
for(var a=0;a<d.length;a++)d[a]&&d[a].init(b);f&&f.call(b);b.adjustHeight()});b.__CORE_PLUGINS=[];return b}},{Config:{},XHTML_DTD:i.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},iframeWrapEl:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(e){return this._setData(e)}},formatData:{getter:function(){return this._getData(1)},setter:function(e){return this._setData(e)}},customStyle:{value:""},
customLink:{value:[]}}},{xclass:"editor"});i.HTML_PARSER={textarea:function(e){return e.one(this.get("prefixCls")+".editor-textarea")}};g.mix(i,g.EventTarget);return KISSY.Editor=i},{requires:["htmlparser","component","core"]});
KISSY.add("editor/plugin/clipboard/index",function(g){function i(h){this.editor=h;this._init()}function j(h){if(b.ie&&"BackCompat"!=h.get("document")[0].compatMode){var d=h.getSelection(),a;if(d.getType()==p.SELECTION_ELEMENT&&(a=d.getSelectedElement())){var k=d.getRanges()[0],c=f(h.get("document")[0].createTextNode(""));c.insertBefore(a);k.setStartBefore(c);k.setEndAfter(a);d.selectRanges([k]);setTimeout(function(){a.parent()&&(c.remove(),d.selectElement(a))},0)}}}var e=g.Editor,f=g.all,b=g.UA,d=
e.Range,c=e.RANGE,a=g.Event;g.augment(i,{_init:function(){var h=this.editor;a.on(h.get("document")[0].body,b.webkit?"paste":b.gecko?"paste":"beforepaste",this._paste,this);a.on(h.get("document")[0].body,"contextmenu",function(){k=1;setTimeout(function(){k=0},10)});h.addCommand("copy",new o("copy"));h.addCommand("cut",new o("cut"));h.addCommand("paste",new o("paste"))},_paste:function(){if(!k){var h=this.editor,a=h.get("document")[0];if(!a.getElementById("ke_pastebin")){var x=h.getSelection(),s=new d(a),
q=f(b.webkit?"<body></body>":"<div></div>",null,a);q.attr("id","ke_pastebin");b.webkit&&q[0].appendChild(a.createTextNode("\u00a0"));a.body.appendChild(q[0]);q.css({position:"absolute",top:x.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});q.css("left","-1000px");var e=x.createBookmarks();s.setStartAt(q,c.POSITION_AFTER_START);s.setEndAt(q,c.POSITION_BEFORE_END);s.select(!0);setTimeout(function(){q.remove();var a;q=b.webkit&&(a=q.first())&&a.hasClass("Apple-style-span")?
a:q;x.selectBookmarks(e);a=q.html();if(a=g.trim(a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var d=h.fire("paste",{html:a,holder:q});void 0!==d&&(a=d);d=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(a)&&(d=h.htmlDataProcessor.wordFilter);h.insertHtml(a,d)}},0)}}}});var l=function(h,a){var d=h.get("document")[0],k=f(d.body),c=!1,e=function(){c=!0};k.on(a,e);(7<b.ie?d:d.selection.createRange()).execCommand(a);k.detach(a,e);return c},m=b.ie?function(h,a){return l(h,
a)}:function(h,a){try{return h.get("document")[0].execCommand(a)}catch(d){return!1}},n={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},o=function(h){this.type=h};o.prototype={exec:function(h){"cut"==this.type&&j(h);(h=m(h,this.type))||alert(n[this.type]);return h}};var p=e.Selection,h={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},k;e.on("contextmenu",function(a){a=a.contextmenu;if(!a.__copy_fix){a.__copy_fix=
1;var d=a.get("editor"),k={copy:1,cut:1,paste:1},c;for(c in k)k.hasOwnProperty(c)&&a.addChild({xclass:"menuitem",content:h[c],value:c});a.on("click",function(h){var a=h.target.get("value");k[a]&&(this.hide(),setTimeout(function(){d.execCommand(a)},30))})}});return{init:function(h){h.docReady(function(){new i(h)})}}},{requires:["editor"]});
KISSY.add("editor/core/dom",function(g,i,j){function e(h,k){var c=h[k?"next":"prev"](f,1);if(c&&c[0].nodeType==d.ELEMENT_NODE){for(var b=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemovable(f);)if(b.push(c),c=k?c.next(f,1):c.prev(f,1),!c)return;if(h._4e_isIdentical(c,f)){for(var e=new a(k?h[0].lastChild:h[0].firstChild);b.length;)b.shift()._4e_move(h,!k,f);c._4e_moveChildren(h,!k,f);c.remove();e[0]&&e[0].nodeType==d.ELEMENT_NODE&&e._4e_mergeSiblings()}}}var f=f,b=i.XHTML_DTD,d=g.DOM,c=g.UA,a=g.Node,
l={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};i.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var m=i.POSITION,n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},o={hr:1},p=function(h){return h&&(h[0]||h)};j.injectDom({_4e_sameLevel:function(h,a){var a=p(a),d=h.parentNode;return d&&d==a.parentNode},_4e_isBlockBoundary:function(h,a){var c=g.merge(o,a);return!(!n[d.css(h,"display")]&&!c[d.nodeName(h)])},_4e_index:function(h,a){for(var d=h.parentNode.childNodes,c,b=-1,s=0;s<d.length;s++)if(c=d[s],!a||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(b++,c===h)return b;return-1},_4e_move:function(h,a,d){a=
p(a);d?a.insertBefore(h,a.firstChild):a.appendChild(h)},_4e_isIdentical:function(h,a){if(!a)return!1;a=p(a);if(d.nodeName(h)!=d.nodeName(a))return!1;var c=h.attributes,b=a.attributes,e=c.length,s=b.length;if(e!=s)return!1;for(var q=0;q<e;q++){var f=c[q],g=f.name;if(f.specified&&d.attr(h,g)!=d.attr(a,g))return!1}if(8>j.ieEngine)for(q=0;q<s;q++)if(f=b[q],g=f.name,f.specified&&d.attr(h,g)!=d.attr(a,g))return!1;return!0},_4e_isEmptyInlineRemovable:function(h){if(!b.$removeEmpty[d.nodeName(h)])return!1;
for(var h=h.childNodes,a=0,c=h.length;a<c;a++){var e=h[a],f=e.nodeType;if(!(f==d.ELEMENT_NODE&&e.getAttribute("_ke_bookmark"))&&(f==d.ELEMENT_NODE&&!d._4e_isEmptyInlineRemovable(e)||f==d.TEXT_NODE&&g.trim(e.nodeValue)))return!1}return!0},_4e_moveChildren:function(h,a,d){a=p(a);if(h!=a)if(d)for(;d=h.lastChild;)a.insertBefore(h.removeChild(d),a.firstChild);else for(;d=h.firstChild;)a.appendChild(h.removeChild(d))},_4e_mergeSiblings:function(h){h=new a(h);l[h.nodeName()]&&(e(h,!0),e(h))},_4e_splitText:function(h,
a){var b=h.ownerDocument;if(h.nodeType==d.TEXT_NODE){if(c.ie&&a==h.nodeValue.length){var e=b.createTextNode("");d.insertAfter(e,h);return e}e=h.splitText(a);b.documentMode&&(b=b.createTextNode(""),d.insertAfter(b,e),d.remove(b));return e}},_4e_parents:function(h,a){var d=[];d.__IS_NODELIST=1;do d[a?"push":"unshift"](h);while(h=h.parentNode);return d},_4e_nextSourceNode:function(h,a,c,b){if(b&&!b.call)var e=p(b),b=function(h){return h!==e};var a=!a&&h.firstChild,s=h;if(!a){if(h.nodeType==d.ELEMENT_NODE&&
b&&!1===b(h,!0))return null;a=h.nextSibling}for(;!a&&(s=s.parentNode);){if(b&&!1===b(s,!0))return null;a=s.nextSibling}return!a||b&&!1===b(a)?null:c&&c!=a.nodeType?d._4e_nextSourceNode(a,!1,c,b):a},_4e_previousSourceNode:function(h,a,c,b){if(b&&!b.call)var e=p(b),b=function(a){return a!==e};var a=!a&&h.lastChild,s=h;if(!a){if(h.nodeType==d.ELEMENT_NODE&&b&&!1===b(h,!0))return null;a=h.previousSibling}for(;!a&&(s=s.parentNode);){if(b&&!1===b(s,!0))return null;a=s.previousSibling}return!a||b&&!1===
b(a)?null:c&&a.nodeType!=c?d._4e_previousSourceNode(a,!1,c,b):a},_4e_commonAncestor:function(a,c){c=p(c);if(a===c)return a;if(d.contains(c,a))return c;var b=a;do if(d.contains(b,c))return b;while(b=b.parentNode);return null},_4e_hasAttributes:9>j.ieEngine?function(a){for(var d=a.attributes,c=0;c<d.length;c++){var b=d[c];switch(b.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(b.specified)return!0}}return!1}:function(a){c.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,c){var b=p(c);if(a.compareDocumentPosition)return a.compareDocumentPosition(b);if(a==b)return m.POSITION_IDENTICAL;if(a.nodeType==d.ELEMENT_NODE&&b.nodeType==d.ELEMENT_NODE){if(d.contains(a,b))return m.POSITION_CONTAINS+m.POSITION_PRECEDING;if(d.contains(b,a))return m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>b.sourceIndex?m.POSITION_DISCONNECTED:a.sourceIndex<b.sourceIndex?m.POSITION_PRECEDING:m.POSITION_FOLLOWING}for(var e=
d._4e_address(a),b=d._4e_address(b),f=Math.min(e.length,b.length),s=0;s<=f-1;s++)if(e[s]!=b[s])return e[s]<b[s]?m.POSITION_PRECEDING:m.POSITION_FOLLOWING;return e.length<b.length?m.POSITION_CONTAINS+m.POSITION_PRECEDING:m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING},_4e_address:function(a,b){for(var c=[],e=a.ownerDocument.documentElement,f=a;f&&f!=e;)c.unshift(d._4e_index(f,b)),f=f.parentNode;return c},_4e_remove:function(a,b){var c=a.parentNode;if(c){if(b)for(var d;d=a.firstChild;)c.insertBefore(a.removeChild(d),
a);c.removeChild(a)}return a},_4e_trim:function(a){d._4e_ltrim(a);d._4e_rtrim(a)},_4e_ltrim:function(a){for(var b;b=a.firstChild;){if(b.nodeType==d.TEXT_NODE){var c=j.ltrim(b.nodeValue),e=b.nodeValue.length;if(c)c.length<e&&(d._4e_splitText(b,e-c.length),a.removeChild(a.firstChild));else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){for(var b;b=a.lastChild;){if(b.type==d.TEXT_NODE){var e=j.rtrim(b.nodeValue),f=b.nodeValue.length;if(e)e.length<f&&(d._4e_splitText(b,e.length),a.removeChild(a.lastChild));
else{a.removeChild(b);continue}}break}!c.ie&&!c.opera&&(b=a.lastChild)&&1==b.nodeType&&"br"==d.nodeName(b)&&a.removeChild(b)},_4e_appendBogus:function(a){for(var b=a.lastChild;b&&b.nodeType==d.TEXT_NODE&&!g.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==d.TEXT_NODE||"br"!==d.nodeName(b))b=c.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br"),c.gecko&&b.setAttribute("type","_moz"),a.appendChild(b)},_4e_outerHtml:function(a){if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,
"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML},_4e_setMarker:function(b,c,d,e){var b=new a(b),f=b.data("list_marker_id")||b.data("list_marker_id",g.guid()).data("list_marker_id"),s=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");c[f]=b;s[d]=1;return b.data(d,e)},_4e_clearMarkers:function(b,c,d){var b=new a(b),e=b.data("list_marker_names"),f=b.data("list_marker_id"),s;for(s in e)e.hasOwnProperty(s)&&b.removeData(s);
b.removeData("list_marker_names");d&&(b.removeData("list_marker_id"),delete c[f])},_4e_copyAttributes:function(b,e,f){for(var e=new a(e),g=b.attributes,f=f||{},n=0;n<g.length;n++){var s=g[n],q=s.name.toLowerCase(),t;if(!(q in f))if("checked"==q&&(t=d.attr(b,q)))e.attr(q,t);else if(s.specified||c.ie&&s.value&&"value"==q)t=d.attr(b,q),null===t&&(t=s.nodeValue),e.attr(q,t)}""!==b.style.cssText&&(e[0].style.cssText=b.style.cssText)},_4e_isEditable:function(a){a=d.nodeName(a);return(a=!b.$nonEditable[a]&&
(b[a]||b.span))&&a["#"]},_4e_getByAddress:function(a,b,c){for(var a=a.documentElement,d=0;a&&d<b.length;d++){var e=b[d];if(c)for(var s=-1,f=0;f<a.childNodes.length;f++){var g=a.childNodes[f];if(!(!0===c&&3==g.nodeType&&g.previousSibling&&3==g.previousSibling.nodeType)&&(s++,s==e)){a=g;break}}else a=a.childNodes[e]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(g){function i(a){1>arguments.length||(this.range=a,this.forceBrBreak=e,this.enlargeBr=j,this.enforceRealBlocks=e,this._||(this._={}))}var j=!0,e=!1,f=g.Editor,b=g.UA,d=f.Walker,c=f.Range,a=f.RANGE,l=f.ElementPath,m=g.Node,n=g.DOM,o=/^[\r\n\t ]*$/;g.augment(i,{getNextParagraph:function(f){var h,k,i,u,x;if(!this._.lastNode){k=this.range.clone();k.shrink(a.SHRINK_ELEMENT,j);k.enlarge(this.forceBrBreak||!this.enlargeBr?a.ENLARGE_LIST_ITEM_CONTENTS:a.ENLARGE_BLOCK_CONTENTS);
var s=new d(k),q=d.bookmark(j,j);s.evaluator=q;this._.nextNode=s.next();s=new d(k);s.evaluator=q;s=s.previous();this._.lastNode=s._4e_nextSourceNode(j);this._.lastNode&&this._.lastNode[0].nodeType==n.TEXT_NODE&&!g.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(q=new c(k.document),q.moveToPosition(this._.lastNode,a.POSITION_AFTER_END),q.checkEndOfBlock()&&(q=new l(q.endContainer),this._.lastNode=(q.block||q.blockLimit)._4e_nextSourceNode(j)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new m(k.document.createTextNode("")),n.insertAfter(this._.lastNode[0],s[0]));k=null}q=this._.nextNode;s=this._.lastNode;for(this._.nextNode=null;q;){var t=e,v=q[0].nodeType!=n.ELEMENT_NODE,y=e;if(v)q[0].nodeType==n.TEXT_NODE&&o.test(q[0].nodeValue)&&(v=e);else{var w=q.nodeName();if(q._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==w)v=j;else if(!k&&!q[0].childNodes.length&&"hr"!=w){h=q;i=q.equals(s);break}k&&(k.setEndAt(q,a.POSITION_BEFORE_START),"br"!=
w&&(this._.nextNode=q));t=j}else{if(q[0].firstChild){k||(k=new c(this.range.document),k.setStartAt(q,a.POSITION_BEFORE_START));q=new m(q[0].firstChild);continue}v=j}}v&&!k&&(k=new c(this.range.document),k.setStartAt(q,a.POSITION_BEFORE_START));i=(!t||v)&&q.equals(s);if(k&&!t)for(;!q[0].nextSibling&&!i;){w=q.parent();if(w._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){t=j;i||w.equals(s);break}q=w;v=j;i=q.equals(s);y=j}v&&k.setEndAt(q,a.POSITION_AFTER_END);q=q._4e_nextSourceNode(y,null,s);if((i=!q)||
t&&k)break}if(!h){if(!k)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;h=new l(k.startContainer);q=h.blockLimit;t={div:1,th:1,td:1};h=h.block;if((!h||!h[0])&&!this.enforceRealBlocks&&t[q.nodeName()]&&k.checkStartOfBlock()&&k.checkEndOfBlock())h=q;else if(!h||this.enforceRealBlocks&&"li"==h.nodeName())h=new m(this.range.document.createElement(f||"p")),h[0].appendChild(k.extractContents()),h._4e_trim(),k.insertNode(h),u=x=j;else if("li"!=h.nodeName()){if(!k.checkStartOfBlock()||
!k.checkEndOfBlock())h=h.clone(e),h[0].appendChild(k.extractContents()),h._4e_trim(),x=k.splitBlock(),u=!x.wasStartOfBlock,x=!x.wasEndOfBlock,k.insertNode(h)}else i||(this._.nextNode=h.equals(s)?null:k.getBoundaryNodes().endNode._4e_nextSourceNode(j,null,s))}u&&(k=new m(h[0].previousSibling),k[0]&&k[0].nodeType==n.ELEMENT_NODE&&("br"==k.nodeName()?k._4e_remove():k[0].lastChild&&"br"==n.nodeName(k[0].lastChild)&&n._4e_remove(k[0].lastChild)));x&&(k=d.bookmark(e,j),u=new m(h[0].lastChild),u[0]&&u[0].nodeType==
n.ELEMENT_NODE&&"br"==u.nodeName()&&(b.ie||u.prev(k,1)||u.next(k,1))&&u.remove());this._.nextNode||(this._.nextNode=i||h.equals(s)?null:h._4e_nextSourceNode(j,null,s));return h}});c.prototype.createIterator=function(){return new i(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(g){function i(a){for(var g=b,i=b,n=[];a;){if(a[0].nodeType==e.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var o=a.nodeName();if(!i&&(!g&&d[o]&&(g=a),c[o])){var j;if(j=!g)if(j="div"==o){a:{j=a[0].childNodes;for(var h=0,k=j.length;h<k;h++){var r=j[h];if(r.nodeType==e.ELEMENT_NODE&&f.$block[r.nodeName.toLowerCase()]){j=!0;break a}}j=!1}j=!j}j?g=a:i=a}n.push(a);if("body"==o)break}a=a.parent()}this.block=g;this.blockLimit=i;this.elements=n}var j=g.Editor,
e=g.DOM,f=j.XHTML_DTD,b=null,d={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},c={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};i.prototype={compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var c=0;c<b.length;c++)if(!e.equals(b[c],a[c]))return!1;return!0},contains:function(a){for(var c=this.elements,d=0;d<c.length;d++)if(c[d].nodeName()in a)return c[d];return b},toString:function(){var a=this.elements,
b,c=[];for(b=0;b<a.length;b++)c.push(a[b].nodeName());return c.toString()}};return j.ElementPath=i},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/enterKey/index",function(g){function i(a){var e;e=a.getSelection().getRanges();for(var i=e.length-1;0<i;i--)e[i].deleteContents();e=e[0];i=e.document;if(e.checkStartOfBlock()&&e.checkEndOfBlock()){var h=(new m(e.startContainer)).block;if(h&&("li"==h.nodeName()||"li"==h.parent().nodeName()))return a.hasCommand("outdent")?(a.execCommand("save"),a.execCommand("outdent"),a.execCommand("save"),!0):!1}var k=e.splitBlock("p");if(!k)return!0;var a=k.previousBlock,h=k.nextBlock,r=
k.wasStartOfBlock,j=k.wasEndOfBlock,x;if(h)x=h.parent(),"li"==x.nodeName()&&(h._4e_breakParent(x),h._4e_move(h.next(),!0));else if(a&&(x=a.parent())&&"li"==x.nodeName())a._4e_breakParent(x),e.moveToElementEditablePosition(a.next()),a._4e_move(a.prev());if(!r&&!j){if("li"==h.nodeName()&&(x=h.first(l.invisible(!0)))&&g.inArray(x.nodeName(),["ul","ol"]))(f.ie?new c(i.createTextNode("\u00a0")):new c(i.createElement("br"))).insertBefore(x);h&&e.moveToElementEditablePosition(h)}else{var s;if(a){if("li"==a.nodeName()||
!b.test(a.nodeName()))s=a.clone()}else h&&(s=h.clone());s||(s=new c("<p>",null,i));if(x=k.elementPath)for(var k=0,q=x.elements.length;k<q;k++){var t=x.elements[k];if(t.equals(x.block)||t.equals(x.blockLimit))break;d.$removeEmpty[t.nodeName()]&&(t=t.clone(),s._4e_moveChildren(t),s.append(t))}f.ie||s._4e_appendBogus();e.insertNode(s);if(f.ie&&r&&(!j||!a[0].childNodes.length))e.moveToElementEditablePosition(j?a:s),e.select();e.moveToElementEditablePosition(r&&!j?h:s)}f.ie||(h?(s=new c(i.createElement("span")),
s.html("&nbsp;"),e.insertNode(s),s.scrollIntoView(void 0,!1),e.deleteContents()):s.scrollIntoView(void 0,!1));e.select();return!0}function j(b){var c=b.get("document")[0];a.on(c,"keydown",function(a){if(13===a.keyCode&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){b.execCommand("save");var c=b.execCommand("enterBlock");b.execCommand("save");!1!==c&&a.preventDefault()}})}var e=g.Editor,f=g.UA,b=/^h[1-6]$/,d=e.XHTML_DTD,c=g.Node,a=g.Event,l=e.Walker,m=e.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:i});a.docReady(function(){j(a)})}}},{requires:["editor"]});
KISSY.add("editor/core/focusManager",function(g){function i(){var b=this;b.__iframeFocus=l;a=b;c&&clearTimeout(c);c=setTimeout(function(){b.fire("focus")},100)}function j(){var b=this;b.__iframeFocus=m;a=n;c&&clearTimeout(c);c=setTimeout(function(){b.fire("blur")},100)}var e=g.Editor,f=g.DOM,b=g.Event,d={},c,a,g={refreshAll:function(){for(var a in d)if(d.hasOwnProperty(a)){var b=d[a].get("document")[0];b.designMode="off";b.designMode="on"}},currentInstance:function(){return a},getInstance:function(a){return d[a]},
add:function(a){var c=f._getWin(a.get("document")[0]);b.on(c,"focus",i,a);b.on(c,"blur",j,a)},register:function(a){d[a._UUID]=a},remove:function(a){delete d[a._UUID];var c=f._getWin(a.get("document")[0]);b.remove(c,"focus",i,a);b.remove(c,"blur",j,a)}},l=!0,m=!1,n=null;g.refreshAll=g.refreshAll;e.focusManager=g;e.getInstances=function(){return d};return g},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/htmlDataProcessor/index",function(g){return{init:function(i){function j(a){return a.replace(p,function(a,b,c){return"<"+b+c.replace(h,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function e(a){return a.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+k+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function f(a){return a.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}
var b=b,d=g.Editor,c=g.Node,a=g.UA,l=g.require("htmlparser"),m=new l.Filter,n=new l.Filter,o=new l.Filter;(function(){var c=function(a,b){return function(c,d){var h=[];(""+c).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(c,e,C){e=e.toLowerCase();"font-family"==e&&(C=C.replace(/["']/g,""));for(var f,g,i,k=0;k<a.length;k++)if(a[k]&&(c=a[k][0],f=a[k][1],g=a[k][2],i=a[k][3],e.match(c)&&(!f||C.match(f)))){e=i||e;b&&(g=g||C);"function"==typeof g&&(g=g(C,d,e));g&&g.push&&
(e=g[0],g=g[1]);"string"==typeof g&&h.push([e,g]);return}!b&&h.push([e,C])});for(var e=0;e<h.length;e++)h[e]=h[e].join(":");return h.length?h.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],b),d={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(a){a.filterChildren()},tags:{p:function(a){a.filterChildren()},$:function(a){var b=a.nodeName||"";if(-1!=b.indexOf(":")&&
!/^ke/.test(b))if("v:imagedata"==b){if(b=a.getAttribute("o:href"))a.setAttribute("src",b),a.removeAttribute("o:href");if(b=a.getAttribute("o:title"))a.setAttribute("title",b),a.removeAttribute("o:title");a.setTagName("img")}else a.setTagName("")}},attributes:{"class":function(a){return!a||/(^|\s+)Mso/.test(a)?!1:a},style:function(a){a=c(a);return!a?!1:a}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},h={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=
["name","href","src"],c,d=0;d<b.length;d++)c="_ke_saved_"+b[d],a.getAttribute(c)&&a.removeAttribute(b[d]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1}},attributes:{style:function(a){if(!g.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(a){return a.substr(0,k.length)==k?(a="{C}"==a.substr(k.length,3)?a.substr(k.length+3):a.substr(k.length),new l.CData(decodeURIComponent(a))):a}};a.ie&&(h.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});m.addRules(h);n.addRules(d);o.addRules(d)})();(function(){function b(a){for(var a=a.childNodes,c=a.length,d=a[c-1];d&&3==d.nodeType&&!g.trim(d.nodeValue);)d=a[--c];return d}
function c(d,h){var e=b(d);e&&((h||!a.ie)&&1==e.nodeType&&"br"==e.nodeName?d.removeChild(e):3==e.nodeType&&k.test(e.nodeValue)&&d.removeChild(e))}function h(a){var c=b(a);return!c||1==c.nodeType&&"br"==c.nodeName||"form"==a.nodeName&&"input"==c.nodeName}function e(b){c(b,!0);h(b)&&(a.ie?b.appendChild(new l.Text("\u00a0")):(b.appendChild(new l.Text("&nbsp;")),b.appendChild(new l.Tag("br"))))}function f(a){c(a,!1);h(a)&&a.appendChild(new l.Text("\u00a0"))}var k=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,i=d.XHTML_DTD,j=g.merge(i.$block,
i.$listItem,i.$tableContent),p;for(p in j)j.hasOwnProperty(p)&&("br"in i[p]||delete j[p]);delete j.td;delete j.pre;var i={tags:{}},z={tags:{}};for(p in j)j.hasOwnProperty(p)&&(i.tags[p]=e,z.tags[p]=f);n.addRules(i);m.addRules(z);o.addRules(i)})();(function(){m.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}})})();var p=/<(a|area|img|input)\b([^>]*)>/gi,h=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,k="{ke_protected}";i.htmlDataProcessor={wordFilter:o,dataFilter:n,
htmlFilter:m,toHtml:function(a){var b=new l.BeautifyWriter;(new l.Parser(a)).parse().writeHtml(b,m);return b.getHtml()},toDataFormat:function(b,d,h){h=h||n;a.gecko&&(b=b.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));b=j(b);d=new c("<div>");d.html("a"+b);b=d.html().substr(1);b=f(b);d=new l.BeautifyWriter;(new l.Parser(b)).parse().writeHtml(d,h);b=d.getHtml();return b=e(b)},toServer:function(a){var b=new l.MinifyWriter;(new l.Parser(a)).parse().writeHtml(b,m);return b.getHtml()}}}}},
{requires:["editor"]});
KISSY.add("editor/core/meta",function(){var g={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../menubutton/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubble/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],orderedList:["../listUtils/btn","./cmd"],unorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubble/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["dd","../focusFix/"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],menubutton:["menubutton"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui",
"./cmd"],undo:["./btn","./cmd"],contextmenu:["menu","../focusFix/"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},i,j,e={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../menubutton/"],"flashCommon/baseClass":["../contextmenu/",
"../bubble/","../dialogLoader/","./utils"],"font/ui":["../button/","../menubutton/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../menubutton/"],"indent/cmd":["../dentUtils/cmd"],"orderedList/cmd":["../listUtils/cmd"],"unorderedList/cmd":["../listUtils/cmd"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],
"link/dialog":["../overlay/","./utils"],"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../menubutton/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../menubutton/"],"xiamiMusic/dialog":["../flash/dialog","../menubutton/"]},f={};for(i in g)j=
"editor/plugin/"+i+"/index",f[j]={requires:g[i]};for(i in e)j="editor/plugin/"+i,f[j]={requires:e[i]};KISSY.add(f)});
KISSY.add("editor/core/range",function(g,i,j,e,f){function b(a){var b=a.nodeType!=r.TEXT_NODE&&r.nodeName(a)in x.$removeEmpty,c=a.nodeType==r.TEXT_NODE&&!g.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return b||c||a}function d(a){return!v(a)&&!y(a)}function c(a){var b=o;return function(c){if(y(c))return n;if(c.nodeType==r.TEXT_NODE){if(g.trim(c.nodeValue).length)return o}else if(c.nodeType==r.ELEMENT_NODE&&(c=r.nodeName(c),!B[c]))if(!a&&!u.ie&&"br"==c&&!b)b=n;else return o;return n}}
function a(a,b){var c=a.startContainer,d=a.endContainer,h=a.startOffset,e=a.endOffset,f,g=o,q=o,i=void 0,k=a.document,t;0<b&&(i=k.createDocumentFragment());if(a.collapsed)return i;a.optimizeBookmark();d[0].nodeType==r.TEXT_NODE?(q=n,d=d._4e_splitText(e)):0<d[0].childNodes.length&&(e>=d[0].childNodes.length?(d=new s(d[0].appendChild(k.createTextNode(""))),t=n):d=new s(d[0].childNodes[e]));c[0].nodeType==r.TEXT_NODE?(g=n,c._4e_splitText(h)):h?h>=c[0].childNodes.length?(c=new s(c[0].appendChild(k.createTextNode(""))),
f=n):c=new s(c[0].childNodes[h].previousSibling):(f=new s(k.createTextNode("")),c.prepend(f),c=f,f=n);var x=c._4e_parents(),l=d._4e_parents();x.each(function(a,b){x[b]=a});l.each(function(a,b){l[b]=a});for(var m,j,k=0;k<x.length&&!(m=x[k],j=l[k],!m.equals(j));k++);for(var h=i,v,z,B=k;B<x.length;B++){v=x[B];e=0<b&&!v.equals(c)?h.appendChild(v.clone()[0]):null;v=v[0].nextSibling;z=l[B];for(var y=d[0],p=z&&z[0];v&&!(p==v||y==v);)z=v.nextSibling,2==b?h.appendChild(v.cloneNode(n)):(r._4e_remove(v),1==
b&&h.appendChild(v)),v=z;e&&(h=e)}for(h=i;k<l.length;k++){v=l[k];e=0<b&&!v.equals(d)?h.appendChild(v.clone()[0]):null;if(!x[k]||!v._4e_sameLevel(x[k]))for(v=v[0].previousSibling;v;)z=v.previousSibling,2==b?h.insertBefore(v.cloneNode(n),h.firstChild):(r._4e_remove(v),1==b&&h.insertBefore(v,h.firstChild)),v=z;e&&(h=e)}if(2==b){if(g&&(m=c[0],m.nodeType==r.TEXT_NODE&&m.nextSibling&&m.nextSibling.nodeType==r.TEXT_NODE&&(m.data+=m.nextSibling.data,m.parentNode.removeChild(m.nextSibling))),q)q=d[0],q.nodeType==
r.TEXT_NODE&&q.previousSibling&&q.previousSibling.nodeType==r.TEXT_NODE&&(q.previousSibling.data+=q.data,q.parentNode.removeChild(q))}else{if(m&&j&&(!c._4e_sameLevel(m)||!d._4e_sameLevel(j)))q=m._4e_index(),f&&m._4e_sameLevel(c)&&q--,a.setStart(m.parent(),q+1);a.collapse(n)}f&&c.remove();t&&d.remove();return i}function l(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function m(a){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=p;this.collapsed=n;this.document=a}i.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var n=!0,o=!1,p=null,h=i.RANGE,k=i.POSITION,r=g.DOM,u=g.UA,x=i.XHTML_DTD,s=g.Node,q=s.all,t={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},v=new e.whitespaces,y=new e.bookmark,w=e.whitespaces(n),z=e.bookmark(!1,
!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.augment(m,{toString:function(){var a=[],b=this.startContainer[0],c=this.endContainer[0];a.push((b.id||b.nodeName)+":"+this.startOffset);a.push((c.id||c.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,b=this.startOffset;a[0].nodeType!=r.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&
this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a[0].nodeType!=r.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,
b=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setEndAfter(b)},setStart:function(a,b){a[0].nodeType==r.ELEMENT_NODE&&t[a.nodeName()]&&(a=a.parent(),b=a._4e_index());this.startContainer=a;this.startOffset=b;this.endContainer||(this.endContainer=a,this.endOffset=b);l(this)},setEnd:function(a,b){a[0].nodeType==r.ELEMENT_NODE&&t[a.nodeName()]&&(a=a.parent(),b=a._4e_index()+1);this.endContainer=a;this.endOffset=
b;this.startContainer||(this.startContainer=a,this.startOffset=b);l(this)},setStartAt:function(a,b){switch(b){case h.POSITION_AFTER_START:this.setStart(a,0);break;case h.POSITION_BEFORE_END:a[0].nodeType==r.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setStartBefore(a);break;case h.POSITION_AFTER_END:this.setStartAfter(a)}l(this)},setEndAt:function(a,b){switch(b){case h.POSITION_AFTER_START:this.setEnd(a,0);break;
case h.POSITION_BEFORE_END:a[0].nodeType==r.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setEndBefore(a);break;case h.POSITION_AFTER_END:this.setEndAfter(a)}l(this)},cloneContents:function(){return a(this,2)},deleteContents:function(){return a(this,0)},extractContents:function(){return a(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=n},clone:function(){var a=new m(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=r.ELEMENT_NODE||a.endContainer[0].nodeType!=r.ELEMENT_NODE)return p;var b=new e(a);b.evaluator=function(a){return w(a)&&z(a)};a=b.next();b.reset();b=
b.previous();return a&&a.equals(b)?a:p},shrink:function(a,b){if(!this.collapsed){var a=a||h.SHRINK_TEXT,c=this.clone(),d=this.startContainer,f=this.endContainer,g=this.startOffset,q=this.endOffset,k=n,i,s,t=n;d&&d[0].nodeType==r.TEXT_NODE&&(g?g>=d[0].nodeValue.length?c.setStartAfter(d):(c.setStartBefore(d),k=o):c.setStartBefore(d));f&&f[0].nodeType==r.TEXT_NODE&&(q?q>=f[0].nodeValue.length?c.setEndAfter(f):(c.setEndAfter(f),t=o):c.setEndBefore(f));if(k||t)s=new e(c),s.evaluator=function(b){return b.nodeType==
(a==h.SHRINK_ELEMENT?r.ELEMENT_NODE:r.TEXT_NODE)},s.guard=function(b,c){if(a==h.SHRINK_ELEMENT&&b.nodeType==r.TEXT_NODE||c&&b==i)return o;!c&&b.nodeType==r.ELEMENT_NODE&&(i=b);return n};k&&(c=s[a==h.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,b?h.POSITION_AFTER_START:h.POSITION_BEFORE_START);t&&(s.reset(),(s=s[a==h.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(s,b?h.POSITION_BEFORE_END:h.POSITION_AFTER_END));return k||t}},createBookmark2:function(a){var b=this.startContainer,
c=this.endContainer,d=this.startOffset,h=this.endOffset,e,f;if(!b||!c)return{start:0,end:0};if(a){if(b[0].nodeType==r.ELEMENT_NODE&&(e=new s(b[0].childNodes[d]))&&e[0]&&e[0].nodeType==r.TEXT_NODE&&0<d&&e[0].previousSibling.nodeType==r.TEXT_NODE)b=e,d=0;for(;b[0].nodeType==r.TEXT_NODE&&(f=b.prev(void 0,1))&&f[0].nodeType==r.TEXT_NODE;)b=f,d+=f[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==r.ELEMENT_NODE&&(e=new s(c[0].childNodes[h]))&&e[0]&&e[0].nodeType==r.TEXT_NODE&&0<h&&e[0].previousSibling.nodeType==
r.TEXT_NODE)c=e,h=0;for(;c[0].nodeType==r.TEXT_NODE&&(f=c.prev(void 0,1))&&f[0].nodeType==r.TEXT_NODE;)c=f,h+=f[0].nodeValue.length}}return{start:b._4e_address(a),end:this.collapsed?p:c._4e_address(a),startOffset:d,endOffset:h,normalized:a,is2:n}},createBookmark:function(a){var b,c,d,e,f=this.collapsed;b=new s("<span>",p,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");a&&(d=g.guid("ke_bm_"),b.attr("id",d+"S"));f||(c=b.clone(),c.html("&nbsp;"),a&&c.attr("id",d+"E"),
e=this.clone(),e.collapse(),e.insertNode(c));e=this.clone();e.collapse(n);e.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,h.POSITION_AFTER_END);return{startNode:a?d+"S":b,endNode:a?d+"E":c,serializable:a,collapsed:f}},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(n)},trim:function(a,b){var c=this.startContainer,d=this.startOffset,h=this.collapsed;if((!a||h)&&c[0]&&c[0].nodeType==r.TEXT_NODE){if(d)if(d>=c[0].nodeValue.length)d=c._4e_index()+1,
c=c.parent();else{var e=c._4e_splitText(d),d=c._4e_index()+1,c=c.parent();r.equals(this.startContainer,this.endContainer)?this.setEnd(e,this.endOffset-this.startOffset):r.equals(c,this.endContainer)&&(this.endOffset+=1)}else d=c._4e_index(),c=c.parent();this.setStart(c,d);if(h){this.collapse(n);return}}c=this.endContainer;d=this.endOffset;!b&&!h&&c[0]&&c[0].nodeType==r.TEXT_NODE&&(d?(d>=c[0].nodeValue.length||c._4e_splitText(d),d=c._4e_index()+1):d=c._4e_index(),c=c.parent(),this.setEnd(c,d))},insertNode:function(a){this.optimizeBookmark();
this.trim(o,n);var b=this.startContainer;b[0].insertBefore(a[0],b[0].childNodes[this.startOffset]||null);b[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(a){var b=q(this.document);if(a.is2){var c=b._4e_getByAddress(a.start,a.normalized),d=a.startOffset,b=a.end&&b._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(c,d);b?this.setEnd(b,a):this.collapse(n)}else c=(d=a.serializable)?g.one("#"+a.startNode,b):a.startNode,a=d?g.one("#"+a.endNode,
b):a.endNode,this.setStartBefore(c),c._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(n)},getCommonAncestor:function(a,b){var c=this.startContainer,d=this.endContainer,c=c[0]==d[0]?a&&c[0].nodeType==r.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new s(c[0].childNodes[this.startOffset]):c:c._4e_commonAncestor(d);return b&&c[0].nodeType==r.TEXT_NODE?c.parent():c},enlarge:function(){function a(b,c,d,h){var e=b[c?"startContainer":"endContainer"],f,g=c?0:1,k=0,i=c?"previousSibling":
"nextSibling";f=b[c?"startOffset":"endOffset"];if(e[0].nodeType==r.TEXT_NODE){if(c){if(f)return}else if(f<e[0].nodeValue.length)return;f=e[0][i];e=e[0].parentNode}else f=e[0].childNodes[f+(c?-1:1)]||null,e=e[0];for(;e;){for(;f;)if(v(f)||y(f))f=f[i];else break;if(f){if(!k)b[c?"setStartAfter":"setEndBefore"](q(f));break}e=q(e);if("body"==e.nodeName())break;if(k||e.equals(h))d[g]=e,k=1;else b[c?"setStartBefore":"setEndAfter"](e);f=e[0][i];e=e[0].parentNode}}return function(b){switch(b){case h.ENLARGE_ELEMENT:if(this.collapsed)break;
var b=this.getCommonAncestor(),c=[];a(this,1,c,b);a(this,0,c,b);c[0]&&c[1]&&(b=c[0].contains(c[1])?c[1]:c[0],this.setStartBefore(b),this.setEndAfter(b));break;case h.ENLARGE_BLOCK_CONTENTS:case h.ENLARGE_LIST_ITEM_CONTENTS:var d=new m(this.document),c=new s(this.document.body);d.setStartAt(c,h.POSITION_AFTER_START);d.setEnd(this.startContainer,this.startOffset);var d=new e(d),f,g,k=e.blockBoundary(b==h.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:p),i=function(a){var b=k(a);b||(f=q(a));return b},t=function(a){var b=
i(a);!b&&"br"==r.nodeName(a)&&(g=q(a));return b};d.guard=i;d=d.lastBackward();f=f||c;this.setStartAt(f,"br"!=f.nodeName()&&(!d&&this.checkStartOfBlock()||d&&f.contains(d))?h.POSITION_AFTER_START:h.POSITION_AFTER_END);d=this.clone();d.collapse();d.setEndAt(c,h.POSITION_BEFORE_END);d=new e(d);d.guard=b==h.ENLARGE_LIST_ITEM_CONTENTS?t:i;f=p;d=d.lastForward();f=f||c;this.setEndAt(f,!d&&this.checkEndOfBlock()||d&&f.contains(d)?h.POSITION_BEFORE_END:h.POSITION_BEFORE_START);g&&this.setEndAfter(g)}}}(),
checkStartOfBlock:function(){var a=this.startContainer,b=this.startOffset;if(b&&a[0].nodeType==r.TEXT_NODE&&g.trim(a[0].nodeValue.substring(0,b)).length)return o;this.trim();a=new f(this.startContainer);b=this.clone();b.collapse(n);b.setStartAt(a.block||a.blockLimit,h.POSITION_AFTER_START);a=new e(b);a.evaluator=c(n);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,b=this.endOffset;if(a[0].nodeType==r.TEXT_NODE&&g.trim(a[0].nodeValue.substring(b)).length)return o;this.trim();
a=new f(this.endContainer);b=this.clone();b.collapse(o);b.setEndAt(a.block||a.blockLimit,h.POSITION_BEFORE_END);a=new e(b);a.evaluator=c(o);return a.checkForward()},checkBoundaryOfElement:function(a,c){var d=this.clone();d[c==h.START?"setStartAt":"setEndAt"](a,c==h.START?h.POSITION_AFTER_START:h.POSITION_BEFORE_END);d=new e(d);d.evaluator=b;return d[c==h.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,c=this.startOffset,d=this.endOffset,
e;if(a[0].nodeType==r.ELEMENT_NODE)if(e=a[0].childNodes.length,e>c)a=q(a[0].childNodes[c]);else if(0==e)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=q(a);a=a._4e_nextSourceNode()||a}if(b[0].nodeType==r.ELEMENT_NODE)if(e=b[0].childNodes.length,e>d)b=q(b[0].childNodes[d])._4e_previousSourceNode(n);else if(0==e)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=q(b)}a._4e_position(b)&k.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},fixBlock:function(a,
b){var c=this.createBookmark(),d=q(this.document.createElement(b));this.collapse(a);this.enlarge(h.ENLARGE_BLOCK_CONTENTS);d[0].appendChild(this.extractContents());d._4e_trim();u.ie||d._4e_appendBogus();this.insertNode(d);this.moveToBookmark(c);return d},splitBlock:function(a){var b=new f(this.startContainer),c=new f(this.endContainer),d=b.block,e=c.block,q=p;if(!b.blockLimit.equals(c.blockLimit))return p;"br"!=a&&(d||(d=this.fixBlock(n,a),e=(new f(this.endContainer)).block),e||(e=this.fixBlock(o,
a)));a=d&&this.checkStartOfBlock();b=e&&this.checkEndOfBlock();this.deleteContents();d&&d[0]==e[0]&&(b?(q=new f(this.startContainer),this.moveToPosition(e,h.POSITION_AFTER_END),e=p):a?(q=new f(this.startContainer),this.moveToPosition(d,h.POSITION_BEFORE_START),d=p):(e=this.splitElement(d),!u.ie&&!g.inArray(d.nodeName(),["ul","ol"])&&d._4e_appendBogus()));return{previousBlock:d,nextBlock:e,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:q}},splitElement:function(a){if(!this.collapsed)return p;this.setEndAt(a,
h.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(o);c[0].appendChild(b);c.insertAfter(a);this.moveToPosition(a,h.POSITION_AFTER_END);return c},moveToElementEditablePosition:function(a,b){for(var c=0;a;){if(a[0].nodeType==r.TEXT_NODE){this.moveToPosition(a,b?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);c=1;break}a[0].nodeType==r.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,b?h.POSITION_BEFORE_END:h.POSITION_AFTER_START),c=1);var e=a,f=c,g=void 0;e[0].nodeType==r.ELEMENT_NODE&&
e._4e_isEditable()&&(g=e[b?"last":"first"](d,1));!f&&!g&&(g=e[b?"prev":"next"](d,1));a=g}return!!c},selectNodeContents:function(a){var b=a[0];this.setStart(a,0);this.setEnd(a,b.nodeType==r.TEXT_NODE?b.nodeValue.length:b.childNodes.length)},insertNodeByDtd:function(a){var b,c,d,e=a.nodeName();b=x.$block[e];this.deleteContents();if(b){for(b=this.getCommonAncestor(o,n);(c=x[b.nodeName()])&&(!c||!c[e]);){var h=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(n),
b.remove()):d=b;b=h}d&&this.splitElement(d)}this.insertNode(a)}});j.injectDom({_4e_breakParent:function(a,b){var b=q(b),a=q(a),c,d=new i.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);c=d.extractContents();d.insertNode(a.remove());a.after(c)}});i.Range=m},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(g){function i(a){this.document=a;this._={cache:{}};if(n){var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=f}}function j(a){a=new i(a);return!a||a.isInvalid?b:a}var e=g.Editor;e.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var f=!0,b=null,d=g.UA,c=g.DOM,a=g.Node,l=e.SELECTION,m=e.RANGE,n=d.ie,o=e.Walker,p=e.Range,h={img:1,hr:1,li:1,table:1,
tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};g.augment(i,{getNative:!n?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=c._getWin(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!n?function(){var a=this._.cache;if(a.type)return a.type;var b=l.SELECTION_TEXT,d=this.getNative();if(d){if(1==d.rangeCount){var d=d.getRangeAt(0),e=d.startContainer;
e==d.endContainer&&e.nodeType==c.ELEMENT_NODE&&1==Number(d.endOffset-d.startOffset)&&h[e.childNodes[d.startOffset].nodeName.toLowerCase()]&&(b=l.SELECTION_ELEMENT)}}else b=l.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=l.SELECTION_NONE;try{var c=this.getNative(),d=c.type;"Text"==d&&(b=l.SELECTION_TEXT);"Control"==d&&(b=l.SELECTION_ELEMENT);c.createRange().parentElement&&(b=l.SELECTION_TEXT)}catch(e){}return a.type=b},getRanges:n?function(){var d=function(a,
d){a=a.duplicate();a.collapse(d);for(var e=a.parentElement(),h=e.childNodes,f,g=0;g<h.length;g++){var k=h[g];if(k.nodeType==c.ELEMENT_NODE){f=a.duplicate();f.moveToElementText(k);var k=f.compareEndPoints("StartToStart",a),i=f.compareEndPoints("EndToStart",a);f.collapse();if(0<k)break;else{if(!k||1==i&&-1==k)return{container:e,offset:g};if(!i)return{container:e,offset:g+1}}f=b}}f||(f=a.duplicate(),f.moveToElementText(e),f.collapse(!1));f.setEndPoint("StartToStart",a);f=(""+f.text).replace(/\r\n|\r/g,
"\n").length;try{for(;0<f;)f-=h[--g].nodeValue.length}catch(m){f=0}return 0===f?{container:e,offset:g}:{container:h[g],offset:-f}};return function(b){var c=this._.cache;if(c.ranges&&!b)return c.ranges;var e=this.getNative(),b=e&&e.createRange(),h=this.getType();if(!e)return[];if(h==l.SELECTION_TEXT)return e=new p(this.document),h=d(b,f),e.setStart(new a(h.container),h.offset),h=d(b),e.setEnd(new a(h.container),h.offset),c.ranges=[e];if(h==l.SELECTION_ELEMENT){c=c.ranges=[];for(h=0;h<b.length;h++){for(var g=
b.item(h),k=g.parentNode,i=0,e=new p(this.document);i<k.childNodes.length&&k.childNodes[i]!=g;i++);e.setStart(new a(k),i);e.setEnd(new a(k),i+1);c.push(e)}return c}return c.ranges=[]}}():function(b){var c=this._.cache;if(c.ranges&&!b)return c.ranges;var b=[],d=this.getNative();if(!d)return[];for(var e=0;e<d.rangeCount;e++){var h=d.getRangeAt(e),f=new p(this.document);f.setStart(new a(h.startContainer),h.startOffset);f.setEnd(new a(h.endContainer),h.endOffset);b.push(f)}return c.ranges=b},getStartElement:function(){var b=
this._.cache;if(void 0!==b.startElement)return b.startElement;var d,e=this.getNative();switch(this.getType()){case l.SELECTION_ELEMENT:return this.getSelectedElement();case l.SELECTION_TEXT:var h=this.getRanges()[0];if(h&&!h.collapsed){for(h.optimize();f;)if(d=h.startContainer,h.startOffset==(d[0].nodeType===c.ELEMENT_NODE?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())h.setStartAfter(d);else break;d=h.startContainer;if(d[0].nodeType!=c.ELEMENT_NODE)return d.parent();d=new a(d[0].childNodes[h.startOffset]);
if(!d[0]||d[0].nodeType!=c.ELEMENT_NODE)return h.startContainer;for(h=d[0].firstChild;h&&h.nodeType==c.ELEMENT_NODE;)d=new a(h),h=h.firstChild;return d}if(n)h=e.createRange(),h.collapse(f),d=new a(h.parentElement());else{if((d=e.anchorNode)&&d.nodeType!=c.ELEMENT_NODE)d=d.parentNode;d&&(d=new a(d))}}return b.startElement=d},getSelectedElement:function(){var b,d=this._.cache;if(void 0!==d.selectedElement)return d.selectedElement;n&&(b=this.getNative().createRange(),b=b.item&&b.item(0));var e;if(b)e=
new a(b);else{b=this.getRanges()[0];for(var f,g=2;g&&(!(e=b.getEnclosedNode())||!(e[0].nodeType==c.ELEMENT_NODE&&h[e.nodeName()]&&(f=e)));g--)b.shrink(m.SHRINK_ELEMENT);e=f}return d.selectedElement=e},reset:function(){this._.cache={}},selectElement:function(a){var b,c=this.document;if(n)try{b=c.body.createControlRange(),b.addElement(a[0]),b.select()}catch(d){b=c.body.createTextRange(),b.moveToElementText(a[0]),b.select()}finally{}else b=c.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),
a.addRange(b);this.reset()},selectRanges:function(a){if(n){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;b.removeAllRanges();for(var e=0;e<a.length;e++){var h=a[e],f=this.document.createRange(),g=h.startContainer;if(h.collapsed&&(d.gecko&&1.09>d.gecko||d.opera||d.webkit)&&g[0].nodeType==c.ELEMENT_NODE&&!g[0].childNodes.length)g[0].appendChild(this.document.createTextNode(d.webkit?"\u200b":"")),h.startOffset++,
h.endOffset++;f.setStart(g[0],h.startOffset);f.setEnd(h.endContainer[0],h.endOffset);b.addRange(f)}}this.reset()},createBookmarks2:function(a){for(var b=[],c=this.getRanges(),d=0;d<c.length;d++)b.push(c[d].createBookmark2(a));return b},createBookmarks:function(a,b){for(var d=[],e=this.document,h,b=b||this.getRanges(),k=b.length,i=0;i<k;i++){d.push(h=b[i].createBookmark(a,f));var m=(a=h.serializable)?g.one("#"+h.startNode,e):h.startNode;h=a?g.one("#"+h.endNode,e):h.endNode;for(var l=i+1;l<k;l++){var n=
b[l],j=n.startContainer,o=n.endContainer;c.equals(j,m.parent())&&n.startOffset++;c.equals(j,h.parent())&&n.startOffset++;c.equals(o,m.parent())&&n.endOffset++;c.equals(o,h.parent())&&n.endOffset++}}return d},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var d=new p(this.document);d.moveToBookmark(a[c]);b.push(d)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=
this.getStartElement();a&&a.scrollIntoView(void 0,!1)},removeAllRanges:function(){var a=this.getNative();n?a&&a.clear():a&&a.removeAllRanges()}});var k={table:1,tbody:1,tr:1},r=o.whitespaces(f),u=/\ufeff|\u00a0/;p.prototype.select=p.prototype.select=!n?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==c.ELEMENT_NODE&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));var b=this.document.createRange();b.setStart(a[0],this.startOffset);try{b.setEnd(this.endContainer[0],
this.endOffset)}catch(d){if(0<=d.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(f),b.setEnd(this.endContainer[0],this.endOffset);else throw d;}a=j(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(b){var d=this.collapsed,e,h;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var g=this.startContainer[0].childNodes[this.startOffset];if(g.nodeType==c.ELEMENT_NODE){(new i(this.document)).selectElement(new a(g));return}}(this.startContainer[0].nodeType==
c.ELEMENT_NODE&&this.startContainer.nodeName()in k||this.endContainer[0].nodeType==c.ELEMENT_NODE&&this.endContainer.nodeName()in k)&&this.shrink(m.SHRINK_ELEMENT,f);var l=this.createBookmark(),g=l.startNode,n;d||(n=l.endNode);l=this.document.body.createTextRange();l.moveToElementText(g[0]);l.moveStart("character",1);if(n)b=this.document.body.createTextRange(),b.moveToElementText(n[0]),l.setEndPoint("EndToEnd",b),l.moveEnd("character",-1);else{for(e=g[0].nextSibling;e&&!r(e);)e=e.nextSibling;e=!(e&&
e.nodeValue&&e.nodeValue.match(u))&&(b||!g[0].previousSibling||g[0].previousSibling&&"br"==c.nodeName(g[0].previousSibling));h=new a(this.document.createElement("span"));h.html("&#65279;");h.insertBefore(g);e&&c.insertBefore(this.document.createTextNode("\ufeff"),g[0]||g)}this.setStartBefore(g);g._4e_remove();if(d){if(e?(l.moveStart("character",-1),l.select(),this.document.selection.clear()):l.select(),h)this.moveToPosition(h,m.POSITION_BEFORE_START),h._4e_remove()}else this.setEndBefore(n),n._4e_remove(),
l.select()};i.getSelection=j;return e.Selection=i},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/plugin/selection/index",function(g,i){function j(b){function c(b,d){var e=i.body.createTextRange();try{e.moveToPoint(b,d)}catch(h){e=a}return e}function d(){var a=i.selection.createRange();l&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&l.select();m.remove(i,"mouseup",d);m.remove(i,"mousemove",e);l=f=0}function e(a){if(a.button){if(a=c(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",l)?a.setEndPoint("StartToStart",l):a.setEndPoint("EndToEnd",l),a.select()}else d()}var f,
g=b.get("window")[0],i=b.get("document")[0],l;m.on(i,"mousedown contextmenu",function(a){var b=i.documentElement;if(a.target===b&&(f&&d(),!(b.scrollHeight>b.clientHeight)&&(f=1,l=c(a.pageX,a.pageY))))m.on(i,"mouseup",d),m.on(i,"mousemove",e),g.focus(),l.select()})}function e(b){function e(a){if(m){var c=b.getSelection(),g=c&&c.getType(),i=c&&f.selection;if(a&&i&&g==p.SELECTION_NONE&&!f.queryCommandEnabled("InsertImage"))setTimeout(function(){e(d)},50);else{var l;if(!i||!i.type||!("Control"!=i.type&&
(l=i.createRange())&&(l=l.parentElement())&&(l=l.nodeName)&&l.toLowerCase()in{input:1,textarea:1}))n=i&&c.getRanges()[0],b.checkSelectionChange()}}}var f=b.get("document")[0],g=new o(f.body),l=new o(f.documentElement);if(8>i.Utils.ieEngine)l.on("click",function(a){"html"===(new o(a.target)).nodeName()&&b.getSelection().getNative().createRange().select()});var n,m,j=d;l.on("mousedown",function(){j=c});l.on("mouseup",function(){j=d});g.on("focusin",function(b){if("body"==(new o(b.target)).nodeName()&&
n){try{j&&n.select()}catch(c){}n=a}});g.on("focus",function(){m=d;e()});g.on("beforedeactivate",function(a){a.relatedTarget||(m=c,j=d)});g.on("mousedown",function(){m=c});g.on("mouseup",function(){m=d;setTimeout(function(){e(d)},0)});g.on("keydown",function(){m=c});g.on("keyup",function(){m=d;setTimeout(function(){e()},0)})}function f(a){var b=a.get("document")[0];m.on(b,"mouseup keyup",function(){a.checkSelectionChange()})}function b(a){function b(a){var c=i.XHTML_DTD;return a._4e_isBlockBoundary()&&
c.$empty[a.nodeName()]}function e(a){return m(a)&&j(a)}var f=a.get("document")[0],g=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,m=i.Walker.whitespaces(d),j=i.Walker.bookmark(c,d),t=function(a){return m(a)&&8!=a.nodeType};a.on("selectionChange",function(m){var j=m.path,q=new o(a.get("document")[0].body),m=(m=m.selection)&&m.getRanges()[0],z=j.blockLimit;if(l.gecko){var B=j.block||j.blockLimit,s=B&&B.last(e);B&&B._4e_isBlockBoundary()&&
(!s||!(1==s[0].nodeType&&s._4e_isBlockBoundary()))&&"pre"!=B.nodeName()&&!B._4e_getBogus()&&B._4e_appendBogus()}if(m&&m.collapsed&&!j.block){if("body"==z.nodeName()){if((j=m.fixBlock(d,"p"))&&j[0]!=q[0].lastChild&&j._4e_outerHtml().match(g))if((z=j.next(t,1))&&z[0].nodeType==n.ELEMENT_NODE&&!b[z])m.moveToElementEditablePosition(z),j._4e_remove();else if((z=j.prev(t,1))&&z[0].nodeType==n.ELEMENT_NODE&&!b[z])m.moveToElementEditablePosition(z,z._4e_outerHtml().match(g)?c:d),j._4e_remove();m.select();
a.notifySelectionChange()}j=new i.Range(f);j.moveToElementEditablePosition(q,d);"body"!==(new i.ElementPath(j.startContainer)).blockLimit.nodeName()&&(q=(new o(f.createElement("p"))).appendTo(q),l.ie||q._4e_appendBogus())}})}var d=!0,c=!1,a=null,l=g.UA,m=g.Event,n=g.DOM,o=g.Node,p=i.SELECTION;return{init:function(a){a.docReady(function(){l.ie?(j(a),e(a)):f(a)});b(a)}}},{requires:["editor"]});
KISSY.add("editor/core/styles",function(g){function i(a){return!w.attr(a,"_ke_bookmark")}function j(a,b){for(var c in a)a.hasOwnProperty(c)&&(g.isString(a[c])?a[c]=a[c].replace(L,function(a,c){return b[c]}):j(a[c],b))}function e(a,b){b&&(a=g.clone(a),j(a,b));var c=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#"==c||K[c]?z.STYLE_BLOCK:I[c]?z.STYLE_OBJECT:z.STYLE_INLINE;this._={definition:a}}function f(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();
for(var d=new C(a),e=d.getRanges(),h=0;h<e.length;h++)c.call(this,e[h]);d.selectRanges(e)}function b(a,b,c){var d=a.element;"*"==d&&(d="span");b=new D(b.createElement(d));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=e.getStyleText(c);if(a)for(var h in a)a.hasOwnProperty(h)&&b.attr(h,a[h]);c&&(b[0].style.cssText=c);return b}function d(d){var e=d.createBookmark(t),h=d.createIterator();h.enforceRealBlocks=t;h.enlargeBr=t;for(var f,g=d.document;f=h.getNextParagraph();){var i=b(this,g,
f),k=i,i="pre"==k.nodeName,m="pre"==f.nodeName,n=!i&&m;i&&!m?(m=f,n=m.html(),n=c(n,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),n=n.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),n=n.replace(/([ \t\n\r]+|&nbsp;)/g," "),n=n.replace(/<br\b[^>]*>/gi,"\n"),G.ie?(m=m[0].ownerDocument.createElement("div"),m.appendChild(k[0]),k[0].outerHTML="<pre>"+n+"</pre>",k=new D(m.firstChild),k._4e_remove()):k.html(n)):n?k=l(a(f),k):f._4e_moveChildren(k);f[0].parentNode.replaceChild(k[0],f[0]);if(i&&(f=k,i=void 0,(i=f._4e_previousSourceNode(t,
w.ELEMENT_NODE))&&"pre"==i.nodeName()))k=c(i.html(),/\n$/,"")+"\n\n"+c(f.html(),/^\n/,""),G.ie?f[0].outerHTML="<pre>"+k+"</pre>":f.html(k),i._4e_remove()}d.moveToBookmark(e)}function c(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function a(a){var b=[];c(a._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+
c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,c){b.push(c)});return b}function l(a,b){for(var d=b[0].ownerDocument.createDocumentFragment(),e=0;e<a.length;e++){var h=a[e],h=h.replace(/(\r\n|\r)/g,"\n"),h=c(h,/^[ \t]*\n/,""),h=c(h,/\n$/,""),h=c(h,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),h=h.replace(/\n/g,"<br>"),h=h.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),
f=b.clone();f.html(h);d.appendChild(f[0])}return d}function m(a){var c=a.document;if(a.collapsed)c=b(this,c,void 0),a.insertNode(c),a.moveToPosition(c,B.POSITION_BEFORE_END);else{var d=this.element,e=this._.definition,h,f=E[d];f||(h=t,f=E.span);var g=a.createBookmark();a.enlarge(B.ENLARGE_ELEMENT);a.trim();for(var k=a.createBookmark(),m=k.startNode,k=k.endNode,l=m,n;l&&l[0];){var j=v;if(w.equals(l,k))l=y,j=t;else{var q=l[0].nodeType,o=q==w.ELEMENT_NODE?l.nodeName():y;if(o&&l.attr("_ke_bookmark")){l=
l._4e_nextSourceNode(t);continue}if(!o||f[o]&&(l._4e_position(k)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(l))){var r=l.parent();if(r&&"a"==d&&r.nodeName()==d)q=b(this,c,void 0),r._4e_moveChildren(q),r[0].parentNode.replaceChild(q[0],r[0]),q._4e_mergeSiblings();else if(r&&r[0]&&((E[r.nodeName()]||E.span)[d]||h)&&(!e.parentRule||e.parentRule(r))){if(!n&&(!o||!E.$removeEmpty[o]||(l._4e_position(k)|
A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))n=new F(c),n.setStartBefore(l);if(q==w.TEXT_NODE||q==w.ELEMENT_NODE&&!l[0].childNodes.length){r=l;for(q=null;(j=!r.next(i,1))&&(q=r.parent())&&f[q.nodeName()]&&(q._4e_position(m)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(q));)r=q;n.setEndAfter(r)}}else j=
t}else j=t;l=l._4e_nextSourceNode()}if(j&&n&&!n.collapsed){for(var j=b(this,c,void 0),r=n.getCommonAncestor(),q={},o={},z,s=null,x;j&&r&&j[0]&&r[0];){if(r.nodeName()==d){for(z in e.attributes)if(e.attributes.hasOwnProperty(z)&&!o[z]&&(x=r.attr(s)))j.attr(z)==x?j.removeAttr(z):o[z]=1;for(s in e.styles)if(e.styles.hasOwnProperty(s)&&!q[s]&&(x=r.style(s)))j.style(s)==x?j.style(s,""):q[s]=1;if(!j._4e_hasAttributes()){j=y;break}}r=r.parent()}j?(j[0].appendChild(n.extractContents()),u(this,j),n.insertNode(j),
j._4e_mergeSiblings(),G.ie||j[0].normalize()):(j=new D(c.createElement("span")),j[0].appendChild(n.extractContents()),n.insertNode(j),u(this,j),j._4e_remove(!0));n=y}}m._4e_remove();k._4e_remove();a.moveToBookmark(g);a.shrink(B.SHRINK_TEXT)}}function n(a){a.enlarge(B.ENLARGE_ELEMENT);var b=a.createBookmark(),c=b.startNode;if(a.collapsed){for(var d=new H(c.parent()),e,f=0,g;f<d.elements.length&&(g=d.elements[f])&&!(g==d.block||g==d.blockLimit);f++)if(this.checkElementRemovable(g)){var i=a.checkBoundaryOfElement(g,
B.END),l=!i&&a.checkBoundaryOfElement(g,B.START);l||i?(e=g,e.match=l?"start":"end"):(g._4e_mergeSiblings(),g.nodeName()!=this.element?(i=h(this),x(g,i[g.nodeName()]||i["*"])):k(this,g))}if(e){g=c;for(f=0;;f++){i=d.elements[f];if(w.equals(i,e))break;else if(i.match)continue;else i=i.clone();i[0].appendChild(g[0]);g=i}g["start"==e.match?"insertBefore":"insertAfter"](e)}}else{var m=b.endNode,n=this,d=function(){for(var a=new H(c.parent()),b=new H(m.parent()),d=y,e=y,h=0;h<a.elements.length;h++){var f=
a.elements[h];if(f==a.block||f==a.blockLimit)break;n.checkElementRemovable(f)&&(d=f)}for(h=0;h<b.elements.length;h++){f=b.elements[h];if(f==b.block||f==b.blockLimit)break;n.checkElementRemovable(f)&&(e=f)}e&&m._4e_breakParent(e);d&&c._4e_breakParent(d)};d();for(e=new D(c[0].nextSibling);e[0]!==m[0];){f=e._4e_nextSourceNode();if(e[0]&&e[0].nodeType==w.ELEMENT_NODE&&this.checkElementRemovable(e)&&(e.nodeName()==this.element?k(this,e):(g=h(this),x(e,g[e.nodeName()]||g["*"])),f[0].nodeType==w.ELEMENT_NODE&&
f.contains(c)))d(),f=new D(c[0].nextSibling);e=f}}a.moveToBookmark(b)}function o(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function p(a,b){var c="";b!==v?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function h(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;
if(c){g.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var e=c[d],h,f,i;"string"==typeof e?h=e.toLowerCase():(h=e.element?e.element.toLowerCase():a.element,f=e.attributes,i=e.styles);e=b[h]||(b[h]={});if(f){h=e.attributes=e.attributes||[];for(var k in f)f.hasOwnProperty(k)&&h.push([k.toLowerCase(),f[k]])}if(i){var e=e.styles=e.styles||[],l;for(l in i)i.hasOwnProperty(l)&&e.push([l.toLowerCase(),i[l]])}}}return b}function k(a,b){var c=a._.definition,d=h(a),e=g.merge(c.attributes,(d[b.nodeName()]||
d["*"]||{}).attributes),c=g.merge(c.styles,(d[b.nodeName()]||d["*"]||{}).styles),d=g.isEmptyObject(e)&&g.isEmptyObject(c),f;for(f in e)if(e.hasOwnProperty(f)&&!(("class"==f||a._.definition.fullMatch)&&b.attr(f)!=r(f,e[f])))d=d||!!b.hasAttr(f),b.removeAttr(f);for(var i in c)c.hasOwnProperty(i)&&!(a._.definition.fullMatch&&b.style(i)!=r(i,c[i],t))&&(d=d||!!b.style(i),b.style(i,""));s(b)}function r(a,b,c){var d=new D("<span>");d[c?"style":"attr"](a,b);return d[c?"style":"attr"](a)}function u(a,b){for(var c=
h(a),d=b.all(a.element),e=d.length;0<=--e;)k(a,new D(d[e]));for(var f in c)if(c.hasOwnProperty(f)&&f!=a.element){d=b.all(f);for(e=d.length-1;0<=e;e--){var g=new D(d[e]);x(g,c[f])}}}function x(a,b){var c,d=b&&b.attributes;if(d)for(c=0;c<d.length;c++){var e=d[c][0],h;if(h=a.attr(e)){var f=d[c][1];(f===y||f.test&&f.test(h)||"string"==typeof f&&h==f)&&a[0].removeAttribute(e)}}if(d=b&&b.styles)for(c=0;c<d.length;c++)if(e=d[c][0],f=a.css(e)){var g=d[c][1];(g===y||g.test&&g.test(h)||"string"==typeof g&&
f==g)&&a.css(e,"")}s(a)}function s(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(t);b&&(b.nodeType==w.ELEMENT_NODE&&w._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==w.ELEMENT_NODE&&w._4e_mergeSiblings(c))}}var q=g.Editor,t=!0,v=!1,y=null,w=g.DOM,z={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},B=q.RANGE,C=q.Selection,A=q.POSITION,F=q.Range,D=g.Node,G=g.UA,H=q.ElementPath,K={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},E=q.XHTML_DTD,I={embed:1,hr:1,img:1,li:1,
object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,L=/#\((.+?)\)/g;q.STYLE=z;e.prototype={apply:function(a){f.call(this,a,v)},remove:function(a){f.call(this,a,t)},applyToRange:function(a){return(this.applyToRange=this.type==z.STYLE_INLINE?m:this.type==z.STYLE_BLOCK?d:y).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==z.STYLE_INLINE?n:y).call(this,a)},checkElementRemovable:function(a,b){if(!a)return v;var c=this._.definition,d;if(a.nodeName()==
this.element){if(!b&&!a._4e_hasAttributes())return t;var f=c._AC;if(f)c=f;else{var f={},g=0,i=c.attributes;if(i)for(var k in i)i.hasOwnProperty(k)&&(g++,f[k]=i[k]);if(i=e.getStyleText(c))f.style||g++,f.style=i;f._length=g;c=c._AC=f}if(c._length){for(var l in c)if("_length"!=l&&c.hasOwnProperty(l)){g=a.attr(l)||"";if("style"==l)a:{f=c[l];g=p(g,v);"string"==typeof f&&(f=o(f));"string"==typeof g&&(g=o(g));i=void 0;for(i in f)if(f.hasOwnProperty(i)&&!(i in g&&(g[i]==f[i]||"inherit"==f[i]||"inherit"==
g[i]))){f=v;break a}f=t}else f=c[l]==g;if(f){if(!b)return t}else if(b)return v}if(b)return t}else return t}l=h(this);if(l=l[a.nodeName()]||l["*"]){if(!(c=l.attributes)&&!(d=l.styles))return t;if(c)for(f=0;f<c.length;f++)if(l=c[f][0],l=a.attr(l))if(g=c[f][1],g===y||"string"==typeof g&&l==g||g.test&&g.test(l))return t;if(d)for(f=0;f<d.length;f++)if(l=a.css(d[f][0]))if(c=d[f][1],c===y||"string"==typeof c&&l==c||c.test&&c.test(l))return t}return v},checkActive:function(a){switch(this.type){case z.STYLE_BLOCK:return this.checkElementRemovable(a.block||
a.blockLimit,t);case z.STYLE_OBJECT:case z.STYLE_INLINE:for(var b=a.elements,c=0,d;c<b.length;c++)if(d=b[c],!(this.type==z.STYLE_INLINE&&(w.equals(d,a.block)||w.equals(d,a.blockLimit))))if((this.type!=z.STYLE_OBJECT||d.nodeName()in I)&&this.checkElementRemovable(d,t))return t}return v}};e.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(J,";"));for(var e in b)if(b.hasOwnProperty(e)){var f=b[e],h=(e+":"+f).replace(J,
";");"inherit"==f?d+=h:c+=h}c.length&&(c=p(c));return a._ST=c+d};q.Style=e},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(g){var i=g.Node,j=g.DOM,e=g.UA,f={debugUrl:function(b){var d=g.Config;d.debug||(b=b.replace(/\.(js|css)/i,"-min.$1"));-1==b.indexOf("?t")&&(b=-1!=b.indexOf("?")?b+"&":b+"?",b+="t="+encodeURIComponent(d.tag));return d.base+"editor/"+b},lazyRun:function(b,d,c){var a=b[d],e=b[c];b[d]=function(){a.apply(this,arguments);b[d]=b[c];return e.apply(this,arguments)}},getXY:function(b,d,c,a){c=c.defaultView||c.parentWindow;b-=j.scrollLeft(c);d-=j.scrollTop(c);a&&(a=a.defaultView||
a.parentWindow,c!=a&&c.frameElement&&(a=j.offset(c.frameElement,void 0,a),b+=a.left,d+=a.top));return{left:b,top:d}},tryThese:function(b){for(var d,c=0,a=arguments.length;c<a;c++){var e=arguments[c];try{d=e();break}catch(f){}}return d},arrayCompare:function(b,d){if(!b&&!d)return!0;if(!b||!d||b.length!=d.length)return!1;for(var c=0;c<b.length;c++)if(b[c]!==d[c])return!1;return!0},clearAllMarkers:function(b){for(var d in b)b.hasOwnProperty(d)&&b[d]._4e_clearMarkers(b,!0,void 0)},ltrim:function(b){return b.replace(/^\s+/,
"")},rtrim:function(b){return b.replace(/\s+$/,"")},isNumber:function(b){return/^\d+(.\d+)?$/.test(g.trim(b))},verifyInputs:function(b){for(var d=0;d<b.length;d++){var c=new i(b[d]),a=g.trim(f.valInput(c)),e=c.attr("data-verify"),c=c.attr("data-warning");if(e&&!RegExp(e).test(a))return alert(c),!1}return!0},sourceDisable:function(b,d){b.on("sourceMode",d.disable,d);b.on("wysiwygMode",d.enable,d)},resetInput:function(b){var d=b.attr("placeholder");d&&e.ie?(b.addClass("ks-editor-input-tip"),b.val(d)):
e.ie||b.val("")},valInput:function(b,d){if(void 0===d)return b.hasClass("ks-editor-input-tip")?"":b.val();b.removeClass("ks-editor-input-tip");b.val(d)},placeholder:function(b,d){b.attr("placeholder",d);e.ie&&(b.on("blur",function(){g.trim(b.val())||(b.addClass("ks-editor-input-tip"),b.val(d))}),b.on("focus",function(){b.removeClass("ks-editor-input-tip");g.trim(b.val())==d&&b.val("")}))},htmlEncode:function(b){return!b?b:(""+b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,
"&quot;")},normParams:function(b){var b=g.clone(b),d;for(d in b)if(b.hasOwnProperty(d)){var c=b[d];g.isFunction(c)&&(b[d]=c())}return b},map:function(b,d){for(var c=0;c<b.length;c++)b[c]=d(b[c]);return b},ieEngine:document.documentMode||e.ie,preventFocus:function(b){e.ie?b.unselectable(void 0):b.attr("onmousedown","return false;")},injectDom:function(b){g.mix(j,b);for(var d in b)b.hasOwnProperty(d)&&function(c){i.prototype[c]=function(){var a=[].slice.call(arguments,0);a.unshift(this[0]);return(a=
b[c].apply(null,a))&&(a.nodeType||g.isWindow(a))?new i(a):g.isArray(a)&&(a.__IS_NODELIST||a[0]&&a[0].nodeType)?new i(a):a}}(d)},addRes:function(){var b=this.__res=this.__res||[];b.push.apply(b,g.makeArray(arguments))},destroyRes:function(){for(var b=this.__res||[],d=0;d<b.length;d++){var c=b[d];g.isFunction(c)?c():(c.destroy&&c.destroy(),c.remove&&c.remove())}this.__res=[]},getQueryCmd:function(b){return"query"+("-"+b).replace(/-(\w)/g,function(b,c){return c.toUpperCase()})+"Active"}};return g.Editor.Utils=
f},{requires:["./base"]});
KISSY.add("editor/core/walker",function(g,i){function j(a,e){if(this._.end)return c;var f,h=this.range,g,i=this.guard,k=this.type,m=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,h.trim(),h.collapsed))return this.end(),c;if(!a&&!this._.guardLTR){var j=h.endContainer[0],o=j.childNodes[h.endOffset];this._.guardLTR=function(a,b){return b&&(j==a||"body"==l.nodeName(a))?!1:a!=o}}if(a&&!this._.guardRTL){var B=h.startContainer[0],p=0<h.startOffset&&B.childNodes[h.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(B==a||"body"==l.nodeName(a))?!1:a!=p}}var A=a?this._.guardRTL:this._.guardLTR;g=i?function(a,b){return A(a,b)===d?d:i(a,b)}:A;this.current?f=this.current[m](d,k,g):a?(f=h.endContainer,0<h.endOffset?(f=new n(f[0].childNodes[h.endOffset-1]),g(f[0])===d&&(f=c)):f=g(f,b)===d?c:f._4e_previousSourceNode(b,k,g,void 0)):(f=h.startContainer,f=new n(f[0].childNodes[h.startOffset]),f.length?g(f[0])===d&&(f=c):f=g(h.startContainer,b)===d?c:h.startContainer._4e_nextSourceNode(b,
k,g,void 0));for(;f&&!this._.end;){this.current=f;if(!this.evaluator||this.evaluator(f[0])!==d){if(!e)return f}else if(e&&this.evaluator)return d;f=f[m](d,k,g)}this.end();return this.current=c}function e(a){for(var b,d=c;b=j.call(this,a);)d=b;return d}function f(a){this.range=a;this.guard=this.evaluator=c;this._={}}var b=!0,d=!1,c=null,a=g.UA,l=g.DOM,m=i.XHTML_DTD,n=g.Node;g.augment(f,{end:function(){this._.end=1},next:function(){return j.call(this)},previous:function(){return j.call(this,b)},checkForward:function(){return j.call(this,
d,b)!==d},checkBackward:function(){return j.call(this,b,b)!==d},lastForward:function(){return e.call(this)},lastBackward:function(){return e.call(this,b)},reset:function(){delete this.current;this._={}},_iterator:j});g.mix(f,{blockBoundary:function(a){return function(b){return!(b.nodeType==l.ELEMENT_NODE&&l._4e_isBlockBoundary(b,a))}},bookmark:function(a,b){function c(a){return"span"==l.nodeName(a)&&l.attr(a,"_ke_bookmark")}return function(d){var e,f;e=d.nodeType==l.TEXT_NODE&&(f=d.parentNode)&&c(f);
e=a?e:e||c(d);return!!(b^e)}},whitespaces:function(a){return function(b){b=b.nodeType==l.TEXT_NODE&&!g.trim(b.nodeValue);return!!(a^b)}},invisible:function(a){var b=f.whitespaces();return function(c){c=b(c)||c.nodeType==l.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var o=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,p=f.whitespaces(),h=f.bookmark(),k=function(a){var b=l.nodeName(a);return h(a)||p(a)||1==a.nodeType&&b in m.$inline&&!(b in m.$empty)};i.Utils.injectDom({_4e_getBogus:function(b){b=new n(b);do b=
b._4e_previousSourceNode();while(b&&k(b[0]));return b&&(!a.ie?"br"==b.nodeName():3==b[0].nodeType&&o.test(b.text()))?b[0]:!1}});return i.Walker=f},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(g){var i=g.Editor;i.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};i.baseZIndex=function(g){return(i.Config.baseZIndex||1E4)+g}},{requires:["./base"]});
KISSY.add("editor",function(g,i,j,e){function f(a,b){var c=a.body;q(function(){a.designMode="on";setTimeout(function(){a.designMode="off";c.focus();arguments.callee.retry||(arguments.callee.retry=m)},50)},function(){a.designMode="off";u.attr(c,"contentEditable",p);u.attr(c,"contentEditable",m);!b&&f(a,1)})}function b(a){a.get("iframe");var b=a.get("textarea")[0],c=a.get("window")[0],d=a.get("document")[0];k.webkit&&(s.on(d,"click",function(a){var b=new x(a.target);g.inArray(b.nodeName(),["input",
"select"])&&a.preventDefault()}),s.on(d,"mouseup",function(a){var b=new x(a.target);g.inArray(b.nodeName(),["input","textarea"])&&a.preventDefault()}));if(k.gecko||r||k.opera){var h;h=(new x('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(b);h.on("focus",function(){a.focus()});a.activateGecko=function(){k.gecko&&a.__iframeFocus&&h[0].focus()};a.on("destroy",function(){h.detach();h.remove()})}s.on(c,"focus",function(){k.gecko?f(d,p):k.opera&&d.body.focus();
a.notifySelectionChange()});if(k.gecko)s.on(d,"mousedown",function(){a.__iframeFocus||f(d,p)});if(r&&(s.on(d,"keydown",function(b){if(b.keyCode in{8:1,46:1}){var c=a.getSelection(),d=c.getSelectedElement();if(d){a.fire("save");var e=c.getRanges()[0].createBookmark();d.remove();c.selectBookmarks([e]);a.fire("save");b.preventDefault()}}}),"CSS1Compat"==d.compatMode)){var i={33:1,34:1};s.on(d,"keydown",function(b){b.keyCode in i&&setTimeout(function(){a.getSelection().scrollIntoView()},0)})}if(k.webkit)s.on(d,
"mousedown",function(b){b=new x(b.target);g.inArray(b.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(b)});if(k.gecko)s.on(d,"dragstart",function(a){var b=new x(a.target);b.nodeName()==="img"&&/ke_/.test(b[0].className)&&a.preventDefault()});e.add(a)}function d(a,b,c,d){var e="",f,i=j.debugUrl("theme/editor-iframe.css");for(f=0;f<c.length;f++)e+=g.substitute('<link href="{href}" rel="stylesheet" />',{href:c[f]});return g.substitute(t,{doctype:8===h.documentMode?
'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:i,style:b,data:d||"&nbsp;",script:a?'<script id="ke_active_script">'+(u.isCustomDomain()?'document.domain="'+h.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function c(a,b){a.__saveTimer&&(clearTimeout(a.__saveTimer),a.__saveTimer=null);a.__saveTimer=setTimeout(function(){a.execCommand("save")},b||0)}function a(a,b){function c(){i=g.document;a.__set("document",new x(i));a.__set("window",new x(g));
e.detach();i.open("text/html","replace");i.write(f);i.close()}var e=a.get("iframe"),f=d(a._UUID,a.get("customStyle"),a.get("customLink"),b),h=e[0],g=h.contentWindow,i;e.__loaded=1;try{i=g.document}catch(k){if(h.src=h.src,7>r){setTimeout(c,10);return}}c()}function l(b,c){var d=new x(y),e=b.get("textarea");e.hasAttr("tabindex")&&d.attr("tabIndex",k.webkit?-1:e.attr("tabIndex"));b.get("iframeWrapEl").prepend(d);b.set("iframe",d);b.__docReady=0;if(k.gecko&&!d.__loaded)d.on("load",function(){a(b,c)},b);
else a(b,c)}var m=!0,n=n,o=g.all,p=!1,h=document,k=g.UA,r=k.ie,u=g.DOM,x=g.Node,s=g.Event,q=j.tryThese,t="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor'>{data}{script}</body></html>",v=u.getEmptyIframeSrc(),y='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true" '+(v?' src="'+v+'"':"")+"</iframe>";g.mix(i,{SOURCE_MODE:0,WYSIWYG_MODE:1});
var w=i.WYSIWYG_MODE;g.augment(i,{createDom:function(){var a,b=this.get("textarea"),c;b||this.set("textarea",b=o("<textarea class='ks-editor-textarea'></textarea>"));c=this.get("el");c.html('<div class="ks-editor-tools"></div><div class="ks-editor-textarea-wrap"></div><div class=\'ks-editor-status\'></div>');this._UUID=g.guid();this.set({iframeWrapEl:a=c.one(".ks-editor-textarea-wrap"),toolBarEl:c.one(".ks-editor-tools"),statusBarEl:c.one(".ks-editor-status")},{silent:1});b.css("width","100%");b.css("display",
"none");a.append(b);e.register(this)},_uiSetHeight:function(a){var b=this.get("toolBarEl"),c=this.get("statusBarEl"),a=parseInt(a,10),a=a-((b&&b.outerHeight()||0)+(c&&c.outerHeight()||0));this.get("iframeWrapEl").css("height",a);this.get("textarea").css("height",a)},adjustHeight:function(){var a;(a=this.get("height"))&&this._uiSetHeight(a)},_uiSetMode:function(a){var b=this,c,d=b.get("iframe"),e=b.get("textarea");a==w?(b.execCommand("save"),b.on("docReady",c=function(){b.execCommand("save");b.detach("docReady",
c)}),b._setData(e.val()),b.fire("wysiwygMode")):(e.val(b._getData(1,w)),e[0].focus(),e.show(),d.hide(),b.fire("sourceMode"))},_uiSetFocused:function(a){a&&this.__docReady&&this.focus()},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,c,d=b.get("prefixCls"),e=b.get("textarea");if(b.get("attachForm")&&(c=e[0].form))u.on(c,"submit",b.sync,b),b.on("destroy",function(){u.detach(c,"submit",b.sync,b)});b.on("docReady",
a);b.on("blur",function(){b.get("el").removeClass(d+"editor-focused")});b.on("focus",function(){b.get("el").addClass(d+"editor-focused")})},destructor:function(){var a=this.get("document")[0],b=this.get("window");this.sync();e.remove(this);s.remove([a,a.documentElement,a.body,b[0]]);g.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},addControl:function(a,
b){this.__controls[a]=b},showDialog:function(a,b){var a=a+"/dialog",c=this.__controls[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},execCommand:function(a){var b=this.__commands[a],c=g.makeArray(arguments);c.shift();c.unshift(this);if(b)return b.exec.apply(b,c)},_getData:function(a,b){var c=this.htmlDataProcessor,d;b==n&&(b=this.get("mode"));d=b==w?this.get("document")[0].body.innerHTML:
c.toDataFormat(this.get("textarea").val());d=a?c.toHtml(d):c.toServer(d);d=g.trim(d);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(d)&&(d="");return d},_setData:function(a){var b,c=a;if(this.get("mode")!=w)this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a,"p");if(this.get("iframe")){a=this.get("iframe");b=this.get("window")[0];var d=this.get("document")[0];s.remove([d,d.documentElement,d.body,b]);a.remove()}l(this,c)}},sync:function(){this.get("textarea").val(this.get("data"))},
getDocHtml:function(){return d(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getSelection:function(){return i.Selection.getSelection(this.get("document")[0])},focus:function(){var a=this.get("document")[0],b=u._getWin(a);k.ie||b&&b.parent&&b.parent.focus();b&&b.focus();a.body.focus();this.notifySelectionChange()},blur:function(){u._getWin(this.get("document")[0]).blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,b){var c=this.get("customStyle")||"",
c=c+("\n"+a);this.set("customStyle",c);u.addStyleSheet(this.get("window"),c,b)},removeCustomStyle:function(a){u.remove(u.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var b=this.get("customLink")||[],c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);b.href=a},removeCustomLink:function(a){for(var b=this.get("document")[0],b=u.query("link",b),c=0;c<b.length;c++)u.attr(b[c],"href")==
a&&u.remove(b[c]);b=this.get("customLink")||[];a=g.indexOf(a,b);-1!=a&&b.splice(a,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=b.getStartElement(),d=new i.ElementPath(c);if(!a.__previousPath||!a.__previousPath.compare(d))a.__previousPath=d,a.fire("selectionChange",
{selection:b,path:d,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(this.get("mode")===w){this.focus();var b,d=a.nodeName(),e=i.XHTML_DTD,f=e.$block[d],h=i.RANGE,g=(d=this.getSelection())&&d.getRanges(),k,l,j;if(g&&0!=g.length){this.execCommand("save");for(l=g.length-1;0<=l;l--)k=g[l],b=!l&&a||a.clone(m),k.insertNodeByDtd(b),j||(j=b);if(j)return k.moveToPosition(j,h.POSITION_AFTER_END),f&&(a=i.Walker.whitespaces(!0),
(a=(j=j.next(a,1))&&j[0].nodeType==u.ELEMENT_NODE&&j.nodeName())&&e.$block[a]&&e[a]["#"]&&k.moveToElementEditablePosition(j)),d.selectRanges([k]),this.focus(),b&&b.scrollIntoView(n,!1),c(this),b}}},insertHtml:function(a,b){var d=this,e;if(d.get("mode")===w){if(e=d.htmlDataProcessor)a=e.toDataFormat(a,null,b);d.focus();d.execCommand("save");var f=d.get("document")[0];e=0;if(r){var h=f.selection;"Control"==h.type&&h.clear();try{h.createRange().pasteHTML(a)}catch(g){}}else try{f.execCommand("inserthtml",
p,a)}catch(k){setTimeout(function(){if(0==d.getSelection().getRanges().length){var b=new i.Range(f),c=u.first(f.body,function(a){return 1==a.nodeType&&"br"!=u.nodeName(a)});c||(c=new x(f.createElement("p")),c._4e_appendBogus(n),f.body.appendChild(c[0]));b.setStartAt(c,i.RANGE.POSITION_AFTER_START);b.select()}f.execCommand("inserthtml",p,a)},e=100)}setTimeout(function(){d.getSelection().scrollIntoView()},e);c(d,e)}}});i._initIFrame=function(a){var c=e.getInstance(a),d=c.get("document")[0],a=d.getElementById("ke_active_script");
u.remove(a);b(c);var h=d.body;r?(h.hideFocus=m,h.disabled=m,h.contentEditable=m,h.removeAttribute("disabled")):setTimeout(function(){k.gecko||k.opera?h.contentEditable=m:k.webkit?h.parentNode.contentEditable=m:d.designMode="on"},0);if(k.gecko||k.opera){var g=d.documentElement;s.on(g,"mousedown",function(a){if(a.target==g){k.gecko&&f(d,p);c.activateGecko()}})}setTimeout(function(){r&&setTimeout(function(){if(d){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){c.__docReady=
1;c.fire("docReady");var a=c.get("disableObjectResizing"),b=c.get("disableInlineTableEditing");if(a||b)try{d.execCommand("enableObjectResizing",p,!a);d.execCommand("enableInlineTableEditing",p,!b)}catch(e){s.on(h,r?"resizestart":"resize",function(c){var d=new x(c.target);(a||d.nodeName()==="table"&&b)&&c.preventDefault()})}},10)};return i},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/focusManager,editor/core/meta".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(g,i){var j={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(e){e.hasCommand("backColor")||e.addCommand("backColor",{exec:function(e,b){e.execCommand("save");i.applyColor(e,b,j);e.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("backColor",{cmdType:"backColor",tooltip:"\u80cc\u666f\u989c\u8272"},j)}}},{requires:["editor","../color/btn","./cmd"]});KISSY.add("editor/plugin/bold/cmd",function(g,i,j){var e=new i.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(f){j.addButtonCmd(f,"bold",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("bold",{cmdType:"bold",tooltip:"\u7c97\u4f53 "},j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubble/index",function(g,i,j){function e(a){var b=null,c=a.get("editor").getControls();g.each(c,function(c){var d;if(d=c.get)if(d=-1!=(c.get("elCls")||"").indexOf("bubble"))if(d=c!==a)if(d=c.get("visible")){d=a.get("y");var e=d+a.get("el").outerHeight(),f=c.get("y"),g=f+c.get("el").outerHeight();d=d<=g&&e>=g||d<=f&&e>=f}d&&(b?b.get("y")<c.get("y")&&(b=c):b=c);return b})}var f=g.Event,b={}.a,d=g.DOM,c={zIndex:j.baseZIndex(j.zIndexManager.BUBBLE_VIEW),elCls:"ks-editor-bubble",
prefixCls:"ks-editor-",effect:{effect:"fade",duration:0.3}};j.prototype.addBubble=function(a,l,m){function j(){k.hide();f.remove(r,"scroll",p)}function o(){var a;var c=k,f=c.get("editorSelectedEl");if(f){var c=c.get("editor"),h=c.get("window")[0],g=c.get("iframe").offset(),c=g.top,g=g.left,i=g+d.width(h),h=c+d.height(h),l=f.offset(b,window),j=l.top,l=l.left,m=l+f.width(),f=j+f.height(),n;f>h&&j<h?n=h-30:f>c&&f<h&&(n=f);m>g&&l<g?a=g:l>g&&l<i&&(a=l);a=a!==b&&n!==b?[a,n]:b}else a=b;if(a){k.set("xy",
a);if(n=e(k))a[1]=n.get("y")+n.get("el").outerHeight(),k.set("xy",a);k.get("visible")||k.show()}}function p(){k.get("editorSelectedEl")&&(k.get("el"),k.hide(),u())}function h(){f.on(r,"scroll",p);o()}var k,m=m||{};m.editor=this;g.mix(m,c);k=new i(m);this.addControl(a+"/bubble",k);this.on("selectionChange",function(a){var a=a.path,b=a.elements;if(a&&b&&(a=a.lastElement))(a=l(a))?(k.set("editorSelectedEl",a),k.hide(),g.later(h,10)):j()});this.on("sourceMode",j);var r=this.get("window")[0],u=g.buffer(o,
350)}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(g,i,j){i.prototype.addButton=function(e,f,b){void 0===b&&(b=f.checkable?j.Toggle:j,delete f.checkable);var d=this.get("prefixCls")+"editor-",c=new b(g.mix({render:this.get("toolBarEl"),elAttrs:{hideFocus:"hideFocus"},autoRender:!0,content:'<span class="'+d+"toolbar-item "+d+"toolbar-"+e+'"></span>',elCls:d+"toolbar-button",prefixCls:d,editor:this},f)),a=c.get("el").one("span");c.get("el").unselectable();c.on("afterContentClsChange",function(b){a[0].className=
d+"toolbar-item "+d+"toolbar-"+b.newVal});c.get("mode")==i.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){c.set("disabled",false)}),this.on("sourceMode",function(){c.set("disabled",true)}));this.addControl(e+"/button",c);return c};return j},{requires:["editor","button"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(g,i){function j(b){this.editor=b;this._init()}var e=g.Node,f=i.SOURCE_MODE,b=i.WYSIWYG_MODE;g.augment(j,{_init:function(){var b=this.editor,c=b.get("statusBarEl");this.holder=(new e("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(c);(this.el=this.holder.one("input")).on("click",
this._check,this);b.on("wysiwygMode",this._wysiwygmode,this);b.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var d=this.editor;this.el.attr("checked")?d.set("mode",f):d.set("mode",b)},destroy:function(){this.holder.remove()}});return{init:function(b){var c=new j(b);b.on("destroy",function(){c.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(g,i,j,e,f){var b=g.Node;g.DOM.addStyleSheet(window,".ks-editor-color-panel a {display: block;color:black;text-decoration: none;}.ks-editor-color-panel a:hover {color:black;text-decoration: none;}.ks-editor-color-panel a:active {color:black;}.ks-editor-color-palette {    margin: 5px 8px 8px;}.ks-editor-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ks-editor-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ks-editor-color-a {    height: 18px;    width: 18px;}a.ks-editor-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ks-editor-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ks-editor-color-remove:hover {    background-color: #D6E9F8;}",
"ks-editor-color-plugin");var d=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],c;(function(){c="<div class='ks-editor-color-panel'><a class='ks-editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var a=0;3>a;a++){c+="<div class='ks-editor-color-palette'><table>";for(var b=d[a],e=b.length/8,f=0;f<e;f++){c+="<tr>";for(var g=0;8>g;g++){var i="#"+b[8*f+g];c+="<td>";c+="<a href='javascript:void(0);' class='ks-editor-color-a' style='background-color:"+i+"'></a>";c+="</td>"}c+="</tr>"}c+="</table></div>"}c+="<div><a class='ks-editor-button ks-editor-color-others ks-inline-block'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();return j.Toggle.extend({initializer:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.colorWin&&
a.colorWin.hide()},150)});a.on("click",function(){a.get("checked")?a._prepare():a.colorWin&&a.colorWin.hide()})},_prepare:function(){var a=this,b=a.get("editor"),d;a.colorWin=new e({elAttrs:{tabindex:0},elCls:"ks-editor-popup",content:c,autoRender:!0,width:170,zIndex:i.baseZIndex(i.zIndexManager.POPUP_MENU)});var g=a.colorWin;d=g.get("contentEl");d.on("click",a._selectColor,a);g.on("hide",function(){a.set("checked",!1)});d.one(".ks-editor-color-others").on("click",function(c){c.halt();g.hide();f.useDialog(b,
"color/colorPicker",a.get("cmdType"))});a._prepare=a._show;a._show()},_show:function(){var a=this.get("el"),b=this.colorWin;b.align(a,["bl","tl"],[0,2]);b.show()},_selectColor:function(a){a.halt();a=new b(a.target);a.hasClass("ks-editor-color-a")&&this.get("editor").execCommand(this.get("cmdType"),a.style("background-color"))},destructor:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{mode:{value:i.WYSIWYG_MODE}}})},{requires:["editor","../button/","../overlay/","../dialogLoader/"]});
KISSY.add("editor/plugin/color/cmd",function(g,i){return{applyColor:function(g,e,f){var b=g.get("document")[0];g.execCommand("save");e?(new i.Style(f,{color:e})).apply(b):(new i.Style(f,{color:"inherit"})).remove(b);g.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(g,i,j,e){i.prototype.addContextMenu=function(f,b,d){var c=this,d=d||{};d.prefixCls=c.get("prefixCls")+"editor-";d.editor=c;d.focusable=1;d.zIndex=i.baseZIndex(i.zIndexManager.POPUP_MENU);d.elAttrs={hideFocus:"hideFocus"};d.children&&g.each(d.children,function(a){a.xclass="menuitem"});var a=new j.PopupMenu(d);e.init(a);c.docReady(function(){var d=c.get("document");d.on("mousedown",function(b){1==b.which&&a.hide()});d.delegate("contextmenu",b,function(b){var c=
g.all(b.target);b.halt();var e=b.pageX,f=b.pageY,b=e?i.Utils.getXY(e,f,d[0],document):c.offset(document),e=b.left,f=b.top;setTimeout(function(){a.set("editorSelectedEl",c,{silent:1});a.set("xy",[e,f]);a.show();i.fire("contextmenu",{contextmenu:a});window.focus();document.body.focus();a.get("el")[0].focus()},30)})});c.addControl(f+"/contextmenu",a);return a}},{requires:["editor","menu","../focusFix/"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(g,i,j){function e(b){return b.nodeType==a.ELEMENT_NODE&&"li"==a.nodeName(b)}function f(b,c,e){for(var f=b.startContainer,h=b.endContainer;f&&!f.parent().equals(c);)f=f.parent();for(;h&&!h.parent().equals(c);)h=h.parent();if(f&&h){for(var g=f,f=[],o=!1;!o;)g.equals(h)&&(o=!0),f.push(g),g=g.next();if(!(1>f.length)){var p=c._4e_parents(!0,void 0);p.each(function(a,b){p[b]=a});for(h=0;h<p.length;h++)if(d[p[h].nodeName()]){c=p[h];break}for(var g="indent"==
e?1:-1,h=f[0],o=f[f.length-1],f={},w=j.listToArray(c,f),z=w[o.data("listarray_index")].indent,h=h.data("listarray_index");h<=o.data("listarray_index");h++){w[h].indent+=g;var B=w[h].parent;w[h].parent=new l(B[0].ownerDocument.createElement(B.nodeName()))}for(h=o.data("listarray_index")+1;h<w.length&&w[h].indent>z;h++)w[h].indent+=g;o=j.arrayToList(w,f,null,"p");g=[];if("outdent"==e){var C;if((C=c.parent())&&"li"==C.nodeName())for(var e=o.listNode.childNodes,A,h=e.length-1;0<=h;h--)(A=new l(e[h]))&&
"li"==A.nodeName()&&g.push(A)}o&&(a.insertBefore(o.listNode[0]||o.listNode,c[0]||c),c.remove());if(g&&g.length)for(h=0;h<g.length;h++){for(A=c=g[h];(A=A.next())&&A.nodeName()in d;)m.ie&&!c.first(function(a){return n(a)&&k(a)},1)&&c[0].appendChild(b.document.createTextNode("\u00a0")),c[0].appendChild(A[0]);a.insertAfter(c[0],C[0])}i.Utils.clearAllMarkers(f)}}}function b(a,b){var c=parseInt(a.style(o),10);isNaN(c)&&(c=0);c+=("indent"==b?1:-1)*p;if(0>c)return!1;c=Math.max(c,0);c=Math.ceil(c/p)*p;a.css(o,
c?c+h:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var d={ol:1,ul:1},c=i.Walker,a=g.DOM,l=g.Node,m=g.UA,n=c.whitespaces(!0),o="margin-left",p=40,h="px",k=c.bookmark(!1,!0);return{checkOutdentActive:function(a){var b=a.blockLimit;return a.contains(d)?!0:(a=a.block||b)&&a.style(o)},addCommand:function(h,g){h.hasCommand(g)||h.addCommand(g,{exec:function(h){h.execCommand("save");var i=h.getSelection(),k=i&&i.getRanges()[0];if(k){for(var l=k.startContainer,j=k.endContainer,m=k.getCommonAncestor();m&&
!(m[0].nodeType==a.ELEMENT_NODE&&d[m.nodeName()]);)m=m.parent();m&&l[0].nodeType==a.ELEMENT_NODE&&l.nodeName()in d&&(l=new c(k),l.evaluator=e,k.startContainer=l.next());m&&j[0].nodeType==a.ELEMENT_NODE&&j.nodeName()in d&&(l=new c(k),l.evaluator=e,k.endContainer=l.previous());j=i.createBookmarks(!0);if(m){for(l=m.first();l&&"li"!=l.nodeName();)l=l.next();var n=k.startContainer;(!(l[0]==n[0]||l.contains(n))||!b(m,g))&&f(k,m,g)}else{k=k.createIterator();k.enforceRealBlocks=!0;for(k.enlargeBr=!0;m=k.getNextParagraph();)b(m,
g)}i.selectBookmarks(j)}h.execCommand("save");h.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(g,i,j){var e,f={loading:function(){e||(e=new i({x:0,width:6==g.UA.ie?g.DOM.docWidth():"100%",y:0,zIndex:j.baseZIndex(j.zIndexManager.LOADING),prefixCls:"ks-editor-",elCls:"ks-editor-global-loading"}));e.set("height",g.DOM.docHeight());e.show();e.loading()},unloading:function(){e.hide()}};return{useDialog:function(b,d,c){b.focus();b.getControl(d+"/dialog")?setTimeout(function(){b.showDialog(d,c)},0):(f.loading(),g.use("editor/plugin/"+d+"/dialog",
function(a,e){f.unloading();b.addControl(d+"/dialog",new e(b));b.showDialog(d,c)}))}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(g,i,j,e,f){function b(a,b,c){for(a+="";a.length<b;)a=c+a;return a}function d(a){g.isNumber(a)&&(a=new Date(a));return a instanceof Date?[a.getFullYear(),"-",b(a.getMonth()+1,2,"0"),"-",b(a.getDate(),2,"0")," ",b(a.getHours(),2,"0"),":",b(a.getMinutes(),2,"0"),":",b(a.getSeconds(),2,"0")].join(""):a}function c(a){this.editor=a;this._init()}function a(a){var b=new c(a);a.on("destroy",function(){b.destroy()})}var l=g.Node,m=g.Event,n=g.JSON,o=i.Utils.addRes,
p=i.Utils.destroyRes;g.augment(c,{_getSaveKey:function(){var a=this.editor.get("pluginConfig");return a.draft&&a.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var a=j.getItem(this._getSaveKey()),b=[];a&&(b=j==window.localStorage?n.parse(decodeURIComponent(a)):a);this.drafts=b}return this.drafts},_init:function(){var a=this,b=a.editor,c=b.get("statusBarEl"),d=b.get("pluginConfig");d.draft=d.draft||{};a.draftInterval=d.draft.interval=d.draft.interval||5;a.draftLimit=
d.draft.limit=d.draft.limit||5;c=(new l("<div class='ks-editor-draft'><span class='ks-editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+d.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(c);a.timeTip=(new l("<span class='ks-editor-draft-time'/>")).appendTo(c);var e=(new l("<a href='#' onclick='return false;' class='ks-editor-button ks-editor-draft-save-btn ks-inline-block' style='vertical-align:middle;padding:1px 9px;'><span class='ks-editor-draft-save'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(c),g=new f({render:c,
width:"100px",prefixCls:"ks-editor-",menuCfg:{width:"225px",align:{points:["tr","br"]}},autoRender:!0,content:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});a.versions=g;g.on("beforeCollapsedChange",function(b){b.newValue||(g.detach("beforeCollapsedChange",arguments.callee),a.sync())});e.on("click",function(b){a.save(!1);b.halt()});o.call(a,e);b.get("textarea")[0].form&&function(){function c(){a.save(!0)}var d=b.get("textarea")[0].form;m.on(d,"submit",c);o.call(a,function(){m.remove(d,"submit",c)})}();var j=setInterval(function(){a.save(!0)},
6E4*a.draftInterval);o.call(a,function(){clearInterval(j)});g.on("click",a.recover,a);o.call(a,g);a.holder=c;if(d.draft.helpHtml){var n=(new l('<a tabindex="0" hidefocus="hidefocus" class="ks-editor-draft-help" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(c);n.on("click",function(){n[0].focus();a.helpPopup&&a.helpPopup.get("visible")?a.helpPopup.hide():a._prepareHelp()});n.on("blur",function(){a.helpPopup&&a.helpPopup.hide()});a.helpBtn=n;o.call(a,n);i.Utils.lazyRun(a,
"_prepareHelp","_realHelp")}o.call(a,c)},_prepareHelp:function(){var a=this.editor.get("pluginConfig").draft,a=new l(a.helpHtml||""),b=new l("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
a.append(b);a.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new e({content:a,prefixCls:"ks-editor-",autoRender:!0,width:a.width()+"px",zIndex:i.baseZIndex(i.zIndexManager.OVERLAY),mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=b},_realHelp:function(){var a=this.helpPopup,b=this.helpBtn,c=a.arrow;a.show();b=b.offset();a.get("el").offset({left:b.left-a.get("el").width()+17,top:b.top-a.get("el").height()-7});c.offset({left:b.left-2,top:b.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var a;a=this.draftLimit;var b=this.timeTip,c=this.versions,e=this._getDrafts(),f;e.length>a&&e.splice(0,e.length-a);for(a=0;a<e.length;a++)f=e[a],f=(f.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+d(f.date),c.addItem({xclass:"menuitem",content:f,value:a});b.html(f);j.setItem(this._getSaveKey(),j==window.localStorage?encodeURIComponent(n.stringify(e)):e)},save:function(a){var b=this._getDrafts(),
c=this.editor.get("formatData");c&&(b[b.length-1]&&c==b[b.length-1].content&&(b.length-=1),this.drafts=b.concat({content:c,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var b=this.editor,c=this._getDrafts(),e=a.target.get("value");confirm("\u786e\u8ba4\u6062\u590d "+d(c[e].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(b.execCommand("save"),b.set("data",c[e].content),b.execCommand("save"));this.versions.set("collapsed",!0);a.halt()},destroy:function(){p.call(this)}});return{init:function(b){j.ready?j.ready(function(){a(b)}):
a(b)}}},{requires:["editor","../localStorage/","overlay","../menubutton/"]});
KISSY.add("editor/plugin/dragUpload/index",function(g,i){var j=g.Node,e=g.Event,f=i.Utils,b=g.DOM;return g.UA.ie?void 0:{init:function(d){function c(a){a=a.originalEvent.target;"img"==b.nodeName(a)&&a.src.match(/^file:\/\//)&&(r[a.src]=a)}function a(a,b){var c=new window.FileReader;c.onload=function(d){var e=a.name,d=d.target.result,f=new XMLHttpRequest;f.open("POST",p,!0);f.onreadystatechange=function(){if(4==f.readyState){if(200==f.status||304==f.status){if(""!=f.responseText){var a=window.JSON.parse(f.responseText);
b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();f.onreadystatechange=null}};e="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+m+'"; filename="'+encodeURIComponent(e)+'"\r\n');e+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";e+=d+"\r\n";o=i.Utils.normParams(o);for(var h in o)o.hasOwnProperty(h)&&(e+="------kissy-editor-yiminghe\r\n",e+='Content-Disposition: form-data; name="'+h+'"\r\n\r\n',e+=o[h]+"\r\n");e+="------kissy-editor-yiminghe--";f.setRequestHeader("Content-Type",
"multipart/form-data, boundary=----kissy-editor-yiminghe");f.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+e.length+"\r\n"+e+"\r\n");c.onload=null};c.readAsBinaryString(a)}var l=d.get("pluginConfig").dragUpload||{},m=l.fileInput||"Filedata",n=l.sizeLimit||Number.MAX_VALUE,o=l.serverParams||{},p=l.serverUrl||"",h=RegExp((l.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),k=d.get("document")[0],r={},u=!1;e.on(k,"dragenter",function(){u||
(e.on(k,"DOMNodeInserted",c),u=!0)});e.on(k,"drop",function(d){e.remove(k,"DOMNodeInserted",c);u=!1;d.halt();var d=d.originalEvent,i,l;g.isEmptyObject(r)?(l=k.elementFromPoint(d.clientX,d.clientY),i=l.lastChild):(g.each(r,function(a){"img"==b.nodeName(a)&&(i=a.nextSibling,l=a.parentNode,b.remove(a))}),r={});d=d.dataTransfer;d.dropEffect="copy";if(d=d.files)for(var m=0;m<d.length;m++){var o=d[m],p=o.size;if(o.name.match(h)&&!(p/1E3>n)){var p=new j("<img src='"+f.debugUrl("theme/tao-loading.gif")+"'/>"),
w=p[0];l.insertBefore(w,i);var z=b.nodeName(w.parentNode);("head"==z||"html"==z)&&b.insertBefore(w,k.body.firstChild);a(o,p)}}});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var c=new (window.BlobBuilder||window.WebKitBlobBuilder),d=a.length,e=new window.Uint8Array(d),f=0;f<d;f++)e[f]=a.charCodeAt(f);c.append(e.buffer);this.send(c.getBlob(b))})}}},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(g,i){function j(e){this.cfg=e;this._cache=[];this._init()}var e=g.Node;g.augment(j,{_init:function(){var f=this.cfg.editor;this.holder=new e("<span>");this.holder.appendTo(f.get("statusBarEl"),void 0);f.on("selectionChange",this._selectionChange,this);i.Utils.sourceDisable(f,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(f){var b=this.cfg.editor,d=this.holder,
f=f.path.elements,c,a;c=this._cache;for(a=0;a<c.length;a++)c[a].remove();this._cache=[];for(a=0;a<f.length;a++){c=f[a];var g=c.attr("_ke_real_element_type")||c.nodeName(),i=new e("<a href='javascript(\""+g+"\")' class='ks-editor-element-path'>"+g+"</a>");this._cache.push(i);(function(a){i.on("click",function(c){c.halt();b.focus();setTimeout(function(){b.getSelection().selectElement(a)},50)})})(c);d.prepend(i)}},destroy:function(){this.holder.remove()}});return{init:function(e){var b=new j({editor:e});
e.on("destroy",function(){b.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(g,i){var j=g.Node,e=g.DOM,f=i.Utils.debugUrl("theme/spacer.gif"),b=g.require("htmlparser");g.augment(i,{createFakeElement:function(b,a,d,e,i,o){var p=b.attr("style")||"";b.attr("width")&&(p="width:"+b.attr("width")+"px;"+p);b.attr("height")&&(p="height:"+b.attr("height")+"px;"+p);var h=g.trim(b.attr("class")),b={"class":a+" "+h,src:f,_ke_realelement:encodeURIComponent(i||b._4e_outerHtml(void 0)),_ke_real_node_type:b[0].nodeType,style:p};o&&delete o.width;
o&&delete o.height;o&&g.mix(b,o,!1);d&&(b._ke_real_element_type=d);e&&(b._ke_resizable=e);return new j("<img/>",b,this.get("document")[0])},restoreRealElement:function(b){if(b.attr("_ke_real_node_type")!=e.ELEMENT_NODE)return null;var b=decodeURIComponent(b.attr("_ke_realelement")),a=new j("<div>",null,this.get("document")[0]);a.html(b);return a.first().remove()}});var d={tags:{$:function(c){var a=c.getAttribute("_ke_realelement"),d;a&&(d=(new b.Parser(decodeURIComponent(a))).parse());if(a=d&&d.childNodes[0]){if(d=
c.getAttribute("style")){var e=/(?:^|\s)width\s*:\s*(\d+)/i.exec(d),c=e&&e[1];d=(e=/(?:^|\s)height\s*:\s*(\d+)/i.exec(d))&&e[1];c&&a.setAttribute("width",c);d&&a.setAttribute("height",d)}return a}}}};return{init:function(c){var a=(c=c.htmlDataProcessor)&&c.htmlFilter;c.createFakeParserElement||(a&&a.addRules(d),g.mix(c,{createFakeParserElement:function(a,c,d,e,i){var h;h=new b.BasicWriter;a.writeHtml(h);h=h.getHtml();var k=a.getAttribute("style")||"";a.getAttribute("width")&&(k="width:"+a.getAttribute("width")+
"px;"+k);a.getAttribute("height")&&(k="height:"+a.getAttribute("height")+"px;"+k);var j=g.trim(a.getAttribute("class")),a={"class":c+" "+j,src:f,_ke_realelement:encodeURIComponent(h),_ke_real_node_type:a.nodeType+"",style:k,align:a.getAttribute("align")||""};i&&delete i.width;i&&delete i.height;i&&g.mix(a,i,!1);d&&(a._ke_real_element_type=d);e&&(a._ke_resizable="_ke_resizable");return new b.Tag("img",a)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(g,i,j){function e(a){this._init(a)}function f(a){var c=g.isString(a)?a.match(/(\d)+/g):a;g.isArray(c)&&(a=parseFloat(c[0]+"."+b(c[1],3)+b(c[2],5)));return a||0}function b(a,b){for(var c=(a+"").length;c++<b;)a="0"+a;return a}var d={};g.augment(e,g.EventTarget,{_init:function(a){var b=g.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var c=a.flashVars,e=a.params;g.mix(a.attrs,{id:b,width:"100%",height:"100%"},
!1);g.mix(e,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);g.mix(c,{shareData:!1,useCompression:!1},!1);e={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(e={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});g.mix(c,e);d[b]=this;this.id=b;this.swf=j.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var b=this,c=0;c<a.length;c++)(function(a){b[a]=function(){return b._callSWF(a,g.makeArray(arguments))}})(a[c])},
_callSWF:function(a,b){b=b||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,b)}catch(c){var d="";0!==b.length&&(d="'"+b.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+d+");"))(this)}},_eventHandler:function(a){var b=a.type;"log"!==b&&b&&this.fire(b,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete d[this.id]}});e.EventHandler=function(a,b){var c=d[a];c&&setTimeout(function(){c._eventHandler.call(c,b)},100)};i.FlashBridge=
e;var c=g.UA,a,l,m=!0;c.fpv=function(b){if(b||m){m=!1;var c;if(navigator.plugins&&navigator.mimeTypes.length)c=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{c=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){}a=!c?void 0:c.match(/(\d)+/g);l=f(a)}return a};c.fpvGEQ=function(a,b){m&&c.fpv(b);return!!l&&l>=f(a)};return e},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(g,i,j,e,f,b){function d(){d.superclass.constructor.apply(this,arguments);this._init()}var c=g.Node;d.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}};g.extend(d,g.Base,{_init:function(){var a=this,b=a.get("cls"),c=a.get("editor"),d=[],e=a.get("bubbleId"),f=a.get("contextMenuId"),h=a.get("contextMenuHandlers");g.each(h,function(a,b){d.push({content:b})});c.addContextMenu(f,"."+b,{width:"120px",
children:d,listeners:{click:function(a){a=a.target.get("content");h[a]&&h[a].call(this)}}});c.addBubble(e,function(a){return a.hasClass(b,void 0)&&a},{listeners:{afterRenderUI:function(){var b=this,d=b.get("contentEl");d.html(g.substitute(' <a class="ks-editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="ks-editor-bubble-link ks-editor-bubble-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubble-link ks-editor-bubble-remove">\u5220\u9664</span>',{label:a.get("label")}));var e=d.one(".ks-editor-bubble-url"),
f=d.one(".ks-editor-bubble-change"),h=d.one(".ks-editor-bubble-remove");i.Utils.preventFocus(d);f.on("click",function(c){a.show(b.get("editorSelectedEl"));c.halt()});h.on("click",function(a){if(g.UA.webkit){var d=c.getSelection().getRanges();if(d=d&&d[0])d.collapse(!0),d.select()}b.get("editorSelectedEl").remove();b.hide();c.notifySelectionChange();a.halt()});b.on("show",function(){var c=b.get("editorSelectedEl");c&&a._updateTip(e,c)})}}});c.docReady(function(){c.get("document").on("dblclick",a._dbClick,
a)})},_getFlashUrl:function(a){return b.getUrl(a)},_updateTip:function(a,b){var c=this.get("editor").restoreRealElement(b);c&&(c=this._getFlashUrl(c),a.attr("href",c))},_dbClick:function(a){var b=new c(a.target);"img"===b.nodeName()&&b.hasClass(this.get("cls"),void 0)&&(this.show(b),a.halt())},show:function(a){var b=this.get("editor");f.useDialog(b,this.get("type"),a)}});return d},{requires:["editor","../contextmenu/","../bubble/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(g){var i=g.DOM,j=g.Node,e=g.UA,f={insertFlash:function(b,d,c,a,e){d=f.createSWF(d,{attrs:c},b.get("document")[0]);c=b.createFakeElement(d.el,a||"ke_flash",e||"flash",!0,d.html,c);b.insertElement(c);return c},isFlashEmbed:function(b){return"application/x-shockwave-flash"==b.getAttribute("type")||/\.swf(?:$|\?)/i.test(b.getAttribute("src")||"")},getUrl:function(b){var d="";if("object"==b.nodeName())for(var b=b[0].childNodes,c=0;c<b.length;c++)1==
b[c].nodeType&&("movie"==(i.attr(b[c],"name")||"").toLowerCase()?d=i.attr(b[c],"value"):"embed"==i.nodeName(b[c])?d=i.attr(b[c],"src"):"object"==i.nodeName(b[c])&&(d=i.attr(b[c],"data")));else"embed"==b.nodeName()&&(d=b.attr("src"));return d},createSWF:function(b,d,c){var a=d.attrs||{},e=d.flashVars,f="",i="",d=d.params||{},o="",c=c||document;g.mix(a,{wmode:"transparent"});for(var p in a)a.hasOwnProperty(p)&&(f+=p+"='"+a[p]+"' ");g.mix(d,{quality:"high",movie:b,wmode:"transparent"});for(var h in d)d.hasOwnProperty(h)&&
(i+="<param name='"+h+"' value='"+d[h]+"'/>");if(e){for(var k in e)e.hasOwnProperty(k)&&(o+="&"+k+"="+encodeURIComponent(e[k]));o=o.substring(1)}b="<object "+f+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+i+(o?'<param name="flashVars" value="'+o+'"/>':"")+"<embed "+f+" "+(o?'FlashVars="'+o+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+b+'"  type="application/x-shockwave-flash"/></object>';return{el:new j(b,null,c),html:b}},createSWFRuntime2:function(b,
d,c){var c=c||document,a=(new j("<div style='width:0;height:0;overflow:hidden;'>",null,c)).appendTo(c.body),a=f.createSWF.apply(this,arguments).el.appendTo(a);e.ie||(a=a.one("object"));return a[0]},createSWFRuntime:function(b,d,c){var a=d.attrs||{},f=d.flashVars||{},m=d.params||{},n="",o="",p="",c=c||document;a.id=a.id||g.guid("ks-editor-runtimeflash-");for(var h in a)a.hasOwnProperty(h)&&(n+=h+"='"+a[h]+"' ");for(var k in m)m.hasOwnProperty(k)&&(o+="<param name='"+k+"' value='"+m[k]+"'/>");for(var r in f)f.hasOwnProperty(r)&&
(p+="&"+r+"="+encodeURIComponent(f[r]));var p=p.substring(1),b=e.ie?"<object "+n+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+o+'<param name="movie" value="'+b+'" />'+(p?'<param name="flashVars" value="'+p+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+b+"' "+n+">"+o+(p?'<param name="flashVars" value="'+p+'"/>':"")+"</object>",u=d.holder;u||(u=(new j("<div style='"+(d.style?d.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,c)).appendTo(c.body),
setTimeout(function(){u.offset({left:i.scrollLeft(),top:i.scrollTop()})},100));u.html(b);return c.getElementById(a.id)}};return f});
KISSY.add("editor/plugin/flash/index",function(g,i,j,e){return{init:function(f){var b=f.htmlDataProcessor;b.dataFilter.addRules({tags:{object:function(a){var c;if(!a.getAttribute("classid")){var d=a.childNodes;for(c=0;c<d.length;c++)if("embed"==d[c].nodeName)if(e.isFlashEmbed(d[c][c]))break;else return b.createFakeParserElement(a,"ke_flash","flash",!0);return null}return b.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return e.isFlashEmbed(a)?b.createFakeParserElement(a,"ke_flash",
"flash",!0):null}}},5);var d=f.get("pluginConfig").flash||{},c=new j({editor:f,cls:"ke_flash",type:"flash",bubbleId:"flash",contextMenuId:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&c.show(a)}}});!1!==d.btn&&f.addButton("flash",{tooltip:"\u63d2\u5165Flash",listeners:{click:function(){c.show()}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/focusFix/index",function(g,i){function j(){var d=this._focusEditor=b.currentInstance();if(f.ie&&d){window.focus();document.body.focus();var c=d.get("document")[0].selection.createRange();c&&c.item&&c.item(0).ownerDocument==d.get("document")[0]&&(d=document.body.createTextRange(),d.moveToElementText(this.get("el").first()[0]),d.collapse(!0),d.select())}}function e(){var b=this._focusEditor;b&&b.focus()}var f=g.UA,b=i.focusManager;return{init:function(b){b.on("beforeVisibleChange",
function(c){c.newVal&&j.call(b)});b.on("hide",function(){e.call(b)})}}},{requires:["editor"]});KISSY.add("editor/plugin/fontFamily/cmd",function(g,i,j){var e={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(f){j.addSelectCmd(f,"fontFamily",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(g,i,j,e){return{init:function(f){e.init(f);var b=f.get("pluginConfig").fontFamily,b=b||{};g.mix(b,{children:[{content:"\u5b8b\u4f53",value:"SimSun"},{content:"\u9ed1\u4f53",value:"SimHei"},{content:"\u96b6\u4e66",value:"LiSu"},{content:"\u6977\u4f53",value:"KaiTi_GB2312"},{content:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{content:"Georgia",value:"Georgia"},{content:"Times New Roman",value:"Times New Roman"},{content:"Impact",value:"Impact"},{content:"Courier New",value:"Courier New"},{content:"Arial",
value:"Arial"},{content:"Verdana",value:"Verdana"},{content:"Tahoma",value:"Tahoma"}],width:"130px"},!1);g.each(b.children,function(b){var c=b.elAttrs||{},a=b.value;c.style=c.style||"";c.style+=";font-family:"+a;b.elAttrs=c});f.addSelect("fontFamily",{cmdType:"fontFamily",defaultCaption:"\u5b57\u4f53",width:130,mode:i.WYSIWYG_MODE,menu:{width:b.width,children:b.children}},j.Select)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(g,i,j){var e={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(f){j.addSelectCmd(f,"fontSize",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(g,i,j,e){return{init:function(f){e.init(f);var b=f.get("pluginConfig").fontSize,b=b||{};g.mix(b,{children:function(b){var c=[];g.each(b,function(a){c.push({content:a,value:a})});return c}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(",")),width:"55px"},!1);f.addSelect("fontSize",{cmdType:"fontSize",defaultCaption:"\u5927\u5c0f",width:"55px",mode:i.WYSIWYG_MODE,menu:{width:b.width,children:b.children}},j.Select)}}},{requires:["editor","../font/ui",
"./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(g,i){var j=i.Utils.getQueryCmd;return{addButtonCmd:function(e,f,b){var d=j(f);e.hasCommand(f)||(e.addCommand(f,{exec:function(c,a){var d=c.get("document")[0];c.execCommand("save");a||void 0===a?b.apply(d):b.remove(d);c.execCommand("save");c.notifySelectionChange()}}),e.addCommand(d,{exec:function(c,a){return b.checkActive(a)}}))},addSelectCmd:function(e,f,b){var d=j(f);e.hasCommand(f)||(e.addCommand(f,{exec:function(c,a,d){var a=new i.Style(b,{value:a}),
e=c.get("document")[0];c.execCommand("save");void 0===d||d?a.apply(e):a.remove(e);c.execCommand("save")}}),e.addCommand(d,{exec:function(c,a,d){return(new i.Style(b,{value:a})).checkElementRemovable(d,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(g,i,j,e){var f=i.Utils.getQueryCmd,g=e.Select.extend({initializer:function(){var b=this,d=b.get("editor");b.on("click",function(c){var a=c.target.get("value"),e=b.get("cmdType"),c=c.prevTarget&&c.prevTarget.get("value");d.focus();a==c?d.execCommand(e,a,!1):d.execCommand(e,a)});d.on("selectionChange",function(c){if(d.get("mode")!=i.SOURCE_MODE){var a=c.path,c=f(b.get("cmdType")),e=b.get("menu"),e=e.get&&e.get("children"),a=a.elements;if(e){for(var g=0,j;g<
a.length;g++){j=a[g];for(var o=0;o<e.length;o++){var p=e[o].get("value");if(d.execCommand(c,p,j)){b.set("value",p);return}}}b.set("value",null)}}})}});return{Button:j.Toggle.extend({initializer:function(){var b=this,d=b.get("editor"),c=b.get("cmdType");b.on("click",function(){b.get("checked")?d.execCommand(c):d.execCommand(c,!1);d.focus()});d.on("selectionChange",function(a){if(d.get("mode")!=i.SOURCE_MODE){var c=f(b.get("cmdType"));d.execCommand(c,a.path)?b.set("checked",!0):b.set("checked",!1)}})}},
{ATTRS:{mode:{value:i.WYSIWYG_MODE}}}),Select:g}},{requires:["editor","../button/","../menubutton/"]});KISSY.add("editor/plugin/foreColor/cmd",function(g,i){var j={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(e){return!("a"==e.nodeName()||e.all("a").length)}};return{init:function(e){e.hasCommand("foreColor")||e.addCommand("foreColor",{exec:function(e,b){e.execCommand("save");i.applyColor(e,b,j);e.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("foreColor",{cmdType:"foreColor",tooltip:"\u6587\u672c\u989c\u8272"},j)}}},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(g,i){return{init:function(g){if(!g.hasCommand("heading")){g.addCommand("heading",{exec:function(e,b){e.execCommand("save");(new i.Style({element:b})).apply(e.get("document")[0]);e.execCommand("save")}});var e=i.Utils.getQueryCmd("heading");g.addCommand(e,{exec:function(e,b,d){return(new i.Style({element:d})).checkActive(b)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(g,i,j){return{init:function(e){j.init(e);var f=[],b={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},d={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},c;for(c in b)b.hasOwnProperty(c)&&f.push({content:c,value:b[c],elAttrs:{style:"font-size:"+d[b[c]]}});e.addSelect("heading",{defaultCaption:"\u6807\u9898",width:"120px",menu:{width:"120px",children:f},mode:i.WYSIWYG_MODE,listeners:{click:function(a){var b=
a.target.get("value"),a=a.prevTarget&&a.prevTarget.get("value");b!=a?e.execCommand("heading",b):(e.execCommand("heading","p"),this.set("value","p"))},afterSyncUI:function(){e.on("selectionChange",function(a){if(e.get("mode")!=i.SOURCE_MODE){var a=a.path,b=i.Utils.getQueryCmd("heading"),c;for(c in d)if(d.hasOwnProperty(c)&&e.execCommand(b,a,c)){this.set("value",c);break}}})}}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(g,i,j,e,f,b){var d=g.UA,c=g.Node,a=g.all,l=g.Event,m=function(b){b=a(b);if("img"===b.nodeName()&&!/(^|\s+)ke_/.test(b[0].className))return b};return{init:function(e){function f(a){b.useDialog(e,"image",a)}e.addButton("image",{tooltip:"\u63d2\u5165\u56fe\u7247",listeners:{click:function(){f(null)}},mode:i.WYSIWYG_MODE});var j=[{content:"\u56fe\u7247\u5c5e\u6027",fn:function(){var b=m(this.get("editorSelectedEl"));b&&(this.hide(),f(a(b)))}},{content:"\u63d2\u5165\u65b0\u884c",fn:function(){this.hide();var a=e.get("document")[0],
b=new c(a.createElement("p"));d.ie||b._4e_appendBogus(void 0);a=new i.Range(a);a.setStartAfter(this.get("editorSelectedEl"));a.select();e.insertElement(b);a.moveToElementEditablePosition(b,1);a.select()}}],h=[];g.each(j,function(a){h.push({content:a.content})});e.addContextMenu("image",m,{width:120,children:h,listeners:{click:function(a){var b=this,c=a.target.get("content");g.each(j,function(a){a.content==c&&a.fn.call(b)})}}});e.docReady(function(){l.on(e.get("document")[0],"dblclick",function(b){b.halt();
b=a(b.target);m(b)&&f(b)})});e.addBubble("image",m,{listeners:{afterRenderUI:function(){var a=this,b=a.get("contentEl");b.html('<a class="ks-editor-bubble-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ks-editor-bubble-link ks-editor-bubble-change" href="#">\u7f16\u8f91</a>  |  <a class="ks-editor-bubble-link ks-editor-bubble-remove" href="#">\u5220\u9664</a>');var c=b.one(".ks-editor-bubble-url"),h=b.one(".ks-editor-bubble-change"),g=b.one(".ks-editor-bubble-remove");i.Utils.preventFocus(b);h.on("click",function(b){f(a.get("editorSelectedEl"));
b.halt()});g.on("click",function(b){if(d.webkit){var c=e.getSelection().getRanges();c&&c[0]&&(c[0].collapse(),c[0].select())}a.get("editorSelectedEl").remove();a.hide();e.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");b&&(b=b.attr("_ke_saved_src")||b.attr("src"),c.attr("href",b))})}}})}}},{requires:["editor","../button/","../bubble/","../contextmenu/","../dialogLoader/"]});
KISSY.add("editor/plugin/indent/cmd",function(g,i,j){var e=j.addCommand;return{init:function(f){e(f,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(g,i,j){return{init:function(e){j.init(e);e.addButton("indent",{tooltip:"\u589e\u52a0\u7f29\u8fdb\u91cf ",listeners:{click:function(){e.execCommand("indent");e.focus()}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(g,i,j){var e=new i.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(f){j.addButtonCmd(f,"italic",e)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("italic",{cmdType:"italic",tooltip:"\u659c\u4f53 "},j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(g,i){return{init:function(g){i.addCommand(g,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(g,i,j){function e(){var e=this.get("editor");e.execCommand("justifyCenter");e.focus()}return{init:function(f){j.init(f);f.addButton("justifyCenter",{tooltip:"\u5c45\u4e2d\u5bf9\u9f50",checkable:!0,listeners:{click:e,afterSyncUI:function(){var b=this;f.on("selectionChange",function(d){if(f.get("mode")!=i.SOURCE_MODE){var c=i.Utils.getQueryCmd("justifyCenter");f.execCommand(c,d.path)?b.set("checked",!0):b.set("checked",!1)}})}},mode:i.WYSIWYG_MODE})}}},{requires:["editor",
"./cmd"]});KISSY.add("editor/plugin/justifyLeft/cmd",function(g,i){return{init:function(g){i.addCommand(g,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(g,i,j){function e(){var e=this.get("editor");e.execCommand("justifyLeft");e.focus()}return{init:function(f){j.init(f);f.addButton("justifyLeft",{tooltip:"\u5de6\u5bf9\u9f50",checkable:!0,listeners:{click:e,afterSyncUI:function(){var b=this;f.on("selectionChange",function(d){if(f.get("mode")!=i.SOURCE_MODE){var c=i.Utils.getQueryCmd("justifyLeft");f.execCommand(c,d.path)?b.set("checked",!0):b.set("checked",!1)}})}},mode:i.WYSIWYG_MODE})}}},{requires:["editor",
"./cmd"]});KISSY.add("editor/plugin/justifyRight/cmd",function(g,i){return{init:function(g){i.addCommand(g,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(g,i,j){function e(){var e=this.get("editor");e.execCommand("justifyRight");e.focus()}return{init:function(f){j.init(f);f.addButton("justifyRight",{tooltip:"\u53f3\u5bf9\u9f50",checkable:!0,listeners:{click:e,afterSyncUI:function(){var b=this;f.on("selectionChange",function(d){if(f.get("mode")!=i.SOURCE_MODE){var c=i.Utils.getQueryCmd("justifyRight");f.execCommand(c,d.path)?b.set("checked",!0):b.set("checked",!1)}})}},mode:i.WYSIWYG_MODE})}}},{requires:["editor",
"./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(g,i){var j=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(e,f,b){e.hasCommand(f)||(e.addCommand(f,{exec:function(d){d.execCommand("save");for(var c=d.getSelection(),a=c.createBookmarks(),e=c.getRanges(),f,g,i=e.length-1;0<=i;i--){f=e[i].createIterator();for(f.enlargeBr=!0;g=f.getNextParagraph();)g.removeAttr("align"),(g.css("text-align").replace(j,"")||"left")==b?g.css("text-align",""):g.css("text-align",b)}c.selectBookmarks(a);d.execCommand("save");
d.notifySelectionChange()}}),e.addCommand(i.Utils.getQueryCmd(f),{exec:function(d,c){var a=c.block||c.blockLimit;return!a||"body"===a.nodeName()?!1:(a.css("text-align").replace(j,"")||"left")==b}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(g,i,j,e,f){function b(b){b=d(b);return b.closest("a",void 0)}var d=g.all;return{init:function(c){c.addButton("link",{tooltip:"\u63d2\u5165\u94fe\u63a5",listeners:{click:function(){f.useDialog(c,"link",void 0)}},mode:i.WYSIWYG_MODE});c.addBubble("link",b,{listeners:{afterRenderUI:function(){var a=this,b=a.get("contentEl");b.html('<a href=""  target="_blank" class="ks-editor-bubble-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ks-editor-bubble-link ks-editor-bubble-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubble-link ks-editor-bubble-remove">\u53bb\u9664</span>');
var d=b.one(".ks-editor-bubble-url"),g=b.one(".ks-editor-bubble-change"),j=b.one(".ks-editor-bubble-remove");i.Utils.preventFocus(b);g.on("click",function(b){var d=a.get("editorSelectedEl");f.useDialog(c,"link",d);b.halt()});j.on("click",function(b){e.removeLink(c,a.get("editorSelectedEl"));b.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");b&&(b=b.attr(e._ke_saved_href)||b.attr("href"),d.html(b),d.attr("href",b))})}}})}}},{requires:["editor","../bubble/","./utils","../dialogLoader/",
"../button/"]});
KISSY.add("editor/plugin/link/utils",function(g,i){var j=g.Node,e=i.Style,f={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(b,d){b.execCommand("save");var c=b.getSelection(),a=c.getRanges()[0];if(a&&a.collapsed)a=c.createBookmarks(),d._4e_remove(!0),c.selectBookmarks(a);else if(a){for(var c=d[0],a=c.attributes,g={},i=0;i<a.length;i++){var j=a[i];j.specified&&(g[j.name]=j.value)}c.style.cssText&&(g.style=c.style.cssText);
(new e(f,g)).remove(b.get("document")[0])}b.execCommand("save");b.notifySelectionChange()},applyLink:function(b,d,c){d._ke_saved_href=d.href;c?(b.execCommand("save"),c.attr(d)):(c=(c=b.getSelection())&&c.getRanges()[0],!c||c.collapsed?(d=new j("<a>"+d.href+"</a>",d,b.get("document")[0]),b.insertElement(d)):(b.execCommand("save"),(new e(f,d)).apply(b.get("document")[0])));b.execCommand("save");b.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(g,i,j){function e(){var e=this.get("editor"),b=this.get("cmdType");e.execCommand(b);e.focus()}return j.Toggle.extend({initializer:function(){var f=this;f.on("click",e,f);var b=f.get("editor");b.on("selectionChange",function(d){var c=i.Utils.getQueryCmd(f.get("cmdType"));b.execCommand(c,d.path)?f.set("checked",!0):f.set("checked",!1)})}},{ATTRS:{mode:{value:i.WYSIWYG_MODE}}})},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(g,i,j,e){function f(a){this.type=a}function b(a,b){var c,e,f=b.blockLimit,g=b.elements;if(!f)return!1;if(g)for(var i=0;i<g.length&&(c=g[i])&&c[0]!==f[0];i++)if(d[e=c.nodeName()]&&e==a)return!0;return!1}var d={ol:"insertOrderedList",ul:"insertUnorderedList"},c=i.RANGE,a=i.ElementPath,l=i.Walker,m=g.UA,n=g.Node,o=g.DOM,p=/^h[1-6]$/;f.prototype={changeListType:function(a,b,c,d){for(var f=j.listToArray(b.root,c,e,e,e),g=[],a=0;a<b.contents.length;a++){var i=
b.contents[a];if((i=i.closest("li",e))&&i[0]&&!i.data("list_item_processed"))g.push(i),i._4e_setMarker(c,"list_item_processed",!0,e)}i=new n(b.root[0].ownerDocument.createElement(this.type));for(a=0;a<g.length;a++){var m=g[a].data("listarray_index");f[m].parent=i}for(var c=j.arrayToList(f,c,null,"p"),l,f=c.listNode.childNodes.length,a=0;a<f&&(l=new n(c.listNode.childNodes[a]));a++)l.nodeName()==this.type&&d.push(l);b.root.before(c.listNode);b.root.remove()},createList:function(a,b,c){var d=b.contents,
a=b.root[0].ownerDocument,f=[];if(1==d.length&&d[0][0]===b.root[0]){var g=new n(a.createElement("div"));d[0][0].nodeType!=o.TEXT_NODE&&d[0]._4e_moveChildren(g,e,e);d[0][0].appendChild(g[0]);d[0]=g}b=b.contents[0].parent();for(g=0;g<d.length;g++)b=b._4e_commonAncestor(d[g].parent(),e);for(g=0;g<d.length;g++)for(var i=d[g],j;j=i.parent();){if(j[0]===b[0]){f.push(i);break}i=j}if(!(1>f.length)){d=new n(f[f.length-1][0].nextSibling);g=new n(a.createElement(this.type));for(c.push(g);f.length;)c=f.shift(),
i=new n(a.createElement("li")),p.test(c.nodeName())?i[0].appendChild(c[0]):(c._4e_copyAttributes(i,e,e),c._4e_moveChildren(i,e,e),c.remove()),g[0].appendChild(i[0]),m.ie||i._4e_appendBogus(e);d[0]?g.insertBefore(d,e):b.append(g)}},removeList:function(a,b,c){function d(c){if((y=new n(p[c?"firstChild":"lastChild"]))&&!(y[0].nodeType==o.ELEMENT_NODE&&y._4e_isBlockBoundary(e,e))&&(w=b.root[c?"prev":"next"](l.whitespaces(!0),1))&&!(y[0].nodeType==o.ELEMENT_NODE&&w._4e_isBlockBoundary({br:1},e)))y[c?"before":
"after"](a.get("document")[0].createElement("br"))}for(var f=j.listToArray(b.root,c,e,e,e),g=[],i=0;i<b.contents.length;i++){var m=b.contents[i];if((m=m.closest("li",e))&&!m.data("list_item_processed"))g.push(m),m._4e_setMarker(c,"list_item_processed",!0,e)}m=null;for(i=0;i<g.length;i++)m=g[i].data("listarray_index"),f[m].indent=-1;for(i=m+1;i<f.length;i++)if(f[i].indent>Math.max(f[i-1].indent,0)){g=f[i-1].indent+1-f[i].indent;for(m=f[i].indent;f[i]&&f[i].indent>=m;)f[i].indent+=g,i++;i--}var p=j.arrayToList(f,
c,null,"p").listNode,y,w;d(!0);d(e);b.root.before(p);b.root.remove()},exec:function(f){var g=f.getSelection(),j=g&&g.getRanges();if(j&&!(1>j.length)){for(var m=g.getStartElement(),m=new i.ElementPath(m),n=b(this.type,m),m=g.createBookmarks(!0),p=[],q={};0<j.length;){var t=j.shift(),v=t.getBoundaryNodes(),y=v.startNode,w=v.endNode;y[0].nodeType==o.ELEMENT_NODE&&"td"==y.nodeName()&&t.setStartAt(v.startNode,c.POSITION_AFTER_START);w[0].nodeType==o.ELEMENT_NODE&&"td"==w.nodeName()&&t.setEndAt(v.endNode,
c.POSITION_BEFORE_END);t=t.createIterator();for(t.forceBrBreak=!1;v=t.getNextParagraph();)if(!v.data("list_block")){v._4e_setMarker(q,"list_block",1,e);for(var w=new a(v),z=w.elements,B=null,C=!1,B=w.blockLimit,A,y=z.length-1;0<=y&&(A=z[y]);y--)if(d[A.nodeName()]&&B.contains(A)){B.removeData("list_group_object");(y=A.data("list_group_object"))?y.contents.push(v):(y={root:A,contents:[v]},p.push(y),A._4e_setMarker(q,"list_group_object",y,e));C=!0;break}C||(w=B||w.block,w.data("list_group_object")?w.data("list_group_object").contents.push(v):
(y={root:w,contents:[v]},w._4e_setMarker(q,"list_group_object",y,e),p.push(y)))}}for(j=[];0<p.length;)y=p.shift(),n?d[y.root.nodeName()]&&this.removeList(f,y,q):d[y.root.nodeName()]?this.changeListType(f,y,q,j):(i.Utils.clearAllMarkers(q),this.createList(f,y,j));for(var F=this,y=0;y<j.length;y++)B=j[y],f=function(a,b){var c=b[a?"prev":"next"](l.whitespaces(!0),1);c&&c[0]&&c.nodeName()==F.type&&(c.remove(),c._4e_moveChildren(b,a?!0:!1,e))},f(e,B),f(!0,B);i.Utils.clearAllMarkers(q);g.selectBookmarks(m)}}};
new f("ul");new f("ol");return{ListCommand:f,queryActive:b}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(g){var i={ol:1,ul:1},j=g.Node,e=g.DOM,f=g.UA,b={listToArray:function(d,c,a,f,g){if(!i[d.nodeName()])return[];f||(f=0);a||(a=[]);for(var n=0,o=d[0].childNodes.length;n<o;n++){var p=new j(d[0].childNodes[n]);if("li"==p.nodeName()){var h={parent:d,indent:f,element:p,contents:[]};g?h.grandparent=g:(h.grandparent=d.parent(),h.grandparent&&"li"==h.grandparent.nodeName()&&(h.grandparent=h.grandparent.parent()));c&&p._4e_setMarker(c,"listarray_index",a.length,
void 0);a.push(h);for(var k=0,r=p[0].childNodes.length,u;k<r;k++)u=new j(p[0].childNodes[k]),u[0].nodeType==e.ELEMENT_NODE&&i[u.nodeName()]?b.listToArray(u,c,a,f+1,h.grandparent):h.contents.push(u)}}return a},arrayToList:function(d,c,a,g){a||(a=0);if(!d||d.length<a+1)return null;for(var m=d[a].parent[0].ownerDocument,n=m.createDocumentFragment(),o=null,p=a,h=Math.max(d[a].indent,0),k=null;;){var r=d[p];if(r.indent==h){if(!o||d[p].parent.nodeName()!=o.nodeName())o=d[p].parent.clone(!1),n.appendChild(o[0]);
for(var k=o[0].appendChild(r.element.clone(!1)[0]),u=0;u<r.contents.length;u++)k.appendChild(r.contents[u].clone(!0)[0]);p++}else if(r.indent==Math.max(h,0)+1)p=b.arrayToList(d,null,p,g),k.appendChild(p.listNode),p=p.nextIndex;else if(-1==r.indent&&!a&&r.grandparent){i[r.grandparent.nodeName()]?k=r.element.clone(!1)[0]:"td"!=r.grandparent.nodeName()?(k=m.createElement(g),r.element._4e_copyAttributes(new j(k))):k=m.createDocumentFragment();for(u=0;u<r.contents.length;u++)o=r.contents[u].clone(!0),
k.nodeType==e.DOCUMENT_FRAGMENT_NODE&&r.element._4e_copyAttributes(new j(o)),k.appendChild(o[0]);k.nodeType==e.DOCUMENT_FRAGMENT_NODE&&p!=d.length-1&&(k.lastChild&&k.lastChild.nodeType==e.ELEMENT_NODE&&"_moz"==k.lastChild.getAttribute("type")&&e._4e_remove(k.lastChild),e._4e_appendBogus(k));k.nodeType==e.ELEMENT_NODE&&e.nodeName(k)==g&&k.firstChild&&(e._4e_trim(k),o=k.firstChild,o.nodeType==e.ELEMENT_NODE&&e._4e_isBlockBoundary(o)&&(o=m.createDocumentFragment(),e._4e_moveChildren(k,o),k=o));o=e.nodeName(k);
!f.ie&&("div"==o||"p"==o)&&e._4e_appendBogus(k);n.appendChild(k);o=null;p++}else return null;if(d.length<=p||Math.max(d[p].indent,0)<h)break}if(c)for(d=new j(n.firstChild);d&&d[0];)d[0].nodeType==e.ELEMENT_NODE&&d._4e_clearMarkers(c,!0),d=d._4e_nextSourceNode();return{listNode:n,nextIndex:p}}};return b},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(g,i,j,e){if(!g.UA.ie&&window.localStorage)return window.localStorage;var f=i.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),b=new e({movie:f,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});b.swf.height=138;var d=new j({width:"0px",prefixCls:"ks-editor-",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",
zIndex:i.baseZIndex(i.zIndexManager.STORE_FLASH_SHOW)});d.render();d.get("contentEl").append(b.swf);d.center();d.show();b.on("pending",function(){d.set("width",215);d.center();d.show();setTimeout(function(){b.retrySave()},1E3)});b.on("save",function(){d.set("width",0)});var c=b.setItem;g.mix(b,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,b){this.lastSave={k:a,v:b};c.call(this,a,b)}});b.on("contentReady",
function(){b._ready=1});return b},{attach:!1,requires:["editor","overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(g,i){function j(a){this.editor=a}var e=g.UA,f=e.ie,b=document,d=g.Node,c=g.Event,a=g.DOM,l;g.augment(j,{restoreWindow:function(){var a=this,b=a.editor;!1!==b.fire("beforeRestoreWindow")&&a._resize&&(c.remove(window,"resize",a._resize),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("restoreWindow")},30))},_restoreState:function(){var c=this.editor,d=this._savedParents;
if(d){for(var e=0;e<d.length;e++){var g=d[e];g.el.css("position",g.position)}this._savedParents=null}c.get("iframeWrapEl").css({height:this.iframeHeight});c.get("textarea").css({height:this.iframeHeight});a.css(b.body,{width:"",height:"",overflow:""});b.documentElement.style.overflow="";c=c.get("el")[0].style;c.position="static";c.width=this.editorElWidth;l.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>f&&this.editor.get("toolBarEl").removeClass("ks-editor-toolbar-padding",
void 0)},_saveSate:function(){var b=this.editor,c=[],d=b.get("el");this.iframeHeight=b.get("iframeWrapEl").style("height");this.editorElWidth=d.style("width");this.scrollLeft=a.scrollLeft();this.scrollTop=a.scrollTop();window.scrollTo(0,0);for(b=d.parent();b;)d=b.css("position"),"static"!=d&&(c.push({el:b,position:d}),b.css("position","static")),b=b.parent();this._savedParents=c;8>f&&this.editor.get("toolBarEl").addClass("ks-editor-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;
this.savedRanges=null;e.gecko&&a.__iframeFocus&&(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;e.gecko&&a.activateGecko();c&&b&&b.selectRanges(c);a.__iframeFocus&&b&&(a=b.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(c){var d=this.editor,e=d.get("el"),g=a.viewportHeight(),h=a.viewportWidth(),j=d.get("statusBarEl")?d.get("statusBarEl")[0].offsetHeight:0,r=d.get("toolBarEl")[0].offsetHeight;
f?b.body.style.overflow="hidden":a.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:i.baseZIndex(i.zIndexManager.MAXIMIZE),width:h+"px"});l.css({zIndex:i.baseZIndex(i.zIndexManager.MAXIMIZE-5),height:g+"px",width:h+"px"});e.offset({left:0,top:0});l.css({left:0,top:0});d.get("iframeWrapEl").css({height:g-j-r+"px"});d.get("textarea").css({height:g-j-r+"px"});!0!==c&&arguments.callee.call(this,!0)},_real:function(){var a=this,
b=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=g.buffer(function(){a._maximize();b.fire("maximizeWindow")},100)),c.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(l||(l=(new d("<iframe  class='ks-editor-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(b.body,
void 0)),this._real())},destroy:function(){this._resize&&(c.remove(window,"resize",this._resize),this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var b=new j(a);a.addCommand("maximizeWindow",{exec:function(){b.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){b.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(g,i,j){return{init:function(e){j.init(e);e.addButton("maximize",{tooltip:"\u5168\u5c4f",listeners:{click:function(){this.get("checked")?(e.execCommand("maximizeWindow"),this.set("tooltip","\u53d6\u6d88\u5168\u5c4f"),this.set("contentCls","restore")):(e.execCommand("restoreWindow"),this.set("tooltip","\u5168\u5c4f"),this.set("contentCls","maximize"));e.focus()}},checkable:!0})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/menubutton/index",function(g,i,j){i.prototype.addSelect=function(e,f,b){var b=b||j.Select,d=this.get("prefixCls")+"editor-";f&&(f.editor=this,f.menu&&(f.menu.zIndex=i.baseZIndex(i.zIndexManager.SELECT),f.menu.xclass="popupmenu",g.each(f.menu.children,function(a){a.xclass="option"})));var c=new b(g.mix({elAttrs:{hideFocus:"hideFocus"},render:this.get("toolBarEl"),prefixCls:d,autoRender:!0},f));c.get("el").unselectable();f.mode==i.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){c.set("disabled",
false)}),this.on("sourceMode",function(){c.set("disabled",true)}));this.addControl(e+"/select",c);return c};return j},{requires:["editor","menubutton"]});KISSY.add("editor/plugin/multipleUpload/index",function(g,i,j){return{init:function(e){e.addButton("multipleUpload",{tooltip:"\u6279\u91cf\u63d2\u56fe",listeners:{click:function(){j.useDialog(e,"multipleUpload")}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/orderedList/cmd",function(g,i,j){var e=j.queryActive,f=new j.ListCommand("ol");return{init:function(b){b.hasCommand("insertOrderedList")||b.addCommand("insertOrderedList",{exec:function(b){f.exec(b)}});var d=i.Utils.getQueryCmd("insertOrderedList");b.hasCommand(d)||b.addCommand(d,{exec:function(b,a){return e("ol",a)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/orderedList/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("orderedList",{cmdType:"insertOrderedList",mode:i.WYSIWYG_MODE},j)}}},{requires:["editor","../listUtils/btn","./cmd"]});KISSY.add("editor/plugin/outdent/cmd",function(g,i,j){var e=j.addCommand,f=j.checkOutdentActive;return{init:function(b){e(b,"outdent");var d=i.Utils.getQueryCmd("outdent");b.hasCommand(d)||b.addCommand(d,{exec:function(b,a){return f(a)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(g,i,j){return{init:function(e){j.init(e);var f=i.Utils.getQueryCmd("outdent");e.addButton("outdent",{tooltip:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",listeners:{click:function(){e.execCommand("outdent");e.focus()},afterSyncUI:function(){var b=this;e.on("selectionChange",function(d){e.get("mode")!=i.SOURCE_MODE&&(e.execCommand(f,d.path)?b.set("disabled",!1):b.set("disabled",!0))})}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/index",function(g,i,j,e){var f=j.extend({bindUI:function(){e.init(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:i.baseZIndex(i.zIndexManager.OVERLAY)}}});f.Dialog=j.Dialog.extend({bindUI:function(){e.init(this)},show:function(){this.center();var b=this.get("y");200<b-g.DOM.scrollTop()&&(b=g.DOM.scrollTop()+200,this.set("y",b));f.prototype.show.call(this)}},{ATTRS:{elAttrs:{value:{hideFocus:"hideFocus"}},prefixCls:{value:"ks-editor-"},zIndex:{value:i.baseZIndex(i.zIndexManager.OVERLAY)},
draggable:{value:!0},constrain:{value:!0},aria:{value:!0}}});return f},{requires:["editor","overlay","../focusFix/","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(g,i,j){var e=g.Node;return{init:function(f){j.init(f);var b=f.htmlDataProcessor;(b&&b.dataFilter).addRules({tags:{div:function(d){var c=d.getAttribute("style"),a;if(c)for(var e=d.childNodes,f=0;f<e.length;f++)1==e[f].nodeType&&(a=e[f]);if((a=a&&"span"==a.nodeName&&a.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(c)&&/display\s*:\s*none/i.test(a))return b.createFakeParserElement(d,"ke_pagebreak","div")}}});f.addButton("pageBreak",{tooltip:"\u5206\u9875",
listeners:{click:function(){var b=new e('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,f.get("document")[0]),b=f.createFakeElement(b,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),c=f.getSelection();if(c=c&&c.getRanges()[0]){f.execCommand("save");for(var a=c.startContainer,g=a;"body"!==a.nodeName();)g=a,a=a.parent();c.collapse(!0);c.splitElement(g);b.insertAfter(g);f.execCommand("save")}}},
mode:i.WYSIWYG_MODE})}}},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(){var g=window;return{init:function(i){i.addButton("preview",{tooltip:"\u9884\u89c8",listeners:{click:function(){try{var j=g.screen,e=Math.round(0.8*j.width),f=Math.round(0.7*j.height),b=Math.round(0.1*j.width)}catch(d){e=640,f=420,b=80}j=i.getDocHtml().replace(/\${title}/,"\u9884\u89c8");e=g.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+e+",height="+f+",left="+b);f=e.document;f.open();f.write(j);f.close();e.focus()}}})}}});
KISSY.add("editor/plugin/progressbar/index",function(g){function i(){i.superclass.constructor.apply(this,arguments);this._init()}var j=g.Node;i.ATTRS={container:{},width:{},height:{},progress:{value:0}};g.extend(i,g.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var e=this.get("height"),f=new j("<div class='ks-editor-progressbar'  style='width:"+this.get("width")+";height:"+e+";'></div>"),b=this.get("container"),e=(new j("<div style='overflow:hidden;'><div class='ks-editor-progressbar-inner' style='height:"+
(parseInt(e)-4)+"px'><div class='ks-editor-progressbar-inner-bg'></div></div></div>")).appendTo(f),d=(new j("<span class='ks-editor-progressbar-title'></span>")).appendTo(f);b&&f.appendTo(b);this.el=f;this._title=d;this._p=e;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(e){e=e.newVal;this._p.css("width",e+"%");this._title.html(e+"%")}});return i});
KISSY.add("editor/plugin/removeFormat/cmd",function(g,i){function j(a,b){for(var c=0;c<b.length;c++)a.removeAttr(b[c])}var e=i.RANGE,f=i.ElementPath,b=g.DOM,d="class,style,lang,width,height,align,hspace,valign".split(/,/),c=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(a){a.hasCommand("removeFormat")||a.addCommand("removeFormat",{exec:function(){a.focus();c.lastIndex=0;var g=a.getSelection().getRanges();
a.execCommand("save");for(var i=0,n;n=g[i];i++)if(!n.collapsed){n.enlarge(e.ENLARGE_ELEMENT);var o=n.createBookmark(),p=o.startNode,h=o.endNode,k=function(a){for(var b=new f(a),d=b.elements,e=1,g;(g=d[e])&&!g.equals(b.block)&&!g.equals(b.blockLimit);e++)c.test(g.nodeName())&&a._4e_breakParent(g)};k(p);k(h);for(p=p._4e_nextSourceNode(!0,b.ELEMENT_NODE,void 0,void 0);p&&!p.equals(h);)k=p._4e_nextSourceNode(!1,b.ELEMENT_NODE,void 0,void 0),"img"==p.nodeName()&&p.attr("_ke_realelement")||(c.test(p.nodeName())?
p._4e_remove(!0):j(p,d)),p=k;n.moveToBookmark(o)}a.getSelection().selectRanges(g);a.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(g,i,j){return{init:function(e){j.init(e);e.addButton("removeFormat",{tooltip:"\u6e05\u9664\u683c\u5f0f",listeners:{click:function(){e.execCommand("removeFormat")}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(g,i,j){var e=g.Node;return{init:function(f){var b=j.Draggable,d=f.get("statusBarEl");f.get("textarea");var c=(f.get("pluginConfig").resize||{}).direction||["x","y"],a="se-resize";1==c.length&&(a="x"==c[0]?"e-resize":"s-resize");var i=(new e("<div class='ks-editor-resizer' style='cursor: "+a+"'></div>")).appendTo(d);f.on("maximizeWindow",function(){i.css("display","none")});f.on("restoreWindow",function(){i.css("display","")});var m=new b({node:i}),n=
0,o=0,p=f.get("el"),h=f.get("el");m.on("dragstart",function(){n=p.height();o=h.width();f.fire("resizeStart")});m.on("drag",function(a){var b=a.left-this.startNodePos.left,a=a.top-this.startNodePos.top;g.inArray("y",c)&&f.set("height",n+a);g.inArray("x",c)&&f.set("width",o+b);f.fire("resize")});f.on("destroy",function(){m.destroy();i.remove()})}}},{requires:["editor","dd"]});
KISSY.add("editor/plugin/separator/index",function(g){return{init:function(i){(new g.Node('<span class="ks-editor-toolbar-separator">&nbsp;</span>')).appendTo(i.get("toolBarEl"))}}},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(g,i,j){for(var e="<div class='ks-editor-smiley-sprite'>",f=0;98>=f;f++)e+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+f+".gif'></a>";e+="</div>";return{init:function(b){b.addButton("smiley",{tooltip:"\u63d2\u5165\u8868\u60c5",checkable:!0,listeners:{afterSyncUI:function(){var b=this;b.on("blur",function(){setTimeout(function(){b.smiley&&b.smiley.hide()},150)})},click:function(){var d=this,c;if(d.get("checked")){if(!(c=d.smiley))c=
d.smiley=new j({content:e,focus4e:!1,width:"297px",autoRender:!0,elCls:"ks-editor-popup",zIndex:i.baseZIndex(i.zIndexManager.POPUP_MENU),mask:!1}),c.get("el").on("click",function(a){var a=new g.Node(a.target),c;if("a"==a.nodeName()&&(c=a.attr("data-icon")))c=new g.Node("<img alt='' src='"+c+"'/>",null,b.get("document")[0]),b.insertElement(c)}),c.on("hide",function(){d.set("checked",!1)});c.set("align",{node:this.get("el"),points:["bl","tl"]});c.show()}else d.smiley&&d.smiley.hide()},destroy:function(){this.smiley&&
this.smiley.destroy()}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","../overlay/"]});
KISSY.add("editor/plugin/sourceArea/index",function(g,i){var j=i.SOURCE_MODE,e=i.WYSIWYG_MODE;return{init:function(f){f.addButton("sourceArea",{tooltip:"\u6e90\u7801",listeners:{afterSyncUI:function(){var b=this;f.on("wysiwygMode",function(){b.set("checked",!1)});f.on("sourceMode",function(){b.set("checked",!0)})},click:function(){this.get("checked")?f.set("mode",j):f.set("mode",e);f.focus()}},checkable:!0})}}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(g,i,j){var e=new i.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(f){j.addButtonCmd(f,"strikeThrough",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("strikeThrough",{cmdType:"strikeThrough",tooltip:"\u5220\u9664\u7ebf "},j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(g,i,j){function e(a){function b(a){!(0<e.length)&&a[0].nodeType==p.ELEMENT_NODE&&r.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(f,"selected_cell",!0,void 0),e.push(a))}for(var c=a.createBookmarks(),d=a.getRanges(),e=[],f={},g=0;g<d.length;g++){var h=d[g];if(h.collapsed)h=h.getCommonAncestor(),(h=h.closest("td",void 0)||h.closest("th",void 0))&&e.push(h);else{var h=new Walker(h),j;for(h.guard=b;j=h.next();)if((j=j.parent())&&r.test(j.nodeName())&&
!j.data("selected_cell"))j._4e_setMarker(f,"selected_cell",!0,void 0),e.push(j)}}i.Utils.clearAllMarkers(f);a.selectBookmarks(c);return e}function f(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",o.ie||(new h(c[d]))._4e_appendBogus(void 0)}}function b(a){if(a instanceof i.Selection){for(var c=e(a),d=c.length,a=[],f,g,j=0;j<d;j++){var k=c[j].parent(),l=k[0].rowIndex;!j&&(f=l-1);a[l]=k;j==d-1&&(g=l+
1)}j=k.parent("table");f=new h(g<j[0].rows.length&&j[0].rows[g]||0<f&&j[0].rows[f]||j[0].parentNode);for(j=a.length;0<=j;j--)a[j]&&b(a[j]);return f}a instanceof h&&(j=a.parent("table"),1==j[0].rows.length?j.remove():a.remove());return 0}function d(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),e=c[0].cellIndex,f=0;f<d[0].rows.length;f++){var g=d[0].rows[f];g.cells.length<e+1||(c=new h(g.cells[e].cloneNode(void 0)),o.ie||c._4e_appendBogus(void 0),
g=new h(g.cells[e]),b?c.insertBefore(g):c.insertAfter(g))}}function c(a){if(a instanceof i.Selection){var d=e(a),f,g=[],a=d[0]&&d[0].parent("table"),j,k,l;j=0;for(k=d.length;j<k;j++)g.push(d[j][0].cellIndex);g.sort();j=1;for(k=g.length;j<k;j++)if(1<g[j]-g[j-1]){l=g[j-1]+1;break}l||(l=0<g[0]?g[0]-1:g[g.length-1]+1);g=a[0].rows;j=0;for(k=g.length;j<k&&!(f=g[j].cells[l]);j++);f=f?new h(f):a.prev();for(l=d.length-1;0<=l;l--)d[l]&&c(d[l]);return f}if(a instanceof h){d=a.parent("table");if(!d)return null;
f=a[0].cellIndex;for(l=d[0].rows.length-1;0<=l;l--)a=new h(d[0].rows[l]),!f&&1==a[0].cells.length?b(a):a[0].cells[f]&&a[0].removeChild(a[0].cells[f])}return null}function a(a,b){var c=new i.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function l(a){var b=(a=a.getSelection())&&a.getStartElement(),c=b&&b.closest("table",void 0);if(c)return a=b.closest(function(a){var b=p.nodeName(a);return c.contains(a)&&("td"==
b||"th"==b)},void 0),b=b.closest(function(a){var b=p.nodeName(a);return c.contains(a)&&"tr"==b},void 0),{table:c,td:a,tr:b}}function m(a){return(a=l(a))&&a.td}function n(a){return(a=l(a))&&a.tr}var o=g.UA,p=g.DOM,h=g.Node,k=["tr","th","td","tbody","table"],r=/^(?:td|th)$/,u={"\u8868\u683c\u5c5e\u6027":l,"\u5220\u9664\u8868\u683c":m,"\u5220\u9664\u5217":m,"\u5220\u9664\u884c":n,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":n,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":n,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":m,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":m},x=(6===o.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),s={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},q={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=g.trim(b.replace("ke_show_border","")))}}};return{init:function(e){e.addCustomStyle(x);var h=e.htmlDataProcessor,m=h&&h.htmlFilter;(h&&h.dataFilter).addRules(s);m.addRules(q);var n={"\u8868\u683c\u5c5e\u6027":function(){this.hide();var a=l(e);a&&j.useDialog(e,"table",{selectedTable:a.table,
selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){this.hide();var a=e.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){this.hide();var c=e.getSelection();a(b(c),void 0)},"\u5220\u9664\u5217 ":function(){this.hide();var b=e.getSelection();(b=c(b))&&a(b,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){this.hide();var a=e.getSelection();
f(a,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){this.hide();var a=e.getSelection();f(a,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){this.hide();var a=e.getSelection();d(a,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){this.hide();var a=e.getSelection();d(a,void 0)}},o=[];g.each(n,function(a,b){o.push({content:b})});e.addContextMenu("table",function(a){if(g.inArray(p.nodeName(a),k))return!0},{width:"120px",children:o,listeners:{click:function(a){a=a.target.get("content");n[a]&&n[a].apply(this)},beforeVisibleChange:function(a){if(a.newVal){var b=this,a=b.get("children"),
c=b.get("editor");g.each(a,function(a){var d=a.get("content");!u[d]||u[d].call(b,c)?a.set("disabled",!1):a.set("disabled",!0)})}}}});e.addButton("table",{mode:i.WYSIWYG_MODE,listeners:{click:function(){j.useDialog(e,"table",{selectedTable:0,selectedTd:0})}},tooltip:"\u63d2\u5165\u8868\u683c"})}}},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(g,i,j){var e=new i.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(f){j.addButtonCmd(f,"underline",e)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("underline",{cmdType:"underline",tooltip:"\u4e0b\u5212\u7ebf "},j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(g,i,j){function e(e){e.get("editor").on("afterSave afterRestore",e._respond,e)}g=j.extend({bindUI:function(){e(this);this.on("click",function(){this.get("editor").execCommand("undo")})},_respond:function(e){0<e.index?this.set("disabled",!1):this.set("disabled",!0)}},{ATTRS:{mode:{value:i.WYSIWYG_MODE},disabled:{value:!0}}});return{RedoBtn:j.extend({bindUI:function(){e(this);this.on("click",function(){this.get("editor").execCommand("redo")})},_respond:function(e){e.index<
e.history.length-1?this.set("disabled",!1):this.set("disabled",!0)}},{mode:{value:i.WYSIWYG_MODE},ATTRS:{disabled:{value:!0}}}),UndoBtn:g}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(g,i){function j(a){var b=a.get("document")[0].body.innerHTML,c;b&&(c=a.getSelection());this.contents=b;this.bookmarks=c&&c.createBookmarks2(!0)}function e(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=g.buffer(this.save,500,this);this._init()}var f=i.Utils.arrayCompare,b=g.UA;g.augment(j,{equals:function(a){if(this.contents!=a.contents)return!1;var b=this.bookmarks,a=a.bookmarks;if(b||a){if(!b||!a||b.length!=a.length)return!1;for(var c=
0;c<b.length;c++){var d=b[c],e=a[c];if(d.startOffset!=e.startOffset||d.endOffset!=e.endOffset||!f(d.start,e.start)||!f(d.end,e.end))return!1}}return!0}});var d={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};g.augment(e,{_keyMonitor:function(){var a=this,b=a.editor;b.docReady(function(){b.get("document").on("keydown",function(e){var f=e.keyCode;f in c||f in d||(90===f&&(e.ctrlKey||e.metaKey)?(!1!==b.fire("restore",{direction:-1})&&a.restore(-1),e.halt()):89===f&&(e.ctrlKey||e.metaKey)?(!1!==b.fire("restore",
{direction:1})&&a.restore(1),e.halt()):!1!==b.fire("save",{buffer:1})&&a.save(1))})})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){if(this.editor.get("mode")==i.WYSIWYG_MODE)if(a)this.bufferRunner();else{var a=this.history,b=this.index;a.length>b+1&&a.splice(b+1,a.length-b-1);var c=this.editor,b=a[a.length-1],d=new j(c);if(!b||!b.equals(d))30===a.length&&a.shift(),a.push(d),this.index=b=a.length-1,c.fire("afterSave",{history:a,index:b})}},restore:function(a){if(this.editor.get("mode")==
i.WYSIWYG_MODE){var c=this.history,d=this.editor,e=d.get("document")[0].body,f=c[this.index+a];f&&(e.innerHTML=f.contents,f.bookmarks?d.getSelection().selectBookmarks(f.bookmarks):b.ie&&(e=e.createTextRange(),e.collapse(!0),e.select()),(e=d.getSelection())&&e.scrollIntoView(),this.index+=a,d.fire("afterRestore",{history:c,index:this.index}),d.notifySelectionChange());return f}}});return{init:function(a){if(!a.hasCommand("save")){var b=new e(a);a.addCommand("save",{exec:function(a,c){b.save(c)}});
a.addCommand("undo",{exec:function(){b.restore(-1)}});a.addCommand("redo",{exec:function(){b.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("undo",{mode:i.WYSIWYG_MODE,tooltip:"\u64a4\u9500",editor:f},j.UndoBtn);f.addButton("redo",{mode:i.WYSIWYG_MODE,tooltip:"\u91cd\u505a",editor:f},j.RedoBtn)}}},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/unorderedList/cmd",function(g,i,j){var e=j.queryActive,f=new j.ListCommand("ul");return{init:function(b){b.hasCommand("insertUnorderedList")||b.addCommand("insertUnorderedList",{exec:function(b){f.exec(b)}});var d=i.Utils.getQueryCmd("insertUnorderedList");b.hasCommand(d)||b.addCommand(d,{exec:function(b,a){return e("ul",a)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/unorderedList/index",function(g,i,j,e){return{init:function(f){e.init(f);f.addButton("unorderedList",{cmdType:"insertUnorderedList",mode:i.WYSIWYG_MODE},j)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(g,i,j,e){return{init:function(f){function b(b){for(var c=0;c<a.length;c++){var d=a[c];if(d.reg.test(b))return d}}var d=f.htmlDataProcessor,c=d&&d.dataFilter,a=[],g=f.get("pluginConfig");g.video=g.video||{};g=g.video;g.providers&&a.push.apply(a,g.providers);g.getProvider=b;c&&c.addRules({elements:{object:function(a){var c=a.getAttribute("classid"),e=a.childNodes;if(!c){for(c=0;c<e.length;c++)if("embed"==e[c].name){if(!j.isFlashEmbed(e[c]))break;if(b(e[c].getAttribute("src")))return d.createFakeParserElement(a,
"ke_video","video",!0)}return null}for(c=0;c<e.length;c++){var f=e[c];if("param"==f.nodeName&&"movie"==f.getAttribute("name").toLowerCase()&&b(f.getAttribute("value")))return d.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!j.isFlashEmbed(a))return null;if(b(a.getAttribute("src")))return d.createFakeParserElement(a,"ke_video","video",!0)}}},4);var m=new e({editor:f,cls:"ke_video",type:"video",bubbleId:"video",contextMenuId:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=
this.get("editorSelectedEl");a&&m.show(a)}}});f.addButton("video",{tooltip:"\u63d2\u5165\u89c6\u9891",listeners:{click:function(){m.show()}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(g,i,j,e){function f(){f.superclass.constructor.apply(this,arguments)}g.extend(f,j,{_updateTip:function(b,d){var c=this.get("editor").restoreRealElement(d);c&&(b.html(d.attr("title")),b.attr("href",this._getFlashUrl(c)))}});return{init:function(b){function d(a){return/xiami\.com/i.test(a)}var c=b.htmlDataProcessor,a=c&&c.dataFilter;a&&a.addRules({tags:{object:function(a){var b=a.getAttribute("title"),f,g;f=a.getAttribute("classid");var h=a.childNodes;
if(!f){for(f=0;f<h.length;f++)if(g=h[f],"embed"==g.nodeName){if(!e.isFlashEmbed(g))break;if(d(g.attributes.src))return c.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:b})}return null}for(f=0;f<h.length;f++)if(g=h[f],"param"==g.nodeName&&"movie"==g.getAttribute("name")&&d(g.getAttribute("value")))return c.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:b})},embed:function(a){if(e.isFlashEmbed(a)&&d(a.getAttribute("src")))return c.createFakeParserElement(a,"ke_xiami","xiamiMusic",
!0,{title:a.getAttribute("title")})}}},4);var g=new f({editor:b,cls:"ke_xiami",type:"xiamiMusic",bubbleId:"xiami",contextMenuId:"xiami",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&g.show(a)}}});b.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",listeners:{click:function(){g.show()}},mode:i.WYSIWYG_MODE})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});KISSY.add("editor/full",function(g,i){return i},{requires:["editor"]});
