/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 24 18:37
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(h,k,j,f){k=f.create(j.Controller,[f.Box],{initializer:function(){var c;this.__commands={};this.__dialogs={};if(c=this.get("textarea")){if(!this.get("render")&&!this.get("elBefore")){var a=c.next();a?this.__set("elBefore",a):this.__set("render",c.parent())}}else this.__editor_created_new=1},use:function(c,a){for(var i=this,d=i.__CORE_PLUGINS||["htmlDataProcessor","enterKey","clipboard","selection"],c=c.split(","),g=c.length-1;0<=g;g--)c[g]||c.splice(g,1);for(g=
0;g<d.length;g++){var l=d[g];h.inArray(l,c)||c.unshift(l)}h.each(c,function(a,d){c[d]&&(c[d]="editor/plugin/"+a+"/")});h.use(c.join(","),function(){var d,g=h.makeArray(arguments);g.shift();for(var l=0;l<g.length;l++)g[l].init(i);a&&a.call(i);(d=i.get("height"))&&i._uiSetHeight(d)});i.__CORE_PLUGINS=[];return i}},{Config:{},XHTML_DTD:k.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},iframeWrapEl:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},
data:{getter:function(){return this._getData()},setter:function(c){return this._setData(c)}},formatData:{getter:function(){return this._getData(1)},setter:function(c){return this._setData(c)}},prefixCls:{value:"ke-"}}},"Editor");h.mix(k,h.EventTarget);return KISSY.Editor=k},{requires:["htmlparser","component","uibase","core"]});
KISSY.add("editor/plugin/clipboard/index",function(h){function k(e){this.editor=e;this._init()}function j(b){if(a.ie&&"BackCompat"!=b.get("document")[0].compatMode){var d=b.getSelection(),m;if(d.getType()==e.SELECTION_ELEMENT&&(m=d.getSelectedElement())){var r=d.getRanges()[0],n=new c(b.get("document")[0].createTextNode(""));n.insertBefore(m);r.setStartBefore(n);r.setEndAfter(m);d.selectRanges([r]);setTimeout(function(){m.parent()&&(n.remove(),d.selectElement(m))},0)}}}var f=h.Editor,c=h.Node,a=h.UA,
i=f.Range,d=f.RANGE,g=h.Event;h.augment(k,{_init:function(){var e=this.editor;g.on(e.get("document")[0].body,a.webkit?"paste":a.gecko?"paste":"beforepaste",this._paste,this);g.on(e.get("document")[0].body,"contextmenu",function(){t=1;setTimeout(function(){t=0},10)});e.addCommand("copy",new p("copy"));e.addCommand("cut",new p("cut"));e.addCommand("paste",new p("paste"))},_paste:function(){if(!t){var e=this.editor,b=e.get("document")[0];if(!b.getElementById("ke_pastebin")){var m=e.getSelection(),r=
new i(b),n=new c(a.webkit?"<body></body>":"<div></div>",null,b);n.attr("id","ke_pastebin");a.webkit&&n[0].appendChild(b.createTextNode("\u00a0"));b.body.appendChild(n[0]);n.css({position:"absolute",top:m.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});n.css("left","-1000px");var g=m.createBookmarks();r.setStartAt(n,d.POSITION_AFTER_START);r.setEndAt(n,d.POSITION_BEFORE_END);r.select(!0);setTimeout(function(){n.remove();var b;n=a.webkit&&(b=n.first())&&b.hasClass("Apple-style-span")?
b:n;m.selectBookmarks(g);b=n.html();if(b=h.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var r=e.fire("paste",{html:b,holder:n});void 0!==r&&(b=r);r=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)&&(r=e.htmlDataProcessor.wordFilter);e.insertHtml(b,r)}},0)}}}});var l=function(e,b){var m=e.get("document")[0],r=new c(m.body),n=!1,d=function(){n=!0};r.on(b,d);(7<a.ie?m:m.selection.createRange()).execCommand(b);r.detach(b,d);return n},o=a.ie?function(b,e){return l(b,
e)}:function(b,e){try{return b.get("document")[0].execCommand(e)}catch(m){return!1}},q={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},p=function(b){this.type=b};p.prototype={exec:function(b){"cut"==this.type&&j(b);(b=o(b,this.type))||alert(q[this.type]);return b}};var e=f.Selection,b={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},t;f.on("contextmenu",function(e){var a=e.contextmenu,m=a.get("editor"),
r=a.menu.get("contentEl"),n={copy:0,cut:0,paste:0},d;for(d in n)n.hasOwnProperty(d)&&(n[d]=r.one(".ke-paste-"+d),n[d]||function(e){var d=(new c("<a href='#'class='ke-paste-"+e+"'>"+b[e]+"</a>")).appendTo(r);d.on("click",function(b){b.halt();a.hide();setTimeout(function(){m.execCommand(e)},30)});n[e]=d}(d))});return{init:function(b){b.docReady(function(){new k(b)})}}},{requires:["editor"]});
KISSY.add("editor/core/dom",function(h){function k(e,b){var a=e[b?"next":"prev"]();if(a&&a[0].nodeType==c.ELEMENT_NODE){for(var d=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(j);)if(d.push(a),a=b?a.next():a.prev(),!a)return;if(e._4e_isIdentical(a,j)){for(var g=new i(b?e[0].lastChild:e[0].firstChild);d.length;)d.shift()._4e_move(e,!b,j);a._4e_moveChildren(e,!b,j);a.remove();g[0]&&g[0].nodeType==c.ELEMENT_NODE&&g._4e_mergeSiblings()}}}var j=j,f=h.Editor,c=h.DOM,a=h.UA,i=h.Node,d=f.Utils,
g={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};f.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var l=f.POSITION,o={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},q={hr:1},p=function(e){return e&&(e[0]||e)};d.injectDom({_4e_sameLevel:function(e,b){var b=p(b),a=e.parentNode;return a&&a==b.parentNode},_4e_isBlockBoundary:function(e,b){var a=h.merge(q,b);return!(!o[c.css(e,"display")]&&!a[c.nodeName(e)])},_4e_getWin:c._getWin,_4e_index:function(e,b){for(var a=e.parentNode.childNodes,d,g=-1,m=0;m<a.length;m++)if(d=a[m],!b||!(3==d.nodeType&&d.previousSibling&&3==d.previousSibling.nodeType))if(g++,d===e)return g;return-1},_4e_move:function(e,
b,a){b=p(b);a?b.insertBefore(e,b.firstChild):b.appendChild(e)},_4e_isIdentical:function(e,b){if(!b)return!1;b=p(b);if(c.nodeName(e)!=c.nodeName(b))return!1;var a=e.attributes,g=b.attributes,i=a.length,m=g.length;if(i!=m)return!1;for(var r=0;r<i;r++){var n=a[r],l=n.name;if(n.specified&&c.attr(e,l)!=c.attr(b,l))return!1}if(8>d.ieEngine)for(r=0;r<m;r++)if(n=g[r],l=n.name,n.specified&&c.attr(e,l)!=c.attr(b,l))return!1;return!0},_4e_isEmptyInlineRemovable:function(e){for(var e=e.childNodes,b=0,a=e.length;b<
a;b++){var d=e[b],g=d.nodeType;if(!(g==c.ELEMENT_NODE&&d.getAttribute("_ke_bookmark"))&&(g==c.ELEMENT_NODE&&!c._4e_isEmptyInlineRemovable(d)||g==c.TEXT_NODE&&h.trim(d.nodeValue)))return!1}return!0},_4e_moveChildren:function(e,b,a){b=p(b);if(e!=b)if(a)for(;a=e.lastChild;)b.insertBefore(e.removeChild(a),b.firstChild);else for(;a=e.firstChild;)b.appendChild(e.removeChild(a))},_4e_mergeSiblings:function(e){e=new i(e);g[e.nodeName()]&&(k(e,!0),k(e))},_4e_splitText:function(e,b){var d=e.ownerDocument;if(e.nodeType==
c.TEXT_NODE){if(a.ie&&b==e.nodeValue.length){var g=d.createTextNode("");c.insertAfter(g,e);return g}g=e.splitText(b);d.documentMode&&(d=d.createTextNode(""),c.insertAfter(d,g),c.remove(d));return g}},_4e_parents:function(e,b){var a=[];a.__IS_NODELIST=1;do a[b?"push":"unshift"](e);while(e=e.parentNode);return a},_4e_nextSourceNode:function(e,b,a,d){if(d&&!d.call)var g=p(d),d=function(b){return b!==g};var b=!b&&e.firstChild,m=e;if(!b){if(e.nodeType==c.ELEMENT_NODE&&d&&!1===d(e,!0))return null;b=e.nextSibling}for(;!b&&
(m=m.parentNode);){if(d&&!1===d(m,!0))return null;b=m.nextSibling}return!b||d&&!1===d(b)?null:a&&a!=b.nodeType?c._4e_nextSourceNode(b,!1,a,d):b},_4e_previousSourceNode:function(e,b,a,d){if(d&&!d.call)var g=p(d),d=function(b){return b!==g};var b=!b&&e.lastChild,m=e;if(!b){if(e.nodeType==c.ELEMENT_NODE&&d&&!1===d(e,!0))return null;b=e.previousSibling}for(;!b&&(m=m.parentNode);){if(d&&!1===d(m,!0))return null;b=m.previousSibling}return!b||d&&!1===d(b)?null:a&&b.nodeType!=a?c._4e_previousSourceNode(b,
!1,a,d):b},_4e_commonAncestor:function(e,b){b=p(b);if(e===b)return e;if(c.contains(b,e))return b;var a=e;do if(c.contains(a,b))return a;while(a=a.parentNode);return null},_4e_hasAttributes:9>d.ieEngine?function(e){for(var b=e.attributes,a=0;a<b.length;a++){var d=b[a];switch(d.name){case "class":if(e.getAttribute("class"))return!0;break;default:if(d.specified)return!0}}return!1}:function(e){a.gecko&&e.removeAttribute("_moz_dirty");return e.hasAttributes()},_4e_position:function(e,b){var a=p(b);if(e.compareDocumentPosition)return e.compareDocumentPosition(a);
if(e==a)return l.POSITION_IDENTICAL;if(e.nodeType==c.ELEMENT_NODE&&a.nodeType==c.ELEMENT_NODE){if(c.contains(e,a))return l.POSITION_CONTAINS+l.POSITION_PRECEDING;if(c.contains(a,e))return l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING;if("sourceIndex"in e)return 0>e.sourceIndex||0>a.sourceIndex?l.POSITION_DISCONNECTED:e.sourceIndex<a.sourceIndex?l.POSITION_PRECEDING:l.POSITION_FOLLOWING}for(var d=c._4e_address(e),a=c._4e_address(a),g=Math.min(d.length,a.length),m=0;m<=g-1;m++)if(d[m]!=a[m])return d[m]<
a[m]?l.POSITION_PRECEDING:l.POSITION_FOLLOWING;return d.length<a.length?l.POSITION_CONTAINS+l.POSITION_PRECEDING:l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING},_4e_address:function(e,b){for(var a=[],d=e.ownerDocument.documentElement,g=e;g&&g!=d;)a.unshift(c._4e_index(g,b)),g=g.parentNode;return a},_4e_remove:function(e,b){var a=e.parentNode;if(a){if(b)for(var d;d=e.firstChild;)a.insertBefore(e.removeChild(d),e);a.removeChild(e)}return e},_4e_trim:function(e){c._4e_ltrim(e);c._4e_rtrim(e)},_4e_ltrim:function(e){for(var b;b=
e.firstChild;){if(b.nodeType==c.TEXT_NODE){var a=d.ltrim(b.nodeValue),g=b.nodeValue.length;if(a)a.length<g&&(c._4e_splitText(b,g-a.length),e.removeChild(e.firstChild));else{e.removeChild(b);continue}}break}},_4e_rtrim:function(e){for(var b;b=e.lastChild;){if(b.type==c.TEXT_NODE){var g=d.rtrim(b.nodeValue),i=b.nodeValue.length;if(g)g.length<i&&(c._4e_splitText(b,g.length),e.removeChild(e.lastChild));else{e.removeChild(b);continue}}break}!a.ie&&!a.opera&&(b=e.lastChild)&&1==b.nodeType&&"br"==c.nodeName(b)&&
e.removeChild(b)},_4e_appendBogus:function(e){for(var b=e.lastChild;b&&b.nodeType==c.TEXT_NODE&&!h.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==c.TEXT_NODE||"br"!==c.nodeName(b))b=a.opera?e.ownerDocument.createTextNode(""):e.ownerDocument.createElement("br"),a.gecko&&b.setAttribute("type","_moz"),e.appendChild(b)},_4e_outerHtml:function(e){if(e.outerHTML)return e.outerHTML.replace(/<\?[^>]*>/,"");var b=e.ownerDocument.createElement("div");b.appendChild(e.cloneNode(!0));return b.innerHTML},
_4e_setMarker:function(e,b,a,d){var e=new i(e),g=e.data("list_marker_id")||e.data("list_marker_id",h.guid()).data("list_marker_id"),m=e.data("list_marker_names")||e.data("list_marker_names",{}).data("list_marker_names");b[g]=e;m[a]=1;return e.data(a,d)},_4e_clearMarkers:function(e,b,a){var e=new i(e),d=e.data("list_marker_names"),g=e.data("list_marker_id"),m;for(m in d)d.hasOwnProperty(m)&&e.removeData(m);e.removeData("list_marker_names");a&&(e.removeData("list_marker_id"),delete b[g])},_4e_copyAttributes:function(e,
b,d){for(var b=new i(b),g=e.attributes,d=d||{},l=0;l<g.length;l++){var m=g[l],r=m.name.toLowerCase(),n;if(!(r in d))if("checked"==r&&(n=c.attr(e,r)))b.attr(r,n);else if(m.specified||a.ie&&m.value&&"value"==r)n=c.attr(e,r),null===n&&(n=m.nodeValue),b.attr(r,n)}""!==e.style.cssText&&(b[0].style.cssText=e.style.cssText)},_4e_isEditable:function(e){var e=c.nodeName(e),b=f.XHTML_DTD;return(e=!b.$nonEditable[e]&&(b[e]||b.span))&&e["#"]},_4e_getByAddress:function(e,b,a){for(var e=e.documentElement,d=0;e&&
d<b.length;d++){var g=b[d];if(a)for(var m=-1,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(!(!0===a&&3==n.nodeType&&n.previousSibling&&3==n.previousSibling.nodeType)&&(m++,m==g)){e=n;break}}else e=e.childNodes[g]}return e}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(h){function k(e){1>arguments.length||(this.range=e,this.forceBrBreak=f,this.enlargeBr=j,this.enforceRealBlocks=f,this._||(this._={}))}var j=!0,f=!1,c=h.Editor,a=h.UA,i=c.Walker,d=c.Range,g=c.RANGE,l=c.ElementPath,o=h.Node,q=h.DOM,p=/^[\r\n\t ]*$/;h.augment(k,{getNextParagraph:function(e){var b,c,s,k,m;if(!this._.lastNode){c=this.range.clone();c.shrink(g.SHRINK_ELEMENT,j);c.enlarge(this.forceBrBreak||!this.enlargeBr?g.ENLARGE_LIST_ITEM_CONTENTS:g.ENLARGE_BLOCK_CONTENTS);
var r=new i(c),n=i.bookmark(j,j);r.evaluator=n;this._.nextNode=r.next();r=new i(c);r.evaluator=n;r=r.previous();this._.lastNode=r._4e_nextSourceNode(j);this._.lastNode&&this._.lastNode[0].nodeType==q.TEXT_NODE&&!h.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(n=new d(c.document),n.moveToPosition(this._.lastNode,g.POSITION_AFTER_END),n.checkEndOfBlock()&&(n=new l(n.endContainer),this._.lastNode=(n.block||n.blockLimit)._4e_nextSourceNode(j)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new o(c.document.createTextNode("")),q.insertAfter(this._.lastNode[0],r[0]));c=null}n=this._.nextNode;r=this._.lastNode;for(this._.nextNode=null;n;){var x=f,w=n[0].nodeType!=q.ELEMENT_NODE,v=f;if(w)n[0].nodeType==q.TEXT_NODE&&p.test(n[0].nodeValue)&&(w=f);else{var y=n.nodeName();if(n._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==y)w=j;else if(!c&&!n[0].childNodes.length&&"hr"!=y){b=n;s=n.equals(r);break}c&&(c.setEndAt(n,g.POSITION_BEFORE_START),"br"!=
y&&(this._.nextNode=n));x=j}else{if(n[0].firstChild){c||(c=new d(this.range.document),c.setStartAt(n,g.POSITION_BEFORE_START));n=new o(n[0].firstChild);continue}w=j}}w&&!c&&(c=new d(this.range.document),c.setStartAt(n,g.POSITION_BEFORE_START));s=(!x||w)&&n.equals(r);if(c&&!x)for(;!n[0].nextSibling&&!s;){y=n.parent();if(y._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){x=j;s||y.equals(r);break}n=y;w=j;s=n.equals(r);v=j}w&&c.setEndAt(n,g.POSITION_AFTER_END);n=n._4e_nextSourceNode(v,null,r);if((s=!n)||
x&&c)break}if(!b){if(!c)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;b=new l(c.startContainer);n=b.blockLimit;x={div:1,th:1,td:1};b=b.block;if((!b||!b[0])&&!this.enforceRealBlocks&&x[n.nodeName()]&&c.checkStartOfBlock()&&c.checkEndOfBlock())b=n;else if(!b||this.enforceRealBlocks&&"li"==b.nodeName())b=new o(this.range.document.createElement(e||"p")),b[0].appendChild(c.extractContents()),b._4e_trim(),c.insertNode(b),k=m=j;else if("li"!=b.nodeName()){if(!c.checkStartOfBlock()||
!c.checkEndOfBlock())b=b.clone(f),b[0].appendChild(c.extractContents()),b._4e_trim(),m=c.splitBlock(),k=!m.wasStartOfBlock,m=!m.wasEndOfBlock,c.insertNode(b)}else s||(this._.nextNode=b.equals(r)?null:c.getBoundaryNodes().endNode._4e_nextSourceNode(j,null,r))}k&&(c=new o(b[0].previousSibling),c[0]&&c[0].nodeType==q.ELEMENT_NODE&&("br"==c.nodeName()?c._4e_remove():c[0].lastChild&&"br"==q.nodeName(c[0].lastChild)&&q._4e_remove(c[0].lastChild)));m&&(c=i.bookmark(f,j),k=new o(b[0].lastChild),k[0]&&k[0].nodeType==
q.ELEMENT_NODE&&"br"==k.nodeName()&&(a.ie||k.prev(c)||k.next(c))&&k.remove());this._.nextNode||(this._.nextNode=s||b.equals(r)?null:b._4e_nextSourceNode(j,null,r));return b}});d.prototype.createIterator=function(){return new k(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(h){function k(g){for(var l=a,h=a,q=[];g;){if(g[0].nodeType==f.ELEMENT_NODE){this.lastElement||(this.lastElement=g);var p=g.nodeName();if(!h&&(!l&&i[p]&&(l=g),d[p])){var e;if(e=!l)if(e="div"==p){a:{e=g[0].childNodes;for(var b=0,k=e.length;b<k;b++){var s=e[b];if(s.nodeType==f.ELEMENT_NODE&&c.$block[s.nodeName.toLowerCase()]){e=!0;break a}}e=!1}e=!e}e?l=g:h=g}q.push(g);if("body"==p)break}g=g.parent()}this.block=l;this.blockLimit=h;this.elements=q}var j=h.Editor,
f=h.DOM,c=j.XHTML_DTD,a=null,i={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},d={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};k.prototype={compare:function(a){var d=this.elements,a=a&&a.elements;if(!a||d.length!=a.length)return!1;for(var c=0;c<d.length;c++)if(!f.equals(d[c],a[c]))return!1;return!0},contains:function(d){for(var c=this.elements,i=0;i<c.length;i++)if(c[i].nodeName()in d)return c[i];return a},toString:function(){var a=this.elements,
d,c=[];for(d=0;d<a.length;d++)c.push(a[d].nodeName());return c.toString()}};return j.ElementPath=k},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/enterKey/index",function(h){function k(g){var f;f=g.getSelection().getRanges();for(var e=f.length-1;0<e;e--)f[e].deleteContents();f=f[0];e=f.document;if(f.checkStartOfBlock()&&f.checkEndOfBlock()){var b=(new o(f.startContainer)).block;if(b&&("li"==b.nodeName()||"li"==b.parent().nodeName()))return g.hasCommand("outdent")?(g.execCommand("save"),g.execCommand("outdent"),g.execCommand("save"),!0):!1}var k=f.splitBlock("p");if(!k)return!0;var g=k.previousBlock,b=k.nextBlock,s=
k.wasStartOfBlock,j=k.wasEndOfBlock,m;if(b)m=b.parent(),"li"==m.nodeName()&&(b._4e_breakParent(m),b._4e_move(b.next(),!0));else if(g&&(m=g.parent())&&"li"==m.nodeName())g._4e_breakParent(m),f.moveToElementEditablePosition(g.next()),g._4e_move(g.prev());if(!s&&!j){if("li"==b.nodeName()&&(m=b.first(l.invisible(!0)))&&h.inArray(m.nodeName(),["ul","ol"]))(c.ie?new d(e.createTextNode("\u00a0")):new d(e.createElement("br"))).insertBefore(m);b&&f.moveToElementEditablePosition(b)}else{var r;if(g){if("li"==g.nodeName()||
!a.test(g.nodeName()))r=g.clone()}else b&&(r=b.clone());r||(r=new d("<p>",null,e));if(m=k.elementPath)for(var k=0,n=m.elements.length;k<n;k++){var x=m.elements[k];if(x.equals(m.block)||x.equals(m.blockLimit))break;i.$removeEmpty[x.nodeName()]&&(x=x.clone(),r._4e_moveChildren(x),r.append(x))}c.ie||r._4e_appendBogus();f.insertNode(r);if(c.ie&&s&&(!j||!g[0].childNodes.length))f.moveToElementEditablePosition(j?g:r),f.select();f.moveToElementEditablePosition(s&&!j?b:r)}c.ie||(b?(r=new d(e.createElement("span")),
r.html("&nbsp;"),f.insertNode(r),r.scrollIntoView(void 0,!1),f.deleteContents()):r.scrollIntoView(void 0,!1));f.select();return!0}function j(a){var d=a.get("document")[0];g.on(d,"keydown",function(e){if(13===e.keyCode&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){a.execCommand("save");var b=a.execCommand("enterBlock");a.execCommand("save");!1!==b&&e.preventDefault()}})}var f=h.Editor,c=h.UA,a=/^h[1-6]$/,i=f.XHTML_DTD,d=h.Node,g=h.Event,l=f.Walker,o=f.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:k});a.docReady(function(){j(a)})}}},{requires:["editor"]});
KISSY.add("editor/core/focusManager",function(h){function k(){var a=this;a.__iframeFocus=l;g=a;d&&clearTimeout(d);d=setTimeout(function(){a.fire("focus")},100)}function j(){var a=this;a.__iframeFocus=o;g=q;d&&clearTimeout(d);d=setTimeout(function(){a.fire("blur")},100)}var f=h.Editor,c=h.DOM,a=h.Event,i={},d,g,h={refreshAll:function(){for(var a in i)if(i.hasOwnProperty(a)){var e=i[a].get("document")[0];e.designMode="off";e.designMode="on"}},currentInstance:function(){return g},getInstance:function(a){return i[a]},
add:function(d){var e=c._4e_getWin(d.get("document")[0]);a.on(e,"focus",k,d);a.on(e,"blur",j,d)},register:function(a){i[a._UUID]=a},remove:function(d){delete i[d._UUID];var e=c._4e_getWin(d.get("document")[0]);a.remove(e,"focus",k,d);a.remove(e,"blur",j,d)}},l=!0,o=!1,q=null;h.refreshAll=h.refreshAll;f.focusManager=h;f.getInstances=function(){return i};return h},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/htmlDataProcessor/index",function(h){return{init:function(k){function j(a){return a.replace(e,function(a,e,d){return"<"+e+d.replace(b,function(b,a){return-1==d.indexOf("_ke_saved_"+a)?" _ke_saved_"+b+" "+b:b})+">"})}function f(b){return b.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(b){return"<\!--"+t+"{C}"+encodeURIComponent(b).replace(/--/g,"%2D%2D")+"--\>"})}function c(b){return b.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(b,a){return decodeURIComponent(a)})}
var a=a,i=h.Editor,d=h.Node,g=h.UA,l=h.require("htmlparser"),o=new l.Filter,q=new l.Filter,p=new l.Filter;(function(){var b=function(b,a){return function(e,d){var g=[];(""+e).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,m,c){m=m.toLowerCase();"font-family"==m&&(c=c.replace(/["']/g,""));for(var i,f,l,h=0;h<b.length;h++)if(b[h]&&(e=b[h][0],i=b[h][1],f=b[h][2],l=b[h][3],m.match(e)&&(!i||c.match(i)))){m=l||m;a&&(f=f||c);"function"==typeof f&&(f=f(c,d,m));f&&f.push&&
(m=f[0],f=f[1]);"string"==typeof f&&g.push([m,f]);return}!a&&g.push([m,c])});for(var m=0;m<g.length;m++)g[m]=g[m].join(":");return g.length?g.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],a),e={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(b){b.filterChildren()},tags:{p:function(b){b.filterChildren()},$:function(b){var a=b.nodeName||"";if(-1!=a.indexOf(":")&&
!/^ke/.test(a))if("v:imagedata"==a){if(a=b.getAttribute("o:href"))b.setAttribute("src",a),b.removeAttribute("o:href");if(a=b.getAttribute("o:title"))b.setAttribute("title",a),b.removeAttribute("o:title");b.setTagName("img")}else b.setTagName("")}},attributes:{"class":function(b){return!b||/(^|\s+)Mso/.test(b)?!1:b},style:function(a){a=b(a);return!a?!1:a}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},d={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(b){if(b.attributes.length)for(var a=
["name","href","src"],e,d=0;d<a.length;d++)e="_ke_saved_"+a[d],b.getAttribute(e)&&b.removeAttribute(a[d]);return b},embed:function(b){var a=b.parentNode;if(a&&"object"==a.nodeName){var e=a.getAttribute("width"),a=a.getAttribute("height");e&&b.setAttribute("width",e);a&&b.setAttribute("width",a)}},a:function(b){if(!b.childNodes.length&&!b.attributes.length)return!1},span:function(b){if(!b.childNodes.length&&!b.attributes.length)return!1}},attributes:{style:function(b){if(!h.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(b){return b.substr(0,t.length)==t?(b="{C}"==b.substr(t.length,3)?b.substr(t.length+3):b.substr(t.length),new l.CData(decodeURIComponent(b))):b}};g.ie&&(d.attributes.style=function(b){return b.replace(/(^|;)([^:]+)/g,function(b){return b.toLowerCase()})});o.addRules(d);q.addRules(e);p.addRules(e)})();(function(){function b(a){for(var a=a.childNodes,e=a.length,d=a[e-1];d&&3==d.nodeType&&!h.trim(d.nodeValue);)d=a[--e];return d}
function a(e,d){var m=b(e);m&&((d||!g.ie)&&1==m.nodeType&&"br"==m.nodeName?e.removeChild(m):3==m.nodeType&&f.test(m.nodeValue)&&e.removeChild(m))}function e(a){var d=b(a);return!d||1==d.nodeType&&"br"==d.nodeName||"form"==a.nodeName&&"input"==d.nodeName}function d(b){a(b,!0);e(b)&&(g.ie?b.appendChild(new l.Text("\u00a0")):(b.appendChild(new l.Text("&nbsp;")),b.appendChild(new l.Tag("br"))))}function c(b){a(b,!1);e(b)&&b.appendChild(new l.Text("\u00a0"))}var f=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,w=i.XHTML_DTD,k=i.Utils.mix({},
w.$block,w.$listItem,w.$tableContent),j;for(j in k)k.hasOwnProperty(j)&&("br"in w[j]||delete k[j]);delete k.td;delete k.pre;var w={tags:{}},t={tags:{}};for(j in k)k.hasOwnProperty(j)&&(w.tags[j]=d,t.tags[j]=c);q.addRules(w);o.addRules(t);p.addRules(w)})();(function(){o.addRules({text:function(b){return b.replace(/\xa0/g,"&nbsp;")}})})();var e=/<(a|area|img|input)\b([^>]*)>/gi,b=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,t="{ke_protected}";k.htmlDataProcessor={wordFilter:p,
dataFilter:q,htmlFilter:o,toHtml:function(b){var a=new l.BeautifyWriter;(new l.Parser(b)).parse().writeHtml(a,o);return a.getHtml()},toDataFormat:function(b,a,e){e=e||q;g.gecko&&(b=b.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));b=j(b);a=new d("<div>");a.html("a"+b);b=a.html().substr(1);b=c(b);a=new l.BeautifyWriter;(new l.Parser(b)).parse().writeHtml(a,e);b=a.getHtml();return b=f(b)},toServer:function(b){var a=new l.MinifyWriter;(new l.Parser(b)).parse().writeHtml(a,
o);return a.getHtml()}}}}},{requires:["editor"]});
KISSY.add("editor/core/meta",function(){var h={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../select/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubbleview/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],insertOrderedList:["../listUtils/btn","./cmd"],insertUnorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubbleview/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["./focus","dd"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui","./cmd"],
undo:["./btn","./cmd"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},k,j,f={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../select/"],"flashCommon/baseClass":["../contextmenu/","../bubbleview/","../dialogLoader/","./utils"],
"font/ui":["../button/","../select/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../select/"],"indent/cmd":["../dentUtils/cmd"],"insertOrderedList/cmd":["../listUtils/cmd"],"insertUnorderedList/cmd":["../listUtils/cmd.js"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],"link/dialog":["../overlay/",
"./utils"],"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../select/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../select/"],"xiamiMusic/dialog":["../flash/dialog","../select/"]},c={};for(k in h)j="editor/plugin/"+k+"/index",c[j]={requires:h[k]};
for(k in f)j="editor/plugin/"+k,c[j]={requires:f[k]};KISSY.add(c)});
KISSY.add("editor/core/range",function(h,k,j,f,c){function a(b){var a=b.nodeType!=s.TEXT_NODE&&s.nodeName(b)in m.$removeEmpty,e=b.nodeType==s.TEXT_NODE&&!h.trim(b.nodeValue),b=!!b.parentNode.getAttribute("_ke_bookmark");return a||e||b}function i(b){return!w(b)&&!v(b)}function d(b){var a=p;return function(e){if(v(e))return q;if(e.nodeType==s.TEXT_NODE){if(h.trim(e.nodeValue).length)return p}else if(e.nodeType==s.ELEMENT_NODE&&(e=s.nodeName(e),!A[e]))if(!b&&!u.ie&&"br"==e&&!a)a=q;else return p;return q}}
function g(b,a){var e=b.startContainer,d=b.endContainer,m=b.startOffset,g=b.endOffset,c,n=p,i=p,f=void 0,l=b.document,h;if(b.collapsed)return f;0<a&&(f=l.createDocumentFragment());b.optimizeBookmark();d[0].nodeType==s.TEXT_NODE?(i=q,d=d._4e_splitText(g)):0<d[0].childNodes.length&&(g>=d[0].childNodes.length?(d=new r(d[0].appendChild(l.createTextNode(""))),h=q):d=new r(d[0].childNodes[g]));e[0].nodeType==s.TEXT_NODE?(n=q,e._4e_splitText(m)):m?m>=e[0].childNodes.length?(e=new r(e[0].appendChild(l.createTextNode(""))),
c=q):e=new r(e[0].childNodes[m].previousSibling):(c=new r(l.createTextNode("")),e.prepend(c),e=c,c=q);var w=e._4e_parents(),k=d._4e_parents();w.each(function(b,a){w[a]=b});k.each(function(b,a){k[a]=b});for(var o,x,l=0;l<w.length&&!(o=w[l],x=k[l],!o.equals(x));l++);for(var m=f,j,v,t=l;t<w.length;t++){j=w[t];g=0<a&&!j.equals(e)?m.appendChild(j.clone()[0]):null;j=j[0].nextSibling;v=k[t];for(var u=d[0],y=v&&v[0];j&&!(y==j||u==j);)v=j.nextSibling,2==a?m.appendChild(j.cloneNode(q)):(s._4e_remove(j),1==
a&&m.appendChild(j)),j=v;g&&(m=g)}for(m=f;l<k.length;l++){j=k[l];g=0<a&&!j.equals(d)?m.appendChild(j.clone()[0]):null;if(!w[l]||!j._4e_sameLevel(w[l]))for(j=j[0].previousSibling;j;)v=j.previousSibling,2==a?m.insertBefore(j.cloneNode(q),m.firstChild):(s._4e_remove(j),1==a&&m.insertBefore(j,m.firstChild)),j=v;g&&(m=g)}if(2==a){if(n&&(o=e[0],o.nodeType==s.TEXT_NODE&&o.nextSibling&&o.nextSibling.nodeType==s.TEXT_NODE&&(o.data+=o.nextSibling.data,o.parentNode.removeChild(o.nextSibling))),i)i=d[0],i.nodeType==
s.TEXT_NODE&&i.previousSibling&&i.previousSibling.nodeType==s.TEXT_NODE&&(i.previousSibling.data+=i.data,i.parentNode.removeChild(i))}else{if(o&&x&&(!e._4e_sameLevel(o)||!d._4e_sameLevel(x)))i=o._4e_index(),c&&o._4e_sameLevel(e)&&i--,b.setStart(o.parent(),i+1);b.collapse(q)}c&&e.remove();h&&d.remove();return f}function l(b){b.collapsed=b.startContainer&&b.endContainer&&b.startContainer[0]==b.endContainer[0]&&b.startOffset==b.endOffset}function o(b){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=e;this.collapsed=q;this.document=b}k.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var q=!0,p=!1,e=null,b=k.RANGE,t=k.POSITION,s=h.DOM,u=h.UA,m=k.XHTML_DTD,r=h.Node,n=r.all,x={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},w=new f.whitespaces,v=new f.bookmark,y=f.whitespaces(q),z=f.bookmark(!1,
!0),A={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};h.augment(o,{toString:function(){var b=[],a=this.startContainer[0],e=this.endContainer[0];b.push((a.id||a.nodeName)+":"+this.startOffset);b.push((e.id||e.nodeName)+":"+this.endOffset);return b.join("<br/>")},optimize:function(){var b=this.startContainer,a=this.startOffset;b[0].nodeType!=s.ELEMENT_NODE&&(a?a>=b[0].nodeValue.length&&
this.setStartAfter(b):this.setStartBefore(b));b=this.endContainer;a=this.endOffset;b[0].nodeType!=s.ELEMENT_NODE&&(a?a>=b[0].nodeValue.length&&this.setEndAfter(b):this.setEndBefore(b))},setStartAfter:function(b){this.setStart(b.parent(),b._4e_index()+1)},setStartBefore:function(b){this.setStart(b.parent(),b._4e_index())},setEndAfter:function(b){this.setEnd(b.parent(),b._4e_index()+1)},setEndBefore:function(b){this.setEnd(b.parent(),b._4e_index())},optimizeBookmark:function(){var b=this.startContainer,
a=this.endContainer;b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setStartBefore(b);a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setEndAfter(a)},setStart:function(b,a){b[0].nodeType==s.ELEMENT_NODE&&x[b.nodeName()]&&(b=b.parent(),a=b._4e_index());this.startContainer=b;this.startOffset=a;this.endContainer||(this.endContainer=b,this.endOffset=a);l(this)},setEnd:function(b,a){b[0].nodeType==s.ELEMENT_NODE&&x[b.nodeName()]&&(b=b.parent(),a=b._4e_index()+1);this.endContainer=b;this.endOffset=
a;this.startContainer||(this.startContainer=b,this.startOffset=a);l(this)},setStartAt:function(a,e){switch(e){case b.POSITION_AFTER_START:this.setStart(a,0);break;case b.POSITION_BEFORE_END:a[0].nodeType==s.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case b.POSITION_BEFORE_START:this.setStartBefore(a);break;case b.POSITION_AFTER_END:this.setStartAfter(a)}l(this)},setEndAt:function(a,e){switch(e){case b.POSITION_AFTER_START:this.setEnd(a,0);break;
case b.POSITION_BEFORE_END:a[0].nodeType==s.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case b.POSITION_BEFORE_START:this.setEndBefore(a);break;case b.POSITION_AFTER_END:this.setEndAfter(a)}l(this)},cloneContents:function(){return g(this,2)},deleteContents:function(){return g(this,0)},extractContents:function(){return g(this,1)},collapse:function(b){b?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=q},clone:function(){var b=new o(this.document);b.startContainer=this.startContainer;b.startOffset=this.startOffset;b.endContainer=this.endContainer;b.endOffset=this.endOffset;b.collapsed=this.collapsed;return b},getEnclosedNode:function(){var b=this.clone();b.optimize();if(b.startContainer[0].nodeType!=s.ELEMENT_NODE||b.endContainer[0].nodeType!=s.ELEMENT_NODE)return e;var a=new f(b);a.evaluator=function(b){return y(b)&&z(b)};b=a.next();a.reset();a=
a.previous();return b&&b.equals(a)?b:e},shrink:function(a,e){if(!this.collapsed){var a=a||b.SHRINK_TEXT,d=this.clone(),m=this.startContainer,g=this.endContainer,c=this.startOffset,r=this.endOffset,n=q,i,l,h=q;m&&m[0].nodeType==s.TEXT_NODE&&(c?c>=m[0].nodeValue.length?d.setStartAfter(m):(d.setStartBefore(m),n=p):d.setStartBefore(m));g&&g[0].nodeType==s.TEXT_NODE&&(r?r>=g[0].nodeValue.length?d.setEndAfter(g):(d.setEndAfter(g),h=p):d.setEndBefore(g));if(n||h)l=new f(d),l.evaluator=function(e){return e.nodeType==
(a==b.SHRINK_ELEMENT?s.ELEMENT_NODE:s.TEXT_NODE)},l.guard=function(e,d){e=e[0]||e;if(a==b.SHRINK_ELEMENT&&e.nodeType==s.TEXT_NODE||d&&e==i)return p;!d&&e.nodeType==s.ELEMENT_NODE&&(i=e);return q};n&&(d=l[a==b.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(d,e?b.POSITION_AFTER_START:b.POSITION_BEFORE_START);h&&(l.reset(),(l=l[a==b.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(l,e?b.POSITION_BEFORE_END:b.POSITION_AFTER_END));return n||h}},createBookmark2:function(b){var a=this.startContainer,
d=this.endContainer,m=this.startOffset,g=this.endOffset,c,n;if(!a||!d)return{start:0,end:0};if(b){if(a[0].nodeType==s.ELEMENT_NODE&&(c=new r(a[0].childNodes[m]))&&c[0]&&c[0].nodeType==s.TEXT_NODE&&0<m&&c[0].previousSibling.nodeType==s.TEXT_NODE)a=c,m=0;for(;a[0].nodeType==s.TEXT_NODE&&(n=a.prev())&&n[0].nodeType==s.TEXT_NODE;)a=n,m+=n[0].nodeValue.length;if(!this.collapsed){if(d[0].nodeType==s.ELEMENT_NODE&&(c=new r(d[0].childNodes[g]))&&c[0]&&c[0].nodeType==s.TEXT_NODE&&0<g&&c[0].previousSibling.nodeType==
s.TEXT_NODE)d=c,g=0;for(;d[0].nodeType==s.TEXT_NODE&&(n=d.prev())&&n[0].nodeType==s.TEXT_NODE;)d=n,g+=n[0].nodeValue.length}}return{start:a._4e_address(b),end:this.collapsed?e:d._4e_address(b),startOffset:m,endOffset:g,normalized:b,is2:q}},createBookmark:function(a){var d,m,g,c,n=this.collapsed;d=new r("<span>",e,this.document);d.attr("_ke_bookmark",1);d.css("display","none");d.html("&nbsp;");a&&(g=h.guid("ke_bm_"),d.attr("id",g+"S"));n||(m=d.clone(),m.html("&nbsp;"),a&&m.attr("id",g+"E"),c=this.clone(),
c.collapse(),c.insertNode(m));c=this.clone();c.collapse(q);c.insertNode(d);m?(this.setStartAfter(d),this.setEndBefore(m)):this.moveToPosition(d,b.POSITION_AFTER_END);return{startNode:a?g+"S":d,endNode:a?g+"E":m,serializable:a,collapsed:n}},moveToPosition:function(b,a){this.setStartAt(b,a);this.collapse(q)},trim:function(b,a){var e=this.startContainer,d=this.startOffset,m=this.collapsed;if((!b||m)&&e[0]&&e[0].nodeType==s.TEXT_NODE){if(d)if(d>=e[0].nodeValue.length)d=e._4e_index()+1,e=e.parent();else{var g=
e._4e_splitText(d),d=e._4e_index()+1,e=e.parent();s.equals(this.startContainer,this.endContainer)?this.setEnd(g,this.endOffset-this.startOffset):s.equals(e,this.endContainer)&&(this.endOffset+=1)}else d=e._4e_index(),e=e.parent();this.setStart(e,d);if(m){this.collapse(q);return}}e=this.endContainer;d=this.endOffset;!a&&!m&&e[0]&&e[0].nodeType==s.TEXT_NODE&&(d?(d>=e[0].nodeValue.length||e._4e_splitText(d),d=e._4e_index()+1):d=e._4e_index(),e=e.parent(),this.setEnd(e,d))},insertNode:function(b){this.optimizeBookmark();
this.trim(p,q);var a=this.startContainer;a[0].insertBefore(b[0],a[0].childNodes[this.startOffset]||null);a[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(b)},moveToBookmark:function(b){var a=n(this.document);if(b.is2){var e=a._4e_getByAddress(b.start,b.normalized),d=b.startOffset,a=b.end&&a._4e_getByAddress(b.end,b.normalized),b=b.endOffset;this.setStart(e,d);a?this.setEnd(a,b):this.collapse(q)}else e=(d=b.serializable)?h.one("#"+b.startNode,a):b.startNode,b=d?h.one("#"+b.endNode,
a):b.endNode,this.setStartBefore(e),e._4e_remove(),b&&b[0]?(this.setEndBefore(b),b._4e_remove()):this.collapse(q)},getCommonAncestor:function(b,a){var e=this.startContainer,d=this.endContainer,e=e[0]==d[0]?b&&e[0].nodeType==s.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new r(e[0].childNodes[this.startOffset]):e:e._4e_commonAncestor(d);return a&&e[0].nodeType==s.TEXT_NODE?e.parent():e},enlarge:function(){function a(b,e,d,m){var g=b[e?"startContainer":"endContainer"],c,r=e?0:1,i=0,l=e?"previousSibling":
"nextSibling";c=b[e?"startOffset":"endOffset"];if(g[0].nodeType==s.TEXT_NODE){if(e){if(c)return}else if(c<g[0].nodeValue.length)return;c=g[0][l];g=g[0].parentNode}else c=g[0].childNodes[c+(e?-1:1)]||null,g=g[0];for(;g;){for(;c;)if(w(c)||v(c))c=c[l];else break;if(c){if(!i)b[e?"setStartAfter":"setEndBefore"](n(c));break}g=n(g);if("body"==g.nodeName())break;if(i||g.equals(m))d[r]=g,i=1;else b[e?"setStartBefore":"setEndAfter"](g);c=g[0][l];g=g[0].parentNode}}return function(d){switch(d){case b.ENLARGE_ELEMENT:if(this.collapsed)break;
var d=this.getCommonAncestor(),g=[];a(this,1,g,d);a(this,0,g,d);g[0]&&g[1]&&(d=g[0].contains(g[1])?g[1]:g[0],this.setStartBefore(d),this.setEndAfter(d));break;case b.ENLARGE_BLOCK_CONTENTS:case b.ENLARGE_LIST_ITEM_CONTENTS:var m=new o(this.document),g=new r(this.document.body);m.setStartAt(g,b.POSITION_AFTER_START);m.setEnd(this.startContainer,this.startOffset);var m=new f(m),c,i,l=f.blockBoundary(d==b.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:e),h=function(b){var a=l(b);a||(c=n(b));return a},w=function(b){var a=
h(b);!a&&"br"==s.nodeName(b)&&(i=n(b));return a};m.guard=h;m=m.lastBackward();c=c||g;this.setStartAt(c,"br"!=c.nodeName()&&(!m&&this.checkStartOfBlock()||m&&c.contains(m))?b.POSITION_AFTER_START:b.POSITION_AFTER_END);m=this.clone();m.collapse();m.setEndAt(g,b.POSITION_BEFORE_END);m=new f(m);m.guard=d==b.ENLARGE_LIST_ITEM_CONTENTS?w:h;c=e;m=m.lastForward();c=c||g;this.setEndAt(c,!m&&this.checkEndOfBlock()||m&&c.contains(m)?b.POSITION_BEFORE_END:b.POSITION_BEFORE_START);i&&this.setEndAfter(i)}}}(),
checkStartOfBlock:function(){var a=this.startContainer,e=this.startOffset;if(e&&a[0].nodeType==s.TEXT_NODE&&h.trim(a[0].nodeValue.substring(0,e)).length)return p;this.trim();a=new c(this.startContainer);e=this.clone();e.collapse(q);e.setStartAt(a.block||a.blockLimit,b.POSITION_AFTER_START);a=new f(e);a.evaluator=d(q);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,e=this.endOffset;if(a[0].nodeType==s.TEXT_NODE&&h.trim(a[0].nodeValue.substring(e)).length)return p;this.trim();
a=new c(this.endContainer);e=this.clone();e.collapse(p);e.setEndAt(a.block||a.blockLimit,b.POSITION_BEFORE_END);a=new f(e);a.evaluator=d(p);return a.checkForward()},checkBoundaryOfElement:function(e,d){var m=this.clone();m[d==b.START?"setStartAt":"setEndAt"](e,d==b.START?b.POSITION_AFTER_START:b.POSITION_BEFORE_END);m=new f(m);m.evaluator=a;return m[d==b.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var b=this.startContainer,a=this.endContainer,e=this.startOffset,d=this.endOffset,
m;if(b[0].nodeType==s.ELEMENT_NODE)if(m=b[0].childNodes.length,m>e)b=n(b[0].childNodes[e]);else if(0==m)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=n(b);b=b._4e_nextSourceNode()||b}if(a[0].nodeType==s.ELEMENT_NODE)if(m=a[0].childNodes.length,m>d)a=n(a[0].childNodes[d])._4e_previousSourceNode(q);else if(0==m)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=n(a)}b._4e_position(a)&t.POSITION_FOLLOWING&&(b=a);return{startNode:b,endNode:a}},fixBlock:function(a,
e){var d=this.createBookmark(),m=n(this.document.createElement(e));this.collapse(a);this.enlarge(b.ENLARGE_BLOCK_CONTENTS);m[0].appendChild(this.extractContents());m._4e_trim();u.ie||m._4e_appendBogus();this.insertNode(m);this.moveToBookmark(d);return m},splitBlock:function(a){var d=new c(this.startContainer),m=new c(this.endContainer),g=d.block,n=m.block,r=e;if(!d.blockLimit.equals(m.blockLimit))return e;"br"!=a&&(g||(g=this.fixBlock(q,a),n=(new c(this.endContainer)).block),n||(n=this.fixBlock(p,
a)));a=g&&this.checkStartOfBlock();d=n&&this.checkEndOfBlock();this.deleteContents();g&&g[0]==n[0]&&(d?(r=new c(this.startContainer),this.moveToPosition(n,b.POSITION_AFTER_END),n=e):a?(r=new c(this.startContainer),this.moveToPosition(g,b.POSITION_BEFORE_START),g=e):(n=this.splitElement(g),!u.ie&&!h.inArray(g.nodeName(),["ul","ol"])&&g._4e_appendBogus()));return{previousBlock:g,nextBlock:n,wasStartOfBlock:a,wasEndOfBlock:d,elementPath:r}},splitElement:function(a){if(!this.collapsed)return e;this.setEndAt(a,
b.POSITION_BEFORE_END);var d=this.extractContents(),m=a.clone(p);m[0].appendChild(d);m.insertAfter(a);this.moveToPosition(a,b.POSITION_AFTER_END);return m},moveToElementEditablePosition:function(a,e){for(var d=0;a;){if(a[0].nodeType==s.TEXT_NODE){this.moveToPosition(a,e?b.POSITION_AFTER_END:b.POSITION_BEFORE_START);d=1;break}a[0].nodeType==s.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,e?b.POSITION_BEFORE_END:b.POSITION_AFTER_START),d=1);var m=a,g=d,c=void 0;m[0].nodeType==s.ELEMENT_NODE&&
m._4e_isEditable()&&(c=m[e?"last":"first"](i));!g&&!c&&(c=m[e?"prev":"next"](i));a=c}return!!d},selectNodeContents:function(b){var a=b[0];this.setStart(b,0);this.setEnd(b,a.nodeType==s.TEXT_NODE?a.nodeValue.length:a.childNodes.length)}});j.injectDom({_4e_breakParent:function(b,a){var a=n(a),b=n(b),e,d=new k.Range(b[0].ownerDocument);d.setStartAfter(b);d.setEndAfter(a);e=d.extractContents();d.insertNode(b.remove());b.after(e)}});k.Range=o},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(h){function k(b){this.document=b;this._={cache:{}};if(q){var a=this.getNative().createRange();if(!a||a.item&&a.item(0).ownerDocument!=b||a.parentElement&&a.parentElement().ownerDocument!=b)this.isInvalid=c}}function j(b){b=new k(b);return!b||b.isInvalid?a:b}var f=h.Editor;f.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var c=!0,a=null,i=h.UA,d=h.DOM,g=h.Node,l=f.SELECTION,o=f.RANGE,q=i.ie,p=f.Walker,e=f.Range,b={img:1,hr:1,li:1,table:1,
tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};h.augment(k,{getNative:!q?function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=d._4e_getWin(this.document).getSelection())}:function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=this.document.selection)},getType:!q?function(){var a=this._.cache;if(a.type)return a.type;var e=l.SELECTION_TEXT,g=this.getNative();if(g){if(1==g.rangeCount){var g=g.getRangeAt(0),c=g.startContainer;
c==g.endContainer&&c.nodeType==d.ELEMENT_NODE&&1==Number(g.endOffset-g.startOffset)&&b[c.childNodes[g.startOffset].nodeName.toLowerCase()]&&(e=l.SELECTION_ELEMENT)}}else e=l.SELECTION_NONE;return a.type=e}:function(){var b=this._.cache;if(b.type)return b.type;var a=l.SELECTION_NONE;try{var e=this.getNative(),d=e.type;"Text"==d&&(a=l.SELECTION_TEXT);"Control"==d&&(a=l.SELECTION_ELEMENT);e.createRange().parentElement&&(a=l.SELECTION_TEXT)}catch(g){}return b.type=a},getRanges:q?function(){var b=function(b,
e){b=b.duplicate();b.collapse(e);for(var g=b.parentElement(),m=g.childNodes,c,i=0;i<m.length;i++){var l=m[i];if(l.nodeType==d.ELEMENT_NODE){c=b.duplicate();c.moveToElementText(l);var l=c.compareEndPoints("StartToStart",b),f=c.compareEndPoints("EndToStart",b);c.collapse();if(0<l)break;else{if(!l||1==f&&-1==l)return{container:g,offset:i};if(!f)return{container:g,offset:i+1}}c=a}}c||(c=b.duplicate(),c.moveToElementText(g),c.collapse(!1));c.setEndPoint("StartToStart",b);c=(""+c.text).replace(/\r\n|\r/g,
"\n").length;try{for(;0<c;)c-=m[--i].nodeValue.length}catch(h){c=0}return 0===c?{container:g,offset:i}:{container:m[i],offset:-c}};return function(a){var d=this._.cache;if(d.ranges&&!a)return d.ranges;var i=this.getNative(),a=i&&i.createRange(),f=this.getType();if(!i)return[];if(f==l.SELECTION_TEXT)return i=new e(this.document),f=b(a,c),i.setStart(new g(f.container),f.offset),f=b(a),i.setEnd(new g(f.container),f.offset),d.ranges=[i];if(f==l.SELECTION_ELEMENT){d=d.ranges=[];for(f=0;f<a.length;f++){for(var h=
a.item(f),k=h.parentNode,o=0,i=new e(this.document);o<k.childNodes.length&&k.childNodes[o]!=h;o++);i.setStart(new g(k),o);i.setEnd(new g(k),o+1);d.push(i)}return d}return d.ranges=[]}}():function(b){var a=this._.cache;if(a.ranges&&!b)return a.ranges;var b=[],d=this.getNative();if(!d)return[];for(var c=0;c<d.rangeCount;c++){var i=d.getRangeAt(c),f=new e(this.document);f.setStart(new g(i.startContainer),i.startOffset);f.setEnd(new g(i.endContainer),i.endOffset);b.push(f)}return a.ranges=b},getStartElement:function(){var b=
this._.cache;if(void 0!==b.startElement)return b.startElement;var a,e=this.getNative();switch(this.getType()){case l.SELECTION_ELEMENT:return this.getSelectedElement();case l.SELECTION_TEXT:var i=this.getRanges()[0];if(i&&!i.collapsed){for(i.optimize();c;)if(a=i.startContainer,i.startOffset==(a[0].nodeType===d.ELEMENT_NODE?a[0].childNodes.length:a[0].nodeValue.length)&&!a._4e_isBlockBoundary())i.setStartAfter(a);else break;a=i.startContainer;if(a[0].nodeType!=d.ELEMENT_NODE)return a.parent();a=new g(a[0].childNodes[i.startOffset]);
if(!a[0]||a[0].nodeType!=d.ELEMENT_NODE)return i.startContainer;for(i=a[0].firstChild;i&&i.nodeType==d.ELEMENT_NODE;)a=new g(i),i=i.firstChild;return a}if(q)i=e.createRange(),i.collapse(c),a=new g(i.parentElement());else{if((a=e.anchorNode)&&a.nodeType!=d.ELEMENT_NODE)a=a.parentNode;a&&(a=new g(a))}}return b.startElement=a},getSelectedElement:function(){var a,e=this._.cache;if(void 0!==e.selectedElement)return e.selectedElement;q&&(a=this.getNative().createRange(),a=a.item&&a.item(0));if(!a){a=this.getRanges()[0];
for(var c,i,f=2;f&&(!(c=a.getEnclosedNode())||!(c[0].nodeType==d.ELEMENT_NODE&&b[c.nodeName()]&&(i=c)));f--)a.shrink(o.SHRINK_ELEMENT);a=i}return e.selectedElement=new g(a)},reset:function(){this._.cache={}},selectElement:function(b){var a,e=this.document;if(q)try{a=e.body.createControlRange(),a.addElement(b[0]),a.select()}catch(d){a=e.body.createTextRange(),a.moveToElementText(b[0]),a.select()}finally{}else a=e.createRange(),a.selectNode(b[0]),b=this.getNative(),b.removeAllRanges(),b.addRange(a);
this.reset()},selectRanges:function(b){if(q){if(1<b.length){var a=b[b.length-1];b[0].setEnd(a.endContainer,a.endOffset);b.length=1}b[0]&&b[0].select()}else{a=this.getNative();if(!a)return;a.removeAllRanges();for(var e=0;e<b.length;e++){var g=b[e],c=this.document.createRange(),f=g.startContainer;if(g.collapsed&&(i.gecko&&1.09>i.gecko||i.opera||i.webkit)&&f[0].nodeType==d.ELEMENT_NODE&&!f[0].childNodes.length)f[0].appendChild(this.document.createTextNode(i.webkit?"\u200b":"")),g.startOffset++,g.endOffset++;
c.setStart(f[0],g.startOffset);c.setEnd(g.endContainer[0],g.endOffset);a.addRange(c)}}this.reset()},createBookmarks2:function(b){for(var a=[],e=this.getRanges(),d=0;d<e.length;d++)a.push(e[d].createBookmark2(b));return a},createBookmarks:function(b,a){for(var e=[],g=this.document,i,a=a||this.getRanges(),f=a.length,l=0;l<f;l++){e.push(i=a[l].createBookmark(b,c));var k=(b=i.serializable)?h.one("#"+i.startNode,g):i.startNode;i=b?h.one("#"+i.endNode,g):i.endNode;for(var o=l+1;o<f;o++){var q=a[o],j=q.startContainer,
s=q.endContainer;d.equals(j,k.parent())&&q.startOffset++;d.equals(j,i.parent())&&q.startOffset++;d.equals(s,k.parent())&&q.endOffset++;d.equals(s,i.parent())&&q.endOffset++}}return e},selectBookmarks:function(b){for(var a=[],d=0;d<b.length;d++){var g=new e(this.document);g.moveToBookmark(b[d]);a.push(g)}this.selectRanges(a);return this},getCommonAncestor:function(){var b=this.getRanges();return b[0].startContainer._4e_commonAncestor(b[b.length-1].endContainer)},scrollIntoView:function(){var b=this.getStartElement();
b&&b.scrollIntoView(void 0,!1)},removeAllRanges:function(){var b=this.getNative();q?b&&b.clear():b&&b.removeAllRanges()}});var t={table:1,tbody:1,tr:1},s=p.whitespaces(c),u=/\ufeff|\u00a0/;e.prototype.select=e.prototype.select=!q?function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==d.ELEMENT_NODE&&!b[0].childNodes.length&&b[0].appendChild(this.document.createTextNode(""));var a=this.document.createRange();a.setStart(b[0],this.startOffset);try{a.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=
e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(c),a.setEnd(this.endContainer[0],this.endOffset);else throw e;}b=j(this.document).getNative();b.removeAllRanges();b.addRange(a)}:function(b){var a=this.collapsed,e,i;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var f=this.startContainer[0].childNodes[this.startOffset];if(f.nodeType==d.ELEMENT_NODE){(new k(this.document)).selectElement(new g(f));return}}(this.startContainer[0].nodeType==d.ELEMENT_NODE&&
this.startContainer.nodeName()in t||this.endContainer[0].nodeType==d.ELEMENT_NODE&&this.endContainer.nodeName()in t)&&this.shrink(o.SHRINK_ELEMENT,c);var l=this.createBookmark(),f=l.startNode,h;a||(h=l.endNode);l=this.document.body.createTextRange();l.moveToElementText(f[0]);l.moveStart("character",1);if(h)b=this.document.body.createTextRange(),b.moveToElementText(h[0]),l.setEndPoint("EndToEnd",b),l.moveEnd("character",-1);else{for(e=f[0].nextSibling;e&&!s(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&
e.nodeValue.match(u))&&(b||!f[0].previousSibling||f[0].previousSibling&&"br"==d.nodeName(f[0].previousSibling));i=new g(this.document.createElement("span"));i.html("&#65279;");i.insertBefore(f);e&&d.insertBefore(this.document.createTextNode("\ufeff"),f[0]||f)}this.setStartBefore(f);f._4e_remove();if(a){if(e?(l.moveStart("character",-1),l.select(),this.document.selection.clear()):l.select(),i)this.moveToPosition(i,o.POSITION_BEFORE_START),i._4e_remove()}else this.setEndBefore(h),h._4e_remove(),l.select()};
k.getSelection=j;return f.Selection=k},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/plugin/selection/index",function(h,k){function j(b){function a(b,e){var d=f.body.createTextRange();try{d.moveToPoint(b,e)}catch(c){d=g}return d}function e(){var b=f.selection.createRange();l&&!b.item&&0===b.compareEndPoints("StartToEnd",b)&&l.select();o.remove(f,"mouseup",e);o.remove(f,"mousemove",d);l=c=0}function d(b){if(b.button){if(b=a(b.pageX,b.pageY))0<b.compareEndPoints("StartToStart",l)?b.setEndPoint("StartToStart",l):b.setEndPoint("EndToEnd",l),b.select()}else e()}var c,
i=b.get("iframe")[0].contentWindow,f=b.get("document")[0],l;o.on(f,"mousedown contextmenu",function(b){var g=f.documentElement;if(b.target===g&&(c&&e(),!(g.scrollHeight>g.clientHeight)&&(c=1,l=a(b.pageX,b.pageY))))o.on(f,"mouseup",e),o.on(f,"mousemove",d),i.focus(),l.select()})}function f(b){function a(d){if(n){var g=b.getSelection(),m=g&&g.getType(),f=g&&c.selection;if(d&&f&&m==e.SELECTION_NONE&&!c.queryCommandEnabled("InsertImage"))setTimeout(function(){a(i)},50);else{var h;if(!f||!f.type||!("Control"!=
f.type&&(h=f.createRange())&&(h=h.parentElement())&&(h=h.nodeName)&&h.toLowerCase()in{input:1,textarea:1}))l=f&&g.getRanges()[0],b._monitor()}}}var c=b.get("document")[0],f=new p(c.body),m=new p(c.documentElement);if(8>k.Utils.ieEngine)m.on("click",function(a){"html"===(new p(a.target)).nodeName()&&b.getSelection().getNative().createRange().select()});var l,n,h=i;m.on("mousedown",function(){h=d});m.on("mouseup",function(){h=i});f.on("focusin",function(b){if("body"==(new p(b.target)).nodeName()&&l){try{h&&
l.select()}catch(a){}l=g}});f.on("focus",function(){n=i;a()});f.on("beforedeactivate",function(b){b.relatedTarget||(n=d,h=i)});f.on("mousedown",function(){n=d});f.on("mouseup",function(){n=i;setTimeout(function(){a(i)},0)});f.on("keydown",function(){n=d});f.on("keyup",function(){n=i;setTimeout(function(){a()},0)})}function c(b){var a=b.get("document")[0];o.on(a,"mouseup keyup",function(){b._monitor()})}function a(b){function a(b){var e=k.XHTML_DTD;return b._4e_isBlockBoundary()&&e.$empty[b.nodeName()]}
function e(b){return f(b)&&h(b)}var g=b.get("document")[0],c=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,f=k.Walker.whitespaces(i),h=k.Walker.bookmark(d,i),o=function(b){return f(b)&&8!=b.nodeType};b.on("selectionChange",function(f){var h=f.path,n=new p(b.get("document")[0].body),f=(f=f.selection)&&f.getRanges()[0],r=h.blockLimit;if(l.gecko){var j=h.block||h.blockLimit,D=j&&j.last(e);j&&j._4e_isBlockBoundary()&&
(!D||!(1==D[0].nodeType&&D._4e_isBlockBoundary()))&&"pre"!=j.nodeName()&&!j._4e_getBogus()&&j._4e_appendBogus()}if(f&&f.collapsed&&!h.block){if("body"==r.nodeName()){if((h=f.fixBlock(i,"p"))&&h[0]!=n[0].lastChild&&h._4e_outerHtml().match(c))if((r=h.next(o))&&r[0].nodeType==q.ELEMENT_NODE&&!a[r])f.moveToElementEditablePosition(r),h._4e_remove();else if((r=h.prev(o))&&r[0].nodeType==q.ELEMENT_NODE&&!a[r])f.moveToElementEditablePosition(r,r._4e_outerHtml().match(c)?d:i),h._4e_remove();f.select();b.notifySelectionChange()}h=
new k.Range(g);h.moveToElementEditablePosition(n,i);"body"!==(new k.ElementPath(h.startContainer)).blockLimit.nodeName()&&(n=(new p(g.createElement("p"))).appendTo(n),l.ie||n._4e_appendBogus())}})}var i=!0,d=!1,g=null,l=h.UA,o=h.Event,q=h.DOM,p=h.Node,e=k.SELECTION;return{init:function(b){b.docReady(function(){l.ie?(j(b),f(b)):c(b)});a(b)}}},{requires:["editor"]});
KISSY.add("editor/core/styles",function(h){function k(b){return!z.attr(b,"_ke_bookmark")}function j(b,a){for(var e in b)b.hasOwnProperty(e)&&(h.isString(b[e])?b[e]=b[e].replace(M,function(b,e){return a[e]}):j(b[e],a))}function f(b,a){a&&(b=h.clone(b),j(b,a));var e=this.element=this.element=(b.element||"*").toLowerCase();this.type=this.type="#"==e||J[e]?A.STYLE_BLOCK:K[e]?A.STYLE_OBJECT:A.STYLE_INLINE;this._={definition:b}}function c(b,a){var e=a?this.removeFromRange:this.applyToRange;b.body.focus();
for(var d=new B(b),g=d.getRanges(),c=0;c<g.length;c++)e.call(this,g[c]);d.selectRanges(g)}function a(b,a,e){var d=b.element;"*"==d&&(d="span");a=new F(a.createElement(d));e&&e._4e_copyAttributes(a);e=b._.definition;b=e.attributes;e=f.getStyleText(e);if(b)for(var g in b)b.hasOwnProperty(g)&&a.attr(g,b[g]);e&&(a[0].style.cssText=e);return a}function i(b){var e=b.createBookmark(x),c=b.createIterator();c.enforceRealBlocks=x;c.enlargeBr=x;for(var i,m=b.document;i=c.getNextParagraph();){var f=a(this,m,
i),h=f,f="pre"==h.nodeName,n="pre"==i.nodeName,r=!f&&n;f&&!n?(n=i,r=n.html(),r=d(r,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),r=r.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),r=r.replace(/([ \t\n\r]+|&nbsp;)/g," "),r=r.replace(/<br\b[^>]*>/gi,"\n"),E.ie?(n=n[0].ownerDocument.createElement("div"),n.appendChild(h[0]),h[0].outerHTML="<pre>"+r+"</pre>",h=new F(n.firstChild),h._4e_remove()):h.html(r)):r?h=l(g(i),h):i._4e_moveChildren(h);i[0].parentNode.replaceChild(h[0],i[0]);if(f&&(i=h,f=void 0,(f=i._4e_previousSourceNode(x,
z.ELEMENT_NODE))&&"pre"==f.nodeName()))h=d(f.html(),/\n$/,"")+"\n\n"+d(i.html(),/^\n/,""),E.ie?i[0].outerHTML="<pre>"+h+"</pre>":i.html(h),f._4e_remove()}b.moveToBookmark(e)}function d(b,a,e){var d="",g="",b=b.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(b,a,e){a&&(d=a);e&&(g=e);return""});return d+b.replace(a,e)+g}function g(b){var a=[];d(b._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(b,a,e){return a+"</pre>"+
e+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(b,e){a.push(e)});return a}function l(b,a){for(var e=a[0].ownerDocument.createDocumentFragment(),g=0;g<b.length;g++){var c=b[g],c=c.replace(/(\r\n|\r)/g,"\n"),c=d(c,/^[ \t]*\n/,""),c=d(c,/\n$/,""),c=d(c,/^[ \t]+|[ \t]+$/g,function(b,a){return 1==b.length?"&nbsp;":a?" "+Array(b.length).join("&nbsp;"):Array(b.length).join("&nbsp;")+" "}),c=c.replace(/\n/g,"<br>"),c=c.replace(/[ \t]{2,}/g,function(b){return Array(b.length).join("&nbsp;")+" "}),
i=a.clone();i.html(c);e.appendChild(i[0])}return e}function o(b){var e=b.document;if(b.collapsed)e=a(this,e,void 0),b.insertNode(e),b.moveToPosition(e,D.POSITION_BEFORE_END);else{var d=this.element,g=this._.definition,c,i=G[d];i||(c=x,i=G.span);var f=b.createBookmark();b.enlarge(D.ENLARGE_ELEMENT);b.trim();for(var m=b.createBookmark(),l=m.startNode,m=m.endNode,h=l,n;h&&h[0];){var r=w;if(z.equals(h,m))h=v,r=x;else{var o=h[0].nodeType,q=o==z.ELEMENT_NODE?h.nodeName():v;if(q&&h.attr("_ke_bookmark")){h=
h._4e_nextSourceNode(x);continue}if(!q||i[q]&&(h._4e_position(m)|C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!g.childRule||g.childRule(h))){var j=h.parent();if(j&&"a"==d&&j.nodeName()==d)o=a(this,e,void 0),j._4e_moveChildren(o),j[0].parentNode.replaceChild(o[0],j[0]),o._4e_mergeSiblings();else if(j&&j[0]&&((G[j.nodeName()]||G.span)[d]||c)&&(!g.parentRule||g.parentRule(j))){if(!n&&(!q||!G.$removeEmpty[q]||(h._4e_position(m)|
C.POSITION_PRECEDING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_PRECEDING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED))n=new H(e),n.setStartBefore(h);if(o==z.TEXT_NODE||o==z.ELEMENT_NODE&&!h[0].childNodes.length){j=h;for(o=null;(r=!j.next(k))&&(o=j.parent())&&i[o.nodeName()]&&(o._4e_position(l)|C.POSITION_FOLLOWING|C.POSITION_IDENTICAL|C.POSITION_IS_CONTAINED)==C.POSITION_FOLLOWING+C.POSITION_IDENTICAL+C.POSITION_IS_CONTAINED&&(!g.childRule||g.childRule(o));)j=o;n.setEndAfter(j)}}else r=
x}else r=x;h=h._4e_nextSourceNode()}if(r&&n&&!n.collapsed){for(var r=a(this,e,void 0),j=n.getCommonAncestor(),o={},q={},s,p=null,t;r&&j&&r[0]&&j[0];){if(j.nodeName()==d){for(s in g.attributes)if(g.attributes.hasOwnProperty(s)&&!q[s]&&(t=j.attr(p)))r.attr(s)==t?r.removeAttr(s):q[s]=1;for(p in g.styles)if(g.styles.hasOwnProperty(p)&&!o[p]&&(t=j.style(p)))r.style(p)==t?r.style(p,""):o[p]=1;if(!r._4e_hasAttributes()){r=v;break}}j=j.parent()}r?(r[0].appendChild(n.extractContents()),u(this,r),n.insertNode(r),
r._4e_mergeSiblings(),E.ie||r[0].normalize()):(r=new F(e.createElement("span")),r[0].appendChild(n.extractContents()),n.insertNode(r),u(this,r),r._4e_remove(!0));n=v}}l._4e_remove();m._4e_remove();b.moveToBookmark(f);b.shrink(D.SHRINK_TEXT)}}function q(a){a.enlarge(D.ENLARGE_ELEMENT);var e=a.createBookmark(),d=e.startNode;if(a.collapsed){for(var g=new I(d.parent()),c,i=0,f;i<g.elements.length&&(f=g.elements[i])&&!(f==g.block||f==g.blockLimit);i++)if(this.checkElementRemovable(f)){var l=a.checkBoundaryOfElement(f,
D.END),h=!l&&a.checkBoundaryOfElement(f,D.START);h||l?(c=f,c.match=h?"start":"end"):(f._4e_mergeSiblings(),f.nodeName()!=this.element?(l=b(this),m(f,l[f.nodeName()]||l["*"])):t(this,f))}if(c){f=d;for(i=0;;i++){l=g.elements[i];if(z.equals(l,c))break;else if(l.match)continue;else l=l.clone();l[0].appendChild(f[0]);f=l}f["start"==c.match?"insertBefore":"insertAfter"](c)}}else{var n=e.endNode,r=this,g=function(){for(var b=new I(d.parent()),a=new I(n.parent()),e=v,g=v,c=0;c<b.elements.length;c++){var i=
b.elements[c];if(i==b.block||i==b.blockLimit)break;r.checkElementRemovable(i)&&(e=i)}for(c=0;c<a.elements.length;c++){i=a.elements[c];if(i==a.block||i==a.blockLimit)break;r.checkElementRemovable(i)&&(g=i)}g&&n._4e_breakParent(g);e&&d._4e_breakParent(e)};g();for(c=new F(d[0].nextSibling);c[0]!==n[0];){i=c._4e_nextSourceNode();if(c[0]&&c[0].nodeType==z.ELEMENT_NODE&&this.checkElementRemovable(c)&&(c.nodeName()==this.element?t(this,c):(f=b(this),m(c,f[c.nodeName()]||f["*"])),i[0].nodeType==z.ELEMENT_NODE&&
i.contains(d)))g(),i=new F(d[0].nextSibling);c=i}}a.moveToBookmark(e)}function p(b){var a={};(""+b).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(b,e,d){a[e]=d});return a}function e(b,a){var e="";a!==w?(e=document.createElement("span"),e.style.cssText=b,e=e.style.cssText||""):e=b;return e.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function b(b){if(b._.overrides)return b._.overrides;var a=b._.overrides={},e=b._.definition.overrides;
if(e){h.isArray(e)||(e=[e]);for(var d=0;d<e.length;d++){var g=e[d],c,i,f;"string"==typeof g?c=g.toLowerCase():(c=g.element?g.element.toLowerCase():b.element,i=g.attributes,f=g.styles);g=a[c]||(a[c]={});if(i){c=g.attributes=g.attributes||[];for(var m in i)i.hasOwnProperty(m)&&c.push([m.toLowerCase(),i[m]])}if(f){var g=g.styles=g.styles||[],l;for(l in f)f.hasOwnProperty(l)&&g.push([l.toLowerCase(),f[l]])}}}return a}function t(a,e){var d=a._.definition,g=b(a),c=y.mix(d.attributes,(g[e.nodeName()]||g["*"]||
{}).attributes),d=y.mix(d.styles,(g[e.nodeName()]||g["*"]||{}).styles),g=h.isEmptyObject(c)&&h.isEmptyObject(d),i;for(i in c)if(c.hasOwnProperty(i)&&!(("class"==i||a._.definition.fullMatch)&&e.attr(i)!=s(i,c[i])))g=g||!!e.hasAttr(i),e.removeAttr(i);for(var f in d)d.hasOwnProperty(f)&&!(a._.definition.fullMatch&&e.style(f)!=s(f,d[f],x))&&(g=g||!!e.style(f),e.style(f,""));r(e)}function s(b,a,e){var d=new F("<span>");d[e?"style":"attr"](b,a);return d[e?"style":"attr"](b)}function u(a,e){for(var d=b(a),
g=e.all(a.element),c=g.length;0<=--c;)t(a,new F(g[c]));for(var i in d)if(d.hasOwnProperty(i)&&i!=a.element){g=e.all(i);for(c=g.length-1;0<=c;c--){var f=new F(g[c]);m(f,d[i])}}}function m(b,a){var e,d=a&&a.attributes;if(d)for(e=0;e<d.length;e++){var g=d[e][0],c;if(c=b.attr(g)){var i=d[e][1];(i===v||i.test&&i.test(c)||"string"==typeof i&&c==i)&&b[0].removeAttribute(g)}}if(d=a&&a.styles)for(e=0;e<d.length;e++)if(g=d[e][0],i=b.css(g)){var f=d[e][1];(f===v||f.test&&f.test(c)||"string"==typeof f&&i==f)&&
b.css(g,"")}r(b)}function r(b){if(!b._4e_hasAttributes()){var a=b[0].firstChild,e=b[0].lastChild;b._4e_remove(x);a&&(a.nodeType==z.ELEMENT_NODE&&z._4e_mergeSiblings(a),e&&a!=e&&e.nodeType==z.ELEMENT_NODE&&z._4e_mergeSiblings(e))}}var n=h.Editor,x=!0,w=!1,v=null,y=n.Utils,z=h.DOM,A={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},D=n.RANGE,B=n.Selection,C=n.POSITION,H=n.Range,F=h.Node,E=h.UA,I=n.ElementPath,J={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},G=n.XHTML_DTD,K={embed:1,hr:1,img:1,
li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},L=/\s*(?:;\s*|$)/g,M=/#\((.+?)\)/g;n.STYLE=A;f.prototype={apply:function(b){c.call(this,b,w)},remove:function(b){c.call(this,b,x)},applyToRange:function(b){return(this.applyToRange=this.type==A.STYLE_INLINE?o:this.type==A.STYLE_BLOCK?i:v).call(this,b)},removeFromRange:function(b){return(this.removeFromRange=this.type==A.STYLE_INLINE?q:v).call(this,b)},checkElementRemovable:function(a,d){if(!a)return w;var g=this._.definition,c;
if(a.nodeName()==this.element){if(!d&&!a._4e_hasAttributes())return x;var i=g._AC;if(i)g=i;else{var i={},m=0,l=g.attributes;if(l)for(var h in l)l.hasOwnProperty(h)&&(m++,i[h]=l[h]);if(l=f.getStyleText(g))i.style||m++,i.style=l;i._length=m;g=g._AC=i}if(g._length){for(var n in g)if("_length"!=n&&g.hasOwnProperty(n)){m=a.attr(n)||"";if("style"==n)a:{i=g[n];m=e(m,w);"string"==typeof i&&(i=p(i));"string"==typeof m&&(m=p(m));l=void 0;for(l in i)if(i.hasOwnProperty(l)&&!(l in m&&(m[l]==i[l]||"inherit"==
i[l]||"inherit"==m[l]))){i=w;break a}i=x}else i=g[n]==m;if(i){if(!d)return x}else if(d)return w}if(d)return x}else return x}n=b(this);if(n=n[a.nodeName()]||n["*"]){if(!(g=n.attributes)&&!(c=n.styles))return x;if(g)for(i=0;i<g.length;i++)if(n=g[i][0],n=a.attr(n))if(m=g[i][1],m===v||"string"==typeof m&&n==m||m.test&&m.test(n))return x;if(c)for(i=0;i<c.length;i++)if(n=a.css(c[i][0]))if(g=c[i][1],g===v||"string"==typeof g&&n==g||g.test&&g.test(n))return x}return w},checkActive:function(b){switch(this.type){case A.STYLE_BLOCK:return this.checkElementRemovable(b.block||
b.blockLimit,x);case A.STYLE_OBJECT:case A.STYLE_INLINE:for(var a=b.elements,e=0,d;e<a.length;e++)if(d=a[e],!(this.type==A.STYLE_INLINE&&(z.equals(d,b.block)||z.equals(d,b.blockLimit))))if((this.type!=A.STYLE_OBJECT||d.nodeName()in K)&&this.checkElementRemovable(d,x))return x}return w}};f.getStyleText=function(b){var a=b._ST;if(a)return a;var a=b.styles,d=b.attributes&&b.attributes.style||"",g="";d.length&&(d=d.replace(L,";"));for(var c in a)if(a.hasOwnProperty(c)){var i=a[c],f=(c+":"+i).replace(L,
";");"inherit"==i?g+=f:d+=f}d.length&&(d=e(d));return b._ST=d+g};n.Style=f},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(h){var k=h.Node,j=h.DOM,f=h.UA,c={debugUrl:function(a){var c=h.Config;c.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));-1==a.indexOf("?t")&&(a=-1!=a.indexOf("?")?a+"&":a+"?",a+="t="+encodeURIComponent(c.tag));return c.base+"editor/"+a},lazyRun:function(a,c,d){var g=a[c],f=a[d];a[c]=function(){g.apply(this,arguments);a[c]=a[d];return f.apply(this,arguments)}},getXY:function(a,c,d,g){d=d.defaultView||d.parentWindow;a-=j.scrollLeft(d);c-=j.scrollTop(d);g&&(g=g.defaultView||
g.parentWindow,d!=g&&d.frameElement&&(g=j.offset(d.frameElement,void 0,g),a+=g.left,c+=g.top));return{left:a,top:c}},tryThese:function(a){for(var c,d=0,g=arguments.length;d<g;d++){var f=arguments[d];try{c=f();break}catch(h){}}return c},arrayCompare:function(a,c){if(!a&&!c)return!0;if(!a||!c||a.length!=c.length)return!1;for(var d=0;d<a.length;d++)if(a[d]!==c[d])return!1;return!0},clearAllMarkers:function(a){for(var c in a)a.hasOwnProperty(c)&&a[c]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,
"")},rtrim:function(a){return a.replace(/\s+$/,"")},mix:function(a){for(var c={},d=0;d<arguments.length;d++)c=h.mix(c,arguments[d]);return c},isCustomDomain:function(){if(!f.ie)return!1;var a=document.domain,c=window.location.hostname;return a!=c&&a!="["+c+"]"},isNumber:function(a){return/^\d+(.\d+)?$/.test(h.trim(a))},verifyInputs:function(a){for(var i=0;i<a.length;i++){var d=new k(a[i]),g=h.trim(c.valInput(d)),f=d.attr("data-verify"),d=d.attr("data-warning");if(f&&!RegExp(f).test(g))return alert(d),
!1}return!0},sourceDisable:function(a,c){a.on("sourceMode",c.disable,c);a.on("wysiwygMode",c.enable,c)},resetInput:function(a){var c=a.attr("placeholder");c&&f.ie?(a.addClass("ke-input-tip"),a.val(c)):f.ie||a.val("")},valInput:function(a,c){if(void 0===c)return a.hasClass("ke-input-tip")?"":a.val();a.removeClass("ke-input-tip");a.val(c)},placeholder:function(a,c){a.attr("placeholder",c);f.ie&&(a.on("blur",function(){h.trim(a.val())||(a.addClass("ke-input-tip"),a.val(c))}),a.on("focus",function(){a.removeClass("ke-input-tip");
h.trim(a.val())==c&&a.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(a){var a=h.clone(a),c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];h.isFunction(d)&&(a[c]=d())}return a},map:function(a,c){for(var d=0;d<a.length;d++)a[d]=c(a[d]);return a},ieEngine:document.documentMode||f.ie,preventFocus:function(a){f.ie?a.unselectable(void 0):a.attr("onmousedown","return false;")},injectDom:function(a){h.mix(j,
a);for(var c in a)a.hasOwnProperty(c)&&function(d){k.prototype[d]=function(){var g=[].slice.call(arguments,0);g.unshift(this[0]);return(g=a[d].apply(null,g))&&(g.nodeType||h.isWindow(g))?new k(g):h.isArray(g)&&(g.__IS_NODELIST||g[0]&&g[0].nodeType)?new k(g):g}}(c)},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,h.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],c=0;c<a.length;c++){var d=a[c];h.isFunction(d)?d():(d.destroy&&d.destroy(),d.remove&&d.remove())}this.__res=
[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,d){return d.toUpperCase()})+"Active"}};return h.Editor.Utils=c},{requires:["./base"]});
KISSY.add("editor/core/walker",function(h,k){function j(b,e){if(this._.end)return d;var g,c=this.range,f,h=this.guard,o=this.type,j=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,c.trim(),c.collapsed))return this.end(),d;if(!b&&!this._.guardLTR){var k=c.endContainer[0],p=k.childNodes[c.endOffset];this._.guardLTR=function(b,a){return a&&(k==b||"body"==l.nodeName(b))?!1:b!=p}}if(b&&!this._.guardRTL){var t=c.startContainer[0],D=0<c.startOffset&&t.childNodes[c.startOffset-
1]||null;this._.guardRTL=function(b,a){return a&&(t==b||"body"==l.nodeName(b))?!1:b!=D}}var B=b?this._.guardRTL:this._.guardLTR;f=h?function(b,a){return B(b,a)===i?i:h(b,a)}:B;this.current?g=this.current[j](i,o,f):b?(g=c.endContainer,0<c.endOffset?(g=new q(g[0].childNodes[c.endOffset-1]),f(g)===i&&(g=d)):g=f(g,a)===i?d:g._4e_previousSourceNode(a,o,f,void 0)):(g=c.startContainer,g=new q(g[0].childNodes[c.startOffset]),g.length?f(g)===i&&(g=d):g=f(c.startContainer,a)===i?d:c.startContainer._4e_nextSourceNode(a,
o,f,void 0));for(;g&&!this._.end;){this.current=g;if(!this.evaluator||this.evaluator(g[0])!==i){if(!e)return g}else if(e&&this.evaluator)return i;g=g[j](i,o,f)}this.end();return this.current=d}function f(b){for(var a,e=d;a=j.call(this,b);)e=a;return e}function c(b){this.range=b;this._={}}var a=!0,i=!1,d=null,g=h.UA,l=h.DOM,o=k.XHTML_DTD,q=h.Node;h.augment(c,{end:function(){this._.end=1},next:function(){return j.call(this)},previous:function(){return j.call(this,a)},checkForward:function(){return j.call(this,
i,a)!==i},checkBackward:function(){return j.call(this,a,a)!==i},lastForward:function(){return f.call(this)},lastBackward:function(){return f.call(this,a)},reset:function(){delete this.current;this._={}},_iterator:j});c.blockBoundary=function(b){return function(a){return!(a.nodeType==l.ELEMENT_NODE&&l._4e_isBlockBoundary(a,b))}};c.bookmark=function(b,a){function e(b){return"span"==l.nodeName(b)&&l.attr(b,"_ke_bookmark")}return function(d){var g,c;g=d.nodeType==l.TEXT_NODE&&(c=d.parentNode)&&e(c);g=
b?g:g||e(d);return!!(a^g)}};c.whitespaces=function(b){return function(a){a=a.nodeType==l.TEXT_NODE&&!h.trim(a.nodeValue);return!!(b^a)}};c.invisible=function(b){var a=c.whitespaces();return function(e){e=a(e)||e.nodeType==l.ELEMENT_NODE&&!e.offsetHeight;return!!(b^e)}};var p=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,e=c.whitespaces(),b=c.bookmark(),t=function(a){var d=l.nodeName(a);return b(a)||e(a)||1==a.nodeType&&d in o.$inline&&!(d in o.$empty)};k.Utils.injectDom({_4e_getBogus:function(b){b=new q(b);do b=
b._4e_previousSourceNode();while(b&&t(b[0]));return b&&(!g.ie?"br"==b.nodeName():3==b[0].nodeType&&p.test(b.text()))?b[0]:!1}});return k.Walker=c},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(h){var k=h.Editor;k.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};k.baseZIndex=function(h){return(k.Config.baseZIndex||1E4)+h}},{requires:["./base"]});
KISSY.add("editor",function(h,k,j,f){function c(e,g){var f=e.body;b(function(){e.designMode="on";setTimeout(function(){e.designMode="off";f.focus();arguments.callee.retry||(arguments.callee.retry=a)},50)},function(){e.designMode="off";q.attr(f,"contentEditable",d);q.attr(f,"contentEditable",a);!g&&c(e,1)})}var a=!0,i=h.all,d=!1,g=document,l=h.UA,o=l.ie,q=h.DOM,p=h.Node,e=h.Event,b=j.tryThese,t="document.open();"+(j.isCustomDomain()?'document.domain="'+g.domain+'";':"")+"document.close();",s='<iframe style="width:100%;height:100%;border:none;"  width="100%"  height="100%"  frameborder="0"  title="kissy-editor" '+
(o?' src="javascript:void(function(){'+encodeURIComponent(t)+'}())"':"")+' allowTransparency="true"></iframe>';h.mix(k,{SOURCE_MODE:0,WYSIWYG_MODE:1});var u=k.WYSIWYG_MODE;h.augment(k,{createDom:function(){var b=this.get("textarea"),a;b||this.set("textarea",b=i("<textarea></textarea>"));a=this.get("el");a.addClass(this.get("prefixCls")+"editor-wrap",void 0);a.html('<div class="ke-editor-tools"></div><div class="ke-textarea-wrap"></div><div class=\'ke-editor-status\'></div>');this._UUID=h.guid();var e=
a.one(".ke-textarea-wrap");this.__set("iframeWrapEl",e);this.__set("toolBarEl",a.one(".ke-editor-tools"));this.__set("statusBarEl",a.one(".ke-editor-status"));var d=this.get("width"),g=this.get("height");a.css("width",d);b.css("width","100%");b.css("display","none");e.append(b);e.css("height",g);b.css("height",g)},_uiSetHeight:function(b){var a=this.get("toolBarEl"),e=this.get("statusBarEl"),b=parseInt(b,10),b=b-((a&&a.outerHeight()||0)+(e&&e.outerHeight()||0));this.get("iframeWrapEl").css("height",
b);this.get("textarea").css("height",b)},_uiSetMode:function(b){var a=this,e,d=a.get("textarea");b?(a.execCommand("save"),a.on("docReady",e=function(){a.execCommand("save");a.detach("docReady",e)}),a._setData(d.val())):(d.val(a._getData(1,u)),d[0].focus());d[b?"hide":"show"]();a.get("iframe")[b?"show":"hide"]();a.fire((b?"wysiwyg":"source")+"Mode")},renderUI:function(){function b(){a.detach("docReady",b);if(a.get("focus"))a.focus();else{var e=a.getSelection();e&&e.removeAllRanges()}}var a=this,e=
a.get("textarea");f.register(a);a.get("attachForm")&&e[0].form&&a._attachForm();a.on("docReady",b)},_createIframe:function(b){var a=this,e=new p(s),d=a.get("textarea");d.hasAttr("tabindex")&&e.attr("tabIndex",l.webkit?-1:d.attr("tabIndex"));a.get("iframeWrapEl").prepend(e);a.set("iframe",e);a.__docReady=0;if(l.gecko&&!e.__loaded)e.on("load",function(){a._setUpIFrame(b)},a);else a._setUpIFrame(b)},destructor:function(){var b=this.get("el"),a=this.get("textarea"),d=this.get("document")[0],g=this.get("iframe")[0].contentWindow;
this.sync();k.focusManager.remove(this);e.remove([d,d.documentElement,d.body,g]);h.each(this.__dialogs,function(b){b.destroy&&b.destroy()});this.__commands=0;this.__editor_created_new||(a.insertBefore(b,void 0),a.css({width:this.get("width"),height:this.get("height")}),a.show())},_attachForm:function(){var b=this,a=b.get("textarea"),e=new p(a[0].form);e.on("submit",b.sync,b);b.on("destroy",function(){e.detach("submit",b.sync,b)})},addDialog:function(b,a){this.__dialogs[b]=a},showDialog:function(b,
a){var e=this.__dialogs[b];e.show(a);this.fire("dialogShow",{dialog:e.dialog,pluginDialog:e,dialogName:b})},hasDialog:function(b){return!!this.__dialogs[b]},addCommand:function(b,a){this.__commands[b]=a},hasCommand:function(b){return this.__commands[b]},execCommand:function(b){var a=this.__commands[b],e=h.makeArray(arguments);e.shift();e.unshift(this);if(a)return a.exec.apply(a,e)},_clearIframeDocContent:function(){if(this.get("iframe")){var b=this.get("iframe"),a=b[0].contentWindow,d=this.get("document")[0];
e.remove([d,d.documentElement,d.body,a]);b.remove()}},_getData:function(b,a){var e=this.htmlDataProcessor,d;void 0==a&&(a=this.get("mode"));d=a==u?this.get("document")[0].body.innerHTML:e.toDataFormat(this.get("textarea").val());d=b?e.toHtml(d):e.toServer(d);d=h.trim(d);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(d)&&(d="");return d},_setData:function(b){var a,e=b;if(this.get("mode")!=u)this.get("textarea").val(b);else{if(a=this.htmlDataProcessor)e=a.toDataFormat(b,"p");this._clearIframeDocContent();
this._createIframe(e)}},sync:function(){this.get("textarea").val(this._getData())},_getRawData:function(){return this.get("document")[0].body.innerHTML},_setRawData:function(b){this.get("document")[0].body.innerHTML=b},_prepareIFrameHtml:function(b,a){var e=this.get("customStyle"),d=this.get("customLink"),c="",f=k.Utils.debugUrl("theme/editor-iframe.css");if(d)for(var i=0;i<d.length;i++)c+='<link href="'+d[i]+'" rel="stylesheet"/>';return"<!doctype html><html><head>"+(8===g.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':
"")+"<title>${title}</title><link href='"+f+"' rel='stylesheet'/><style>"+(e||"")+"</style>"+c+"</head><body class='ke-editor'>"+(a||"&nbsp;")+(b?'<script id="ke_actscript" type="text/javascript">'+(j.isCustomDomain()?'document.domain="'+g.domain+'";':"")+'window.parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':"")+"</body></html>"},getSelection:function(){return k.Selection.getSelection(this.get("document")[0])},focus:function(){var b=this.get("document")[0],a=q._4e_getWin(b);l.ie||a&&a.parent&&
a.parent.focus();a&&a.focus();b.body.focus();this.notifySelectionChange()},blur:function(){q._4e_getWin(this.get("document")[0]).blur();this.get("document")[0].body.blur()},addCustomStyle:function(b){var a=this.get("customStyle")||"",a=a+("\n"+b);this.set("customStyle",a);q.addStyleSheet(this.get("iframe")[0].contentWindow,a)},addCustomLink:function(b){var a=this.get("customLink")||[],e=this.get("document")[0];a.push(b);this.set("customLink",a);a=e.createElement("link");a.rel="stylesheet";e.getElementsByTagName("head")[0].appendChild(a);
a.href=b},removeCustomLink:function(b){for(var a=this.get("document")[0],a=q.query("link",a),e=0;e<a.length;e++)a[e].href==b&&q.remove(a[e]);a=this.get("customLink")||[];b=h.indexOf(b,a);-1!=b&&a.splice(b,1)},_setUpIFrame:function(b){function a(){f=c.document;e.__set("document",new p(f));e.__set("window",new p(c));d.detach();f.open("text/html","replace");f.write(g);f.close()}var e=this,d=e.get("iframe"),g=e._prepareIFrameHtml(e._UUID,b),c=d[0].contentWindow,f;d.__loaded=1;try{f=c.document}catch(i){if(d[0].src=
d[0].src,7>o){setTimeout(a,10);return}}a()},docReady:function(b){this.on("docReady",b);this.__docReady&&b.call(this)},_monitor:function(){var b=this;b._monitorId&&clearTimeout(b._monitorId);b._monitorId=setTimeout(function(){var a=b.getSelection();if(a&&!a.isInvalid){var e=a.getStartElement(),d=new k.ElementPath(e);if(!b.__previousPath||!b.__previousPath.compare(d))b.__previousPath=d,b.fire("selectionChange",{selection:a,path:d,element:e})}},100)},notifySelectionChange:function(){this.__previousPath=
null;this._monitor()},insertElement:function(b,e,g){var c=this;if(c.get("mode")===u){c.focus();var f,i=b.nodeName(),l=k.XHTML_DTD,h=k.RANGE,o=l.$block[i],j=c.getSelection(),s=j&&j.getRanges(),t,H,F,E;if(!s||0==s.length){var I=arguments,J=I.callee;setTimeout(function(){J.apply(c,I)},30)}else{c.execCommand("save");for(var G=s.length-1;0<=G;G--){t=s[G];t.deleteContents();f=!G&&b||b.clone(a);e&&e(f);if(o)for(;(F=t.getCommonAncestor(d,a))&&(E=l[F.nodeName()])&&(!E||!E[i]);)F.nodeName()in l.span?t.splitElement(F):
t.checkStartOfBlock()&&t.checkEndOfBlock()?(t.setStartBefore(F),t.collapse(a),F.remove()):t.splitBlock();t.insertNode(f);H||(H=f)}H&&(i=H._4e_nextSourceNode(a),l=c.get("document")[0],E=k.XHTML_DTD,E.$inline[f.nodeName()]?(i=new p(l.createTextNode(" ")),i.insertAfter(H)):i?"br"==i.nodeName()&&E[i.parent().nodeName()].p&&(E=new p("<p>&nbsp;</p>",null,l),i[0].parentNode.replaceChild(E[0],i[0]),i=E):(E=new p("<p>&nbsp;</p>",null,l),E.insertAfter(H),i=E),t.moveToPosition(H,h.POSITION_AFTER_END),i&&i[0].nodeType==
q.ELEMENT_NODE&&t.moveToElementEditablePosition(i),j.selectRanges([t]),c.focus(),f&&f.scrollIntoView(void 0,!1),c._saveLater(),g&&g(f))}}},insertHtml:function(b,a){var e=this,g;if(e.get("mode")===u){if(g=e.htmlDataProcessor)b=g.toDataFormat(b,null,a);e.focus();e.execCommand("save");var c=e.get("document")[0];g=0;if(o){var f=c.selection;"Control"==f.type&&f.clear();try{f.createRange().pasteHTML(b)}catch(i){}}else try{c.execCommand("inserthtml",d,b)}catch(l){setTimeout(function(){if(0==e.getSelection().getRanges().length){var a=
new k.Range(c),g=q.first(c.body,function(b){return 1==b.nodeType&&"br"!=q.nodeName(b)});g||(g=new p(c.createElement("p")),c.body.appendChild(g[0]));a.setStartAt(g,k.RANGE.POSITION_AFTER_START);a.select()}c.execCommand("inserthtml",d,b)},g=100)}setTimeout(function(){e.getSelection().scrollIntoView()},g);e._saveLater(g)}},_saveLater:function(b){var a=this;a.__saveTimer&&(clearTimeout(a.__saveTimer),a.__saveTimer=null);a.__saveTimer=setTimeout(function(){a.execCommand("save")},b||0)},_fixByBindIframeDoc:function(){var b=
this,a=b.get("iframe"),g=b.get("textarea")[0],a=a[0].contentWindow,i=b.get("document")[0];l.webkit&&(e.on(i,"click",function(b){var a=new p(b.target);h.inArray(a.nodeName(),["input","select"])&&b.preventDefault()}),e.on(i,"mouseup",function(b){var a=new p(b.target);h.inArray(a.nodeName(),["input","textarea"])&&b.preventDefault()}));if(l.gecko||o||l.opera){var j;j=(new p('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(g);j.on("focus",function(){b.focus()});
b.activateGecko=function(){l.gecko&&b.__iframeFocus&&j[0].focus()};b.on("destroy",function(){j.detach();j.remove()})}e.on(a,"focus",function(){l.gecko?c(i,d):l.opera&&i.body.focus();b.notifySelectionChange()});if(l.gecko)e.on(i,"mousedown",function(){b.__iframeFocus||c(i,d)});if(o&&(e.on(i,"keydown",function(a){if(a.keyCode in{8:1,46:1}){var e=b.getSelection(),d=e.getSelectedElement();if(d){b.fire("save");var g=e.getRanges()[0].createBookmark();d.remove();e.selectBookmarks([g]);b.fire("save");a.preventDefault()}}}),
"CSS1Compat"==i.compatMode)){var k={33:1,34:1};e.on(i,"keydown",function(a){a.keyCode in k&&setTimeout(function(){b.getSelection().scrollIntoView()},0)})}if(l.webkit)e.on(i,"mousedown",function(a){a=new p(a.target);h.inArray(a.nodeName(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(a)});if(l.gecko)e.on(i,"dragstart",function(b){var a=new p(b.target);a.nodeName()==="img"&&/ke_/.test(a[0].className)&&b.preventDefault()});f.add(b)}});k._initIFrame=function(b){var g=f.getInstance(b),
i=g.get("document")[0],b=i.getElementById("ke_actscript");q.remove(b);g._fixByBindIframeDoc();var h=i.body;o?(h.hideFocus=a,h.disabled=a,h.contentEditable=a,h.removeAttribute("disabled")):setTimeout(function(){l.gecko||l.opera?h.contentEditable=a:l.webkit?h.parentNode.contentEditable=a:i.designMode="on"},0);if(l.gecko||l.opera){var j=i.documentElement;e.on(j,"mousedown",function(b){if(b.target==j){l.gecko&&c(i,d);g.activateGecko()}})}setTimeout(function(){o&&setTimeout(function(){if(i){h.runtimeStyle.marginBottom=
"0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){g.__docReady=1;g.fire("docReady");var b=g.get("disableObjectResizing"),a=g.get("disableInlineTableEditing");if(b||a)try{i.execCommand("enableObjectResizing",d,!b);i.execCommand("enableInlineTableEditing",d,!a)}catch(c){e.on(h,o?"resizestart":"resize",function(e){var d=new p(e.target);(b||d.nodeName()==="table"&&a)&&e.preventDefault()})}},10)};return k},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/focusManager,editor/core/meta".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(h,k){var j={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(f){f.hasCommand("backColor")||f.addCommand("backColor",{exec:function(c,a){c.execCommand("save");k.applyColor(c,a,j);c.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"backColor",title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-back-color"},void 0,j)}}},{requires:["editor","../color/btn","./cmd"]});KISSY.add("editor/plugin/bold/cmd",function(h,k,j){var f=new k.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(c){j.addButtonCmd(c,"bold",f)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"bold",contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 "},void 0,j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubbleview/index",function(h,k,j,f){function c(a){var d=null,g=l[h.stamp(a.editor)];h.each(g,function(e){var b;if(b=e!==a)if(b=e.get("visible")){b=a.get("y");var g=b+a.get("el").outerHeight(),c=e.get("y"),f=c+e.get("el").outerHeight();b=b<=f&&g>=f||b<=c&&g>=c}b&&(d?d.get("y")<e.get("y")&&(d=e):d=e);return d})}var a=h.Event,i={}.a,d=h.DOM,g=k.create(j,[],{},{ATTRS:{zIndex:{value:f.baseZIndex(f.zIndexManager.BUBBLE_VIEW)},elCls:{value:"ke-bubbleview-bubble"},prefixCls:{value:"ke-"},
effect:{value:{effect:"fade",duration:0.3}}}}),l={};g.register=function(f){function j(){u&&(u.hide(),a.remove(n,"scroll",e))}function k(){var b;var a=u.selectedEl,e=u.editor;if(a){var g=e.get("iframe")[0].contentWindow,f=e.get("iframe").offset(),e=f.top,f=f.left,l=f+d.width(g),g=e+d.height(g),h=a.offset(i,window),m=h.top,h=h.left,j=h+a.width(),a=m+a.height(),o;a>g&&m<g?o=g-30:a>e&&a<g&&(o=a);j>f&&h<f?b=f:h>f&&h<l&&(b=h);b=b!==i&&o!==i?[b,o]:i}else b=i;if(b){u.set("xy",b);if(o=c(u))b[1]=o.get("y")+
o.get("el").outerHeight(),u.set("xy",b);u.get("visible")||u.show()}}function e(){u.selectedEl&&(u&&(u.get("el"),u.hide()),x())}function b(){a.on(n,"scroll",e);k()}var t=f.filter,s=f.editor,u=new g({editor:s}),m=h.stamp(s),r=l[m]=l[m]||[];u.init=f.init;if(u.init)u.on("afterRenderUI",function(){u.init()});r.push(u);u.editor=s;s.on("destroy",function(){delete l[m];u.destroy()});s.on("selectionChange",function(a){var a=a.path,e=a.elements;if(a&&e&&(a=a.lastElement))(a=t(a))?(u.selectedEl=a,u.hide(),h.later(b,
10)):u&&j()});s.on("sourceMode",j);var n=s.get("iframe")[0].contentWindow,x=h.buffer(k,350)};return g},{requires:["uibase","overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(h,k,j){function f(a){return a&&-1==a.indexOf("<")?a:0}var c=j.create([j.Box.Render],{_updateHref:function(){this.get("el").attr("href","javascript:void('"+(f(this.get("text"))||f(this.get("title")))+"')")},bindUI:function(){var a=this,c=a.get("keepFocus"),d=a.get("el");d.on("click",a._action,a);c&&d.unselectable();d.on("mousedown",function(g){"off"==a.get("state")&&d.addClass("ke-triplebutton-active");c&&g.halt()});d.on("mouseup mouseleave",function(){"off"==
a.get("state")&&d.hasClass("ke-triplebutton-active")&&setTimeout(function(){d.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"));this._updateHref()},_uiSetContentCls:function(a){var c=this.get("el");void 0!==a&&(c.html("<span class='ke-toolbar-item "+a+"' />"),this.get("keepFocus")&&c.unselectable(void 0))},_uiSetText:function(a){this.get("el").html(a);this._updateHref()},_uiSetState:function(a,c){this["_"+a](c)},disable:function(){this.set("state",
"disabled")},enable:function(){"disabled"==this.get("state")&&this.set("state",this._savedState)},_action:function(a){this.fire(this.get("state")+"Click",{TripleEvent:a});this.fire("click",{TripleClickType:this.get("state")+"Click"});this.get("keepFocus")||this.get("el")[0].focus()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.get("el").removeClass("ke-triplebutton-off ke-triplebutton-disabled").addClass("ke-triplebutton-on")},_off:function(){this.get("el").removeClass("ke-triplebutton-on ke-triplebutton-disabled").addClass("ke-triplebutton-off")},
_disabled:function(a){var c=this.get("el");this._savedState=a.prevVal;c.removeClass("ke-triplebutton-off ke-triplebutton-on").addClass("ke-triplebutton-disabled")}},{name:"editor/plugin/button",ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elTagName:{value:"a"},title:{},contentCls:{},text:{},keepFocus:{value:!0}}});c.ON="on";c.OFF="off";c.DISABLED="disabled";c.ON_CLASS="ke-triplebutton-on";c.OFF_CLASS="ke-triplebutton-off";c.DISABLED_CLASS="ke-triplebutton-disabled";
k.TripleButton=c;k.prototype.addButton=function(a,f,d){var d=d||c,g=this,l=new d(h.mix({render:g.get("toolBarEl"),autoRender:!0,editor:g},a));h.mix(l,f);l.init&&l.init();g.on("selectionChange",function(){g.get("mode")!=k.SOURCE_MODE&&l.selectionChange&&l.selectionChange.apply(l,arguments)});l.on("click",function(a){var d=a.TripleClickType;l[d]&&l[d].apply(l,arguments)});l.get("mode")==k.WYSIWYG_MODE&&(g.on("wysiwygMode",l.enable,l),g.on("sourceMode",l.disable,l));g.on("destroy",function(){l.destroy()});
return l};return c},{requires:["editor","uibase"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(h,k){function j(a){this.editor=a;this._init()}var f=h.Node,c=k.SOURCE_MODE,a=k.WYSIWYG_MODE;h.augment(j,{_init:function(){var a=this.editor,d=a.get("statusBarEl");this.holder=(new f("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(d);(this.el=this.holder.one("input")).on("click",
this._check,this);a.on("wysiwygMode",this._wysiwygmode,this);a.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var f=this.editor;this.el.attr("checked")?f.set("mode",c):f.set("mode",a)},destroy:function(){this.holder.remove()}});return{init:function(a){var d=new j(a);a.on("destroy",function(){d.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(h,k,j,f,c){function a(){a.superclass.constructor.apply(this,arguments)}var i=h.Node;h.DOM.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var d=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],g;(function(){g="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var a=0;3>a;a++){g+="<div class='ke-color-palette'><table>";for(var c=d[a],f=c.length/8,i=0;i<f;i++){g+="<tr>";for(var e=0;8>e;e++){var b="#"+c[8*i+e];g+="<td>";g+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+b+"'></a>";g+="</td>"}g+="</tr>"}g+="</table></div>"}g+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();h.extend(a,j,{offClick:function(){this._prepare()},onClick:function(){this.colorWin&&this.colorWin.hide()},_prepare:function(){var a=
this,d=a.get("editor"),i;a.colorWin=new f({elAttrs:{tabindex:0},elCls:"ke-popup",content:g,autoRender:!0,width:170,zIndex:k.baseZIndex(k.zIndexManager.POPUP_MENU)});var h=a.colorWin;i=h.get("contentEl");i.on("click",a._selectColor,a);h.get("el").on("blur",function(){h.hide()});h.on("show",a.bon,a);h.on("hide",a.boff,a);i.one(".ke-color-others").on("click",function(e){e.halt();h.hide();c.useDialog(d,"color/colorPicker/dialog",a.get("cmdType"))});a._prepare=a._show;a._show()},_show:function(){var a=
this.get("el"),d=this.colorWin;d.align(a,["bl","tl"],[0,2]);d.show();d.get("el")[0].focus()},_selectColor:function(a){a.halt();a=new i(a.target);a.hasClass("ke-color-a")&&this.get("editor").execCommand(this.get("cmdType"),a.style("background-color"))},destroy:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{mode:{value:k.WYSIWYG_MODE}}});return a},{requires:["editor","../button/","../overlay/","../dialogLoader/"]});
KISSY.add("editor/plugin/color/cmd",function(h,k){return{applyColor:function(h,f,c){var a=h.get("document")[0];h.execCommand("save");f?(new k.Style(c,{color:f})).apply(a):(new k.Style(c,{color:"inherit"})).remove(a);h.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(h,k,j){function f(){f.superclass.constructor.apply(this,arguments)}var c=h.all,a=h.Event;f.register=function(d){function g(){i.hide()}var i=new f(d),h=d.editor;i.editor=h;h.on("destroy",function(){i.destroy()});h.on("sourceMode",g);h.docReady(function(){var j=h.get("document")[0];a.on(j,"mousedown",g);a.delegate(j,"contextmenu",d.filter,function(a){f.hide(h);var e=c(a.target);a.halt();var b=a.pageX,d=a.pageY;b||(a=e._4e_getOffset(void 0),b=a.left,
d=a.top);setTimeout(function(){i.selectedEl=e;i.show(k.Utils.getXY(b,d,j,document));f.show(i)},30)})});return i};var i={};f.hide=function(a){(a=i[h.stamp(a)])&&a.hide()};f.show=function(a){i[h.stamp(a.editor)]=a};h.extend(f,h.Base,{_init:function(){var a=this,g=a.get("handlers");a.menu=new j({autoRender:!0,width:a.get("width"),elCls:"ke-menu"});var f=a.menu.get("contentEl"),i;for(i in g){var k=c("<a href='#'>"+i+"</a>");f.append(k);g.hasOwnProperty(i)&&function(g,e){g.unselectable(void 0);g.on("click",
function(b){b.halt();g.hasClass("ke-menuitem-disable",void 0)||(a.hide(),h.later(e,30,!1,a))})}(k,g[i])}},destroy:function(){var a;(a=this.menu)&&a.destroy()},hide:function(){var a;(a=this.menu)&&a.hide()},_realShow:function(a){var g=this.menu;k.fire("contextmenu",{contextmenu:this});g.set("xy",[a.left,a.top]);var c=this.get("statusChecker"),f=this.editor;c&&g.get("contentEl").children("a").each(function(a){var d=c[h.trim(a.text())];d&&(d(f)?a.removeClass("ke-menuitem-disable",void 0):a.addClass("ke-menuitem-disable",
void 0))});g.show()},show:function(a){this._init();this.show=this._realShow;this.show(a)}});return f},{requires:["editor","overlay"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(h,k,j){function f(b){return b.nodeType==g.ELEMENT_NODE&&"li"==g.nodeName(b)}function c(b,a,e){for(var d=b.startContainer,c=b.endContainer;d&&!d.parent().equals(a);)d=d.parent();for(;c&&!c.parent().equals(a);)c=c.parent();if(d&&c){for(var f=d,d=[],h=!1;!h;)f.equals(c)&&(h=!0),d.push(f),f=f.next();if(!(1>d.length)){var p=a._4e_parents(!0,void 0);p.each(function(b,a){p[a]=b});for(c=0;c<p.length;c++)if(i[p[c].nodeName()]){a=p[c];break}for(var f="indent"==
e?1:-1,c=d[0],h=d[d.length-1],d={},y=j.listToArray(a,d),z=y[h.data("listarray_index")].indent,c=c.data("listarray_index");c<=h.data("listarray_index");c++){y[c].indent+=f;var A=y[c].parent;y[c].parent=new l(A[0].ownerDocument.createElement(A.nodeName()))}for(c=h.data("listarray_index")+1;c<y.length&&y[c].indent>z;c++)y[c].indent+=f;h=j.arrayToList(y,d,null,"p");f=[];if("outdent"==e){var D;if((D=a.parent())&&"li"==D.nodeName())for(var e=h.listNode.childNodes,B,c=e.length-1;0<=c;c--)(B=new l(e[c]))&&
"li"==B.nodeName()&&f.push(B)}h&&(g.insertBefore(h.listNode[0]||h.listNode,a[0]||a),a.remove());if(f&&f.length)for(c=0;c<f.length;c++){for(B=a=f[c];(B=B.next())&&B.nodeName()in i;)o.ie&&!a.first(function(b){return q(b)&&t(b)})&&a[0].appendChild(b.document.createTextNode("\u00a0")),a[0].appendChild(B[0]);g.insertAfter(a[0],D[0])}k.Utils.clearAllMarkers(d)}}}function a(a,d){var c=parseInt(a.style(p),10);isNaN(c)&&(c=0);c+=("indent"==d?1:-1)*e;if(0>c)return!1;c=Math.max(c,0);c=Math.ceil(c/e)*e;a.css(p,c?
c+b:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var i={ol:1,ul:1},d=k.Walker,g=h.DOM,l=h.Node,o=h.UA,q=d.whitespaces(!0),p="margin-left",e=40,b="px",t=d.bookmark(!1,!0);return{checkOutdentActive:function(b){var a=b.blockLimit;return b.contains(i)?!0:(b=b.block||a)&&b.style(p)},addCommand:function(b,e){b.hasCommand(e)||b.addCommand(e,{exec:function(b){b.execCommand("save");var h=b.getSelection(),l=h&&h.getRanges()[0];if(l){for(var j=l.startContainer,k=l.endContainer,o=l.getCommonAncestor();o&&
!(o[0].nodeType==g.ELEMENT_NODE&&i[o.nodeName()]);)o=o.parent();o&&j[0].nodeType==g.ELEMENT_NODE&&j.nodeName()in i&&(j=new d(l),j.evaluator=f,l.startContainer=j.next());o&&k[0].nodeType==g.ELEMENT_NODE&&k.nodeName()in i&&(j=new d(l),j.evaluator=f,l.endContainer=j.previous());k=h.createBookmarks(!0);if(o){for(j=o.first();j&&"li"!=j.nodeName();)j=j.next();var q=l.startContainer;(!(j[0]==q[0]||j.contains(q))||!a(o,e))&&c(l,o,e)}else{l=l.createIterator();l.enforceRealBlocks=!0;for(l.enlargeBr=!0;o=l.getNextParagraph();)a(o,
e)}h.selectBookmarks(k)}b.execCommand("save");b.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(h,k,j){var f,c={loading:function(){f||(f=new k({x:0,width:6==h.UA.ie?h.DOM.docWidth():"100%",y:0,zIndex:j.baseZIndex(j.zIndexManager.LOADING),prefixCls:"ke-",elCls:"ke-global-loading"}));f.set("height",h.DOM.docHeight());f.show();f.loading()},unloading:function(){f.hide()}};return{useDialog:function(a,f,d){a.hasDialog(f)?a.showDialog(f,d):(c.loading(),h.use("editor/plugin/"+f,function(g,h){c.unloading();a.addDialog(f,new h(a));a.showDialog(f,d)}))}}},
{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(h,k,j,f,c){function a(b,a,e){for(b+="";b.length<a;)b=e+b;return b}function i(b){h.isNumber(b)&&(b=new Date(b));return b instanceof Date?[b.getFullYear(),"-",a(b.getMonth()+1,2,"0"),"-",a(b.getDate(),2,"0")," ",a(b.getHours(),2,"0"),":",a(b.getMinutes(),2,"0"),":",a(b.getSeconds(),2,"0")].join(""):b}function d(b){this.editor=b;this._init()}function g(b){var a=new d(b);b.on("destroy",function(){a.destroy()})}var l=h.Node,o=h.Event,q=h.JSON,p=k.Utils.addRes,
e=k.Utils.destroyRes;h.augment(d,{_getSaveKey:function(){var b=this.editor.get("pluginConfig");return b.draft&&b.draft.saveKey||"ke-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var b=j.getItem(this._getSaveKey()),a=[];b&&(a=j==window.localStorage?q.parse(decodeURIComponent(b)):b);this.drafts=a}return this.drafts},_init:function(){var b=this,a=b.editor,e=a.get("statusBarEl"),d=a.get("pluginConfig");d.draft=d.draft||{};b.draftInterval=d.draft.interval=d.draft.interval||5;b.draftLimit=
d.draft.limit=d.draft.limit||5;e=(new l("<div class='ke-draft'><span class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+d.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);b.timeTip=(new l("<span class='ke-draft-time'/>")).appendTo(e);var g=(new l("<a href='#' onclick='return false;' class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(e),f=new c({container:e,menuContainer:document.body,doc:a.get("document")[0],
width:"85px",popUpWidth:"225px",align:["r","t"],emptyText:"&nbsp;&nbsp;&nbsp;\u5c1a\u65e0\u7f16\u8f91\u5668\u5386\u53f2\u5b58\u5728",title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});b.versions=f;f.on("select",function(){f.detach("select",arguments.callee);b.sync()});g.on("click",function(a){b.save(!1);a.halt()});p.call(b,g);a.get("textarea")[0].form&&function(){function e(){b.save(!0)}var d=a.get("textarea")[0].form;o.on(d,"submit",e);p.call(b,function(){o.remove(d,"submit",e)})}();var i=setInterval(function(){b.save(!0)},6E4*b.draftInterval);p.call(b,function(){clearInterval(i)});
f.on("click",b.recover,b);p.call(b,f);b.holder=e;if(d.draft.helpHtml){var h=(new l('<a tabindex="0" hidefocus="hidefocus" class="ke-draft-help ke-triplebutton-off" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(e);h.on("click",function(){h[0].focus();b.helpPopup&&b.helpPopup.get("visible")?b.helpPopup.hide():b._prepareHelp()});h.on("blur",function(){b.helpPopup&&b.helpPopup.hide()});b.helpBtn=h;p.call(b,h);k.Utils.lazyRun(b,"_prepareHelp","_realHelp")}p.call(b,
e)},_prepareHelp:function(){var a=this.editor.get("pluginConfig").draft,a=new l(a.helpHtml||""),e=new l("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
a.append(e);a.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new f({content:a,autoRender:!0,width:a.width()+"px",mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=e},_realHelp:function(){var a=this.helpPopup,e=this.helpBtn,d=a.arrow;a.show();e=e.offset();a.get("el").offset({left:e.left-a.get("el").width()+17,top:e.top-a.get("el").height()-7});d.offset({left:e.left-2,top:e.top-8})},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility",
"")},sync:function(){var a=this.draftLimit,e=this.timeTip,d=this.versions,c=this._getDrafts();c.length>a&&c.splice(0,c.length-a);for(var a=[],g,f=0;f<c.length;f++)g=c[f],g=(g.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+i(g.date),a.push({name:g,value:f});d.set("items",a.reverse());e.html(g);j.setItem(this._getSaveKey(),j==window.localStorage?encodeURIComponent(q.stringify(c)):c)},save:function(a){var e=this._getDrafts(),d=this.editor.get("formatData");d&&(e[e.length-1]&&d==e[e.length-1].content&&(e.length-=1),this.drafts=
e.concat({content:d,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var e=this.editor,d=this.versions,c=this._getDrafts(),g=a.newVal;d.reset("value");confirm("\u786e\u8ba4\u6062\u590d "+i(c[g].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(e.execCommand("save"),e.set("data",c[g].content),e.execCommand("save"));a.halt()},destroy:function(){e.call(this)}});return{init:function(a){j.ready?j.ready(function(){g(a)}):g(a)}}},{requires:["editor","../localStorage/","overlay","../select/"]});
KISSY.add("editor/plugin/dragUpload/index",function(h,k){var j=h.Node,f=h.Event,c=k.Utils,a=h.DOM;return h.UA.ie?void 0:{init:function(i){function d(b){b=b.originalEvent.target;"img"==a.nodeName(b)&&b.src.match(/^file:\/\//)&&(s[b.src]=b)}function g(a,b){var d=new window.FileReader;d.onload=function(c){var g=a.name,c=c.target.result,f=new XMLHttpRequest;f.open("POST",e,!0);f.onreadystatechange=function(){if(4==f.readyState){if(200==f.status||304==f.status){if(""!=f.responseText){var a=window.JSON.parse(f.responseText);
b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();f.onreadystatechange=null}};g="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+o+'"; filename="'+encodeURIComponent(g)+'"\r\n');g+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";g+=c+"\r\n";p=k.Utils.normParams(p);for(var i in p)p.hasOwnProperty(i)&&(g+="------kissy-editor-yiminghe\r\n",g+='Content-Disposition: form-data; name="'+i+'"\r\n\r\n',g+=p[i]+"\r\n");g+="------kissy-editor-yiminghe--";f.setRequestHeader("Content-Type",
"multipart/form-data, boundary=----kissy-editor-yiminghe");f.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+g.length+"\r\n"+g+"\r\n");d.onload=null};d.readAsBinaryString(a)}var l=i.get("pluginConfig").dragUpload||{},o=l.fileInput||"Filedata",q=l.sizeLimit||Number.MAX_VALUE,p=l.serverParams||{},e=l.serverUrl||"",b=RegExp((l.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),t=i.get("document")[0],s={},u=!1;f.on(t,"dragenter",function(){u||
(f.on(t,"DOMNodeInserted",d),u=!0)});f.on(t,"drop",function(e){f.remove(t,"DOMNodeInserted",d);u=!1;e.halt();var e=e.originalEvent,i,l;h.isEmptyObject(s)?(l=t.elementFromPoint(e.clientX,e.clientY),i=l.lastChild):(h.each(s,function(b){"img"==a.nodeName(b)&&(i=b.nextSibling,l=b.parentNode,a.remove(b))}),s={});e=e.dataTransfer;e.dropEffect="copy";if(e=e.files)for(var k=0;k<e.length;k++){var o=e[k],p=o.size;if(o.name.match(b)&&!(p/1E3>q)){var p=new j("<img src='"+c.debugUrl("theme/tao-loading.gif")+"'/>"),
y=p[0];l.insertBefore(y,i);var z=a.nodeName(y.parentNode);("head"==z||"html"==z)&&a.insertBefore(y,t.body.firstChild);g(o,p)}}});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var e=new (window.BlobBuilder||window.WebKitBlobBuilder),d=a.length,g=new window.Uint8Array(d),c=0;c<d;c++)g[c]=a.charCodeAt(c);e.append(g.buffer);this.send(e.getBlob(b))})}}},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(h,k){function j(c){this.cfg=c;this._cache=[];this._init()}var f=h.Node;h.augment(j,{_init:function(){var c=this.cfg.editor;this.holder=new f("<span>");this.holder.appendTo(c.get("statusBarEl"),void 0);c.on("selectionChange",this._selectionChange,this);k.Utils.sourceDisable(c,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(c){var a=this.cfg.editor,i=this.holder,
c=c.path.elements,d,g;d=this._cache;for(g=0;g<d.length;g++)d[g].remove();this._cache=[];for(g=0;g<c.length;g++){d=c[g];var h=d.attr("_ke_real_element_type")||d.nodeName(),j=new f("<a href='javascript(\""+h+"\")' class='ke-element-path'>"+h+"</a>");this._cache.push(j);(function(d){j.on("click",function(c){c.halt();a.focus();setTimeout(function(){a.getSelection().selectElement(d)},50)})})(d);i.prepend(j)}},destroy:function(){this.holder.remove()}});return{init:function(c){var a=new j({editor:c});c.on("destroy",
function(){a.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(h,k){var j=h.Node,f=h.DOM,c=k.Utils.debugUrl("theme/spacer.gif"),a=h.require("htmlparser");h.augment(k,{createFakeElement:function(a,g,f,i,k,p){var e=a.attr("style")||"";a.attr("width")&&(e="width:"+a.attr("width")+"px;"+e);a.attr("height")&&(e="height:"+a.attr("height")+"px;"+e);var b=h.trim(a.attr("class")),a={"class":g+" "+b,src:c,_ke_realelement:encodeURIComponent(k||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:e};p&&delete p.width;
p&&delete p.height;p&&h.mix(a,p,!1);f&&(a._ke_real_element_type=f);i&&(a._ke_resizable=i);return new j("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=f.ELEMENT_NODE)return null;var a=decodeURIComponent(a.attr("_ke_realelement")),c=new j("<div>",null,this.get("document")[0]);c.html(a);return c.first(function(a){return a.nodeType==f.ELEMENT_NODE}).remove()}});var i={tags:{$:function(d){var c=d.getAttribute("_ke_realelement"),f;c&&(f=(new a.Parser(decodeURIComponent(c))).parse());
if(c=f&&f.childNodes[0]){if(f=d.getAttribute("style")){var i=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f),d=i&&i[1];f=(i=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&i[1];d&&c.setAttribute("width",d);f&&c.setAttribute("height",f)}return c}}}};return{init:function(d){var g=(d=d.htmlDataProcessor)&&d.htmlFilter;d.createFakeParserElement||(g&&g.addRules(i),h.mix(d,{createFakeParserElement:function(d,g,f,i,e){var b;b=new a.BasicWriter;d.writeHtml(b);b=b.getHtml();var j=d.getAttribute("style")||"";d.getAttribute("width")&&
(j="width:"+d.getAttribute("width")+"px;"+j);d.getAttribute("height")&&(j="height:"+d.getAttribute("height")+"px;"+j);var k=h.trim(d.getAttribute("class")),d={"class":g+" "+k,src:c,_ke_realelement:encodeURIComponent(b),_ke_real_node_type:d.nodeType+"",style:j,align:d.getAttribute("align")||""};e&&delete e.width;e&&delete e.height;e&&h.mix(d,e,!1);f&&(d._ke_real_element_type=f);i&&(d._ke_resizable="_ke_resizable");return new a.Tag("img",d)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(h,k,j){function f(a){this._init(a)}function c(d){var c=h.isString(d)?d.match(/(\d)+/g):d;h.isArray(c)&&(d=parseFloat(c[0]+"."+a(c[1],3)+a(c[2],5)));return d||0}function a(a,d){for(var e=(a+"").length;e++<d;)a="0"+a;return a}var i={};h.augment(f,h.EventTarget,{_init:function(a){var d=h.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var e=a.flashVars,b=a.params;h.mix(a.attrs,{id:d,width:"100%",height:"100%"},
!1);h.mix(b,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);h.mix(e,{shareData:!1,useCompression:!1},!1);b={YUISwfId:d,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(b={swfID:d,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});h.mix(e,b);i[d]=this;this.id=d;this.swf=j.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var d=this,e=0;e<a.length;e++)(function(a){d[a]=function(){return d._callSWF(a,h.makeArray(arguments))}})(a[e])},
_callSWF:function(a,d){d=d||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,d)}catch(e){var b="";0!==d.length&&(b="'"+d.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+b+");"))(this)}},_eventHandler:function(a){var d=a.type;"log"!==d&&d&&this.fire(d,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete i[this.id]}});f.EventHandler=function(a,d){var e=i[a];e&&setTimeout(function(){e._eventHandler.call(e,d)},100)};k.FlashBridge=
f;var d=h.UA,g,l,o=!0;d.fpv=function(a){if(a||o){o=!1;var d;if(navigator.plugins&&navigator.mimeTypes.length)d=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{d=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(e){}g=!d?void 0:d.match(/(\d)+/g);l=c(g)}return g};d.fpvGEQ=function(a,g){o&&d.fpv(g);return!!l&&l>=c(a)};return f},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(h,k,j,f,c,a){function i(){i.superclass.constructor.apply(this,arguments);this._init()}var d=h.Node;i.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},contextMenuHandlers:{}};h.extend(i,h.Base,{_init:function(){var a=this,d=a.get("cls"),c=a.get("editor"),i=a.get("contextMenuHandlers");j.register({editor:c,filter:"."+d,width:"120px",handlers:i});f.register({filter:function(a){return a.hasClass(d,void 0)&&a},editor:c,init:function(){var d=this,e=d.get("contentEl");
e.html(h.substitute(' <a class="ke-bubbleview-url" target="_blank" href="#">{label}</a>   |    <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>',{label:a.get("label")}));var b=e.one(".ke-bubbleview-url"),f=e.one(".ke-bubbleview-change"),i=e.one(".ke-bubbleview-remove");k.Utils.preventFocus(e);f.on("click",function(b){a.show(d.selectedEl);b.halt()});i.on("click",function(a){if(h.UA.webkit){var b=c.getSelection().getRanges();
if(b=b&&b[0])b.collapse(!0),b.select()}d.selectedEl.remove();d.hide();c.notifySelectionChange();a.halt()});d.on("show",function(){var e=d.selectedEl;e&&a._updateTip(b,e)})}});c.docReady(function(){c.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(d){return a.getUrl(d)},_updateTip:function(a,d){var c=this.get("editor").restoreRealElement(d);c&&(c=this._getFlashUrl(c),a.attr("href",c))},_dbClick:function(a){var c=new d(a.target);"img"===c.nodeName()&&c.hasClass(this.get("cls"),
void 0)&&(this.show(c),a.halt())},show:function(a){var d=this.get("editor");c.useDialog(d,this.get("type")+"/dialog",a)}});return i},{requires:["editor","../contextmenu/","../bubbleview/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(h){var k=h.DOM,j=h.Node,f=h.UA,c={insertFlash:function(a,f,d,g,h,j){f=c.createSWF(f,{attrs:d},a.get("document")[0]);d=a.createFakeElement(f.el,g||"ke_flash",h||"flash",!0,f.html,d);a.insertElement(d,null,j)},isFlashEmbed:function(a){return"application/x-shockwave-flash"==a.getAttribute("type")||/\.swf(?:$|\?)/i.test(a.getAttribute("src")||"")},getUrl:function(a){var c="";if("object"==a.nodeName())for(var a=a[0].childNodes,d=0;d<a.length;d++)1==
a[d].nodeType&&("movie"==(k.attr(a[d],"name")||"").toLowerCase()?c=k.attr(a[d],"value"):"embed"==k.nodeName(a[d])?c=k.attr(a[d],"src"):"object"==k.nodeName(a[d])&&(c=k.attr(a[d],"data")));else"embed"==a.nodeName()&&(c=a.attr("src"));return c},createSWF:function(a,c,d){var g=c.attrs||{},f=c.flashVars,k="",q="",c=c.params||{},p="",d=d||document;h.mix(g,{wmode:"transparent"});for(var e in g)g.hasOwnProperty(e)&&(k+=e+"='"+g[e]+"' ");h.mix(c,{quality:"high",movie:a,wmode:"transparent"});for(var b in c)c.hasOwnProperty(b)&&
(q+="<param name='"+b+"' value='"+c[b]+"'/>");if(f){for(var t in f)f.hasOwnProperty(t)&&(p+="&"+t+"="+encodeURIComponent(f[t]));p=p.substring(1)}a="<object "+k+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+q+(p?'<param name="flashVars" value="'+p+'"/>':"")+"<embed "+k+" "+(p?'FlashVars="'+p+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+a+'"  type="application/x-shockwave-flash"/></object>';return{el:new j(a,null,d),html:a}},createSWFRuntime2:function(a,
i,d){var d=d||document,g=(new j("<div style='width:0;height:0;overflow:hidden;'>",null,d)).appendTo(d.body),g=c.createSWF.apply(this,arguments).el.appendTo(g);f.ie||(g=g.one("object"));return g[0]},createSWFRuntime:function(a,c,d){var g=c.attrs||{},l=c.flashVars||{},o=c.params||{},q="",p="",e="",d=d||document;g.id=g.id||h.guid("ke-runtimeflash-");for(var b in g)g.hasOwnProperty(b)&&(q+=b+"='"+g[b]+"' ");for(var t in o)o.hasOwnProperty(t)&&(p+="<param name='"+t+"' value='"+o[t]+"'/>");for(var s in l)l.hasOwnProperty(s)&&
(e+="&"+s+"="+encodeURIComponent(l[s]));var e=e.substring(1),a=f.ie?"<object "+q+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+p+'<param name="movie" value="'+a+'" />'+(e?'<param name="flashVars" value="'+e+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+a+"' "+q+">"+p+(e?'<param name="flashVars" value="'+e+'"/>':"")+"</object>",u=c.holder;u||(u=(new j("<div style='"+(c.style?c.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,d)).appendTo(d.body),
setTimeout(function(){u.offset({left:k.scrollLeft(),top:k.scrollTop()})},100));u.html(a);return d.getElementById(g.id)}};return c});
KISSY.add("editor/plugin/flash/index",function(h,k,j,f){return{init:function(c){var a=c.htmlDataProcessor;a.dataFilter.addRules({tags:{object:function(d){var c;if(!d.getAttribute("classid")){var i=d.childNodes;for(c=0;c<i.length;c++)if("embed"==i[c].nodeName)if(f.isFlashEmbed(i[c][c]))break;else return a.createFakeParserElement(d,"ke_flash","flash",!0);return null}return a.createFakeParserElement(d,"ke_flash","flash",!0)},embed:function(d){return f.isFlashEmbed(d)?a.createFakeParserElement(d,"ke_flash",
"flash",!0):null}}},5);var i=c.get("pluginConfig").flash||{},d=new j({editor:c,cls:"ke_flash",type:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.selectedEl;a&&d.show(a)}}});!1!==i.btn&&c.addButton({contentCls:"ke-toolbar-flash",title:"\u63d2\u5165Flash",mode:k.WYSIWYG_MODE},{offClick:function(){d.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/fontFamily/cmd",function(h,k,j){var f={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(c){j.addSelectCmd(c,"fontFamily",f)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(h,k,j,f){return{init:function(c){f.init(c);var a=c.get("pluginConfig").fontFamily,a=a||{};h.mix(a,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},{name:"Verdana",
value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},!1);h.each(a.items,function(a){var d=a.attrs||{},c=a.value;d.style=d.style||"";d.style+=";font-family:"+c;a.attrs=d});c.addSelect({cmdType:"fontFamily",title:"\u5b57\u4f53",width:"110px",mode:k.WYSIWYG_MODE,defaultValue:a.defaultValue,popUpWidth:a.width,items:a.items},void 0,j.Select)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(h,k,j){var f={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(c){j.addSelectCmd(c,"fontSize",f)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(h,k,j,f){return{init:function(c){f.init(c);var a=c.get("pluginConfig").fontSize,a=a||{};h.mix(a,{items:function(a){var d=[];h.each(a,function(a){d.push({name:a,value:a})});return d}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(",")),width:"55px"},!1);c.addSelect({cmdType:"fontSize",title:"\u5927\u5c0f",width:"30px",mode:k.WYSIWYG_MODE,showValue:!0,defaultValue:a.defaultValue,popUpWidth:a.width,items:a.items},void 0,j.Select)}}},{requires:["editor",
"../font/ui","./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(h,k){var j=k.Utils.getQueryCmd;return{addButtonCmd:function(f,c,a){var i=j(c);f.hasCommand(c)||(f.addCommand(c,{exec:function(d,c){var f=d.get("document")[0];d.execCommand("save");c||void 0===c?a.apply(f):a.remove(f);d.execCommand("save");d.notifySelectionChange()}}),f.addCommand(i,{exec:function(d,c){return a.checkActive(c)}}))},addSelectCmd:function(f,c,a){var i=j(c);f.hasCommand(c)||(f.addCommand(c,{exec:function(d,c,f){var c=new k.Style(a,{value:c}),
i=d.get("document")[0];d.execCommand("save");void 0===f||f?c.apply(i):c.remove(i);d.execCommand("save")}}),f.addCommand(i,{exec:function(d,c,f){return(new k.Style(a,{value:c})).checkElementRemovable(f,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(h,k,j,f){function c(){c.superclass.constructor.apply(this,arguments)}function a(){a.superclass.constructor.apply(this,arguments)}var i=k.Utils.getQueryCmd;h.extend(c,f,{click:function(a){var c=a.newVal,f=this.get("cmdType"),a=a.prevVal,i=this.get("editor");i.focus();c==a?i.execCommand(f,c,!1):i.execCommand(f,c)},selectionChange:function(a){for(var c=a.path,a=i(this.get("cmdType")),f=this.get("items"),h=this.get("editor"),c=c.elements,j=0,k;j<c.length;j++){k=
c[j];for(var e=0;e<f.length;e++){var b=f[e].value;if(h.execCommand(a,b,k)){this.set("value",b);return}}}(a=this.get("defaultValue"))?this.set("value",a):this.reset("value")}});h.extend(a,j,{offClick:function(){var a=this.get("cmdType"),c=this.get("editor");c.execCommand(a);c.focus()},onClick:function(){var a=this.get("cmdType"),c=this.get("editor");c.execCommand(a,!1);c.focus()},selectionChange:function(a){var c=this.get("editor"),f=i(this.get("cmdType"));c.execCommand(f,a.path)?this.set("state",
j.ON):this.set("state",j.OFF)}},{ATTRS:{mode:{value:k.WYSIWYG_MODE}}});return{Button:a,Select:c}},{requires:["editor","../button/","../select/"]});
KISSY.add("editor/plugin/foreColor/cmd",function(h,k){var j={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(f){return!("a"==f.nodeName()||f.all("a").length)}};return{init:function(f){f.hasCommand("foreColor")||f.addCommand("foreColor",{exec:function(c,a){c.execCommand("save");k.applyColor(c,a,j);c.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"foreColor",title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-fore-color"},void 0,j)}}},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(h,k){return{init:function(h){if(!h.hasCommand("heading")){h.addCommand("heading",{exec:function(c,a){c.execCommand("save");(new k.Style({element:a})).apply(c.get("document")[0]);c.execCommand("save")}});var f=k.Utils.getQueryCmd("heading");h.addCommand(f,{exec:function(c,a,f){return(new k.Style({element:f})).checkActive(a)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(h,k,j){return{init:function(f){j.init(f);var c=[],a={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},i={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},d;for(d in a)a.hasOwnProperty(d)&&c.push({name:d,value:a[d],attrs:{style:"font-size:"+i[a[d]]}});f.addSelect({items:c,title:"\u6807\u9898",width:"100px",mode:k.WYSIWYG_MODE},{click:function(a){var d=a.newVal;d!=a.prevVal?f.execCommand("heading",d):(f.execCommand("heading",
"p"),this.set("value","p"))},selectionChange:function(a){var a=a.path,d=k.Utils.getQueryCmd("heading"),c;for(c in i)if(i.hasOwnProperty(c)&&f.execCommand(d,a,c)){this.set("value",c);break}}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(h,k,j,f,c,a){var i=h.UA,d=h.Node,g=h.all,l=h.Event,o=function(a){a=g(a);return"img"===a.nodeName(a)&&!/(^|\s+)ke_/.test(a[0].className)&&a};return{init:function(h){function j(e){a.useDialog(h,"image/dialog",e)}h.addButton({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:k.WYSIWYG_MODE},{offClick:function(){j(null)}});c.register({editor:h,filter:o,width:"120px",handlers:{"\u56fe\u7247\u5c5e\u6027":function(){var a=o(this.selectedEl);a&&j(g(a))},"\u63d2\u5165\u65b0\u884c":function(){var a=h.get("document")[0],
b=new d(a.createElement("p"));i.ie||b._4e_appendBogus(void 0);a=new k.Range(a);a.setStartAfter(this.selectedEl);a.select();h.insertElement(b);a.moveToElementEditablePosition(b,1);a.select()}}});h.docReady(function(){l.on(h.get("document")[0],"dblclick",function(a){a.halt();a=g(a.target);o(a)&&j(a)})});f.register({editor:h,filter:o,init:function(){var a=this,b=a.get("contentEl");b.html('<a class="ke-bubbleview-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ke-bubbleview-link ke-bubbleview-change" href="#">\u7f16\u8f91</a>  |  <a class="ke-bubbleview-link ke-bubbleview-remove" href="#">\u5220\u9664</a>');
var d=b.one(".ke-bubbleview-url"),c=b.one(".ke-bubbleview-change"),g=b.one(".ke-bubbleview-remove");k.Utils.preventFocus(b);c.on("click",function(b){j(a.selectedEl);b.halt()});g.on("click",function(b){if(i.webkit){var d=h.getSelection().getRanges();d&&d[0]&&(d[0].collapse(),d[0].select())}a.selectedEl.remove();a.hide();h.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr("_ke_saved_src")||b.attr("src"),d.attr("href",b))})}})}}},{requires:["editor","../button/",
"../bubbleview/","../contextmenu/","../dialogLoader/"]});KISSY.add("editor/plugin/indent/cmd",function(h,k,j){var f=j.addCommand;return{init:function(c){f(c,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(h,k,j){return{init:function(f){j.init(f);f.addButton({title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:k.WYSIWYG_MODE,contentCls:"ke-toolbar-indent"},{offClick:function(){f.execCommand("indent")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/insertOrderedList/cmd",function(h,k,j){var f=j.queryActive,c=new j.ListCommand("ol");return{init:function(a){a.hasCommand("insertOrderedList")||a.addCommand("insertOrderedList",{exec:function(a){c.exec(a)}});var i=k.Utils.getQueryCmd("insertOrderedList");a.hasCommand(i)||a.addCommand(i,{exec:function(a,c){return f("ol",c)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/insertOrderedList/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"insertOrderedList",mode:k.WYSIWYG_MODE,contentCls:"ke-toolbar-ol"},void 0,j)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/insertUnorderedList/cmd",function(h,k,j){var f=j.queryActive,c=new j.ListCommand("ul");return{init:function(a){a.hasCommand("insertUnorderedList")||a.addCommand("insertUnorderedList",{exec:function(a){c.exec(a)}});var i=k.Utils.getQueryCmd("insertUnorderedList");a.hasCommand(i)||a.addCommand(i,{exec:function(a,c){return f("ul",c)}})}}},{requires:["editor","../listUtils/cmd.js"]});
KISSY.add("editor/plugin/insertUnorderedList/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"insertUnorderedList",mode:k.WYSIWYG_MODE,contentCls:"ke-toolbar-ul"},void 0,j)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(h,k,j){var f=new k.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(c){j.addButtonCmd(c,"italic",f)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"italic",contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 "},void 0,j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(h,k){return{init:function(h){k.addCommand(h,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(h,k,j){function f(){this.get("editor").execCommand("justifyCenter")}return{init:function(c){j.init(c);c.addButton({contentCls:"ke-toolbar-justifyCenter",title:"\u5c45\u4e2d\u5bf9\u9f50"},{onClick:f,offClick:f,selectionChange:function(a){var f=k.Utils.getQueryCmd("justifyCenter");c.execCommand(f,a.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyLeft/cmd",function(h,k){return{init:function(h){k.addCommand(h,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(h,k,j){function f(){this.get("editor").execCommand("justifyLeft")}return{init:function(c){j.init(c);c.addButton({contentCls:"ke-toolbar-justifyLeft",title:"\u5de6\u5bf9\u9f50"},{onClick:f,offClick:f,selectionChange:function(a){var f=k.Utils.getQueryCmd("justifyLeft");c.execCommand(f,a.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyRight/cmd",function(h,k){return{init:function(h){k.addCommand(h,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(h,k,j){function f(){this.get("editor").execCommand("justifyRight")}return{init:function(c){j.init(c);c.addButton({contentCls:"ke-toolbar-justifyRight",title:"\u53f3\u5bf9\u9f50"},{onClick:f,offClick:f,selectionChange:function(a){var f=k.Utils.getQueryCmd("justifyRight");c.execCommand(f,a.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(h,k){var j=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(f,c,a){f.hasCommand(c)||(f.addCommand(c,{exec:function(c){c.execCommand("save");for(var d=c.getSelection(),g=d.createBookmarks(),f=d.getRanges(),h,k,p=f.length-1;0<=p;p--){h=f[p].createIterator();for(h.enlargeBr=!0;k=h.getNextParagraph();)k.removeAttr("align"),(k.css("text-align").replace(j,"")||"left")==a?k.css("text-align",""):k.css("text-align",a)}d.selectBookmarks(g);c.execCommand("save");
c.notifySelectionChange()}}),f.addCommand(k.Utils.getQueryCmd(c),{exec:function(c,d){var g=d.block||d.blockLimit;return!g||"body"===g.nodeName()?!1:(g.css("text-align").replace(j,"")||"left")==a}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(h,k,j,f,c){function a(a){a=i(a);return a.closest("a",void 0)}var i=h.all;return{init:function(d){d.addButton({contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:k.WYSIWYG_MODE},{offClick:function(){c.useDialog(d,"link/dialog",void 0)}});j.register({editor:d,filter:a,init:function(){var a=this,i=a.get("contentEl");i.html('<a href=""  target="_blank" class="ke-bubbleview-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');
var h=i.one(".ke-bubbleview-url"),j=i.one(".ke-bubbleview-change"),p=i.one(".ke-bubbleview-remove");k.Utils.preventFocus(i);j.on("click",function(e){c.useDialog(d,"link/dialog",a.selectedEl);e.halt()});p.on("click",function(e){f.removeLink(d,a.selectedEl);e.halt()});a.on("show",function(){var e=a.selectedEl;e&&(e=e.attr(f._ke_saved_href)||e.attr("href"),h.html(e),h.attr("href",e))})}})}}},{requires:["editor","../bubbleview/","./utils","../dialogLoader/"]});
KISSY.add("editor/plugin/link/utils",function(h,k){var j=h.Node,f=k.Style,c={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(a,i){a.execCommand("save");var d=a.getSelection(),g=d.getRanges()[0];if(g&&g.collapsed)g=d.createBookmarks(),i._4e_remove(!0),d.selectBookmarks(g);else if(g){for(var d=i[0],g=d.attributes,h={},j=0;j<g.length;j++){var k=g[j];k.specified&&(h[k.name]=k.value)}d.style.cssText&&(h.style=d.style.cssText);
(new f(c,h)).remove(a.get("document")[0])}a.execCommand("save");a.notifySelectionChange()},applyLink:function(a,i,d){i._ke_saved_href=i.href;d?(a.execCommand("save"),d.attr(i)):(d=(d=a.getSelection())&&d.getRanges()[0],!d||d.collapsed?(i=new j("<a>"+i.href+"</a>",i,a.get("document")[0]),a.insertElement(i)):(a.execCommand("save"),(new f(c,i)).apply(a.get("document")[0])));a.execCommand("save");a.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(h,k,j){function f(){f.superclass.constructor.apply(this,arguments)}function c(){var a=this.get("editor"),c=this.get("cmdType");a.execCommand(c)}h.extend(f,j,{offClick:c,onClick:c,selectionChange:function(a){var c=this.get("editor"),d=k.Utils.getQueryCmd(this.get("cmdType"));c.execCommand(d,a.path)?this.bon():this.boff()}});return f},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(h,k,j,f){function c(a){this.type=a}function a(a,e){var c,d,g=e.blockLimit,f=e.elements;if(!g)return!1;if(f)for(var h=0;h<f.length&&(c=f[h])&&c[0]!==g[0];h++)if(i[d=c.nodeName()]&&d==a)return!0;return!1}var i={ol:"insertOrderedList",ul:"insertUnorderedList"},d=k.RANGE,g=k.ElementPath,l=k.Walker,o=h.UA,q=h.Node,p=h.DOM,e=/^h[1-6]$/;c.prototype={changeListType:function(a,e,c,d){for(var g=j.listToArray(e.root,c,f,f,f),i=[],a=0;a<e.contents.length;a++){var h=
e.contents[a];if((h=h.closest("li",f))&&h[0]&&!h.data("list_item_processed"))i.push(h),h._4e_setMarker(c,"list_item_processed",!0,f)}h=new q(e.root[0].ownerDocument.createElement(this.type));for(a=0;a<i.length;a++){var l=i[a].data("listarray_index");g[l].parent=h}for(var c=j.arrayToList(g,c,null,"p"),k,g=c.listNode.childNodes.length,a=0;a<g&&(k=new q(c.listNode.childNodes[a]));a++)k.nodeName()==this.type&&d.push(k);c.listNode.insertBefore(e.root);e.root.remove()},createList:function(a,c,d){var g=
c.contents,a=c.root[0].ownerDocument,i=[];if(1==g.length&&g[0][0]===c.root[0]){var h=new q(a.createElement("div"));g[0][0].nodeType!=p.TEXT_NODE&&g[0]._4e_moveChildren(h,f,f);g[0][0].appendChild(h[0]);g[0]=h}c=c.contents[0].parent();for(h=0;h<g.length;h++)c=c._4e_commonAncestor(g[h].parent(),f);for(h=0;h<g.length;h++)for(var l=g[h],j;j=l.parent();){if(j[0]===c[0]){i.push(l);break}l=j}if(!(1>i.length)){g=new q(i[i.length-1][0].nextSibling);h=new q(a.createElement(this.type));for(d.push(h);i.length;)d=
i.shift(),l=new q(a.createElement("li")),e.test(d.nodeName())?l[0].appendChild(d[0]):(d._4e_copyAttributes(l,f,f),d._4e_moveChildren(l,f,f),d.remove()),h[0].appendChild(l[0]),o.ie||l._4e_appendBogus(f);g[0]?h.insertBefore(g,f):c.append(h)}},removeList:function(a,e,c){function d(c){if((v=new q(o[c?"firstChild":"lastChild"]))&&!(v[0].nodeType==p.ELEMENT_NODE&&v._4e_isBlockBoundary(f,f))&&(y=e.root[c?"prev":"next"](l.whitespaces(!0)))&&!(v[0].nodeType==p.ELEMENT_NODE&&y._4e_isBlockBoundary({br:1},f)))v[c?
"before":"after"](a.get("document")[0].createElement("br"))}for(var g=j.listToArray(e.root,c,f,f,f),h=[],i=0;i<e.contents.length;i++){var k=e.contents[i];if((k=k.closest("li",f))&&!k.data("list_item_processed"))h.push(k),k._4e_setMarker(c,"list_item_processed",!0,f)}k=null;for(i=0;i<h.length;i++)k=h[i].data("listarray_index"),g[k].indent=-1;for(i=k+1;i<g.length;i++)if(g[i].indent>Math.max(g[i-1].indent,0)){h=g[i-1].indent+1-g[i].indent;for(k=g[i].indent;g[i]&&g[i].indent>=k;)g[i].indent+=h,i++;i--}var o=
j.arrayToList(g,c,null,"p").listNode,v,y;d(!0);d(f);e.root.before(o);e.root.remove()},exec:function(b){var e=b.getSelection(),c=e&&e.getRanges();if(c&&!(1>c.length)){for(var h=e.getStartElement(),h=new k.ElementPath(h),j=a(this.type,h),h=e.createBookmarks(!0),o=[],n={};0<c.length;){var q=c.shift(),w=q.getBoundaryNodes(),v=w.startNode,y=w.endNode;v[0].nodeType==p.ELEMENT_NODE&&"td"==v.nodeName()&&q.setStartAt(w.startNode,d.POSITION_AFTER_START);y[0].nodeType==p.ELEMENT_NODE&&"td"==y.nodeName()&&q.setEndAt(w.endNode,
d.POSITION_BEFORE_END);q=q.createIterator();for(q.forceBrBreak=!1;w=q.getNextParagraph();)if(!w.data("list_block")){w._4e_setMarker(n,"list_block",1,f);for(var y=new g(w),z=y.elements,A=null,D=!1,A=y.blockLimit,B,v=z.length-1;0<=v&&(B=z[v]);v--)if(i[B.nodeName()]&&A.contains(B)){A.removeData("list_group_object");(v=B.data("list_group_object"))?v.contents.push(w):(v={root:B,contents:[w]},o.push(v),B._4e_setMarker(n,"list_group_object",v,f));D=!0;break}D||(y=A||y.block,y.data("list_group_object")?y.data("list_group_object").contents.push(w):
(v={root:y,contents:[w]},y._4e_setMarker(n,"list_group_object",v,f),o.push(v)))}}for(c=[];0<o.length;)v=o.shift(),j?i[v.root.nodeName()]&&this.removeList(b,v,n):i[v.root.nodeName()]?this.changeListType(b,v,n,c):(k.Utils.clearAllMarkers(n),this.createList(b,v,c));for(var C=this,v=0;v<c.length;v++)A=c[v],b=function(a,b){var e=b[a?"prev":"next"](l.whitespaces(!0));e&&e[0]&&e.nodeName()==C.type&&(e.remove(),e._4e_moveChildren(b,a?!0:!1,f))},b(f,A),b(!0,A);k.Utils.clearAllMarkers(n);e.selectBookmarks(h)}}};
new c("ul");new c("ol");return{ListCommand:c,queryActive:a}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(h){var k={ol:1,ul:1},j=h.Node,f=h.DOM,c=h.UA,a={listToArray:function(c,d,g,h,o){if(!k[c.nodeName()])return[];h||(h=0);g||(g=[]);for(var q=0,p=c[0].childNodes.length;q<p;q++){var e=new j(c[0].childNodes[q]);if("li"==e.nodeName()){var b={parent:c,indent:h,element:e,contents:[]};o?b.grandparent=o:(b.grandparent=c.parent(),b.grandparent&&"li"==b.grandparent.nodeName()&&(b.grandparent=b.grandparent.parent()));d&&e._4e_setMarker(d,"listarray_index",g.length,
void 0);g.push(b);for(var t=0,s=e[0].childNodes.length,u;t<s;t++)u=new j(e[0].childNodes[t]),u[0].nodeType==f.ELEMENT_NODE&&k[u.nodeName()]?a.listToArray(u,d,g,h+1,b.grandparent):b.contents.push(u)}}return g},arrayToList:function(h,d,g,l){g||(g=0);if(!h||h.length<g+1)return null;for(var o=h[g].parent[0].ownerDocument,q=o.createDocumentFragment(),p=null,e=g,b=Math.max(h[g].indent,0),t=null;;){var s=h[e];if(s.indent==b){if(!p||h[e].parent.nodeName()!=p.nodeName())p=h[e].parent.clone(!1),q.appendChild(p[0]);
for(var t=p[0].appendChild(s.element.clone(!1)[0]),u=0;u<s.contents.length;u++)t.appendChild(s.contents[u].clone(!0)[0]);e++}else if(s.indent==Math.max(b,0)+1)e=a.arrayToList(h,null,e,l),t.appendChild(e.listNode),e=e.nextIndex;else if(-1==s.indent&&!g&&s.grandparent){k[s.grandparent.nodeName()]?t=s.element.clone(!1)[0]:"td"!=s.grandparent.nodeName()?(t=o.createElement(l),s.element._4e_copyAttributes(new j(t))):t=o.createDocumentFragment();for(u=0;u<s.contents.length;u++)p=s.contents[u].clone(!0),
t.nodeType==f.DOCUMENT_FRAGMENT_NODE&&s.element._4e_copyAttributes(new j(p)),t.appendChild(p[0]);t.nodeType==f.DOCUMENT_FRAGMENT_NODE&&e!=h.length-1&&(t.lastChild&&t.lastChild.nodeType==f.ELEMENT_NODE&&"_moz"==t.lastChild.getAttribute("type")&&f._4e_remove(t.lastChild),f._4e_appendBogus(t));t.nodeType==f.ELEMENT_NODE&&f.nodeName(t)==l&&t.firstChild&&(f._4e_trim(t),p=t.firstChild,p.nodeType==f.ELEMENT_NODE&&f._4e_isBlockBoundary(p)&&(p=o.createDocumentFragment(),f._4e_moveChildren(t,p),t=p));p=f.nodeName(t);
!c.ie&&("div"==p||"p"==p)&&f._4e_appendBogus(t);q.appendChild(t);p=null;e++}else return null;if(h.length<=e||Math.max(h[e].indent,0)<b)break}if(d)for(h=new j(q.firstChild);h&&h[0];)h[0].nodeType==f.ELEMENT_NODE&&h._4e_clearMarkers(d,!0),h=h._4e_nextSourceNode();return{listNode:q,nextIndex:e}}};return a},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(h,k,j,f){if(!h.UA.ie&&window.localStorage)return window.localStorage;var c=k.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),a=new f({movie:c,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});a.swf.height=138;var i=new j({width:"0px",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",zIndex:k.baseZIndex(k.zIndexManager.STORE_FLASH_SHOW)});
i.render();i.get("contentEl").append(a.swf);i.center();i.show();a.on("pending",function(){i.set("width",215);i.center();i.show();setTimeout(function(){a.retrySave()},1E3)});a.on("save",function(){i.set("width",0)});var d=a.setItem;h.mix(a,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,c){this.lastSave={k:a,v:c};d.call(this,a,c)}});a.on("contentReady",function(){a._ready=1});return a},{attach:!1,requires:["editor",
"overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(h,k){function j(a){this.editor=a}var f=h.UA,c=f.ie,a=document,i=h.Node,d=h.Event,g=h.DOM,l;h.augment(j,{restoreWindow:function(){var a=this,c=a.editor;!1!==c.fire("beforeRestoreWindow")&&a._resize&&(d.remove(window,"resize",a._resize),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();c.notifySelectionChange();c.fire("restoreWindow")},30))},_restoreState:function(){var d=this.editor,f=this._savedParents;
if(f){for(var h=0;h<f.length;h++){var e=f[h];e.el.css("position",e.position)}this._savedParents=null}d.get("iframeWrapEl").css({height:this.iframeHeight});g.css(a.body,{width:"",height:"",overflow:""});a.documentElement.style.overflow="";d=d.get("el")[0].style;d.position="static";d.width=this.editorElWidth;l.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>c&&this.editor.get("toolBarEl").removeClass("ke-toolbar-padding",void 0)},_saveSate:function(){var a=this.editor,
d=[],f=a.get("el");this.iframeHeight=a.get("iframeWrapEl").style("height");this.editorElWidth=f.style("width");this.scrollLeft=g.scrollLeft();this.scrollTop=g.scrollTop();window.scrollTo(0,0);for(a=f.parent();a;)f=a.css("position"),"static"!=f&&(d.push({el:a,position:f}),a.css("position","static")),a=a.parent();this._savedParents=d;8>c&&this.editor.get("toolBarEl").addClass("ke-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;f.gecko&&a.__iframeFocus&&
(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,c=a.getSelection(),d=this.savedRanges;f.gecko&&a.activateGecko();d&&c&&c.selectRanges(d);a.__iframeFocus&&c&&(a=c.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(d){var f=this.editor,h=f.get("el"),e=g.viewportHeight(),b=g.viewportWidth(),i=f.get("statusBarEl")?f.get("statusBarEl")[0].offsetHeight:0,j=f.get("toolBarEl")[0].offsetHeight;c?a.body.style.overflow="hidden":g.css(a.body,
{width:0,height:0,overflow:"hidden"});a.documentElement.style.overflow="hidden";h.css({position:"absolute",zIndex:k.baseZIndex(k.zIndexManager.MAXIMIZE),width:b+"px"});l.css({zIndex:k.baseZIndex(k.zIndexManager.MAXIMIZE-5),height:e+"px",width:b+"px"});h.offset({left:0,top:0});l.css({left:0,top:0});f.get("iframeWrapEl").css({height:e-i-j+"px"});!0!==d&&arguments.callee.call(this,!0)},_real:function(){var a=this,c=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=
h.buffer(function(){a._maximize();c.fire("maximizeWindow")},100)),d.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();c.notifySelectionChange();c.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(l||(l=(new i("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(a.body,void 0)),this._real())},destroy:function(){this._resize&&(d.remove(window,"resize",this._resize),
this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var c=new j(a);a.addCommand("maximizeWindow",{exec:function(){c.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){c.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(h,k,j){return{init:function(f){j.init(f);f.addButton({title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"},{onClick:function(){f.execCommand("restoreWindow");this.boff();this.set("title","\u5168\u5c4f");this.set("contentCls","ke-toolbar-maximize")},offClick:function(){f.execCommand("maximizeWindow");this.bon();this.set("title","\u53d6\u6d88\u5168\u5c4f");this.set("contentCls","ke-toolbar-restore")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/multipleUpload/index",function(h,k,j){return{init:function(f){f.addButton({contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",mode:k.WYSIWYG_MODE},{offClick:function(){j.useDialog(f,"multipleUpload/dialog")}})}}},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/outdent/cmd",function(h,k,j){var f=j.addCommand,c=j.checkOutdentActive;return{init:function(a){f(a,"outdent");var h=k.Utils.getQueryCmd("outdent");a.hasCommand(h)||a.addCommand(h,{exec:function(a,g){return c(g)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(h,k,j){return{init:function(f){j.init(f);var c=k.Utils.getQueryCmd("outdent");f.addButton({title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:k.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent"},{offClick:function(){f.execCommand("outdent")},selectionChange:function(a){f.execCommand(c,a.path)?this.enable():this.disable()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/focus",function(h,k){function j(){}var f=h.UA,c=k.focusManager;j.ATTRS={focus4e:{value:!0}};j.prototype={_uiSetFocus4e:function(a){a?(this.on("show",this._show4FocusExt,this),this.on("hide",this._hide4FocusExt,this)):(this.detach("show",this._show4FocusExt,this),this.detach("hide",this._hide4FocusExt,this))},_show4FocusExt:function(){var a=this._focusEditor=c.currentInstance();if(f.ie&&a){window.focus();document.body.focus();var h=a.get("document")[0].selection.createRange();
h&&h.item&&h.item(0).ownerDocument==a.get("document")[0]&&(a=document.body.createTextRange(),a.moveToElementText(this.get("el").first()[0]),a.collapse(!0),a.select())}},_hide4FocusExt:function(){var a=this._focusEditor;a&&a.focus()}};return j},{requires:["editor"]});
KISSY.add("editor/plugin/overlay/index",function(h,k,j,f,c){var a=j.create(f,[c],{},{ATTRS:{prefixCls:{value:"ke-"},zIndex:{value:k.baseZIndex(k.zIndexManager.OVERLAY)}}});a.Dialog=j.create(f.Dialog,[c],{show:function(){this.center();var c=this.get("y");200<c-h.DOM.scrollTop()&&(c=h.DOM.scrollTop()+200,this.set("y",c));a.prototype.show.call(this)}},{ATTRS:{prefixCls:{value:"ke-"},draggable:{value:!0},constrain:{value:!0},aria:{value:!0},zIndex:{value:k.baseZIndex(k.zIndexManager.OVERLAY)}}});return a},
{requires:["editor","uibase","overlay","./focus","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(h,k,j){var f=h.Node;return{init:function(c){j.init(c);var a=c.htmlDataProcessor;(a&&a.dataFilter).addRules({tags:{div:function(c){var d=c.getAttribute("style"),g;if(d)for(var f=c.childNodes,h=0;h<f.length;h++)1==f[h].nodeType&&(g=f[h]);if((g=g&&"span"==g.nodeName&&g.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(d)&&/display\s*:\s*none/i.test(g))return a.createFakeParserElement(c,"ke_pagebreak","div")}}});c.addButton({title:"\u5206\u9875",mode:k.WYSIWYG_MODE,
contentCls:"ke-toolbar-pagebreak"},{offClick:function(){var a=this.get("editor"),c=new f('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,a.get("document")[0]),c=a.createFakeElement(c,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),g=a.getSelection();if(g=g&&g.getRanges()[0]){a.execCommand("save");for(var h=g.startContainer,j=h;"body"!==h.nodeName();)j=h,h=h.parent();g.collapse(!0);g.splitElement(j);
c.insertAfter(j);a.execCommand("save")}}})}}},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(){var h=window;return{init:function(k){k.addButton({title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"},{offClick:function(){var j=this.get("editor");try{var f=h.screen,c=Math.round(0.8*f.width),a=Math.round(0.7*f.height),i=Math.round(0.1*f.width)}catch(d){c=640,a=420,i=80}j=j._prepareIFrameHtml(void 0,j.get("formatData")).replace(/\${title}/,"\u9884\u89c8");c=h.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+c+",height="+
a+",left="+i);a=c.document;a.open();a.write(j);a.close();c.focus()}})}}});
KISSY.add("editor/plugin/progressbar/index",function(h){function k(){k.superclass.constructor.apply(this,arguments);this._init()}var j=h.Node;k.ATTRS={container:{},width:{},height:{},progress:{value:0}};h.extend(k,h.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var f=this.get("height"),c=new j("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+f+";'></div>"),a=this.get("container"),f=(new j("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+
(parseInt(f)-4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(c),h=(new j("<span class='ke-progressbar-title'></span>")).appendTo(c);a&&c.appendTo(a);this.el=c;this._title=h;this._p=f;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(f){f=f.newVal;this._p.css("width",f+"%");this._title.html(f+"%")}});return k});
KISSY.add("editor/plugin/removeFormat/cmd",function(h,k){function j(a,c){for(var d=0;d<c.length;d++)a.removeAttr(c[d])}var f=k.RANGE,c=k.ElementPath,a=h.DOM,i="class,style,lang,width,height,align,hspace,valign".split(/,/),d=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(g){g.hasCommand("removeFormat")||g.addCommand("removeFormat",{exec:function(){g.focus();d.lastIndex=0;var h=g.getSelection().getRanges();
g.execCommand("save");for(var k=0,q;q=h[k];k++)if(!q.collapsed){q.enlarge(f.ENLARGE_ELEMENT);var p=q.createBookmark(),e=p.startNode,b=p.endNode,t=function(a){for(var b=new c(a),e=b.elements,g=1,f;(f=e[g])&&!f.equals(b.block)&&!f.equals(b.blockLimit);g++)d.test(f.nodeName())&&a._4e_breakParent(f)};t(e);t(b);for(e=e._4e_nextSourceNode(!0,a.ELEMENT_NODE,void 0,void 0);e&&!e.equals(b);)t=e._4e_nextSourceNode(!1,a.ELEMENT_NODE,void 0,void 0),"img"==e.nodeName()&&e.attr("_ke_realelement")||(d.test(e.nodeName())?
e._4e_remove(!0):j(e,i)),e=t;q.moveToBookmark(p)}g.getSelection().selectRanges(h);g.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(h,k,j){return{init:function(f){j.init(f);f.addButton({title:"\u6e05\u9664\u683c\u5f0f",mode:k.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat"},{offClick:function(){f.execCommand("removeFormat")}})}}},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(h,k,j){var f=h.Node;return{init:function(c){var a=j.Draggable,i=c.get("statusBarEl");c.get("textarea");var d=(c.get("pluginConfig").resize||{}).direction||["x","y"],g="se-resize";1==d.length&&(g="x"==d[0]?"e-resize":"s-resize");var k=(new f("<div class='ke-resizer' style='cursor: "+g+"'></div>")).appendTo(i);c.on("maximizeWindow",function(){k.css("display","none")});c.on("restoreWindow",function(){k.css("display","")});var o=new a({node:k}),q=0,p=0,
e=c.get("el"),b=c.get("el");o.on("dragstart",function(){q=e.height();p=b.width();c.fire("resizeStart")});o.on("drag",function(a){var b=a.left-this.startNodePos.left,a=a.top-this.startNodePos.top;h.inArray("y",d)&&c.set("height",q+a);h.inArray("x",d)&&c.set("width",p+b);c.fire("resize")});c.on("destroy",function(){o.destroy();k.remove()})}}},{requires:["editor","dd"]});
KISSY.add("editor/plugin/select/index",function(h,k,j,f){function c(a){c.superclass.constructor.call(this,a);this._init()}function a(a){return a&&-1==a.indexOf("<")?a:0}var i=h.Node,d=i.all,g=h.Event,l=h.DOM,o=k.XHTML_DTD;c.DISABLED=0;c.ENABLED=1;c.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},popUpWidth:{},title:{},items:{},emptyText:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var a=this.el.parent();a;){var b=a.nodeName();if(o[b]&&o[b].div)return a;a=
a.parent()}return d(document.body)}},state:{value:1}};c.decorate=function(a){var b=a.width(),d=[];a.all("option").each(function(a){d.push({name:a.html(),value:a.val()})});return new c({width:b+"px",title:a.attr("title"),el:a,items:d,cls:"ke-combox",value:a.val()})};var q=k.Utils.addRes,p=k.Utils.destroyRes;h.extend(c,h.Base,{_init:function(){var e=this,b=e.get("container"),c=e.get("el"),g=d("<span class='ke-select-wrap'><a class='ke-select'  hidefocus='hidefocus' tabindex='0'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
h=g.one("a"),i=e.get("title")||"",j=e.get("cls"),l=g.one(".ke-select-text"),o=g.one(".ke-select-text-inner");g.one(".ke-select-drop");e.get("value")!==f?o.html(e._findNameByV(e.get("value"))):o.html(i);g.unselectable(f);l.css("width",e.get("width"));i&&g.attr("title",i);h.attr("href","javascript:void('"+a(i)+"')");j&&g.addClass(j,f);c?c[0].parentNode.replaceChild(g[0],c[0]):b&&g.appendTo(b,f);g.on("click",e._click,e);g.on("keydown",e._keydown,e);e.el=g;e.title=o;e._focusA=g.one("a.ke-select");e._focusA.on("blur",
function(){e.menu&&e.menu.hide()});k.Utils.lazyRun(this,"_prepare","_real");e.on("afterValueChange",e._valueChange,e);e.on("afterStateChange",e._stateChange,e)},_keydown:function(a){var b;switch(a.keyCode){case g.KeyCodes.DOWN:a.halt();if(!this._isShown()){this._click();this._findCurrent()||d(this.as[0]).addClass("ke-menu-selected",f);break}a=d(this._findCurrent());a.removeClass("ke-menu-selected",f);(b=a.next())?b.addClass("ke-menu-selected",f):d(this.as[0]).addClass("ke-menu-selected",f);break;
case g.KeyCodes.UP:a.halt();if(!this._isShown())break;a=d(this._findCurrent());a.removeClass("ke-menu-selected",f);(b=a.prev(f,f))?b.addClass("ke-menu-selected",f):d(this.as[this.as.length-1]).addClass("ke-menu-selected",f);break;case g.KeyCodes.ENTER:a.halt();if(!this._isShown()){this._click();this._findCurrent()||d(this.as[0]).addClass("ke-menu-selected",f);break}a=d(this._findCurrent());if(!a)break;this._select({target:a});break;case g.KeyCodes.ESC:a.halt();if(!this._isShown())break;this.menu.hide()}},
_findCurrent:function(){var a=f;this.as.each(function(b){if(b.hasClass("ke-menu-selected",f))return a=b,!1});return a},_isShown:function(){return this.menu&&this.menu.get("visible")},_findNameByV:function(a){var b=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return a||b;h.each(c,function(c){if(c.value==a)return b=c.name,!1});return b},_valueChange:function(a){this.title.html(this._findNameByV(a.newVal))},_itemsChange:function(c){var b,c=c.newVal,g=this._selectList;g.html("");
if(c&&c.length)for(b=0;b<c.length;b++){var j=c[b];(new i(h.substitute("<a class='ke-select-menu-item' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:a(j.name),value:j.value,name:j.name}),j.attrs)).unselectable(f).appendTo(g,f)}else(b=this.get("emptyText"))&&d(h.substitute("<a class='ke-select-menu-item' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:a(b),value:"",name:b})).appendTo(g,f);this.as=g.all("a")},val:function(a){return a!==
f?(this.set("value",a),this):this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var a=this,b=a.el,c=a._focusA,h=a.get("popUpWidth"),h=new j({autoRender:!0,render:a.get("menuContainer"),content:"<div>",elCls:"ke-menu",width:h?h:b.width(),zIndex:k.baseZIndex(k.zIndexManager.SELECT)}),i=a.get("items");h.on("hide",function(){c.removeClass("ke-select-active",f)});h.on("show",function(){c.addClass("ke-select-active",f)});q.call(a,h);b=h.get("contentEl").one("div");
a.menu=h;h.get("el").on("mousedown",function(a){a.halt()});g.on(window,"resize",a._resize,a);q.call(a,function(){g.remove(window,"resize",a._resize,a)});a.get("title")&&d("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+a.get("title")+"</div>").appendTo(b,f);a._selectList=d("<div>").appendTo(b,f);a._itemsChange({newVal:i});b.on("click",a._select,a);a.as=a._selectList.all("a");b.on("mouseenter",function(){a.as.removeClass("ke-menu-selected",f)});q.call(a,b);a.on("afterItemsChange",
a._itemsChange,a);a.menuNode=b},_stateChange:function(a){var b=this.el;1==a.newVal?b.removeClass("ke-select-disabled",f):b.addClass("ke-select-disabled",f)},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(a){a&&a.halt&&a.halt();var b=this.menu,c=this.menuNode;if((a=d(a.target).closest(function(a){return l.contains(c,a)&&"a"==l.nodeName(a)},f))&&a.attr("data-value")){var g=this.get("value"),h=a.attr("data-value");this.set("value",h);this.fire("click",
{newVal:h,prevVal:g,name:a.html()});b.hide()}},_real:function(){var a=this.el,b=a.offset(),c=h.clone(b),d=this.menu.get("el").height(),g=this.menu.get("el").width(),f=l.scrollTop(),i=l.scrollLeft(),j=l.viewportHeight(),k=l.viewportWidth(),k=i+k-60,j=f+j,o=b.top+(a.height()-2),a=b.left+a.width()-2,p=this.get("align"),q=p[0];"b"==p[1]?(b.top=o,b.top+d>j&&c.top-f>j-o&&(b.top=c.top-d)):(b.top=c.top-d,b.top<f&&c.top-f<j-o&&(b.top=o));"l"==q?b.left+g>k&&a-i>k-c.left&&(b.left=a-g):(b.left=a-g,b.left<i&&
a-i<k-c.left&&(b.left=c.left));this.menu.set("xy",[b.left,b.top]);this.menu.show()},_click:function(a){a&&a.halt();var a=this.el,b=this.menu,c=this.get("value");if(b&&b.get("visible"))b.hide();else{this._focusA[0].focus();if(a.hasClass("ke-select-disabled",f))return!1;this.fire("select");this._prepare();c&&b&&this.as.each(function(a){a.attr("data-value")==c?a.addClass("ke-menu-selected",f):a.removeClass("ke-menu-selected",f)})}},destroy:function(){p.call(this);this.el.remove()}});k.prototype.addSelect=
function(a,b,d){var d=d||c,g=this;a.editor=g;var f=new d(h.mix({container:g.get("toolBarEl"),doc:g.get("document")[0]},a));h.mix(f,b);g.on("selectionChange",function(){g.get("mode")!=k.SOURCE_MODE&&f.selectionChange&&f.selectionChange.apply(f,arguments)});g.on("destroy",function(){f.destroy()});f.on("click",function(a){var b=a.type;f[b]&&f[b].apply(f,arguments);a.halt()});a.mode==k.WYSIWYG_MODE&&(g.on("wysiwygMode",f.enable,f),g.on("sourceMode",f.disable,f));f.init&&f.init();return f};return c},{requires:["editor",
"overlay"]});KISSY.add("editor/plugin/separator/index",function(h){return{init:function(k){var j=(new h.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(k.get("toolBarEl"));k.on("destroy",function(){j.remove()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(h,k,j){for(var f="<div class='ke-smiley-sprite'>",c=0;98>=c;c++)f+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+c+".gif'></a>";f+="</div>";return{init:function(a){a.addButton({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",keepFocus:!1,mode:k.WYSIWYG_MODE},{init:function(){var a=this;a.get("el").on("blur",function(){a.smiley&&setTimeout(function(){a.smiley.hide()},100)})},offClick:function(){this.smiley||(this.smiley=
new j({content:f,focus4e:!1,width:"297px",autoRender:!0,elCls:"ke-popup",zIndex:k.baseZIndex(k.zIndexManager.POPUP_MENU),mask:!1}),this.smiley.get("el").on("click",function(c){var c=new h.Node(c.target),d;if("a"==c.nodeName()&&(d=c.attr("data-icon")))d=new h.Node("<img alt='' src='"+d+"'/>",null,a.get("document")[0]),a.insertElement(d)}));this.smiley.set("align",{node:this.get("el"),points:["bl","tl"]});this.smiley.show()},onClick:function(){this.smiley.hide()},destructor:function(){this.smiley&&
this.smiley.destroy()}})}}},{requires:["editor","../overlay/"]});KISSY.add("editor/plugin/sourceArea/index",function(h,k){var j=k.SOURCE_MODE,f=k.WYSIWYG_MODE;return{init:function(c){c.addButton({title:"\u6e90\u7801",contentCls:"ke-toolbar-source"},{init:function(){c.on("wysiwygMode",this.boff,this);c.on("sourceMode",this.bon,this)},offClick:function(){c.set("mode",j)},onClick:function(){c.set("mode",f)}})}}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(h,k,j){var f=new k.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(c){j.addButtonCmd(c,"strikeThrough",f)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"strikeThrough",contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf "},void 0,j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(h,k,j,f){function c(a){function c(a){!(0<g.length)&&a[0].nodeType==b.ELEMENT_NODE&&u.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(f,"selected_cell",!0,void 0),g.push(a))}for(var d=a.createBookmarks(),e=a.getRanges(),g=[],f={},h=0;h<e.length;h++){var i=e[h];if(i.collapsed)i=i.getCommonAncestor(),(i=i.closest("td",void 0)||i.closest("th",void 0))&&g.push(i);else{var i=new Walker(i),j;for(i.guard=c;j=i.next();)if((j=j.parent())&&u.test(j.nodeName())&&
!j.data("selected_cell"))j._4e_setMarker(f,"selected_cell",!0,void 0),g.push(j)}}k.Utils.clearAllMarkers(f);a.selectBookmarks(d);return g}function a(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",e.ie||(new t(c[d]))._4e_appendBogus(void 0)}}function i(a){if(a instanceof k.Selection){for(var b=c(a),d=b.length,a=[],e,g,f=0;f<d;f++){var h=b[f].parent(),j=h[0].rowIndex;!f&&(e=j-1);a[j]=h;f==d-1&&(g=j+
1)}f=h.parent("table");e=new t(g<f[0].rows.length&&f[0].rows[g]||0<e&&f[0].rows[e]||f[0].parentNode);for(f=a.length;0<=f;f--)a[f]&&i(a[f]);return e}a instanceof t&&(f=a.parent("table"),1==f[0].rows.length?f.remove():a.remove());return 0}function d(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),g=c[0].cellIndex,f=0;f<d[0].rows.length;f++){var h=d[0].rows[f];h.cells.length<g+1||(c=new t(h.cells[g].cloneNode(void 0)),e.ie||c._4e_appendBogus(void 0),
h=new t(h.cells[g]),b?c.insertBefore(h):c.insertAfter(h))}}function g(a){if(a instanceof k.Selection){var b=c(a),d,e=[],a=b[0]&&b[0].parent("table"),f,h,j;f=0;for(h=b.length;f<h;f++)e.push(b[f][0].cellIndex);e.sort();f=1;for(h=e.length;f<h;f++)if(1<e[f]-e[f-1]){j=e[f-1]+1;break}j||(j=0<e[0]?e[0]-1:e[e.length-1]+1);e=a[0].rows;f=0;for(h=e.length;f<h&&!(d=e[f].cells[j]);f++);d=d?new t(d):a.prev();for(j=b.length-1;0<=j;j--)b[j]&&g(b[j]);return d}if(a instanceof t){b=a.parent("table");if(!b)return null;
d=a[0].cellIndex;for(j=b[0].rows.length-1;0<=j;j--)a=new t(b[0].rows[j]),!d&&1==a[0].cells.length?i(a):a[0].cells[d]&&a[0].removeChild(a[0].cells[d])}return null}function l(a,b){var c=new k.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function o(a){var c=(a=a.getSelection())&&a.getStartElement(),d=c&&c.closest("table",void 0);if(d)return a=c.closest(function(a){var c=b.nodeName(a);return d.contains(a)&&("td"==
c||"th"==c)},void 0),c=c.closest(function(a){var c=b.nodeName(a);return d.contains(a)&&"tr"==c},void 0),{table:d,td:a,tr:c}}function q(a){return(a=o(a))&&a.td}function p(a){return(a=o(a))&&a.tr}var e=h.UA,b=h.DOM,t=h.Node,s=["tr","th","td","tbody","table"],u=/^(?:td|th)$/,m={"\u8868\u683c\u5c5e\u6027":o,"\u5220\u9664\u8868\u683c":q,"\u5220\u9664\u5217":q,"\u5220\u9664\u884c":p,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":p,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":p,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":q,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":q},r=(6===e.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),n={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},x={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=h.trim(b.replace("ke_show_border","")))}}};return{init:function(c){c.addCustomStyle(r);var e=c.htmlDataProcessor,p=e&&e.htmlFilter;(e&&e.dataFilter).addRules(n);p.addRules(x);f.register({editor:c,filter:function(a){if(h.inArray(b.nodeName(a),s))return!0},statusChecker:m,
width:"120px",handlers:{"\u8868\u683c\u5c5e\u6027":function(){var a=o(c);a&&j.useDialog(c,"table/dialog",{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){var a=c.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var d=a.getRanges()[0];d.collapse();a.selectRanges([d]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){var a=c.getSelection();l(i(a),void 0)},"\u5220\u9664\u5217 ":function(){var a=c.getSelection();
(a=g(a))&&l(a,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){var b=c.getSelection();a(b,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){var b=c.getSelection();a(b,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){var a=c.getSelection();d(a,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){var a=c.getSelection();d(a,void 0)}}});c.addButton({contentCls:"ke-toolbar-table",mode:k.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c"},{offClick:function(){j.useDialog(c,"table/dialog",{selectedTable:0,selectedTd:0})}})}}},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(h,k,j){var f=new k.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(c){j.addButtonCmd(c,"underline",f)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({cmdType:"underline",contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf "},void 0,j.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(h,k,j){function f(){this.get("editor").on("afterSave afterRestore",this._respond,this);this.disable()}function c(){c.superclass.constructor.apply(this,arguments);f.call(this)}function a(){a.superclass.constructor.apply(this,arguments);f.call(this)}h.extend(c,j,{offClick:function(){this.get("editor").execCommand("undo")},_respond:function(a){0<a.index?this.boff():this.disable()}});h.extend(a,j,{offClick:function(){this.get("editor").execCommand("redo")},
_respond:function(a){a.index<a.history.length-1?this.boff():this.disable()}});return{RedoBtn:a,UndoBtn:c}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(h,k){function j(a){var c=a._getRawData(),d;c&&(d=a.getSelection());this.contents=c;this.bookmarks=d&&d.createBookmarks2(!0)}function f(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=h.buffer(this.save,500,this);this._init()}var c=k.Utils.arrayCompare,a=h.UA;h.augment(j,{equals:function(a){if(this.contents!=a.contents)return!1;var d=this.bookmarks,a=a.bookmarks;if(d||a){if(!d||!a||d.length!=a.length)return!1;for(var f=0;f<d.length;f++){var h=
d[f],i=a[f];if(h.startOffset!=i.startOffset||h.endOffset!=i.endOffset||!c(h.start,i.start)||!c(h.end,i.end))return!1}}return!0}});var i={16:1,17:1,18:1},d={37:1,38:1,39:1,40:1,33:1,34:1};h.augment(f,{_keyMonitor:function(){var a=this,c=a.editor;c.get("document").on("keydown",function(f){var h=f.keyCode;h in d||h in i||(90===h&&(f.ctrlKey||f.metaKey)?(!1!==c.fire("restore",{direction:-1})&&a.restore(-1),f.halt()):89===h&&(f.ctrlKey||f.metaKey)?(!1!==c.fire("restore",{direction:1})&&a.restore(1),f.halt()):
!1!==c.fire("save",{buffer:1})&&a.save(1))})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){if(this.editor.get("mode")==k.WYSIWYG_MODE)if(a)this.bufferRunner();else{var a=this.history,c=this.index;a.length>c+1&&a.splice(c+1,a.length-c-1);var d=this.editor,c=a[a.length-1],f=new j(d);if(!c||!c.equals(f))30===a.length&&a.shift(),a.push(f),this.index=c=a.length-1,d.fire("afterSave",{history:a,index:c})}},restore:function(c){if(this.editor.get("mode")==
k.WYSIWYG_MODE){var d=this.history,f=this.editor,h=d[this.index+c];if(h){f._setRawData(h.contents);if(h.bookmarks)f.getSelection().selectBookmarks(h.bookmarks);else if(a.ie){var i=f.get("document")[0].body.createTextRange();i.collapse(!0);i.select()}(i=f.getSelection())&&i.scrollIntoView();this.index+=c;f.fire("afterRestore",{history:d,index:this.index});f.notifySelectionChange()}return h}}});return{init:function(a){if(!a.hasCommand("save")){var c=new f(a);a.addCommand("save",{exec:function(a,d){c.save(d)}});
a.addCommand("undo",{exec:function(){c.restore(-1)}});a.addCommand("redo",{exec:function(){c.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(h,k,j,f){return{init:function(c){f.init(c);c.addButton({mode:k.WYSIWYG_MODE,title:"\u64a4\u9500",editor:c,contentCls:"ke-toolbar-undo"},void 0,j.UndoBtn);c.addButton({mode:k.WYSIWYG_MODE,title:"\u91cd\u505a",editor:c,contentCls:"ke-toolbar-redo"},void 0,j.RedoBtn)}}},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(h,k,j,f){return{init:function(c){function a(a){for(var c=0;c<g.length;c++){var d=g[c];if(d.reg.test(a))return d}}var h=c.htmlDataProcessor,d=h&&h.dataFilter,g=[],l=c.get("pluginConfig");l.video=l.video||{};l=l.video;l.providers&&g.push.apply(g,l.providers);l.getProvider=a;d&&d.addRules({elements:{object:function(c){var d=c.getAttribute("classid"),e=c.childNodes;if(!d){for(d=0;d<e.length;d++)if("embed"==e[d].name){if(!j.isFlashEmbed(e[d]))break;if(a(e[d].getAttribute("src")))return h.createFakeParserElement(c,
"ke_video","video",!0)}return null}for(d=0;d<e.length;d++){var b=e[d];if("param"==b.nodeName&&"movie"==b.getAttribute("name").toLowerCase()&&a(b.getAttribute("value")))return h.createFakeParserElement(c,"ke_video","video",!0)}},embed:function(c){if(!j.isFlashEmbed(c))return null;if(a(c.getAttribute("src")))return h.createFakeParserElement(c,"ke_video","video",!0)}}},4);var o=new f({editor:c,cls:"ke_video",type:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.selectedEl;a&&o.show(a)}}});c.addButton({contentCls:"ke-toolbar-video",
title:"\u63d2\u5165\u89c6\u9891",mode:k.WYSIWYG_MODE},{offClick:function(){o.show()}})}}},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(h,k,j,f){function c(){c.superclass.constructor.apply(this,arguments)}h.extend(c,j,{_updateTip:function(a,c){var d=this.get("editor").restoreRealElement(c);d&&(a.html(c.attr("title")),a.attr("href",this._getFlashUrl(d)))}});return{init:function(a){function h(a){return/xiami\.com/i.test(a)}var d=a.htmlDataProcessor,g=d&&d.dataFilter;g&&g.addRules({tags:{object:function(a){var c=a.getAttribute("title"),g,e;g=a.getAttribute("classid");var b=a.childNodes;
if(!g){for(g=0;g<b.length;g++)if(e=b[g],"embed"==e.nodeName){if(!f.isFlashEmbed(e))break;if(h(e.attributes.src))return d.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:c})}return null}for(g=0;g<b.length;g++)if(e=b[g],"param"==e.nodeName&&"movie"==e.getAttribute("name")&&h(e.getAttribute("value")))return d.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:c})},embed:function(a){if(f.isFlashEmbed(a)&&h(a.getAttribute("src")))return d.createFakeParserElement(a,"ke_xiami","xiamiMusic",
!0,{title:a.getAttribute("title")})}}},4);var j=new c({editor:a,cls:"ke_xiami",type:"xiamiMusic",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.selectedEl;a&&j.show(a)}}});a.addButton({contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",mode:k.WYSIWYG_MODE},{offClick:function(){j.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});KISSY.add("editor/full",function(h,k){return k},{requires:["editor"]});
