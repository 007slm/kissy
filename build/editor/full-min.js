/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 28 19:44
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(h,i,l){i=l.define(l.Controller,[l.UIBase.Box],{initializer:function(){var d;this.__commands={};this.__dialogs={};if(d=this.get("textarea")){if(!this.get("render")&&!this.get("elBefore")){var f=d.next();f?this.__set("elBefore",f):this.__set("render",d.parent())}}else this.__editor_created_new=1},use:function(d,f){var c=this,k=c.__CORE_PLUGINS||["htmlDataProcessor","enterKey","clipboard","selection"];h.isString(d)&&(d=d.split(","));for(var a=d.length-1;0<=a;a--)d[a]||
d.splice(a,1);for(a=0;a<k.length;a++){var g=k[a];h.inArray(g,d)||d.unshift(g)}h.each(d,function(c,a){d[a]&&(d[a]="editor/plugin/"+c+"/")});h.use(d,function(){var a,g=h.makeArray(arguments);g.shift();for(var d=0;d<g.length;d++)g[d]&&g[d].init(c);f&&f.call(c);(a=c.get("height"))&&c._uiSetHeight(a)});c.__CORE_PLUGINS=[];return c}},{Config:{},XHTML_DTD:i.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},iframeWrapEl:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},
mode:{value:1},data:{getter:function(){return this._getData()},setter:function(d){return this._setData(d)}},formatData:{getter:function(){return this._getData(1)},setter:function(d){return this._setData(d)}},prefixCls:{value:"ke-"}}},"Editor");h.mix(i,h.EventTarget);return KISSY.Editor=i},{requires:["htmlparser","component","core"]});
KISSY.add("editor/plugin/clipboard/index",function(h){function i(e){this.editor=e;this._init()}function l(b){if(c.ie&&"BackCompat"!=b.get("document")[0].compatMode){var a=b.getSelection(),g;if(a.getType()==e.SELECTION_ELEMENT&&(g=a.getSelectedElement())){var d=a.getRanges()[0],q=new f(b.get("document")[0].createTextNode(""));q.insertBefore(g);d.setStartBefore(q);d.setEndAfter(g);a.selectRanges([d]);setTimeout(function(){g.parent()&&(q.remove(),a.selectElement(g))},0)}}}var d=h.Editor,f=h.Node,c=h.UA,
k=d.Range,a=d.RANGE,g=h.Event;h.augment(i,{_init:function(){var e=this.editor;g.on(e.get("document")[0].body,c.webkit?"paste":c.gecko?"paste":"beforepaste",this._paste,this);g.on(e.get("document")[0].body,"contextmenu",function(){q=1;setTimeout(function(){q=0},10)});e.addCommand("copy",new p("copy"));e.addCommand("cut",new p("cut"));e.addCommand("paste",new p("paste"))},_paste:function(){if(!q){var e=this.editor,b=e.get("document")[0];if(!b.getElementById("ke_pastebin")){var g=e.getSelection(),d=
new k(b),r=new f(c.webkit?"<body></body>":"<div></div>",null,b);r.attr("id","ke_pastebin");c.webkit&&r[0].appendChild(b.createTextNode("\u00a0"));b.body.appendChild(r[0]);r.css({position:"absolute",top:g.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});r.css("left","-1000px");var j=g.createBookmarks();d.setStartAt(r,a.POSITION_AFTER_START);d.setEndAt(r,a.POSITION_BEFORE_END);d.select(!0);setTimeout(function(){r.remove();var b;r=c.webkit&&(b=r.first())&&b.hasClass("Apple-style-span")?
b:r;g.selectBookmarks(j);b=r.html();if(b=h.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var a=e.fire("paste",{html:b,holder:r});void 0!==a&&(b=a);a=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)&&(a=e.htmlDataProcessor.wordFilter);e.insertHtml(b,a)}},0)}}}});var j=function(b,e){var a=b.get("document")[0],g=new f(a.body),d=!1,q=function(){d=!0};g.on(e,q);(7<c.ie?a:a.selection.createRange()).execCommand(e);g.detach(e,q);return d},n=c.ie?function(b,e){return j(b,
e)}:function(b,e){try{return b.get("document")[0].execCommand(e)}catch(a){return!1}},m={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},p=function(b){this.type=b};p.prototype={exec:function(b){"cut"==this.type&&l(b);(b=n(b,this.type))||alert(m[this.type]);return b}};var e=d.Selection,b={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},q;d.on("contextmenu",function(e){var a=e.contextmenu,c=a.get("editor"),
g=a.menu.get("contentEl"),d={copy:0,cut:0,paste:0},q;for(q in d)d.hasOwnProperty(q)&&(d[q]=g.one(".ke-paste-"+q),d[q]||function(e){var o=(new f("<a href='#'class='ke-paste-"+e+"'>"+b[e]+"</a>")).appendTo(g);o.on("click",function(b){b.halt();a.hide();setTimeout(function(){c.execCommand(e)},30)});d[e]=o}(q))});return{init:function(b){b.docReady(function(){new i(b)})}}},{requires:["editor"]});
KISSY.add("editor/core/dom",function(h){function i(e,b){var a=e[b?"next":"prev"]();if(a&&a[0].nodeType==f.ELEMENT_NODE){for(var c=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(l);)if(c.push(a),a=b?a.next():a.prev(),!a)return;if(e._4e_isIdentical(a,l)){for(var g=new k(b?e[0].lastChild:e[0].firstChild);c.length;)c.shift()._4e_move(e,!b,l);a._4e_moveChildren(e,!b,l);a.remove();g[0]&&g[0].nodeType==f.ELEMENT_NODE&&g._4e_mergeSiblings()}}}var l=l,d=h.Editor,f=h.DOM,c=h.UA,k=h.Node,a=d.Utils,
g={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};d.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var j=d.POSITION,n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},m={hr:1},p=function(e){return e&&(e[0]||e)};a.injectDom({_4e_sameLevel:function(e,b){var b=p(b),a=e.parentNode;return a&&a==b.parentNode},_4e_isBlockBoundary:function(e,b){var a=h.merge(m,b);return!(!n[f.css(e,"display")]&&!a[f.nodeName(e)])},_4e_getWin:f._getWin,_4e_index:function(e,b){for(var a=e.parentNode.childNodes,c,g=-1,d=0;d<a.length;d++)if(c=a[d],!b||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(g++,c===e)return g;return-1},_4e_move:function(e,
b,a){b=p(b);a?b.insertBefore(e,b.firstChild):b.appendChild(e)},_4e_isIdentical:function(e,b){if(!b)return!1;b=p(b);if(f.nodeName(e)!=f.nodeName(b))return!1;var c=e.attributes,g=b.attributes,d=c.length,k=g.length;if(d!=k)return!1;for(var t=0;t<d;t++){var j=c[t],h=j.name;if(j.specified&&f.attr(e,h)!=f.attr(b,h))return!1}if(8>a.ieEngine)for(t=0;t<k;t++)if(j=g[t],h=j.name,j.specified&&f.attr(e,h)!=f.attr(b,h))return!1;return!0},_4e_isEmptyInlineRemovable:function(e){for(var e=e.childNodes,b=0,a=e.length;b<
a;b++){var c=e[b],g=c.nodeType;if(!(g==f.ELEMENT_NODE&&c.getAttribute("_ke_bookmark"))&&(g==f.ELEMENT_NODE&&!f._4e_isEmptyInlineRemovable(c)||g==f.TEXT_NODE&&h.trim(c.nodeValue)))return!1}return!0},_4e_moveChildren:function(e,b,a){b=p(b);if(e!=b)if(a)for(;a=e.lastChild;)b.insertBefore(e.removeChild(a),b.firstChild);else for(;a=e.firstChild;)b.appendChild(e.removeChild(a))},_4e_mergeSiblings:function(e){e=new k(e);g[e.nodeName()]&&(i(e,!0),i(e))},_4e_splitText:function(e,b){var a=e.ownerDocument;if(e.nodeType==
f.TEXT_NODE){if(c.ie&&b==e.nodeValue.length){var g=a.createTextNode("");f.insertAfter(g,e);return g}g=e.splitText(b);a.documentMode&&(a=a.createTextNode(""),f.insertAfter(a,g),f.remove(a));return g}},_4e_parents:function(e,b){var a=[];a.__IS_NODELIST=1;do a[b?"push":"unshift"](e);while(e=e.parentNode);return a},_4e_nextSourceNode:function(e,b,a,c){if(c&&!c.call)var g=p(c),c=function(b){return b!==g};var b=!b&&e.firstChild,d=e;if(!b){if(e.nodeType==f.ELEMENT_NODE&&c&&!1===c(e,!0))return null;b=e.nextSibling}for(;!b&&
(d=d.parentNode);){if(c&&!1===c(d,!0))return null;b=d.nextSibling}return!b||c&&!1===c(b)?null:a&&a!=b.nodeType?f._4e_nextSourceNode(b,!1,a,c):b},_4e_previousSourceNode:function(e,b,a,c){if(c&&!c.call)var g=p(c),c=function(b){return b!==g};var b=!b&&e.lastChild,d=e;if(!b){if(e.nodeType==f.ELEMENT_NODE&&c&&!1===c(e,!0))return null;b=e.previousSibling}for(;!b&&(d=d.parentNode);){if(c&&!1===c(d,!0))return null;b=d.previousSibling}return!b||c&&!1===c(b)?null:a&&b.nodeType!=a?f._4e_previousSourceNode(b,
!1,a,c):b},_4e_commonAncestor:function(e,b){b=p(b);if(e===b)return e;if(f.contains(b,e))return b;var a=e;do if(f.contains(a,b))return a;while(a=a.parentNode);return null},_4e_hasAttributes:9>a.ieEngine?function(e){for(var b=e.attributes,a=0;a<b.length;a++){var c=b[a];switch(c.name){case "class":if(e.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(e){c.gecko&&e.removeAttribute("_moz_dirty");return e.hasAttributes()},_4e_position:function(e,b){var a=p(b);if(e.compareDocumentPosition)return e.compareDocumentPosition(a);
if(e==a)return j.POSITION_IDENTICAL;if(e.nodeType==f.ELEMENT_NODE&&a.nodeType==f.ELEMENT_NODE){if(f.contains(e,a))return j.POSITION_CONTAINS+j.POSITION_PRECEDING;if(f.contains(a,e))return j.POSITION_IS_CONTAINED+j.POSITION_FOLLOWING;if("sourceIndex"in e)return 0>e.sourceIndex||0>a.sourceIndex?j.POSITION_DISCONNECTED:e.sourceIndex<a.sourceIndex?j.POSITION_PRECEDING:j.POSITION_FOLLOWING}for(var c=f._4e_address(e),a=f._4e_address(a),g=Math.min(c.length,a.length),d=0;d<=g-1;d++)if(c[d]!=a[d])return c[d]<
a[d]?j.POSITION_PRECEDING:j.POSITION_FOLLOWING;return c.length<a.length?j.POSITION_CONTAINS+j.POSITION_PRECEDING:j.POSITION_IS_CONTAINED+j.POSITION_FOLLOWING},_4e_address:function(e,b){for(var a=[],c=e.ownerDocument.documentElement,g=e;g&&g!=c;)a.unshift(f._4e_index(g,b)),g=g.parentNode;return a},_4e_remove:function(e,b){var a=e.parentNode;if(a){if(b)for(var c;c=e.firstChild;)a.insertBefore(e.removeChild(c),e);a.removeChild(e)}return e},_4e_trim:function(e){f._4e_ltrim(e);f._4e_rtrim(e)},_4e_ltrim:function(e){for(var b;b=
e.firstChild;){if(b.nodeType==f.TEXT_NODE){var c=a.ltrim(b.nodeValue),g=b.nodeValue.length;if(c)c.length<g&&(f._4e_splitText(b,g-c.length),e.removeChild(e.firstChild));else{e.removeChild(b);continue}}break}},_4e_rtrim:function(e){for(var b;b=e.lastChild;){if(b.type==f.TEXT_NODE){var g=a.rtrim(b.nodeValue),d=b.nodeValue.length;if(g)g.length<d&&(f._4e_splitText(b,g.length),e.removeChild(e.lastChild));else{e.removeChild(b);continue}}break}!c.ie&&!c.opera&&(b=e.lastChild)&&1==b.nodeType&&"br"==f.nodeName(b)&&
e.removeChild(b)},_4e_appendBogus:function(e){for(var b=e.lastChild;b&&b.nodeType==f.TEXT_NODE&&!h.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==f.TEXT_NODE||"br"!==f.nodeName(b))b=c.opera?e.ownerDocument.createTextNode(""):e.ownerDocument.createElement("br"),c.gecko&&b.setAttribute("type","_moz"),e.appendChild(b)},_4e_outerHtml:function(e){if(e.outerHTML)return e.outerHTML.replace(/<\?[^>]*>/,"");var b=e.ownerDocument.createElement("div");b.appendChild(e.cloneNode(!0));return b.innerHTML},
_4e_setMarker:function(e,b,a,c){var e=new k(e),g=e.data("list_marker_id")||e.data("list_marker_id",h.guid()).data("list_marker_id"),d=e.data("list_marker_names")||e.data("list_marker_names",{}).data("list_marker_names");b[g]=e;d[a]=1;return e.data(a,c)},_4e_clearMarkers:function(e,b,a){var e=new k(e),c=e.data("list_marker_names"),g=e.data("list_marker_id"),d;for(d in c)c.hasOwnProperty(d)&&e.removeData(d);e.removeData("list_marker_names");a&&(e.removeData("list_marker_id"),delete b[g])},_4e_copyAttributes:function(e,
b,a){for(var b=new k(b),g=e.attributes,a=a||{},d=0;d<g.length;d++){var j=g[d],t=j.name.toLowerCase(),h;if(!(t in a))if("checked"==t&&(h=f.attr(e,t)))b.attr(t,h);else if(j.specified||c.ie&&j.value&&"value"==t)h=f.attr(e,t),null===h&&(h=j.nodeValue),b.attr(t,h)}""!==e.style.cssText&&(b[0].style.cssText=e.style.cssText)},_4e_isEditable:function(e){var e=f.nodeName(e),b=d.XHTML_DTD;return(e=!b.$nonEditable[e]&&(b[e]||b.span))&&e["#"]},_4e_getByAddress:function(e,b,a){for(var e=e.documentElement,c=0;e&&
c<b.length;c++){var g=b[c];if(a)for(var d=-1,k=0;k<e.childNodes.length;k++){var j=e.childNodes[k];if(!(!0===a&&3==j.nodeType&&j.previousSibling&&3==j.previousSibling.nodeType)&&(d++,d==g)){e=j;break}}else e=e.childNodes[g]}return e}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(h){function i(e){1>arguments.length||(this.range=e,this.forceBrBreak=d,this.enlargeBr=l,this.enforceRealBlocks=d,this._||(this._={}))}var l=!0,d=!1,f=h.Editor,c=h.UA,k=f.Walker,a=f.Range,g=f.RANGE,j=f.ElementPath,n=h.Node,m=h.DOM,p=/^[\r\n\t ]*$/;h.augment(i,{getNextParagraph:function(e){var b,f,o,i,v;if(!this._.lastNode){f=this.range.clone();f.shrink(g.SHRINK_ELEMENT,l);f.enlarge(this.forceBrBreak||!this.enlargeBr?g.ENLARGE_LIST_ITEM_CONTENTS:g.ENLARGE_BLOCK_CONTENTS);
var t=new k(f),r=k.bookmark(l,l);t.evaluator=r;this._.nextNode=t.next();t=new k(f);t.evaluator=r;t=t.previous();this._.lastNode=t._4e_nextSourceNode(l);this._.lastNode&&this._.lastNode[0].nodeType==m.TEXT_NODE&&!h.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(r=new a(f.document),r.moveToPosition(this._.lastNode,g.POSITION_AFTER_END),r.checkEndOfBlock()&&(r=new j(r.endContainer),this._.lastNode=(r.block||r.blockLimit)._4e_nextSourceNode(l)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new n(f.document.createTextNode("")),m.insertAfter(this._.lastNode[0],t[0]));f=null}r=this._.nextNode;t=this._.lastNode;for(this._.nextNode=null;r;){var x=d,y=r[0].nodeType!=m.ELEMENT_NODE,z=d;if(y)r[0].nodeType==m.TEXT_NODE&&p.test(r[0].nodeValue)&&(y=d);else{var w=r.nodeName();if(r._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==w)y=l;else if(!f&&!r[0].childNodes.length&&"hr"!=w){b=r;o=r.equals(t);break}f&&(f.setEndAt(r,g.POSITION_BEFORE_START),"br"!=
w&&(this._.nextNode=r));x=l}else{if(r[0].firstChild){f||(f=new a(this.range.document),f.setStartAt(r,g.POSITION_BEFORE_START));r=new n(r[0].firstChild);continue}y=l}}y&&!f&&(f=new a(this.range.document),f.setStartAt(r,g.POSITION_BEFORE_START));o=(!x||y)&&r.equals(t);if(f&&!x)for(;!r[0].nextSibling&&!o;){w=r.parent();if(w._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){x=l;o||w.equals(t);break}r=w;y=l;o=r.equals(t);z=l}y&&f.setEndAt(r,g.POSITION_AFTER_END);r=r._4e_nextSourceNode(z,null,t);if((o=!r)||
x&&f)break}if(!b){if(!f)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;b=new j(f.startContainer);r=b.blockLimit;x={div:1,th:1,td:1};b=b.block;if((!b||!b[0])&&!this.enforceRealBlocks&&x[r.nodeName()]&&f.checkStartOfBlock()&&f.checkEndOfBlock())b=r;else if(!b||this.enforceRealBlocks&&"li"==b.nodeName())b=new n(this.range.document.createElement(e||"p")),b[0].appendChild(f.extractContents()),b._4e_trim(),f.insertNode(b),i=v=l;else if("li"!=b.nodeName()){if(!f.checkStartOfBlock()||
!f.checkEndOfBlock())b=b.clone(d),b[0].appendChild(f.extractContents()),b._4e_trim(),v=f.splitBlock(),i=!v.wasStartOfBlock,v=!v.wasEndOfBlock,f.insertNode(b)}else o||(this._.nextNode=b.equals(t)?null:f.getBoundaryNodes().endNode._4e_nextSourceNode(l,null,t))}i&&(f=new n(b[0].previousSibling),f[0]&&f[0].nodeType==m.ELEMENT_NODE&&("br"==f.nodeName()?f._4e_remove():f[0].lastChild&&"br"==m.nodeName(f[0].lastChild)&&m._4e_remove(f[0].lastChild)));v&&(f=k.bookmark(d,l),i=new n(b[0].lastChild),i[0]&&i[0].nodeType==
m.ELEMENT_NODE&&"br"==i.nodeName()&&(c.ie||i.prev(f)||i.next(f))&&i.remove());this._.nextNode||(this._.nextNode=o||b.equals(t)?null:b._4e_nextSourceNode(l,null,t));return b}});a.prototype.createIterator=function(){return new i(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(h){function i(g){for(var j=c,h=c,m=[];g;){if(g[0].nodeType==d.ELEMENT_NODE){this.lastElement||(this.lastElement=g);var p=g.nodeName();if(!h&&(!j&&k[p]&&(j=g),a[p])){var e;if(e=!j)if(e="div"==p){a:{e=g[0].childNodes;for(var b=0,i=e.length;b<i;b++){var o=e[b];if(o.nodeType==d.ELEMENT_NODE&&f.$block[o.nodeName.toLowerCase()]){e=!0;break a}}e=!1}e=!e}e?j=g:h=g}m.push(g);if("body"==p)break}g=g.parent()}this.block=j;this.blockLimit=h;this.elements=m}var l=h.Editor,
d=h.DOM,f=l.XHTML_DTD,c=null,k={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},a={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};i.prototype={compare:function(a){var c=this.elements,a=a&&a.elements;if(!a||c.length!=a.length)return!1;for(var f=0;f<c.length;f++)if(!d.equals(c[f],a[f]))return!1;return!0},contains:function(a){for(var d=this.elements,f=0;f<d.length;f++)if(d[f].nodeName()in a)return d[f];return c},toString:function(){var a=this.elements,
c,d=[];for(c=0;c<a.length;c++)d.push(a[c].nodeName());return d.toString()}};return l.ElementPath=i},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/enterKey/index",function(h){function i(g){var d;d=g.getSelection().getRanges();for(var e=d.length-1;0<e;e--)d[e].deleteContents();d=d[0];e=d.document;if(d.checkStartOfBlock()&&d.checkEndOfBlock()){var b=(new n(d.startContainer)).block;if(b&&("li"==b.nodeName()||"li"==b.parent().nodeName()))return g.hasCommand("outdent")?(g.execCommand("save"),g.execCommand("outdent"),g.execCommand("save"),!0):!1}var i=d.splitBlock("p");if(!i)return!0;var g=i.previousBlock,b=i.nextBlock,o=
i.wasStartOfBlock,l=i.wasEndOfBlock,v;if(b)v=b.parent(),"li"==v.nodeName()&&(b._4e_breakParent(v),b._4e_move(b.next(),!0));else if(g&&(v=g.parent())&&"li"==v.nodeName())g._4e_breakParent(v),d.moveToElementEditablePosition(g.next()),g._4e_move(g.prev());if(!o&&!l){if("li"==b.nodeName()&&(v=b.first(j.invisible(!0)))&&h.inArray(v.nodeName(),["ul","ol"]))(f.ie?new a(e.createTextNode("\u00a0")):new a(e.createElement("br"))).insertBefore(v);b&&d.moveToElementEditablePosition(b)}else{var t;if(g){if("li"==g.nodeName()||
!c.test(g.nodeName()))t=g.clone()}else b&&(t=b.clone());t||(t=new a("<p>",null,e));if(v=i.elementPath)for(var i=0,r=v.elements.length;i<r;i++){var x=v.elements[i];if(x.equals(v.block)||x.equals(v.blockLimit))break;k.$removeEmpty[x.nodeName()]&&(x=x.clone(),t._4e_moveChildren(x),t.append(x))}f.ie||t._4e_appendBogus();d.insertNode(t);if(f.ie&&o&&(!l||!g[0].childNodes.length))d.moveToElementEditablePosition(l?g:t),d.select();d.moveToElementEditablePosition(o&&!l?b:t)}f.ie||(b?(t=new a(e.createElement("span")),
t.html("&nbsp;"),d.insertNode(t),t.scrollIntoView(void 0,!1),d.deleteContents()):t.scrollIntoView(void 0,!1));d.select();return!0}function l(a){var c=a.get("document")[0];g.on(c,"keydown",function(e){if(13===e.keyCode&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){a.execCommand("save");var b=a.execCommand("enterBlock");a.execCommand("save");!1!==b&&e.preventDefault()}})}var d=h.Editor,f=h.UA,c=/^h[1-6]$/,k=d.XHTML_DTD,a=h.Node,g=h.Event,j=d.Walker,n=d.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:i});a.docReady(function(){l(a)})}}},{requires:["editor"]});
KISSY.add("editor/core/focusManager",function(h){function i(){var c=this;c.__iframeFocus=j;g=c;a&&clearTimeout(a);a=setTimeout(function(){c.fire("focus")},100)}function l(){var c=this;c.__iframeFocus=n;g=m;a&&clearTimeout(a);a=setTimeout(function(){c.fire("blur")},100)}var d=h.Editor,f=h.DOM,c=h.Event,k={},a,g,h={refreshAll:function(){for(var a in k)if(k.hasOwnProperty(a)){var e=k[a].get("document")[0];e.designMode="off";e.designMode="on"}},currentInstance:function(){return g},getInstance:function(a){return k[a]},
add:function(a){var e=f._4e_getWin(a.get("document")[0]);c.on(e,"focus",i,a);c.on(e,"blur",l,a)},register:function(a){k[a._UUID]=a},remove:function(a){delete k[a._UUID];var e=f._4e_getWin(a.get("document")[0]);c.remove(e,"focus",i,a);c.remove(e,"blur",l,a)}},j=!0,n=!1,m=null;h.refreshAll=h.refreshAll;d.focusManager=h;d.getInstances=function(){return k};return h},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/htmlDataProcessor/index",function(h){return{init:function(i){function l(a){return a.replace(e,function(a,e,c){return"<"+e+c.replace(b,function(b,a){return-1==c.indexOf("_ke_saved_"+a)?" _ke_saved_"+b+" "+b:b})+">"})}function d(b){return b.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(b){return"<\!--"+q+"{C}"+encodeURIComponent(b).replace(/--/g,"%2D%2D")+"--\>"})}function f(b){return b.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(b,a){return decodeURIComponent(a)})}
var c=c,k=h.Editor,a=h.Node,g=h.UA,j=h.require("htmlparser"),n=new j.Filter,m=new j.Filter,p=new j.Filter;(function(){var b=function(b,a){return function(e,c){var g=[];(""+e).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,d,f){d=d.toLowerCase();"font-family"==d&&(f=f.replace(/["']/g,""));for(var k,j,h,o=0;o<b.length;o++)if(b[o]&&(e=b[o][0],k=b[o][1],j=b[o][2],h=b[o][3],d.match(e)&&(!k||f.match(k)))){d=h||d;a&&(j=j||f);"function"==typeof j&&(j=j(f,c,d));j&&j.push&&
(d=j[0],j=j[1]);"string"==typeof j&&g.push([d,j]);return}!a&&g.push([d,f])});for(var d=0;d<g.length;d++)g[d]=g[d].join(":");return g.length?g.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],c),a={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(b){b.filterChildren()},tags:{p:function(b){b.filterChildren()},$:function(b){var a=b.nodeName||"";if(-1!=a.indexOf(":")&&
!/^ke/.test(a))if("v:imagedata"==a){if(a=b.getAttribute("o:href"))b.setAttribute("src",a),b.removeAttribute("o:href");if(a=b.getAttribute("o:title"))b.setAttribute("title",a),b.removeAttribute("o:title");b.setTagName("img")}else b.setTagName("")}},attributes:{"class":function(b){return!b||/(^|\s+)Mso/.test(b)?!1:b},style:function(a){a=b(a);return!a?!1:a}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},e={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(b){if(b.attributes.length)for(var a=
["name","href","src"],e,c=0;c<a.length;c++)e="_ke_saved_"+a[c],b.getAttribute(e)&&b.removeAttribute(a[c]);return b},embed:function(b){var a=b.parentNode;if(a&&"object"==a.nodeName){var e=a.getAttribute("width"),a=a.getAttribute("height");e&&b.setAttribute("width",e);a&&b.setAttribute("width",a)}},a:function(b){if(!b.childNodes.length&&!b.attributes.length)return!1},span:function(b){if(!b.childNodes.length&&!b.attributes.length)return!1}},attributes:{style:function(b){if(!h.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(b){return b.substr(0,q.length)==q?(b="{C}"==b.substr(q.length,3)?b.substr(q.length+3):b.substr(q.length),new j.CData(decodeURIComponent(b))):b}};g.ie&&(e.attributes.style=function(b){return b.replace(/(^|;)([^:]+)/g,function(b){return b.toLowerCase()})});n.addRules(e);m.addRules(a);p.addRules(a)})();(function(){function b(a){for(var a=a.childNodes,e=a.length,c=a[e-1];c&&3==c.nodeType&&!h.trim(c.nodeValue);)c=a[--e];return c}
function a(e,c){var d=b(e);d&&((c||!g.ie)&&1==d.nodeType&&"br"==d.nodeName?e.removeChild(d):3==d.nodeType&&f.test(d.nodeValue)&&e.removeChild(d))}function e(a){var c=b(a);return!c||1==c.nodeType&&"br"==c.nodeName||"form"==a.nodeName&&"input"==c.nodeName}function c(b){a(b,!0);e(b)&&(g.ie?b.appendChild(new j.Text("\u00a0")):(b.appendChild(new j.Text("&nbsp;")),b.appendChild(new j.Tag("br"))))}function d(b){a(b,!1);e(b)&&b.appendChild(new j.Text("\u00a0"))}var f=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,i=k.XHTML_DTD,l=h.merge(i.$block,
i.$listItem,i.$tableContent),q;for(q in l)l.hasOwnProperty(q)&&("br"in i[q]||delete l[q]);delete l.td;delete l.pre;var i={tags:{}},s={tags:{}};for(q in l)l.hasOwnProperty(q)&&(i.tags[q]=c,s.tags[q]=d);m.addRules(i);n.addRules(s);p.addRules(i)})();(function(){n.addRules({text:function(b){return b.replace(/\xa0/g,"&nbsp;")}})})();var e=/<(a|area|img|input)\b([^>]*)>/gi,b=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,q="{ke_protected}";i.htmlDataProcessor={wordFilter:p,dataFilter:m,
htmlFilter:n,toHtml:function(b){var a=new j.BeautifyWriter;(new j.Parser(b)).parse().writeHtml(a,n);return a.getHtml()},toDataFormat:function(b,e,c){c=c||m;g.gecko&&(b=b.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));b=l(b);e=new a("<div>");e.html("a"+b);b=e.html().substr(1);b=f(b);e=new j.BeautifyWriter;(new j.Parser(b)).parse().writeHtml(e,c);b=e.getHtml();return b=d(b)},toServer:function(b){var a=new j.MinifyWriter;(new j.Parser(b)).parse().writeHtml(a,n);return a.getHtml()}}}}},
{requires:["editor"]});
KISSY.add("editor/core/meta",function(){var h={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../select/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubbleview/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],insertOrderedList:["../listUtils/btn","./cmd"],insertUnorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubbleview/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["./focus","dd"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui","./cmd"],
undo:["./btn","./cmd"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},i,l,d={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../select/"],"flashCommon/baseClass":["../contextmenu/","../bubbleview/","../dialogLoader/","./utils"],
"font/ui":["../button/","../select/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../select/"],"indent/cmd":["../dentUtils/cmd"],"insertOrderedList/cmd":["../listUtils/cmd"],"insertUnorderedList/cmd":["../listUtils/cmd.js"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],"link/dialog":["../overlay/",
"./utils"],"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../select/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../select/"],"xiamiMusic/dialog":["../flash/dialog","../select/"]},f={};for(i in h)l="editor/plugin/"+i+"/index",f[l]={requires:h[i]};
for(i in d)l="editor/plugin/"+i,f[l]={requires:d[i]};KISSY.add(f)});
KISSY.add("editor/core/range",function(h,i,l,d,f){function c(b){var a=b.nodeType!=o.TEXT_NODE&&o.nodeName(b)in v.$removeEmpty,e=b.nodeType==o.TEXT_NODE&&!h.trim(b.nodeValue),b=!!b.parentNode.getAttribute("_ke_bookmark");return a||e||b}function k(b){return!y(b)&&!z(b)}function a(b){var a=p;return function(e){if(z(e))return m;if(e.nodeType==o.TEXT_NODE){if(h.trim(e.nodeValue).length)return p}else if(e.nodeType==o.ELEMENT_NODE&&(e=o.nodeName(e),!B[e]))if(!b&&!u.ie&&"br"==e&&!a)a=m;else return p;return m}}
function g(b,a){var e=b.startContainer,c=b.endContainer,g=b.startOffset,d=b.endOffset,f,k=p,j=p,h=void 0,i=b.document,r;if(b.collapsed)return h;0<a&&(h=i.createDocumentFragment());b.optimizeBookmark();c[0].nodeType==o.TEXT_NODE?(j=m,c=c._4e_splitText(d)):0<c[0].childNodes.length&&(d>=c[0].childNodes.length?(c=new t(c[0].appendChild(i.createTextNode(""))),r=m):c=new t(c[0].childNodes[d]));e[0].nodeType==o.TEXT_NODE?(k=m,e._4e_splitText(g)):g?g>=e[0].childNodes.length?(e=new t(e[0].appendChild(i.createTextNode(""))),
f=m):e=new t(e[0].childNodes[g].previousSibling):(f=new t(i.createTextNode("")),e.prepend(f),e=f,f=m);var v=e._4e_parents(),n=c._4e_parents();v.each(function(b,a){v[a]=b});n.each(function(b,a){n[a]=b});for(var y,l,i=0;i<v.length&&!(y=v[i],l=n[i],!y.equals(l));i++);for(var g=h,s,q,x=i;x<v.length;x++){s=v[x];d=0<a&&!s.equals(e)?g.appendChild(s.clone()[0]):null;s=s[0].nextSibling;q=n[x];for(var z=c[0],u=q&&q[0];s&&!(u==s||z==s);)q=s.nextSibling,2==a?g.appendChild(s.cloneNode(m)):(o._4e_remove(s),1==
a&&g.appendChild(s)),s=q;d&&(g=d)}for(g=h;i<n.length;i++){s=n[i];d=0<a&&!s.equals(c)?g.appendChild(s.clone()[0]):null;if(!v[i]||!s._4e_sameLevel(v[i]))for(s=s[0].previousSibling;s;)q=s.previousSibling,2==a?g.insertBefore(s.cloneNode(m),g.firstChild):(o._4e_remove(s),1==a&&g.insertBefore(s,g.firstChild)),s=q;d&&(g=d)}if(2==a){if(k&&(y=e[0],y.nodeType==o.TEXT_NODE&&y.nextSibling&&y.nextSibling.nodeType==o.TEXT_NODE&&(y.data+=y.nextSibling.data,y.parentNode.removeChild(y.nextSibling))),j)j=c[0],j.nodeType==
o.TEXT_NODE&&j.previousSibling&&j.previousSibling.nodeType==o.TEXT_NODE&&(j.previousSibling.data+=j.data,j.parentNode.removeChild(j))}else{if(y&&l&&(!e._4e_sameLevel(y)||!c._4e_sameLevel(l)))j=y._4e_index(),f&&y._4e_sameLevel(e)&&j--,b.setStart(y.parent(),j+1);b.collapse(m)}f&&e.remove();r&&c.remove();return h}function j(b){b.collapsed=b.startContainer&&b.endContainer&&b.startContainer[0]==b.endContainer[0]&&b.startOffset==b.endOffset}function n(b){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=e;this.collapsed=m;this.document=b}i.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var m=!0,p=!1,e=null,b=i.RANGE,q=i.POSITION,o=h.DOM,u=h.UA,v=i.XHTML_DTD,t=h.Node,r=t.all,x={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},y=new d.whitespaces,z=new d.bookmark,w=d.whitespaces(m),s=d.bookmark(!1,
!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};h.augment(n,{toString:function(){var b=[],a=this.startContainer[0],e=this.endContainer[0];b.push((a.id||a.nodeName)+":"+this.startOffset);b.push((e.id||e.nodeName)+":"+this.endOffset);return b.join("<br/>")},optimize:function(){var b=this.startContainer,a=this.startOffset;b[0].nodeType!=o.ELEMENT_NODE&&(a?a>=b[0].nodeValue.length&&
this.setStartAfter(b):this.setStartBefore(b));b=this.endContainer;a=this.endOffset;b[0].nodeType!=o.ELEMENT_NODE&&(a?a>=b[0].nodeValue.length&&this.setEndAfter(b):this.setEndBefore(b))},setStartAfter:function(b){this.setStart(b.parent(),b._4e_index()+1)},setStartBefore:function(b){this.setStart(b.parent(),b._4e_index())},setEndAfter:function(b){this.setEnd(b.parent(),b._4e_index()+1)},setEndBefore:function(b){this.setEnd(b.parent(),b._4e_index())},optimizeBookmark:function(){var b=this.startContainer,
a=this.endContainer;b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setStartBefore(b);a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setEndAfter(a)},setStart:function(b,a){b[0].nodeType==o.ELEMENT_NODE&&x[b.nodeName()]&&(b=b.parent(),a=b._4e_index());this.startContainer=b;this.startOffset=a;this.endContainer||(this.endContainer=b,this.endOffset=a);j(this)},setEnd:function(b,a){b[0].nodeType==o.ELEMENT_NODE&&x[b.nodeName()]&&(b=b.parent(),a=b._4e_index()+1);this.endContainer=b;this.endOffset=
a;this.startContainer||(this.startContainer=b,this.startOffset=a);j(this)},setStartAt:function(a,e){switch(e){case b.POSITION_AFTER_START:this.setStart(a,0);break;case b.POSITION_BEFORE_END:a[0].nodeType==o.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case b.POSITION_BEFORE_START:this.setStartBefore(a);break;case b.POSITION_AFTER_END:this.setStartAfter(a)}j(this)},setEndAt:function(a,e){switch(e){case b.POSITION_AFTER_START:this.setEnd(a,0);break;
case b.POSITION_BEFORE_END:a[0].nodeType==o.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case b.POSITION_BEFORE_START:this.setEndBefore(a);break;case b.POSITION_AFTER_END:this.setEndAfter(a)}j(this)},cloneContents:function(){return g(this,2)},deleteContents:function(){return g(this,0)},extractContents:function(){return g(this,1)},collapse:function(b){b?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=m},clone:function(){var b=new n(this.document);b.startContainer=this.startContainer;b.startOffset=this.startOffset;b.endContainer=this.endContainer;b.endOffset=this.endOffset;b.collapsed=this.collapsed;return b},getEnclosedNode:function(){var b=this.clone();b.optimize();if(b.startContainer[0].nodeType!=o.ELEMENT_NODE||b.endContainer[0].nodeType!=o.ELEMENT_NODE)return e;var a=new d(b);a.evaluator=function(b){return w(b)&&s(b)};b=a.next();a.reset();a=
a.previous();return b&&b.equals(a)?b:e},shrink:function(a,e){if(!this.collapsed){var a=a||b.SHRINK_TEXT,c=this.clone(),g=this.startContainer,f=this.endContainer,j=this.startOffset,k=this.endOffset,h=m,i,v,r=m;g&&g[0].nodeType==o.TEXT_NODE&&(j?j>=g[0].nodeValue.length?c.setStartAfter(g):(c.setStartBefore(g),h=p):c.setStartBefore(g));f&&f[0].nodeType==o.TEXT_NODE&&(k?k>=f[0].nodeValue.length?c.setEndAfter(f):(c.setEndAfter(f),r=p):c.setEndBefore(f));if(h||r)v=new d(c),v.evaluator=function(e){return e.nodeType==
(a==b.SHRINK_ELEMENT?o.ELEMENT_NODE:o.TEXT_NODE)},v.guard=function(e,c){if(a==b.SHRINK_ELEMENT&&e.nodeType==o.TEXT_NODE||c&&e==i)return p;!c&&e.nodeType==o.ELEMENT_NODE&&(i=e);return m};h&&(c=v[a==b.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,e?b.POSITION_AFTER_START:b.POSITION_BEFORE_START);r&&(v.reset(),(v=v[a==b.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(v,e?b.POSITION_BEFORE_END:b.POSITION_AFTER_END));return h||r}},createBookmark2:function(b){var a=this.startContainer,
c=this.endContainer,g=this.startOffset,d=this.endOffset,f,j;if(!a||!c)return{start:0,end:0};if(b){if(a[0].nodeType==o.ELEMENT_NODE&&(f=new t(a[0].childNodes[g]))&&f[0]&&f[0].nodeType==o.TEXT_NODE&&0<g&&f[0].previousSibling.nodeType==o.TEXT_NODE)a=f,g=0;for(;a[0].nodeType==o.TEXT_NODE&&(j=a.prev())&&j[0].nodeType==o.TEXT_NODE;)a=j,g+=j[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==o.ELEMENT_NODE&&(f=new t(c[0].childNodes[d]))&&f[0]&&f[0].nodeType==o.TEXT_NODE&&0<d&&f[0].previousSibling.nodeType==
o.TEXT_NODE)c=f,d=0;for(;c[0].nodeType==o.TEXT_NODE&&(j=c.prev())&&j[0].nodeType==o.TEXT_NODE;)c=j,d+=j[0].nodeValue.length}}return{start:a._4e_address(b),end:this.collapsed?e:c._4e_address(b),startOffset:g,endOffset:d,normalized:b,is2:m}},createBookmark:function(a){var c,g,d,f,j=this.collapsed;c=new t("<span>",e,this.document);c.attr("_ke_bookmark",1);c.css("display","none");c.html("&nbsp;");a&&(d=h.guid("ke_bm_"),c.attr("id",d+"S"));j||(g=c.clone(),g.html("&nbsp;"),a&&g.attr("id",d+"E"),f=this.clone(),
f.collapse(),f.insertNode(g));f=this.clone();f.collapse(m);f.insertNode(c);g?(this.setStartAfter(c),this.setEndBefore(g)):this.moveToPosition(c,b.POSITION_AFTER_END);return{startNode:a?d+"S":c,endNode:a?d+"E":g,serializable:a,collapsed:j}},moveToPosition:function(b,a){this.setStartAt(b,a);this.collapse(m)},trim:function(b,a){var e=this.startContainer,c=this.startOffset,g=this.collapsed;if((!b||g)&&e[0]&&e[0].nodeType==o.TEXT_NODE){if(c)if(c>=e[0].nodeValue.length)c=e._4e_index()+1,e=e.parent();else{var d=
e._4e_splitText(c),c=e._4e_index()+1,e=e.parent();o.equals(this.startContainer,this.endContainer)?this.setEnd(d,this.endOffset-this.startOffset):o.equals(e,this.endContainer)&&(this.endOffset+=1)}else c=e._4e_index(),e=e.parent();this.setStart(e,c);if(g){this.collapse(m);return}}e=this.endContainer;c=this.endOffset;!a&&!g&&e[0]&&e[0].nodeType==o.TEXT_NODE&&(c?(c>=e[0].nodeValue.length||e._4e_splitText(c),c=e._4e_index()+1):c=e._4e_index(),e=e.parent(),this.setEnd(e,c))},insertNode:function(b){this.optimizeBookmark();
this.trim(p,m);var a=this.startContainer;a[0].insertBefore(b[0],a[0].childNodes[this.startOffset]||null);a[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(b)},moveToBookmark:function(b){var a=r(this.document);if(b.is2){var e=a._4e_getByAddress(b.start,b.normalized),c=b.startOffset,a=b.end&&a._4e_getByAddress(b.end,b.normalized),b=b.endOffset;this.setStart(e,c);a?this.setEnd(a,b):this.collapse(m)}else e=(c=b.serializable)?h.one("#"+b.startNode,a):b.startNode,b=c?h.one("#"+b.endNode,
a):b.endNode,this.setStartBefore(e),e._4e_remove(),b&&b[0]?(this.setEndBefore(b),b._4e_remove()):this.collapse(m)},getCommonAncestor:function(b,a){var e=this.startContainer,c=this.endContainer,e=e[0]==c[0]?b&&e[0].nodeType==o.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new t(e[0].childNodes[this.startOffset]):e:e._4e_commonAncestor(c);return a&&e[0].nodeType==o.TEXT_NODE?e.parent():e},enlarge:function(){function a(b,e,c,g){var d=b[e?"startContainer":"endContainer"],f,j=e?0:1,k=0,h=e?"previousSibling":
"nextSibling";f=b[e?"startOffset":"endOffset"];if(d[0].nodeType==o.TEXT_NODE){if(e){if(f)return}else if(f<d[0].nodeValue.length)return;f=d[0][h];d=d[0].parentNode}else f=d[0].childNodes[f+(e?-1:1)]||null,d=d[0];for(;d;){for(;f;)if(y(f)||z(f))f=f[h];else break;if(f){if(!k)b[e?"setStartAfter":"setEndBefore"](r(f));break}d=r(d);if("body"==d.nodeName())break;if(k||d.equals(g))c[j]=d,k=1;else b[e?"setStartBefore":"setEndAfter"](d);f=d[0][h];d=d[0].parentNode}}return function(c){switch(c){case b.ENLARGE_ELEMENT:if(this.collapsed)break;
var c=this.getCommonAncestor(),g=[];a(this,1,g,c);a(this,0,g,c);g[0]&&g[1]&&(c=g[0].contains(g[1])?g[1]:g[0],this.setStartBefore(c),this.setEndAfter(c));break;case b.ENLARGE_BLOCK_CONTENTS:case b.ENLARGE_LIST_ITEM_CONTENTS:var f=new n(this.document),g=new t(this.document.body);f.setStartAt(g,b.POSITION_AFTER_START);f.setEnd(this.startContainer,this.startOffset);var f=new d(f),j,k,h=d.blockBoundary(c==b.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:e),i=function(b){var a=h(b);a||(j=r(b));return a},v=function(b){var a=
i(b);!a&&"br"==o.nodeName(b)&&(k=r(b));return a};f.guard=i;f=f.lastBackward();j=j||g;this.setStartAt(j,"br"!=j.nodeName()&&(!f&&this.checkStartOfBlock()||f&&j.contains(f))?b.POSITION_AFTER_START:b.POSITION_AFTER_END);f=this.clone();f.collapse();f.setEndAt(g,b.POSITION_BEFORE_END);f=new d(f);f.guard=c==b.ENLARGE_LIST_ITEM_CONTENTS?v:i;j=e;f=f.lastForward();j=j||g;this.setEndAt(j,!f&&this.checkEndOfBlock()||f&&j.contains(f)?b.POSITION_BEFORE_END:b.POSITION_BEFORE_START);k&&this.setEndAfter(k)}}}(),
checkStartOfBlock:function(){var e=this.startContainer,c=this.startOffset;if(c&&e[0].nodeType==o.TEXT_NODE&&h.trim(e[0].nodeValue.substring(0,c)).length)return p;this.trim();e=new f(this.startContainer);c=this.clone();c.collapse(m);c.setStartAt(e.block||e.blockLimit,b.POSITION_AFTER_START);e=new d(c);e.evaluator=a(m);return e.checkBackward()},checkEndOfBlock:function(){var e=this.endContainer,c=this.endOffset;if(e[0].nodeType==o.TEXT_NODE&&h.trim(e[0].nodeValue.substring(c)).length)return p;this.trim();
e=new f(this.endContainer);c=this.clone();c.collapse(p);c.setEndAt(e.block||e.blockLimit,b.POSITION_BEFORE_END);e=new d(c);e.evaluator=a(p);return e.checkForward()},checkBoundaryOfElement:function(a,e){var g=this.clone();g[e==b.START?"setStartAt":"setEndAt"](a,e==b.START?b.POSITION_AFTER_START:b.POSITION_BEFORE_END);g=new d(g);g.evaluator=c;return g[e==b.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var b=this.startContainer,a=this.endContainer,e=this.startOffset,c=this.endOffset,
g;if(b[0].nodeType==o.ELEMENT_NODE)if(g=b[0].childNodes.length,g>e)b=r(b[0].childNodes[e]);else if(0==g)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=r(b);b=b._4e_nextSourceNode()||b}if(a[0].nodeType==o.ELEMENT_NODE)if(g=a[0].childNodes.length,g>c)a=r(a[0].childNodes[c])._4e_previousSourceNode(m);else if(0==g)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=r(a)}b._4e_position(a)&q.POSITION_FOLLOWING&&(b=a);return{startNode:b,endNode:a}},fixBlock:function(a,
e){var c=this.createBookmark(),g=r(this.document.createElement(e));this.collapse(a);this.enlarge(b.ENLARGE_BLOCK_CONTENTS);g[0].appendChild(this.extractContents());g._4e_trim();u.ie||g._4e_appendBogus();this.insertNode(g);this.moveToBookmark(c);return g},splitBlock:function(a){var c=new f(this.startContainer),g=new f(this.endContainer),d=c.block,j=g.block,k=e;if(!c.blockLimit.equals(g.blockLimit))return e;"br"!=a&&(d||(d=this.fixBlock(m,a),j=(new f(this.endContainer)).block),j||(j=this.fixBlock(p,
a)));a=d&&this.checkStartOfBlock();c=j&&this.checkEndOfBlock();this.deleteContents();d&&d[0]==j[0]&&(c?(k=new f(this.startContainer),this.moveToPosition(j,b.POSITION_AFTER_END),j=e):a?(k=new f(this.startContainer),this.moveToPosition(d,b.POSITION_BEFORE_START),d=e):(j=this.splitElement(d),!u.ie&&!h.inArray(d.nodeName(),["ul","ol"])&&d._4e_appendBogus()));return{previousBlock:d,nextBlock:j,wasStartOfBlock:a,wasEndOfBlock:c,elementPath:k}},splitElement:function(a){if(!this.collapsed)return e;this.setEndAt(a,
b.POSITION_BEFORE_END);var c=this.extractContents(),g=a.clone(p);g[0].appendChild(c);g.insertAfter(a);this.moveToPosition(a,b.POSITION_AFTER_END);return g},moveToElementEditablePosition:function(a,e){for(var c=0;a;){if(a[0].nodeType==o.TEXT_NODE){this.moveToPosition(a,e?b.POSITION_AFTER_END:b.POSITION_BEFORE_START);c=1;break}a[0].nodeType==o.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,e?b.POSITION_BEFORE_END:b.POSITION_AFTER_START),c=1);var g=a,d=c,f=void 0;g[0].nodeType==o.ELEMENT_NODE&&
g._4e_isEditable()&&(f=g[e?"last":"first"](k));!d&&!f&&(f=g[e?"prev":"next"](k));a=f}return!!c},selectNodeContents:function(b){var a=b[0];this.setStart(b,0);this.setEnd(b,a.nodeType==o.TEXT_NODE?a.nodeValue.length:a.childNodes.length)},insertNodeByDtd:function(b){var a,e,c,g=b.nodeName();a=v.$block[g];this.deleteContents();if(a){for(a=this.getCommonAncestor(p,m);(e=v[a.nodeName()])&&(!e||!e[g]);){var d=a.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(a),this.collapse(m),
a.remove()):c=a;a=d}c&&this.splitElement(c)}this.insertNode(b)}});l.injectDom({_4e_breakParent:function(b,a){var a=r(a),b=r(b),e,c=new i.Range(b[0].ownerDocument);c.setStartAfter(b);c.setEndAfter(a);e=c.extractContents();c.insertNode(b.remove());b.after(e)}});i.Range=n},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(h){function i(b){this.document=b;this._={cache:{}};if(m){var a=this.getNative().createRange();if(!a||a.item&&a.item(0).ownerDocument!=b||a.parentElement&&a.parentElement().ownerDocument!=b)this.isInvalid=f}}function l(b){b=new i(b);return!b||b.isInvalid?c:b}var d=h.Editor;d.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var f=!0,c=null,k=h.UA,a=h.DOM,g=h.Node,j=d.SELECTION,n=d.RANGE,m=k.ie,p=d.Walker,e=d.Range,b={img:1,hr:1,li:1,table:1,
tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};h.augment(i,{getNative:!m?function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=a._4e_getWin(this.document).getSelection())}:function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=this.document.selection)},getType:!m?function(){var e=this._.cache;if(e.type)return e.type;var c=j.SELECTION_TEXT,g=this.getNative();if(g){if(1==g.rangeCount){var g=g.getRangeAt(0),d=g.startContainer;
d==g.endContainer&&d.nodeType==a.ELEMENT_NODE&&1==Number(g.endOffset-g.startOffset)&&b[d.childNodes[g.startOffset].nodeName.toLowerCase()]&&(c=j.SELECTION_ELEMENT)}}else c=j.SELECTION_NONE;return e.type=c}:function(){var b=this._.cache;if(b.type)return b.type;var a=j.SELECTION_NONE;try{var e=this.getNative(),c=e.type;"Text"==c&&(a=j.SELECTION_TEXT);"Control"==c&&(a=j.SELECTION_ELEMENT);e.createRange().parentElement&&(a=j.SELECTION_TEXT)}catch(g){}return b.type=a},getRanges:m?function(){var b=function(b,
e){b=b.duplicate();b.collapse(e);for(var g=b.parentElement(),d=g.childNodes,f,j=0;j<d.length;j++){var k=d[j];if(k.nodeType==a.ELEMENT_NODE){f=b.duplicate();f.moveToElementText(k);var k=f.compareEndPoints("StartToStart",b),h=f.compareEndPoints("EndToStart",b);f.collapse();if(0<k)break;else{if(!k||1==h&&-1==k)return{container:g,offset:j};if(!h)return{container:g,offset:j+1}}f=c}}f||(f=b.duplicate(),f.moveToElementText(g),f.collapse(!1));f.setEndPoint("StartToStart",b);f=(""+f.text).replace(/\r\n|\r/g,
"\n").length;try{for(;0<f;)f-=d[--j].nodeValue.length}catch(i){f=0}return 0===f?{container:g,offset:j}:{container:d[j],offset:-f}};return function(a){var c=this._.cache;if(c.ranges&&!a)return c.ranges;var d=this.getNative(),a=d&&d.createRange(),k=this.getType();if(!d)return[];if(k==j.SELECTION_TEXT)return d=new e(this.document),k=b(a,f),d.setStart(new g(k.container),k.offset),k=b(a),d.setEnd(new g(k.container),k.offset),c.ranges=[d];if(k==j.SELECTION_ELEMENT){c=c.ranges=[];for(k=0;k<a.length;k++){for(var h=
a.item(k),i=h.parentNode,o=0,d=new e(this.document);o<i.childNodes.length&&i.childNodes[o]!=h;o++);d.setStart(new g(i),o);d.setEnd(new g(i),o+1);c.push(d)}return c}return c.ranges=[]}}():function(b){var a=this._.cache;if(a.ranges&&!b)return a.ranges;var b=[],c=this.getNative();if(!c)return[];for(var d=0;d<c.rangeCount;d++){var f=c.getRangeAt(d),j=new e(this.document);j.setStart(new g(f.startContainer),f.startOffset);j.setEnd(new g(f.endContainer),f.endOffset);b.push(j)}return a.ranges=b},getStartElement:function(){var b=
this._.cache;if(void 0!==b.startElement)return b.startElement;var e,c=this.getNative();switch(this.getType()){case j.SELECTION_ELEMENT:return this.getSelectedElement();case j.SELECTION_TEXT:var d=this.getRanges()[0];if(d&&!d.collapsed){for(d.optimize();f;)if(e=d.startContainer,d.startOffset==(e[0].nodeType===a.ELEMENT_NODE?e[0].childNodes.length:e[0].nodeValue.length)&&!e._4e_isBlockBoundary())d.setStartAfter(e);else break;e=d.startContainer;if(e[0].nodeType!=a.ELEMENT_NODE)return e.parent();e=new g(e[0].childNodes[d.startOffset]);
if(!e[0]||e[0].nodeType!=a.ELEMENT_NODE)return d.startContainer;for(d=e[0].firstChild;d&&d.nodeType==a.ELEMENT_NODE;)e=new g(d),d=d.firstChild;return e}if(m)d=c.createRange(),d.collapse(f),e=new g(d.parentElement());else{if((e=c.anchorNode)&&e.nodeType!=a.ELEMENT_NODE)e=e.parentNode;e&&(e=new g(e))}}return b.startElement=e},getSelectedElement:function(){var e,c=this._.cache;if(void 0!==c.selectedElement)return c.selectedElement;m&&(e=this.getNative().createRange(),e=e.item&&e.item(0));var d;if(e)d=
new g(e);else{e=this.getRanges()[0];for(var f,j=2;j&&(!(d=e.getEnclosedNode())||!(d[0].nodeType==a.ELEMENT_NODE&&b[d.nodeName()]&&(f=d)));j--)e.shrink(n.SHRINK_ELEMENT);d=f}return c.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(b){var a,e=this.document;if(m)try{a=e.body.createControlRange(),a.addElement(b[0]),a.select()}catch(c){a=e.body.createTextRange(),a.moveToElementText(b[0]),a.select()}finally{}else a=e.createRange(),a.selectNode(b[0]),b=this.getNative(),b.removeAllRanges(),
b.addRange(a);this.reset()},selectRanges:function(b){if(m){if(1<b.length){var e=b[b.length-1];b[0].setEnd(e.endContainer,e.endOffset);b.length=1}b[0]&&b[0].select()}else{e=this.getNative();if(!e)return;e.removeAllRanges();for(var c=0;c<b.length;c++){var g=b[c],d=this.document.createRange(),f=g.startContainer;if(g.collapsed&&(k.gecko&&1.09>k.gecko||k.opera||k.webkit)&&f[0].nodeType==a.ELEMENT_NODE&&!f[0].childNodes.length)f[0].appendChild(this.document.createTextNode(k.webkit?"\u200b":"")),g.startOffset++,
g.endOffset++;d.setStart(f[0],g.startOffset);d.setEnd(g.endContainer[0],g.endOffset);e.addRange(d)}}this.reset()},createBookmarks2:function(b){for(var a=[],e=this.getRanges(),c=0;c<e.length;c++)a.push(e[c].createBookmark2(b));return a},createBookmarks:function(b,e){for(var c=[],g=this.document,d,e=e||this.getRanges(),j=e.length,k=0;k<j;k++){c.push(d=e[k].createBookmark(b,f));var i=(b=d.serializable)?h.one("#"+d.startNode,g):d.startNode;d=b?h.one("#"+d.endNode,g):d.endNode;for(var o=k+1;o<j;o++){var m=
e[o],n=m.startContainer,l=m.endContainer;a.equals(n,i.parent())&&m.startOffset++;a.equals(n,d.parent())&&m.startOffset++;a.equals(l,i.parent())&&m.endOffset++;a.equals(l,d.parent())&&m.endOffset++}}return c},selectBookmarks:function(b){for(var a=[],c=0;c<b.length;c++){var d=new e(this.document);d.moveToBookmark(b[c]);a.push(d)}this.selectRanges(a);return this},getCommonAncestor:function(){var b=this.getRanges();return b[0].startContainer._4e_commonAncestor(b[b.length-1].endContainer)},scrollIntoView:function(){var b=
this.getStartElement();b&&b.scrollIntoView(void 0,!1)},removeAllRanges:function(){var b=this.getNative();m?b&&b.clear():b&&b.removeAllRanges()}});var q={table:1,tbody:1,tr:1},o=p.whitespaces(f),u=/\ufeff|\u00a0/;e.prototype.select=e.prototype.select=!m?function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==a.ELEMENT_NODE&&!b[0].childNodes.length&&b[0].appendChild(this.document.createTextNode(""));var e=this.document.createRange();e.setStart(b[0],this.startOffset);try{e.setEnd(this.endContainer[0],
this.endOffset)}catch(c){if(0<=c.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(f),e.setEnd(this.endContainer[0],this.endOffset);else throw c;}b=l(this.document).getNative();b.removeAllRanges();b.addRange(e)}:function(b){var e=this.collapsed,c,d;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var j=this.startContainer[0].childNodes[this.startOffset];if(j.nodeType==a.ELEMENT_NODE){(new i(this.document)).selectElement(new g(j));return}}(this.startContainer[0].nodeType==
a.ELEMENT_NODE&&this.startContainer.nodeName()in q||this.endContainer[0].nodeType==a.ELEMENT_NODE&&this.endContainer.nodeName()in q)&&this.shrink(n.SHRINK_ELEMENT,f);var k=this.createBookmark(),j=k.startNode,h;e||(h=k.endNode);k=this.document.body.createTextRange();k.moveToElementText(j[0]);k.moveStart("character",1);if(h)b=this.document.body.createTextRange(),b.moveToElementText(h[0]),k.setEndPoint("EndToEnd",b),k.moveEnd("character",-1);else{for(c=j[0].nextSibling;c&&!o(c);)c=c.nextSibling;c=!(c&&
c.nodeValue&&c.nodeValue.match(u))&&(b||!j[0].previousSibling||j[0].previousSibling&&"br"==a.nodeName(j[0].previousSibling));d=new g(this.document.createElement("span"));d.html("&#65279;");d.insertBefore(j);c&&a.insertBefore(this.document.createTextNode("\ufeff"),j[0]||j)}this.setStartBefore(j);j._4e_remove();if(e){if(c?(k.moveStart("character",-1),k.select(),this.document.selection.clear()):k.select(),d)this.moveToPosition(d,n.POSITION_BEFORE_START),d._4e_remove()}else this.setEndBefore(h),h._4e_remove(),
k.select()};i.getSelection=l;return d.Selection=i},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/plugin/selection/index",function(h,i){function l(b){function a(b,e){var c=j.body.createTextRange();try{c.moveToPoint(b,e)}catch(d){c=g}return c}function e(){var b=j.selection.createRange();k&&!b.item&&0===b.compareEndPoints("StartToEnd",b)&&k.select();n.remove(j,"mouseup",e);n.remove(j,"mousemove",c);k=d=0}function c(b){if(b.button){if(b=a(b.pageX,b.pageY))0<b.compareEndPoints("StartToStart",k)?b.setEndPoint("StartToStart",k):b.setEndPoint("EndToEnd",k),b.select()}else e()}var d,
f=b.get("iframe")[0].contentWindow,j=b.get("document")[0],k;n.on(j,"mousedown contextmenu",function(b){var g=j.documentElement;if(b.target===g&&(d&&e(),!(g.scrollHeight>g.clientHeight)&&(d=1,k=a(b.pageX,b.pageY))))n.on(j,"mouseup",e),n.on(j,"mousemove",c),f.focus(),k.select()})}function d(b){function c(a){if(m){var g=b.getSelection(),f=g&&g.getType(),j=g&&d.selection;if(a&&j&&f==e.SELECTION_NONE&&!d.queryCommandEnabled("InsertImage"))setTimeout(function(){c(k)},50);else{var i;if(!j||!j.type||!("Control"!=
j.type&&(i=j.createRange())&&(i=i.parentElement())&&(i=i.nodeName)&&i.toLowerCase()in{input:1,textarea:1}))h=j&&g.getRanges()[0],b.checkSelectionChange()}}}var d=b.get("document")[0],f=new p(d.body),j=new p(d.documentElement);if(8>i.Utils.ieEngine)j.on("click",function(a){"html"===(new p(a.target)).nodeName()&&b.getSelection().getNative().createRange().select()});var h,m,n=k;j.on("mousedown",function(){n=a});j.on("mouseup",function(){n=k});f.on("focusin",function(b){if("body"==(new p(b.target)).nodeName()&&
h){try{n&&h.select()}catch(a){}h=g}});f.on("focus",function(){m=k;c()});f.on("beforedeactivate",function(b){b.relatedTarget||(m=a,n=k)});f.on("mousedown",function(){m=a});f.on("mouseup",function(){m=k;setTimeout(function(){c(k)},0)});f.on("keydown",function(){m=a});f.on("keyup",function(){m=k;setTimeout(function(){c()},0)})}function f(b){var a=b.get("document")[0];n.on(a,"mouseup keyup",function(){b.checkSelectionChange()})}function c(b){function e(b){var a=i.XHTML_DTD;return b._4e_isBlockBoundary()&&
a.$empty[b.nodeName()]}function c(b){return f(b)&&h(b)}var d=b.get("document")[0],g=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,f=i.Walker.whitespaces(k),h=i.Walker.bookmark(a,k),n=function(b){return f(b)&&8!=b.nodeType};b.on("selectionChange",function(f){var h=f.path,l=new p(b.get("document")[0].body),f=(f=f.selection)&&f.getRanges()[0],s=h.blockLimit;if(j.gecko){var r=h.block||h.blockLimit,t=r&&r.last(c);r&&r._4e_isBlockBoundary()&&
(!t||!(1==t[0].nodeType&&t._4e_isBlockBoundary()))&&"pre"!=r.nodeName()&&!r._4e_getBogus()&&r._4e_appendBogus()}if(f&&f.collapsed&&!h.block){if("body"==s.nodeName()){if((h=f.fixBlock(k,"p"))&&h[0]!=l[0].lastChild&&h._4e_outerHtml().match(g))if((s=h.next(n))&&s[0].nodeType==m.ELEMENT_NODE&&!e[s])f.moveToElementEditablePosition(s),h._4e_remove();else if((s=h.prev(n))&&s[0].nodeType==m.ELEMENT_NODE&&!e[s])f.moveToElementEditablePosition(s,s._4e_outerHtml().match(g)?a:k),h._4e_remove();f.select();b.notifySelectionChange()}h=
new i.Range(d);h.moveToElementEditablePosition(l,k);"body"!==(new i.ElementPath(h.startContainer)).blockLimit.nodeName()&&(l=(new p(d.createElement("p"))).appendTo(l),j.ie||l._4e_appendBogus())}})}var k=!0,a=!1,g=null,j=h.UA,n=h.Event,m=h.DOM,p=h.Node,e=i.SELECTION;return{init:function(b){b.docReady(function(){j.ie?(l(b),d(b)):f(b)});c(b)}}},{requires:["editor"]});
KISSY.add("editor/core/styles",function(h){function i(b){return!w.attr(b,"_ke_bookmark")}function l(b,a){for(var e in b)b.hasOwnProperty(e)&&(h.isString(b[e])?b[e]=b[e].replace(L,function(b,e){return a[e]}):l(b[e],a))}function d(b,a){a&&(b=h.clone(b),l(b,a));var e=this.element=this.element=(b.element||"*").toLowerCase();this.type=this.type="#"==e||K[e]?s.STYLE_BLOCK:I[e]?s.STYLE_OBJECT:s.STYLE_INLINE;this._={definition:b}}function f(b,a){var e=a?this.removeFromRange:this.applyToRange;b.body.focus();
for(var c=new C(b),d=c.getRanges(),g=0;g<d.length;g++)e.call(this,d[g]);c.selectRanges(d)}function c(b,a,e){var c=b.element;"*"==c&&(c="span");a=new D(a.createElement(c));e&&e._4e_copyAttributes(a);e=b._.definition;b=e.attributes;e=d.getStyleText(e);if(b)for(var g in b)b.hasOwnProperty(g)&&a.attr(g,b[g]);e&&(a[0].style.cssText=e);return a}function k(b){var e=b.createBookmark(x),d=b.createIterator();d.enforceRealBlocks=x;d.enlargeBr=x;for(var f,k=b.document;f=d.getNextParagraph();){var h=c(this,k,
f),i=h,h="pre"==i.nodeName,m="pre"==f.nodeName,n=!h&&m;h&&!m?(m=f,n=m.html(),n=a(n,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),n=n.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),n=n.replace(/([ \t\n\r]+|&nbsp;)/g," "),n=n.replace(/<br\b[^>]*>/gi,"\n"),G.ie?(m=m[0].ownerDocument.createElement("div"),m.appendChild(i[0]),i[0].outerHTML="<pre>"+n+"</pre>",i=new D(m.firstChild),i._4e_remove()):i.html(n)):n?i=j(g(f),i):f._4e_moveChildren(i);f[0].parentNode.replaceChild(i[0],f[0]);if(h&&(f=i,h=void 0,(h=f._4e_previousSourceNode(x,
w.ELEMENT_NODE))&&"pre"==h.nodeName()))i=a(h.html(),/\n$/,"")+"\n\n"+a(f.html(),/^\n/,""),G.ie?f[0].outerHTML="<pre>"+i+"</pre>":f.html(i),h._4e_remove()}b.moveToBookmark(e)}function a(b,a,e){var c="",d="",b=b.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(b,a,e){a&&(c=a);e&&(d=e);return""});return c+b.replace(a,e)+d}function g(b){var e=[];a(b._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(b,a,e){return a+"</pre>"+
e+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(b,a){e.push(a)});return e}function j(b,e){for(var c=e[0].ownerDocument.createDocumentFragment(),d=0;d<b.length;d++){var g=b[d],g=g.replace(/(\r\n|\r)/g,"\n"),g=a(g,/^[ \t]*\n/,""),g=a(g,/\n$/,""),g=a(g,/^[ \t]+|[ \t]+$/g,function(b,a){return 1==b.length?"&nbsp;":a?" "+Array(b.length).join("&nbsp;"):Array(b.length).join("&nbsp;")+" "}),g=g.replace(/\n/g,"<br>"),g=g.replace(/[ \t]{2,}/g,function(b){return Array(b.length).join("&nbsp;")+" "}),
f=e.clone();f.html(g);c.appendChild(f[0])}return c}function n(b){var a=b.document;if(b.collapsed)a=c(this,a,void 0),b.insertNode(a),b.moveToPosition(a,B.POSITION_BEFORE_END);else{var e=this.element,d=this._.definition,g,f=E[e];f||(g=x,f=E.span);var j=b.createBookmark();b.enlarge(B.ENLARGE_ELEMENT);b.trim();for(var k=b.createBookmark(),h=k.startNode,k=k.endNode,m=h,n;m&&m[0];){var o=y;if(w.equals(m,k))m=z,o=x;else{var l=m[0].nodeType,p=l==w.ELEMENT_NODE?m.nodeName():z;if(p&&m.attr("_ke_bookmark")){m=
m._4e_nextSourceNode(x);continue}if(!p||f[p]&&(m._4e_position(k)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(m))){var s=m.parent();if(s&&"a"==e&&s.nodeName()==e)l=c(this,a,void 0),s._4e_moveChildren(l),s[0].parentNode.replaceChild(l[0],s[0]),l._4e_mergeSiblings();else if(s&&s[0]&&((E[s.nodeName()]||E.span)[e]||g)&&(!d.parentRule||d.parentRule(s))){if(!n&&(!p||!E.$removeEmpty[p]||(m._4e_position(k)|
A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))n=new F(a),n.setStartBefore(m);if(l==w.TEXT_NODE||l==w.ELEMENT_NODE&&!m[0].childNodes.length){s=m;for(l=null;(o=!s.next(i))&&(l=s.parent())&&f[l.nodeName()]&&(l._4e_position(h)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(l));)s=l;n.setEndAfter(s)}}else o=
x}else o=x;m=m._4e_nextSourceNode()}if(o&&n&&!n.collapsed){for(var o=c(this,a,void 0),s=n.getCommonAncestor(),l={},p={},q,r=null,v;o&&s&&o[0]&&s[0];){if(s.nodeName()==e){for(q in d.attributes)if(d.attributes.hasOwnProperty(q)&&!p[q]&&(v=s.attr(r)))o.attr(q)==v?o.removeAttr(q):p[q]=1;for(r in d.styles)if(d.styles.hasOwnProperty(r)&&!l[r]&&(v=s.style(r)))o.style(r)==v?o.style(r,""):l[r]=1;if(!o._4e_hasAttributes()){o=z;break}}s=s.parent()}o?(o[0].appendChild(n.extractContents()),u(this,o),n.insertNode(o),
o._4e_mergeSiblings(),G.ie||o[0].normalize()):(o=new D(a.createElement("span")),o[0].appendChild(n.extractContents()),n.insertNode(o),u(this,o),o._4e_remove(!0));n=z}}h._4e_remove();k._4e_remove();b.moveToBookmark(j);b.shrink(B.SHRINK_TEXT)}}function m(a){a.enlarge(B.ENLARGE_ELEMENT);var e=a.createBookmark(),c=e.startNode;if(a.collapsed){for(var d=new H(c.parent()),g,f=0,j;f<d.elements.length&&(j=d.elements[f])&&!(j==d.block||j==d.blockLimit);f++)if(this.checkElementRemovable(j)){var k=a.checkBoundaryOfElement(j,
B.END),h=!k&&a.checkBoundaryOfElement(j,B.START);h||k?(g=j,g.match=h?"start":"end"):(j._4e_mergeSiblings(),j.nodeName()!=this.element?(k=b(this),v(j,k[j.nodeName()]||k["*"])):q(this,j))}if(g){j=c;for(f=0;;f++){k=d.elements[f];if(w.equals(k,g))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(j[0]);j=k}j["start"==g.match?"insertBefore":"insertAfter"](g)}}else{var i=e.endNode,m=this,d=function(){for(var b=new H(c.parent()),a=new H(i.parent()),e=z,d=z,g=0;g<b.elements.length;g++){var f=
b.elements[g];if(f==b.block||f==b.blockLimit)break;m.checkElementRemovable(f)&&(e=f)}for(g=0;g<a.elements.length;g++){f=a.elements[g];if(f==a.block||f==a.blockLimit)break;m.checkElementRemovable(f)&&(d=f)}d&&i._4e_breakParent(d);e&&c._4e_breakParent(e)};d();for(g=new D(c[0].nextSibling);g[0]!==i[0];){f=g._4e_nextSourceNode();if(g[0]&&g[0].nodeType==w.ELEMENT_NODE&&this.checkElementRemovable(g)&&(g.nodeName()==this.element?q(this,g):(j=b(this),v(g,j[g.nodeName()]||j["*"])),f[0].nodeType==w.ELEMENT_NODE&&
f.contains(c)))d(),f=new D(c[0].nextSibling);g=f}}a.moveToBookmark(e)}function p(b){var a={};(""+b).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(b,e,c){a[e]=c});return a}function e(b,a){var e="";a!==y?(e=document.createElement("span"),e.style.cssText=b,e=e.style.cssText||""):e=b;return e.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function b(b){if(b._.overrides)return b._.overrides;var a=b._.overrides={},e=b._.definition.overrides;
if(e){h.isArray(e)||(e=[e]);for(var c=0;c<e.length;c++){var d=e[c],g,f,j;"string"==typeof d?g=d.toLowerCase():(g=d.element?d.element.toLowerCase():b.element,f=d.attributes,j=d.styles);d=a[g]||(a[g]={});if(f){g=d.attributes=d.attributes||[];for(var k in f)f.hasOwnProperty(k)&&g.push([k.toLowerCase(),f[k]])}if(j){var d=d.styles=d.styles||[],i;for(i in j)j.hasOwnProperty(i)&&d.push([i.toLowerCase(),j[i]])}}}return a}function q(a,e){var c=a._.definition,d=b(a),g=h.merge(c.attributes,(d[e.nodeName()]||
d["*"]||{}).attributes),c=h.merge(c.styles,(d[e.nodeName()]||d["*"]||{}).styles),d=h.isEmptyObject(g)&&h.isEmptyObject(c),f;for(f in g)if(g.hasOwnProperty(f)&&!(("class"==f||a._.definition.fullMatch)&&e.attr(f)!=o(f,g[f])))d=d||!!e.hasAttr(f),e.removeAttr(f);for(var j in c)c.hasOwnProperty(j)&&!(a._.definition.fullMatch&&e.style(j)!=o(j,c[j],x))&&(d=d||!!e.style(j),e.style(j,""));t(e)}function o(b,a,e){var c=new D("<span>");c[e?"style":"attr"](b,a);return c[e?"style":"attr"](b)}function u(a,e){for(var c=
b(a),d=e.all(a.element),g=d.length;0<=--g;)q(a,new D(d[g]));for(var f in c)if(c.hasOwnProperty(f)&&f!=a.element){d=e.all(f);for(g=d.length-1;0<=g;g--){var j=new D(d[g]);v(j,c[f])}}}function v(b,a){var e,c=a&&a.attributes;if(c)for(e=0;e<c.length;e++){var d=c[e][0],g;if(g=b.attr(d)){var f=c[e][1];(f===z||f.test&&f.test(g)||"string"==typeof f&&g==f)&&b[0].removeAttribute(d)}}if(c=a&&a.styles)for(e=0;e<c.length;e++)if(d=c[e][0],f=b.css(d)){var j=c[e][1];(j===z||j.test&&j.test(g)||"string"==typeof j&&
f==j)&&b.css(d,"")}t(b)}function t(b){if(!b._4e_hasAttributes()){var a=b[0].firstChild,e=b[0].lastChild;b._4e_remove(x);a&&(a.nodeType==w.ELEMENT_NODE&&w._4e_mergeSiblings(a),e&&a!=e&&e.nodeType==w.ELEMENT_NODE&&w._4e_mergeSiblings(e))}}var r=h.Editor,x=!0,y=!1,z=null,w=h.DOM,s={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},B=r.RANGE,C=r.Selection,A=r.POSITION,F=r.Range,D=h.Node,G=h.UA,H=r.ElementPath,K={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},E=r.XHTML_DTD,I={embed:1,hr:1,img:1,li:1,
object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,L=/#\((.+?)\)/g;r.STYLE=s;d.prototype={apply:function(b){f.call(this,b,y)},remove:function(b){f.call(this,b,x)},applyToRange:function(b){return(this.applyToRange=this.type==s.STYLE_INLINE?n:this.type==s.STYLE_BLOCK?k:z).call(this,b)},removeFromRange:function(b){return(this.removeFromRange=this.type==s.STYLE_INLINE?m:z).call(this,b)},checkElementRemovable:function(a,c){if(!a)return y;var g=this._.definition,f;if(a.nodeName()==
this.element){if(!c&&!a._4e_hasAttributes())return x;var j=g._AC;if(j)g=j;else{var j={},k=0,h=g.attributes;if(h)for(var i in h)h.hasOwnProperty(i)&&(k++,j[i]=h[i]);if(h=d.getStyleText(g))j.style||k++,j.style=h;j._length=k;g=g._AC=j}if(g._length){for(var m in g)if("_length"!=m&&g.hasOwnProperty(m)){k=a.attr(m)||"";if("style"==m)a:{j=g[m];k=e(k,y);"string"==typeof j&&(j=p(j));"string"==typeof k&&(k=p(k));h=void 0;for(h in j)if(j.hasOwnProperty(h)&&!(h in k&&(k[h]==j[h]||"inherit"==j[h]||"inherit"==
k[h]))){j=y;break a}j=x}else j=g[m]==k;if(j){if(!c)return x}else if(c)return y}if(c)return x}else return x}m=b(this);if(m=m[a.nodeName()]||m["*"]){if(!(g=m.attributes)&&!(f=m.styles))return x;if(g)for(j=0;j<g.length;j++)if(m=g[j][0],m=a.attr(m))if(k=g[j][1],k===z||"string"==typeof k&&m==k||k.test&&k.test(m))return x;if(f)for(j=0;j<f.length;j++)if(m=a.css(f[j][0]))if(g=f[j][1],g===z||"string"==typeof g&&m==g||g.test&&g.test(m))return x}return y},checkActive:function(b){switch(this.type){case s.STYLE_BLOCK:return this.checkElementRemovable(b.block||
b.blockLimit,x);case s.STYLE_OBJECT:case s.STYLE_INLINE:for(var a=b.elements,e=0,c;e<a.length;e++)if(c=a[e],!(this.type==s.STYLE_INLINE&&(w.equals(c,b.block)||w.equals(c,b.blockLimit))))if((this.type!=s.STYLE_OBJECT||c.nodeName()in I)&&this.checkElementRemovable(c,x))return x}return y}};d.getStyleText=function(b){var a=b._ST;if(a)return a;var a=b.styles,c=b.attributes&&b.attributes.style||"",g="";c.length&&(c=c.replace(J,";"));for(var d in a)if(a.hasOwnProperty(d)){var f=a[d],j=(d+":"+f).replace(J,
";");"inherit"==f?g+=j:c+=j}c.length&&(c=e(c));return b._ST=c+g};r.Style=d},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(h){var i=h.Node,l=h.DOM,d=h.UA,f={debugUrl:function(c){var d=h.Config;d.debug||(c=c.replace(/\.(js|css)/i,"-min.$1"));-1==c.indexOf("?t")&&(c=-1!=c.indexOf("?")?c+"&":c+"?",c+="t="+encodeURIComponent(d.tag));return d.base+"editor/"+c},lazyRun:function(c,d,a){var g=c[d],f=c[a];c[d]=function(){g.apply(this,arguments);c[d]=c[a];return f.apply(this,arguments)}},getXY:function(c,d,a,g){a=a.defaultView||a.parentWindow;c-=l.scrollLeft(a);d-=l.scrollTop(a);g&&(g=g.defaultView||
g.parentWindow,a!=g&&a.frameElement&&(g=l.offset(a.frameElement,void 0,g),c+=g.left,d+=g.top));return{left:c,top:d}},tryThese:function(c){for(var d,a=0,g=arguments.length;a<g;a++){var f=arguments[a];try{d=f();break}catch(h){}}return d},arrayCompare:function(c,d){if(!c&&!d)return!0;if(!c||!d||c.length!=d.length)return!1;for(var a=0;a<c.length;a++)if(c[a]!==d[a])return!1;return!0},clearAllMarkers:function(c){for(var d in c)c.hasOwnProperty(d)&&c[d]._4e_clearMarkers(c,!0,void 0)},ltrim:function(c){return c.replace(/^\s+/,
"")},rtrim:function(c){return c.replace(/\s+$/,"")},isNumber:function(c){return/^\d+(.\d+)?$/.test(h.trim(c))},verifyInputs:function(c){for(var d=0;d<c.length;d++){var a=new i(c[d]),g=h.trim(f.valInput(a)),j=a.attr("data-verify"),a=a.attr("data-warning");if(j&&!RegExp(j).test(g))return alert(a),!1}return!0},sourceDisable:function(c,d){c.on("sourceMode",d.disable,d);c.on("wysiwygMode",d.enable,d)},resetInput:function(c){var f=c.attr("placeholder");f&&d.ie?(c.addClass("ke-input-tip"),c.val(f)):d.ie||
c.val("")},valInput:function(c,d){if(void 0===d)return c.hasClass("ke-input-tip")?"":c.val();c.removeClass("ke-input-tip");c.val(d)},placeholder:function(c,f){c.attr("placeholder",f);d.ie&&(c.on("blur",function(){h.trim(c.val())||(c.addClass("ke-input-tip"),c.val(f))}),c.on("focus",function(){c.removeClass("ke-input-tip");h.trim(c.val())==f&&c.val("")}))},htmlEncode:function(c){return!c?c:(""+c).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(c){var c=
h.clone(c),d;for(d in c)if(c.hasOwnProperty(d)){var a=c[d];h.isFunction(a)&&(c[d]=a())}return c},map:function(c,d){for(var a=0;a<c.length;a++)c[a]=d(c[a]);return c},ieEngine:document.documentMode||d.ie,preventFocus:function(c){d.ie?c.unselectable(void 0):c.attr("onmousedown","return false;")},injectDom:function(c){h.mix(l,c);for(var d in c)c.hasOwnProperty(d)&&function(a){i.prototype[a]=function(){var d=[].slice.call(arguments,0);d.unshift(this[0]);return(d=c[a].apply(null,d))&&(d.nodeType||h.isWindow(d))?
new i(d):h.isArray(d)&&(d.__IS_NODELIST||d[0]&&d[0].nodeType)?new i(d):d}}(d)},addRes:function(){var c=this.__res=this.__res||[];c.push.apply(c,h.makeArray(arguments))},destroyRes:function(){for(var c=this.__res||[],d=0;d<c.length;d++){var a=c[d];h.isFunction(a)?a():(a.destroy&&a.destroy(),a.remove&&a.remove())}this.__res=[]},getQueryCmd:function(c){return"query"+("-"+c).replace(/-(\w)/g,function(c,a){return a.toUpperCase()})+"Active"}};return h.Editor.Utils=f},{requires:["./base"]});
KISSY.add("editor/core/walker",function(h,i){function l(b,e){if(this._.end)return a;var d,g=this.range,f,h=this.guard,i=this.type,n=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,g.trim(),g.collapsed))return this.end(),a;if(!b&&!this._.guardLTR){var l=g.endContainer[0],s=l.childNodes[g.endOffset];this._.guardLTR=function(b,a){return a&&(l==b||"body"==j.nodeName(b))?!1:b!=s}}if(b&&!this._.guardRTL){var p=g.startContainer[0],q=0<g.startOffset&&p.childNodes[g.startOffset-
1]||null;this._.guardRTL=function(b,a){return a&&(p==b||"body"==j.nodeName(b))?!1:b!=q}}var A=b?this._.guardRTL:this._.guardLTR;f=h?function(b,a){return A(b,a)===k?k:h(b,a)}:A;this.current?d=this.current[n](k,i,f):b?(d=g.endContainer,0<g.endOffset?(d=new m(d[0].childNodes[g.endOffset-1]),f(d[0])===k&&(d=a)):d=f(d,c)===k?a:d._4e_previousSourceNode(c,i,f,void 0)):(d=g.startContainer,d=new m(d[0].childNodes[g.startOffset]),d.length?f(d[0])===k&&(d=a):d=f(g.startContainer,c)===k?a:g.startContainer._4e_nextSourceNode(c,
i,f,void 0));for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d[0])!==k){if(!e)return d}else if(e&&this.evaluator)return k;d=d[n](k,i,f)}this.end();return this.current=a}function d(b){for(var e,c=a;e=l.call(this,b);)c=e;return c}function f(b){this.range=b;this.guard=this.evaluator=a;this._={}}var c=!0,k=!1,a=null,g=h.UA,j=h.DOM,n=i.XHTML_DTD,m=h.Node;h.augment(f,{end:function(){this._.end=1},next:function(){return l.call(this)},previous:function(){return l.call(this,c)},checkForward:function(){return l.call(this,
k,c)!==k},checkBackward:function(){return l.call(this,c,c)!==k},lastForward:function(){return d.call(this)},lastBackward:function(){return d.call(this,c)},reset:function(){delete this.current;this._={}},_iterator:l});h.mix(f,{blockBoundary:function(b){return function(a){return!(a.nodeType==j.ELEMENT_NODE&&j._4e_isBlockBoundary(a,b))}},bookmark:function(b,a){function e(b){return"span"==j.nodeName(b)&&j.attr(b,"_ke_bookmark")}return function(c){var d,g;d=c.nodeType==j.TEXT_NODE&&(g=c.parentNode)&&e(g);
d=b?d:d||e(c);return!!(a^d)}},whitespaces:function(b){return function(a){a=a.nodeType==j.TEXT_NODE&&!h.trim(a.nodeValue);return!!(b^a)}},invisible:function(b){var a=f.whitespaces();return function(e){e=a(e)||e.nodeType==j.ELEMENT_NODE&&!e.offsetHeight;return!!(b^e)}}});var p=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,e=f.whitespaces(),b=f.bookmark(),q=function(a){var c=j.nodeName(a);return b(a)||e(a)||1==a.nodeType&&c in n.$inline&&!(c in n.$empty)};i.Utils.injectDom({_4e_getBogus:function(b){b=new m(b);do b=
b._4e_previousSourceNode();while(b&&q(b[0]));return b&&(!g.ie?"br"==b.nodeName():3==b[0].nodeType&&p.test(b.text()))?b[0]:!1}});return i.Walker=f},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(h){var i=h.Editor;i.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};i.baseZIndex=function(h){return(i.Config.baseZIndex||1E4)+h}},{requires:["./base"]});
KISSY.add("editor",function(h,i,l,d){function f(b,a){var c=b.body;r(function(){b.designMode="on";setTimeout(function(){b.designMode="off";c.focus();arguments.callee.retry||(arguments.callee.retry=n)},50)},function(){b.designMode="off";u.attr(c,"contentEditable",e);u.attr(c,"contentEditable",n);!a&&f(b,1)})}function c(b){var a=b.get("iframe"),c=b.get("textarea")[0],a=a[0].contentWindow,g=b.get("document")[0];q.webkit&&(t.on(g,"click",function(b){var a=new v(b.target);h.inArray(a.nodeName(),["input",
"select"])&&b.preventDefault()}),t.on(g,"mouseup",function(b){var a=new v(b.target);h.inArray(a.nodeName(),["input","textarea"])&&b.preventDefault()}));if(q.gecko||o||q.opera){var j;j=(new v('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(c);j.on("focus",function(){b.focus()});b.activateGecko=function(){q.gecko&&b.__iframeFocus&&j[0].focus()};b.on("destroy",function(){j.detach();j.remove()})}t.on(a,"focus",function(){q.gecko?f(g,e):q.opera&&g.body.focus();
b.notifySelectionChange()});if(q.gecko)t.on(g,"mousedown",function(){b.__iframeFocus||f(g,e)});if(o&&(t.on(g,"keydown",function(a){if(a.keyCode in{8:1,46:1}){var e=b.getSelection(),c=e.getSelectedElement();if(c){b.fire("save");var d=e.getRanges()[0].createBookmark();c.remove();e.selectBookmarks([d]);b.fire("save");a.preventDefault()}}}),"CSS1Compat"==g.compatMode)){var k={33:1,34:1};t.on(g,"keydown",function(a){a.keyCode in k&&setTimeout(function(){b.getSelection().scrollIntoView()},0)})}if(q.webkit)t.on(g,
"mousedown",function(a){a=new v(a.target);h.inArray(a.nodeName(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(a)});if(q.gecko)t.on(g,"dragstart",function(b){var a=new v(b.target);a.nodeName()==="img"&&/ke_/.test(a[0].className)&&b.preventDefault()});d.add(b)}function k(a,e,c,d){var g="",f,j=l.debugUrl("theme/editor-iframe.css");if(c)for(f=0;f<c.length;f++)g+=h.substitute('<link href="{href}" rel="stylesheet" />',{href:c[f]});return h.substitute(x,{doctype:8===b.documentMode?
'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:j,style:e||"",data:d||"&nbsp;",script:a?'<script id="ke_active_script">'+(u.isCustomDomain()?'document.domain="'+b.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function a(b,a){b.__saveTimer&&(clearTimeout(b.__saveTimer),b.__saveTimer=null);b.__saveTimer=setTimeout(function(){b.execCommand("save")},a||0)}function g(b,a){function e(){j=f.document;b.__set("document",new v(j));b.__set("window",
new v(f));c.detach();j.open("text/html","replace");j.write(d);j.close()}var c=b.get("iframe"),d=k(b._UUID,b.get("customStyle"),b.get("customLink"),a),g=c[0],f=g.contentWindow,j;c.__loaded=1;try{j=f.document}catch(h){if(g.src=g.src,7>o){setTimeout(e,10);return}}e()}function j(b,a){var e=new v(z),c=b.get("textarea");c.hasAttr("tabindex")&&e.attr("tabIndex",q.webkit?-1:c.attr("tabIndex"));b.get("iframeWrapEl").prepend(e);b.set("iframe",e);b.__docReady=0;if(q.gecko&&!e.__loaded)e.on("load",function(){g(b,
a)},b);else g(b,a)}var n=!0,m=m,p=h.all,e=!1,b=document,q=h.UA,o=q.ie,u=h.DOM,v=h.Node,t=h.Event,r=l.tryThese,x="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ke-editor'>{data}{script}</body></html>",y=u.getEmptyIframeSrc(),z='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true" '+(y?' src="'+y+'"':"")+"</iframe>";h.mix(i,{SOURCE_MODE:0,
WYSIWYG_MODE:1});var w=i.WYSIWYG_MODE;h.augment(i,{createDom:function(){var b,a=this.get("textarea"),e;a||this.set("textarea",a=p("<textarea></textarea>"));e=this.get("el");e.addClass(this.get("prefixCls")+"editor-wrap",m);e.html('<div class="ke-editor-tools"></div><div class="ke-textarea-wrap"></div><div class=\'ke-editor-status\'></div>');this._UUID=h.guid();this.set({iframeWrapEl:b=e.one(".ke-textarea-wrap"),toolBarEl:e.one(".ke-editor-tools"),statusBarEl:e.one(".ke-editor-status")},{silent:1});
a.css("width","100%");a.css("display","none");b.append(a);d.register(this)},_uiSetHeight:function(b){var a=this.get("toolBarEl"),e=this.get("statusBarEl"),b=parseInt(b,10),b=b-((a&&a.outerHeight()||0)+(e&&e.outerHeight()||0));this.get("iframeWrapEl").css("height",b);this.get("textarea").css("height",b)},_uiSetMode:function(b){var a=this,e,c=a.get("iframe"),d=a.get("textarea");b==w?(a.execCommand("save"),a.on("docReady",e=function(){a.execCommand("save");a.detach("docReady",e)}),a._setData(d.val()),
a.fire("wysiwygMode")):(d.val(a._getData(1,w)),d[0].focus(),d.show(),c.hide(),a.fire("sourceMode"))},_uiSetFocused:function(b){b&&this.__docReady&&this.focus()},bindUI:function(){function b(){a.detach("docReady",b);if(a.get("focused"))a.focus();else{var e=a.getSelection();e&&e.removeAllRanges()}}var a=this,e,c=a.get("textarea");if(a.get("attachForm")&&(e=c[0].form))u.on(e,"submit",a.sync,a),a.on("destroy",function(){u.detach(e,"submit",a.sync,a)});a.on("docReady",b)},destructor:function(){var b=this.get("el"),
a=this.get("textarea"),e=this.get("document")[0],c=this.get("iframe")[0].contentWindow;this.sync();d.remove(this);t.remove([e,e.documentElement,e.body,c]);h.each(this.__dialogs,function(b){b.destroy&&b.destroy()});this.__commands=0;this.__editor_created_new||(a.insertBefore(b,m),a.css({width:this.get("width"),height:this.get("height")}),a.show())},addDialog:function(b,a){this.__dialogs[b]=a},showDialog:function(b,a){var e=this.__dialogs[b];e.show(a);this.fire("dialogShow",{dialog:e.dialog,pluginDialog:e,
dialogName:b})},hasDialog:function(b){return!!this.__dialogs[b]},addCommand:function(b,a){this.__commands[b]=a},hasCommand:function(b){return this.__commands[b]},execCommand:function(b){var a=this.__commands[b],e=h.makeArray(arguments);e.shift();e.unshift(this);if(a)return a.exec.apply(a,e)},_getData:function(b,a){var e=this.htmlDataProcessor,c;a==m&&(a=this.get("mode"));c=a==w?this.get("document")[0].body.innerHTML:e.toDataFormat(this.get("textarea").val());c=b?e.toHtml(c):e.toServer(c);c=h.trim(c);
/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(c)&&(c="");return c},_setData:function(b){var a,e=b;if(this.get("mode")!=w)this.get("textarea").val(b);else{if(a=this.htmlDataProcessor)e=a.toDataFormat(b,"p");if(this.get("iframe")){b=this.get("iframe");a=b[0].contentWindow;var c=this.get("document")[0];t.remove([c,c.documentElement,c.body,a]);b.remove()}j(this,e)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return k(0,this.get("customStyle"),this.get("customLink"),
this.get("formatData"))},getSelection:function(){return i.Selection.getSelection(this.get("document")[0])},focus:function(){var b=this.get("document")[0],a=u._4e_getWin(b);q.ie||a&&a.parent&&a.parent.focus();a&&a.focus();b.body.focus();this.notifySelectionChange()},blur:function(){u._4e_getWin(this.get("document")[0]).blur();this.get("document")[0].body.blur()},addCustomStyle:function(b,a){var e=this.get("customStyle")||"",e=e+("\n"+b);this.set("customStyle",e);u.addStyleSheet(this.get("iframe")[0].contentWindow,
e,a)},removeCustomStyle:function(b){u.remove(u.get("#"+b,this.get("iframe")[0].contentWindow))},addCustomLink:function(b){var a=this.get("customLink")||[],e=this.get("document")[0];a.push(b);this.set("customLink",a);a=e.createElement("link");a.rel="stylesheet";e.getElementsByTagName("head")[0].appendChild(a);a.href=b},removeCustomLink:function(b){for(var a=this.get("document")[0],a=u.query("link",a),e=0;e<a.length;e++)u.attr(a[e],"href")==b&&u.remove(a[e]);a=this.get("customLink")||[];b=h.indexOf(b,
a);-1!=b&&a.splice(b,1)},docReady:function(b){this.on("docReady",b);this.__docReady&&b.call(this)},checkSelectionChange:function(){var b=this;b.__checkSelectionChangeId&&clearTimeout(b.__checkSelectionChangeId);b.__checkSelectionChangeId=setTimeout(function(){var a=b.getSelection();if(a&&!a.isInvalid){var e=a.getStartElement(),c=new i.ElementPath(e);if(!b.__previousPath||!b.__previousPath.compare(c))b.__previousPath=c,b.fire("selectionChange",{selection:a,path:c,element:e})}},100)},notifySelectionChange:function(){this.__previousPath=
null;this.checkSelectionChange()},insertElement:function(b,e,c){var d=this;if(d.get("mode")===w){d.focus();var g,f=b.nodeName(),j=i.XHTML_DTD,h=j.$block[f],k=i.RANGE,l=(f=d.getSelection())&&f.getRanges(),o,p,q;if(!l||0==l.length){var r=arguments,y=r.callee;setTimeout(function(){y.apply(d,r)},30)}else{d.execCommand("save");for(p=l.length-1;0<=p;p--)o=l[p],g=!p&&b||b.clone(n),e&&e(g),o.insertNodeByDtd(g),q||(q=g);q&&(o.moveToPosition(q,k.POSITION_AFTER_END),h&&(h=i.Walker.whitespaces(!0),(h=(q=q.next(h))&&
q[0].nodeType==u.ELEMENT_NODE&&q.nodeName())&&j.$block[h]&&j[h]["#"]&&o.moveToElementEditablePosition(q)),f.selectRanges([o]),d.focus(),g&&g.scrollIntoView(m,!1),a(d),c&&c(g))}}},insertHtml:function(b,c){var d=this,g;if(d.get("mode")===w){if(g=d.htmlDataProcessor)b=g.toDataFormat(b,null,c);d.focus();d.execCommand("save");var f=d.get("document")[0];g=0;if(o){var j=f.selection;"Control"==j.type&&j.clear();try{j.createRange().pasteHTML(b)}catch(h){}}else try{f.execCommand("inserthtml",e,b)}catch(k){setTimeout(function(){if(0==
d.getSelection().getRanges().length){var a=new i.Range(f),c=u.first(f.body,function(b){return 1==b.nodeType&&"br"!=u.nodeName(b)});c||(c=new v(f.createElement("p")),c._4e_appendBogus(m),f.body.appendChild(c[0]));a.setStartAt(c,i.RANGE.POSITION_AFTER_START);a.select()}f.execCommand("inserthtml",e,b)},g=100)}setTimeout(function(){d.getSelection().scrollIntoView()},g);a(d,g)}}});i._initIFrame=function(b){var a=d.getInstance(b),g=a.get("document")[0],b=g.getElementById("ke_active_script");u.remove(b);
c(a);var j=g.body;o?(j.hideFocus=n,j.disabled=n,j.contentEditable=n,j.removeAttribute("disabled")):setTimeout(function(){q.gecko||q.opera?j.contentEditable=n:q.webkit?j.parentNode.contentEditable=n:g.designMode="on"},0);if(q.gecko||q.opera){var h=g.documentElement;t.on(h,"mousedown",function(b){if(b.target==h){q.gecko&&f(g,e);a.activateGecko()}})}setTimeout(function(){o&&setTimeout(function(){if(g){j.runtimeStyle.marginBottom="0px";j.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.__docReady=
1;a.fire("docReady");var b=a.get("disableObjectResizing"),c=a.get("disableInlineTableEditing");if(b||c)try{g.execCommand("enableObjectResizing",e,!b);g.execCommand("enableInlineTableEditing",e,!c)}catch(d){t.on(j,o?"resizestart":"resize",function(a){var e=new v(a.target);(b||e.nodeName()==="table"&&c)&&a.preventDefault()})}},10)};return i},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/focusManager,editor/core/meta".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(h,i){var l={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(d){d.hasCommand("backColor")||d.addCommand("backColor",{exec:function(d,c){d.execCommand("save");i.applyColor(d,c,l);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"backColor",title:"\u80cc\u666f\u989c\u8272",contentCls:"ke-toolbar-back-color"},void 0,l)}}},{requires:["editor","../color/btn","./cmd"]});KISSY.add("editor/plugin/bold/cmd",function(h,i,l){var d=new i.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(f){l.addButtonCmd(f,"bold",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"bold",contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubbleview/index",function(h,i,l,d){function f(a){var c=null,d=j[h.stamp(a.editor)];h.each(d,function(e){var b;if(b=e!==a)if(b=e.get("visible")){b=a.get("y");var d=b+a.get("el").outerHeight(),g=e.get("y"),f=g+e.get("el").outerHeight();b=b<=f&&d>=f||b<=g&&d>=g}b&&(c?c.get("y")<e.get("y")&&(c=e):c=e);return c})}var c=h.Event,k={}.a,a=h.DOM,g=i.define(l,[],{},{ATTRS:{zIndex:{value:d.baseZIndex(d.zIndexManager.BUBBLE_VIEW)},elCls:{value:"ke-bubbleview-bubble"},prefixCls:{value:"ke-"},
effect:{value:{effect:"fade",duration:0.3}}}}),j={};g.register=function(d){function i(){u&&(u.hide(),c.remove(r,"scroll",e))}function l(){var b;var e=u.selectedEl,c=u.editor;if(e){var d=c.get("iframe")[0].contentWindow,g=c.get("iframe").offset(),c=g.top,g=g.left,j=g+a.width(d),d=c+a.height(d),h=e.offset(k,window),i=h.top,h=h.left,m=h+e.width(),e=i+e.height(),n;e>d&&i<d?n=d-30:e>c&&e<d&&(n=e);m>g&&h<g?b=g:h>g&&h<j&&(b=h);b=b!==k&&n!==k?[b,n]:k}else b=k;if(b){u.set("xy",b);if(n=f(u))b[1]=n.get("y")+
n.get("el").outerHeight(),u.set("xy",b);u.get("visible")||u.show()}}function e(){u.selectedEl&&(u&&(u.get("el"),u.hide()),x())}function b(){c.on(r,"scroll",e);l()}var q=d.filter,o=d.editor,u=new g({editor:o}),v=h.stamp(o),t=j[v]=j[v]||[];u.init=d.init;if(u.init)u.on("afterRenderUI",function(){u.init()});t.push(u);u.editor=o;o.on("destroy",function(){delete j[v];u.destroy()});o.on("selectionChange",function(a){var a=a.path,e=a.elements;if(a&&e&&(a=a.lastElement))(a=q(a))?(u.selectedEl=a,u.hide(),h.later(b,
10)):u&&i()});o.on("sourceMode",i);var r=o.get("iframe")[0].contentWindow,x=h.buffer(l,350)};return g},{requires:["component","overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(h,i,l){function d(c){return c&&-1==c.indexOf("<")?c:0}var f=l.define([l.UIBase.Box.Render],{_updateHref:function(){this.get("el").attr("href","javascript:void('"+(d(this.get("text"))||d(this.get("title")))+"')")},bindUI:function(){var c=this,d=c.get("keepFocus"),a=c.get("el");a.on("click",c._action,c);d&&a.unselectable();a.on("mousedown",function(g){"off"==c.get("state")&&a.addClass("ke-triplebutton-active");d&&g.halt()});a.on("mouseup mouseleave",function(){"off"==
c.get("state")&&a.hasClass("ke-triplebutton-active")&&setTimeout(function(){a.removeClass("ke-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"));this._updateHref()},_uiSetContentCls:function(c){var d=this.get("el");void 0!==c&&(d.html("<span class='ke-toolbar-item "+c+"' />"),this.get("keepFocus")&&d.unselectable(void 0))},_uiSetText:function(c){this.get("el").html(c);this._updateHref()},_uiSetState:function(c,d){this["_"+c](d)},disable:function(){this.set("state",
"disabled")},enable:function(){"disabled"==this.get("state")&&this.set("state",this._savedState)},_action:function(c){this.fire(this.get("state")+"Click",{TripleEvent:c});this.fire("click",{TripleClickType:this.get("state")+"Click"});this.get("keepFocus")||this.get("el")[0].focus()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.get("el").removeClass("ke-triplebutton-off ke-triplebutton-disabled").addClass("ke-triplebutton-on")},_off:function(){this.get("el").removeClass("ke-triplebutton-on ke-triplebutton-disabled").addClass("ke-triplebutton-off")},
_disabled:function(c){var d=this.get("el");this._savedState=c.prevVal;d.removeClass("ke-triplebutton-off ke-triplebutton-on").addClass("ke-triplebutton-disabled")}},{name:"editor/plugin/button",ATTRS:{state:{value:"off"},elCls:{value:"ke-triplebutton ke-triplebutton-off"},elTagName:{value:"a"},title:{},contentCls:{},text:{},keepFocus:{value:!0}}});f.ON="on";f.OFF="off";f.DISABLED="disabled";f.ON_CLASS="ke-triplebutton-on";f.OFF_CLASS="ke-triplebutton-off";f.DISABLED_CLASS="ke-triplebutton-disabled";
i.TripleButton=f;i.prototype.addButton=function(c,d,a){var a=a||f,g=this,j=new a(h.mix({render:g.get("toolBarEl"),autoRender:!0,editor:g},c));h.mix(j,d);j.init&&j.init();g.on("selectionChange",function(){g.get("mode")!=i.SOURCE_MODE&&j.selectionChange&&j.selectionChange.apply(j,arguments)});j.on("click",function(a){var c=a.TripleClickType;j[c]&&j[c].apply(j,arguments)});j.get("mode")==i.WYSIWYG_MODE&&(g.on("wysiwygMode",j.enable,j),g.on("sourceMode",j.disable,j));g.on("destroy",function(){j.destroy()});
return j};return f},{requires:["editor","component"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(h,i){function l(c){this.editor=c;this._init()}var d=h.Node,f=i.SOURCE_MODE,c=i.WYSIWYG_MODE;h.augment(l,{_init:function(){var c=this.editor,a=c.get("statusBarEl");this.holder=(new d("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(a);(this.el=this.holder.one("input")).on("click",
this._check,this);c.on("wysiwygMode",this._wysiwygmode,this);c.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var d=this.editor;this.el.attr("checked")?d.set("mode",f):d.set("mode",c)},destroy:function(){this.holder.remove()}});return{init:function(c){var a=new l(c);c.on("destroy",function(){a.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(h,i,l,d,f){function c(){c.superclass.constructor.apply(this,arguments)}var k=h.Node;h.DOM.addStyleSheet(".ke-color-panel a {display: block;color:black;text-decoration: none;}.ke-color-panel a:hover {color:black;text-decoration: none;}.ke-color-panel a:active {color:black;}.ke-color-palette {    margin: 5px 8px 8px;}.ke-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ke-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ke-color-a {    height: 18px;    width: 18px;}a.ke-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ke-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ke-color-remove:hover {    background-color: #D6E9F8;}",
"ke-color-plugin");var a=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],g;(function(){g="<div class='ke-color-panel'><a class='ke-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var c=0;3>c;c++){g+="<div class='ke-color-palette'><table>";for(var d=a[c],f=d.length/8,h=0;h<f;h++){g+="<tr>";for(var e=0;8>e;e++){var b="#"+d[8*h+e];g+="<td>";g+="<a href='javascript:void(0);' class='ke-color-a' style='background-color:"+b+"'></a>";g+="</td>"}g+="</tr>"}g+="</table></div>"}g+="<div><a class='ke-button ke-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();h.extend(c,l,{offClick:function(){this._prepare()},onClick:function(){this.colorWin&&this.colorWin.hide()},_prepare:function(){var a=
this,c=a.get("editor"),h;a.colorWin=new d({elAttrs:{tabindex:0},elCls:"ke-popup",content:g,autoRender:!0,width:170,zIndex:i.baseZIndex(i.zIndexManager.POPUP_MENU)});var k=a.colorWin;h=k.get("contentEl");h.on("click",a._selectColor,a);k.get("el").on("blur",function(){k.hide()});k.on("show",a.bon,a);k.on("hide",a.boff,a);h.one(".ke-color-others").on("click",function(e){e.halt();k.hide();f.useDialog(c,"color/colorPicker/dialog",a.get("cmdType"))});a._prepare=a._show;a._show()},_show:function(){var a=
this.get("el"),c=this.colorWin;c.align(a,["bl","tl"],[0,2]);c.show();c.get("el")[0].focus()},_selectColor:function(a){a.halt();a=new k(a.target);a.hasClass("ke-color-a")&&this.get("editor").execCommand(this.get("cmdType"),a.style("background-color"))},destroy:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{mode:{value:i.WYSIWYG_MODE}}});return c},{requires:["editor","../button/","../overlay/","../dialogLoader/"]});
KISSY.add("editor/plugin/color/cmd",function(h,i){return{applyColor:function(h,d,f){var c=h.get("document")[0];h.execCommand("save");d?(new i.Style(f,{color:d})).apply(c):(new i.Style(f,{color:"inherit"})).remove(c);h.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(h,i,l){function d(){d.superclass.constructor.apply(this,arguments)}var f=h.all,c=h.Event;d.register=function(a){function g(){j.hide()}var j=new d(a),h=a.editor;j.editor=h;h.on("destroy",function(){j.destroy()});h.on("sourceMode",g);h.docReady(function(){var k=h.get("document")[0];c.on(k,"mousedown",g);c.delegate(k,"contextmenu",a.filter,function(a){d.hide(h);var e=f(a.target);a.halt();var b=a.pageX,c=a.pageY;b||(a=e._4e_getOffset(void 0),b=a.left,
c=a.top);setTimeout(function(){j.selectedEl=e;j.show(i.Utils.getXY(b,c,k,document));d.show(j)},30)})});return j};var k={};d.hide=function(a){(a=k[h.stamp(a)])&&a.hide()};d.show=function(a){k[h.stamp(a.editor)]=a};h.extend(d,h.Base,{_init:function(){var a=this,c=a.get("handlers");a.menu=new l({autoRender:!0,width:a.get("width"),elCls:"ke-menu"});var d=a.menu.get("contentEl"),k;for(k in c){var i=f("<a href='#'>"+k+"</a>");d.append(i);c.hasOwnProperty(k)&&function(c,e){c.unselectable(void 0);c.on("click",
function(b){b.halt();c.hasClass("ke-menuitem-disable",void 0)||(a.hide(),h.later(e,30,!1,a))})}(i,c[k])}},destroy:function(){var a;(a=this.menu)&&a.destroy()},hide:function(){var a;(a=this.menu)&&a.hide()},_realShow:function(a){var c=this.menu;i.fire("contextmenu",{contextmenu:this});c.set("xy",[a.left,a.top]);var d=this.get("statusChecker"),f=this.editor;d&&c.get("contentEl").children("a").each(function(a){var c=d[h.trim(a.text())];c&&(c(f)?a.removeClass("ke-menuitem-disable",void 0):a.addClass("ke-menuitem-disable",
void 0))});c.show()},show:function(a){this._init();this.show=this._realShow;this.show(a)}});return d},{requires:["editor","overlay"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(h,i,l){function d(b){return b.nodeType==g.ELEMENT_NODE&&"li"==g.nodeName(b)}function f(b,a,e){for(var c=b.startContainer,d=b.endContainer;c&&!c.parent().equals(a);)c=c.parent();for(;d&&!d.parent().equals(a);)d=d.parent();if(c&&d){for(var f=c,c=[],h=!1;!h;)f.equals(d)&&(h=!0),c.push(f),f=f.next();if(!(1>c.length)){var p=a._4e_parents(!0,void 0);p.each(function(b,a){p[a]=b});for(d=0;d<p.length;d++)if(k[p[d].nodeName()]){a=p[d];break}for(var f="indent"==
e?1:-1,d=c[0],h=c[c.length-1],c={},w=l.listToArray(a,c),s=w[h.data("listarray_index")].indent,d=d.data("listarray_index");d<=h.data("listarray_index");d++){w[d].indent+=f;var B=w[d].parent;w[d].parent=new j(B[0].ownerDocument.createElement(B.nodeName()))}for(d=h.data("listarray_index")+1;d<w.length&&w[d].indent>s;d++)w[d].indent+=f;h=l.arrayToList(w,c,null,"p");f=[];if("outdent"==e){var C;if((C=a.parent())&&"li"==C.nodeName())for(var e=h.listNode.childNodes,A,d=e.length-1;0<=d;d--)(A=new j(e[d]))&&
"li"==A.nodeName()&&f.push(A)}h&&(g.insertBefore(h.listNode[0]||h.listNode,a[0]||a),a.remove());if(f&&f.length)for(d=0;d<f.length;d++){for(A=a=f[d];(A=A.next())&&A.nodeName()in k;)n.ie&&!a.first(function(b){return m(b)&&q(b)})&&a[0].appendChild(b.document.createTextNode("\u00a0")),a[0].appendChild(A[0]);g.insertAfter(a[0],C[0])}i.Utils.clearAllMarkers(c)}}}function c(a,c){var d=parseInt(a.style(p),10);isNaN(d)&&(d=0);d+=("indent"==c?1:-1)*e;if(0>d)return!1;d=Math.max(d,0);d=Math.ceil(d/e)*e;a.css(p,d?
d+b:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var k={ol:1,ul:1},a=i.Walker,g=h.DOM,j=h.Node,n=h.UA,m=a.whitespaces(!0),p="margin-left",e=40,b="px",q=a.bookmark(!1,!0);return{checkOutdentActive:function(b){var a=b.blockLimit;return b.contains(k)?!0:(b=b.block||a)&&b.style(p)},addCommand:function(b,e){b.hasCommand(e)||b.addCommand(e,{exec:function(b){b.execCommand("save");var j=b.getSelection(),h=j&&j.getRanges()[0];if(h){for(var i=h.startContainer,m=h.endContainer,n=h.getCommonAncestor();n&&
!(n[0].nodeType==g.ELEMENT_NODE&&k[n.nodeName()]);)n=n.parent();n&&i[0].nodeType==g.ELEMENT_NODE&&i.nodeName()in k&&(i=new a(h),i.evaluator=d,h.startContainer=i.next());n&&m[0].nodeType==g.ELEMENT_NODE&&m.nodeName()in k&&(i=new a(h),i.evaluator=d,h.endContainer=i.previous());m=j.createBookmarks(!0);if(n){for(i=n.first();i&&"li"!=i.nodeName();)i=i.next();var l=h.startContainer;(!(i[0]==l[0]||i.contains(l))||!c(n,e))&&f(h,n,e)}else{h=h.createIterator();h.enforceRealBlocks=!0;for(h.enlargeBr=!0;n=h.getNextParagraph();)c(n,
e)}j.selectBookmarks(m)}b.execCommand("save");b.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(h,i,l){var d,f={loading:function(){d||(d=new i({x:0,width:6==h.UA.ie?h.DOM.docWidth():"100%",y:0,zIndex:l.baseZIndex(l.zIndexManager.LOADING),prefixCls:"ke-",elCls:"ke-global-loading"}));d.set("height",h.DOM.docHeight());d.show();d.loading()},unloading:function(){d.hide()}};return{useDialog:function(c,d,a){c.hasDialog(d)?c.showDialog(d,a):(f.loading(),h.use("editor/plugin/"+d,function(g,j){f.unloading();c.addDialog(d,new j(c));c.showDialog(d,a)}))}}},
{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(h,i,l,d,f){function c(b,a,e){for(b+="";b.length<a;)b=e+b;return b}function k(b){h.isNumber(b)&&(b=new Date(b));return b instanceof Date?[b.getFullYear(),"-",c(b.getMonth()+1,2,"0"),"-",c(b.getDate(),2,"0")," ",c(b.getHours(),2,"0"),":",c(b.getMinutes(),2,"0"),":",c(b.getSeconds(),2,"0")].join(""):b}function a(b){this.editor=b;this._init()}function g(b){var e=new a(b);b.on("destroy",function(){e.destroy()})}var j=h.Node,n=h.Event,m=h.JSON,p=i.Utils.addRes,
e=i.Utils.destroyRes;h.augment(a,{_getSaveKey:function(){var b=this.editor.get("pluginConfig");return b.draft&&b.draft.saveKey||"ke-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var b=l.getItem(this._getSaveKey()),a=[];b&&(a=l==window.localStorage?m.parse(decodeURIComponent(b)):b);this.drafts=a}return this.drafts},_init:function(){var b=this,a=b.editor,e=a.get("statusBarEl"),c=a.get("pluginConfig");c.draft=c.draft||{};b.draftInterval=c.draft.interval=c.draft.interval||5;b.draftLimit=
c.draft.limit=c.draft.limit||5;e=(new j("<div class='ke-draft'><span class='ke-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+c.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);b.timeTip=(new j("<span class='ke-draft-time'/>")).appendTo(e);var d=(new j("<a href='#' onclick='return false;' class='ke-button ke-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ke-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(e),g=new f({container:e,menuContainer:document.body,doc:a.get("document")[0],
width:"85px",popUpWidth:"225px",align:["r","t"],emptyText:"&nbsp;&nbsp;&nbsp;\u5c1a\u65e0\u7f16\u8f91\u5668\u5386\u53f2\u5b58\u5728",title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});b.versions=g;g.on("select",function(){g.detach("select",arguments.callee);b.sync()});d.on("click",function(a){b.save(!1);a.halt()});p.call(b,d);a.get("textarea")[0].form&&function(){function e(){b.save(!0)}var c=a.get("textarea")[0].form;n.on(c,"submit",e);p.call(b,function(){n.remove(c,"submit",e)})}();var h=setInterval(function(){b.save(!0)},6E4*b.draftInterval);p.call(b,function(){clearInterval(h)});
g.on("click",b.recover,b);p.call(b,g);b.holder=e;if(c.draft.helpHtml){var k=(new j('<a tabindex="0" hidefocus="hidefocus" class="ke-draft-help ke-triplebutton-off" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(e);k.on("click",function(){k[0].focus();b.helpPopup&&b.helpPopup.get("visible")?b.helpPopup.hide():b._prepareHelp()});k.on("blur",function(){b.helpPopup&&b.helpPopup.hide()});b.helpBtn=k;p.call(b,k);i.Utils.lazyRun(b,"_prepareHelp","_realHelp")}p.call(b,
e)},_prepareHelp:function(){var b=this.editor.get("pluginConfig").draft,b=new j(b.helpHtml||""),a=new j("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
b.append(a);b.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new d({content:b,autoRender:!0,width:b.width()+"px",mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=a},_realHelp:function(){var b=this.helpPopup,a=this.helpBtn,e=b.arrow;b.show();a=a.offset();b.get("el").offset({left:a.left-b.get("el").width()+17,top:a.top-b.get("el").height()-7});e.offset({left:a.left-2,top:a.top-8})},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility",
"")},sync:function(){var b=this.draftLimit,a=this.timeTip,e=this.versions,c=this._getDrafts();c.length>b&&c.splice(0,c.length-b);for(var b=[],d,g=0;g<c.length;g++)d=c[g],d=(d.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+k(d.date),b.push({name:d,value:g});e.set("items",b.reverse());a.html(d);l.setItem(this._getSaveKey(),l==window.localStorage?encodeURIComponent(m.stringify(c)):c)},save:function(b){var a=this._getDrafts(),e=this.editor.get("formatData");e&&(a[a.length-1]&&e==a[a.length-1].content&&(a.length-=1),this.drafts=
a.concat({content:e,date:(new Date).getTime(),auto:b}),this.sync())},recover:function(b){var a=this.editor,e=this.versions,c=this._getDrafts(),d=b.newVal;e.reset("value");confirm("\u786e\u8ba4\u6062\u590d "+k(c[d].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(a.execCommand("save"),a.set("data",c[d].content),a.execCommand("save"));b.halt()},destroy:function(){e.call(this)}});return{init:function(b){l.ready?l.ready(function(){g(b)}):g(b)}}},{requires:["editor","../localStorage/","overlay","../select/"]});
KISSY.add("editor/plugin/dragUpload/index",function(h,i){var l=h.Node,d=h.Event,f=i.Utils,c=h.DOM;return h.UA.ie?void 0:{init:function(k){function a(b){b=b.originalEvent.target;"img"==c.nodeName(b)&&b.src.match(/^file:\/\//)&&(o[b.src]=b)}function g(b,a){var c=new window.FileReader;c.onload=function(d){var g=b.name,d=d.target.result,f=new XMLHttpRequest;f.open("POST",e,!0);f.onreadystatechange=function(){if(4==f.readyState){if(200==f.status||304==f.status){if(""!=f.responseText){var b=window.JSON.parse(f.responseText);
a[0].src=b.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),a.remove();f.onreadystatechange=null}};g="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+n+'"; filename="'+encodeURIComponent(g)+'"\r\n');g+="Content-Type: "+(b.type||"application/octet-stream")+"\r\n\r\n";g+=d+"\r\n";p=i.Utils.normParams(p);for(var j in p)p.hasOwnProperty(j)&&(g+="------kissy-editor-yiminghe\r\n",g+='Content-Disposition: form-data; name="'+j+'"\r\n\r\n',g+=p[j]+"\r\n");g+="------kissy-editor-yiminghe--";f.setRequestHeader("Content-Type",
"multipart/form-data, boundary=----kissy-editor-yiminghe");f.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+g.length+"\r\n"+g+"\r\n");c.onload=null};c.readAsBinaryString(b)}var j=k.get("pluginConfig").dragUpload||{},n=j.fileInput||"Filedata",m=j.sizeLimit||Number.MAX_VALUE,p=j.serverParams||{},e=j.serverUrl||"",b=RegExp((j.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),q=k.get("document")[0],o={},u=!1;d.on(q,"dragenter",function(){u||
(d.on(q,"DOMNodeInserted",a),u=!0)});d.on(q,"drop",function(e){d.remove(q,"DOMNodeInserted",a);u=!1;e.halt();var e=e.originalEvent,j,k;h.isEmptyObject(o)?(k=q.elementFromPoint(e.clientX,e.clientY),j=k.lastChild):(h.each(o,function(b){"img"==c.nodeName(b)&&(j=b.nextSibling,k=b.parentNode,c.remove(b))}),o={});e=e.dataTransfer;e.dropEffect="copy";if(e=e.files)for(var i=0;i<e.length;i++){var n=e[i],p=n.size;if(n.name.match(b)&&!(p/1E3>m)){var p=new l("<img src='"+f.debugUrl("theme/tao-loading.gif")+"'/>"),
w=p[0];k.insertBefore(w,j);var s=c.nodeName(w.parentNode);("head"==s||"html"==s)&&c.insertBefore(w,q.body.firstChild);g(n,p)}}});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(b,a){for(var e=new (window.BlobBuilder||window.WebKitBlobBuilder),c=b.length,d=new window.Uint8Array(c),g=0;g<c;g++)d[g]=b.charCodeAt(g);e.append(d.buffer);this.send(e.getBlob(a))})}}},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(h,i){function l(d){this.cfg=d;this._cache=[];this._init()}var d=h.Node;h.augment(l,{_init:function(){var f=this.cfg.editor;this.holder=new d("<span>");this.holder.appendTo(f.get("statusBarEl"),void 0);f.on("selectionChange",this._selectionChange,this);i.Utils.sourceDisable(f,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(f){var c=this.cfg.editor,h=this.holder,
f=f.path.elements,a,g;a=this._cache;for(g=0;g<a.length;g++)a[g].remove();this._cache=[];for(g=0;g<f.length;g++){a=f[g];var j=a.attr("_ke_real_element_type")||a.nodeName(),i=new d("<a href='javascript(\""+j+"\")' class='ke-element-path'>"+j+"</a>");this._cache.push(i);(function(a){i.on("click",function(d){d.halt();c.focus();setTimeout(function(){c.getSelection().selectElement(a)},50)})})(a);h.prepend(i)}},destroy:function(){this.holder.remove()}});return{init:function(d){var c=new l({editor:d});d.on("destroy",
function(){c.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(h,i){var l=h.Node,d=h.DOM,f=i.Utils.debugUrl("theme/spacer.gif"),c=h.require("htmlparser");h.augment(i,{createFakeElement:function(a,c,d,k,i,p){var e=a.attr("style")||"";a.attr("width")&&(e="width:"+a.attr("width")+"px;"+e);a.attr("height")&&(e="height:"+a.attr("height")+"px;"+e);var b=h.trim(a.attr("class")),a={"class":c+" "+b,src:f,_ke_realelement:encodeURIComponent(i||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:e};p&&delete p.width;
p&&delete p.height;p&&h.mix(a,p,!1);d&&(a._ke_real_element_type=d);k&&(a._ke_resizable=k);return new l("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=d.ELEMENT_NODE)return null;var a=decodeURIComponent(a.attr("_ke_realelement")),c=new l("<div>",null,this.get("document")[0]);c.html(a);return c.first(function(a){return a.nodeType==d.ELEMENT_NODE}).remove()}});var k={tags:{$:function(a){var d=a.getAttribute("_ke_realelement"),f;d&&(f=(new c.Parser(decodeURIComponent(d))).parse());
if(d=f&&f.childNodes[0]){if(f=a.getAttribute("style")){var h=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f),a=h&&h[1];f=(h=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&h[1];a&&d.setAttribute("width",a);f&&d.setAttribute("height",f)}return d}}}};return{init:function(a){var d=(a=a.htmlDataProcessor)&&a.htmlFilter;a.createFakeParserElement||(d&&d.addRules(k),h.mix(a,{createFakeParserElement:function(a,d,g,k,e){var b;b=new c.BasicWriter;a.writeHtml(b);b=b.getHtml();var i=a.getAttribute("style")||"";a.getAttribute("width")&&
(i="width:"+a.getAttribute("width")+"px;"+i);a.getAttribute("height")&&(i="height:"+a.getAttribute("height")+"px;"+i);var l=h.trim(a.getAttribute("class")),a={"class":d+" "+l,src:f,_ke_realelement:encodeURIComponent(b),_ke_real_node_type:a.nodeType+"",style:i,align:a.getAttribute("align")||""};e&&delete e.width;e&&delete e.height;e&&h.mix(a,e,!1);g&&(a._ke_real_element_type=g);k&&(a._ke_resizable="_ke_resizable");return new c.Tag("img",a)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(h,i,l){function d(a){this._init(a)}function f(a){var d=h.isString(a)?a.match(/(\d)+/g):a;h.isArray(d)&&(a=parseFloat(d[0]+"."+c(d[1],3)+c(d[2],5)));return a||0}function c(a,c){for(var e=(a+"").length;e++<c;)a="0"+a;return a}var k={};h.augment(d,h.EventTarget,{_init:function(a){var c=h.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var e=a.flashVars,b=a.params;h.mix(a.attrs,{id:c,width:"100%",height:"100%"},
!1);h.mix(b,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);h.mix(e,{shareData:!1,useCompression:!1},!1);b={YUISwfId:c,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(b={swfID:c,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});h.mix(e,b);k[c]=this;this.id=c;this.swf=l.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var c=this,e=0;e<a.length;e++)(function(b){c[b]=function(){return c._callSWF(b,h.makeArray(arguments))}})(a[e])},
_callSWF:function(a,c){c=c||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,c)}catch(e){var b="";0!==c.length&&(b="'"+c.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+b+");"))(this)}},_eventHandler:function(a){var c=a.type;"log"!==c&&c&&this.fire(c,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete k[this.id]}});d.EventHandler=function(a,c){var e=k[a];e&&setTimeout(function(){e._eventHandler.call(e,c)},100)};i.FlashBridge=
d;var a=h.UA,g,j,n=!0;a.fpv=function(a){if(a||n){n=!1;var c;if(navigator.plugins&&navigator.mimeTypes.length)c=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{c=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(e){}g=!c?void 0:c.match(/(\d)+/g);j=f(g)}return g};a.fpvGEQ=function(c,d){n&&a.fpv(d);return!!j&&j>=f(c)};return d},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(h,i,l,d,f,c){function k(){k.superclass.constructor.apply(this,arguments);this._init()}var a=h.Node;k.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},contextMenuHandlers:{}};h.extend(k,h.Base,{_init:function(){var a=this,c=a.get("cls"),f=a.get("editor"),k=a.get("contextMenuHandlers");l.register({editor:f,filter:"."+c,width:"120px",handlers:k});d.register({filter:function(a){return a.hasClass(c,void 0)&&a},editor:f,init:function(){var c=this,e=c.get("contentEl");
e.html(h.substitute(' <a class="ke-bubbleview-url" target="_blank" href="#">{label}</a>   |    <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>',{label:a.get("label")}));var b=e.one(".ke-bubbleview-url"),d=e.one(".ke-bubbleview-change"),j=e.one(".ke-bubbleview-remove");i.Utils.preventFocus(e);d.on("click",function(b){a.show(c.selectedEl);b.halt()});j.on("click",function(b){if(h.UA.webkit){var a=f.getSelection().getRanges();
if(a=a&&a[0])a.collapse(!0),a.select()}c.selectedEl.remove();c.hide();f.notifySelectionChange();b.halt()});c.on("show",function(){var e=c.selectedEl;e&&a._updateTip(b,e)})}});f.docReady(function(){f.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(a){return c.getUrl(a)},_updateTip:function(a,c){var d=this.get("editor").restoreRealElement(c);d&&(d=this._getFlashUrl(d),a.attr("href",d))},_dbClick:function(c){var d=new a(c.target);"img"===d.nodeName()&&d.hasClass(this.get("cls"),
void 0)&&(this.show(d),c.halt())},show:function(a){var c=this.get("editor");f.useDialog(c,this.get("type")+"/dialog",a)}});return k},{requires:["editor","../contextmenu/","../bubbleview/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(h){var i=h.DOM,l=h.Node,d=h.UA,f={insertFlash:function(c,d,a,g,j,h){d=f.createSWF(d,{attrs:a},c.get("document")[0]);a=c.createFakeElement(d.el,g||"ke_flash",j||"flash",!0,d.html,a);c.insertElement(a,null,h)},isFlashEmbed:function(c){return"application/x-shockwave-flash"==c.getAttribute("type")||/\.swf(?:$|\?)/i.test(c.getAttribute("src")||"")},getUrl:function(c){var d="";if("object"==c.nodeName())for(var c=c[0].childNodes,a=0;a<c.length;a++)1==
c[a].nodeType&&("movie"==(i.attr(c[a],"name")||"").toLowerCase()?d=i.attr(c[a],"value"):"embed"==i.nodeName(c[a])?d=i.attr(c[a],"src"):"object"==i.nodeName(c[a])&&(d=i.attr(c[a],"data")));else"embed"==c.nodeName()&&(d=c.attr("src"));return d},createSWF:function(c,d,a){var g=d.attrs||{},f=d.flashVars,i="",m="",d=d.params||{},p="",a=a||document;h.mix(g,{wmode:"transparent"});for(var e in g)g.hasOwnProperty(e)&&(i+=e+"='"+g[e]+"' ");h.mix(d,{quality:"high",movie:c,wmode:"transparent"});for(var b in d)d.hasOwnProperty(b)&&
(m+="<param name='"+b+"' value='"+d[b]+"'/>");if(f){for(var q in f)f.hasOwnProperty(q)&&(p+="&"+q+"="+encodeURIComponent(f[q]));p=p.substring(1)}c="<object "+i+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+m+(p?'<param name="flashVars" value="'+p+'"/>':"")+"<embed "+i+" "+(p?'FlashVars="'+p+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+c+'"  type="application/x-shockwave-flash"/></object>';return{el:new l(c,null,a),html:c}},createSWFRuntime2:function(c,
h,a){var a=a||document,g=(new l("<div style='width:0;height:0;overflow:hidden;'>",null,a)).appendTo(a.body),g=f.createSWF.apply(this,arguments).el.appendTo(g);d.ie||(g=g.one("object"));return g[0]},createSWFRuntime:function(c,f,a){var g=f.attrs||{},j=f.flashVars||{},n=f.params||{},m="",p="",e="",a=a||document;g.id=g.id||h.guid("ke-runtimeflash-");for(var b in g)g.hasOwnProperty(b)&&(m+=b+"='"+g[b]+"' ");for(var q in n)n.hasOwnProperty(q)&&(p+="<param name='"+q+"' value='"+n[q]+"'/>");for(var o in j)j.hasOwnProperty(o)&&
(e+="&"+o+"="+encodeURIComponent(j[o]));var e=e.substring(1),c=d.ie?"<object "+m+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+p+'<param name="movie" value="'+c+'" />'+(e?'<param name="flashVars" value="'+e+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+c+"' "+m+">"+p+(e?'<param name="flashVars" value="'+e+'"/>':"")+"</object>",u=f.holder;u||(u=(new l("<div style='"+(f.style?f.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,a)).appendTo(a.body),
setTimeout(function(){u.offset({left:i.scrollLeft(),top:i.scrollTop()})},100));u.html(c);return a.getElementById(g.id)}};return f});
KISSY.add("editor/plugin/flash/index",function(h,i,l,d){return{init:function(f){var c=f.htmlDataProcessor;c.dataFilter.addRules({tags:{object:function(a){var f;if(!a.getAttribute("classid")){var h=a.childNodes;for(f=0;f<h.length;f++)if("embed"==h[f].nodeName)if(d.isFlashEmbed(h[f][f]))break;else return c.createFakeParserElement(a,"ke_flash","flash",!0);return null}return c.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return d.isFlashEmbed(a)?c.createFakeParserElement(a,"ke_flash",
"flash",!0):null}}},5);var h=f.get("pluginConfig").flash||{},a=new l({editor:f,cls:"ke_flash",type:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var c=this.selectedEl;c&&a.show(c)}}});!1!==h.btn&&f.addButton({contentCls:"ke-toolbar-flash",title:"\u63d2\u5165Flash",mode:i.WYSIWYG_MODE},{offClick:function(){a.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/fontFamily/cmd",function(h,i,l){var d={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(f){l.addSelectCmd(f,"fontFamily",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(h,i,l,d){return{init:function(f){d.init(f);var c=f.get("pluginConfig").fontFamily,c=c||{};h.mix(c,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},{name:"Verdana",
value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},!1);h.each(c.items,function(c){var a=c.attrs||{},d=c.value;a.style=a.style||"";a.style+=";font-family:"+d;c.attrs=a});f.addSelect({cmdType:"fontFamily",title:"\u5b57\u4f53",width:"110px",mode:i.WYSIWYG_MODE,defaultValue:c.defaultValue,popUpWidth:c.width,items:c.items},void 0,l.Select)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(h,i,l){var d={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(f){l.addSelectCmd(f,"fontSize",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(h,i,l,d){return{init:function(f){d.init(f);var c=f.get("pluginConfig").fontSize,c=c||{};h.mix(c,{items:function(c){var a=[];h.each(c,function(c){a.push({name:c,value:c})});return a}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(",")),width:"55px"},!1);f.addSelect({cmdType:"fontSize",title:"\u5927\u5c0f",width:"30px",mode:i.WYSIWYG_MODE,showValue:!0,defaultValue:c.defaultValue,popUpWidth:c.width,items:c.items},void 0,l.Select)}}},{requires:["editor",
"../font/ui","./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(h,i){var l=i.Utils.getQueryCmd;return{addButtonCmd:function(d,f,c){var h=l(f);d.hasCommand(f)||(d.addCommand(f,{exec:function(a,d){var f=a.get("document")[0];a.execCommand("save");d||void 0===d?c.apply(f):c.remove(f);a.execCommand("save");a.notifySelectionChange()}}),d.addCommand(h,{exec:function(a,d){return c.checkActive(d)}}))},addSelectCmd:function(d,f,c){var h=l(f);d.hasCommand(f)||(d.addCommand(f,{exec:function(a,d,f){var d=new i.Style(c,{value:d}),
h=a.get("document")[0];a.execCommand("save");void 0===f||f?d.apply(h):d.remove(h);a.execCommand("save")}}),d.addCommand(h,{exec:function(a,d,f){return(new i.Style(c,{value:d})).checkElementRemovable(f,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(h,i,l,d){function f(){f.superclass.constructor.apply(this,arguments)}function c(){c.superclass.constructor.apply(this,arguments)}var k=i.Utils.getQueryCmd;h.extend(f,d,{click:function(a){var c=a.newVal,d=this.get("cmdType"),a=a.prevVal,f=this.get("editor");f.focus();c==a?f.execCommand(d,c,!1):f.execCommand(d,c)},selectionChange:function(a){for(var c=a.path,a=k(this.get("cmdType")),d=this.get("items"),f=this.get("editor"),c=c.elements,h=0,i;h<c.length;h++){i=
c[h];for(var e=0;e<d.length;e++){var b=d[e].value;if(f.execCommand(a,b,i)){this.set("value",b);return}}}(a=this.get("defaultValue"))?this.set("value",a):this.reset("value")}});h.extend(c,l,{offClick:function(){var a=this.get("cmdType"),c=this.get("editor");c.execCommand(a);c.focus()},onClick:function(){var a=this.get("cmdType"),c=this.get("editor");c.execCommand(a,!1);c.focus()},selectionChange:function(a){var c=this.get("editor"),d=k(this.get("cmdType"));c.execCommand(d,a.path)?this.set("state",
l.ON):this.set("state",l.OFF)}},{ATTRS:{mode:{value:i.WYSIWYG_MODE}}});return{Button:c,Select:f}},{requires:["editor","../button/","../select/"]});
KISSY.add("editor/plugin/foreColor/cmd",function(h,i){var l={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(d){return!("a"==d.nodeName()||d.all("a").length)}};return{init:function(d){d.hasCommand("foreColor")||d.addCommand("foreColor",{exec:function(d,c){d.execCommand("save");i.applyColor(d,c,l);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"foreColor",title:"\u6587\u672c\u989c\u8272",contentCls:"ke-toolbar-fore-color"},void 0,l)}}},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(h,i){return{init:function(h){if(!h.hasCommand("heading")){h.addCommand("heading",{exec:function(d,c){d.execCommand("save");(new i.Style({element:c})).apply(d.get("document")[0]);d.execCommand("save")}});var d=i.Utils.getQueryCmd("heading");h.addCommand(d,{exec:function(d,c,h){return(new i.Style({element:h})).checkActive(c)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(h,i,l){return{init:function(d){l.init(d);var f=[],c={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},h={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},a;for(a in c)c.hasOwnProperty(a)&&f.push({name:a,value:c[a],attrs:{style:"font-size:"+h[c[a]]}});d.addSelect({items:f,title:"\u6807\u9898",width:"100px",mode:i.WYSIWYG_MODE},{click:function(a){var c=a.newVal;c!=a.prevVal?d.execCommand("heading",c):(d.execCommand("heading",
"p"),this.set("value","p"))},selectionChange:function(a){var a=a.path,c=i.Utils.getQueryCmd("heading"),f;for(f in h)if(h.hasOwnProperty(f)&&d.execCommand(c,a,f)){this.set("value",f);break}}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(h,i,l,d,f,c){var k=h.UA,a=h.Node,g=h.all,j=h.Event,n=function(a){a=g(a);return"img"===a.nodeName(a)&&!/(^|\s+)ke_/.test(a[0].className)&&a};return{init:function(h){function l(a){c.useDialog(h,"image/dialog",a)}h.addButton({contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:i.WYSIWYG_MODE},{offClick:function(){l(null)}});f.register({editor:h,filter:n,width:"120px",handlers:{"\u56fe\u7247\u5c5e\u6027":function(){var a=n(this.selectedEl);a&&l(g(a))},"\u63d2\u5165\u65b0\u884c":function(){var c=h.get("document")[0],
b=new a(c.createElement("p"));k.ie||b._4e_appendBogus(void 0);c=new i.Range(c);c.setStartAfter(this.selectedEl);c.select();h.insertElement(b);c.moveToElementEditablePosition(b,1);c.select()}}});h.docReady(function(){j.on(h.get("document")[0],"dblclick",function(a){a.halt();a=g(a.target);n(a)&&l(a)})});d.register({editor:h,filter:n,init:function(){var a=this,b=a.get("contentEl");b.html('<a class="ke-bubbleview-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ke-bubbleview-link ke-bubbleview-change" href="#">\u7f16\u8f91</a>  |  <a class="ke-bubbleview-link ke-bubbleview-remove" href="#">\u5220\u9664</a>');
var c=b.one(".ke-bubbleview-url"),d=b.one(".ke-bubbleview-change"),f=b.one(".ke-bubbleview-remove");i.Utils.preventFocus(b);d.on("click",function(b){l(a.selectedEl);b.halt()});f.on("click",function(b){if(k.webkit){var c=h.getSelection().getRanges();c&&c[0]&&(c[0].collapse(),c[0].select())}a.selectedEl.remove();a.hide();h.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr("_ke_saved_src")||b.attr("src"),c.attr("href",b))})}})}}},{requires:["editor","../button/",
"../bubbleview/","../contextmenu/","../dialogLoader/"]});KISSY.add("editor/plugin/indent/cmd",function(h,i,l){var d=l.addCommand;return{init:function(f){d(f,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(h,i,l){return{init:function(d){l.init(d);d.addButton({title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:i.WYSIWYG_MODE,contentCls:"ke-toolbar-indent"},{offClick:function(){d.execCommand("indent")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/insertOrderedList/cmd",function(h,i,l){var d=l.queryActive,f=new l.ListCommand("ol");return{init:function(c){c.hasCommand("insertOrderedList")||c.addCommand("insertOrderedList",{exec:function(a){f.exec(a)}});var h=i.Utils.getQueryCmd("insertOrderedList");c.hasCommand(h)||c.addCommand(h,{exec:function(a,c){return d("ol",c)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/insertOrderedList/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"insertOrderedList",mode:i.WYSIWYG_MODE,contentCls:"ke-toolbar-ol"},void 0,l)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/insertUnorderedList/cmd",function(h,i,l){var d=l.queryActive,f=new l.ListCommand("ul");return{init:function(c){c.hasCommand("insertUnorderedList")||c.addCommand("insertUnorderedList",{exec:function(a){f.exec(a)}});var h=i.Utils.getQueryCmd("insertUnorderedList");c.hasCommand(h)||c.addCommand(h,{exec:function(a,c){return d("ul",c)}})}}},{requires:["editor","../listUtils/cmd.js"]});
KISSY.add("editor/plugin/insertUnorderedList/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"insertUnorderedList",mode:i.WYSIWYG_MODE,contentCls:"ke-toolbar-ul"},void 0,l)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(h,i,l){var d=new i.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(f){l.addButtonCmd(f,"italic",d)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"italic",contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(h,i){return{init:function(h){i.addCommand(h,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(h,i,l){function d(){this.get("editor").execCommand("justifyCenter")}return{init:function(f){l.init(f);f.addButton({contentCls:"ke-toolbar-justifyCenter",title:"\u5c45\u4e2d\u5bf9\u9f50"},{onClick:d,offClick:d,selectionChange:function(c){var d=i.Utils.getQueryCmd("justifyCenter");f.execCommand(d,c.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyLeft/cmd",function(h,i){return{init:function(h){i.addCommand(h,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(h,i,l){function d(){this.get("editor").execCommand("justifyLeft")}return{init:function(f){l.init(f);f.addButton({contentCls:"ke-toolbar-justifyLeft",title:"\u5de6\u5bf9\u9f50"},{onClick:d,offClick:d,selectionChange:function(c){var d=i.Utils.getQueryCmd("justifyLeft");f.execCommand(d,c.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyRight/cmd",function(h,i){return{init:function(h){i.addCommand(h,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(h,i,l){function d(){this.get("editor").execCommand("justifyRight")}return{init:function(f){l.init(f);f.addButton({contentCls:"ke-toolbar-justifyRight",title:"\u53f3\u5bf9\u9f50"},{onClick:d,offClick:d,selectionChange:function(c){var d=i.Utils.getQueryCmd("justifyRight");f.execCommand(d,c.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(h,i){var l=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(d,f,c){d.hasCommand(f)||(d.addCommand(f,{exec:function(d){d.execCommand("save");for(var a=d.getSelection(),f=a.createBookmarks(),h=a.getRanges(),i,m,p=h.length-1;0<=p;p--){i=h[p].createIterator();for(i.enlargeBr=!0;m=i.getNextParagraph();)m.removeAttr("align"),(m.css("text-align").replace(l,"")||"left")==c?m.css("text-align",""):m.css("text-align",c)}a.selectBookmarks(f);d.execCommand("save");
d.notifySelectionChange()}}),d.addCommand(i.Utils.getQueryCmd(f),{exec:function(d,a){var f=a.block||a.blockLimit;return!f||"body"===f.nodeName()?!1:(f.css("text-align").replace(l,"")||"left")==c}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(h,i,l,d,f){function c(a){a=k(a);return a.closest("a",void 0)}var k=h.all;return{init:function(a){a.addButton({contentCls:"ke-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:i.WYSIWYG_MODE},{offClick:function(){f.useDialog(a,"link/dialog",void 0)}});l.register({editor:a,filter:c,init:function(){var c=this,h=c.get("contentEl");h.html('<a href=""  target="_blank" class="ke-bubbleview-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ke-bubbleview-link ke-bubbleview-remove">\u53bb\u9664</span>');
var k=h.one(".ke-bubbleview-url"),l=h.one(".ke-bubbleview-change"),p=h.one(".ke-bubbleview-remove");i.Utils.preventFocus(h);l.on("click",function(d){f.useDialog(a,"link/dialog",c.selectedEl);d.halt()});p.on("click",function(e){d.removeLink(a,c.selectedEl);e.halt()});c.on("show",function(){var a=c.selectedEl;a&&(a=a.attr(d._ke_saved_href)||a.attr("href"),k.html(a),k.attr("href",a))})}})}}},{requires:["editor","../bubbleview/","./utils","../dialogLoader/"]});
KISSY.add("editor/plugin/link/utils",function(h,i){var l=h.Node,d=i.Style,f={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(c,h){c.execCommand("save");var a=c.getSelection(),g=a.getRanges()[0];if(g&&g.collapsed)g=a.createBookmarks(),h._4e_remove(!0),a.selectBookmarks(g);else if(g){for(var a=h[0],g=a.attributes,j={},i=0;i<g.length;i++){var l=g[i];l.specified&&(j[l.name]=l.value)}a.style.cssText&&(j.style=a.style.cssText);
(new d(f,j)).remove(c.get("document")[0])}c.execCommand("save");c.notifySelectionChange()},applyLink:function(c,h,a){h._ke_saved_href=h.href;a?(c.execCommand("save"),a.attr(h)):(a=(a=c.getSelection())&&a.getRanges()[0],!a||a.collapsed?(h=new l("<a>"+h.href+"</a>",h,c.get("document")[0]),c.insertElement(h)):(c.execCommand("save"),(new d(f,h)).apply(c.get("document")[0])));c.execCommand("save");c.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(h,i,l){function d(){d.superclass.constructor.apply(this,arguments)}function f(){var c=this.get("editor"),d=this.get("cmdType");c.execCommand(d)}h.extend(d,l,{offClick:f,onClick:f,selectionChange:function(c){var d=this.get("editor"),a=i.Utils.getQueryCmd(this.get("cmdType"));d.execCommand(a,c.path)?this.bon():this.boff()}});return d},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(h,i,l,d){function f(b){this.type=b}function c(b,a){var c,d,e=a.blockLimit,f=a.elements;if(!e)return!1;if(f)for(var g=0;g<f.length&&(c=f[g])&&c[0]!==e[0];g++)if(k[d=c.nodeName()]&&d==b)return!0;return!1}var k={ol:"insertOrderedList",ul:"insertUnorderedList"},a=i.RANGE,g=i.ElementPath,j=i.Walker,n=h.UA,m=h.Node,p=h.DOM,e=/^h[1-6]$/;f.prototype={changeListType:function(b,a,c,e){for(var f=l.listToArray(a.root,c,d,d,d),g=[],b=0;b<a.contents.length;b++){var h=
a.contents[b];if((h=h.closest("li",d))&&h[0]&&!h.data("list_item_processed"))g.push(h),h._4e_setMarker(c,"list_item_processed",!0,d)}h=new m(a.root[0].ownerDocument.createElement(this.type));for(b=0;b<g.length;b++){var j=g[b].data("listarray_index");f[j].parent=h}for(var c=l.arrayToList(f,c,null,"p"),i,f=c.listNode.childNodes.length,b=0;b<f&&(i=new m(c.listNode.childNodes[b]));b++)i.nodeName()==this.type&&e.push(i);c.listNode.insertBefore(a.root);a.root.remove()},createList:function(a,c,f){var g=
c.contents,a=c.root[0].ownerDocument,h=[];if(1==g.length&&g[0][0]===c.root[0]){var j=new m(a.createElement("div"));g[0][0].nodeType!=p.TEXT_NODE&&g[0]._4e_moveChildren(j,d,d);g[0][0].appendChild(j[0]);g[0]=j}c=c.contents[0].parent();for(j=0;j<g.length;j++)c=c._4e_commonAncestor(g[j].parent(),d);for(j=0;j<g.length;j++)for(var i=g[j],k;k=i.parent();){if(k[0]===c[0]){h.push(i);break}i=k}if(!(1>h.length)){g=new m(h[h.length-1][0].nextSibling);j=new m(a.createElement(this.type));for(f.push(j);h.length;)f=
h.shift(),i=new m(a.createElement("li")),e.test(f.nodeName())?i[0].appendChild(f[0]):(f._4e_copyAttributes(i,d,d),f._4e_moveChildren(i,d,d),f.remove()),j[0].appendChild(i[0]),n.ie||i._4e_appendBogus(d);g[0]?j.insertBefore(g,d):c.append(j)}},removeList:function(a,c,e){function f(e){if((z=new m(n[e?"firstChild":"lastChild"]))&&!(z[0].nodeType==p.ELEMENT_NODE&&z._4e_isBlockBoundary(d,d))&&(w=c.root[e?"prev":"next"](j.whitespaces(!0)))&&!(z[0].nodeType==p.ELEMENT_NODE&&w._4e_isBlockBoundary({br:1},d)))z[e?
"before":"after"](a.get("document")[0].createElement("br"))}for(var g=l.listToArray(c.root,e,d,d,d),h=[],i=0;i<c.contents.length;i++){var k=c.contents[i];if((k=k.closest("li",d))&&!k.data("list_item_processed"))h.push(k),k._4e_setMarker(e,"list_item_processed",!0,d)}k=null;for(i=0;i<h.length;i++)k=h[i].data("listarray_index"),g[k].indent=-1;for(i=k+1;i<g.length;i++)if(g[i].indent>Math.max(g[i-1].indent,0)){h=g[i-1].indent+1-g[i].indent;for(k=g[i].indent;g[i]&&g[i].indent>=k;)g[i].indent+=h,i++;i--}var n=
l.arrayToList(g,e,null,"p").listNode,z,w;f(!0);f(d);c.root.before(n);c.root.remove()},exec:function(b){var e=b.getSelection(),f=e&&e.getRanges();if(f&&!(1>f.length)){for(var h=e.getStartElement(),h=new i.ElementPath(h),l=c(this.type,h),h=e.createBookmarks(!0),n=[],m={};0<f.length;){var x=f.shift(),y=x.getBoundaryNodes(),z=y.startNode,w=y.endNode;z[0].nodeType==p.ELEMENT_NODE&&"td"==z.nodeName()&&x.setStartAt(y.startNode,a.POSITION_AFTER_START);w[0].nodeType==p.ELEMENT_NODE&&"td"==w.nodeName()&&x.setEndAt(y.endNode,
a.POSITION_BEFORE_END);x=x.createIterator();for(x.forceBrBreak=!1;y=x.getNextParagraph();)if(!y.data("list_block")){y._4e_setMarker(m,"list_block",1,d);for(var w=new g(y),s=w.elements,B=null,C=!1,B=w.blockLimit,A,z=s.length-1;0<=z&&(A=s[z]);z--)if(k[A.nodeName()]&&B.contains(A)){B.removeData("list_group_object");(z=A.data("list_group_object"))?z.contents.push(y):(z={root:A,contents:[y]},n.push(z),A._4e_setMarker(m,"list_group_object",z,d));C=!0;break}C||(w=B||w.block,w.data("list_group_object")?w.data("list_group_object").contents.push(y):
(z={root:w,contents:[y]},w._4e_setMarker(m,"list_group_object",z,d),n.push(z)))}}for(f=[];0<n.length;)z=n.shift(),l?k[z.root.nodeName()]&&this.removeList(b,z,m):k[z.root.nodeName()]?this.changeListType(b,z,m,f):(i.Utils.clearAllMarkers(m),this.createList(b,z,f));for(var F=this,z=0;z<f.length;z++)B=f[z],b=function(a,b){var c=b[a?"prev":"next"](j.whitespaces(!0));c&&c[0]&&c.nodeName()==F.type&&(c.remove(),c._4e_moveChildren(b,a?!0:!1,d))},b(d,B),b(!0,B);i.Utils.clearAllMarkers(m);e.selectBookmarks(h)}}};
new f("ul");new f("ol");return{ListCommand:f,queryActive:c}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(h){var i={ol:1,ul:1},l=h.Node,d=h.DOM,f=h.UA,c={listToArray:function(f,a,g,h,n){if(!i[f.nodeName()])return[];h||(h=0);g||(g=[]);for(var m=0,p=f[0].childNodes.length;m<p;m++){var e=new l(f[0].childNodes[m]);if("li"==e.nodeName()){var b={parent:f,indent:h,element:e,contents:[]};n?b.grandparent=n:(b.grandparent=f.parent(),b.grandparent&&"li"==b.grandparent.nodeName()&&(b.grandparent=b.grandparent.parent()));a&&e._4e_setMarker(a,"listarray_index",g.length,
void 0);g.push(b);for(var q=0,o=e[0].childNodes.length,u;q<o;q++)u=new l(e[0].childNodes[q]),u[0].nodeType==d.ELEMENT_NODE&&i[u.nodeName()]?c.listToArray(u,a,g,h+1,b.grandparent):b.contents.push(u)}}return g},arrayToList:function(h,a,g,j){g||(g=0);if(!h||h.length<g+1)return null;for(var n=h[g].parent[0].ownerDocument,m=n.createDocumentFragment(),p=null,e=g,b=Math.max(h[g].indent,0),q=null;;){var o=h[e];if(o.indent==b){if(!p||h[e].parent.nodeName()!=p.nodeName())p=h[e].parent.clone(!1),m.appendChild(p[0]);
for(var q=p[0].appendChild(o.element.clone(!1)[0]),u=0;u<o.contents.length;u++)q.appendChild(o.contents[u].clone(!0)[0]);e++}else if(o.indent==Math.max(b,0)+1)e=c.arrayToList(h,null,e,j),q.appendChild(e.listNode),e=e.nextIndex;else if(-1==o.indent&&!g&&o.grandparent){i[o.grandparent.nodeName()]?q=o.element.clone(!1)[0]:"td"!=o.grandparent.nodeName()?(q=n.createElement(j),o.element._4e_copyAttributes(new l(q))):q=n.createDocumentFragment();for(u=0;u<o.contents.length;u++)p=o.contents[u].clone(!0),
q.nodeType==d.DOCUMENT_FRAGMENT_NODE&&o.element._4e_copyAttributes(new l(p)),q.appendChild(p[0]);q.nodeType==d.DOCUMENT_FRAGMENT_NODE&&e!=h.length-1&&(q.lastChild&&q.lastChild.nodeType==d.ELEMENT_NODE&&"_moz"==q.lastChild.getAttribute("type")&&d._4e_remove(q.lastChild),d._4e_appendBogus(q));q.nodeType==d.ELEMENT_NODE&&d.nodeName(q)==j&&q.firstChild&&(d._4e_trim(q),p=q.firstChild,p.nodeType==d.ELEMENT_NODE&&d._4e_isBlockBoundary(p)&&(p=n.createDocumentFragment(),d._4e_moveChildren(q,p),q=p));p=d.nodeName(q);
!f.ie&&("div"==p||"p"==p)&&d._4e_appendBogus(q);m.appendChild(q);p=null;e++}else return null;if(h.length<=e||Math.max(h[e].indent,0)<b)break}if(a)for(h=new l(m.firstChild);h&&h[0];)h[0].nodeType==d.ELEMENT_NODE&&h._4e_clearMarkers(a,!0),h=h._4e_nextSourceNode();return{listNode:m,nextIndex:e}}};return c},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(h,i,l,d){if(!h.UA.ie&&window.localStorage)return window.localStorage;var f=i.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),c=new d({movie:f,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});c.swf.height=138;var k=new l({width:"0px",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",zIndex:i.baseZIndex(i.zIndexManager.STORE_FLASH_SHOW)});
k.render();k.get("contentEl").append(c.swf);k.center();k.show();c.on("pending",function(){k.set("width",215);k.center();k.show();setTimeout(function(){c.retrySave()},1E3)});c.on("save",function(){k.set("width",0)});var a=c.setItem;h.mix(c,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(c,d){this.lastSave={k:c,v:d};a.call(this,c,d)}});c.on("contentReady",function(){c._ready=1});return c},{attach:!1,requires:["editor",
"overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(h,i){function l(a){this.editor=a}var d=h.UA,f=d.ie,c=document,k=h.Node,a=h.Event,g=h.DOM,j;h.augment(l,{restoreWindow:function(){var c=this,d=c.editor;!1!==d.fire("beforeRestoreWindow")&&c._resize&&(a.remove(window,"resize",c._resize),c._resize=0,c._saveEditorStatus(),c._restoreState(),setTimeout(function(){c._restoreEditorStatus();d.notifySelectionChange();d.fire("restoreWindow")},30))},_restoreState:function(){var a=this.editor,d=this._savedParents;
if(d){for(var h=0;h<d.length;h++){var e=d[h];e.el.css("position",e.position)}this._savedParents=null}a.get("iframeWrapEl").css({height:this.iframeHeight});g.css(c.body,{width:"",height:"",overflow:""});c.documentElement.style.overflow="";a=a.get("el")[0].style;a.position="static";a.width=this.editorElWidth;j.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>f&&this.editor.get("toolBarEl").removeClass("ke-toolbar-padding",void 0)},_saveSate:function(){var a=this.editor,
c=[],d=a.get("el");this.iframeHeight=a.get("iframeWrapEl").style("height");this.editorElWidth=d.style("width");this.scrollLeft=g.scrollLeft();this.scrollTop=g.scrollTop();window.scrollTo(0,0);for(a=d.parent();a;)d=a.css("position"),"static"!=d&&(c.push({el:a,position:d}),a.css("position","static")),a=a.parent();this._savedParents=c;8>f&&this.editor.get("toolBarEl").addClass("ke-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;d.gecko&&a.__iframeFocus&&
(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,c=a.getSelection(),f=this.savedRanges;d.gecko&&a.activateGecko();f&&c&&c.selectRanges(f);a.__iframeFocus&&c&&(a=c.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(a){var d=this.editor,h=d.get("el"),e=g.viewportHeight(),b=g.viewportWidth(),k=d.get("statusBarEl")?d.get("statusBarEl")[0].offsetHeight:0,l=d.get("toolBarEl")[0].offsetHeight;f?c.body.style.overflow="hidden":g.css(c.body,
{width:0,height:0,overflow:"hidden"});c.documentElement.style.overflow="hidden";h.css({position:"absolute",zIndex:i.baseZIndex(i.zIndexManager.MAXIMIZE),width:b+"px"});j.css({zIndex:i.baseZIndex(i.zIndexManager.MAXIMIZE-5),height:e+"px",width:b+"px"});h.offset({left:0,top:0});j.css({left:0,top:0});d.get("iframeWrapEl").css({height:e-k-l+"px"});!0!==a&&arguments.callee.call(this,!0)},_real:function(){var c=this,d=c.editor;c._resize||(c._saveEditorStatus(),c._saveSate(),c._maximize(),c._resize||(c._resize=
h.buffer(function(){c._maximize();d.fire("maximizeWindow")},100)),a.on(window,"resize",c._resize),setTimeout(function(){c._restoreEditorStatus();d.notifySelectionChange();d.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(j||(j=(new k("<iframe  class='ke-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(c.body,void 0)),this._real())},destroy:function(){this._resize&&(a.remove(window,"resize",this._resize),
this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var c=new l(a);a.addCommand("maximizeWindow",{exec:function(){c.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){c.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(h,i,l){return{init:function(d){l.init(d);d.addButton({title:"\u5168\u5c4f",contentCls:"ke-toolbar-maximize"},{onClick:function(){d.execCommand("restoreWindow");this.boff();this.set("title","\u5168\u5c4f");this.set("contentCls","ke-toolbar-maximize")},offClick:function(){d.execCommand("maximizeWindow");this.bon();this.set("title","\u53d6\u6d88\u5168\u5c4f");this.set("contentCls","ke-toolbar-restore")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/multipleUpload/index",function(h,i,l){return{init:function(d){d.addButton({contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",mode:i.WYSIWYG_MODE},{offClick:function(){l.useDialog(d,"multipleUpload/dialog")}})}}},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/outdent/cmd",function(h,i,l){var d=l.addCommand,f=l.checkOutdentActive;return{init:function(c){d(c,"outdent");var h=i.Utils.getQueryCmd("outdent");c.hasCommand(h)||c.addCommand(h,{exec:function(a,c){return f(c)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(h,i,l){return{init:function(d){l.init(d);var f=i.Utils.getQueryCmd("outdent");d.addButton({title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:i.WYSIWYG_MODE,contentCls:"ke-toolbar-outdent"},{offClick:function(){d.execCommand("outdent")},selectionChange:function(c){d.execCommand(f,c.path)?this.enable():this.disable()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/focus",function(h,i){function l(){}var d=h.UA,f=i.focusManager;l.ATTRS={focus4e:{value:!0}};l.prototype={_uiSetFocus4e:function(c){c?(this.on("show",this._show4FocusExt,this),this.on("hide",this._hide4FocusExt,this)):(this.detach("show",this._show4FocusExt,this),this.detach("hide",this._hide4FocusExt,this))},_show4FocusExt:function(){var c=this._focusEditor=f.currentInstance();if(d.ie&&c){window.focus();document.body.focus();var h=c.get("document")[0].selection.createRange();
h&&h.item&&h.item(0).ownerDocument==c.get("document")[0]&&(c=document.body.createTextRange(),c.moveToElementText(this.get("el").first()[0]),c.collapse(!0),c.select())}},_hide4FocusExt:function(){var c=this._focusEditor;c&&c.focus()}};return l},{requires:["editor"]});
KISSY.add("editor/plugin/overlay/index",function(h,i,l,d,f){var c=l.define(d,[f],{},{ATTRS:{prefixCls:{value:"ke-"},zIndex:{value:i.baseZIndex(i.zIndexManager.OVERLAY)}}});c.Dialog=l.define(d.Dialog,[f],{show:function(){this.center();var d=this.get("y");200<d-h.DOM.scrollTop()&&(d=h.DOM.scrollTop()+200,this.set("y",d));c.prototype.show.call(this)}},{ATTRS:{prefixCls:{value:"ke-"},draggable:{value:!0},constrain:{value:!0},aria:{value:!0},zIndex:{value:i.baseZIndex(i.zIndexManager.OVERLAY)}}});return c},
{requires:["editor","component","overlay","./focus","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(h,i,l){var d=h.Node;return{init:function(f){l.init(f);var c=f.htmlDataProcessor;(c&&c.dataFilter).addRules({tags:{div:function(d){var a=d.getAttribute("style"),f;if(a)for(var h=d.childNodes,i=0;i<h.length;i++)1==h[i].nodeType&&(f=h[i]);if((f=f&&"span"==f.nodeName&&f.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(a)&&/display\s*:\s*none/i.test(f))return c.createFakeParserElement(d,"ke_pagebreak","div")}}});f.addButton({title:"\u5206\u9875",mode:i.WYSIWYG_MODE,
contentCls:"ke-toolbar-pagebreak"},{offClick:function(){var c=this.get("editor"),a=new d('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,c.get("document")[0]),a=c.createFakeElement(a,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),f=c.getSelection();if(f=f&&f.getRanges()[0]){c.execCommand("save");for(var h=f.startContainer,i=h;"body"!==h.nodeName();)i=h,h=h.parent();f.collapse(!0);f.splitElement(i);
a.insertAfter(i);c.execCommand("save")}}})}}},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(){var h=window;return{init:function(i){i.addButton({title:"\u9884\u89c8",contentCls:"ke-toolbar-preview"},{offClick:function(){var i=this.get("editor");try{var d=h.screen,f=Math.round(0.8*d.width),c=Math.round(0.7*d.height),k=Math.round(0.1*d.width)}catch(a){f=640,c=420,k=80}i=i.getDocHtml().replace(/\${title}/,"\u9884\u89c8");f=h.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+f+",height="+c+",left="+k);c=f.document;c.open();
c.write(i);c.close();f.focus()}})}}});
KISSY.add("editor/plugin/progressbar/index",function(h){function i(){i.superclass.constructor.apply(this,arguments);this._init()}var l=h.Node;i.ATTRS={container:{},width:{},height:{},progress:{value:0}};h.extend(i,h.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var d=this.get("height"),f=new l("<div class='ke-progressbar'  style='width:"+this.get("width")+";height:"+d+";'></div>"),c=this.get("container"),d=(new l("<div style='overflow:hidden;'><div class='ke-progressbar-inner' style='height:"+(parseInt(d)-
4)+"px'><div class='ke-progressbar-inner-bg'></div></div></div>")).appendTo(f),h=(new l("<span class='ke-progressbar-title'></span>")).appendTo(f);c&&f.appendTo(c);this.el=f;this._title=h;this._p=d;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(d){d=d.newVal;this._p.css("width",d+"%");this._title.html(d+"%")}});return i});
KISSY.add("editor/plugin/removeFormat/cmd",function(h,i){function l(a,c){for(var d=0;d<c.length;d++)a.removeAttr(c[d])}var d=i.RANGE,f=i.ElementPath,c=h.DOM,k="class,style,lang,width,height,align,hspace,valign".split(/,/),a=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(g){g.hasCommand("removeFormat")||g.addCommand("removeFormat",{exec:function(){g.focus();a.lastIndex=0;var h=g.getSelection().getRanges();
g.execCommand("save");for(var i=0,m;m=h[i];i++)if(!m.collapsed){m.enlarge(d.ENLARGE_ELEMENT);var p=m.createBookmark(),e=p.startNode,b=p.endNode,q=function(b){for(var c=new f(b),d=c.elements,e=1,g;(g=d[e])&&!g.equals(c.block)&&!g.equals(c.blockLimit);e++)a.test(g.nodeName())&&b._4e_breakParent(g)};q(e);q(b);for(e=e._4e_nextSourceNode(!0,c.ELEMENT_NODE,void 0,void 0);e&&!e.equals(b);)q=e._4e_nextSourceNode(!1,c.ELEMENT_NODE,void 0,void 0),"img"==e.nodeName()&&e.attr("_ke_realelement")||(a.test(e.nodeName())?
e._4e_remove(!0):l(e,k)),e=q;m.moveToBookmark(p)}g.getSelection().selectRanges(h);g.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(h,i,l){return{init:function(d){l.init(d);d.addButton({title:"\u6e05\u9664\u683c\u5f0f",mode:i.WYSIWYG_MODE,contentCls:"ke-toolbar-removeformat"},{offClick:function(){d.execCommand("removeFormat")}})}}},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(h,i,l){var d=h.Node;return{init:function(f){var c=l.Draggable,i=f.get("statusBarEl");f.get("textarea");var a=(f.get("pluginConfig").resize||{}).direction||["x","y"],g="se-resize";1==a.length&&(g="x"==a[0]?"e-resize":"s-resize");var j=(new d("<div class='ke-resizer' style='cursor: "+g+"'></div>")).appendTo(i);f.on("maximizeWindow",function(){j.css("display","none")});f.on("restoreWindow",function(){j.css("display","")});var n=new c({node:j}),m=0,p=0,
e=f.get("el"),b=f.get("el");n.on("dragstart",function(){m=e.height();p=b.width();f.fire("resizeStart")});n.on("drag",function(b){var c=b.left-this.startNodePos.left,b=b.top-this.startNodePos.top;h.inArray("y",a)&&f.set("height",m+b);h.inArray("x",a)&&f.set("width",p+c);f.fire("resize")});f.on("destroy",function(){n.destroy();j.remove()})}}},{requires:["editor","dd"]});
KISSY.add("editor/plugin/select/index",function(h,i,l,d){function f(a){f.superclass.constructor.call(this,a);this._init()}function c(a){return a&&-1==a.indexOf("<")?a:0}var k=h.Node,a=k.all,g=h.Event,j=h.DOM,n=i.XHTML_DTD;f.DISABLED=0;f.ENABLED=1;f.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},popUpWidth:{},title:{},items:{},emptyText:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var c=this.el.parent();c;){var b=c.nodeName();if(n[b]&&n[b].div)return c;c=
c.parent()}return a(document.body)}},state:{value:1}};f.decorate=function(a){var b=a.width(),c=[];a.all("option").each(function(a){c.push({name:a.html(),value:a.val()})});return new f({width:b+"px",title:a.attr("title"),el:a,items:c,cls:"ke-combox",value:a.val()})};var m=i.Utils.addRes,p=i.Utils.destroyRes;h.extend(f,h.Base,{_init:function(){var e=this,b=e.get("container"),f=e.get("el"),g=a("<span class='ke-select-wrap'><a class='ke-select'  hidefocus='hidefocus' tabindex='0'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
h=g.one("a"),j=e.get("title")||"",k=e.get("cls"),l=g.one(".ke-select-text"),m=g.one(".ke-select-text-inner");g.one(".ke-select-drop");e.get("value")!==d?m.html(e._findNameByV(e.get("value"))):m.html(j);g.unselectable(d);l.css("width",e.get("width"));j&&g.attr("title",j);h.attr("href","javascript:void('"+c(j)+"')");k&&g.addClass(k,d);f?f[0].parentNode.replaceChild(g[0],f[0]):b&&g.appendTo(b,d);g.on("click",e._click,e);g.on("keydown",e._keydown,e);e.el=g;e.title=m;e._focusA=g.one("a.ke-select");e._focusA.on("blur",
function(){e.menu&&e.menu.hide()});i.Utils.lazyRun(this,"_prepare","_real");e.on("afterValueChange",e._valueChange,e);e.on("afterStateChange",e._stateChange,e)},_keydown:function(c){var b;switch(c.keyCode){case g.KeyCodes.DOWN:c.halt();if(!this._isShown()){this._click();this._findCurrent()||a(this.as[0]).addClass("ke-menu-selected",d);break}c=a(this._findCurrent());c.removeClass("ke-menu-selected",d);(b=c.next())?b.addClass("ke-menu-selected",d):a(this.as[0]).addClass("ke-menu-selected",d);break;
case g.KeyCodes.UP:c.halt();if(!this._isShown())break;c=a(this._findCurrent());c.removeClass("ke-menu-selected",d);(b=c.prev(d,d))?b.addClass("ke-menu-selected",d):a(this.as[this.as.length-1]).addClass("ke-menu-selected",d);break;case g.KeyCodes.ENTER:c.halt();if(!this._isShown()){this._click();this._findCurrent()||a(this.as[0]).addClass("ke-menu-selected",d);break}c=a(this._findCurrent());if(!c)break;this._select({target:c});break;case g.KeyCodes.ESC:c.halt();if(!this._isShown())break;this.menu.hide()}},
_findCurrent:function(){var a=d;this.as.each(function(b){if(b.hasClass("ke-menu-selected",d))return a=b,!1});return a},_isShown:function(){return this.menu&&this.menu.get("visible")},_findNameByV:function(a){var b=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return a||b;h.each(c,function(c){if(c.value==a)return b=c.name,!1});return b},_valueChange:function(a){this.title.html(this._findNameByV(a.newVal))},_itemsChange:function(e){var b,e=e.newVal,f=this._selectList;f.html("");
if(e&&e.length)for(b=0;b<e.length;b++){var g=e[b];(new k(h.substitute("<a class='ke-select-menu-item' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:c(g.name),value:g.value,name:g.name}),g.attrs)).unselectable(d).appendTo(f,d)}else(b=this.get("emptyText"))&&a(h.substitute("<a class='ke-select-menu-item' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:c(b),value:"",name:b})).appendTo(f,d);this.as=f.all("a")},val:function(a){return a!==
d?(this.set("value",a),this):this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var c=this,b=c.el,f=c._focusA,h=c.get("popUpWidth"),h=new l({autoRender:!0,render:c.get("menuContainer"),content:"<div>",elCls:"ke-menu",width:h?h:b.width(),zIndex:i.baseZIndex(i.zIndexManager.SELECT)}),j=c.get("items");h.on("hide",function(){f.removeClass("ke-select-active",d)});h.on("show",function(){f.addClass("ke-select-active",d)});m.call(c,h);b=h.get("contentEl").one("div");
c.menu=h;h.get("el").on("mousedown",function(a){a.halt()});g.on(window,"resize",c._resize,c);m.call(c,function(){g.remove(window,"resize",c._resize,c)});c.get("title")&&a("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+c.get("title")+"</div>").appendTo(b,d);c._selectList=a("<div>").appendTo(b,d);c._itemsChange({newVal:j});b.on("click",c._select,c);c.as=c._selectList.all("a");b.on("mouseenter",function(){c.as.removeClass("ke-menu-selected",d)});m.call(c,b);c.on("afterItemsChange",
c._itemsChange,c);c.menuNode=b},_stateChange:function(a){var b=this.el;1==a.newVal?b.removeClass("ke-select-disabled",d):b.addClass("ke-select-disabled",d)},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(c){c&&c.halt&&c.halt();var b=this.menu,f=this.menuNode;if((c=a(c.target).closest(function(a){return j.contains(f,a)&&"a"==j.nodeName(a)},d))&&c.attr("data-value")){var g=this.get("value"),h=c.attr("data-value");this.set("value",h);this.fire("click",
{newVal:h,prevVal:g,name:c.html()});b.hide()}},_real:function(){var a=this.el,b=a.offset(),c=h.clone(b),d=this.menu.get("el").height(),f=this.menu.get("el").width(),g=j.scrollTop(),i=j.scrollLeft(),k=j.viewportHeight(),l=j.viewportWidth(),l=i+l-60,k=g+k,m=b.top+(a.height()-2),a=b.left+a.width()-2,n=this.get("align"),p=n[0];"b"==n[1]?(b.top=m,b.top+d>k&&c.top-g>k-m&&(b.top=c.top-d)):(b.top=c.top-d,b.top<g&&c.top-g<k-m&&(b.top=m));"l"==p?b.left+f>l&&a-i>l-c.left&&(b.left=a-f):(b.left=a-f,b.left<i&&
a-i<l-c.left&&(b.left=c.left));this.menu.set("xy",[b.left,b.top]);this.menu.show()},_click:function(a){a&&a.halt();var a=this.el,b=this.menu,c=this.get("value");if(b&&b.get("visible"))b.hide();else{this._focusA[0].focus();if(a.hasClass("ke-select-disabled",d))return!1;this.fire("select");this._prepare();c&&b&&this.as.each(function(a){a.attr("data-value")==c?a.addClass("ke-menu-selected",d):a.removeClass("ke-menu-selected",d)})}},destroy:function(){p.call(this);this.el.remove()}});i.prototype.addSelect=
function(a,b,c){var c=c||f,d=this;a.editor=d;var g=new c(h.mix({container:d.get("toolBarEl"),doc:d.get("document")[0]},a));h.mix(g,b);d.on("selectionChange",function(){d.get("mode")!=i.SOURCE_MODE&&g.selectionChange&&g.selectionChange.apply(g,arguments)});d.on("destroy",function(){g.destroy()});g.on("click",function(a){var b=a.type;g[b]&&g[b].apply(g,arguments);a.halt()});a.mode==i.WYSIWYG_MODE&&(d.on("wysiwygMode",g.enable,g),d.on("sourceMode",g.disable,g));g.init&&g.init();return g};return f},{requires:["editor",
"overlay"]});KISSY.add("editor/plugin/separator/index",function(h){return{init:function(i){var l=(new h.Node('<span class="ke-toolbar-separator">&nbsp;</span>')).appendTo(i.get("toolBarEl"));i.on("destroy",function(){l.remove()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(h,i,l){for(var d="<div class='ke-smiley-sprite'>",f=0;98>=f;f++)d+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+f+".gif'></a>";d+="</div>";return{init:function(c){c.addButton({contentCls:"ke-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",keepFocus:!1,mode:i.WYSIWYG_MODE},{init:function(){var c=this;c.get("el").on("blur",function(){c.smiley&&setTimeout(function(){c.smiley.hide()},100)})},offClick:function(){this.smiley||(this.smiley=
new l({content:d,focus4e:!1,width:"297px",autoRender:!0,elCls:"ke-popup",zIndex:i.baseZIndex(i.zIndexManager.POPUP_MENU),mask:!1}),this.smiley.get("el").on("click",function(d){var d=new h.Node(d.target),a;if("a"==d.nodeName()&&(a=d.attr("data-icon")))a=new h.Node("<img alt='' src='"+a+"'/>",null,c.get("document")[0]),c.insertElement(a)}));this.smiley.set("align",{node:this.get("el"),points:["bl","tl"]});this.smiley.show()},onClick:function(){this.smiley.hide()},destructor:function(){this.smiley&&
this.smiley.destroy()}})}}},{requires:["editor","../overlay/"]});KISSY.add("editor/plugin/sourceArea/index",function(h,i){var l=i.SOURCE_MODE,d=i.WYSIWYG_MODE;return{init:function(f){f.addButton({title:"\u6e90\u7801",contentCls:"ke-toolbar-source"},{init:function(){f.on("wysiwygMode",this.boff,this);f.on("sourceMode",this.bon,this)},offClick:function(){f.set("mode",l)},onClick:function(){f.set("mode",d)}})}}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(h,i,l){var d=new i.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(f){l.addButtonCmd(f,"strikeThrough",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"strikeThrough",contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(h,i,l,d){function f(a){function c(a){!(0<f.length)&&a[0].nodeType==b.ELEMENT_NODE&&u.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(g,"selected_cell",!0,void 0),f.push(a))}for(var d=a.createBookmarks(),e=a.getRanges(),f=[],g={},h=0;h<e.length;h++){var j=e[h];if(j.collapsed)j=j.getCommonAncestor(),(j=j.closest("td",void 0)||j.closest("th",void 0))&&f.push(j);else{var j=new Walker(j),k;for(j.guard=c;k=j.next();)if((k=k.parent())&&u.test(k.nodeName())&&
!k.data("selected_cell"))k._4e_setMarker(g,"selected_cell",!0,void 0),f.push(k)}}i.Utils.clearAllMarkers(g);a.selectBookmarks(d);return f}function c(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",e.ie||(new q(c[d]))._4e_appendBogus(void 0)}}function k(a){if(a instanceof i.Selection){for(var b=f(a),c=b.length,a=[],d,e,g=0;g<c;g++){var h=b[g].parent(),j=h[0].rowIndex;!g&&(d=j-1);a[j]=h;g==c-1&&(e=j+
1)}g=h.parent("table");d=new q(e<g[0].rows.length&&g[0].rows[e]||0<d&&g[0].rows[d]||g[0].parentNode);for(g=a.length;0<=g;g--)a[g]&&k(a[g]);return d}a instanceof q&&(g=a.parent("table"),1==g[0].rows.length?g.remove():a.remove());return 0}function a(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),f=c[0].cellIndex,g=0;g<d[0].rows.length;g++){var h=d[0].rows[g];h.cells.length<f+1||(c=new q(h.cells[f].cloneNode(void 0)),e.ie||c._4e_appendBogus(void 0),
h=new q(h.cells[f]),b?c.insertBefore(h):c.insertAfter(h))}}function g(a){if(a instanceof i.Selection){var b=f(a),c,d=[],a=b[0]&&b[0].parent("table"),e,h,j;e=0;for(h=b.length;e<h;e++)d.push(b[e][0].cellIndex);d.sort();e=1;for(h=d.length;e<h;e++)if(1<d[e]-d[e-1]){j=d[e-1]+1;break}j||(j=0<d[0]?d[0]-1:d[d.length-1]+1);d=a[0].rows;e=0;for(h=d.length;e<h&&!(c=d[e].cells[j]);e++);c=c?new q(c):a.prev();for(j=b.length-1;0<=j;j--)b[j]&&g(b[j]);return c}if(a instanceof q){b=a.parent("table");if(!b)return null;
c=a[0].cellIndex;for(j=b[0].rows.length-1;0<=j;j--)a=new q(b[0].rows[j]),!c&&1==a[0].cells.length?k(a):a[0].cells[c]&&a[0].removeChild(a[0].cells[c])}return null}function j(a,b){var c=new i.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function n(a){var c=(a=a.getSelection())&&a.getStartElement(),d=c&&c.closest("table",void 0);if(d)return a=c.closest(function(a){var c=b.nodeName(a);return d.contains(a)&&("td"==
c||"th"==c)},void 0),c=c.closest(function(a){var c=b.nodeName(a);return d.contains(a)&&"tr"==c},void 0),{table:d,td:a,tr:c}}function m(a){return(a=n(a))&&a.td}function p(a){return(a=n(a))&&a.tr}var e=h.UA,b=h.DOM,q=h.Node,o=["tr","th","td","tbody","table"],u=/^(?:td|th)$/,v={"\u8868\u683c\u5c5e\u6027":n,"\u5220\u9664\u8868\u683c":m,"\u5220\u9664\u5217":m,"\u5220\u9664\u884c":p,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":p,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":p,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":m,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":m},t=(6===e.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),r={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},x={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=h.trim(b.replace("ke_show_border","")))}}};return{init:function(e){e.addCustomStyle(t);var f=e.htmlDataProcessor,m=f&&f.htmlFilter;(f&&f.dataFilter).addRules(r);m.addRules(x);d.register({editor:e,filter:function(a){if(h.inArray(b.nodeName(a),o))return!0},statusChecker:v,
width:"120px",handlers:{"\u8868\u683c\u5c5e\u6027":function(){var a=n(e);a&&l.useDialog(e,"table/dialog",{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){var a=e.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){var a=e.getSelection();j(k(a),void 0)},"\u5220\u9664\u5217 ":function(){var a=e.getSelection();
(a=g(a))&&j(a,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){var a=e.getSelection();c(a,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){var a=e.getSelection();c(a,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){var b=e.getSelection();a(b,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){var b=e.getSelection();a(b,void 0)}}});e.addButton({contentCls:"ke-toolbar-table",mode:i.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c"},{offClick:function(){l.useDialog(e,"table/dialog",{selectedTable:0,selectedTd:0})}})}}},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(h,i,l){var d=new i.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(f){l.addButtonCmd(f,"underline",d)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({cmdType:"underline",contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf "},void 0,l.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(h,i,l){function d(){this.get("editor").on("afterSave afterRestore",this._respond,this);this.disable()}function f(){f.superclass.constructor.apply(this,arguments);d.call(this)}function c(){c.superclass.constructor.apply(this,arguments);d.call(this)}h.extend(f,l,{offClick:function(){this.get("editor").execCommand("undo")},_respond:function(c){0<c.index?this.boff():this.disable()}});h.extend(c,l,{offClick:function(){this.get("editor").execCommand("redo")},
_respond:function(c){c.index<c.history.length-1?this.boff():this.disable()}});return{RedoBtn:c,UndoBtn:f}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(h,i){function l(a){var c=a.get("document")[0].body.innerHTML,d;c&&(d=a.getSelection());this.contents=c;this.bookmarks=d&&d.createBookmarks2(!0)}function d(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=h.buffer(this.save,500,this);this._init()}var f=i.Utils.arrayCompare,c=h.UA;h.augment(l,{equals:function(a){if(this.contents!=a.contents)return!1;var c=this.bookmarks,a=a.bookmarks;if(c||a){if(!c||!a||c.length!=a.length)return!1;for(var d=
0;d<c.length;d++){var h=c[d],i=a[d];if(h.startOffset!=i.startOffset||h.endOffset!=i.endOffset||!f(h.start,i.start)||!f(h.end,i.end))return!1}}return!0}});var k={16:1,17:1,18:1},a={37:1,38:1,39:1,40:1,33:1,34:1};h.augment(d,{_keyMonitor:function(){var c=this,d=c.editor;d.get("document").on("keydown",function(f){var h=f.keyCode;h in a||h in k||(90===h&&(f.ctrlKey||f.metaKey)?(!1!==d.fire("restore",{direction:-1})&&c.restore(-1),f.halt()):89===h&&(f.ctrlKey||f.metaKey)?(!1!==d.fire("restore",{direction:1})&&
c.restore(1),f.halt()):!1!==d.fire("save",{buffer:1})&&c.save(1))})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){if(this.editor.get("mode")==i.WYSIWYG_MODE)if(a)this.bufferRunner();else{var a=this.history,c=this.index;a.length>c+1&&a.splice(c+1,a.length-c-1);var d=this.editor,c=a[a.length-1],f=new l(d);if(!c||!c.equals(f))30===a.length&&a.shift(),a.push(f),this.index=c=a.length-1,d.fire("afterSave",{history:a,index:c})}},restore:function(a){if(this.editor.get("mode")==
i.WYSIWYG_MODE){var d=this.history,f=this.editor,h=f.get("document")[0].body,k=d[this.index+a];k&&(h.innerHTML=k.contents,k.bookmarks?f.getSelection().selectBookmarks(k.bookmarks):c.ie&&(h=h.createTextRange(),h.collapse(!0),h.select()),(h=f.getSelection())&&h.scrollIntoView(),this.index+=a,f.fire("afterRestore",{history:d,index:this.index}),f.notifySelectionChange());return k}}});return{init:function(a){if(!a.hasCommand("save")){var c=new d(a);a.addCommand("save",{exec:function(a,d){c.save(d)}});
a.addCommand("undo",{exec:function(){c.restore(-1)}});a.addCommand("redo",{exec:function(){c.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(h,i,l,d){return{init:function(f){d.init(f);f.addButton({mode:i.WYSIWYG_MODE,title:"\u64a4\u9500",editor:f,contentCls:"ke-toolbar-undo"},void 0,l.UndoBtn);f.addButton({mode:i.WYSIWYG_MODE,title:"\u91cd\u505a",editor:f,contentCls:"ke-toolbar-redo"},void 0,l.RedoBtn)}}},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(h,i,l,d){return{init:function(f){function c(a){for(var c=0;c<g.length;c++){var d=g[c];if(d.reg.test(a))return d}}var h=f.htmlDataProcessor,a=h&&h.dataFilter,g=[],j=f.get("pluginConfig");j.video=j.video||{};j=j.video;j.providers&&g.push.apply(g,j.providers);j.getProvider=c;a&&a.addRules({elements:{object:function(a){var d=a.getAttribute("classid"),e=a.childNodes;if(!d){for(d=0;d<e.length;d++)if("embed"==e[d].name){if(!l.isFlashEmbed(e[d]))break;if(c(e[d].getAttribute("src")))return h.createFakeParserElement(a,
"ke_video","video",!0)}return null}for(d=0;d<e.length;d++){var b=e[d];if("param"==b.nodeName&&"movie"==b.getAttribute("name").toLowerCase()&&c(b.getAttribute("value")))return h.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!l.isFlashEmbed(a))return null;if(c(a.getAttribute("src")))return h.createFakeParserElement(a,"ke_video","video",!0)}}},4);var n=new d({editor:f,cls:"ke_video",type:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.selectedEl;a&&n.show(a)}}});f.addButton({contentCls:"ke-toolbar-video",
title:"\u63d2\u5165\u89c6\u9891",mode:i.WYSIWYG_MODE},{offClick:function(){n.show()}})}}},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(h,i,l,d){function f(){f.superclass.constructor.apply(this,arguments)}h.extend(f,l,{_updateTip:function(c,d){var a=this.get("editor").restoreRealElement(d);a&&(c.html(d.attr("title")),c.attr("href",this._getFlashUrl(a)))}});return{init:function(c){function h(a){return/xiami\.com/i.test(a)}var a=c.htmlDataProcessor,g=a&&a.dataFilter;g&&g.addRules({tags:{object:function(c){var f=c.getAttribute("title"),g,e;g=c.getAttribute("classid");var b=c.childNodes;
if(!g){for(g=0;g<b.length;g++)if(e=b[g],"embed"==e.nodeName){if(!d.isFlashEmbed(e))break;if(h(e.attributes.src))return a.createFakeParserElement(c,"ke_xiami","xiamiMusic",!0,{title:f})}return null}for(g=0;g<b.length;g++)if(e=b[g],"param"==e.nodeName&&"movie"==e.getAttribute("name")&&h(e.getAttribute("value")))return a.createFakeParserElement(c,"ke_xiami","xiamiMusic",!0,{title:f})},embed:function(c){if(d.isFlashEmbed(c)&&h(c.getAttribute("src")))return a.createFakeParserElement(c,"ke_xiami","xiamiMusic",
!0,{title:c.getAttribute("title")})}}},4);var j=new f({editor:c,cls:"ke_xiami",type:"xiamiMusic",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.selectedEl;a&&j.show(a)}}});c.addButton({contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",mode:i.WYSIWYG_MODE},{offClick:function(){j.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});KISSY.add("editor/full",function(h,i){return i},{requires:["editor"]});
