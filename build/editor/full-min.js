/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 19 16:41
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(d,f,j){f=j.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:f.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(d){return this._setData(d)}},formatData:{getter:function(){return this._getData(1)},setter:function(d){return this._setData(d)}},customStyle:{value:""},
customLink:{value:[]}}},{xclass:"editor"});f.HTML_PARSER={textarea:function(d){return d.one(".ks-editor-textarea")}};d.mix(f,d.EventTarget);return KISSY.Editor=f},{requires:["htmlparser","component","core"]});
KISSY.add("editor/core/clipboard",function(d,f,j,i){function h(a){this.editor=a;this._init()}function a(a){if(c.ie&&"BackCompat"!=a.get("document")[0].compatMode){var g=a.getSelection(),b;if(g.getType()==i.SELECTION_ELEMENT&&(b=g.getSelectedElement())){var n=g.getRanges()[0],o=e(a.get("document")[0].createTextNode(""));o.insertBefore(b);n.setStartBefore(o);n.setEndAfter(b);g.selectRanges([n]);setTimeout(function(){b.parent()&&(o.remove(),g.selectElement(b))},0)}}}var e=d.all,c=d.UA,b=f.RANGE,m=d.Event;
d.augment(h,{_init:function(){var a=this.editor;m.on(a.get("document")[0].body,c.webkit?"paste":c.gecko?"paste":"beforepaste",this._paste,this);m.on(a.get("document")[0].body,"contextmenu",function(){g=1;setTimeout(function(){g=0},10)});a.addCommand("copy",new p("copy"));a.addCommand("cut",new p("cut"));a.addCommand("paste",new p("paste"))},_paste:function(){if(!g){var a=this.editor,n=a.get("document")[0];if(!n.getElementById("ke_pastebin")){var t=a.getSelection(),s=new j(n),o=e(c.webkit?"<body></body>":
"<div></div>",null,n);o.attr("id","ke_pastebin");c.webkit&&o[0].appendChild(n.createTextNode("\u00a0"));n.body.appendChild(o[0]);o.css({position:"absolute",top:t.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});o.css("left","-1000px");var k=t.createBookmarks();s.setStartAt(o,b.POSITION_AFTER_START);s.setEndAt(o,b.POSITION_BEFORE_END);s.select(!0);setTimeout(function(){o.remove();var g;o=c.webkit&&(g=o.first())&&g.hasClass("Apple-style-span")?g:o;t.selectBookmarks(k);g=o.html();
if(g=d.trim(g.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var b=a.fire("paste",{html:g,holder:o});void 0!==b&&(g=b);b=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(g)&&(b=a.htmlDataProcessor.wordFilter);a.insertHtml(g,b)}},0)}}}});var l=function(a,g){var b=a.get("document")[0],n=e(b.body),o=!1,d=function(){o=!0};n.on(g,d);(7<c.ie?b:b.selection.createRange()).execCommand(g);n.detach(g,d);return o},k=c.ie?function(a,g){return l(a,g)}:function(a,g){try{return a.get("document")[0].execCommand(g)}catch(b){return!1}},
q={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},p=function(a){this.type=a};p.prototype={exec:function(g){"cut"==this.type&&a(g);(g=k(g,this.type))||alert(q[this.type]);return g}};var n={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},g;return{init:function(a){a.docReady(function(){new h(a)});var g={copy:1,cut:1,paste:1};a.on("contextmenu",function(b){b=b.contextmenu;if(!b.__copy_fix){b.__copy_fix=
1;for(var e in g)g.hasOwnProperty(e)&&b.addChild({xclass:"menuitem",content:n[e],value:e});b.on("click",function(b){var e=b.target.get("value");g[e]&&(this.hide(),setTimeout(function(){a.execCommand(e)},30))})}})}}},{requires:["./base","./range","./selection"]});
KISSY.add("editor/core/dom",function(d,f,j){function i(a,g){var c=a[g?"next":"prev"](h,1);if(c&&c[0].nodeType==e.ELEMENT_NODE){for(var d=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemovable(h);)if(d.push(c),c=g?c.next(h,1):c.prev(h,1),!c)return;if(a._4e_isIdentical(c,h)){for(var t=new b(g?a[0].lastChild:a[0].firstChild);d.length;)d.shift()._4e_move(a,!g,h);c._4e_moveChildren(a,!g,h);c.remove();t[0]&&t[0].nodeType==e.ELEMENT_NODE&&t._4e_mergeSiblings()}}}var h=h,a=f.XHTML_DTD,e=d.DOM,c=d.UA,b=d.Node,
m={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};f.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var l=f.POSITION,k={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},q={hr:1},p=function(a){return a&&(a[0]||a)};j.injectDom({_4e_sameLevel:function(a,g){var g=p(g),b=a.parentNode;return b&&b==g.parentNode},_4e_isBlockBoundary:function(a,g){var b=d.merge(q,g);return!(!k[e.css(a,"display")]&&!b[e.nodeName(a)])},_4e_index:function(a,g){for(var b=a.parentNode.childNodes,e,c=-1,s=0;s<b.length;s++)if(e=b[s],!g||!(3==e.nodeType&&e.previousSibling&&3==e.previousSibling.nodeType))if(c++,e===a)return c;return-1},_4e_move:function(a,g,b){g=
p(g);b?g.insertBefore(a,g.firstChild):g.appendChild(a)},_4e_isIdentical:function(a,g){if(!g)return!1;g=p(g);if(e.nodeName(a)!=e.nodeName(g))return!1;var b=a.attributes,c=g.attributes,d=b.length,s=c.length;if(d!=s)return!1;for(var o=0;o<d;o++){var k=b[o],m=k.name;if(k.specified&&e.attr(a,m)!=e.attr(g,m))return!1}if(8>j.ieEngine)for(o=0;o<s;o++)if(k=c[o],m=k.name,k.specified&&e.attr(a,m)!=e.attr(g,m))return!1;return!0},_4e_isEmptyInlineRemovable:function(b){if(!a.$removeEmpty[e.nodeName(b)])return!1;
for(var b=b.childNodes,g=0,c=b.length;g<c;g++){var k=b[g],t=k.nodeType;if(!(t==e.ELEMENT_NODE&&k.getAttribute("_ke_bookmark"))&&(t==e.ELEMENT_NODE&&!e._4e_isEmptyInlineRemovable(k)||t==e.TEXT_NODE&&d.trim(k.nodeValue)))return!1}return!0},_4e_moveChildren:function(a,b,e){b=p(b);if(a!=b)if(e)for(;e=a.lastChild;)b.insertBefore(a.removeChild(e),b.firstChild);else for(;e=a.firstChild;)b.appendChild(a.removeChild(e))},_4e_mergeSiblings:function(a){a=new b(a);m[a.nodeName()]&&(i(a,!0),i(a))},_4e_splitText:function(a,
b){var d=a.ownerDocument;if(a.nodeType==e.TEXT_NODE){if(c.ie&&b==a.nodeValue.length){var k=d.createTextNode("");e.insertAfter(k,a);return k}k=a.splitText(b);d.documentMode&&(d=d.createTextNode(""),e.insertAfter(d,k),e.remove(d));return k}},_4e_parents:function(a,b){var e=[];e.__IS_NODELIST=1;do e[b?"push":"unshift"](a);while(a=a.parentNode);return e},_4e_nextSourceNode:function(a,b,c,d){if(d&&!d.call)var t=p(d),d=function(a){return a!==t};var b=!b&&a.firstChild,s=a;if(!b){if(a.nodeType==e.ELEMENT_NODE&&
d&&!1===d(a,!0))return null;b=a.nextSibling}for(;!b&&(s=s.parentNode);){if(d&&!1===d(s,!0))return null;b=s.nextSibling}return!b||d&&!1===d(b)?null:c&&c!=b.nodeType?e._4e_nextSourceNode(b,!1,c,d):b},_4e_previousSourceNode:function(a,b,c,d){if(d&&!d.call)var t=p(d),d=function(a){return a!==t};var b=!b&&a.lastChild,s=a;if(!b){if(a.nodeType==e.ELEMENT_NODE&&d&&!1===d(a,!0))return null;b=a.previousSibling}for(;!b&&(s=s.parentNode);){if(d&&!1===d(s,!0))return null;b=s.previousSibling}return!b||d&&!1===
d(b)?null:c&&b.nodeType!=c?e._4e_previousSourceNode(b,!1,c,d):b},_4e_commonAncestor:function(a,b){b=p(b);if(a===b)return a;if(e.contains(b,a))return b;var c=a;do if(e.contains(c,b))return c;while(c=c.parentNode);return null},_4e_hasAttributes:9>j.ieEngine?function(a){for(var b=a.attributes,e=0;e<b.length;e++){var c=b[e];switch(c.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(a){c.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,b){var c=p(b);if(a.compareDocumentPosition)return a.compareDocumentPosition(c);if(a==c)return l.POSITION_IDENTICAL;if(a.nodeType==e.ELEMENT_NODE&&c.nodeType==e.ELEMENT_NODE){if(e.contains(a,c))return l.POSITION_CONTAINS+l.POSITION_PRECEDING;if(e.contains(c,a))return l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>c.sourceIndex?l.POSITION_DISCONNECTED:a.sourceIndex<c.sourceIndex?l.POSITION_PRECEDING:l.POSITION_FOLLOWING}for(var d=
e._4e_address(a),c=e._4e_address(c),t=Math.min(d.length,c.length),s=0;s<=t-1;s++)if(d[s]!=c[s])return d[s]<c[s]?l.POSITION_PRECEDING:l.POSITION_FOLLOWING;return d.length<c.length?l.POSITION_CONTAINS+l.POSITION_PRECEDING:l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING},_4e_address:function(a,b){for(var c=[],d=a.ownerDocument.documentElement,t=a;t&&t!=d;)c.unshift(e._4e_index(t,b)),t=t.parentNode;return c},_4e_remove:function(a,b){var e=a.parentNode;if(e){if(b)for(var c;c=a.firstChild;)e.insertBefore(a.removeChild(c),
a);e.removeChild(a)}return a},_4e_trim:function(a){e._4e_ltrim(a);e._4e_rtrim(a)},_4e_ltrim:function(a){for(var b;b=a.firstChild;){if(b.nodeType==e.TEXT_NODE){var c=j.ltrim(b.nodeValue),d=b.nodeValue.length;if(c)c.length<d&&(e._4e_splitText(b,d-c.length),a.removeChild(a.firstChild));else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){for(var b;b=a.lastChild;){if(b.type==e.TEXT_NODE){var d=j.rtrim(b.nodeValue),k=b.nodeValue.length;if(d)d.length<k&&(e._4e_splitText(b,d.length),a.removeChild(a.lastChild));
else{a.removeChild(b);continue}}break}!c.ie&&!c.opera&&(b=a.lastChild)&&1==b.nodeType&&"br"==e.nodeName(b)&&a.removeChild(b)},_4e_appendBogus:function(a){for(var b=a.lastChild;b&&b.nodeType==e.TEXT_NODE&&!d.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==e.TEXT_NODE||"br"!==e.nodeName(b))b=c.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br"),c.gecko&&b.setAttribute("type","_moz"),a.appendChild(b)},_4e_outerHtml:function(a){if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,
"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML},_4e_setMarker:function(a,c,e,k){var a=new b(a),t=a.data("list_marker_id")||a.data("list_marker_id",d.guid()).data("list_marker_id"),s=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");c[t]=a;s[e]=1;return a.data(e,k)},_4e_clearMarkers:function(a,c,e){var a=new b(a),d=a.data("list_marker_names"),k=a.data("list_marker_id"),s;for(s in d)d.hasOwnProperty(s)&&a.removeData(s);
a.removeData("list_marker_names");e&&(a.removeData("list_marker_id"),delete c[k])},_4e_copyAttributes:function(a,d,k){for(var d=new b(d),m=a.attributes,k=k||{},t=0;t<m.length;t++){var s=m[t],o=s.name.toLowerCase(),h;if(!(o in k))if("checked"==o&&(h=e.attr(a,o)))d.attr(o,h);else if(s.specified||c.ie&&s.value&&"value"==o)h=e.attr(a,o),null===h&&(h=s.nodeValue),d.attr(o,h)}""!==a.style.cssText&&(d[0].style.cssText=a.style.cssText)},_4e_isEditable:function(b){b=e.nodeName(b);return(b=!a.$nonEditable[b]&&
(a[b]||a.span))&&b["#"]},_4e_getByAddress:function(a,b,c){for(var a=a.documentElement,e=0;a&&e<b.length;e++){var d=b[e];if(c)for(var s=-1,o=0;o<a.childNodes.length;o++){var k=a.childNodes[o];if(!(!0===c&&3==k.nodeType&&k.previousSibling&&3==k.previousSibling.nodeType)&&(s++,s==d)){a=k;break}}else a=a.childNodes[d]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(d){function f(a){1>arguments.length||(this.range=a,this.forceBrBreak=i,this.enlargeBr=j,this.enforceRealBlocks=i,this._||(this._={}))}var j=!0,i=!1,h=d.Editor,a=d.UA,e=h.Walker,c=h.Range,b=h.RANGE,m=h.ElementPath,l=d.Node,k=d.DOM,q=/^[\r\n\t ]*$/;d.augment(f,{getNextParagraph:function(h){var f,g,r,w,t;if(!this._.lastNode){g=this.range.clone();g.shrink(b.SHRINK_ELEMENT,j);g.enlarge(this.forceBrBreak||!this.enlargeBr?b.ENLARGE_LIST_ITEM_CONTENTS:b.ENLARGE_BLOCK_CONTENTS);
var s=new e(g),o=e.bookmark(j,j);s.evaluator=o;this._.nextNode=s.next();s=new e(g);s.evaluator=o;s=s.previous();this._.lastNode=s._4e_nextSourceNode(j);this._.lastNode&&this._.lastNode[0].nodeType==k.TEXT_NODE&&!d.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(o=new c(g.document),o.moveToPosition(this._.lastNode,b.POSITION_AFTER_END),o.checkEndOfBlock()&&(o=new m(o.endContainer),this._.lastNode=(o.block||o.blockLimit)._4e_nextSourceNode(j)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new l(g.document.createTextNode("")),k.insertAfter(this._.lastNode[0],s[0]));g=null}o=this._.nextNode;s=this._.lastNode;for(this._.nextNode=null;o;){var y=i,v=o[0].nodeType!=k.ELEMENT_NODE,x=i;if(v)o[0].nodeType==k.TEXT_NODE&&q.test(o[0].nodeValue)&&(v=i);else{var u=o.nodeName();if(o._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==u)v=j;else if(!g&&!o[0].childNodes.length&&"hr"!=u){f=o;r=o.equals(s);break}g&&(g.setEndAt(o,b.POSITION_BEFORE_START),"br"!=
u&&(this._.nextNode=o));y=j}else{if(o[0].firstChild){g||(g=new c(this.range.document),g.setStartAt(o,b.POSITION_BEFORE_START));o=new l(o[0].firstChild);continue}v=j}}v&&!g&&(g=new c(this.range.document),g.setStartAt(o,b.POSITION_BEFORE_START));r=(!y||v)&&o.equals(s);if(g&&!y)for(;!o[0].nextSibling&&!r;){u=o.parent();if(u._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){y=j;r||u.equals(s);break}o=u;v=j;r=o.equals(s);x=j}v&&g.setEndAt(o,b.POSITION_AFTER_END);o=o._4e_nextSourceNode(x,null,s);if((r=!o)||
y&&g)break}if(!f){if(!g)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;f=new m(g.startContainer);o=f.blockLimit;y={div:1,th:1,td:1};f=f.block;if((!f||!f[0])&&!this.enforceRealBlocks&&y[o.nodeName()]&&g.checkStartOfBlock()&&g.checkEndOfBlock())f=o;else if(!f||this.enforceRealBlocks&&"li"==f.nodeName())f=new l(this.range.document.createElement(h||"p")),f[0].appendChild(g.extractContents()),f._4e_trim(),g.insertNode(f),w=t=j;else if("li"!=f.nodeName()){if(!g.checkStartOfBlock()||
!g.checkEndOfBlock())f=f.clone(i),f[0].appendChild(g.extractContents()),f._4e_trim(),t=g.splitBlock(),w=!t.wasStartOfBlock,t=!t.wasEndOfBlock,g.insertNode(f)}else r||(this._.nextNode=f.equals(s)?null:g.getBoundaryNodes().endNode._4e_nextSourceNode(j,null,s))}w&&(g=new l(f[0].previousSibling),g[0]&&g[0].nodeType==k.ELEMENT_NODE&&("br"==g.nodeName()?g._4e_remove():g[0].lastChild&&"br"==k.nodeName(g[0].lastChild)&&k._4e_remove(g[0].lastChild)));t&&(g=e.bookmark(i,j),w=new l(f[0].lastChild),w[0]&&w[0].nodeType==
k.ELEMENT_NODE&&"br"==w.nodeName()&&(a.ie||w.prev(g,1)||w.next(g,1))&&w.remove());this._.nextNode||(this._.nextNode=r||f.equals(s)?null:f._4e_nextSourceNode(j,null,s));return f}});c.prototype.createIterator=function(){return new f(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(d){function f(b){for(var d=a,f=a,k=[];b;){if(b[0].nodeType==i.ELEMENT_NODE){this.lastElement||(this.lastElement=b);var q=b.nodeName();if(!f&&(!d&&e[q]&&(d=b),c[q])){var j;if(j=!d)if(j="div"==q){a:{j=b[0].childNodes;for(var n=0,g=j.length;n<g;n++){var r=j[n];if(r.nodeType==i.ELEMENT_NODE&&h.$block[r.nodeName.toLowerCase()]){j=!0;break a}}j=!1}j=!j}j?d=b:f=b}k.push(b);if("body"==q)break}b=b.parent()}this.block=d;this.blockLimit=f;this.elements=k}var j=d.Editor,
i=d.DOM,h=j.XHTML_DTD,a=null,e={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},c={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};f.prototype={compare:function(a){var c=this.elements,a=a&&a.elements;if(!a||c.length!=a.length)return!1;for(var e=0;e<c.length;e++)if(!i.equals(c[e],a[e]))return!1;return!0},contains:function(b){for(var e=this.elements,c=0;c<e.length;c++)if(e[c].nodeName()in b)return e[c];return a},toString:function(){var a=this.elements,
c,e=[];for(c=0;c<a.length;c++)e.push(a[c].nodeName());return e.toString()}};return j.ElementPath=f},{requires:["./base","./dom"]});
KISSY.add("editor/core/enterKey",function(d,f,j,i){function h(a){var f;f=a.getSelection().getRanges();for(var h=f.length-1;0<h;h--)f[h].deleteContents();f=f[0];h=f.document;if(f.checkStartOfBlock()&&f.checkEndOfBlock()){var l=(new i(f.startContainer)).block;if(l&&("li"==l.nodeName()||"li"==l.parent().nodeName()))return a.hasCommand("outdent")?(a.execCommand("save"),a.execCommand("outdent"),a.execCommand("save"),!0):!1}var g=f.splitBlock("p");if(!g)return!0;var a=g.previousBlock,l=g.nextBlock,r=g.wasStartOfBlock,
w=g.wasEndOfBlock,t;if(l)t=l.parent(),"li"==t.nodeName()&&(l._4e_breakParent(t),l._4e_move(l.next(),!0));else if(a&&(t=a.parent())&&"li"==t.nodeName())a._4e_breakParent(t),f.moveToElementEditablePosition(a.next()),a._4e_move(a.prev());if(!r&&!w){if("li"==l.nodeName()&&(t=l.first(j.invisible(!0)))&&d.inArray(t.nodeName(),["ul","ol"]))(e.ie?new m(h.createTextNode("\u00a0")):new m(h.createElement("br"))).insertBefore(t);l&&f.moveToElementEditablePosition(l)}else{var s;if(a){if("li"==a.nodeName()||!c.test(a.nodeName()))s=
a.clone()}else l&&(s=l.clone());s||(s=new m("<p>",null,h));if(t=g.elementPath)for(var g=0,o=t.elements.length;g<o;g++){var y=t.elements[g];if(y.equals(t.block)||y.equals(t.blockLimit))break;b.$removeEmpty[y.nodeName()]&&(y=y.clone(),s._4e_moveChildren(y),s.append(y))}e.ie||s._4e_appendBogus();f.insertNode(s);if(e.ie&&r&&(!w||!a[0].childNodes.length))f.moveToElementEditablePosition(w?a:s),f.select();f.moveToElementEditablePosition(r&&!w?l:s)}e.ie||(l?(s=new m(h.createElement("span")),s.html("&nbsp;"),
f.insertNode(s),s.scrollIntoView(void 0,!1),f.deleteContents()):s.scrollIntoView(void 0,!1));f.select();return!0}function a(a){var b=a.get("document")[0];l.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var c=a.execCommand("enterBlock");a.execCommand("save");!1!==c&&b.preventDefault()}})}var e=d.UA,c=/^h[1-6]$/,b=f.XHTML_DTD,m=d.Node,l=d.Event;return{init:function(b){b.addCommand("enterBlock",{exec:h});b.docReady(function(){a(b)})}}},{requires:["./base",
"./walker","./elementPath"]});
KISSY.add("editor/core/focusManager",function(d){function f(){var a=this;a.__iframeFocus=m;b=a;c&&clearTimeout(c);c=setTimeout(function(){a.fire("focus")},100)}function j(){var a=this;a.__iframeFocus=l;b=k;c&&clearTimeout(c);c=setTimeout(function(){a.fire("blur")},100)}var i=d.Editor,h=d.DOM,a=d.Event,e={},c,b,d={refreshAll:function(){for(var a in e)if(e.hasOwnProperty(a)){var b=e[a].get("document")[0];b.designMode="off";b.designMode="on"}},currentInstance:function(){return b},getInstance:function(a){return e[a]},
add:function(b){var c=h._getWin(b.get("document")[0]);a.on(c,"focus",f,b);a.on(c,"blur",j,b)},register:function(a){e[a._UUID]=a},remove:function(b){delete e[b._UUID];var c=h._getWin(b.get("document")[0]);a.remove(c,"focus",f,b);a.remove(c,"blur",j,b)}},m=!0,l=!1,k=null;d.refreshAll=d.refreshAll;i.focusManager=d;i.getInstances=function(){return e};return d},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(d,f){return{init:function(j){function i(a){return a.replace(p,function(a,b,c){return"<"+b+c.replace(n,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function h(a){return a.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+g+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function a(a){return a.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}
var e=e,c=d.Node,b=d.UA,m=d.require("htmlparser"),l=new m.Filter,k=new m.Filter,q=new m.Filter;(function(){var a=function(a,b){return function(c,e){var d=[];(""+c).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(c,g,f){g=g.toLowerCase();"font-family"==g&&(f=f.replace(/["']/g,""));for(var t,k,h,m=0;m<a.length;m++)if(a[m]&&(c=a[m][0],t=a[m][1],k=a[m][2],h=a[m][3],g.match(c)&&(!t||f.match(t)))){g=h||g;b&&(k=k||f);"function"==typeof k&&(k=k(f,e,g));k&&k.push&&(g=k[0],k=
k[1]);"string"==typeof k&&d.push([g,k]);return}!b&&d.push([g,f])});for(var g=0;g<d.length;g++)d[g]=d[g].join(":");return d.length?d.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],e),c={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(a){a.filterChildren()},tags:{p:function(a){a.filterChildren()},$:function(a){var b=a.nodeName||"";if(-1!=b.indexOf(":")&&!/^ke/.test(b))if("v:imagedata"==
b){if(b=a.getAttribute("o:href"))a.setAttribute("src",b),a.removeAttribute("o:href");if(b=a.getAttribute("o:title"))a.setAttribute("title",b),a.removeAttribute("o:title");a.setTagName("img")}else a.setTagName("")}},attributes:{"class":function(a){return!a||/(^|\s+)Mso/.test(a)?!1:a},style:function(b){b=a(b);return!b?!1:b}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},f={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=["name","href","src"],c,
e=0;e<b.length;e++)c="_ke_saved_"+b[e],a.getAttribute(c)&&a.removeAttribute(b[e]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1}},attributes:{style:function(a){if(!d.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(a){return a.substr(0,g.length)==g?(a="{C}"==a.substr(g.length,3)?a.substr(g.length+3):a.substr(g.length),new m.CData(decodeURIComponent(a))):a}};b.ie&&(f.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});l.addRules(f);k.addRules(c);q.addRules(c)})();(function(){function a(b){for(var b=b.childNodes,c=b.length,e=b[c-1];e&&3==e.nodeType&&!d.trim(e.nodeValue);)e=b[--c];return e}
function c(e,d){var g=a(e);g&&((d||!b.ie)&&1==g.nodeType&&"br"==g.nodeName?e.removeChild(g):3==g.nodeType&&h.test(g.nodeValue)&&e.removeChild(g))}function e(b){var c=a(b);return!c||1==c.nodeType&&"br"==c.nodeName||"form"==b.nodeName&&"input"==c.nodeName}function g(a){c(a,!0);e(a)&&(b.ie?a.appendChild(new m.Text("\u00a0")):(a.appendChild(new m.Text("&nbsp;")),a.appendChild(new m.Tag("br"))))}function o(a){c(a,!1);e(a)&&a.appendChild(new m.Text("\u00a0"))}var h=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,v=f.XHTML_DTD,i=d.merge(v.$block,
v.$listItem,v.$tableContent),j;for(j in i)i.hasOwnProperty(j)&&("br"in v[j]||delete i[j]);delete i.td;delete i.pre;var v={tags:{}},n={tags:{}};for(j in i)i.hasOwnProperty(j)&&(v.tags[j]=g,n.tags[j]=o);k.addRules(v);l.addRules(n);q.addRules(v)})();(function(){l.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}})})();var p=/<(a|area|img|input)\b([^>]*)>/gi,n=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,g="{ke_protected}";j.htmlDataProcessor={wordFilter:q,dataFilter:k,
htmlFilter:l,toHtml:function(a){var b=new m.BeautifyWriter;(new m.Parser(a)).parse().writeHtml(b,l);return b.getHtml()},toDataFormat:function(e,d,g){g=g||k;b.gecko&&(e=e.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));e=i(e);d=new c("<div>");d.html("a"+e);e=d.html().substr(1);e=a(e);d=new m.BeautifyWriter;(new m.Parser(e)).parse().writeHtml(d,g);e=d.getHtml();return e=h(e)},toServer:function(a){var b=new m.MinifyWriter;(new m.Parser(a)).parse().writeHtml(b,l);return b.getHtml()}}}}},
{requires:["./base"]});
KISSY.add("editor/core/meta",function(){var d={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../menubutton/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubble/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],orderedList:["../listUtils/btn","./cmd"],unorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubble/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["dd","../focusFix/"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],menubutton:["menubutton"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui",
"./cmd"],undo:["./btn","./cmd"],contextmenu:["menu","../focusFix/"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},f,j,i={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../menubutton/"],"flashCommon/baseClass":["../contextmenu/",
"../bubble/","../dialogLoader/","./utils"],"font/ui":["../button/","../menubutton/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../menubutton/"],"indent/cmd":["../dentUtils/cmd"],"orderedList/cmd":["../listUtils/cmd"],"unorderedList/cmd":["../listUtils/cmd"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],
"link/dialog":["../overlay/","./utils"],"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../menubutton/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../menubutton/"],"xiamiMusic/dialog":["../flash/dialog","../menubutton/"]},h={};for(f in d)j=
"editor/plugin/"+f+"/index",h[j]={requires:d[f]};for(f in i)j="editor/plugin/"+f,h[j]={requires:i[f]};KISSY.add(h)});
KISSY.add("editor/core/range",function(d,f,j,i,h){function a(a){var b=a.nodeType!=r.TEXT_NODE&&r.nodeName(a)in t.$removeEmpty,c=a.nodeType==r.TEXT_NODE&&!d.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return b||c||a}function e(a){return!v(a)&&!x(a)}function c(a){var b=q;return function(c){if(x(c))return k;if(c.nodeType==r.TEXT_NODE){if(d.trim(c.nodeValue).length)return q}else if(c.nodeType==r.ELEMENT_NODE&&(c=r.nodeName(c),!z[c]))if(!a&&!w.ie&&"br"==c&&!b)b=k;else return q;return k}}
function b(a,b){var c=a.startContainer,e=a.endContainer,d=a.startOffset,g=a.endOffset,o,f=q,t=q,h=void 0,m=a.document,i;0<b&&(h=m.createDocumentFragment());if(a.collapsed)return h;a.optimizeBookmark();e[0].nodeType==r.TEXT_NODE?(t=k,e=e._4e_splitText(g)):0<e[0].childNodes.length&&(g>=e[0].childNodes.length?(e=new s(e[0].appendChild(m.createTextNode(""))),i=k):e=new s(e[0].childNodes[g]));c[0].nodeType==r.TEXT_NODE?(f=k,c._4e_splitText(d)):d?d>=c[0].childNodes.length?(c=new s(c[0].appendChild(m.createTextNode(""))),
o=k):c=new s(c[0].childNodes[d].previousSibling):(o=new s(m.createTextNode("")),c.prepend(o),c=o,o=k);var l=c._4e_parents(),v=e._4e_parents();l.each(function(a,b){l[b]=a});v.each(function(a,b){v[b]=a});for(var j,y,m=0;m<l.length&&!(j=l[m],y=v[m],!j.equals(y));m++);for(var d=h,n,x,w=m;w<l.length;w++){n=l[w];g=0<b&&!n.equals(c)?d.appendChild(n.clone()[0]):null;n=n[0].nextSibling;x=v[w];for(var p=e[0],u=x&&x[0];n&&!(u==n||p==n);)x=n.nextSibling,2==b?d.appendChild(n.cloneNode(k)):(r._4e_remove(n),1==
b&&d.appendChild(n)),n=x;g&&(d=g)}for(d=h;m<v.length;m++){n=v[m];g=0<b&&!n.equals(e)?d.appendChild(n.clone()[0]):null;if(!l[m]||!n._4e_sameLevel(l[m]))for(n=n[0].previousSibling;n;)x=n.previousSibling,2==b?d.insertBefore(n.cloneNode(k),d.firstChild):(r._4e_remove(n),1==b&&d.insertBefore(n,d.firstChild)),n=x;g&&(d=g)}if(2==b){if(f&&(j=c[0],j.nodeType==r.TEXT_NODE&&j.nextSibling&&j.nextSibling.nodeType==r.TEXT_NODE&&(j.data+=j.nextSibling.data,j.parentNode.removeChild(j.nextSibling))),t)t=e[0],t.nodeType==
r.TEXT_NODE&&t.previousSibling&&t.previousSibling.nodeType==r.TEXT_NODE&&(t.previousSibling.data+=t.data,t.parentNode.removeChild(t))}else{if(j&&y&&(!c._4e_sameLevel(j)||!e._4e_sameLevel(y)))t=j._4e_index(),o&&j._4e_sameLevel(c)&&t--,a.setStart(j.parent(),t+1);a.collapse(k)}o&&c.remove();i&&e.remove();return h}function m(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function l(a){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=p;this.collapsed=k;this.document=a}f.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var k=!0,q=!1,p=null,n=f.RANGE,g=f.POSITION,r=d.DOM,w=d.UA,t=f.XHTML_DTD,s=d.Node,o=s.all,y={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},v=new i.whitespaces,x=new i.bookmark,u=i.whitespaces(k),B=i.bookmark(!1,
!0),z={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};d.augment(l,{toString:function(){var a=[],b=this.startContainer[0],c=this.endContainer[0];a.push((b.id||b.nodeName)+":"+this.startOffset);a.push((c.id||c.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,b=this.startOffset;a[0].nodeType!=r.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&
this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a[0].nodeType!=r.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,
b=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setEndAfter(b)},setStart:function(a,b){a[0].nodeType==r.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),b=a._4e_index());this.startContainer=a;this.startOffset=b;this.endContainer||(this.endContainer=a,this.endOffset=b);m(this)},setEnd:function(a,b){a[0].nodeType==r.ELEMENT_NODE&&y[a.nodeName()]&&(a=a.parent(),b=a._4e_index()+1);this.endContainer=a;this.endOffset=
b;this.startContainer||(this.startContainer=a,this.startOffset=b);m(this)},setStartAt:function(a,b){switch(b){case n.POSITION_AFTER_START:this.setStart(a,0);break;case n.POSITION_BEFORE_END:a[0].nodeType==r.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case n.POSITION_BEFORE_START:this.setStartBefore(a);break;case n.POSITION_AFTER_END:this.setStartAfter(a)}m(this)},setEndAt:function(a,b){switch(b){case n.POSITION_AFTER_START:this.setEnd(a,0);break;
case n.POSITION_BEFORE_END:a[0].nodeType==r.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case n.POSITION_BEFORE_START:this.setEndBefore(a);break;case n.POSITION_AFTER_END:this.setEndAfter(a)}m(this)},cloneContents:function(){return b(this,2)},deleteContents:function(){return b(this,0)},extractContents:function(){return b(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=k},clone:function(){var a=new l(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=r.ELEMENT_NODE||a.endContainer[0].nodeType!=r.ELEMENT_NODE)return p;var b=new i(a);b.evaluator=function(a){return u(a)&&B(a)};a=b.next();b.reset();b=
b.previous();return a&&a.equals(b)?a:p},shrink:function(a,b){if(!this.collapsed){var a=a||n.SHRINK_TEXT,c=this.clone(),e=this.startContainer,d=this.endContainer,g=this.startOffset,o=this.endOffset,f=k,t,h,m=k;e&&e[0].nodeType==r.TEXT_NODE&&(g?g>=e[0].nodeValue.length?c.setStartAfter(e):(c.setStartBefore(e),f=q):c.setStartBefore(e));d&&d[0].nodeType==r.TEXT_NODE&&(o?o>=d[0].nodeValue.length?c.setEndAfter(d):(c.setEndAfter(d),m=q):c.setEndBefore(d));if(f||m)h=new i(c),h.evaluator=function(b){return b.nodeType==
(a==n.SHRINK_ELEMENT?r.ELEMENT_NODE:r.TEXT_NODE)},h.guard=function(b,c){if(a==n.SHRINK_ELEMENT&&b.nodeType==r.TEXT_NODE||c&&b==t)return q;!c&&b.nodeType==r.ELEMENT_NODE&&(t=b);return k};f&&(c=h[a==n.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,b?n.POSITION_AFTER_START:n.POSITION_BEFORE_START);m&&(h.reset(),(h=h[a==n.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(h,b?n.POSITION_BEFORE_END:n.POSITION_AFTER_END));return f||m}},createBookmark2:function(a){var b=this.startContainer,
c=this.endContainer,e=this.startOffset,d=this.endOffset,g,o;if(!b||!c)return{start:0,end:0};if(a){if(b[0].nodeType==r.ELEMENT_NODE&&(g=new s(b[0].childNodes[e]))&&g[0]&&g[0].nodeType==r.TEXT_NODE&&0<e&&g[0].previousSibling.nodeType==r.TEXT_NODE)b=g,e=0;for(;b[0].nodeType==r.TEXT_NODE&&(o=b.prev(void 0,1))&&o[0].nodeType==r.TEXT_NODE;)b=o,e+=o[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==r.ELEMENT_NODE&&(g=new s(c[0].childNodes[d]))&&g[0]&&g[0].nodeType==r.TEXT_NODE&&0<d&&g[0].previousSibling.nodeType==
r.TEXT_NODE)c=g,d=0;for(;c[0].nodeType==r.TEXT_NODE&&(o=c.prev(void 0,1))&&o[0].nodeType==r.TEXT_NODE;)c=o,d+=o[0].nodeValue.length}}return{start:b._4e_address(a),end:this.collapsed?p:c._4e_address(a),startOffset:e,endOffset:d,normalized:a,is2:k}},createBookmark:function(a){var b,c,e,g,o=this.collapsed;b=new s("<span>",p,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");a&&(e=d.guid("ke_bm_"),b.attr("id",e+"S"));o||(c=b.clone(),c.html("&nbsp;"),a&&c.attr("id",e+"E"),
g=this.clone(),g.collapse(),g.insertNode(c));g=this.clone();g.collapse(k);g.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,n.POSITION_AFTER_END);return{startNode:a?e+"S":b,endNode:a?e+"E":c,serializable:a,collapsed:o}},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(k)},trim:function(a,b){var c=this.startContainer,e=this.startOffset,d=this.collapsed;if((!a||d)&&c[0]&&c[0].nodeType==r.TEXT_NODE){if(e)if(e>=c[0].nodeValue.length)e=c._4e_index()+1,
c=c.parent();else{var g=c._4e_splitText(e),e=c._4e_index()+1,c=c.parent();r.equals(this.startContainer,this.endContainer)?this.setEnd(g,this.endOffset-this.startOffset):r.equals(c,this.endContainer)&&(this.endOffset+=1)}else e=c._4e_index(),c=c.parent();this.setStart(c,e);if(d){this.collapse(k);return}}c=this.endContainer;e=this.endOffset;!b&&!d&&c[0]&&c[0].nodeType==r.TEXT_NODE&&(e?(e>=c[0].nodeValue.length||c._4e_splitText(e),e=c._4e_index()+1):e=c._4e_index(),c=c.parent(),this.setEnd(c,e))},insertNode:function(a){this.optimizeBookmark();
this.trim(q,k);var b=this.startContainer;b[0].insertBefore(a[0],b[0].childNodes[this.startOffset]||null);b[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(a){var b=o(this.document);if(a.is2){var c=b._4e_getByAddress(a.start,a.normalized),e=a.startOffset,b=a.end&&b._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(c,e);b?this.setEnd(b,a):this.collapse(k)}else c=(e=a.serializable)?d.one("#"+a.startNode,b):a.startNode,a=e?d.one("#"+a.endNode,
b):a.endNode,this.setStartBefore(c),c._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(k)},getCommonAncestor:function(a,b){var c=this.startContainer,e=this.endContainer,c=c[0]==e[0]?a&&c[0].nodeType==r.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new s(c[0].childNodes[this.startOffset]):c:c._4e_commonAncestor(e);return b&&c[0].nodeType==r.TEXT_NODE?c.parent():c},enlarge:function(){function a(b,c,e,d){var g=b[c?"startContainer":"endContainer"],f,t=c?0:1,h=0,k=c?"previousSibling":
"nextSibling";f=b[c?"startOffset":"endOffset"];if(g[0].nodeType==r.TEXT_NODE){if(c){if(f)return}else if(f<g[0].nodeValue.length)return;f=g[0][k];g=g[0].parentNode}else f=g[0].childNodes[f+(c?-1:1)]||null,g=g[0];for(;g;){for(;f;)if(v(f)||x(f))f=f[k];else break;if(f){if(!h)b[c?"setStartAfter":"setEndBefore"](o(f));break}g=o(g);if("body"==g.nodeName())break;if(h||g.equals(d))e[t]=g,h=1;else b[c?"setStartBefore":"setEndAfter"](g);f=g[0][k];g=g[0].parentNode}}return function(b){switch(b){case n.ENLARGE_ELEMENT:if(this.collapsed)break;
var b=this.getCommonAncestor(),c=[];a(this,1,c,b);a(this,0,c,b);c[0]&&c[1]&&(b=c[0].contains(c[1])?c[1]:c[0],this.setStartBefore(b),this.setEndAfter(b));break;case n.ENLARGE_BLOCK_CONTENTS:case n.ENLARGE_LIST_ITEM_CONTENTS:var e=new l(this.document),c=new s(this.document.body);e.setStartAt(c,n.POSITION_AFTER_START);e.setEnd(this.startContainer,this.startOffset);var e=new i(e),d,g,f=i.blockBoundary(b==n.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:p),t=function(a){var b=f(a);b||(d=o(a));return b},h=function(a){var b=
t(a);!b&&"br"==r.nodeName(a)&&(g=o(a));return b};e.guard=t;e=e.lastBackward();d=d||c;this.setStartAt(d,"br"!=d.nodeName()&&(!e&&this.checkStartOfBlock()||e&&d.contains(e))?n.POSITION_AFTER_START:n.POSITION_AFTER_END);e=this.clone();e.collapse();e.setEndAt(c,n.POSITION_BEFORE_END);e=new i(e);e.guard=b==n.ENLARGE_LIST_ITEM_CONTENTS?h:t;d=p;e=e.lastForward();d=d||c;this.setEndAt(d,!e&&this.checkEndOfBlock()||e&&d.contains(e)?n.POSITION_BEFORE_END:n.POSITION_BEFORE_START);g&&this.setEndAfter(g)}}}(),
checkStartOfBlock:function(){var a=this.startContainer,b=this.startOffset;if(b&&a[0].nodeType==r.TEXT_NODE&&d.trim(a[0].nodeValue.substring(0,b)).length)return q;this.trim();a=new h(this.startContainer);b=this.clone();b.collapse(k);b.setStartAt(a.block||a.blockLimit,n.POSITION_AFTER_START);a=new i(b);a.evaluator=c(k);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,b=this.endOffset;if(a[0].nodeType==r.TEXT_NODE&&d.trim(a[0].nodeValue.substring(b)).length)return q;this.trim();
a=new h(this.endContainer);b=this.clone();b.collapse(q);b.setEndAt(a.block||a.blockLimit,n.POSITION_BEFORE_END);a=new i(b);a.evaluator=c(q);return a.checkForward()},checkBoundaryOfElement:function(b,c){var e=this.clone();e[c==n.START?"setStartAt":"setEndAt"](b,c==n.START?n.POSITION_AFTER_START:n.POSITION_BEFORE_END);e=new i(e);e.evaluator=a;return e[c==n.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,c=this.startOffset,e=this.endOffset,
d;if(a[0].nodeType==r.ELEMENT_NODE)if(d=a[0].childNodes.length,d>c)a=o(a[0].childNodes[c]);else if(0==d)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=o(a);a=a._4e_nextSourceNode()||a}if(b[0].nodeType==r.ELEMENT_NODE)if(d=b[0].childNodes.length,d>e)b=o(b[0].childNodes[e])._4e_previousSourceNode(k);else if(0==d)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=o(b)}a._4e_position(b)&g.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},fixBlock:function(a,
b){var c=this.createBookmark(),e=o(this.document.createElement(b));this.collapse(a);this.enlarge(n.ENLARGE_BLOCK_CONTENTS);e[0].appendChild(this.extractContents());e._4e_trim();w.ie||e._4e_appendBogus();this.insertNode(e);this.moveToBookmark(c);return e},splitBlock:function(a){var b=new h(this.startContainer),c=new h(this.endContainer),e=b.block,g=c.block,o=p;if(!b.blockLimit.equals(c.blockLimit))return p;"br"!=a&&(e||(e=this.fixBlock(k,a),g=(new h(this.endContainer)).block),g||(g=this.fixBlock(q,
a)));a=e&&this.checkStartOfBlock();b=g&&this.checkEndOfBlock();this.deleteContents();e&&e[0]==g[0]&&(b?(o=new h(this.startContainer),this.moveToPosition(g,n.POSITION_AFTER_END),g=p):a?(o=new h(this.startContainer),this.moveToPosition(e,n.POSITION_BEFORE_START),e=p):(g=this.splitElement(e),!w.ie&&!d.inArray(e.nodeName(),["ul","ol"])&&e._4e_appendBogus()));return{previousBlock:e,nextBlock:g,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:o}},splitElement:function(a){if(!this.collapsed)return p;this.setEndAt(a,
n.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(q);c[0].appendChild(b);c.insertAfter(a);this.moveToPosition(a,n.POSITION_AFTER_END);return c},moveToElementEditablePosition:function(a,b){for(var c=0;a;){if(a[0].nodeType==r.TEXT_NODE){this.moveToPosition(a,b?n.POSITION_AFTER_END:n.POSITION_BEFORE_START);c=1;break}a[0].nodeType==r.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,b?n.POSITION_BEFORE_END:n.POSITION_AFTER_START),c=1);var d=a,g=c,o=void 0;d[0].nodeType==r.ELEMENT_NODE&&
d._4e_isEditable()&&(o=d[b?"last":"first"](e,1));!g&&!o&&(o=d[b?"prev":"next"](e,1));a=o}return!!c},selectNodeContents:function(a){var b=a[0];this.setStart(a,0);this.setEnd(a,b.nodeType==r.TEXT_NODE?b.nodeValue.length:b.childNodes.length)},insertNodeByDtd:function(a){var b,c,e,d=a.nodeName();b=t.$block[d];this.deleteContents();if(b){for(b=this.getCommonAncestor(q,k);(c=t[b.nodeName()])&&(!c||!c[d]);){var g=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(k),
b.remove()):e=b;b=g}e&&this.splitElement(e)}this.insertNode(a)}});j.injectDom({_4e_breakParent:function(a,b){var b=o(b),a=o(a),c,e=new f.Range(a[0].ownerDocument);e.setStartAfter(a);e.setEndAfter(b);c=e.extractContents();e.insertNode(a.remove());a.after(c)}});f.Range=l},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(d){function f(a){this.document=a;this._={cache:{}};if(k)try{var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=h}catch(c){this.isInvalid=h}}function j(b){b=new f(b);return!b||b.isInvalid?a:b}var i=d.Editor;i.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var h=!0,a=null,e=d.UA,c=d.DOM,b=d.Node,m=i.SELECTION,l=i.RANGE,k=e.ie,q=i.Walker,p=i.Range,
n={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};d.augment(f,{getNative:!k?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=c._getWin(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!k?function(){var a=this._.cache;if(a.type)return a.type;var b=m.SELECTION_TEXT,e=this.getNative();if(e){if(1==e.rangeCount){var e=
e.getRangeAt(0),d=e.startContainer;d==e.endContainer&&d.nodeType==c.ELEMENT_NODE&&1==Number(e.endOffset-e.startOffset)&&n[d.childNodes[e.startOffset].nodeName.toLowerCase()]&&(b=m.SELECTION_ELEMENT)}}else b=m.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=m.SELECTION_NONE;try{var c=this.getNative(),e=c.type;"Text"==e&&(b=m.SELECTION_TEXT);"Control"==e&&(b=m.SELECTION_ELEMENT);c.createRange().parentElement&&(b=m.SELECTION_TEXT)}catch(d){}return a.type=b},
getRanges:k?function(){var e=function(b,e){b=b.duplicate();b.collapse(e);for(var d=b.parentElement(),g=d.childNodes,f,h=0;h<g.length;h++){var k=g[h];if(k.nodeType==c.ELEMENT_NODE){f=b.duplicate();f.moveToElementText(k);var k=f.compareEndPoints("StartToStart",b),m=f.compareEndPoints("EndToStart",b);f.collapse();if(0<k)break;else{if(!k||1==m&&-1==k)return{container:d,offset:h};if(!m)return{container:d,offset:h+1}}f=a}}f||(f=b.duplicate(),f.moveToElementText(d),f.collapse(!1));f.setEndPoint("StartToStart",
b);f=(""+f.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<f;)f-=g[--h].nodeValue.length}catch(t){f=0}return 0===f?{container:d,offset:h}:{container:g[h],offset:-f}};return function(a){var c=this._.cache;if(c.ranges&&!a)return c.ranges;var d=this.getNative(),a=d&&d.createRange(),g=this.getType();if(!d)return[];if(g==m.SELECTION_TEXT)return d=new p(this.document),g=e(a,h),d.setStart(new b(g.container),g.offset),g=e(a),d.setEnd(new b(g.container),g.offset),c.ranges=[d];if(g==m.SELECTION_ELEMENT){c=
c.ranges=[];for(g=0;g<a.length;g++){for(var f=a.item(g),k=f.parentNode,l=0,d=new p(this.document);l<k.childNodes.length&&k.childNodes[l]!=f;l++);d.setStart(new b(k),l);d.setEnd(new b(k),l+1);c.push(d)}return c}return c.ranges=[]}}():function(a){var c=this._.cache;if(c.ranges&&!a)return c.ranges;var a=[],e=this.getNative();if(!e)return[];for(var d=0;d<e.rangeCount;d++){var g=e.getRangeAt(d),f=new p(this.document);f.setStart(new b(g.startContainer),g.startOffset);f.setEnd(new b(g.endContainer),g.endOffset);
a.push(f)}return c.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var e,d=this.getNative();switch(this.getType()){case m.SELECTION_ELEMENT:return this.getSelectedElement();case m.SELECTION_TEXT:var g=this.getRanges()[0];if(g&&!g.collapsed){for(g.optimize();h;)if(e=g.startContainer,g.startOffset==(e[0].nodeType===c.ELEMENT_NODE?e[0].childNodes.length:e[0].nodeValue.length)&&!e._4e_isBlockBoundary())g.setStartAfter(e);else break;e=g.startContainer;
if(e[0].nodeType!=c.ELEMENT_NODE)return e.parent();e=new b(e[0].childNodes[g.startOffset]);if(!e[0]||e[0].nodeType!=c.ELEMENT_NODE)return g.startContainer;for(g=e[0].firstChild;g&&g.nodeType==c.ELEMENT_NODE;)e=new b(g),g=g.firstChild;return e}if(k)g=d.createRange(),g.collapse(h),e=new b(g.parentElement());else{if((e=d.anchorNode)&&e.nodeType!=c.ELEMENT_NODE)e=e.parentNode;e&&(e=new b(e))}}return a.startElement=e},getSelectedElement:function(){var a,e=this._.cache;if(void 0!==e.selectedElement)return e.selectedElement;
k&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var d;if(a)d=new b(a);else{a=this.getRanges()[0];for(var g,f=2;f&&(!(d=a.getEnclosedNode())||!(d[0].nodeType==c.ELEMENT_NODE&&n[d.nodeName()]&&(g=d)));f--)a.shrink(l.SHRINK_ELEMENT);d=g}return e.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(a){var b,c=this.document;if(k)try{b=c.body.createControlRange(),b.addElement(a[0]),b.select()}catch(e){b=c.body.createTextRange(),b.moveToElementText(a[0]),b.select()}finally{}else b=
c.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(b);this.reset()},selectRanges:function(a){if(k){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;b.removeAllRanges();for(var d=0;d<a.length;d++){var g=a[d],f=this.document.createRange(),h=g.startContainer;if(g.collapsed&&(e.gecko&&1.09>e.gecko||e.opera||e.webkit)&&h[0].nodeType==c.ELEMENT_NODE&&!h[0].childNodes.length)h[0].appendChild(this.document.createTextNode(e.webkit?
"\u200b":"")),g.startOffset++,g.endOffset++;f.setStart(h[0],g.startOffset);f.setEnd(g.endContainer[0],g.endOffset);b.addRange(f)}}this.reset()},createBookmarks2:function(a){for(var b=[],c=this.getRanges(),e=0;e<c.length;e++)b.push(c[e].createBookmark2(a));return b},createBookmarks:function(a,b){for(var e=[],g=this.document,f,b=b||this.getRanges(),k=b.length,m=0;m<k;m++){e.push(f=b[m].createBookmark(a,h));var l=(a=f.serializable)?d.one("#"+f.startNode,g):f.startNode;f=a?d.one("#"+f.endNode,g):f.endNode;
for(var i=m+1;i<k;i++){var j=b[i],r=j.startContainer,n=j.endContainer;c.equals(r,l.parent())&&j.startOffset++;c.equals(r,f.parent())&&j.startOffset++;c.equals(n,l.parent())&&j.endOffset++;c.equals(n,f.parent())&&j.endOffset++}}return e},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var e=new p(this.document);e.moveToBookmark(a[c]);b.push(e)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-
1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,!1)},removeAllRanges:function(){var a=this.getNative();k?a&&a.clear():a&&a.removeAllRanges()}});var g={table:1,tbody:1,tr:1},r=q.whitespaces(h),w=/\ufeff|\u00a0/;p.prototype.select=p.prototype.select=!k?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==c.ELEMENT_NODE&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));var b=this.document.createRange();b.setStart(a[0],
this.startOffset);try{b.setEnd(this.endContainer[0],this.endOffset)}catch(e){if(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(h),b.setEnd(this.endContainer[0],this.endOffset);else throw e;}a=j(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(a){var e=this.collapsed,d,k;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var m=this.startContainer[0].childNodes[this.startOffset];if(m.nodeType==c.ELEMENT_NODE){(new f(this.document)).selectElement(new b(m));
return}}(this.startContainer[0].nodeType==c.ELEMENT_NODE&&this.startContainer.nodeName()in g||this.endContainer[0].nodeType==c.ELEMENT_NODE&&this.endContainer.nodeName()in g)&&this.shrink(l.SHRINK_ELEMENT,h);var i=this.createBookmark(),m=i.startNode,j;e||(j=i.endNode);i=this.document.body.createTextRange();i.moveToElementText(m[0]);i.moveStart("character",1);if(j)a=this.document.body.createTextRange(),a.moveToElementText(j[0]),i.setEndPoint("EndToEnd",a),i.moveEnd("character",-1);else{for(d=m[0].nextSibling;d&&
!r(d);)d=d.nextSibling;d=!(d&&d.nodeValue&&d.nodeValue.match(w))&&(a||!m[0].previousSibling||m[0].previousSibling&&"br"==c.nodeName(m[0].previousSibling));k=new b(this.document.createElement("span"));k.html("&#65279;");k.insertBefore(m);d&&c.insertBefore(this.document.createTextNode("\ufeff"),m[0]||m)}this.setStartBefore(m);m._4e_remove();if(e){if(d?(i.moveStart("character",-1),i.select(),this.document.selection.clear()):i.select(),k)this.moveToPosition(k,l.POSITION_BEFORE_START),k._4e_remove()}else this.setEndBefore(j),
j._4e_remove(),i.select()};f.getSelection=j;return i.Selection=f},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/core/selectionFix",function(d,f){function j(a){function e(a,c){var d=h.body.createTextRange();try{d.moveToPoint(a,c)}catch(g){d=b}return d}function c(){var a=h.selection.createRange();m&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&m.select();l.remove(h,"mouseup",c);l.remove(h,"mousemove",d);m=f=0}function d(a){if(a.button){if(a=e(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",m)?a.setEndPoint("StartToStart",m):a.setEndPoint("EndToEnd",m),a.select()}else c()}var f,k=a.get("window")[0],
h=a.get("document")[0],m;l.on(h,"mousedown contextmenu",function(a){var b=h.documentElement;if(a.target===b&&(f&&c(),!(b.scrollHeight>b.clientHeight)&&(f=1,m=e(a.pageX,a.pageY))))l.on(h,"mouseup",c),l.on(h,"mousemove",d),k.focus(),m.select()})}function i(a){function d(b){if(l){var c=a.getSelection(),f=c&&c.getType(),k=c&&h.selection;if(b&&k&&f==p.SELECTION_NONE&&!h.queryCommandEnabled("InsertImage"))setTimeout(function(){d(e)},50);else{var m;if(!k||!k.type||!("Control"!=k.type&&(m=k.createRange())&&
(m=m.parentElement())&&(m=m.nodeName)&&m.toLowerCase()in{input:1,textarea:1}))i=k&&c.getRanges()[0],a.checkSelectionChange()}}}var h=a.get("document")[0],k=new q(h.body),m=new q(h.documentElement);if(8>f.Utils.ieEngine)m.on("click",function(b){"html"===(new q(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var i,l,j=e;m.on("mousedown",function(){j=c});m.on("mouseup",function(){j=e});k.on("focusin",function(a){if("body"==(new q(a.target)).nodeName()&&i){try{j&&i.select()}catch(c){}i=
b}});k.on("focus",function(){l=e;d()});k.on("beforedeactivate",function(a){a.relatedTarget||(l=c,j=e)});k.on("mousedown",function(){l=c});k.on("mouseup",function(){l=e;setTimeout(function(){d(e)},0)});k.on("keydown",function(){l=c});k.on("keyup",function(){l=e;setTimeout(function(){d()},0)})}function h(a){var b=a.get("document")[0];l.on(b,"mouseup keyup",function(){a.checkSelectionChange()})}function a(a){function b(a){var c=f.XHTML_DTD;return a._4e_isBlockBoundary()&&c.$empty[a.nodeName()]}function d(a){return i(a)&&
l(a)}var h=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,i=f.Walker.whitespaces(e),l=f.Walker.bookmark(c,e),j=function(a){return i(a)&&8!=a.nodeType};a.on("selectionChange",function(i){var l=i.path,t=new q(a.get("document")[0].body),i=(i=i.selection)&&i.getRanges()[0],s=l.blockLimit;if(m.gecko){var p=l.block||l.blockLimit,z=p&&p.last(d);p&&p._4e_isBlockBoundary()&&(!z||!(1==z[0].nodeType&&z._4e_isBlockBoundary()))&&
"pre"!=p.nodeName()&&!p._4e_getBogus()&&p._4e_appendBogus()}if(i&&i.collapsed&&!l.block){if("body"==s.nodeName()){if((l=i.fixBlock(e,"p"))&&l[0]!=t[0].lastChild&&l._4e_outerHtml().match(h))if((s=l.next(j,1))&&s[0].nodeType==k.ELEMENT_NODE&&!b[s])i.moveToElementEditablePosition(s),l._4e_remove();else if((s=l.prev(j,1))&&s[0].nodeType==k.ELEMENT_NODE&&!b[s])i.moveToElementEditablePosition(s,s._4e_outerHtml().match(h)?c:e),l._4e_remove();i.select();a.notifySelectionChange()}l=a.get("document")[0];i=
new f.Range(l);i.moveToElementEditablePosition(t,e);"body"!==(new f.ElementPath(i.startContainer)).blockLimit.nodeName()&&(t=(new q(l.createElement("p"))).appendTo(t),m.ie||t._4e_appendBogus())}})}var e=!0,c=!1,b=null,m=d.UA,l=d.Event,k=d.DOM,q=d.Node,p=f.SELECTION;return{init:function(b){b.docReady(function(){m.ie?(j(b),i(b)):h(b)});a(b)}}},{requires:["./base","./selection"]});
KISSY.add("editor/core/styles",function(d){function f(a){return!u.attr(a,"_ke_bookmark")}function j(a,b){for(var c in a)a.hasOwnProperty(c)&&(d.isString(a[c])?a[c]=a[c].replace(L,function(a,c){return b[c]}):j(a[c],b))}function i(a,b){b&&(a=d.clone(a),j(a,b));var c=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#"==c||K[c]?B.STYLE_BLOCK:I[c]?B.STYLE_OBJECT:B.STYLE_INLINE;this._={definition:a}}function h(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();
for(var e=new D(a),d=e.getRanges(),g=0;g<d.length;g++)c.call(this,d[g]);e.selectRanges(d)}function a(a,b,c){var e=a.element;"*"==e&&(e="span");b=new C(b.createElement(e));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=i.getStyleText(c);if(a)for(var d in a)a.hasOwnProperty(d)&&b.attr(d,a[d]);c&&(b[0].style.cssText=c);return b}function e(e){var d=e.createBookmark(y),g=e.createIterator();g.enforceRealBlocks=y;g.enlargeBr=y;for(var f,k=e.document;f=g.getNextParagraph();){var h=a(this,k,
f),i=h,h="pre"==i.nodeName,l="pre"==f.nodeName,j=!h&&l;h&&!l?(l=f,j=l.html(),j=c(j,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),j=j.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),j=j.replace(/([ \t\n\r]+|&nbsp;)/g," "),j=j.replace(/<br\b[^>]*>/gi,"\n"),G.ie?(l=l[0].ownerDocument.createElement("div"),l.appendChild(i[0]),i[0].outerHTML="<pre>"+j+"</pre>",i=new C(l.firstChild),i._4e_remove()):i.html(j)):j?i=m(b(f),i):f._4e_moveChildren(i);f[0].parentNode.replaceChild(i[0],f[0]);if(h&&(f=i,h=void 0,(h=f._4e_previousSourceNode(y,
u.ELEMENT_NODE))&&"pre"==h.nodeName()))i=c(h.html(),/\n$/,"")+"\n\n"+c(f.html(),/^\n/,""),G.ie?f[0].outerHTML="<pre>"+i+"</pre>":f.html(i),h._4e_remove()}e.moveToBookmark(d)}function c(a,b,c){var e="",d="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(e=b);c&&(d=c);return""});return e+a.replace(b,c)+d}function b(a){var b=[];c(a._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+
c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,c){b.push(c)});return b}function m(a,b){for(var e=b[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var g=a[d],g=g.replace(/(\r\n|\r)/g,"\n"),g=c(g,/^[ \t]*\n/,""),g=c(g,/\n$/,""),g=c(g,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),g=g.replace(/\n/g,"<br>"),g=g.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),
f=b.clone();f.html(g);e.appendChild(f[0])}return e}function l(b){var c=b.document;if(b.collapsed)c=a(this,c,void 0),b.insertNode(c),b.moveToPosition(c,z.POSITION_BEFORE_END);else{var e=this.element,d=this._.definition,g,h=F[e];h||(g=y,h=F.span);var k=b.createBookmark();b.enlarge(z.ENLARGE_ELEMENT);b.trim();for(var m=b.createBookmark(),i=m.startNode,m=m.endNode,l=i,j;l&&l[0];){var o=v;if(u.equals(l,m))l=x,o=y;else{var r=l[0].nodeType,t=r==u.ELEMENT_NODE?l.nodeName():x;if(t&&l.attr("_ke_bookmark")){l=
l._4e_nextSourceNode(y);continue}if(!t||h[t]&&(l._4e_position(m)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(l))){var q=l.parent();if(q&&"a"==e&&q.nodeName()==e)r=a(this,c,void 0),q._4e_moveChildren(r),q[0].parentNode.replaceChild(r[0],q[0]),r._4e_mergeSiblings();else if(q&&q[0]&&((F[q.nodeName()]||F.span)[e]||g)&&(!d.parentRule||d.parentRule(q))){if(!j&&(!t||!F.$removeEmpty[t]||(l._4e_position(m)|
A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))j=new E(c),j.setStartBefore(l);if(r==u.TEXT_NODE||r==u.ELEMENT_NODE&&!l[0].childNodes.length){q=l;for(r=null;(o=!q.next(f,1))&&(r=q.parent())&&h[r.nodeName()]&&(r._4e_position(i)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(r));)q=r;j.setEndAfter(q)}}else o=
y}else o=y;l=l._4e_nextSourceNode()}if(o&&j&&!j.collapsed){for(var o=a(this,c,void 0),q=j.getCommonAncestor(),r={},t={},n,s=null,p;o&&q&&o[0]&&q[0];){if(q.nodeName()==e){for(n in d.attributes)if(d.attributes.hasOwnProperty(n)&&!t[n]&&(p=q.attr(s)))o.attr(n)==p?o.removeAttr(n):t[n]=1;for(s in d.styles)if(d.styles.hasOwnProperty(s)&&!r[s]&&(p=q.style(s)))o.style(s)==p?o.style(s,""):r[s]=1;if(!o._4e_hasAttributes()){o=x;break}}q=q.parent()}o?(o[0].appendChild(j.extractContents()),w(this,o),j.insertNode(o),
o._4e_mergeSiblings(),G.ie||o[0].normalize()):(o=new C(c.createElement("span")),o[0].appendChild(j.extractContents()),j.insertNode(o),w(this,o),o._4e_remove(!0));j=x}}i._4e_remove();m._4e_remove();b.moveToBookmark(k);b.shrink(z.SHRINK_TEXT)}}function k(a){a.enlarge(z.ENLARGE_ELEMENT);var b=a.createBookmark(),c=b.startNode;if(a.collapsed){for(var e=new H(c.parent()),d,f=0,h;f<e.elements.length&&(h=e.elements[f])&&!(h==e.block||h==e.blockLimit);f++)if(this.checkElementRemovable(h)){var k=a.checkBoundaryOfElement(h,
z.END),m=!k&&a.checkBoundaryOfElement(h,z.START);m||k?(d=h,d.match=m?"start":"end"):(h._4e_mergeSiblings(),h.nodeName()!=this.element?(k=n(this),t(h,k[h.nodeName()]||k["*"])):g(this,h))}if(d){h=c;for(f=0;;f++){k=e.elements[f];if(u.equals(k,d))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(h[0]);h=k}h["start"==d.match?"insertBefore":"insertAfter"](d)}}else{var l=b.endNode,i=this,e=function(){for(var a=new H(c.parent()),b=new H(l.parent()),e=x,d=x,g=0;g<a.elements.length;g++){var f=
a.elements[g];if(f==a.block||f==a.blockLimit)break;i.checkElementRemovable(f)&&(e=f)}for(g=0;g<b.elements.length;g++){f=b.elements[g];if(f==b.block||f==b.blockLimit)break;i.checkElementRemovable(f)&&(d=f)}d&&l._4e_breakParent(d);e&&c._4e_breakParent(e)};e();for(d=new C(c[0].nextSibling);d[0]!==l[0];){f=d._4e_nextSourceNode();if(d[0]&&d[0].nodeType==u.ELEMENT_NODE&&this.checkElementRemovable(d)&&(d.nodeName()==this.element?g(this,d):(h=n(this),t(d,h[d.nodeName()]||h["*"])),f[0].nodeType==u.ELEMENT_NODE&&
f.contains(c)))e(),f=new C(c[0].nextSibling);d=f}}a.moveToBookmark(b)}function q(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,e){b[c]=e});return b}function p(a,b){var c="";b!==v?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function n(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;
if(c){d.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++){var g=c[e],f,h,k;"string"==typeof g?f=g.toLowerCase():(f=g.element?g.element.toLowerCase():a.element,h=g.attributes,k=g.styles);g=b[f]||(b[f]={});if(h){f=g.attributes=g.attributes||[];for(var m in h)h.hasOwnProperty(m)&&f.push([m.toLowerCase(),h[m]])}if(k){var g=g.styles=g.styles||[],l;for(l in k)k.hasOwnProperty(l)&&g.push([l.toLowerCase(),k[l]])}}}return b}function g(a,b){var c=a._.definition,e=n(a),g=d.merge(c.attributes,(e[b.nodeName()]||
e["*"]||{}).attributes),c=d.merge(c.styles,(e[b.nodeName()]||e["*"]||{}).styles),e=d.isEmptyObject(g)&&d.isEmptyObject(c),f;for(f in g)if(g.hasOwnProperty(f)&&!(("class"==f||a._.definition.fullMatch)&&b.attr(f)!=r(f,g[f])))e=e||!!b.hasAttr(f),b.removeAttr(f);for(var h in c)c.hasOwnProperty(h)&&!(a._.definition.fullMatch&&b.style(h)!=r(h,c[h],y))&&(e=e||!!b.style(h),b.style(h,""));s(b)}function r(a,b,c){var e=new C("<span>");e[c?"style":"attr"](a,b);return e[c?"style":"attr"](a)}function w(a,b){for(var c=
n(a),e=b.all(a.element),d=e.length;0<=--d;)g(a,new C(e[d]));for(var f in c)if(c.hasOwnProperty(f)&&f!=a.element){e=b.all(f);for(d=e.length-1;0<=d;d--){var h=new C(e[d]);t(h,c[f])}}}function t(a,b){var c,e=b&&b.attributes;if(e)for(c=0;c<e.length;c++){var d=e[c][0],g;if(g=a.attr(d)){var f=e[c][1];(f===x||f.test&&f.test(g)||"string"==typeof f&&g==f)&&a[0].removeAttribute(d)}}if(e=b&&b.styles)for(c=0;c<e.length;c++)if(d=e[c][0],f=a.css(d)){var h=e[c][1];(h===x||h.test&&h.test(g)||"string"==typeof h&&
f==h)&&a.css(d,"")}s(a)}function s(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(y);b&&(b.nodeType==u.ELEMENT_NODE&&u._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==u.ELEMENT_NODE&&u._4e_mergeSiblings(c))}}var o=d.Editor,y=!0,v=!1,x=null,u=d.DOM,B={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},z=o.RANGE,D=o.Selection,A=o.POSITION,E=o.Range,C=d.Node,G=d.UA,H=o.ElementPath,K={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},F=o.XHTML_DTD,I={embed:1,hr:1,img:1,li:1,
object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,L=/#\((.+?)\)/g;o.STYLE=B;i.prototype={apply:function(a){h.call(this,a,v)},remove:function(a){h.call(this,a,y)},applyToRange:function(a){return(this.applyToRange=this.type==B.STYLE_INLINE?l:this.type==B.STYLE_BLOCK?e:x).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==B.STYLE_INLINE?k:x).call(this,a)},checkElementRemovable:function(a,b){if(!a)return v;var c=this._.definition,e;if(a.nodeName()==
this.element){if(!b&&!a._4e_hasAttributes())return y;var d=c._AC;if(d)c=d;else{var d={},g=0,f=c.attributes;if(f)for(var h in f)f.hasOwnProperty(h)&&(g++,d[h]=f[h]);if(f=i.getStyleText(c))d.style||g++,d.style=f;d._length=g;c=c._AC=d}if(c._length){for(var k in c)if("_length"!=k&&c.hasOwnProperty(k)){g=a.attr(k)||"";if("style"==k)a:{d=c[k];g=p(g,v);"string"==typeof d&&(d=q(d));"string"==typeof g&&(g=q(g));f=void 0;for(f in d)if(d.hasOwnProperty(f)&&!(f in g&&(g[f]==d[f]||"inherit"==d[f]||"inherit"==
g[f]))){d=v;break a}d=y}else d=c[k]==g;if(d){if(!b)return y}else if(b)return v}if(b)return y}else return y}k=n(this);if(k=k[a.nodeName()]||k["*"]){if(!(c=k.attributes)&&!(e=k.styles))return y;if(c)for(d=0;d<c.length;d++)if(k=c[d][0],k=a.attr(k))if(g=c[d][1],g===x||"string"==typeof g&&k==g||g.test&&g.test(k))return y;if(e)for(d=0;d<e.length;d++)if(k=a.css(e[d][0]))if(c=e[d][1],c===x||"string"==typeof c&&k==c||c.test&&c.test(k))return y}return v},checkActive:function(a){switch(this.type){case B.STYLE_BLOCK:return this.checkElementRemovable(a.block||
a.blockLimit,y);case B.STYLE_OBJECT:case B.STYLE_INLINE:for(var b=a.elements,c=0,e;c<b.length;c++)if(e=b[c],!(this.type==B.STYLE_INLINE&&(u.equals(e,a.block)||u.equals(e,a.blockLimit))))if((this.type!=B.STYLE_OBJECT||e.nodeName()in I)&&this.checkElementRemovable(e,y))return y}return v}};i.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",e="";c.length&&(c=c.replace(J,";"));for(var d in b)if(b.hasOwnProperty(d)){var g=b[d],f=(d+":"+g).replace(J,
";");"inherit"==g?e+=f:c+=f}c.length&&(c=p(c));return a._ST=c+e};o.Style=i},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(d){var f=d.Node,j=d.DOM,i=d.UA,h={debugUrl:function(a){var e=d.Config;e.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));-1==a.indexOf("?t")&&(a=-1!=a.indexOf("?")?a+"&":a+"?",a+="t="+encodeURIComponent(e.tag));return e.base+"editor/"+a},lazyRun:function(a,e,c){var b=a[e],d=a[c];a[e]=function(){b.apply(this,arguments);a[e]=a[c];return d.apply(this,arguments)}},getXY:function(a,e,c,b){c=c.defaultView||c.parentWindow;a-=j.scrollLeft(c);e-=j.scrollTop(c);b&&(b=b.defaultView||
b.parentWindow,c!=b&&c.frameElement&&(b=j.offset(c.frameElement,void 0,b),a+=b.left,e+=b.top));return{left:a,top:e}},tryThese:function(a){for(var e,c=0,b=arguments.length;c<b;c++){var d=arguments[c];try{e=d();break}catch(f){}}return e},arrayCompare:function(a,e){if(!a&&!e)return!0;if(!a||!e||a.length!=e.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==e[c])return!1;return!0},clearAllMarkers:function(a){for(var e in a)a.hasOwnProperty(e)&&a[e]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,
"")},rtrim:function(a){return a.replace(/\s+$/,"")},isNumber:function(a){return/^\d+(.\d+)?$/.test(d.trim(a))},verifyInputs:function(a){for(var e=0;e<a.length;e++){var c=new f(a[e]),b=d.trim(h.valInput(c)),m=c.attr("data-verify"),c=c.attr("data-warning");if(m&&!RegExp(m).test(b))return alert(c),!1}return!0},sourceDisable:function(a,e){a.on("sourceMode",e.disable,e);a.on("wysiwygMode",e.enable,e)},resetInput:function(a){var e=a.attr("placeholder");e&&i.ie?(a.addClass("ks-editor-input-tip"),a.val(e)):
i.ie||a.val("")},valInput:function(a,e){if(void 0===e)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(e)},placeholder:function(a,e){a.attr("placeholder",e);i.ie&&(a.on("blur",function(){d.trim(a.val())||(a.addClass("ks-editor-input-tip"),a.val(e))}),a.on("focus",function(){a.removeClass("ks-editor-input-tip");d.trim(a.val())==e&&a.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,
"&quot;")},normParams:function(a){var a=d.clone(a),e;for(e in a)if(a.hasOwnProperty(e)){var c=a[e];d.isFunction(c)&&(a[e]=c())}return a},map:function(a,e){for(var c=0;c<a.length;c++)a[c]=e(a[c]);return a},ieEngine:document.documentMode||i.ie,preventFocus:function(a){i.ie?a.unselectable(void 0):a.attr("onmousedown","return false;")},injectDom:function(a){d.mix(j,a);for(var e in a)a.hasOwnProperty(e)&&function(c){f.prototype[c]=function(){var b=[].slice.call(arguments,0);b.unshift(this[0]);return(b=
a[c].apply(null,b))&&(b.nodeType||d.isWindow(b))?new f(b):d.isArray(b)&&(b.__IS_NODELIST||b[0]&&b[0].nodeType)?new f(b):b}}(e)},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,d.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],e=0;e<a.length;e++){var c=a[e];d.isFunction(c)?c():(c.destroy&&c.destroy(),c.remove&&c.remove())}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,c){return c.toUpperCase()})+"Active"}};return d.Editor.Utils=
h},{requires:["./base"]});
KISSY.add("editor/core/walker",function(d,f){function j(b,d){if(this._.end)return c;var g,f=this.range,h,l=this.guard,i=this.type,j=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,f.trim(),f.collapsed))return this.end(),c;if(!b&&!this._.guardLTR){var q=f.endContainer[0],n=q.childNodes[f.endOffset];this._.guardLTR=function(a,b){return b&&(q==a||"body"==m.nodeName(a))?!1:a!=n}}if(b&&!this._.guardRTL){var p=f.startContainer[0],D=0<f.startOffset&&p.childNodes[f.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(p==a||"body"==m.nodeName(a))?!1:a!=D}}var A=b?this._.guardRTL:this._.guardLTR;h=l?function(a,b){return A(a,b)===e?e:l(a,b)}:A;this.current?g=this.current[j](e,i,h):b?(g=f.endContainer,0<f.endOffset?(g=new k(g[0].childNodes[f.endOffset-1]),h(g[0])===e&&(g=c)):g=h(g,a)===e?c:g._4e_previousSourceNode(a,i,h,void 0)):(g=f.startContainer,g=new k(g[0].childNodes[f.startOffset]),g.length?h(g[0])===e&&(g=c):g=h(f.startContainer,a)===e?c:f.startContainer._4e_nextSourceNode(a,
i,h,void 0));for(;g&&!this._.end;){this.current=g;if(!this.evaluator||this.evaluator(g[0])!==e){if(!d)return g}else if(d&&this.evaluator)return e;g=g[j](e,i,h)}this.end();return this.current=c}function i(a){for(var b,e=c;b=j.call(this,a);)e=b;return e}function h(a){this.range=a;this.guard=this.evaluator=c;this._={}}var a=!0,e=!1,c=null,b=d.UA,m=d.DOM,l=f.XHTML_DTD,k=d.Node;d.augment(h,{end:function(){this._.end=1},next:function(){return j.call(this)},previous:function(){return j.call(this,a)},checkForward:function(){return j.call(this,
e,a)!==e},checkBackward:function(){return j.call(this,a,a)!==e},lastForward:function(){return i.call(this)},lastBackward:function(){return i.call(this,a)},reset:function(){delete this.current;this._={}},_iterator:j});d.mix(h,{blockBoundary:function(a){return function(b){return!(b.nodeType==m.ELEMENT_NODE&&m._4e_isBlockBoundary(b,a))}},bookmark:function(a,b){function c(a){return"span"==m.nodeName(a)&&m.attr(a,"_ke_bookmark")}return function(e){var d,g;d=e.nodeType==m.TEXT_NODE&&(g=e.parentNode)&&c(g);
d=a?d:d||c(e);return!!(b^d)}},whitespaces:function(a){return function(b){b=b.nodeType==m.TEXT_NODE&&!d.trim(b.nodeValue);return!!(a^b)}},invisible:function(a){var b=h.whitespaces();return function(c){c=b(c)||c.nodeType==m.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var q=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,p=h.whitespaces(),n=h.bookmark(),g=function(a){var b=m.nodeName(a);return n(a)||p(a)||1==a.nodeType&&b in l.$inline&&!(b in l.$empty)};f.Utils.injectDom({_4e_getBogus:function(a){a=new k(a);do a=
a._4e_previousSourceNode();while(a&&g(a[0]));return a&&(!b.ie?"br"==a.nodeName():3==a[0].nodeType&&q.test(a.text()))?a[0]:!1}});return f.Walker=h},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(d){var f=d.Editor;f.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};f.baseZIndex=function(d){return(f.Config.baseZIndex||1E4)+d}},{requires:["./base"]});
KISSY.add("editor",function(d,f,j,i,h,a,e,c,b,m,l){function k(a,b){var c=a.body;D(function(){a.designMode="on";setTimeout(function(){a.designMode="off";c.focus();arguments.callee.retry||(arguments.callee.retry=w)},50)},function(){a.designMode="off";u.attr(c,"contentEditable",o);u.attr(c,"contentEditable",w);!b&&k(a,1)})}function q(a){a.get("iframe");var b=a.get("textarea")[0],c=a.get("window")[0],e=a.get("document")[0];v.webkit&&(z.on(e,"click",function(a){var b=new B(a.target);d.inArray(b.nodeName(),
["input","select"])&&a.preventDefault()}),z.on(e,"mouseup",function(a){var b=new B(a.target);d.inArray(b.nodeName(),["input","textarea"])&&a.preventDefault()}));if(v.gecko||x||v.opera){var g;g=(new B('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(b);g.on("focus",function(){a.focus()});a.activateGecko=function(){v.gecko&&a.__iframeFocus&&g[0].focus()};a.on("destroy",function(){g.detach();g.remove()})}z.on(c,"focus",function(){v.gecko?k(e,o):v.opera&&
e.body.focus();a.notifySelectionChange()});if(v.gecko)z.on(e,"mousedown",function(){a.__iframeFocus||k(e,o)});if(x&&(z.on(e,"keydown",function(b){if(b.keyCode in{8:1,46:1}){var c=a.getSelection(),e=c.getSelectedElement();if(e){a.execCommand("save");var d=c.getRanges()[0].createBookmark();e.remove();c.selectBookmarks([d]);a.execCommand("save");b.preventDefault()}}}),"CSS1Compat"==e.compatMode)){var f={33:1,34:1};z.on(e,"keydown",function(b){b.keyCode in f&&setTimeout(function(){a.getSelection().scrollIntoView()},
0)})}if(v.webkit)z.on(e,"mousedown",function(b){b=new B(b.target);d.inArray(b.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(b)});if(v.gecko)z.on(e,"dragstart",function(a){var b=new B(a.target);b.nodeName()==="img"&&/ke_/.test(b[0].className)&&a.preventDefault()});i.add(a)}function p(a,b,c,e){var g="",f,h=j.debugUrl("theme/editor-iframe.css");for(f=0;f<c.length;f++)g+=d.substitute('<link href="{href}" rel="stylesheet" />',{href:c[f]});return d.substitute(A,{doctype:8===
y.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:h,style:b,data:e||"&nbsp;",script:a?'<script id="ke_active_script">'+(u.isCustomDomain()?'document.domain="'+y.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function n(a,b){a.__saveTimer&&(clearTimeout(a.__saveTimer),a.__saveTimer=null);a.__saveTimer=setTimeout(function(){a.execCommand("save")},b||0)}function g(a,b){function c(){h=f.document;a.__set("document",new B(h));a.__set("window",
new B(f));e.detach();h.open("text/html","replace");h.write(d);h.close()}var e=a.get("iframe"),d=p(a._UUID,a.get("customStyle"),a.get("customLink"),b),g=e[0],f=g.contentWindow,h;e.__loaded=1;try{h=f.document}catch(k){if(g.src=g.src,7>x){setTimeout(c,10);return}}c()}function r(a,b){var c=new B(E),e=a.get("textarea");e.hasAttr("tabindex")&&c.attr("tabIndex",v.webkit?-1:e.attr("tabIndex"));e.parent().prepend(c);a.set("iframe",c);a.__docReady=0;if(v.gecko&&!c.__loaded)c.on("load",function(){g(a,b)},a);
else g(a,b)}var w=!0,t=t,s=d.all,o=!1,y=document,v=d.UA,x=v.ie,u=d.DOM,B=d.Node,z=d.Event,D=j.tryThese,A="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor'>{data}{script}</body></html>",h=u.getEmptyIframeSrc(),E='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true" '+(h?' src="'+h+'"':"")+"</iframe>";d.mix(f,{SOURCE_MODE:0,WYSIWYG_MODE:1});
var C=f.WYSIWYG_MODE;d.augment(f,{createDom:function(){var a,b=this.get("textarea"),c;b||this.set("textarea",b=s("<textarea class='ks-editor-textarea'></textarea>"));c=this.get("el");c.html('<div class="ks-editor-tools"></div><div class="ks-editor-textarea-wrap"></div><div class=\'ks-editor-status\'></div>');a=c.one(".ks-editor-textarea-wrap");this._UUID=d.guid();this.set({toolBarEl:c.one(".ks-editor-tools"),statusBarEl:c.one(".ks-editor-status")},{silent:1});b.css("width","100%");b.css("display",
"none");a.append(b);i.register(this)},renderUI:function(){c.init(this);b.init(this);m.init(this);l.init(this)},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,c,e=b.get("prefixCls"),d=b.get("textarea");if(b.get("attachForm")&&(c=d[0].form))u.on(c,"submit",b.sync,b),b.on("destroy",function(){u.detach(c,"submit",b.sync,b)});b.on("docReady",a);b.on("blur",function(){b.get("el").removeClass(e+"editor-focused")});
b.on("focus",function(){b.get("el").addClass(e+"editor-focused")})},syncUI:function(){var a=this.get("height");a&&this._uiSetHeight(a)},_uiSetHeight:function(a){var b=this.get("textarea"),c=this.get("toolBarEl"),e=this.get("statusBarEl"),a=parseInt(a,10),a=a-((c&&c.outerHeight()||0)+(e&&e.outerHeight()||0));b.parent().css("height",a);b.css("height",a)},_uiSetMode:function(a){var b=this,c,e=b.get("render"),d=b.get("iframe"),g=b.get("textarea");a==C?(e&&b.execCommand("save"),b.on("docReady",c=function(){e&&
b.execCommand("save");b.detach("docReady",c)}),b._setData(g.val()),b.fire("wysiwygMode")):(g.val(b._getData(1,C)),g[0].focus(),g.show(),d.hide(),b.fire("sourceMode"))},_uiSetFocused:function(a){a&&this.__docReady&&this.focus()},destructor:function(){var a=this.get("document")[0],b=this.get("window");this.sync();i.remove(this);z.remove([a,a.documentElement,a.body,b[0]]);d.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},
getControls:function(){return this.__controls},addControl:function(a,b){this.__controls[a]=b},showDialog:function(a,b){var a=a+"/dialog",c=this.__controls[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},execCommand:function(a){var b=this.__commands[a],c=d.makeArray(arguments);c.shift();c.unshift(this);if(b)return b.exec.apply(b,c)},_getData:function(a,b){var c=this.htmlDataProcessor,
e;b==t&&(b=this.get("mode"));e=b==C?this.get("document")[0].body.innerHTML:c.toDataFormat(this.get("textarea").val());e=a?c.toHtml(e):c.toServer(e);e=d.trim(e);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(e)&&(e="");return e},_setData:function(a){var b,c=a;if(this.get("mode")!=C)this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a,"p");if(this.get("iframe")){a=this.get("iframe");b=this.get("window")[0];var e=this.get("document")[0];z.remove([e,e.documentElement,e.body,
b]);a.remove()}r(this,c)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return p(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getSelection:function(){return f.Selection.getSelection(this.get("document")[0])},focus:function(){var a=this.get("document")[0],b=u._getWin(a);v.ie||b&&b.parent&&b.parent.focus();b&&b.focus();a.body.focus();this.notifySelectionChange()},blur:function(){u._getWin(this.get("document")[0]).blur();this.get("document")[0].body.blur()},
addCustomStyle:function(a,b){var c=this.get("customStyle")||"",c=c+("\n"+a);this.set("customStyle",c);u.addStyleSheet(this.get("window"),c,b)},removeCustomStyle:function(a){u.remove(u.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var b=this.get("customLink")||[],c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);b.href=a},removeCustomLink:function(a){for(var b=this.get("document")[0],
b=u.query("link",b),c=0;c<b.length;c++)u.attr(b[c],"href")==a&&u.remove(b[c]);b=this.get("customLink")||[];a=d.indexOf(a,b);-1!=a&&b.splice(a,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=b.getStartElement(),e=new f.ElementPath(c);if(!a.__previousPath||!a.__previousPath.compare(e))a.__previousPath=
e,a.fire("selectionChange",{selection:b,path:e,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(this.get("mode")===C){this.focus();var b,c=a.nodeName(),e=f.XHTML_DTD,d=e.$block[c],g=f.RANGE,h=(c=this.getSelection())&&c.getRanges(),k,m,l;if(h&&0!=h.length){this.execCommand("save");for(m=h.length-1;0<=m;m--)k=h[m],b=!m&&a||a.clone(w),k.insertNodeByDtd(b),l||(l=b);if(l)return k.moveToPosition(l,g.POSITION_AFTER_END),
d&&(a=f.Walker.whitespaces(!0),(a=(l=l.next(a,1))&&l[0].nodeType==u.ELEMENT_NODE&&l.nodeName())&&e.$block[a]&&e[a]["#"]&&k.moveToElementEditablePosition(l)),c.selectRanges([k]),this.focus(),b&&b.scrollIntoView(t,!1),n(this),b}}},insertHtml:function(a,b){var c=this,e;if(c.get("mode")===C){if(e=c.htmlDataProcessor)a=e.toDataFormat(a,null,b);c.focus();c.execCommand("save");var d=c.get("document")[0];e=0;if(x){var g=d.selection;"Control"==g.type&&g.clear();try{g.createRange().pasteHTML(a)}catch(h){}}else try{d.execCommand("inserthtml",
o,a)}catch(k){setTimeout(function(){if(0==c.getSelection().getRanges().length){var b=new f.Range(d),e=u.first(d.body,function(a){return 1==a.nodeType&&"br"!=u.nodeName(a)});e||(e=new B(d.createElement("p")),e._4e_appendBogus(t),d.body.appendChild(e[0]));b.setStartAt(e,f.RANGE.POSITION_AFTER_START);b.select()}d.execCommand("inserthtml",o,a)},e=100)}setTimeout(function(){c.getSelection().scrollIntoView()},e);n(c,e)}}});f._initIFrame=function(a){var b=i.getInstance(a),c=b.get("document")[0],a=c.getElementById("ke_active_script");
u.remove(a);q(b);var e=c.body;x?(e.hideFocus=w,e.disabled=w,e.contentEditable=w,e.removeAttribute("disabled")):setTimeout(function(){v.gecko||v.opera?e.contentEditable=w:v.webkit?e.parentNode.contentEditable=w:c.designMode="on"},0);if(v.gecko||v.opera){var d=c.documentElement;z.on(d,"mousedown",function(a){if(a.target==d){v.gecko&&k(c,o);b.activateGecko()}})}setTimeout(function(){x&&setTimeout(function(){if(c){e.runtimeStyle.marginBottom="0px";e.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){b.__docReady=
1;b.fire("docReady");var a=b.get("disableObjectResizing"),d=b.get("disableInlineTableEditing");if(a||d)try{c.execCommand("enableObjectResizing",o,!a);c.execCommand("enableInlineTableEditing",o,!d)}catch(g){z.on(e,x?"resizestart":"resize",function(b){var c=new B(b.target);(a||c.nodeName()==="table"&&d)&&b.preventDefault()})}},10)};return f},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/meta,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(d,f){var j={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(d){d.hasCommand("backColor")||d.addCommand("backColor",{exec:function(d,a){d.execCommand("save");f.applyColor(d,a,j);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(d,f,j,i){function h(a){this.config=a||{}}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("backColor",{cmdType:"backColor",tooltip:"\u80cc\u666f\u989c\u8272",pluginConfig:this.config},j)}});return h},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/bold/cmd",function(d,f,j){var i=new f.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(d){j.addButtonCmd(d,"bold",i)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/bold/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("bold",{cmdType:"bold",tooltip:"\u7c97\u4f53 "},j.Button)}});return h},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubble/index",function(d,f,j){function i(a){var c=null,e=a.get("editor").getControls();d.each(e,function(e){var d;if(d=e.get)if(d=-1!=(e.get("elCls")||"").indexOf("bubble"))if(d=e!==a)if(d=e.get("visible")){d=a.get("y");var f=d+a.get("el").outerHeight(),h=e.get("y"),g=h+e.get("el").outerHeight();d=d<=g&&f>=g||d<=h&&f>=h}d&&(c?c.get("y")<e.get("y")&&(c=e):c=e);return c})}var h=d.Event,a={}.a,e=d.DOM,c={zIndex:j.baseZIndex(j.zIndexManager.BUBBLE_VIEW),elCls:"ks-editor-bubble",
prefixCls:"ks-editor-",effect:{effect:"fade",duration:0.3}};j.prototype.addBubble=function(b,m,l){function k(){r.hide();var a=g.get("window")[0];h.remove(a,"scroll",p)}function j(){var b;var c=r,d=c.get("editorSelectedEl");if(d){var c=c.get("editor"),g=c.get("window")[0],f=c.get("iframe").offset(),c=f.top,f=f.left,h=f+e.width(g),g=c+e.height(g),k=d.offset(a,window),l=k.top,k=k.left,m=k+d.width(),d=l+d.height(),q;d>g&&l<g?q=g-30:d>c&&d<g&&(q=d);m>f&&k<f?b=f:k>f&&k<h&&(b=k);b=b!==a&&q!==a?[b,q]:a}else b=
a;if(b){r.set("xy",b);if(q=i(r))b[1]=q.get("y")+q.get("el").outerHeight(),r.set("xy",b);r.get("visible")||r.show()}}function p(){r.get("editorSelectedEl")&&(r.get("el"),r.hide(),w())}function n(){var a=g.get("window")[0];h.on(a,"scroll",p);j()}var g=this,r,l=l||{};l.editor=g;d.mix(l,c);r=new f(l);g.addControl(b+"/bubble",r);g.on("selectionChange",function(a){var a=a.path,b=a.elements;if(a&&b&&(a=a.lastElement))(a=m(a))?(r.set("editorSelectedEl",a),r.hide(),d.later(n,10)):k()});g.on("sourceMode",k);
var w=d.buffer(j,350)}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(d,f,j){f.prototype.addButton=function(i,h,a){void 0===a&&(a=j);var e=this.get("prefixCls")+"editor-",c=new a(d.mix({render:this.get("toolBarEl"),elAttrs:{hideFocus:"hideFocus"},autoRender:!0,content:'<span class="'+e+"toolbar-item "+e+"toolbar-"+i+'"></span>',elCls:e+"toolbar-button",prefixCls:e,editor:this},h)),b=c.get("el").one("span");c.get("el").unselectable();c.on("afterContentClsChange",function(a){b[0].className=e+"toolbar-item "+e+"toolbar-"+
a.newVal});c.get("mode")==f.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){c.set("disabled",!1)}),this.on("sourceMode",function(){c.set("disabled",!0)}));this.addControl(i+"/button",c);return c};return j},{requires:["editor","button"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(d,f){function j(a){this.editor=a;this._init()}function i(){}var h=d.Node,a=f.SOURCE_MODE,e=f.WYSIWYG_MODE;d.augment(j,{_init:function(){var a=this.editor,b=a.get("statusBarEl");this.holder=(new h("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(b);(this.el=this.holder.one("input")).on("click",
this._check,this);a.on("wysiwygMode",this._wysiwygmode,this);a.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var c=this.editor;this.el.attr("checked")?c.set("mode",a):c.set("mode",e)},destroy:function(){this.holder.remove()}});d.augment(i,{renderUI:function(a){var b=new j(a);a.on("destroy",function(){b.destroy()})}});return i},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(d,f,j,i,h){var a=d.Node;d.DOM.addStyleSheet(window,".ks-editor-color-panel a {display: block;color:black;text-decoration: none;}.ks-editor-color-panel a:hover {color:black;text-decoration: none;}.ks-editor-color-panel a:active {color:black;}.ks-editor-color-palette {    margin: 5px 8px 8px;}.ks-editor-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ks-editor-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ks-editor-color-a {    height: 18px;    width: 18px;}a.ks-editor-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ks-editor-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ks-editor-color-remove:hover {    background-color: #D6E9F8;}",
"ks-editor-color-plugin");var e=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],c;(function(){c="<div class='ks-editor-color-panel'><a class='ks-editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var a=0;3>a;a++){c+="<div class='ks-editor-color-palette'><table>";for(var d=e[a],f=d.length/8,h=0;h<f;h++){c+="<tr>";for(var i=0;8>i;i++){var j="#"+d[8*h+i];c+="<td>";c+="<a href='javascript:void(0);' class='ks-editor-color-a' style='background-color:"+j+"'></a>";c+="</td>"}c+="</tr>"}c+="</table></div>"}c+="<div><a class='ks-editor-button ks-editor-color-others ks-inline-block'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();return j.extend({initializer:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.colorWin&&
a.colorWin.hide()},150)});a.on("click",function(){a.get("checked")?a._prepare():a.colorWin&&a.colorWin.hide()})},_prepare:function(){var a=this,e=a.get("editor"),d;a.colorWin=new i({elAttrs:{tabindex:0},elCls:"ks-editor-popup",content:c,autoRender:!0,width:170,zIndex:f.baseZIndex(f.zIndexManager.POPUP_MENU)});var k=a.colorWin;d=k.get("contentEl");d.on("click",a._selectColor,a);k.on("hide",function(){a.set("checked",!1)});d.one(".ks-editor-color-others").on("click",function(c){c.halt();k.hide();h.useDialog(e,
"color/colorPicker",a.get("pluginConfig"),a.get("cmdType"))});a._prepare=a._show;a._show()},_show:function(){var a=this.get("el"),c=this.colorWin;c.align(a,["bl","tl"],[0,2]);c.show()},_selectColor:function(b){b.halt();b=new a(b.target);b.hasClass("ks-editor-color-a")&&this.get("editor").execCommand(this.get("cmdType"),b.style("background-color"))},destructor:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{checkable:{value:!0},mode:{value:f.WYSIWYG_MODE}}})},{requires:["editor","../button/",
"../overlay/","../dialogLoader/"]});KISSY.add("editor/plugin/color/cmd",function(d,f){return{applyColor:function(d,i,h){var a=d.get("document")[0];d.execCommand("save");i?(new f.Style(h,{color:i})).apply(a):(new f.Style(h,{color:"inherit"})).remove(a);d.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(d,f,j,i){f.prototype.addContextMenu=function(h,a,e){var c=this,e=e||{};e.prefixCls=c.get("prefixCls")+"editor-";e.editor=c;e.focusable=1;e.zIndex=f.baseZIndex(f.zIndexManager.POPUP_MENU);e.elAttrs={hideFocus:"hideFocus"};e.children&&d.each(e.children,function(a){a.xclass="menuitem"});var b=new j.PopupMenu(e);i.init(b);c.docReady(function(){var e=c.get("document");e.on("mousedown",function(a){1==a.which&&b.hide()});e.delegate("contextmenu",a,function(a){var h=
d.all(a.target);a.halt();var i=a.pageX,j=a.pageY,a=i?f.Utils.getXY(i,j,e[0],document):h.offset(document),i=a.left,j=a.top;setTimeout(function(){b.set("editorSelectedEl",h,{silent:1});b.set("xy",[i,j]);b.show();c.fire("contextmenu",{contextmenu:b});window.focus();document.body.focus();b.get("el")[0].focus()},30)})});c.addControl(h+"/contextmenu",b);return b}},{requires:["editor","menu","../focusFix/"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(d,f,j){function i(a){return a.nodeType==b.ELEMENT_NODE&&"li"==b.nodeName(a)}function h(a,c,d){for(var h=a.startContainer,i=a.endContainer;h&&!h.parent().equals(c);)h=h.parent();for(;i&&!i.parent().equals(c);)i=i.parent();if(h&&i){for(var q=h,h=[],n=!1;!n;)q.equals(i)&&(n=!0),h.push(q),q=q.next();if(!(1>h.length)){var p=c._4e_parents(!0,void 0);p.each(function(a,b){p[b]=a});for(i=0;i<p.length;i++)if(e[p[i].nodeName()]){c=p[i];break}for(var q="indent"==
d?1:-1,i=h[0],n=h[h.length-1],h={},u=j.listToArray(c,h),B=u[n.data("listarray_index")].indent,i=i.data("listarray_index");i<=n.data("listarray_index");i++){u[i].indent+=q;var z=u[i].parent;u[i].parent=new m(z[0].ownerDocument.createElement(z.nodeName()))}for(i=n.data("listarray_index")+1;i<u.length&&u[i].indent>B;i++)u[i].indent+=q;n=j.arrayToList(u,h,null,"p");q=[];if("outdent"==d){var D;if((D=c.parent())&&"li"==D.nodeName())for(var d=n.listNode.childNodes,A,i=d.length-1;0<=i;i--)(A=new m(d[i]))&&
"li"==A.nodeName()&&q.push(A)}n&&(b.insertBefore(n.listNode[0]||n.listNode,c[0]||c),c.remove());if(q&&q.length)for(i=0;i<q.length;i++){for(A=c=q[i];(A=A.next())&&A.nodeName()in e;)l.ie&&!c.first(function(a){return k(a)&&g(a)},1)&&c[0].appendChild(a.document.createTextNode("\u00a0")),c[0].appendChild(A[0]);b.insertAfter(c[0],D[0])}f.Utils.clearAllMarkers(h)}}}function a(a,b){var c=parseInt(a.style(q),10);isNaN(c)&&(c=0);c+=("indent"==b?1:-1)*p;if(0>c)return!1;c=Math.max(c,0);c=Math.ceil(c/p)*p;a.css(q,
c?c+n:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var e={ol:1,ul:1},c=f.Walker,b=d.DOM,m=d.Node,l=d.UA,k=c.whitespaces(!0),q="margin-left",p=40,n="px",g=c.bookmark(!1,!0);return{checkOutdentActive:function(a){var b=a.blockLimit;return a.contains(e)?!0:(a=a.block||b)&&a.style(q)},addCommand:function(d,g){d.hasCommand(g)||d.addCommand(g,{exec:function(d){d.execCommand("save");var f=d.getSelection(),k=f&&f.getRanges()[0];if(k){for(var l=k.startContainer,m=k.endContainer,j=k.getCommonAncestor();j&&
!(j[0].nodeType==b.ELEMENT_NODE&&e[j.nodeName()]);)j=j.parent();j&&l[0].nodeType==b.ELEMENT_NODE&&l.nodeName()in e&&(l=new c(k),l.evaluator=i,k.startContainer=l.next());j&&m[0].nodeType==b.ELEMENT_NODE&&m.nodeName()in e&&(l=new c(k),l.evaluator=i,k.endContainer=l.previous());m=f.createBookmarks(!0);if(j){for(l=j.first();l&&"li"!=l.nodeName();)l=l.next();var q=k.startContainer;(!(l[0]==q[0]||l.contains(q))||!a(j,g))&&h(k,j,g)}else{k=k.createIterator();k.enforceRealBlocks=!0;for(k.enlargeBr=!0;j=k.getNextParagraph();)a(j,
g)}f.selectBookmarks(m)}d.execCommand("save");d.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(d,f,j){var i,h={loading:function(){i||(i=new f({x:0,width:6==d.UA.ie?d.DOM.docWidth():"100%",y:0,zIndex:j.baseZIndex(j.zIndexManager.LOADING),prefixCls:"ks-editor-",elCls:"ks-editor-global-loading"}));i.set("height",d.DOM.docHeight());i.show();i.loading()},unloading:function(){i.hide()}};return{useDialog:function(a,e,c,b){a.focus();a.getControl(e+"/dialog")?setTimeout(function(){a.showDialog(e,b)},0):(h.loading(),d.use("editor/plugin/"+e+"/dialog",
function(d,f){h.unloading();a.addControl(e+"/dialog",new f(a,c));a.showDialog(e,b)}))}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(d,f,j,i,h){function a(a,b,c){for(a+="";a.length<b;)a=c+a;return a}function e(b){d.isNumber(b)&&(b=new Date(b));return b instanceof Date?[b.getFullYear(),"-",a(b.getMonth()+1,2,"0"),"-",a(b.getDate(),2,"0")," ",a(b.getHours(),2,"0"),":",a(b.getMinutes(),2,"0"),":",a(b.getSeconds(),2,"0")].join(""):b}function c(a,b){this.editor=a;this.config=b;this._init()}function b(a,b){var e=new c(a,b);a.on("destroy",function(){e.destroy()})}function m(a){this.config=
a||{}}var l=d.Node,k=d.Event,q=d.JSON,p=f.Utils.addRes,n=f.Utils.destroyRes;d.augment(c,{_getSaveKey:function(){var a=this.config;return a.draft&&a.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var a=j.getItem(this._getSaveKey()),b=[];a&&(b=j==window.localStorage?q.parse(decodeURIComponent(a)):a);this.drafts=b}return this.drafts},_init:function(){var a=this,b=a.editor,c=b.get("statusBarEl"),e=this.config;e.draft=e.draft||{};a.draftInterval=e.draft.interval=
e.draft.interval||5;a.draftLimit=e.draft.limit=e.draft.limit||5;c=(new l("<div class='ks-editor-draft'><span class='ks-editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+e.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(c);a.timeTip=(new l("<span class='ks-editor-draft-time'/>")).appendTo(c);var d=(new l("<a href='#' onclick='return false;' class='ks-editor-button ks-editor-draft-save-btn ks-inline-block' style='vertical-align:middle;padding:1px 9px;'><span class='ks-editor-draft-save'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(c),
i=new h({render:c,width:"100px",prefixCls:"ks-editor-",menuCfg:{width:"225px",align:{points:["tr","br"]}},autoRender:!0,content:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});a.versions=i;i.on("beforeCollapsedChange",function(b){b.newValue||(i.detach("beforeCollapsedChange",arguments.callee),a.sync())});d.on("click",function(b){a.save(!1);b.halt()});p.call(a,d);b.get("textarea")[0].form&&function(){function c(){a.save(!0)}var e=b.get("textarea")[0].form;k.on(e,"submit",c);p.call(a,function(){k.remove(e,"submit",c)})}();var m=setInterval(function(){a.save(!0)},
6E4*a.draftInterval);p.call(a,function(){clearInterval(m)});i.on("click",a.recover,a);p.call(a,i);a.holder=c;if(e.draft.helpHtml){var j=(new l('<a tabindex="0" hidefocus="hidefocus" class="ks-editor-draft-help" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(c);j.on("click",function(){j[0].focus();a.helpPopup&&a.helpPopup.get("visible")?a.helpPopup.hide():a._prepareHelp()});j.on("blur",function(){a.helpPopup&&a.helpPopup.hide()});a.helpBtn=j;p.call(a,j);f.Utils.lazyRun(a,
"_prepareHelp","_realHelp")}p.call(a,c)},_prepareHelp:function(){var a=new l(this.config.draft.helpHtml||""),b=new l("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
a.append(b);a.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new i({content:a,prefixCls:"ks-editor-",autoRender:!0,width:a.width()+"px",zIndex:f.baseZIndex(f.zIndexManager.OVERLAY),mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=b},_realHelp:function(){var a=this.helpPopup,b=this.helpBtn,c=a.arrow;a.show();b=b.offset();a.get("el").offset({left:b.left-a.get("el").width()+17,top:b.top-a.get("el").height()-7});c.offset({left:b.left-2,top:b.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var a;a=this.draftLimit;var b=this.timeTip,c=this.versions,d=this._getDrafts(),f;d.length>a&&d.splice(0,d.length-a);for(a=0;a<d.length;a++)f=d[a],f=(f.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+e(f.date),c.addItem({xclass:"menuitem",content:f,value:a});b.html(f);j.setItem(this._getSaveKey(),j==window.localStorage?encodeURIComponent(q.stringify(d)):d)},save:function(a){var b=this._getDrafts(),
c=this.editor.get("formatData");c&&(b[b.length-1]&&c==b[b.length-1].content&&(b.length-=1),this.drafts=b.concat({content:c,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var b=this.editor,c=this._getDrafts(),d=a.target.get("value");confirm("\u786e\u8ba4\u6062\u590d "+e(c[d].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(b.execCommand("save"),b.set("data",c[d].content),b.execCommand("save"));this.versions.set("collapsed",!0);a.halt()},destroy:function(){n.call(this)}});d.augment(m,{renderUI:function(a){j.ready?j.ready(function(){b(a,
this.config)}):b(a,this.config)}});return m},{requires:["editor","../localStorage/","overlay","../menubutton/"]});
KISSY.add("editor/plugin/dragUpload/index",function(d,f){function j(a){this.config=a||{}}var i=d.Node,h=d.Event,a=f.Utils,e=d.DOM;d.augment(j,{renderUI:function(c){function b(a){a=a.originalEvent.target;"img"==e.nodeName(a)&&a.src.match(/^file:\/\//)&&(r[a.src]=a)}function m(a,b){var c=new window.FileReader;c.onload=function(e){var d=a.name,e=e.target.result,g=new XMLHttpRequest;g.open("POST",n,!0);g.onreadystatechange=function(){if(4==g.readyState){if(200==g.status||304==g.status){if(""!=g.responseText){var a=
window.JSON.parse(g.responseText);b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();g.onreadystatechange=null}};d="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+k+'"; filename="'+encodeURIComponent(d)+'"\r\n');d+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";d+=e+"\r\n";p=f.Utils.normParams(p);for(var h in p)p.hasOwnProperty(h)&&(d+="------kissy-editor-yiminghe\r\n",d+='Content-Disposition: form-data; name="'+h+'"\r\n\r\n',d+=p[h]+"\r\n");d+="------kissy-editor-yiminghe--";
g.setRequestHeader("Content-Type","multipart/form-data, boundary=----kissy-editor-yiminghe");g.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+d.length+"\r\n"+d+"\r\n");c.onload=null};c.readAsBinaryString(a)}var l=this.config,k=l.fileInput||"Filedata",j=l.sizeLimit||Number.MAX_VALUE,p=l.serverParams||{},n=l.serverUrl||"",g=RegExp((l.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),r={},w=!1;c.docReady(function(){var f=c.get("document")[0];
h.on(f,"dragenter",function(){w||(h.on(f,"DOMNodeInserted",b),w=!0)});h.on(f,"drop",function(c){h.remove(f,"DOMNodeInserted",b);w=!1;c.halt();var c=c.originalEvent,k,l;d.isEmptyObject(r)?(l=f.elementFromPoint(c.clientX,c.clientY),k=l.lastChild):(d.each(r,function(a){"img"==e.nodeName(a)&&(k=a.nextSibling,l=a.parentNode,e.remove(a))}),r={});c=c.dataTransfer;c.dropEffect="copy";if(c=c.files)for(var n=0;n<c.length;n++){var p=c[n],u=p.size;if(p.name.match(g)&&!(u/1E3>j)){var u=new i("<img src='"+a.debugUrl("theme/tao-loading.gif")+
"'/>"),B=u[0];l.insertBefore(B,k);var z=e.nodeName(B.parentNode);("head"==z||"html"==z)&&e.insertBefore(B,f.body.firstChild);m(p,u)}}})});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var c=new (window.BlobBuilder||window.WebKitBlobBuilder),e=a.length,d=new window.Uint8Array(e),g=0;g<e;g++)d[g]=a.charCodeAt(g);c.append(d.buffer);this.send(c.getBlob(b))})}});return j},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(d,f){function j(a){this.cfg=a;this._cache=[];this._init()}function i(){}var h=d.Node;d.augment(j,{_init:function(){var a=this.cfg.editor;this.holder=new h("<span>");this.holder.appendTo(a.get("statusBarEl"),void 0);a.on("selectionChange",this._selectionChange,this);f.Utils.sourceDisable(a,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(a){var e=this.cfg.editor,
c=this.holder,a=a.path.elements,b,d;b=this._cache;for(d=0;d<b.length;d++)b[d].remove();this._cache=[];for(d=0;d<a.length;d++){b=a[d];var f=b.attr("_ke_real_element_type")||b.nodeName(),k=new h("<a href='javascript(\""+f+"\")' class='ks-editor-element-path'>"+f+"</a>");this._cache.push(k);(function(a){k.on("click",function(b){b.halt();e.focus();setTimeout(function(){e.getSelection().selectElement(a)},50)})})(b);c.prepend(k)}},destroy:function(){this.holder.remove()}});d.augment(i,{renderUI:function(a){var e=
new j({editor:a});a.on("destroy",function(){e.destroy()})}});return i},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(d,f){var j=d.Node,i=d.DOM,h=f.Utils.debugUrl("theme/spacer.gif"),a=d.require("htmlparser");d.augment(f,{createFakeElement:function(a,b,e,f,k,i){var p=a.attr("style")||"";a.attr("width")&&(p="width:"+a.attr("width")+"px;"+p);a.attr("height")&&(p="height:"+a.attr("height")+"px;"+p);var n=d.trim(a.attr("class")),a={"class":b+" "+n,src:h,_ke_realelement:encodeURIComponent(k||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:p};i&&delete i.width;
i&&delete i.height;i&&d.mix(a,i,!1);e&&(a._ke_real_element_type=e);f&&(a._ke_resizable=f);return new j("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=i.ELEMENT_NODE)return null;var a=decodeURIComponent(a.attr("_ke_realelement")),b=new j("<div>",null,this.get("document")[0]);b.html(a);return b.first().remove()}});var e={tags:{$:function(c){var b=c.getAttribute("_ke_realelement"),e;b&&(e=(new a.Parser(decodeURIComponent(b))).parse());if(b=e&&e.childNodes[0]){if(e=
c.getAttribute("style")){var d=/(?:^|\s)width\s*:\s*(\d+)/i.exec(e),c=d&&d[1];e=(d=/(?:^|\s)height\s*:\s*(\d+)/i.exec(e))&&d[1];c&&b.setAttribute("width",c);e&&b.setAttribute("height",e)}return b}}}};return{init:function(c){var b=(c=c.htmlDataProcessor)&&c.htmlFilter;c.createFakeParserElement||(b&&b.addRules(e),d.mix(c,{createFakeParserElement:function(b,c,e,f,i){var j;j=new a.BasicWriter;b.writeHtml(j);j=j.getHtml();var g=b.getAttribute("style")||"";b.getAttribute("width")&&(g="width:"+b.getAttribute("width")+
"px;"+g);b.getAttribute("height")&&(g="height:"+b.getAttribute("height")+"px;"+g);var r=d.trim(b.getAttribute("class")),b={"class":c+" "+r,src:h,_ke_realelement:encodeURIComponent(j),_ke_real_node_type:b.nodeType+"",style:g,align:b.getAttribute("align")||""};i&&delete i.width;i&&delete i.height;i&&d.mix(b,i,!1);e&&(b._ke_real_element_type=e);f&&(b._ke_resizable="_ke_resizable");return new a.Tag("img",b)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(d,f,j){function i(a){this._init(a)}function h(b){var c=d.isString(b)?b.match(/(\d)+/g):b;d.isArray(c)&&(b=parseFloat(c[0]+"."+a(c[1],3)+a(c[2],5)));return b||0}function a(a,b){for(var c=(a+"").length;c++<b;)a="0"+a;return a}var e={};d.augment(i,d.EventTarget,{_init:function(a){var b=d.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var c=a.flashVars,f=a.params;d.mix(a.attrs,{id:b,width:"100%",height:"100%"},
!1);d.mix(f,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);d.mix(c,{shareData:!1,useCompression:!1},!1);f={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(f={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});d.mix(c,f);e[b]=this;this.id=b;this.swf=j.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var b=this,c=0;c<a.length;c++)(function(a){b[a]=function(){return b._callSWF(a,d.makeArray(arguments))}})(a[c])},
_callSWF:function(a,b){b=b||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,b)}catch(c){var e="";0!==b.length&&(e="'"+b.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+e+");"))(this)}},_eventHandler:function(a){var b=a.type;"log"!==b&&b&&this.fire(b,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete e[this.id]}});i.EventHandler=function(a,b){var c=e[a];c&&setTimeout(function(){c._eventHandler.call(c,b)},100)};f.FlashBridge=
i;var c=d.UA,b,m,l=!0;c.fpv=function(a){if(a||l){l=!1;var c;if(navigator.plugins&&navigator.mimeTypes.length)c=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{c=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(e){}b=!c?void 0:c.match(/(\d)+/g);m=h(b)}return b};c.fpvGEQ=function(a,b){l&&c.fpv(b);return!!m&&m>=h(a)};return i},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(d,f,j,i,h,a){function e(){e.superclass.constructor.apply(this,arguments);this._init()}var c=d.Node;e.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}};d.extend(e,d.Base,{_init:function(){var a=this,c=a.get("cls"),e=a.get("editor"),h=[],i=a.get("bubbleId"),j=a.get("contextMenuId"),n=a.get("contextMenuHandlers");d.each(n,function(a,b){h.push({content:b})});e.addContextMenu(j,"."+c,{width:"120px",
children:h,listeners:{click:function(a){a=a.target.get("content");n[a]&&n[a].call(this)}}});e.addBubble(i,function(a){return a.hasClass(c,void 0)&&a},{listeners:{afterRenderUI:function(){var c=this,h=c.get("contentEl");h.html(d.substitute(' <a class="ks-editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="ks-editor-bubble-link ks-editor-bubble-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubble-link ks-editor-bubble-remove">\u5220\u9664</span>',{label:a.get("label")}));var i=h.one(".ks-editor-bubble-url"),
k=h.one(".ks-editor-bubble-change"),j=h.one(".ks-editor-bubble-remove");f.Utils.preventFocus(h);k.on("click",function(e){a.show(c.get("editorSelectedEl"));e.halt()});j.on("click",function(a){if(d.UA.webkit){var b=e.getSelection().getRanges();if(b=b&&b[0])b.collapse(!0),b.select()}c.get("editorSelectedEl").remove();c.hide();e.notifySelectionChange();a.halt()});c.on("show",function(){var e=c.get("editorSelectedEl");e&&a._updateTip(i,e)})}}});e.docReady(function(){e.get("document").on("dblclick",a._dbClick,
a)})},_getFlashUrl:function(b){return a.getUrl(b)},_updateTip:function(a,c){var e=this.get("editor").restoreRealElement(c);e&&(e=this._getFlashUrl(e),a.attr("href",e))},_dbClick:function(a){var e=new c(a.target);"img"===e.nodeName()&&e.hasClass(this.get("cls"),void 0)&&(this.show(e),a.halt())},show:function(a){var c=this.get("editor");h.useDialog(c,this.get("type"),this.get("pluginConfig"),a)}});return e},{requires:["editor","../contextmenu/","../bubble/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(d){var f=d.DOM,j=d.Node,i=d.UA,h={insertFlash:function(a,e,c,b,d){e=h.createSWF(e,{attrs:c},a.get("document")[0]);c=a.createFakeElement(e.el,b||"ke_flash",d||"flash",!0,e.html,c);a.insertElement(c);return c},isFlashEmbed:function(a){return"application/x-shockwave-flash"==a.getAttribute("type")||/\.swf(?:$|\?)/i.test(a.getAttribute("src")||"")},getUrl:function(a){var e="";if("object"==a.nodeName())for(var a=a[0].childNodes,c=0;c<a.length;c++)1==
a[c].nodeType&&("movie"==(f.attr(a[c],"name")||"").toLowerCase()?e=f.attr(a[c],"value"):"embed"==f.nodeName(a[c])?e=f.attr(a[c],"src"):"object"==f.nodeName(a[c])&&(e=f.attr(a[c],"data")));else"embed"==a.nodeName()&&(e=a.attr("src"));return e},createSWF:function(a,e,c){var b=e.attrs||{},f=e.flashVars,h="",i="",e=e.params||{},q="",c=c||document;d.mix(b,{wmode:"transparent"});for(var p in b)b.hasOwnProperty(p)&&(h+=p+"='"+b[p]+"' ");d.mix(e,{quality:"high",movie:a,wmode:"transparent"});for(var n in e)e.hasOwnProperty(n)&&
(i+="<param name='"+n+"' value='"+e[n]+"'/>");if(f){for(var g in f)f.hasOwnProperty(g)&&(q+="&"+g+"="+encodeURIComponent(f[g]));q=q.substring(1)}a="<object "+h+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+i+(q?'<param name="flashVars" value="'+q+'"/>':"")+"<embed "+h+" "+(q?'FlashVars="'+q+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+a+'"  type="application/x-shockwave-flash"/></object>';return{el:new j(a,null,c),html:a}},createSWFRuntime2:function(a,
e,c){var c=c||document,b=(new j("<div style='width:0;height:0;overflow:hidden;'>",null,c)).appendTo(c.body),b=h.createSWF.apply(this,arguments).el.appendTo(b);i.ie||(b=b.one("object"));return b[0]},createSWFRuntime:function(a,e,c){var b=e.attrs||{},h=e.flashVars||{},l=e.params||{},k="",q="",p="",c=c||document;b.id=b.id||d.guid("ks-editor-runtimeflash-");for(var n in b)b.hasOwnProperty(n)&&(k+=n+"='"+b[n]+"' ");for(var g in l)l.hasOwnProperty(g)&&(q+="<param name='"+g+"' value='"+l[g]+"'/>");for(var r in h)h.hasOwnProperty(r)&&
(p+="&"+r+"="+encodeURIComponent(h[r]));var p=p.substring(1),a=i.ie?"<object "+k+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+q+'<param name="movie" value="'+a+'" />'+(p?'<param name="flashVars" value="'+p+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+a+"' "+k+">"+q+(p?'<param name="flashVars" value="'+p+'"/>':"")+"</object>",w=e.holder;w||(w=(new j("<div style='"+(e.style?e.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,c)).appendTo(c.body),
setTimeout(function(){w.offset({left:f.scrollLeft(),top:f.scrollTop()})},100));w.html(a);return c.getElementById(b.id)}};return h});
KISSY.add("editor/plugin/flash/index",function(d,f,j,i){function h(a){this.config=a||{}}d.augment(h,{renderUI:function(a){var e=a.htmlDataProcessor;e.dataFilter.addRules({tags:{object:function(a){var c;if(!a.getAttribute("classid")){var d=a.childNodes;for(c=0;c<d.length;c++)if("embed"==d[c].nodeName)if(i.isFlashEmbed(d[c][c]))break;else return e.createFakeParserElement(a,"ke_flash","flash",!0);return null}return e.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return i.isFlashEmbed(a)?
e.createFakeParserElement(a,"ke_flash","flash",!0):null}}},5);var c=new j({editor:a,cls:"ke_flash",type:"flash",pluginConfig:this.config,bubbleId:"flash",contextMenuId:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&c.show(a)}}});a.addButton("flash",{tooltip:"\u63d2\u5165Flash",listeners:{click:function(){c.show()}},mode:f.WYSIWYG_MODE})}});return h},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/focusFix/index",function(d,f){function j(){var e=this._focusEditor=a.currentInstance();if(h.ie&&e){window.focus();document.body.focus();var c=e.get("document")[0].selection.createRange();c&&c.item&&c.item(0).ownerDocument==e.get("document")[0]&&(e=document.body.createTextRange(),e.moveToElementText(this.get("el").first()[0]),e.collapse(!0),e.select())}}function i(){var a=this._focusEditor;a&&a.focus()}var h=d.UA,a=f.focusManager;return{init:function(a){a.on("beforeVisibleChange",
function(c){c.newVal&&j.call(a)});a.on("hide",function(){i.call(a)})}}},{requires:["editor"]});KISSY.add("editor/plugin/fontFamily/cmd",function(d,f,j){var i={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(d){j.addSelectCmd(d,"fontFamily",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(d,f,j,i){function h(a){this.config=a||{}}d.augment(h,{renderUI:function(a){i.init(a);var e=this.config,c={};d.mix(c,{children:[{content:"\u5b8b\u4f53",value:"SimSun"},{content:"\u9ed1\u4f53",value:"SimHei"},{content:"\u96b6\u4e66",value:"LiSu"},{content:"\u6977\u4f53",value:"KaiTi_GB2312"},{content:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{content:"Georgia",value:"Georgia"},{content:"Times New Roman",value:"Times New Roman"},{content:"Impact",value:"Impact"},{content:"Courier New",value:"Courier New"},
{content:"Arial",value:"Arial"},{content:"Verdana",value:"Verdana"},{content:"Tahoma",value:"Tahoma"}],width:"130px"});d.each(c.children,function(a){var c=a.elAttrs||{},e=a.value;c.style=c.style||"";c.style+=";font-family:"+e;a.elAttrs=c});e.menu=d.mix(c,e.menu);a.addSelect("fontFamily",d.mix({cmdType:"fontFamily",defaultCaption:"\u5b57\u4f53",width:130,mode:f.WYSIWYG_MODE},e),j.Select)}});return h},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(d,f,j){var i={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(d){j.addSelectCmd(d,"fontSize",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(d,f,j,i){function h(a){this.config=a||{}}d.augment(h,{renderUI:function(a){i.init(a);var e=this.config;e.menu=d.mix({children:function(a){var b=[];d.each(a,function(a){b.push({content:a,value:a})});return b}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(","))},e.menu);a.addSelect("fontSize",d.mix({cmdType:"fontSize",defaultCaption:"\u5927\u5c0f",width:"70px",mode:f.WYSIWYG_MODE},e),j.Select)}});return h},{requires:["editor","../font/ui",
"./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(d,f){var j=f.Utils.getQueryCmd;return{addButtonCmd:function(d,f,a){var e=j(f);d.hasCommand(f)||(d.addCommand(f,{exec:function(c,b){var e=c.get("document")[0];c.execCommand("save");b||void 0===b?a.apply(e):a.remove(e);c.execCommand("save");c.notifySelectionChange()}}),d.addCommand(e,{exec:function(c,b){return a.checkActive(b)}}))},addSelectCmd:function(d,h,a){var e=j(h);d.hasCommand(h)||(d.addCommand(h,{exec:function(c,b,e){var b=new f.Style(a,{value:b}),
d=c.get("document")[0];c.execCommand("save");void 0===e||e?b.apply(d):b.remove(d);c.execCommand("save")}}),d.addCommand(e,{exec:function(c,b,e){return(new f.Style(a,{value:b})).checkElementRemovable(e,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(d,f,j,i){var h=f.Utils.getQueryCmd,d=i.Select.extend({initializer:function(){var a=this,e=a.get("editor");a.on("click",function(c){var b=c.target.get("value"),d=a.get("cmdType"),c=c.prevTarget&&c.prevTarget.get("value");e.focus();b==c?e.execCommand(d,b,!1):e.execCommand(d,b)});e.on("selectionChange",function(c){if(e.get("mode")!=f.SOURCE_MODE){var b=c.path,c=h(a.get("cmdType")),d=a.get("menu"),d=d.get&&d.get("children"),b=b.elements;if(d){for(var i=0,k;i<
b.length;i++){k=b[i];for(var j=0;j<d.length;j++){var p=d[j].get("value");if(e.execCommand(c,p,k)){a.set("value",p);return}}}a.set("value",null)}}})}});return{Button:j.extend({initializer:function(){var a=this,e=a.get("editor"),c=a.get("cmdType");a.on("click",function(){a.get("checked")?e.execCommand(c):e.execCommand(c,!1);e.focus()});e.on("selectionChange",function(b){if(e.get("mode")!=f.SOURCE_MODE){var c=h(a.get("cmdType"));e.execCommand(c,b.path)?a.set("checked",!0):a.set("checked",!1)}})}},{ATTRS:{checkable:{value:!0},
mode:{value:f.WYSIWYG_MODE}}}),Select:d}},{requires:["editor","../button/","../menubutton/"]});KISSY.add("editor/plugin/foreColor/cmd",function(d,f){var j={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(d){return!("a"==d.nodeName()||d.all("a").length)}};return{init:function(d){d.hasCommand("foreColor")||d.addCommand("foreColor",{exec:function(d,a){d.execCommand("save");f.applyColor(d,a,j);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(d,f,j,i){function h(a){this.config=a||{}}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("foreColor",{cmdType:"foreColor",tooltip:"\u6587\u672c\u989c\u8272",pluginConfig:this.config},j)}});return h},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(d,f){return{init:function(d){if(!d.hasCommand("heading")){d.addCommand("heading",{exec:function(d,a){d.execCommand("save");(new f.Style({element:a})).apply(d.get("document")[0]);d.execCommand("save")}});var i=f.Utils.getQueryCmd("heading");d.addCommand(i,{exec:function(d,a,e){return(new f.Style({element:e})).checkActive(a)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(d,f,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);var a=[],e={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},c={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},b;for(b in e)e.hasOwnProperty(b)&&a.push({content:b,value:e[b],elAttrs:{style:"font-size:"+c[e[b]]}});d.addSelect("heading",{defaultCaption:"\u6807\u9898",width:"120px",menu:{children:a},mode:f.WYSIWYG_MODE,listeners:{click:function(a){var b=
a.target.get("value"),a=a.prevTarget&&a.prevTarget.get("value");b!=a?d.execCommand("heading",b):(d.execCommand("heading","p"),this.set("value","p"))},afterSyncUI:function(){d.on("selectionChange",function(a){if(d.get("mode")!=f.SOURCE_MODE){var a=a.path,b=f.Utils.getQueryCmd("heading"),e;for(e in c)if(c.hasOwnProperty(e)&&d.execCommand(b,a,e)){this.set("value",e);break}}})}}})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(d,f,j,i,h,a){function e(a){this.config=a||{}}var c=d.UA,b=d.Node,m=d.all,l=d.Event,k=function(a){a=m(a);if("img"===a.nodeName()&&!/(^|\s+)ke_/.test(a[0].className))return a};d.augment(e,{renderUI:function(e){function h(b){a.useDialog(e,"image",i.config,b)}var i=this;e.addButton("image",{tooltip:"\u63d2\u5165\u56fe\u7247",listeners:{click:function(){h(null)}},mode:f.WYSIWYG_MODE});var g=[{content:"\u56fe\u7247\u5c5e\u6027",fn:function(){var a=k(this.get("editorSelectedEl"));a&&(this.hide(),
h(m(a)))}},{content:"\u63d2\u5165\u65b0\u884c",fn:function(){this.hide();var a=e.get("document")[0],d=new b(a.createElement("p"));c.ie||d._4e_appendBogus(void 0);a=new f.Range(a);a.setStartAfter(this.get("editorSelectedEl"));a.select();e.insertElement(d);a.moveToElementEditablePosition(d,1);a.select()}}],j=[];d.each(g,function(a){j.push({content:a.content})});e.addContextMenu("image",k,{width:120,children:j,listeners:{click:function(a){var b=this,c=a.target.get("content");d.each(g,function(a){a.content==c&&a.fn.call(b)})}}});
e.docReady(function(){l.on(e.get("document")[0],"dblclick",function(a){a.halt();a=m(a.target);k(a)&&h(a)})});e.addBubble("image",k,{listeners:{afterRenderUI:function(){var a=this,b=a.get("contentEl");b.html('<a class="ks-editor-bubble-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ks-editor-bubble-link ks-editor-bubble-change" href="#">\u7f16\u8f91</a>  |  <a class="ks-editor-bubble-link ks-editor-bubble-remove" href="#">\u5220\u9664</a>');var d=b.one(".ks-editor-bubble-url"),g=b.one(".ks-editor-bubble-change"),
i=b.one(".ks-editor-bubble-remove");f.Utils.preventFocus(b);g.on("click",function(b){h(a.get("editorSelectedEl"));b.halt()});i.on("click",function(b){if(c.webkit){var d=e.getSelection().getRanges();d&&d[0]&&(d[0].collapse(),d[0].select())}a.get("editorSelectedEl").remove();a.hide();e.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");b&&(b=b.attr("_ke_saved_src")||b.attr("src"),d.attr("href",b))})}}})}});return e},{requires:["editor","../button/","../bubble/",
"../contextmenu/","../dialogLoader/"]});KISSY.add("editor/plugin/indent/cmd",function(d,f,j){var i=j.addCommand;return{init:function(d){i(d,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(d,f,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("indent",{tooltip:"\u589e\u52a0\u7f29\u8fdb\u91cf ",listeners:{click:function(){d.execCommand("indent");d.focus()}},mode:f.WYSIWYG_MODE})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(d,f,j){var i=new f.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(d){j.addButtonCmd(d,"italic",i)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("italic",{cmdType:"italic",tooltip:"\u659c\u4f53 "},j.Button)}});return h},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(d,f){return{init:function(d){f.addCommand(d,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(d,f,j){function i(){var a=this.get("editor");a.execCommand("justifyCenter");a.focus()}function h(){}d.augment(h,{renderUI:function(a){j.init(a);a.addButton("justifyCenter",{tooltip:"\u5c45\u4e2d\u5bf9\u9f50",checkable:!0,listeners:{click:i,afterSyncUI:function(){var e=this;a.on("selectionChange",function(c){if(a.get("mode")!=f.SOURCE_MODE){var b=f.Utils.getQueryCmd("justifyCenter");a.execCommand(b,c.path)?e.set("checked",!0):e.set("checked",!1)}})}},mode:f.WYSIWYG_MODE})}});
return h},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justifyLeft/cmd",function(d,f){return{init:function(d){f.addCommand(d,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(d,f,j){function i(){var a=this.get("editor");a.execCommand("justifyLeft");a.focus()}function h(){}d.augment(h,{renderUI:function(a){j.init(a);a.addButton("justifyLeft",{tooltip:"\u5de6\u5bf9\u9f50",checkable:!0,listeners:{click:i,afterSyncUI:function(){var e=this;a.on("selectionChange",function(c){if(a.get("mode")!=f.SOURCE_MODE){var b=f.Utils.getQueryCmd("justifyLeft");a.execCommand(b,c.path)?e.set("checked",!0):e.set("checked",!1)}})}},mode:f.WYSIWYG_MODE})}});
return h},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justifyRight/cmd",function(d,f){return{init:function(d){f.addCommand(d,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(d,f,j){function i(){var a=this.get("editor");a.execCommand("justifyRight");a.focus()}function h(){}d.augment(h,{renderUI:function(a){j.init(a);a.addButton("justifyRight",{tooltip:"\u53f3\u5bf9\u9f50",checkable:!0,listeners:{click:i,afterSyncUI:function(){var e=this;a.on("selectionChange",function(c){if(a.get("mode")!=f.SOURCE_MODE){var b=f.Utils.getQueryCmd("justifyRight");a.execCommand(b,c.path)?e.set("checked",!0):e.set("checked",!1)}})}},mode:f.WYSIWYG_MODE})}});
return h},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(d,f){var j=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(d,h,a){d.hasCommand(h)||(d.addCommand(h,{exec:function(e){e.execCommand("save");for(var c=e.getSelection(),b=c.createBookmarks(),d=c.getRanges(),f,h,i=d.length-1;0<=i;i--){f=d[i].createIterator();for(f.enlargeBr=!0;h=f.getNextParagraph();)h.removeAttr("align"),(h.css("text-align").replace(j,"")||"left")==a?h.css("text-align",""):h.css("text-align",a)}c.selectBookmarks(b);e.execCommand("save");
e.notifySelectionChange()}}),d.addCommand(f.Utils.getQueryCmd(h),{exec:function(e,c){var b=c.block||c.blockLimit;return!b||"body"===b.nodeName()?!1:(b.css("text-align").replace(j,"")||"left")==a}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(d,f,j,i,h){function a(a){a=c(a);return a.closest("a",void 0)}function e(a){this.config=a||{}}var c=d.all;d.augment(e,{renderUI:function(b){b.addButton("link",{tooltip:"\u63d2\u5165\u94fe\u63a5",listeners:{click:function(){h.useDialog(b,"link",c.config,void 0)}},mode:f.WYSIWYG_MODE});var c=this;b.addBubble("link",a,{listeners:{afterRenderUI:function(){var a=this,e=a.get("contentEl");e.html('<a href=""  target="_blank" class="ks-editor-bubble-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ks-editor-bubble-link ks-editor-bubble-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubble-link ks-editor-bubble-remove">\u53bb\u9664</span>');
var d=e.one(".ks-editor-bubble-url"),j=e.one(".ks-editor-bubble-change"),n=e.one(".ks-editor-bubble-remove");f.Utils.preventFocus(e);j.on("click",function(e){var d=a.get("editorSelectedEl");h.useDialog(b,"link",c.config,d);e.halt()});n.on("click",function(c){i.removeLink(b,a.get("editorSelectedEl"));c.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");b&&(b=b.attr(i._ke_saved_href)||b.attr("href"),d.html(b),d.attr("href",b))})}}})}});return e},{requires:["editor","../bubble/","./utils",
"../dialogLoader/","../button/"]});
KISSY.add("editor/plugin/link/utils",function(d,f){var j=d.Node,i=f.Style,h={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(a,e){a.execCommand("save");var c=a.getSelection(),b=c.getRanges()[0];if(b&&b.collapsed)b=c.createBookmarks(),e._4e_remove(!0),c.selectBookmarks(b);else if(b){for(var c=e[0],b=c.attributes,d={},f=0;f<b.length;f++){var k=b[f];k.specified&&(d[k.name]=k.value)}c.style.cssText&&(d.style=c.style.cssText);
(new i(h,d)).remove(a.get("document")[0])}a.execCommand("save");a.notifySelectionChange()},applyLink:function(a,e,c){e._ke_saved_href=e.href;c?(a.execCommand("save"),c.attr(e)):(c=(c=a.getSelection())&&c.getRanges()[0],!c||c.collapsed?(e=new j("<a>"+e.href+"</a>",e,a.get("document")[0]),a.insertElement(e)):(a.execCommand("save"),(new i(h,e)).apply(a.get("document")[0])));a.execCommand("save");a.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(d,f,j){function i(){var d=this.get("editor"),a=this.get("cmdType");d.execCommand(a);d.focus()}return j.extend({initializer:function(){var d=this;d.on("click",i,d);var a=d.get("editor");a.on("selectionChange",function(e){var c=f.Utils.getQueryCmd(d.get("cmdType"));a.execCommand(c,e.path)?d.set("checked",!0):d.set("checked",!1)})}},{ATTRS:{checkable:{value:!0},mode:{value:f.WYSIWYG_MODE}}})},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(d,f,j,i){function h(a){this.type=a}function a(a,b){var c,d,f=b.blockLimit,h=b.elements;if(!f)return!1;if(h)for(var i=0;i<h.length&&(c=h[i])&&c[0]!==f[0];i++)if(e[d=c.nodeName()]&&d==a)return!0;return!1}var e={ol:"insertOrderedList",ul:"insertUnorderedList"},c=f.RANGE,b=f.ElementPath,m=f.Walker,l=d.UA,k=d.Node,q=d.DOM,p=/^h[1-6]$/;h.prototype={changeListType:function(a,b,c,e){for(var d=j.listToArray(b.root,c,i,i,i),f=[],a=0;a<b.contents.length;a++){var h=
b.contents[a];if((h=h.closest("li",i))&&h[0]&&!h.data("list_item_processed"))f.push(h),h._4e_setMarker(c,"list_item_processed",!0,i)}h=new k(b.root[0].ownerDocument.createElement(this.type));for(a=0;a<f.length;a++){var l=f[a].data("listarray_index");d[l].parent=h}for(var c=j.arrayToList(d,c,null,"p"),m,d=c.listNode.childNodes.length,a=0;a<d&&(m=new k(c.listNode.childNodes[a]));a++)m.nodeName()==this.type&&e.push(m);b.root.before(c.listNode);b.root.remove()},createList:function(a,b,c){var e=b.contents,
a=b.root[0].ownerDocument,d=[];if(1==e.length&&e[0][0]===b.root[0]){var f=new k(a.createElement("div"));e[0][0].nodeType!=q.TEXT_NODE&&e[0]._4e_moveChildren(f,i,i);e[0][0].appendChild(f[0]);e[0]=f}b=b.contents[0].parent();for(f=0;f<e.length;f++)b=b._4e_commonAncestor(e[f].parent(),i);for(f=0;f<e.length;f++)for(var h=e[f],j;j=h.parent();){if(j[0]===b[0]){d.push(h);break}h=j}if(!(1>d.length)){e=new k(d[d.length-1][0].nextSibling);f=new k(a.createElement(this.type));for(c.push(f);d.length;)c=d.shift(),
h=new k(a.createElement("li")),p.test(c.nodeName())?h[0].appendChild(c[0]):(c._4e_copyAttributes(h,i,i),c._4e_moveChildren(h,i,i),c.remove()),f[0].appendChild(h[0]),l.ie||h._4e_appendBogus(i);e[0]?f.insertBefore(e,i):b.append(f)}},removeList:function(a,b,c){function e(c){if((x=new k(p[c?"firstChild":"lastChild"]))&&!(x[0].nodeType==q.ELEMENT_NODE&&x._4e_isBlockBoundary(i,i))&&(u=b.root[c?"prev":"next"](m.whitespaces(!0),1))&&!(x[0].nodeType==q.ELEMENT_NODE&&u._4e_isBlockBoundary({br:1},i)))x[c?"before":
"after"](a.get("document")[0].createElement("br"))}for(var d=j.listToArray(b.root,c,i,i,i),f=[],h=0;h<b.contents.length;h++){var l=b.contents[h];if((l=l.closest("li",i))&&!l.data("list_item_processed"))f.push(l),l._4e_setMarker(c,"list_item_processed",!0,i)}l=null;for(h=0;h<f.length;h++)l=f[h].data("listarray_index"),d[l].indent=-1;for(h=l+1;h<d.length;h++)if(d[h].indent>Math.max(d[h-1].indent,0)){f=d[h-1].indent+1-d[h].indent;for(l=d[h].indent;d[h]&&d[h].indent>=l;)d[h].indent+=f,h++;h--}var p=j.arrayToList(d,
c,null,"p").listNode,x,u;e(!0);e(i);b.root.before(p);b.root.remove()},exec:function(d){var g=d.getSelection(),h=g&&g.getRanges();if(h&&!(1>h.length)){for(var k=g.getStartElement(),k=new f.ElementPath(k),j=a(this.type,k),k=g.createBookmarks(!0),l=[],p={};0<h.length;){var y=h.shift(),v=y.getBoundaryNodes(),x=v.startNode,u=v.endNode;x[0].nodeType==q.ELEMENT_NODE&&"td"==x.nodeName()&&y.setStartAt(v.startNode,c.POSITION_AFTER_START);u[0].nodeType==q.ELEMENT_NODE&&"td"==u.nodeName()&&y.setEndAt(v.endNode,
c.POSITION_BEFORE_END);y=y.createIterator();for(y.forceBrBreak=!1;v=y.getNextParagraph();)if(!v.data("list_block")){v._4e_setMarker(p,"list_block",1,i);for(var u=new b(v),B=u.elements,z=null,D=!1,z=u.blockLimit,A,x=B.length-1;0<=x&&(A=B[x]);x--)if(e[A.nodeName()]&&z.contains(A)){z.removeData("list_group_object");(x=A.data("list_group_object"))?x.contents.push(v):(x={root:A,contents:[v]},l.push(x),A._4e_setMarker(p,"list_group_object",x,i));D=!0;break}D||(u=z||u.block,u.data("list_group_object")?u.data("list_group_object").contents.push(v):
(x={root:u,contents:[v]},u._4e_setMarker(p,"list_group_object",x,i),l.push(x)))}}for(h=[];0<l.length;)x=l.shift(),j?e[x.root.nodeName()]&&this.removeList(d,x,p):e[x.root.nodeName()]?this.changeListType(d,x,p,h):(f.Utils.clearAllMarkers(p),this.createList(d,x,h));for(var E=this,x=0;x<h.length;x++)z=h[x],d=function(a,b){var c=b[a?"prev":"next"](m.whitespaces(!0),1);c&&c[0]&&c.nodeName()==E.type&&(c.remove(),c._4e_moveChildren(b,a?!0:!1,i))},d(i,z),d(!0,z);f.Utils.clearAllMarkers(p);g.selectBookmarks(k)}}};
new h("ul");new h("ol");return{ListCommand:h,queryActive:a}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(d){var f={ol:1,ul:1},j=d.Node,i=d.DOM,h=d.UA,a={listToArray:function(e,c,b,d,h){if(!f[e.nodeName()])return[];d||(d=0);b||(b=[]);for(var k=0,q=e[0].childNodes.length;k<q;k++){var p=new j(e[0].childNodes[k]);if("li"==p.nodeName()){var n={parent:e,indent:d,element:p,contents:[]};h?n.grandparent=h:(n.grandparent=e.parent(),n.grandparent&&"li"==n.grandparent.nodeName()&&(n.grandparent=n.grandparent.parent()));c&&p._4e_setMarker(c,"listarray_index",b.length,
void 0);b.push(n);for(var g=0,r=p[0].childNodes.length,w;g<r;g++)w=new j(p[0].childNodes[g]),w[0].nodeType==i.ELEMENT_NODE&&f[w.nodeName()]?a.listToArray(w,c,b,d+1,n.grandparent):n.contents.push(w)}}return b},arrayToList:function(e,c,b,d){b||(b=0);if(!e||e.length<b+1)return null;for(var l=e[b].parent[0].ownerDocument,k=l.createDocumentFragment(),q=null,p=b,n=Math.max(e[b].indent,0),g=null;;){var r=e[p];if(r.indent==n){if(!q||e[p].parent.nodeName()!=q.nodeName())q=e[p].parent.clone(!1),k.appendChild(q[0]);
for(var g=q[0].appendChild(r.element.clone(!1)[0]),w=0;w<r.contents.length;w++)g.appendChild(r.contents[w].clone(!0)[0]);p++}else if(r.indent==Math.max(n,0)+1)p=a.arrayToList(e,null,p,d),g.appendChild(p.listNode),p=p.nextIndex;else if(-1==r.indent&&!b&&r.grandparent){f[r.grandparent.nodeName()]?g=r.element.clone(!1)[0]:"td"!=r.grandparent.nodeName()?(g=l.createElement(d),r.element._4e_copyAttributes(new j(g))):g=l.createDocumentFragment();for(w=0;w<r.contents.length;w++)q=r.contents[w].clone(!0),
g.nodeType==i.DOCUMENT_FRAGMENT_NODE&&r.element._4e_copyAttributes(new j(q)),g.appendChild(q[0]);g.nodeType==i.DOCUMENT_FRAGMENT_NODE&&p!=e.length-1&&(g.lastChild&&g.lastChild.nodeType==i.ELEMENT_NODE&&"_moz"==g.lastChild.getAttribute("type")&&i._4e_remove(g.lastChild),i._4e_appendBogus(g));g.nodeType==i.ELEMENT_NODE&&i.nodeName(g)==d&&g.firstChild&&(i._4e_trim(g),q=g.firstChild,q.nodeType==i.ELEMENT_NODE&&i._4e_isBlockBoundary(q)&&(q=l.createDocumentFragment(),i._4e_moveChildren(g,q),g=q));q=i.nodeName(g);
!h.ie&&("div"==q||"p"==q)&&i._4e_appendBogus(g);k.appendChild(g);q=null;p++}else return null;if(e.length<=p||Math.max(e[p].indent,0)<n)break}if(c)for(e=new j(k.firstChild);e&&e[0];)e[0].nodeType==i.ELEMENT_NODE&&e._4e_clearMarkers(c,!0),e=e._4e_nextSourceNode();return{listNode:k,nextIndex:p}}};return a},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(d,f,j,i){if(!d.UA.ie&&window.localStorage)return window.localStorage;var h=f.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),a=new i({movie:h,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});a.swf.height=138;var e=new j({width:"0px",prefixCls:"ks-editor-",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",
zIndex:f.baseZIndex(f.zIndexManager.STORE_FLASH_SHOW)});e.render();e.get("contentEl").append(a.swf);e.center();e.show();a.on("pending",function(){e.set("width",215);e.center();e.show();setTimeout(function(){a.retrySave()},1E3)});a.on("save",function(){e.set("width",0)});var c=a.setItem;d.mix(a,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,e){this.lastSave={k:a,v:e};c.call(this,a,e)}});a.on("contentReady",
function(){a._ready=1});return a},{attach:!1,requires:["editor","overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(d,f){function j(a){this.editor=a}var i=d.UA,h=i.ie,a=document,e=d.Node,c=d.Event,b=d.DOM,m;d.augment(j,{restoreWindow:function(){var a=this,b=a.editor;!1!==b.fire("beforeRestoreWindow")&&a._resize&&(c.remove(window,"resize",a._resize),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("afterRestoreWindow")},30))},_restoreState:function(){var c=this.editor,e=c.get("textarea"),
d=this._savedParents;if(d){for(var f=0;f<d.length;f++){var i=d[f];i.el.css("position",i.position)}this._savedParents=null}e.parent().css({height:this.iframeHeight});e.css({height:this.iframeHeight});b.css(a.body,{width:"",height:"",overflow:""});a.documentElement.style.overflow="";c=c.get("el")[0].style;c.position="static";c.width=this.editorElWidth;m.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>h&&this.editor.get("toolBarEl").removeClass("ks-editor-toolbar-padding",
void 0)},_saveSate:function(){var a=this.editor,c=[],e=a.get("el");this.iframeHeight=a.get("textarea").parent().style("height");this.editorElWidth=e.style("width");this.scrollLeft=b.scrollLeft();this.scrollTop=b.scrollTop();window.scrollTo(0,0);for(a=e.parent();a;)e=a.css("position"),"static"!=e&&(c.push({el:a,position:e}),a.css("position","static")),a=a.parent();this._savedParents=c;8>h&&this.editor.get("toolBarEl").addClass("ks-editor-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=
this.editor;this.savedRanges=null;i.gecko&&a.__iframeFocus&&(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;i.gecko&&a.activateGecko();c&&b&&b.selectRanges(c);a.__iframeFocus&&b&&(a=b.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(c){var e=this.editor,d=e.get("el"),i=b.viewportHeight(),j=b.viewportWidth(),g=e.get("textarea"),r=e.get("statusBarEl")?e.get("statusBarEl")[0].offsetHeight:
0,e=e.get("toolBarEl")[0].offsetHeight;h?a.body.style.overflow="hidden":b.css(a.body,{width:0,height:0,overflow:"hidden"});a.documentElement.style.overflow="hidden";d.css({position:"absolute",zIndex:f.baseZIndex(f.zIndexManager.MAXIMIZE),width:j+"px"});m.css({zIndex:f.baseZIndex(f.zIndexManager.MAXIMIZE-5),height:i+"px",width:j+"px"});d.offset({left:0,top:0});m.css({left:0,top:0});g.parent().css({height:i-r-e+"px"});g.css({height:i-r-e+"px"});!0!==c&&arguments.callee.call(this,!0)},_real:function(){var a=
this,b=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=d.buffer(function(){a._maximize();b.fire("afterMaximizeWindow")},100)),c.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("afterMaximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(m||(m=(new e("<iframe  class='ks-editor-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(a.body,
void 0)),this._real())},destroy:function(){this._resize&&(c.remove(window,"resize",this._resize),this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var b=new j(a);a.addCommand("maximizeWindow",{exec:function(){b.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){b.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(d,f,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("maximize",{tooltip:"\u5168\u5c4f",listeners:{click:function(){this.get("checked")?(d.execCommand("maximizeWindow"),this.set("tooltip","\u53d6\u6d88\u5168\u5c4f"),this.set("contentCls","restore")):(d.execCommand("restoreWindow"),this.set("tooltip","\u5168\u5c4f"),this.set("contentCls","maximize"));d.focus()}},checkable:!0})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/menubutton/index",function(d,f,j){f.prototype.addSelect=function(i,h,a){var a=a||j.Select,e=this.get("prefixCls")+"editor-";h&&(h.editor=this,h.menu&&(h.menu.zIndex=f.baseZIndex(f.zIndexManager.SELECT),h.menu.xclass="popupmenu",d.each(h.menu.children,function(a){a.xclass="option"})));var c=new a(d.mix({elAttrs:{hideFocus:"hideFocus"},render:this.get("toolBarEl"),prefixCls:e,autoRender:!0},h));c.get("el").unselectable();h.mode==f.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){c.set("disabled",
false)}),this.on("sourceMode",function(){c.set("disabled",true)}));this.addControl(i+"/select",c);return c};return j},{requires:["editor","menubutton"]});KISSY.add("editor/plugin/multipleUpload/index",function(d,f,j){function i(d){this.config=d||{}}d.augment(i,{renderUI:function(d){var a=this;d.addButton("multipleUpload",{tooltip:"\u6279\u91cf\u63d2\u56fe",listeners:{click:function(){j.useDialog(d,"multipleUpload",a.config)}},mode:f.WYSIWYG_MODE})}});return i},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/orderedList/cmd",function(d,f,j){var i=j.queryActive,h=new j.ListCommand("ol");return{init:function(a){a.hasCommand("insertOrderedList")||a.addCommand("insertOrderedList",{exec:function(a){h.exec(a)}});var e=f.Utils.getQueryCmd("insertOrderedList");a.hasCommand(e)||a.addCommand(e,{exec:function(a,b){return i("ol",b)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/orderedList/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("orderedList",{cmdType:"insertOrderedList",mode:f.WYSIWYG_MODE},j)}});return h},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/outdent/cmd",function(d,f,j){var i=j.addCommand,h=j.checkOutdentActive;return{init:function(a){i(a,"outdent");var e=f.Utils.getQueryCmd("outdent");a.hasCommand(e)||a.addCommand(e,{exec:function(a,b){return h(b)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(d,f,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);var a=f.Utils.getQueryCmd("outdent");d.addButton("outdent",{tooltip:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",listeners:{click:function(){d.execCommand("outdent");d.focus()},afterSyncUI:function(){var e=this;d.on("selectionChange",function(c){d.get("mode")!=f.SOURCE_MODE&&(d.execCommand(a,c.path)?e.set("disabled",!1):e.set("disabled",!0))})}},mode:f.WYSIWYG_MODE})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/index",function(d,f,j,i){var h=j.extend({bindUI:function(){i.init(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:f.baseZIndex(f.zIndexManager.OVERLAY)}}});h.Dialog=j.Dialog.extend({bindUI:function(){i.init(this)},show:function(){this.center();var a=this.get("y");200<a-d.DOM.scrollTop()&&(a=d.DOM.scrollTop()+200,this.set("y",a));h.prototype.show.call(this)}},{ATTRS:{elAttrs:{value:{hideFocus:"hideFocus"}},prefixCls:{value:"ks-editor-"},zIndex:{value:f.baseZIndex(f.zIndexManager.OVERLAY)},
draggable:{value:!0},constrain:{value:!0},aria:{value:!0}}});return h},{requires:["editor","overlay","../focusFix/","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(d,f,j){function i(){}var h=d.Node;d.augment(i,{renderUI:function(a){j.init(a);var e=a.htmlDataProcessor;(e&&e.dataFilter).addRules({tags:{div:function(a){var b=a.getAttribute("style"),d;if(b)for(var f=a.childNodes,h=0;h<f.length;h++)1==f[h].nodeType&&(d=f[h]);if((d=d&&"span"==d.nodeName&&d.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(b)&&/display\s*:\s*none/i.test(d))return e.createFakeParserElement(a,"ke_pagebreak","div")}}});a.addButton("pageBreak",
{tooltip:"\u5206\u9875",listeners:{click:function(){var c=new h('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,a.get("document")[0]),c=a.createFakeElement(c,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),b=a.getSelection();if(b=b&&b.getRanges()[0]){a.execCommand("save");for(var e=b.startContainer,d=e;"body"!==e.nodeName();)d=e,e=e.parent();b.collapse(!0);b.splitElement(d);c.insertAfter(d);a.execCommand("save")}}},
mode:f.WYSIWYG_MODE})}});return i},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(d){function f(){}var j=window;d.augment(f,{renderUI:function(d){d.addButton("preview",{tooltip:"\u9884\u89c8",listeners:{click:function(){try{var f=j.screen,a=Math.round(0.8*f.width),e=Math.round(0.7*f.height),c=Math.round(0.1*f.width)}catch(b){a=640,e=420,c=80}f=d.getDocHtml().replace(/\${title}/,"\u9884\u89c8");a=j.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+a+",height="+e+",left="+c);e=a.document;e.open();e.write(f);
e.close();a.focus()}}})}});return f});
KISSY.add("editor/plugin/progressbar/index",function(d){function f(){f.superclass.constructor.apply(this,arguments);this._init()}var j=d.Node;f.ATTRS={container:{},width:{},height:{},progress:{value:0}};d.extend(f,d.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var d=this.get("height"),f=new j("<div class='ks-editor-progressbar'  style='width:"+this.get("width")+";height:"+d+";'></div>"),a=this.get("container"),d=(new j("<div style='overflow:hidden;'><div class='ks-editor-progressbar-inner' style='height:"+(parseInt(d)-
4)+"px'><div class='ks-editor-progressbar-inner-bg'></div></div></div>")).appendTo(f),e=(new j("<span class='ks-editor-progressbar-title'></span>")).appendTo(f);a&&f.appendTo(a);this.el=f;this._title=e;this._p=d;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(d){d=d.newVal;this._p.css("width",d+"%");this._title.html(d+"%")}});return f});
KISSY.add("editor/plugin/removeFormat/cmd",function(d,f){function j(a,c){for(var e=0;e<c.length;e++)a.removeAttr(c[e])}var i=f.RANGE,h=f.ElementPath,a=d.DOM,e="class,style,lang,width,height,align,hspace,valign".split(/,/),c=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(b){b.hasCommand("removeFormat")||b.addCommand("removeFormat",{exec:function(){b.focus();c.lastIndex=0;var d=b.getSelection().getRanges();
b.execCommand("save");for(var f=0,k;k=d[f];f++)if(!k.collapsed){k.enlarge(i.ENLARGE_ELEMENT);var q=k.createBookmark(),p=q.startNode,n=q.endNode,g=function(a){for(var b=new h(a),e=b.elements,d=1,f;(f=e[d])&&!f.equals(b.block)&&!f.equals(b.blockLimit);d++)c.test(f.nodeName())&&a._4e_breakParent(f)};g(p);g(n);for(p=p._4e_nextSourceNode(!0,a.ELEMENT_NODE,void 0,void 0);p&&!p.equals(n);)g=p._4e_nextSourceNode(!1,a.ELEMENT_NODE,void 0,void 0),"img"==p.nodeName()&&p.attr("_ke_realelement")||(c.test(p.nodeName())?
p._4e_remove(!0):j(p,e)),p=g;k.moveToBookmark(q)}b.getSelection().selectRanges(d);b.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(d,f,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("removeFormat",{tooltip:"\u6e05\u9664\u683c\u5f0f",listeners:{click:function(){d.execCommand("removeFormat")}},mode:f.WYSIWYG_MODE})}});return i},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(d,f,j){function i(a){this.config=a||{}}var h=d.Node;d.augment(i,{renderUI:function(a){var e=j.Draggable,c=a.get("statusBarEl");a.get("textarea");var b=this.config.direction||["x","y"],f="se-resize";1==b.length&&(f="x"==b[0]?"e-resize":"s-resize");var i=(new h("<div class='ks-editor-resizer' style='cursor: "+f+"'></div>")).appendTo(c);a.on("maximizeWindow",function(){i.css("display","none")});a.on("restoreWindow",function(){i.css("display","")});var k=
new e({node:i}),q=0,p=0,n=a.get("el"),g=a.get("el");k.on("dragstart",function(){q=n.height();p=g.width();a.fire("resizeStart")});k.on("drag",function(c){var e=c.left-this.startNodePos.left,c=c.top-this.startNodePos.top;d.inArray("y",b)&&a.set("height",q+c);d.inArray("x",b)&&a.set("width",p+e);a.fire("resize")});a.on("destroy",function(){k.destroy();i.remove()})}});return i},{requires:["editor","dd"]});
KISSY.add("editor/plugin/separator/index",function(d){function f(){}d.augment(f,{renderUI:function(f){d.all('<span class="ks-editor-toolbar-separator">&nbsp;</span>').appendTo(f.get("toolBarEl"))}});return f},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(d,f,j){function i(){}for(var h="<div class='ks-editor-smiley-sprite'>",a=0;98>=a;a++)h+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+a+".gif'></a>";h+="</div>";d.augment(i,{init:function(a){a.addButton("smiley",{tooltip:"\u63d2\u5165\u8868\u60c5",checkable:!0,listeners:{afterSyncUI:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.smiley&&a.smiley.hide()},150)})},click:function(){var c=this,b;if(c.get("checked")){if(!(b=
c.smiley))b=c.smiley=new j({content:h,focus4e:!1,width:"297px",autoRender:!0,elCls:"ks-editor-popup",zIndex:f.baseZIndex(f.zIndexManager.POPUP_MENU),mask:!1}),b.get("el").on("click",function(b){var b=new d.Node(b.target),c;if("a"==b.nodeName()&&(c=b.attr("data-icon")))c=new d.Node("<img alt='' src='"+c+"'/>",null,a.get("document")[0]),a.insertElement(c)}),b.on("hide",function(){c.set("checked",!1)});b.set("align",{node:this.get("el"),points:["bl","tl"]});b.show()}else c.smiley&&c.smiley.hide()},destroy:function(){this.smiley&&
this.smiley.destroy()}},mode:f.WYSIWYG_MODE})}});return i},{requires:["editor","../overlay/"]});
KISSY.add("editor/plugin/sourceArea/index",function(d,f){function j(){}var i=f.SOURCE_MODE,h=f.WYSIWYG_MODE;d.augment(j,{renderUI:function(a){a.addButton("sourceArea",{tooltip:"\u6e90\u7801",listeners:{afterSyncUI:function(){var d=this;a.on("wysiwygMode",function(){d.set("checked",!1)});a.on("sourceMode",function(){d.set("checked",!0)})},click:function(){this.get("checked")?a.set("mode",i):a.set("mode",h);a.focus()}},checkable:!0})}});return j},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(d,f,j){var i=new f.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(d){j.addButtonCmd(d,"strikeThrough",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("strikeThrough",{cmdType:"strikeThrough",tooltip:"\u5220\u9664\u7ebf "},j.Button)}});return h},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(d,f,j){function i(a){function b(a){!(0<e.length)&&a[0].nodeType==n.ELEMENT_NODE&&w.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(g,"selected_cell",!0,void 0),e.push(a))}for(var c=a.createBookmarks(),d=a.getRanges(),e=[],g={},h=0;h<d.length;h++){var i=d[h];if(i.collapsed)i=i.getCommonAncestor(),(i=i.closest("td",void 0)||i.closest("th",void 0))&&e.push(i);else{var i=new Walker(i),j;for(i.guard=b;j=i.next();)if((j=j.parent())&&w.test(j.nodeName())&&
!j.data("selected_cell"))j._4e_setMarker(g,"selected_cell",!0,void 0),e.push(j)}}f.Utils.clearAllMarkers(g);a.selectBookmarks(c);return e}function h(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",p.ie||(new g(c[d]))._4e_appendBogus(void 0)}}function a(b){if(b instanceof f.Selection){for(var c=i(b),d=c.length,b=[],e,h,j=0;j<d;j++){var k=c[j].parent(),l=k[0].rowIndex;!j&&(e=l-1);b[l]=k;j==d-1&&(h=l+
1)}j=k.parent("table");e=new g(h<j[0].rows.length&&j[0].rows[h]||0<e&&j[0].rows[e]||j[0].parentNode);for(j=b.length;0<=j;j--)b[j]&&a(b[j]);return e}b instanceof g&&(j=b.parent("table"),1==j[0].rows.length?j.remove():b.remove());return 0}function e(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),e=c[0].cellIndex,f=0;f<d[0].rows.length;f++){var h=d[0].rows[f];h.cells.length<e+1||(c=new g(h.cells[e].cloneNode(void 0)),p.ie||c._4e_appendBogus(void 0),
h=new g(h.cells[e]),b?c.insertBefore(h):c.insertAfter(h))}}function c(b){if(b instanceof f.Selection){var d=i(b),e,h=[],b=d[0]&&d[0].parent("table"),j,k,l;j=0;for(k=d.length;j<k;j++)h.push(d[j][0].cellIndex);h.sort();j=1;for(k=h.length;j<k;j++)if(1<h[j]-h[j-1]){l=h[j-1]+1;break}l||(l=0<h[0]?h[0]-1:h[h.length-1]+1);h=b[0].rows;j=0;for(k=h.length;j<k&&!(e=h[j].cells[l]);j++);e=e?new g(e):b.prev();for(l=d.length-1;0<=l;l--)d[l]&&c(d[l]);return e}if(b instanceof g){d=b.parent("table");if(!d)return null;
e=b[0].cellIndex;for(l=d[0].rows.length-1;0<=l;l--)b=new g(d[0].rows[l]),!e&&1==b[0].cells.length?a(b):b[0].cells[e]&&b[0].removeChild(b[0].cells[e])}return null}function b(a,b){var c=new f.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function m(a){var b=(a=a.getSelection())&&a.getStartElement(),c=b&&b.closest("table",void 0);if(c)return a=b.closest(function(a){var b=n.nodeName(a);return c.contains(a)&&("td"==
b||"th"==b)},void 0),b=b.closest(function(a){var b=n.nodeName(a);return c.contains(a)&&"tr"==b},void 0),{table:c,td:a,tr:b}}function l(a){return(a=m(a))&&a.td}function k(a){return(a=m(a))&&a.tr}function q(a){this.config=a||{}}var p=d.UA,n=d.DOM,g=d.Node,r=["tr","th","td","tbody","table"],w=/^(?:td|th)$/,t={"\u8868\u683c\u5c5e\u6027":m,"\u5220\u9664\u8868\u683c":l,"\u5220\u9664\u5217":l,"\u5220\u9664\u884c":k,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":k,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":k,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":l,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":l},s=(6===p.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),o={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},y={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=d.trim(b.replace("ke_show_border","")))}}};d.augment(q,{init:function(g){g.addCustomStyle(s);var i=g.htmlDataProcessor,k=i&&i.htmlFilter;(i&&i.dataFilter).addRules(o);k.addRules(y);var l=this,p={"\u8868\u683c\u5c5e\u6027":function(){this.hide();var a=m(g);a&&j.useDialog(g,"table",l.config,
{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){this.hide();var a=g.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){this.hide();var c=g.getSelection();b(a(c),void 0)},"\u5220\u9664\u5217 ":function(){this.hide();var a=g.getSelection();(a=c(a))&&b(a,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){this.hide();
var a=g.getSelection();h(a,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){this.hide();var a=g.getSelection();h(a,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){this.hide();var a=g.getSelection();e(a,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){this.hide();var a=g.getSelection();e(a,void 0)}},q=[];d.each(p,function(a,b){q.push({content:b})});g.addContextMenu("table",function(a){if(d.inArray(n.nodeName(a),r))return!0},{width:"120px",children:q,listeners:{click:function(a){a=a.target.get("content");p[a]&&p[a].apply(this)},beforeVisibleChange:function(a){if(a.newVal){var b=
this,a=b.get("children"),c=b.get("editor");d.each(a,function(a){var d=a.get("content");!t[d]||t[d].call(b,c)?a.set("disabled",!1):a.set("disabled",!0)})}}}});g.addButton("table",{mode:f.WYSIWYG_MODE,listeners:{click:function(){j.useDialog(g,"table",l.config,{selectedTable:0,selectedTd:0})}},tooltip:"\u63d2\u5165\u8868\u683c"})}});return q},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(d,f,j){var i=new f.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(d){j.addButtonCmd(d,"underline",i)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("underline",{cmdType:"underline",tooltip:"\u4e0b\u5212\u7ebf "},j.Button)}});return h},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(d,f,j){d=j.extend({bindUI:function(){var d=this,f=d.get("editor");d.on("click",function(){f.execCommand("undo")});f.on("afterUndo afterRedo afterSave",function(a){0<a.index?d.set("disabled",!1):d.set("disabled",!0)})}},{ATTRS:{mode:{value:f.WYSIWYG_MODE},disabled:{value:!0}}});return{RedoBtn:j.extend({bindUI:function(){var d=this,f=d.get("editor");d.on("click",function(){f.execCommand("redo")});f.on("afterUndo afterRedo afterSave",function(a){a.index<a.history.length-
1?d.set("disabled",!1):d.set("disabled",!0)})}},{mode:{value:f.WYSIWYG_MODE},ATTRS:{disabled:{value:!0}}}),UndoBtn:d}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(d,f){function j(a){var c=a.get("document")[0].body.innerHTML,d;c&&(d=a.getSelection());this.contents=c;this.bookmarks=d&&d.createBookmarks2(!0)}function i(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=d.buffer(this.save,500,this);this._init()}var h=f.Utils.arrayCompare,a=d.UA;d.augment(j,{equals:function(a){if(this.contents!=a.contents)return!1;var c=this.bookmarks,a=a.bookmarks;if(c||a){if(!c||!a||c.length!=a.length)return!1;for(var d=
0;d<c.length;d++){var e=c[d],f=a[d];if(e.startOffset!=f.startOffset||e.endOffset!=f.endOffset||!h(e.start,f.start)||!h(e.end,f.end))return!1}}return!0}});var e={16:1,17:1,18:1},c={37:1,38:1,39:1,40:1,33:1,34:1};d.augment(i,{_keyMonitor:function(){var a=this,d=a.editor;d.docReady(function(){d.get("document").on("keydown",function(f){var h=f.keyCode;h in c||h in e||(90===h&&(f.ctrlKey||f.metaKey)?(!1!==d.fire("beforeRedo")&&a.restore(-1),f.halt()):89===h&&(f.ctrlKey||f.metaKey)?(!1!==d.fire("beforeUndo")&&
a.restore(1),f.halt()):!1!==d.fire("beforeSave",{buffer:1})&&a.save(1))})})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){var c=this.editor;if(c.get("mode")==f.WYSIWYG_MODE&&c.get("document"))if(a)this.bufferRunner();else{var a=this.history,d=this.index;a.length>d+1&&a.splice(d+1,a.length-d-1);var d=a[a.length-1],e=new j(c);if(!d||!d.equals(e))30===a.length&&a.shift(),a.push(e),this.index=d=a.length-1,c.fire("afterSave",{history:a,index:d})}},restore:function(b){if(this.editor.get("mode")==
f.WYSIWYG_MODE){var c=this.history,d=this.editor,e=d.get("document")[0].body,h=c[this.index+b];h&&(e.innerHTML=h.contents,h.bookmarks?d.getSelection().selectBookmarks(h.bookmarks):a.ie&&(e=e.createTextRange(),e.collapse(!0),e.select()),(e=d.getSelection())&&e.scrollIntoView(),this.index+=b,d.fire(0<b?"afterUndo":"afterRedo",{history:c,index:this.index}),d.notifySelectionChange());return h}}});return{init:function(a){if(!a.hasCommand("save")){var c=new i(a);a.addCommand("save",{exec:function(a,b){c.save(b)}});
a.addCommand("undo",{exec:function(){c.restore(-1)}});a.addCommand("redo",{exec:function(){c.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("undo",{mode:f.WYSIWYG_MODE,tooltip:"\u64a4\u9500",editor:a},j.UndoBtn);a.addButton("redo",{mode:f.WYSIWYG_MODE,tooltip:"\u91cd\u505a",editor:a},j.RedoBtn)}});return h},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/unorderedList/cmd",function(d,f,j){var i=j.queryActive,h=new j.ListCommand("ul");return{init:function(a){a.hasCommand("insertUnorderedList")||a.addCommand("insertUnorderedList",{exec:function(a){h.exec(a)}});var d=f.Utils.getQueryCmd("insertUnorderedList");a.hasCommand(d)||a.addCommand(d,{exec:function(a,b){return i("ul",b)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/unorderedList/index",function(d,f,j,i){function h(){}d.augment(h,{renderUI:function(a){i.init(a);a.addButton("unorderedList",{cmdType:"insertUnorderedList",mode:f.WYSIWYG_MODE},j)}});return h},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(d,f,j,i){function h(a){this.config=a}d.augment(h,{renderUI:function(a){function d(a){for(var b=0;b<h.length;b++){var c=h[b];if(c.reg.test(a))return c}}var c=a.htmlDataProcessor,b=c&&c.dataFilter,h=[],l=this.config;l.providers&&h.push.apply(h,l.providers);l.getProvider=d;b&&b.addRules({elements:{object:function(a){var b=a.getAttribute("classid"),f=a.childNodes;if(!b){for(b=0;b<f.length;b++)if("embed"==f[b].name){if(!j.isFlashEmbed(f[b]))break;if(d(f[b].getAttribute("src")))return c.createFakeParserElement(a,
"ke_video","video",!0)}return null}for(b=0;b<f.length;b++){var g=f[b];if("param"==g.nodeName&&"movie"==g.getAttribute("name").toLowerCase()&&d(g.getAttribute("value")))return c.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!j.isFlashEmbed(a))return null;if(d(a.getAttribute("src")))return c.createFakeParserElement(a,"ke_video","video",!0)}}},4);var k=new i({editor:a,cls:"ke_video",type:"video",pluginConfig:this.config,bubbleId:"video",contextMenuId:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=
this.get("editorSelectedEl");a&&k.show(a)}}});a.addButton("video",{tooltip:"\u63d2\u5165\u89c6\u9891",listeners:{click:function(){k.show()}},mode:f.WYSIWYG_MODE})}});return h},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(d,f,j,i){function h(){h.superclass.constructor.apply(this,arguments)}function a(a){this.config=a||{}}d.extend(h,j,{_updateTip:function(a,c){var b=this.get("editor").restoreRealElement(c);b&&(a.html(c.attr("title")),a.attr("href",this._getFlashUrl(b)))}});d.augment(a,{renderUI:function(a){function c(a){return/xiami\.com/i.test(a)}var b=a.htmlDataProcessor,d=b&&b.dataFilter;d&&d.addRules({tags:{object:function(a){var d=a.getAttribute("title"),e,f;
e=a.getAttribute("classid");var g=a.childNodes;if(!e){for(e=0;e<g.length;e++)if(f=g[e],"embed"==f.nodeName){if(!i.isFlashEmbed(f))break;if(c(f.attributes.src))return b.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:d})}return null}for(e=0;e<g.length;e++)if(f=g[e],"param"==f.nodeName&&"movie"==f.getAttribute("name")&&c(f.getAttribute("value")))return b.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:d})},embed:function(a){if(i.isFlashEmbed(a)&&c(a.getAttribute("src")))return b.createFakeParserElement(a,
"ke_xiami","xiamiMusic",!0,{title:a.getAttribute("title")})}}},4);var j=new h({editor:a,cls:"ke_xiami",type:"xiamiMusic",bubbleId:"xiami",pluginConfig:this.config,contextMenuId:"xiami",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&j.show(a)}}});a.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",listeners:{click:function(){j.show()}},mode:f.WYSIWYG_MODE})}});return a},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/full",function(d,f){return f},{requires:["editor"]});
