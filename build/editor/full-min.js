/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 30 21:24
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(f,j,k){j=k.Controller.extend({initializer:function(){this.__commands={};this.__dialogs={}},use:function(d,h){var c=this,g=c.__CORE_PLUGINS||["htmlDataProcessor","enterKey","clipboard","selection"];f.isString(d)&&(d=d.split(","));for(var b=d.length-1;0<=b;b--)d[b]||d.splice(b,1);for(b=0;b<g.length;b++){var a=g[b];f.inArray(a,d)||d.unshift(a)}f.each(d,function(c,b){d[b]&&(d[b]="editor/plugin/"+c+"/")});f.use(d,function(){var b=f.makeArray(arguments);b.shift();for(var a=
0;a<b.length;a++)b[a]&&b[a].init(c);h&&h.call(c);c.adjustHeight()});c.__CORE_PLUGINS=[];return c}},{Config:{},XHTML_DTD:j.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},iframeWrapEl:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(d){return this._setData(d)}},formatData:{getter:function(){return this._getData(1)},setter:function(d){return this._setData(d)}},customStyle:{value:""},
customLink:{value:[]}}},{xclass:"editor"});j.HTML_PARSER={textarea:function(d){return d.one(this.get("prefixCls")+".editor-textarea")}};f.mix(j,f.EventTarget);return KISSY.Editor=j},{requires:["htmlparser","component","core"]});
KISSY.add("editor/plugin/clipboard/index",function(f){function j(e){this.editor=e;this._init()}function k(e){if(c.ie&&"BackCompat"!=e.get("document")[0].compatMode){var b=e.getSelection(),a;if(b.getType()==i.SELECTION_ELEMENT&&(a=b.getSelectedElement())){var q=b.getRanges()[0],g=new h(e.get("document")[0].createTextNode(""));g.insertBefore(a);q.setStartBefore(g);q.setEndAfter(a);b.selectRanges([q]);setTimeout(function(){a.parent()&&(g.remove(),b.selectElement(a))},0)}}}var d=f.Editor,h=f.Node,c=f.UA,
g=d.Range,b=d.RANGE,a=f.Event;f.augment(j,{_init:function(){var e=this.editor;a.on(e.get("document")[0].body,c.webkit?"paste":c.gecko?"paste":"beforepaste",this._paste,this);a.on(e.get("document")[0].body,"contextmenu",function(){q=1;setTimeout(function(){q=0},10)});e.addCommand("copy",new p("copy"));e.addCommand("cut",new p("cut"));e.addCommand("paste",new p("paste"))},_paste:function(){if(!q){var e=this.editor,a=e.get("document")[0];if(!a.getElementById("ke_pastebin")){var i=e.getSelection(),r=
new g(a),d=new h(c.webkit?"<body></body>":"<div></div>",null,a);d.attr("id","ke_pastebin");c.webkit&&d[0].appendChild(a.createTextNode("\u00a0"));a.body.appendChild(d[0]);d.css({position:"absolute",top:i.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var l=i.createBookmarks();r.setStartAt(d,b.POSITION_AFTER_START);r.setEndAt(d,b.POSITION_BEFORE_END);r.select(!0);setTimeout(function(){d.remove();var a;d=c.webkit&&(a=d.first())&&a.hasClass("Apple-style-span")?
a:d;i.selectBookmarks(l);a=d.html();if(a=f.trim(a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var b=e.fire("paste",{html:a,holder:d});void 0!==b&&(a=b);b=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(a)&&(b=e.htmlDataProcessor.wordFilter);e.insertHtml(a,b)}},0)}}}});var l=function(e,a){var b=e.get("document")[0],q=new h(b.body),g=!1,i=function(){g=!0};q.on(a,i);(7<c.ie?b:b.selection.createRange()).execCommand(a);q.detach(a,i);return g},o=c.ie?function(e,a){return l(e,
a)}:function(e,a){try{return e.get("document")[0].execCommand(a)}catch(b){return!1}},n={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},p=function(e){this.type=e};p.prototype={exec:function(e){"cut"==this.type&&k(e);(e=o(e,this.type))||alert(n[this.type]);return e}};var i=d.Selection,e={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},q;d.on("contextmenu",function(a){var b=a.contextmenu,c=b.get("editor"),
q=b.menu.get("contentEl"),g={copy:0,cut:0,paste:0},i;for(i in g)g.hasOwnProperty(i)&&(g[i]=q.one(".ks-editor-paste-"+i),g[i]||function(a){var m=(new h("<a href='#'class='ks-editor-paste-"+a+"'>"+e[a]+"</a>")).appendTo(q);m.on("click",function(e){e.halt();b.hide();setTimeout(function(){c.execCommand(a)},30)});g[a]=m}(i))});return{init:function(e){e.docReady(function(){new j(e)})}}},{requires:["editor"]});
KISSY.add("editor/core/dom",function(f,j,k){function d(e,b){var m=e[b?"next":"prev"](h,1);if(m&&m[0].nodeType==g.ELEMENT_NODE){for(var c=[];m.attr("_ke_bookmark")||m._4e_isEmptyInlineRemovable(h);)if(c.push(m),m=b?m.next(h,1):m.prev(h,1),!m)return;if(e._4e_isIdentical(m,h)){for(var i=new a(b?e[0].lastChild:e[0].firstChild);c.length;)c.shift()._4e_move(e,!b,h);m._4e_moveChildren(e,!b,h);m.remove();i[0]&&i[0].nodeType==g.ELEMENT_NODE&&i._4e_mergeSiblings()}}}var h=h,c=j.XHTML_DTD,g=f.DOM,b=f.UA,a=f.Node,
l={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};j.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var o=j.POSITION,n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},p={hr:1},i=function(e){return e&&(e[0]||e)};k.injectDom({_4e_sameLevel:function(e,a){var a=i(a),b=e.parentNode;return b&&b==a.parentNode},_4e_isBlockBoundary:function(e,a){var b=f.merge(p,a);return!(!n[g.css(e,"display")]&&!b[g.nodeName(e)])},_4e_index:function(e,a){for(var b=e.parentNode.childNodes,c,g=-1,i=0;i<b.length;i++)if(c=b[i],!a||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(g++,c===e)return g;return-1},_4e_move:function(e,a,b){a=
i(a);b?a.insertBefore(e,a.firstChild):a.appendChild(e)},_4e_isIdentical:function(e,a){if(!a)return!1;a=i(a);if(g.nodeName(e)!=g.nodeName(a))return!1;var b=e.attributes,c=a.attributes,d=b.length,r=c.length;if(d!=r)return!1;for(var l=0;l<d;l++){var f=b[l],n=f.name;if(f.specified&&g.attr(e,n)!=g.attr(a,n))return!1}if(8>k.ieEngine)for(l=0;l<r;l++)if(f=c[l],n=f.name,f.specified&&g.attr(e,n)!=g.attr(a,n))return!1;return!0},_4e_isEmptyInlineRemovable:function(e){if(!c.$removeEmpty[g.nodeName(e)])return!1;
for(var e=e.childNodes,a=0,b=e.length;a<b;a++){var i=e[a],d=i.nodeType;if(!(d==g.ELEMENT_NODE&&i.getAttribute("_ke_bookmark"))&&(d==g.ELEMENT_NODE&&!g._4e_isEmptyInlineRemovable(i)||d==g.TEXT_NODE&&f.trim(i.nodeValue)))return!1}return!0},_4e_moveChildren:function(e,a,b){a=i(a);if(e!=a)if(b)for(;b=e.lastChild;)a.insertBefore(e.removeChild(b),a.firstChild);else for(;b=e.firstChild;)a.appendChild(e.removeChild(b))},_4e_mergeSiblings:function(e){e=new a(e);l[e.nodeName()]&&(d(e,!0),d(e))},_4e_splitText:function(e,
a){var c=e.ownerDocument;if(e.nodeType==g.TEXT_NODE){if(b.ie&&a==e.nodeValue.length){var i=c.createTextNode("");g.insertAfter(i,e);return i}i=e.splitText(a);c.documentMode&&(c=c.createTextNode(""),g.insertAfter(c,i),g.remove(c));return i}},_4e_parents:function(e,a){var b=[];b.__IS_NODELIST=1;do b[a?"push":"unshift"](e);while(e=e.parentNode);return b},_4e_nextSourceNode:function(e,a,b,c){if(c&&!c.call)var d=i(c),c=function(e){return e!==d};var a=!a&&e.firstChild,r=e;if(!a){if(e.nodeType==g.ELEMENT_NODE&&
c&&!1===c(e,!0))return null;a=e.nextSibling}for(;!a&&(r=r.parentNode);){if(c&&!1===c(r,!0))return null;a=r.nextSibling}return!a||c&&!1===c(a)?null:b&&b!=a.nodeType?g._4e_nextSourceNode(a,!1,b,c):a},_4e_previousSourceNode:function(e,a,b,c){if(c&&!c.call)var d=i(c),c=function(e){return e!==d};var a=!a&&e.lastChild,r=e;if(!a){if(e.nodeType==g.ELEMENT_NODE&&c&&!1===c(e,!0))return null;a=e.previousSibling}for(;!a&&(r=r.parentNode);){if(c&&!1===c(r,!0))return null;a=r.previousSibling}return!a||c&&!1===
c(a)?null:b&&a.nodeType!=b?g._4e_previousSourceNode(a,!1,b,c):a},_4e_commonAncestor:function(e,a){a=i(a);if(e===a)return e;if(g.contains(a,e))return a;var b=e;do if(g.contains(b,a))return b;while(b=b.parentNode);return null},_4e_hasAttributes:9>k.ieEngine?function(e){for(var a=e.attributes,b=0;b<a.length;b++){var c=a[b];switch(c.name){case "class":if(e.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(e){b.gecko&&e.removeAttribute("_moz_dirty");return e.hasAttributes()},
_4e_position:function(e,a){var b=i(a);if(e.compareDocumentPosition)return e.compareDocumentPosition(b);if(e==b)return o.POSITION_IDENTICAL;if(e.nodeType==g.ELEMENT_NODE&&b.nodeType==g.ELEMENT_NODE){if(g.contains(e,b))return o.POSITION_CONTAINS+o.POSITION_PRECEDING;if(g.contains(b,e))return o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING;if("sourceIndex"in e)return 0>e.sourceIndex||0>b.sourceIndex?o.POSITION_DISCONNECTED:e.sourceIndex<b.sourceIndex?o.POSITION_PRECEDING:o.POSITION_FOLLOWING}for(var c=
g._4e_address(e),b=g._4e_address(b),d=Math.min(c.length,b.length),r=0;r<=d-1;r++)if(c[r]!=b[r])return c[r]<b[r]?o.POSITION_PRECEDING:o.POSITION_FOLLOWING;return c.length<b.length?o.POSITION_CONTAINS+o.POSITION_PRECEDING:o.POSITION_IS_CONTAINED+o.POSITION_FOLLOWING},_4e_address:function(e,a){for(var b=[],c=e.ownerDocument.documentElement,i=e;i&&i!=c;)b.unshift(g._4e_index(i,a)),i=i.parentNode;return b},_4e_remove:function(e,a){var b=e.parentNode;if(b){if(a)for(var c;c=e.firstChild;)b.insertBefore(e.removeChild(c),
e);b.removeChild(e)}return e},_4e_trim:function(e){g._4e_ltrim(e);g._4e_rtrim(e)},_4e_ltrim:function(e){for(var a;a=e.firstChild;){if(a.nodeType==g.TEXT_NODE){var b=k.ltrim(a.nodeValue),c=a.nodeValue.length;if(b)b.length<c&&(g._4e_splitText(a,c-b.length),e.removeChild(e.firstChild));else{e.removeChild(a);continue}}break}},_4e_rtrim:function(e){for(var a;a=e.lastChild;){if(a.type==g.TEXT_NODE){var c=k.rtrim(a.nodeValue),i=a.nodeValue.length;if(c)c.length<i&&(g._4e_splitText(a,c.length),e.removeChild(e.lastChild));
else{e.removeChild(a);continue}}break}!b.ie&&!b.opera&&(a=e.lastChild)&&1==a.nodeType&&"br"==g.nodeName(a)&&e.removeChild(a)},_4e_appendBogus:function(e){for(var a=e.lastChild;a&&a.nodeType==g.TEXT_NODE&&!f.trim(a.nodeValue);)a=a.previousSibling;if(!a||a.nodeType==g.TEXT_NODE||"br"!==g.nodeName(a))a=b.opera?e.ownerDocument.createTextNode(""):e.ownerDocument.createElement("br"),b.gecko&&a.setAttribute("type","_moz"),e.appendChild(a)},_4e_outerHtml:function(e){if(e.outerHTML)return e.outerHTML.replace(/<\?[^>]*>/,
"");var a=e.ownerDocument.createElement("div");a.appendChild(e.cloneNode(!0));return a.innerHTML},_4e_setMarker:function(e,b,c,i){var e=new a(e),g=e.data("list_marker_id")||e.data("list_marker_id",f.guid()).data("list_marker_id"),d=e.data("list_marker_names")||e.data("list_marker_names",{}).data("list_marker_names");b[g]=e;d[c]=1;return e.data(c,i)},_4e_clearMarkers:function(e,b,c){var e=new a(e),i=e.data("list_marker_names"),g=e.data("list_marker_id"),d;for(d in i)i.hasOwnProperty(d)&&e.removeData(d);
e.removeData("list_marker_names");c&&(e.removeData("list_marker_id"),delete b[g])},_4e_copyAttributes:function(e,c,i){for(var c=new a(c),d=e.attributes,i=i||{},l=0;l<d.length;l++){var r=d[l],f=r.name.toLowerCase(),n;if(!(f in i))if("checked"==f&&(n=g.attr(e,f)))c.attr(f,n);else if(r.specified||b.ie&&r.value&&"value"==f)n=g.attr(e,f),null===n&&(n=r.nodeValue),c.attr(f,n)}""!==e.style.cssText&&(c[0].style.cssText=e.style.cssText)},_4e_isEditable:function(e){e=g.nodeName(e);return(e=!c.$nonEditable[e]&&
(c[e]||c.span))&&e["#"]},_4e_getByAddress:function(e,a,b){for(var e=e.documentElement,c=0;e&&c<a.length;c++){var i=a[c];if(b)for(var g=-1,d=0;d<e.childNodes.length;d++){var l=e.childNodes[d];if(!(!0===b&&3==l.nodeType&&l.previousSibling&&3==l.previousSibling.nodeType)&&(g++,g==i)){e=l;break}}else e=e.childNodes[i]}return e}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(f){function j(a){1>arguments.length||(this.range=a,this.forceBrBreak=d,this.enlargeBr=k,this.enforceRealBlocks=d,this._||(this._={}))}var k=!0,d=!1,h=f.Editor,c=f.UA,g=h.Walker,b=h.Range,a=h.RANGE,l=h.ElementPath,o=f.Node,n=f.DOM,p=/^[\r\n\t ]*$/;f.augment(j,{getNextParagraph:function(i){var e,h,m,j,v;if(!this._.lastNode){h=this.range.clone();h.shrink(a.SHRINK_ELEMENT,k);h.enlarge(this.forceBrBreak||!this.enlargeBr?a.ENLARGE_LIST_ITEM_CONTENTS:a.ENLARGE_BLOCK_CONTENTS);
var r=new g(h),s=g.bookmark(k,k);r.evaluator=s;this._.nextNode=r.next();r=new g(h);r.evaluator=s;r=r.previous();this._.lastNode=r._4e_nextSourceNode(k);this._.lastNode&&this._.lastNode[0].nodeType==n.TEXT_NODE&&!f.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(s=new b(h.document),s.moveToPosition(this._.lastNode,a.POSITION_AFTER_END),s.checkEndOfBlock()&&(s=new l(s.endContainer),this._.lastNode=(s.block||s.blockLimit)._4e_nextSourceNode(k)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new o(h.document.createTextNode("")),n.insertAfter(this._.lastNode[0],r[0]));h=null}s=this._.nextNode;r=this._.lastNode;for(this._.nextNode=null;s;){var w=d,y=s[0].nodeType!=n.ELEMENT_NODE,z=d;if(y)s[0].nodeType==n.TEXT_NODE&&p.test(s[0].nodeValue)&&(y=d);else{var t=s.nodeName();if(s._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==t)y=k;else if(!h&&!s[0].childNodes.length&&"hr"!=t){e=s;m=s.equals(r);break}h&&(h.setEndAt(s,a.POSITION_BEFORE_START),"br"!=
t&&(this._.nextNode=s));w=k}else{if(s[0].firstChild){h||(h=new b(this.range.document),h.setStartAt(s,a.POSITION_BEFORE_START));s=new o(s[0].firstChild);continue}y=k}}y&&!h&&(h=new b(this.range.document),h.setStartAt(s,a.POSITION_BEFORE_START));m=(!w||y)&&s.equals(r);if(h&&!w)for(;!s[0].nextSibling&&!m;){t=s.parent();if(t._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){w=k;m||t.equals(r);break}s=t;y=k;m=s.equals(r);z=k}y&&h.setEndAt(s,a.POSITION_AFTER_END);s=s._4e_nextSourceNode(z,null,r);if((m=!s)||
w&&h)break}if(!e){if(!h)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;e=new l(h.startContainer);s=e.blockLimit;w={div:1,th:1,td:1};e=e.block;if((!e||!e[0])&&!this.enforceRealBlocks&&w[s.nodeName()]&&h.checkStartOfBlock()&&h.checkEndOfBlock())e=s;else if(!e||this.enforceRealBlocks&&"li"==e.nodeName())e=new o(this.range.document.createElement(i||"p")),e[0].appendChild(h.extractContents()),e._4e_trim(),h.insertNode(e),j=v=k;else if("li"!=e.nodeName()){if(!h.checkStartOfBlock()||
!h.checkEndOfBlock())e=e.clone(d),e[0].appendChild(h.extractContents()),e._4e_trim(),v=h.splitBlock(),j=!v.wasStartOfBlock,v=!v.wasEndOfBlock,h.insertNode(e)}else m||(this._.nextNode=e.equals(r)?null:h.getBoundaryNodes().endNode._4e_nextSourceNode(k,null,r))}j&&(h=new o(e[0].previousSibling),h[0]&&h[0].nodeType==n.ELEMENT_NODE&&("br"==h.nodeName()?h._4e_remove():h[0].lastChild&&"br"==n.nodeName(h[0].lastChild)&&n._4e_remove(h[0].lastChild)));v&&(h=g.bookmark(d,k),j=new o(e[0].lastChild),j[0]&&j[0].nodeType==
n.ELEMENT_NODE&&"br"==j.nodeName()&&(c.ie||j.prev(h,1)||j.next(h,1))&&j.remove());this._.nextNode||(this._.nextNode=m||e.equals(r)?null:e._4e_nextSourceNode(k,null,r));return e}});b.prototype.createIterator=function(){return new j(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(f){function j(a){for(var l=c,f=c,n=[];a;){if(a[0].nodeType==d.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var p=a.nodeName();if(!f&&(!l&&g[p]&&(l=a),b[p])){var i;if(i=!l)if(i="div"==p){a:{i=a[0].childNodes;for(var e=0,j=i.length;e<j;e++){var m=i[e];if(m.nodeType==d.ELEMENT_NODE&&h.$block[m.nodeName.toLowerCase()]){i=!0;break a}}i=!1}i=!i}i?l=a:f=a}n.push(a);if("body"==p)break}a=a.parent()}this.block=l;this.blockLimit=f;this.elements=n}var k=f.Editor,
d=f.DOM,h=k.XHTML_DTD,c=null,g={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},b={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};j.prototype={compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var c=0;c<b.length;c++)if(!d.equals(b[c],a[c]))return!1;return!0},contains:function(a){for(var b=this.elements,g=0;g<b.length;g++)if(b[g].nodeName()in a)return b[g];return c},toString:function(){var a=this.elements,
b,c=[];for(b=0;b<a.length;b++)c.push(a[b].nodeName());return c.toString()}};return k.ElementPath=j},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/enterKey/index",function(f){function j(a){var d;d=a.getSelection().getRanges();for(var i=d.length-1;0<i;i--)d[i].deleteContents();d=d[0];i=d.document;if(d.checkStartOfBlock()&&d.checkEndOfBlock()){var e=(new o(d.startContainer)).block;if(e&&("li"==e.nodeName()||"li"==e.parent().nodeName()))return a.hasCommand("outdent")?(a.execCommand("save"),a.execCommand("outdent"),a.execCommand("save"),!0):!1}var j=d.splitBlock("p");if(!j)return!0;var a=j.previousBlock,e=j.nextBlock,m=
j.wasStartOfBlock,k=j.wasEndOfBlock,v;if(e)v=e.parent(),"li"==v.nodeName()&&(e._4e_breakParent(v),e._4e_move(e.next(),!0));else if(a&&(v=a.parent())&&"li"==v.nodeName())a._4e_breakParent(v),d.moveToElementEditablePosition(a.next()),a._4e_move(a.prev());if(!m&&!k){if("li"==e.nodeName()&&(v=e.first(l.invisible(!0)))&&f.inArray(v.nodeName(),["ul","ol"]))(h.ie?new b(i.createTextNode("\u00a0")):new b(i.createElement("br"))).insertBefore(v);e&&d.moveToElementEditablePosition(e)}else{var r;if(a){if("li"==a.nodeName()||
!c.test(a.nodeName()))r=a.clone()}else e&&(r=e.clone());r||(r=new b("<p>",null,i));if(v=j.elementPath)for(var j=0,s=v.elements.length;j<s;j++){var w=v.elements[j];if(w.equals(v.block)||w.equals(v.blockLimit))break;g.$removeEmpty[w.nodeName()]&&(w=w.clone(),r._4e_moveChildren(w),r.append(w))}h.ie||r._4e_appendBogus();d.insertNode(r);if(h.ie&&m&&(!k||!a[0].childNodes.length))d.moveToElementEditablePosition(k?a:r),d.select();d.moveToElementEditablePosition(m&&!k?e:r)}h.ie||(e?(r=new b(i.createElement("span")),
r.html("&nbsp;"),d.insertNode(r),r.scrollIntoView(void 0,!1),d.deleteContents()):r.scrollIntoView(void 0,!1));d.select();return!0}function k(b){var c=b.get("document")[0];a.on(c,"keydown",function(a){if(13===a.keyCode&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){b.execCommand("save");var e=b.execCommand("enterBlock");b.execCommand("save");!1!==e&&a.preventDefault()}})}var d=f.Editor,h=f.UA,c=/^h[1-6]$/,g=d.XHTML_DTD,b=f.Node,a=f.Event,l=d.Walker,o=d.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:j});a.docReady(function(){k(a)})}}},{requires:["editor"]});
KISSY.add("editor/core/focusManager",function(f){function j(){var c=this;c.__iframeFocus=l;a=c;b&&clearTimeout(b);b=setTimeout(function(){c.fire("focus")},100)}function k(){var c=this;c.__iframeFocus=o;a=n;b&&clearTimeout(b);b=setTimeout(function(){c.fire("blur")},100)}var d=f.Editor,h=f.DOM,c=f.Event,g={},b,a,f={refreshAll:function(){for(var a in g)if(g.hasOwnProperty(a)){var b=g[a].get("document")[0];b.designMode="off";b.designMode="on"}},currentInstance:function(){return a},getInstance:function(a){return g[a]},
add:function(a){var b=h._getWin(a.get("document")[0]);c.on(b,"focus",j,a);c.on(b,"blur",k,a)},register:function(a){g[a._UUID]=a},remove:function(a){delete g[a._UUID];var b=h._getWin(a.get("document")[0]);c.remove(b,"focus",j,a);c.remove(b,"blur",k,a)}},l=!0,o=!1,n=null;f.refreshAll=f.refreshAll;d.focusManager=f;d.getInstances=function(){return g};return f},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/htmlDataProcessor/index",function(f){return{init:function(j){function k(a){return a.replace(i,function(a,b,c){return"<"+b+c.replace(e,function(a,e){return-1==c.indexOf("_ke_saved_"+e)?" _ke_saved_"+a+" "+a:a})+">"})}function d(a){return a.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+q+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function h(a){return a.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,e){return decodeURIComponent(e)})}
var c=c,g=f.Editor,b=f.Node,a=f.UA,l=f.require("htmlparser"),o=new l.Filter,n=new l.Filter,p=new l.Filter;(function(){var e=function(a,e){return function(b,c){var g=[];(""+b).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(b,d,i){d=d.toLowerCase();"font-family"==d&&(i=i.replace(/["']/g,""));for(var h,f,l,m=0;m<a.length;m++)if(a[m]&&(b=a[m][0],h=a[m][1],f=a[m][2],l=a[m][3],d.match(b)&&(!h||i.match(h)))){d=l||d;e&&(f=f||i);"function"==typeof f&&(f=f(i,c,d));f&&f.push&&
(d=f[0],f=f[1]);"string"==typeof f&&g.push([d,f]);return}!e&&g.push([d,i])});for(var d=0;d<g.length;d++)g[d]=g[d].join(":");return g.length?g.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],c),b={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(a){a.filterChildren()},tags:{p:function(a){a.filterChildren()},$:function(a){var e=a.nodeName||"";if(-1!=e.indexOf(":")&&
!/^ke/.test(e))if("v:imagedata"==e){if(e=a.getAttribute("o:href"))a.setAttribute("src",e),a.removeAttribute("o:href");if(e=a.getAttribute("o:title"))a.setAttribute("title",e),a.removeAttribute("o:title");a.setTagName("img")}else a.setTagName("")}},attributes:{"class":function(a){return!a||/(^|\s+)Mso/.test(a)?!1:a},style:function(a){a=e(a);return!a?!1:a}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},g={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var e=
["name","href","src"],b,c=0;c<e.length;c++)b="_ke_saved_"+e[c],a.getAttribute(b)&&a.removeAttribute(e[c]);return a},embed:function(a){var e=a.parentNode;if(e&&"object"==e.nodeName){var b=e.getAttribute("width"),e=e.getAttribute("height");b&&a.setAttribute("width",b);e&&a.setAttribute("width",e)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1}},attributes:{style:function(a){if(!f.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(a){return a.substr(0,q.length)==q?(a="{C}"==a.substr(q.length,3)?a.substr(q.length+3):a.substr(q.length),new l.CData(decodeURIComponent(a))):a}};a.ie&&(g.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});o.addRules(g);n.addRules(b);p.addRules(b)})();(function(){function e(a){for(var a=a.childNodes,b=a.length,c=a[b-1];c&&3==c.nodeType&&!f.trim(c.nodeValue);)c=a[--b];return c}
function b(c,d){var g=e(c);g&&((d||!a.ie)&&1==g.nodeType&&"br"==g.nodeName?c.removeChild(g):3==g.nodeType&&h.test(g.nodeValue)&&c.removeChild(g))}function c(a){var b=e(a);return!b||1==b.nodeType&&"br"==b.nodeName||"form"==a.nodeName&&"input"==b.nodeName}function d(e){b(e,!0);c(e)&&(a.ie?e.appendChild(new l.Text("\u00a0")):(e.appendChild(new l.Text("&nbsp;")),e.appendChild(new l.Tag("br"))))}function i(a){b(a,!1);c(a)&&a.appendChild(new l.Text("\u00a0"))}var h=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,j=g.XHTML_DTD,k=f.merge(j.$block,
j.$listItem,j.$tableContent),q;for(q in k)k.hasOwnProperty(q)&&("br"in j[q]||delete k[q]);delete k.td;delete k.pre;var j={tags:{}},u={tags:{}};for(q in k)k.hasOwnProperty(q)&&(j.tags[q]=d,u.tags[q]=i);n.addRules(j);o.addRules(u);p.addRules(j)})();(function(){o.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}})})();var i=/<(a|area|img|input)\b([^>]*)>/gi,e=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,q="{ke_protected}";j.htmlDataProcessor={wordFilter:p,dataFilter:n,
htmlFilter:o,toHtml:function(a){var e=new l.BeautifyWriter;(new l.Parser(a)).parse().writeHtml(e,o);return e.getHtml()},toDataFormat:function(e,c,g){g=g||n;a.gecko&&(e=e.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));e=k(e);c=new b("<div>");c.html("a"+e);e=c.html().substr(1);e=h(e);c=new l.BeautifyWriter;(new l.Parser(e)).parse().writeHtml(c,g);e=c.getHtml();return e=d(e)},toServer:function(a){var e=new l.MinifyWriter;(new l.Parser(a)).parse().writeHtml(e,o);return e.getHtml()}}}}},
{requires:["editor"]});
KISSY.add("editor/core/meta",function(){var f={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../select/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubbleview/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],insertOrderedList:["../listUtils/btn","./cmd"],insertUnorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubbleview/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["./focus","dd"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui","./cmd"],
undo:["./btn","./cmd"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},j,k,d={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../select/"],"flashCommon/baseClass":["../contextmenu/","../bubbleview/","../dialogLoader/","./utils"],
"font/ui":["../button/","../select/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../select/"],"indent/cmd":["../dentUtils/cmd"],"insertOrderedList/cmd":["../listUtils/cmd"],"insertUnorderedList/cmd":["../listUtils/cmd.js"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],"link/dialog":["../overlay/",
"./utils"],"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../select/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../select/"],"xiamiMusic/dialog":["../flash/dialog","../select/"]},h={};for(j in f)k="editor/plugin/"+j+"/index",h[k]={requires:f[j]};
for(j in d)k="editor/plugin/"+j,h[k]={requires:d[j]};KISSY.add(h)});
KISSY.add("editor/core/range",function(f,j,k,d,h){function c(a){var e=a.nodeType!=m.TEXT_NODE&&m.nodeName(a)in v.$removeEmpty,b=a.nodeType==m.TEXT_NODE&&!f.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return e||b||a}function g(a){return!y(a)&&!z(a)}function b(a){var e=p;return function(b){if(z(b))return n;if(b.nodeType==m.TEXT_NODE){if(f.trim(b.nodeValue).length)return p}else if(b.nodeType==m.ELEMENT_NODE&&(b=m.nodeName(b),!B[b]))if(!a&&!x.ie&&"br"==b&&!e)e=n;else return p;return n}}
function a(a,e){var b=a.startContainer,c=a.endContainer,g=a.startOffset,d=a.endOffset,i,f=p,h=p,l=void 0,j=a.document,o;if(a.collapsed)return l;0<e&&(l=j.createDocumentFragment());a.optimizeBookmark();c[0].nodeType==m.TEXT_NODE?(h=n,c=c._4e_splitText(d)):0<c[0].childNodes.length&&(d>=c[0].childNodes.length?(c=new r(c[0].appendChild(j.createTextNode(""))),o=n):c=new r(c[0].childNodes[d]));b[0].nodeType==m.TEXT_NODE?(f=n,b._4e_splitText(g)):g?g>=b[0].childNodes.length?(b=new r(b[0].appendChild(j.createTextNode(""))),
i=n):b=new r(b[0].childNodes[g].previousSibling):(i=new r(j.createTextNode("")),b.prepend(i),b=i,i=n);var v=b._4e_parents(),s=c._4e_parents();v.each(function(a,e){v[e]=a});s.each(function(a,e){s[e]=a});for(var y,u,j=0;j<v.length&&!(y=v[j],u=s[j],!y.equals(u));j++);for(var g=l,k,q,w=j;w<v.length;w++){k=v[w];d=0<e&&!k.equals(b)?g.appendChild(k.clone()[0]):null;k=k[0].nextSibling;q=s[w];for(var z=c[0],B=q&&q[0];k&&!(B==k||z==k);)q=k.nextSibling,2==e?g.appendChild(k.cloneNode(n)):(m._4e_remove(k),1==
e&&g.appendChild(k)),k=q;d&&(g=d)}for(g=l;j<s.length;j++){k=s[j];d=0<e&&!k.equals(c)?g.appendChild(k.clone()[0]):null;if(!v[j]||!k._4e_sameLevel(v[j]))for(k=k[0].previousSibling;k;)q=k.previousSibling,2==e?g.insertBefore(k.cloneNode(n),g.firstChild):(m._4e_remove(k),1==e&&g.insertBefore(k,g.firstChild)),k=q;d&&(g=d)}if(2==e){if(f&&(y=b[0],y.nodeType==m.TEXT_NODE&&y.nextSibling&&y.nextSibling.nodeType==m.TEXT_NODE&&(y.data+=y.nextSibling.data,y.parentNode.removeChild(y.nextSibling))),h)h=c[0],h.nodeType==
m.TEXT_NODE&&h.previousSibling&&h.previousSibling.nodeType==m.TEXT_NODE&&(h.previousSibling.data+=h.data,h.parentNode.removeChild(h))}else{if(y&&u&&(!b._4e_sameLevel(y)||!c._4e_sameLevel(u)))h=y._4e_index(),i&&y._4e_sameLevel(b)&&h--,a.setStart(y.parent(),h+1);a.collapse(n)}i&&b.remove();o&&c.remove();return l}function l(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function o(a){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=i;this.collapsed=n;this.document=a}j.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var n=!0,p=!1,i=null,e=j.RANGE,q=j.POSITION,m=f.DOM,x=f.UA,v=j.XHTML_DTD,r=f.Node,s=r.all,w={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},y=new d.whitespaces,z=new d.bookmark,t=d.whitespaces(n),u=d.bookmark(!1,
!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};f.augment(o,{toString:function(){var a=[],e=this.startContainer[0],b=this.endContainer[0];a.push((e.id||e.nodeName)+":"+this.startOffset);a.push((b.id||b.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,e=this.startOffset;a[0].nodeType!=m.ELEMENT_NODE&&(e?e>=a[0].nodeValue.length&&
this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;e=this.endOffset;a[0].nodeType!=m.ELEMENT_NODE&&(e?e>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,
e=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);e&&"span"==e.nodeName()&&e.attr("_ke_bookmark")&&this.setEndAfter(e)},setStart:function(a,e){a[0].nodeType==m.ELEMENT_NODE&&w[a.nodeName()]&&(a=a.parent(),e=a._4e_index());this.startContainer=a;this.startOffset=e;this.endContainer||(this.endContainer=a,this.endOffset=e);l(this)},setEnd:function(a,e){a[0].nodeType==m.ELEMENT_NODE&&w[a.nodeName()]&&(a=a.parent(),e=a._4e_index()+1);this.endContainer=a;this.endOffset=
e;this.startContainer||(this.startContainer=a,this.startOffset=e);l(this)},setStartAt:function(a,b){switch(b){case e.POSITION_AFTER_START:this.setStart(a,0);break;case e.POSITION_BEFORE_END:a[0].nodeType==m.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case e.POSITION_BEFORE_START:this.setStartBefore(a);break;case e.POSITION_AFTER_END:this.setStartAfter(a)}l(this)},setEndAt:function(a,b){switch(b){case e.POSITION_AFTER_START:this.setEnd(a,0);break;
case e.POSITION_BEFORE_END:a[0].nodeType==m.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case e.POSITION_BEFORE_START:this.setEndBefore(a);break;case e.POSITION_AFTER_END:this.setEndAfter(a)}l(this)},cloneContents:function(){return a(this,2)},deleteContents:function(){return a(this,0)},extractContents:function(){return a(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=n},clone:function(){var a=new o(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=m.ELEMENT_NODE||a.endContainer[0].nodeType!=m.ELEMENT_NODE)return i;var e=new d(a);e.evaluator=function(a){return t(a)&&u(a)};a=e.next();e.reset();e=
e.previous();return a&&a.equals(e)?a:i},shrink:function(a,b){if(!this.collapsed){var a=a||e.SHRINK_TEXT,c=this.clone(),g=this.startContainer,i=this.endContainer,h=this.startOffset,f=this.endOffset,l=n,j,r,v=n;g&&g[0].nodeType==m.TEXT_NODE&&(h?h>=g[0].nodeValue.length?c.setStartAfter(g):(c.setStartBefore(g),l=p):c.setStartBefore(g));i&&i[0].nodeType==m.TEXT_NODE&&(f?f>=i[0].nodeValue.length?c.setEndAfter(i):(c.setEndAfter(i),v=p):c.setEndBefore(i));if(l||v)r=new d(c),r.evaluator=function(b){return b.nodeType==
(a==e.SHRINK_ELEMENT?m.ELEMENT_NODE:m.TEXT_NODE)},r.guard=function(b,c){if(a==e.SHRINK_ELEMENT&&b.nodeType==m.TEXT_NODE||c&&b==j)return p;!c&&b.nodeType==m.ELEMENT_NODE&&(j=b);return n};l&&(c=r[a==e.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,b?e.POSITION_AFTER_START:e.POSITION_BEFORE_START);v&&(r.reset(),(r=r[a==e.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(r,b?e.POSITION_BEFORE_END:e.POSITION_AFTER_END));return l||v}},createBookmark2:function(a){var e=this.startContainer,
b=this.endContainer,c=this.startOffset,g=this.endOffset,d,h;if(!e||!b)return{start:0,end:0};if(a){if(e[0].nodeType==m.ELEMENT_NODE&&(d=new r(e[0].childNodes[c]))&&d[0]&&d[0].nodeType==m.TEXT_NODE&&0<c&&d[0].previousSibling.nodeType==m.TEXT_NODE)e=d,c=0;for(;e[0].nodeType==m.TEXT_NODE&&(h=e.prev(void 0,1))&&h[0].nodeType==m.TEXT_NODE;)e=h,c+=h[0].nodeValue.length;if(!this.collapsed){if(b[0].nodeType==m.ELEMENT_NODE&&(d=new r(b[0].childNodes[g]))&&d[0]&&d[0].nodeType==m.TEXT_NODE&&0<g&&d[0].previousSibling.nodeType==
m.TEXT_NODE)b=d,g=0;for(;b[0].nodeType==m.TEXT_NODE&&(h=b.prev(void 0,1))&&h[0].nodeType==m.TEXT_NODE;)b=h,g+=h[0].nodeValue.length}}return{start:e._4e_address(a),end:this.collapsed?i:b._4e_address(a),startOffset:c,endOffset:g,normalized:a,is2:n}},createBookmark:function(a){var b,c,g,d,h=this.collapsed;b=new r("<span>",i,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");a&&(g=f.guid("ke_bm_"),b.attr("id",g+"S"));h||(c=b.clone(),c.html("&nbsp;"),a&&c.attr("id",g+"E"),
d=this.clone(),d.collapse(),d.insertNode(c));d=this.clone();d.collapse(n);d.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,e.POSITION_AFTER_END);return{startNode:a?g+"S":b,endNode:a?g+"E":c,serializable:a,collapsed:h}},moveToPosition:function(a,e){this.setStartAt(a,e);this.collapse(n)},trim:function(a,e){var b=this.startContainer,c=this.startOffset,g=this.collapsed;if((!a||g)&&b[0]&&b[0].nodeType==m.TEXT_NODE){if(c)if(c>=b[0].nodeValue.length)c=b._4e_index()+1,
b=b.parent();else{var d=b._4e_splitText(c),c=b._4e_index()+1,b=b.parent();m.equals(this.startContainer,this.endContainer)?this.setEnd(d,this.endOffset-this.startOffset):m.equals(b,this.endContainer)&&(this.endOffset+=1)}else c=b._4e_index(),b=b.parent();this.setStart(b,c);if(g){this.collapse(n);return}}b=this.endContainer;c=this.endOffset;!e&&!g&&b[0]&&b[0].nodeType==m.TEXT_NODE&&(c?(c>=b[0].nodeValue.length||b._4e_splitText(c),c=b._4e_index()+1):c=b._4e_index(),b=b.parent(),this.setEnd(b,c))},insertNode:function(a){this.optimizeBookmark();
this.trim(p,n);var e=this.startContainer;e[0].insertBefore(a[0],e[0].childNodes[this.startOffset]||null);e[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(a){var e=s(this.document);if(a.is2){var b=e._4e_getByAddress(a.start,a.normalized),c=a.startOffset,e=a.end&&e._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,c);e?this.setEnd(e,a):this.collapse(n)}else b=(c=a.serializable)?f.one("#"+a.startNode,e):a.startNode,a=c?f.one("#"+a.endNode,
e):a.endNode,this.setStartBefore(b),b._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(n)},getCommonAncestor:function(a,e){var b=this.startContainer,c=this.endContainer,b=b[0]==c[0]?a&&b[0].nodeType==m.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new r(b[0].childNodes[this.startOffset]):b:b._4e_commonAncestor(c);return e&&b[0].nodeType==m.TEXT_NODE?b.parent():b},enlarge:function(){function a(e,b,c,g){var d=e[b?"startContainer":"endContainer"],i,h=b?0:1,f=0,l=b?"previousSibling":
"nextSibling";i=e[b?"startOffset":"endOffset"];if(d[0].nodeType==m.TEXT_NODE){if(b){if(i)return}else if(i<d[0].nodeValue.length)return;i=d[0][l];d=d[0].parentNode}else i=d[0].childNodes[i+(b?-1:1)]||null,d=d[0];for(;d;){for(;i;)if(y(i)||z(i))i=i[l];else break;if(i){if(!f)e[b?"setStartAfter":"setEndBefore"](s(i));break}d=s(d);if("body"==d.nodeName())break;if(f||d.equals(g))c[h]=d,f=1;else e[b?"setStartBefore":"setEndAfter"](d);i=d[0][l];d=d[0].parentNode}}return function(b){switch(b){case e.ENLARGE_ELEMENT:if(this.collapsed)break;
var b=this.getCommonAncestor(),c=[];a(this,1,c,b);a(this,0,c,b);c[0]&&c[1]&&(b=c[0].contains(c[1])?c[1]:c[0],this.setStartBefore(b),this.setEndAfter(b));break;case e.ENLARGE_BLOCK_CONTENTS:case e.ENLARGE_LIST_ITEM_CONTENTS:var g=new o(this.document),c=new r(this.document.body);g.setStartAt(c,e.POSITION_AFTER_START);g.setEnd(this.startContainer,this.startOffset);var g=new d(g),h,f,l=d.blockBoundary(b==e.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:i),j=function(a){var e=l(a);e||(h=s(a));return e},v=function(a){var e=
j(a);!e&&"br"==m.nodeName(a)&&(f=s(a));return e};g.guard=j;g=g.lastBackward();h=h||c;this.setStartAt(h,"br"!=h.nodeName()&&(!g&&this.checkStartOfBlock()||g&&h.contains(g))?e.POSITION_AFTER_START:e.POSITION_AFTER_END);g=this.clone();g.collapse();g.setEndAt(c,e.POSITION_BEFORE_END);g=new d(g);g.guard=b==e.ENLARGE_LIST_ITEM_CONTENTS?v:j;h=i;g=g.lastForward();h=h||c;this.setEndAt(h,!g&&this.checkEndOfBlock()||g&&h.contains(g)?e.POSITION_BEFORE_END:e.POSITION_BEFORE_START);f&&this.setEndAfter(f)}}}(),
checkStartOfBlock:function(){var a=this.startContainer,c=this.startOffset;if(c&&a[0].nodeType==m.TEXT_NODE&&f.trim(a[0].nodeValue.substring(0,c)).length)return p;this.trim();a=new h(this.startContainer);c=this.clone();c.collapse(n);c.setStartAt(a.block||a.blockLimit,e.POSITION_AFTER_START);a=new d(c);a.evaluator=b(n);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,c=this.endOffset;if(a[0].nodeType==m.TEXT_NODE&&f.trim(a[0].nodeValue.substring(c)).length)return p;this.trim();
a=new h(this.endContainer);c=this.clone();c.collapse(p);c.setEndAt(a.block||a.blockLimit,e.POSITION_BEFORE_END);a=new d(c);a.evaluator=b(p);return a.checkForward()},checkBoundaryOfElement:function(a,b){var g=this.clone();g[b==e.START?"setStartAt":"setEndAt"](a,b==e.START?e.POSITION_AFTER_START:e.POSITION_BEFORE_END);g=new d(g);g.evaluator=c;return g[b==e.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,e=this.endContainer,b=this.startOffset,c=this.endOffset,
g;if(a[0].nodeType==m.ELEMENT_NODE)if(g=a[0].childNodes.length,g>b)a=s(a[0].childNodes[b]);else if(0==g)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=s(a);a=a._4e_nextSourceNode()||a}if(e[0].nodeType==m.ELEMENT_NODE)if(g=e[0].childNodes.length,g>c)e=s(e[0].childNodes[c])._4e_previousSourceNode(n);else if(0==g)e=e._4e_previousSourceNode();else{for(e=e[0];e.lastChild;)e=e.lastChild;e=s(e)}a._4e_position(e)&q.POSITION_FOLLOWING&&(a=e);return{startNode:a,endNode:e}},fixBlock:function(a,
b){var c=this.createBookmark(),g=s(this.document.createElement(b));this.collapse(a);this.enlarge(e.ENLARGE_BLOCK_CONTENTS);g[0].appendChild(this.extractContents());g._4e_trim();x.ie||g._4e_appendBogus();this.insertNode(g);this.moveToBookmark(c);return g},splitBlock:function(a){var b=new h(this.startContainer),c=new h(this.endContainer),g=b.block,d=c.block,l=i;if(!b.blockLimit.equals(c.blockLimit))return i;"br"!=a&&(g||(g=this.fixBlock(n,a),d=(new h(this.endContainer)).block),d||(d=this.fixBlock(p,
a)));a=g&&this.checkStartOfBlock();b=d&&this.checkEndOfBlock();this.deleteContents();g&&g[0]==d[0]&&(b?(l=new h(this.startContainer),this.moveToPosition(d,e.POSITION_AFTER_END),d=i):a?(l=new h(this.startContainer),this.moveToPosition(g,e.POSITION_BEFORE_START),g=i):(d=this.splitElement(g),!x.ie&&!f.inArray(g.nodeName(),["ul","ol"])&&g._4e_appendBogus()));return{previousBlock:g,nextBlock:d,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:l}},splitElement:function(a){if(!this.collapsed)return i;this.setEndAt(a,
e.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(p);c[0].appendChild(b);c.insertAfter(a);this.moveToPosition(a,e.POSITION_AFTER_END);return c},moveToElementEditablePosition:function(a,b){for(var c=0;a;){if(a[0].nodeType==m.TEXT_NODE){this.moveToPosition(a,b?e.POSITION_AFTER_END:e.POSITION_BEFORE_START);c=1;break}a[0].nodeType==m.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,b?e.POSITION_BEFORE_END:e.POSITION_AFTER_START),c=1);var d=a,i=c,h=void 0;d[0].nodeType==m.ELEMENT_NODE&&
d._4e_isEditable()&&(h=d[b?"last":"first"](g,1));!i&&!h&&(h=d[b?"prev":"next"](g,1));a=h}return!!c},selectNodeContents:function(a){var e=a[0];this.setStart(a,0);this.setEnd(a,e.nodeType==m.TEXT_NODE?e.nodeValue.length:e.childNodes.length)},insertNodeByDtd:function(a){var e,b,c,g=a.nodeName();e=v.$block[g];this.deleteContents();if(e){for(e=this.getCommonAncestor(p,n);(b=v[e.nodeName()])&&(!b||!b[g]);){var d=e.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(e),this.collapse(n),
e.remove()):c=e;e=d}c&&this.splitElement(c)}this.insertNode(a)}});k.injectDom({_4e_breakParent:function(a,e){var e=s(e),a=s(a),b,c=new j.Range(a[0].ownerDocument);c.setStartAfter(a);c.setEndAfter(e);b=c.extractContents();c.insertNode(a.remove());a.after(b)}});j.Range=o},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(f){function j(a){this.document=a;this._={cache:{}};if(n){var e=this.getNative().createRange();if(!e||e.item&&e.item(0).ownerDocument!=a||e.parentElement&&e.parentElement().ownerDocument!=a)this.isInvalid=h}}function k(a){a=new j(a);return!a||a.isInvalid?c:a}var d=f.Editor;d.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var h=!0,c=null,g=f.UA,b=f.DOM,a=f.Node,l=d.SELECTION,o=d.RANGE,n=g.ie,p=d.Walker,i=d.Range,e={img:1,hr:1,li:1,table:1,
tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};f.augment(j,{getNative:!n?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=b._getWin(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!n?function(){var a=this._.cache;if(a.type)return a.type;var c=l.SELECTION_TEXT,g=this.getNative();if(g){if(1==g.rangeCount){var g=g.getRangeAt(0),d=g.startContainer;
d==g.endContainer&&d.nodeType==b.ELEMENT_NODE&&1==Number(g.endOffset-g.startOffset)&&e[d.childNodes[g.startOffset].nodeName.toLowerCase()]&&(c=l.SELECTION_ELEMENT)}}else c=l.SELECTION_NONE;return a.type=c}:function(){var a=this._.cache;if(a.type)return a.type;var e=l.SELECTION_NONE;try{var b=this.getNative(),c=b.type;"Text"==c&&(e=l.SELECTION_TEXT);"Control"==c&&(e=l.SELECTION_ELEMENT);b.createRange().parentElement&&(e=l.SELECTION_TEXT)}catch(g){}return a.type=e},getRanges:n?function(){var e=function(a,
e){a=a.duplicate();a.collapse(e);for(var g=a.parentElement(),d=g.childNodes,i,h=0;h<d.length;h++){var f=d[h];if(f.nodeType==b.ELEMENT_NODE){i=a.duplicate();i.moveToElementText(f);var f=i.compareEndPoints("StartToStart",a),l=i.compareEndPoints("EndToStart",a);i.collapse();if(0<f)break;else{if(!f||1==l&&-1==f)return{container:g,offset:h};if(!l)return{container:g,offset:h+1}}i=c}}i||(i=a.duplicate(),i.moveToElementText(g),i.collapse(!1));i.setEndPoint("StartToStart",a);i=(""+i.text).replace(/\r\n|\r/g,
"\n").length;try{for(;0<i;)i-=d[--h].nodeValue.length}catch(j){i=0}return 0===i?{container:g,offset:h}:{container:d[h],offset:-i}};return function(b){var c=this._.cache;if(c.ranges&&!b)return c.ranges;var g=this.getNative(),b=g&&g.createRange(),d=this.getType();if(!g)return[];if(d==l.SELECTION_TEXT)return g=new i(this.document),d=e(b,h),g.setStart(new a(d.container),d.offset),d=e(b),g.setEnd(new a(d.container),d.offset),c.ranges=[g];if(d==l.SELECTION_ELEMENT){c=c.ranges=[];for(d=0;d<b.length;d++){for(var f=
b.item(d),j=f.parentNode,m=0,g=new i(this.document);m<j.childNodes.length&&j.childNodes[m]!=f;m++);g.setStart(new a(j),m);g.setEnd(new a(j),m+1);c.push(g)}return c}return c.ranges=[]}}():function(e){var b=this._.cache;if(b.ranges&&!e)return b.ranges;var e=[],c=this.getNative();if(!c)return[];for(var g=0;g<c.rangeCount;g++){var d=c.getRangeAt(g),h=new i(this.document);h.setStart(new a(d.startContainer),d.startOffset);h.setEnd(new a(d.endContainer),d.endOffset);e.push(h)}return b.ranges=e},getStartElement:function(){var e=
this._.cache;if(void 0!==e.startElement)return e.startElement;var c,g=this.getNative();switch(this.getType()){case l.SELECTION_ELEMENT:return this.getSelectedElement();case l.SELECTION_TEXT:var d=this.getRanges()[0];if(d&&!d.collapsed){for(d.optimize();h;)if(c=d.startContainer,d.startOffset==(c[0].nodeType===b.ELEMENT_NODE?c[0].childNodes.length:c[0].nodeValue.length)&&!c._4e_isBlockBoundary())d.setStartAfter(c);else break;c=d.startContainer;if(c[0].nodeType!=b.ELEMENT_NODE)return c.parent();c=new a(c[0].childNodes[d.startOffset]);
if(!c[0]||c[0].nodeType!=b.ELEMENT_NODE)return d.startContainer;for(d=c[0].firstChild;d&&d.nodeType==b.ELEMENT_NODE;)c=new a(d),d=d.firstChild;return c}if(n)d=g.createRange(),d.collapse(h),c=new a(d.parentElement());else{if((c=g.anchorNode)&&c.nodeType!=b.ELEMENT_NODE)c=c.parentNode;c&&(c=new a(c))}}return e.startElement=c},getSelectedElement:function(){var c,g=this._.cache;if(void 0!==g.selectedElement)return g.selectedElement;n&&(c=this.getNative().createRange(),c=c.item&&c.item(0));var d;if(c)d=
new a(c);else{c=this.getRanges()[0];for(var i,h=2;h&&(!(d=c.getEnclosedNode())||!(d[0].nodeType==b.ELEMENT_NODE&&e[d.nodeName()]&&(i=d)));h--)c.shrink(o.SHRINK_ELEMENT);d=i}return g.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(a){var e,b=this.document;if(n)try{e=b.body.createControlRange(),e.addElement(a[0]),e.select()}catch(c){e=b.body.createTextRange(),e.moveToElementText(a[0]),e.select()}finally{}else e=b.createRange(),e.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),
a.addRange(e);this.reset()},selectRanges:function(a){if(n){if(1<a.length){var e=a[a.length-1];a[0].setEnd(e.endContainer,e.endOffset);a.length=1}a[0]&&a[0].select()}else{e=this.getNative();if(!e)return;e.removeAllRanges();for(var c=0;c<a.length;c++){var d=a[c],i=this.document.createRange(),h=d.startContainer;if(d.collapsed&&(g.gecko&&1.09>g.gecko||g.opera||g.webkit)&&h[0].nodeType==b.ELEMENT_NODE&&!h[0].childNodes.length)h[0].appendChild(this.document.createTextNode(g.webkit?"\u200b":"")),d.startOffset++,
d.endOffset++;i.setStart(h[0],d.startOffset);i.setEnd(d.endContainer[0],d.endOffset);e.addRange(i)}}this.reset()},createBookmarks2:function(a){for(var e=[],b=this.getRanges(),c=0;c<b.length;c++)e.push(b[c].createBookmark2(a));return e},createBookmarks:function(a,e){for(var c=[],g=this.document,d,e=e||this.getRanges(),i=e.length,l=0;l<i;l++){c.push(d=e[l].createBookmark(a,h));var j=(a=d.serializable)?f.one("#"+d.startNode,g):d.startNode;d=a?f.one("#"+d.endNode,g):d.endNode;for(var m=l+1;m<i;m++){var n=
e[m],o=n.startContainer,k=n.endContainer;b.equals(o,j.parent())&&n.startOffset++;b.equals(o,d.parent())&&n.startOffset++;b.equals(k,j.parent())&&n.endOffset++;b.equals(k,d.parent())&&n.endOffset++}}return c},selectBookmarks:function(a){for(var e=[],b=0;b<a.length;b++){var c=new i(this.document);c.moveToBookmark(a[b]);e.push(c)}this.selectRanges(e);return this},getCommonAncestor:function(){var a=this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=
this.getStartElement();a&&a.scrollIntoView(void 0,!1)},removeAllRanges:function(){var a=this.getNative();n?a&&a.clear():a&&a.removeAllRanges()}});var q={table:1,tbody:1,tr:1},m=p.whitespaces(h),x=/\ufeff|\u00a0/;i.prototype.select=i.prototype.select=!n?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==b.ELEMENT_NODE&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));var e=this.document.createRange();e.setStart(a[0],this.startOffset);try{e.setEnd(this.endContainer[0],
this.endOffset)}catch(c){if(0<=c.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(h),e.setEnd(this.endContainer[0],this.endOffset);else throw c;}a=k(this.document).getNative();a.removeAllRanges();a.addRange(e)}:function(e){var c=this.collapsed,g,d;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var i=this.startContainer[0].childNodes[this.startOffset];if(i.nodeType==b.ELEMENT_NODE){(new j(this.document)).selectElement(new a(i));return}}(this.startContainer[0].nodeType==
b.ELEMENT_NODE&&this.startContainer.nodeName()in q||this.endContainer[0].nodeType==b.ELEMENT_NODE&&this.endContainer.nodeName()in q)&&this.shrink(o.SHRINK_ELEMENT,h);var f=this.createBookmark(),i=f.startNode,l;c||(l=f.endNode);f=this.document.body.createTextRange();f.moveToElementText(i[0]);f.moveStart("character",1);if(l)e=this.document.body.createTextRange(),e.moveToElementText(l[0]),f.setEndPoint("EndToEnd",e),f.moveEnd("character",-1);else{for(g=i[0].nextSibling;g&&!m(g);)g=g.nextSibling;g=!(g&&
g.nodeValue&&g.nodeValue.match(x))&&(e||!i[0].previousSibling||i[0].previousSibling&&"br"==b.nodeName(i[0].previousSibling));d=new a(this.document.createElement("span"));d.html("&#65279;");d.insertBefore(i);g&&b.insertBefore(this.document.createTextNode("\ufeff"),i[0]||i)}this.setStartBefore(i);i._4e_remove();if(c){if(g?(f.moveStart("character",-1),f.select(),this.document.selection.clear()):f.select(),d)this.moveToPosition(d,o.POSITION_BEFORE_START),d._4e_remove()}else this.setEndBefore(l),l._4e_remove(),
f.select()};j.getSelection=k;return d.Selection=j},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/plugin/selection/index",function(f,j){function k(e){function c(e,b){var g=h.body.createTextRange();try{g.moveToPoint(e,b)}catch(d){g=a}return g}function b(){var a=h.selection.createRange();f&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&f.select();o.remove(h,"mouseup",b);o.remove(h,"mousemove",g);f=d=0}function g(a){if(a.button){if(a=c(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",f)?a.setEndPoint("StartToStart",f):a.setEndPoint("EndToEnd",f),a.select()}else b()}var d,
i=e.get("window")[0],h=e.get("document")[0],f;o.on(h,"mousedown contextmenu",function(a){var e=h.documentElement;if(a.target===e&&(d&&b(),!(e.scrollHeight>e.clientHeight)&&(d=1,f=c(a.pageX,a.pageY))))o.on(h,"mouseup",b),o.on(h,"mousemove",g),i.focus(),f.select()})}function d(e){function c(a){if(n){var b=e.getSelection(),h=b&&b.getType(),f=b&&d.selection;if(a&&f&&h==i.SELECTION_NONE&&!d.queryCommandEnabled("InsertImage"))setTimeout(function(){c(g)},50);else{var j;if(!f||!f.type||!("Control"!=f.type&&
(j=f.createRange())&&(j=j.parentElement())&&(j=j.nodeName)&&j.toLowerCase()in{input:1,textarea:1}))l=f&&b.getRanges()[0],e.checkSelectionChange()}}}var d=e.get("document")[0],h=new p(d.body),f=new p(d.documentElement);if(8>j.Utils.ieEngine)f.on("click",function(a){"html"===(new p(a.target)).nodeName()&&e.getSelection().getNative().createRange().select()});var l,n,o=g;f.on("mousedown",function(){o=b});f.on("mouseup",function(){o=g});h.on("focusin",function(e){if("body"==(new p(e.target)).nodeName()&&
l){try{o&&l.select()}catch(b){}l=a}});h.on("focus",function(){n=g;c()});h.on("beforedeactivate",function(a){a.relatedTarget||(n=b,o=g)});h.on("mousedown",function(){n=b});h.on("mouseup",function(){n=g;setTimeout(function(){c(g)},0)});h.on("keydown",function(){n=b});h.on("keyup",function(){n=g;setTimeout(function(){c()},0)})}function h(a){var b=a.get("document")[0];o.on(b,"mouseup keyup",function(){a.checkSelectionChange()})}function c(a){function c(a){var e=j.XHTML_DTD;return a._4e_isBlockBoundary()&&
e.$empty[a.nodeName()]}function d(a){return f(a)&&o(a)}var i=a.get("document")[0],h=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,f=j.Walker.whitespaces(g),o=j.Walker.bookmark(b,g),k=function(a){return f(a)&&8!=a.nodeType};a.on("selectionChange",function(f){var o=f.path,r=new p(a.get("document")[0].body),f=(f=f.selection)&&f.getRanges()[0],u=o.blockLimit;if(l.gecko){var s=o.block||o.blockLimit,C=s&&s.last(d);s&&s._4e_isBlockBoundary()&&
(!C||!(1==C[0].nodeType&&C._4e_isBlockBoundary()))&&"pre"!=s.nodeName()&&!s._4e_getBogus()&&s._4e_appendBogus()}if(f&&f.collapsed&&!o.block){if("body"==u.nodeName()){if((o=f.fixBlock(g,"p"))&&o[0]!=r[0].lastChild&&o._4e_outerHtml().match(h))if((u=o.next(k,1))&&u[0].nodeType==n.ELEMENT_NODE&&!c[u])f.moveToElementEditablePosition(u),o._4e_remove();else if((u=o.prev(k,1))&&u[0].nodeType==n.ELEMENT_NODE&&!c[u])f.moveToElementEditablePosition(u,u._4e_outerHtml().match(h)?b:g),o._4e_remove();f.select();
a.notifySelectionChange()}o=new j.Range(i);o.moveToElementEditablePosition(r,g);"body"!==(new j.ElementPath(o.startContainer)).blockLimit.nodeName()&&(r=(new p(i.createElement("p"))).appendTo(r),l.ie||r._4e_appendBogus())}})}var g=!0,b=!1,a=null,l=f.UA,o=f.Event,n=f.DOM,p=f.Node,i=j.SELECTION;return{init:function(a){a.docReady(function(){l.ie?(k(a),d(a)):h(a)});c(a)}}},{requires:["editor"]});
KISSY.add("editor/core/styles",function(f){function j(a){return!t.attr(a,"_ke_bookmark")}function k(a,e){for(var b in a)a.hasOwnProperty(b)&&(f.isString(a[b])?a[b]=a[b].replace(L,function(a,b){return e[b]}):k(a[b],e))}function d(a,e){e&&(a=f.clone(a),k(a,e));var b=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#"==b||K[b]?u.STYLE_BLOCK:I[b]?u.STYLE_OBJECT:u.STYLE_INLINE;this._={definition:a}}function h(a,e){var b=e?this.removeFromRange:this.applyToRange;a.body.focus();
for(var c=new C(a),g=c.getRanges(),d=0;d<g.length;d++)b.call(this,g[d]);c.selectRanges(g)}function c(a,e,b){var c=a.element;"*"==c&&(c="span");e=new D(e.createElement(c));b&&b._4e_copyAttributes(e);b=a._.definition;a=b.attributes;b=d.getStyleText(b);if(a)for(var g in a)a.hasOwnProperty(g)&&e.attr(g,a[g]);b&&(e[0].style.cssText=b);return e}function g(e){var g=e.createBookmark(w),d=e.createIterator();d.enforceRealBlocks=w;d.enlargeBr=w;for(var i,h=e.document;i=d.getNextParagraph();){var f=c(this,h,
i),j=f,f="pre"==j.nodeName,m="pre"==i.nodeName,o=!f&&m;f&&!m?(m=i,o=m.html(),o=b(o,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),o=o.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),o=o.replace(/([ \t\n\r]+|&nbsp;)/g," "),o=o.replace(/<br\b[^>]*>/gi,"\n"),G.ie?(m=m[0].ownerDocument.createElement("div"),m.appendChild(j[0]),j[0].outerHTML="<pre>"+o+"</pre>",j=new D(m.firstChild),j._4e_remove()):j.html(o)):o?j=l(a(i),j):i._4e_moveChildren(j);i[0].parentNode.replaceChild(j[0],i[0]);if(f&&(i=j,f=void 0,(f=i._4e_previousSourceNode(w,
t.ELEMENT_NODE))&&"pre"==f.nodeName()))j=b(f.html(),/\n$/,"")+"\n\n"+b(i.html(),/^\n/,""),G.ie?i[0].outerHTML="<pre>"+j+"</pre>":i.html(j),f._4e_remove()}e.moveToBookmark(g)}function b(a,e,b){var c="",g="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,e,b){e&&(c=e);b&&(g=b);return""});return c+a.replace(e,b)+g}function a(a){var e=[];b(a._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,e,b){return e+"</pre>"+
b+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,b){e.push(b)});return e}function l(a,e){for(var c=e[0].ownerDocument.createDocumentFragment(),g=0;g<a.length;g++){var d=a[g],d=d.replace(/(\r\n|\r)/g,"\n"),d=b(d,/^[ \t]*\n/,""),d=b(d,/\n$/,""),d=b(d,/^[ \t]+|[ \t]+$/g,function(a,e){return 1==a.length?"&nbsp;":e?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),d=d.replace(/\n/g,"<br>"),d=d.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),
i=e.clone();i.html(d);c.appendChild(i[0])}return c}function o(a){var e=a.document;if(a.collapsed)e=c(this,e,void 0),a.insertNode(e),a.moveToPosition(e,B.POSITION_BEFORE_END);else{var b=this.element,g=this._.definition,d,i=E[b];i||(d=w,i=E.span);var h=a.createBookmark();a.enlarge(B.ENLARGE_ELEMENT);a.trim();for(var f=a.createBookmark(),l=f.startNode,f=f.endNode,m=l,o;m&&m[0];){var n=y;if(t.equals(m,f))m=z,n=w;else{var k=m[0].nodeType,p=k==t.ELEMENT_NODE?m.nodeName():z;if(p&&m.attr("_ke_bookmark")){m=
m._4e_nextSourceNode(w);continue}if(!p||i[p]&&(m._4e_position(f)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!g.childRule||g.childRule(m))){var u=m.parent();if(u&&"a"==b&&u.nodeName()==b)k=c(this,e,void 0),u._4e_moveChildren(k),u[0].parentNode.replaceChild(k[0],u[0]),k._4e_mergeSiblings();else if(u&&u[0]&&((E[u.nodeName()]||E.span)[b]||d)&&(!g.parentRule||g.parentRule(u))){if(!o&&(!p||!E.$removeEmpty[p]||(m._4e_position(f)|
A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))o=new F(e),o.setStartBefore(m);if(k==t.TEXT_NODE||k==t.ELEMENT_NODE&&!m[0].childNodes.length){u=m;for(k=null;(n=!u.next(j,1))&&(k=u.parent())&&i[k.nodeName()]&&(k._4e_position(l)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!g.childRule||g.childRule(k));)u=k;o.setEndAfter(u)}}else n=
w}else n=w;m=m._4e_nextSourceNode()}if(n&&o&&!o.collapsed){for(var n=c(this,e,void 0),u=o.getCommonAncestor(),k={},p={},q,s=null,r;n&&u&&n[0]&&u[0];){if(u.nodeName()==b){for(q in g.attributes)if(g.attributes.hasOwnProperty(q)&&!p[q]&&(r=u.attr(s)))n.attr(q)==r?n.removeAttr(q):p[q]=1;for(s in g.styles)if(g.styles.hasOwnProperty(s)&&!k[s]&&(r=u.style(s)))n.style(s)==r?n.style(s,""):k[s]=1;if(!n._4e_hasAttributes()){n=z;break}}u=u.parent()}n?(n[0].appendChild(o.extractContents()),x(this,n),o.insertNode(n),
n._4e_mergeSiblings(),G.ie||n[0].normalize()):(n=new D(e.createElement("span")),n[0].appendChild(o.extractContents()),o.insertNode(n),x(this,n),n._4e_remove(!0));o=z}}l._4e_remove();f._4e_remove();a.moveToBookmark(h);a.shrink(B.SHRINK_TEXT)}}function n(a){a.enlarge(B.ENLARGE_ELEMENT);var b=a.createBookmark(),c=b.startNode;if(a.collapsed){for(var g=new H(c.parent()),d,i=0,h;i<g.elements.length&&(h=g.elements[i])&&!(h==g.block||h==g.blockLimit);i++)if(this.checkElementRemovable(h)){var f=a.checkBoundaryOfElement(h,
B.END),l=!f&&a.checkBoundaryOfElement(h,B.START);l||f?(d=h,d.match=l?"start":"end"):(h._4e_mergeSiblings(),h.nodeName()!=this.element?(f=e(this),v(h,f[h.nodeName()]||f["*"])):q(this,h))}if(d){h=c;for(i=0;;i++){f=g.elements[i];if(t.equals(f,d))break;else if(f.match)continue;else f=f.clone();f[0].appendChild(h[0]);h=f}h["start"==d.match?"insertBefore":"insertAfter"](d)}}else{var j=b.endNode,m=this,g=function(){for(var a=new H(c.parent()),e=new H(j.parent()),b=z,g=z,d=0;d<a.elements.length;d++){var i=
a.elements[d];if(i==a.block||i==a.blockLimit)break;m.checkElementRemovable(i)&&(b=i)}for(d=0;d<e.elements.length;d++){i=e.elements[d];if(i==e.block||i==e.blockLimit)break;m.checkElementRemovable(i)&&(g=i)}g&&j._4e_breakParent(g);b&&c._4e_breakParent(b)};g();for(d=new D(c[0].nextSibling);d[0]!==j[0];){i=d._4e_nextSourceNode();if(d[0]&&d[0].nodeType==t.ELEMENT_NODE&&this.checkElementRemovable(d)&&(d.nodeName()==this.element?q(this,d):(h=e(this),v(d,h[d.nodeName()]||h["*"])),i[0].nodeType==t.ELEMENT_NODE&&
i.contains(c)))g(),i=new D(c[0].nextSibling);d=i}}a.moveToBookmark(b)}function p(a){var e={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,b,c){e[b]=c});return e}function i(a,e){var b="";e!==y?(b=document.createElement("span"),b.style.cssText=a,b=b.style.cssText||""):b=a;return b.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function e(a){if(a._.overrides)return a._.overrides;var e=a._.overrides={},b=a._.definition.overrides;
if(b){f.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++){var d=b[c],g,i,h;"string"==typeof d?g=d.toLowerCase():(g=d.element?d.element.toLowerCase():a.element,i=d.attributes,h=d.styles);d=e[g]||(e[g]={});if(i){g=d.attributes=d.attributes||[];for(var l in i)i.hasOwnProperty(l)&&g.push([l.toLowerCase(),i[l]])}if(h){var d=d.styles=d.styles||[],j;for(j in h)h.hasOwnProperty(j)&&d.push([j.toLowerCase(),h[j]])}}}return e}function q(a,b){var c=a._.definition,d=e(a),g=f.merge(c.attributes,(d[b.nodeName()]||
d["*"]||{}).attributes),c=f.merge(c.styles,(d[b.nodeName()]||d["*"]||{}).styles),d=f.isEmptyObject(g)&&f.isEmptyObject(c),i;for(i in g)if(g.hasOwnProperty(i)&&!(("class"==i||a._.definition.fullMatch)&&b.attr(i)!=m(i,g[i])))d=d||!!b.hasAttr(i),b.removeAttr(i);for(var h in c)c.hasOwnProperty(h)&&!(a._.definition.fullMatch&&b.style(h)!=m(h,c[h],w))&&(d=d||!!b.style(h),b.style(h,""));r(b)}function m(a,e,b){var c=new D("<span>");c[b?"style":"attr"](a,e);return c[b?"style":"attr"](a)}function x(a,b){for(var c=
e(a),d=b.all(a.element),g=d.length;0<=--g;)q(a,new D(d[g]));for(var i in c)if(c.hasOwnProperty(i)&&i!=a.element){d=b.all(i);for(g=d.length-1;0<=g;g--){var h=new D(d[g]);v(h,c[i])}}}function v(a,e){var b,c=e&&e.attributes;if(c)for(b=0;b<c.length;b++){var d=c[b][0],g;if(g=a.attr(d)){var i=c[b][1];(i===z||i.test&&i.test(g)||"string"==typeof i&&g==i)&&a[0].removeAttribute(d)}}if(c=e&&e.styles)for(b=0;b<c.length;b++)if(d=c[b][0],i=a.css(d)){var h=c[b][1];(h===z||h.test&&h.test(g)||"string"==typeof h&&
i==h)&&a.css(d,"")}r(a)}function r(a){if(!a._4e_hasAttributes()){var e=a[0].firstChild,b=a[0].lastChild;a._4e_remove(w);e&&(e.nodeType==t.ELEMENT_NODE&&t._4e_mergeSiblings(e),b&&e!=b&&b.nodeType==t.ELEMENT_NODE&&t._4e_mergeSiblings(b))}}var s=f.Editor,w=!0,y=!1,z=null,t=f.DOM,u={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},B=s.RANGE,C=s.Selection,A=s.POSITION,F=s.Range,D=f.Node,G=f.UA,H=s.ElementPath,K={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},E=s.XHTML_DTD,I={embed:1,hr:1,img:1,li:1,
object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,L=/#\((.+?)\)/g;s.STYLE=u;d.prototype={apply:function(a){h.call(this,a,y)},remove:function(a){h.call(this,a,w)},applyToRange:function(a){return(this.applyToRange=this.type==u.STYLE_INLINE?o:this.type==u.STYLE_BLOCK?g:z).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==u.STYLE_INLINE?n:z).call(this,a)},checkElementRemovable:function(a,b){if(!a)return y;var c=this._.definition,g;if(a.nodeName()==
this.element){if(!b&&!a._4e_hasAttributes())return w;var h=c._AC;if(h)c=h;else{var h={},f=0,l=c.attributes;if(l)for(var j in l)l.hasOwnProperty(j)&&(f++,h[j]=l[j]);if(l=d.getStyleText(c))h.style||f++,h.style=l;h._length=f;c=c._AC=h}if(c._length){for(var m in c)if("_length"!=m&&c.hasOwnProperty(m)){f=a.attr(m)||"";if("style"==m)a:{h=c[m];f=i(f,y);"string"==typeof h&&(h=p(h));"string"==typeof f&&(f=p(f));l=void 0;for(l in h)if(h.hasOwnProperty(l)&&!(l in f&&(f[l]==h[l]||"inherit"==h[l]||"inherit"==
f[l]))){h=y;break a}h=w}else h=c[m]==f;if(h){if(!b)return w}else if(b)return y}if(b)return w}else return w}m=e(this);if(m=m[a.nodeName()]||m["*"]){if(!(c=m.attributes)&&!(g=m.styles))return w;if(c)for(h=0;h<c.length;h++)if(m=c[h][0],m=a.attr(m))if(f=c[h][1],f===z||"string"==typeof f&&m==f||f.test&&f.test(m))return w;if(g)for(h=0;h<g.length;h++)if(m=a.css(g[h][0]))if(c=g[h][1],c===z||"string"==typeof c&&m==c||c.test&&c.test(m))return w}return y},checkActive:function(a){switch(this.type){case u.STYLE_BLOCK:return this.checkElementRemovable(a.block||
a.blockLimit,w);case u.STYLE_OBJECT:case u.STYLE_INLINE:for(var e=a.elements,b=0,c;b<e.length;b++)if(c=e[b],!(this.type==u.STYLE_INLINE&&(t.equals(c,a.block)||t.equals(c,a.blockLimit))))if((this.type!=u.STYLE_OBJECT||c.nodeName()in I)&&this.checkElementRemovable(c,w))return w}return y}};d.getStyleText=function(a){var e=a._ST;if(e)return e;var e=a.styles,b=a.attributes&&a.attributes.style||"",c="";b.length&&(b=b.replace(J,";"));for(var d in e)if(e.hasOwnProperty(d)){var g=e[d],h=(d+":"+g).replace(J,
";");"inherit"==g?c+=h:b+=h}b.length&&(b=i(b));return a._ST=b+c};s.Style=d},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(f){var j=f.Node,k=f.DOM,d=f.UA,h={debugUrl:function(c){var d=f.Config;d.debug||(c=c.replace(/\.(js|css)/i,"-min.$1"));-1==c.indexOf("?t")&&(c=-1!=c.indexOf("?")?c+"&":c+"?",c+="t="+encodeURIComponent(d.tag));return d.base+"editor/"+c},lazyRun:function(c,d,b){var a=c[d],h=c[b];c[d]=function(){a.apply(this,arguments);c[d]=c[b];return h.apply(this,arguments)}},getXY:function(c,d,b,a){b=b.defaultView||b.parentWindow;c-=k.scrollLeft(b);d-=k.scrollTop(b);a&&(a=a.defaultView||
a.parentWindow,b!=a&&b.frameElement&&(a=k.offset(b.frameElement,void 0,a),c+=a.left,d+=a.top));return{left:c,top:d}},tryThese:function(c){for(var d,b=0,a=arguments.length;b<a;b++){var h=arguments[b];try{d=h();break}catch(f){}}return d},arrayCompare:function(c,d){if(!c&&!d)return!0;if(!c||!d||c.length!=d.length)return!1;for(var b=0;b<c.length;b++)if(c[b]!==d[b])return!1;return!0},clearAllMarkers:function(c){for(var d in c)c.hasOwnProperty(d)&&c[d]._4e_clearMarkers(c,!0,void 0)},ltrim:function(c){return c.replace(/^\s+/,
"")},rtrim:function(c){return c.replace(/\s+$/,"")},isNumber:function(c){return/^\d+(.\d+)?$/.test(f.trim(c))},verifyInputs:function(c){for(var d=0;d<c.length;d++){var b=new j(c[d]),a=f.trim(h.valInput(b)),l=b.attr("data-verify"),b=b.attr("data-warning");if(l&&!RegExp(l).test(a))return alert(b),!1}return!0},sourceDisable:function(c,d){c.on("sourceMode",d.disable,d);c.on("wysiwygMode",d.enable,d)},resetInput:function(c){var g=c.attr("placeholder");g&&d.ie?(c.addClass("ks-editor-input-tip"),c.val(g)):
d.ie||c.val("")},valInput:function(c,d){if(void 0===d)return c.hasClass("ks-editor-input-tip")?"":c.val();c.removeClass("ks-editor-input-tip");c.val(d)},placeholder:function(c,g){c.attr("placeholder",g);d.ie&&(c.on("blur",function(){f.trim(c.val())||(c.addClass("ks-editor-input-tip"),c.val(g))}),c.on("focus",function(){c.removeClass("ks-editor-input-tip");f.trim(c.val())==g&&c.val("")}))},htmlEncode:function(c){return!c?c:(""+c).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,
"&quot;")},normParams:function(c){var c=f.clone(c),d;for(d in c)if(c.hasOwnProperty(d)){var b=c[d];f.isFunction(b)&&(c[d]=b())}return c},map:function(c,d){for(var b=0;b<c.length;b++)c[b]=d(c[b]);return c},ieEngine:document.documentMode||d.ie,preventFocus:function(c){d.ie?c.unselectable(void 0):c.attr("onmousedown","return false;")},injectDom:function(c){f.mix(k,c);for(var d in c)c.hasOwnProperty(d)&&function(b){j.prototype[b]=function(){var a=[].slice.call(arguments,0);a.unshift(this[0]);return(a=
c[b].apply(null,a))&&(a.nodeType||f.isWindow(a))?new j(a):f.isArray(a)&&(a.__IS_NODELIST||a[0]&&a[0].nodeType)?new j(a):a}}(d)},addRes:function(){var c=this.__res=this.__res||[];c.push.apply(c,f.makeArray(arguments))},destroyRes:function(){for(var c=this.__res||[],d=0;d<c.length;d++){var b=c[d];f.isFunction(b)?b():(b.destroy&&b.destroy(),b.remove&&b.remove())}this.__res=[]},getQueryCmd:function(c){return"query"+("-"+c).replace(/-(\w)/g,function(c,b){return b.toUpperCase()})+"Active"}};return f.Editor.Utils=
h},{requires:["./base"]});
KISSY.add("editor/core/walker",function(f,j){function k(a,e){if(this._.end)return b;var d,i=this.range,h,f=this.guard,j=this.type,o=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,i.trim(),i.collapsed))return this.end(),b;if(!a&&!this._.guardLTR){var k=i.endContainer[0],p=k.childNodes[i.endOffset];this._.guardLTR=function(a,e){return e&&(k==a||"body"==l.nodeName(a))?!1:a!=p}}if(a&&!this._.guardRTL){var q=i.startContainer[0],C=0<i.startOffset&&q.childNodes[i.startOffset-
1]||null;this._.guardRTL=function(a,e){return e&&(q==a||"body"==l.nodeName(a))?!1:a!=C}}var A=a?this._.guardRTL:this._.guardLTR;h=f?function(a,e){return A(a,e)===g?g:f(a,e)}:A;this.current?d=this.current[o](g,j,h):a?(d=i.endContainer,0<i.endOffset?(d=new n(d[0].childNodes[i.endOffset-1]),h(d[0])===g&&(d=b)):d=h(d,c)===g?b:d._4e_previousSourceNode(c,j,h,void 0)):(d=i.startContainer,d=new n(d[0].childNodes[i.startOffset]),d.length?h(d[0])===g&&(d=b):d=h(i.startContainer,c)===g?b:i.startContainer._4e_nextSourceNode(c,
j,h,void 0));for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d[0])!==g){if(!e)return d}else if(e&&this.evaluator)return g;d=d[o](g,j,h)}this.end();return this.current=b}function d(a){for(var e,c=b;e=k.call(this,a);)c=e;return c}function h(a){this.range=a;this.guard=this.evaluator=b;this._={}}var c=!0,g=!1,b=null,a=f.UA,l=f.DOM,o=j.XHTML_DTD,n=f.Node;f.augment(h,{end:function(){this._.end=1},next:function(){return k.call(this)},previous:function(){return k.call(this,c)},checkForward:function(){return k.call(this,
g,c)!==g},checkBackward:function(){return k.call(this,c,c)!==g},lastForward:function(){return d.call(this)},lastBackward:function(){return d.call(this,c)},reset:function(){delete this.current;this._={}},_iterator:k});f.mix(h,{blockBoundary:function(a){return function(e){return!(e.nodeType==l.ELEMENT_NODE&&l._4e_isBlockBoundary(e,a))}},bookmark:function(a,e){function b(a){return"span"==l.nodeName(a)&&l.attr(a,"_ke_bookmark")}return function(c){var d,g;d=c.nodeType==l.TEXT_NODE&&(g=c.parentNode)&&b(g);
d=a?d:d||b(c);return!!(e^d)}},whitespaces:function(a){return function(e){e=e.nodeType==l.TEXT_NODE&&!f.trim(e.nodeValue);return!!(a^e)}},invisible:function(a){var e=h.whitespaces();return function(b){b=e(b)||b.nodeType==l.ELEMENT_NODE&&!b.offsetHeight;return!!(a^b)}}});var p=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,i=h.whitespaces(),e=h.bookmark(),q=function(a){var b=l.nodeName(a);return e(a)||i(a)||1==a.nodeType&&b in o.$inline&&!(b in o.$empty)};j.Utils.injectDom({_4e_getBogus:function(e){e=new n(e);do e=
e._4e_previousSourceNode();while(e&&q(e[0]));return e&&(!a.ie?"br"==e.nodeName():3==e[0].nodeType&&p.test(e.text()))?e[0]:!1}});return j.Walker=h},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(f){var j=f.Editor;j.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};j.baseZIndex=function(f){return(j.Config.baseZIndex||1E4)+f}},{requires:["./base"]});
KISSY.add("editor",function(f,j,k,d){function h(a,e){var b=a.body;s(function(){a.designMode="on";setTimeout(function(){a.designMode="off";b.focus();arguments.callee.retry||(arguments.callee.retry=o)},50)},function(){a.designMode="off";x.attr(b,"contentEditable",i);x.attr(b,"contentEditable",o);!e&&h(a,1)})}function c(a){a.get("iframe");var e=a.get("textarea")[0],b=a.get("window")[0],c=a.get("document")[0];q.webkit&&(r.on(c,"click",function(a){var e=new v(a.target);f.inArray(e.nodeName(),["input",
"select"])&&a.preventDefault()}),r.on(c,"mouseup",function(a){var e=new v(a.target);f.inArray(e.nodeName(),["input","textarea"])&&a.preventDefault()}));if(q.gecko||m||q.opera){var g;g=(new v('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(e);g.on("focus",function(){a.focus()});a.activateGecko=function(){q.gecko&&a.__iframeFocus&&g[0].focus()};a.on("destroy",function(){g.detach();g.remove()})}r.on(b,"focus",function(){q.gecko?h(c,i):q.opera&&c.body.focus();
a.notifySelectionChange()});if(q.gecko)r.on(c,"mousedown",function(){a.__iframeFocus||h(c,i)});if(m&&(r.on(c,"keydown",function(e){if(e.keyCode in{8:1,46:1}){var b=a.getSelection(),c=b.getSelectedElement();if(c){a.fire("save");var d=b.getRanges()[0].createBookmark();c.remove();b.selectBookmarks([d]);a.fire("save");e.preventDefault()}}}),"CSS1Compat"==c.compatMode)){var l={33:1,34:1};r.on(c,"keydown",function(e){e.keyCode in l&&setTimeout(function(){a.getSelection().scrollIntoView()},0)})}if(q.webkit)r.on(c,
"mousedown",function(e){e=new v(e.target);f.inArray(e.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(e)});if(q.gecko)r.on(c,"dragstart",function(a){var e=new v(a.target);e.nodeName()==="img"&&/ke_/.test(e[0].className)&&a.preventDefault()});d.add(a)}function g(a,b,c,d){var g="",i,h=k.debugUrl("theme/editor-iframe.css");for(i=0;i<c.length;i++)g+=f.substitute('<link href="{href}" rel="stylesheet" />',{href:c[i]});return f.substitute(w,{doctype:8===e.documentMode?
'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:h,style:b,data:d||"&nbsp;",script:a?'<script id="ke_active_script">'+(x.isCustomDomain()?'document.domain="'+e.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function b(a,e){a.__saveTimer&&(clearTimeout(a.__saveTimer),a.__saveTimer=null);a.__saveTimer=setTimeout(function(){a.execCommand("save")},e||0)}function a(a,e){function b(){f=h.document;a.__set("document",new v(f));a.__set("window",new v(h));
c.detach();f.open("text/html","replace");f.write(d);f.close()}var c=a.get("iframe"),d=g(a._UUID,a.get("customStyle"),a.get("customLink"),e),i=c[0],h=i.contentWindow,f;c.__loaded=1;try{f=h.document}catch(l){if(i.src=i.src,7>m){setTimeout(b,10);return}}b()}function l(e,b){var c=new v(z),d=e.get("textarea");d.hasAttr("tabindex")&&c.attr("tabIndex",q.webkit?-1:d.attr("tabIndex"));e.get("iframeWrapEl").prepend(c);e.set("iframe",c);e.__docReady=0;if(q.gecko&&!c.__loaded)c.on("load",function(){a(e,b)},e);
else a(e,b)}var o=!0,n=n,p=f.all,i=!1,e=document,q=f.UA,m=q.ie,x=f.DOM,v=f.Node,r=f.Event,s=k.tryThese,w="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor'>{data}{script}</body></html>",y=x.getEmptyIframeSrc(),z='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true" '+(y?' src="'+y+'"':"")+"</iframe>";f.mix(j,{SOURCE_MODE:0,WYSIWYG_MODE:1});
var t=j.WYSIWYG_MODE;f.augment(j,{createDom:function(){var a,e=this.get("textarea"),b;e||this.set("textarea",e=p("<textarea class='ks-editor-textarea'></textarea>"));b=this.get("el");b.html('<div class="ks-editor-tools"></div><div class="ks-editor-textarea-wrap"></div><div class=\'ks-editor-status\'></div>');this._UUID=f.guid();this.set({iframeWrapEl:a=b.one(".ks-editor-textarea-wrap"),toolBarEl:b.one(".ks-editor-tools"),statusBarEl:b.one(".ks-editor-status")},{silent:1});e.css("width","100%");e.css("display",
"none");a.append(e);d.register(this)},_uiSetHeight:function(a){var e=this.get("toolBarEl"),b=this.get("statusBarEl"),a=parseInt(a,10),a=a-((e&&e.outerHeight()||0)+(b&&b.outerHeight()||0));this.get("iframeWrapEl").css("height",a);this.get("textarea").css("height",a)},adjustHeight:function(){var a;(a=this.get("height"))&&this._uiSetHeight(a)},_uiSetMode:function(a){var e=this,b,c=e.get("iframe"),d=e.get("textarea");a==t?(e.execCommand("save"),e.on("docReady",b=function(){e.execCommand("save");e.detach("docReady",
b)}),e._setData(d.val()),e.fire("wysiwygMode")):(d.val(e._getData(1,t)),d[0].focus(),d.show(),c.hide(),e.fire("sourceMode"))},_uiSetFocused:function(a){a&&this.__docReady&&this.focus()},bindUI:function(){function a(){e.detach("docReady",a);if(e.get("focused"))e.focus();else{var b=e.getSelection();b&&b.removeAllRanges()}}var e=this,b,c=e.get("prefixCls"),d=e.get("textarea");if(e.get("attachForm")&&(b=d[0].form))x.on(b,"submit",e.sync,e),e.on("destroy",function(){x.detach(b,"submit",e.sync,e)});e.on("docReady",
a);e.on("blur",function(){e.get("el").removeClass(c+"editor-focused")});e.on("focus",function(){e.get("el").addClass(c+"editor-focused")})},destructor:function(){var a=this.get("document")[0],e=this.get("window");this.sync();d.remove(this);r.remove([a,a.documentElement,a.body,e[0]]);f.each(this.__dialogs,function(a){a.destroy&&a.destroy()});this.__commands=0},addDialog:function(a,e){this.__dialogs[a]=e},showDialog:function(a,e){var b=this.__dialogs[a];b.show(e);this.fire("dialogShow",{dialog:b.dialog,
pluginDialog:b,dialogName:a})},hasDialog:function(a){return!!this.__dialogs[a]},addCommand:function(a,e){this.__commands[a]=e},hasCommand:function(a){return this.__commands[a]},execCommand:function(a){var e=this.__commands[a],b=f.makeArray(arguments);b.shift();b.unshift(this);if(e)return e.exec.apply(e,b)},_getData:function(a,e){var b=this.htmlDataProcessor,c;e==n&&(e=this.get("mode"));c=e==t?this.get("document")[0].body.innerHTML:b.toDataFormat(this.get("textarea").val());c=a?b.toHtml(c):b.toServer(c);
c=f.trim(c);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(c)&&(c="");return c},_setData:function(a){var e,b=a;if(this.get("mode")!=t)this.get("textarea").val(a);else{if(e=this.htmlDataProcessor)b=e.toDataFormat(a,"p");if(this.get("iframe")){a=this.get("iframe");e=this.get("window")[0];var c=this.get("document")[0];r.remove([c,c.documentElement,c.body,e]);a.remove()}l(this,b)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return g(0,this.get("customStyle"),this.get("customLink"),
this.get("formatData"))},getSelection:function(){return j.Selection.getSelection(this.get("document")[0])},focus:function(){var a=this.get("document")[0],e=x._getWin(a);q.ie||e&&e.parent&&e.parent.focus();e&&e.focus();a.body.focus();this.notifySelectionChange()},blur:function(){x._getWin(this.get("document")[0]).blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,e){var b=this.get("customStyle")||"",b=b+("\n"+a);this.set("customStyle",b);x.addStyleSheet(this.get("window"),b,e)},
removeCustomStyle:function(a){x.remove(x.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var e=this.get("customLink")||[],b=this.get("document")[0];e.push(a);this.set("customLink",e);e=b.createElement("link");e.rel="stylesheet";b.getElementsByTagName("head")[0].appendChild(e);e.href=a},removeCustomLink:function(a){for(var e=this.get("document")[0],e=x.query("link",e),b=0;b<e.length;b++)x.attr(e[b],"href")==a&&x.remove(e[b]);e=this.get("customLink")||[];a=f.indexOf(a,e);-1!=a&&e.splice(a,
1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var e=a.getSelection();if(e&&!e.isInvalid){var b=e.getStartElement(),c=new j.ElementPath(b);if(!a.__previousPath||!a.__previousPath.compare(c))a.__previousPath=c,a.fire("selectionChange",{selection:e,path:c,element:b})}},100)},notifySelectionChange:function(){this.__previousPath=
null;this.checkSelectionChange()},insertElement:function(a){if(this.get("mode")===t){this.focus();var e,c=a.nodeName(),d=j.XHTML_DTD,g=d.$block[c],i=j.RANGE,h=(c=this.getSelection())&&c.getRanges(),f,l,m;if(h&&0!=h.length){this.execCommand("save");for(l=h.length-1;0<=l;l--)f=h[l],e=!l&&a||a.clone(o),f.insertNodeByDtd(e),m||(m=e);if(m)return f.moveToPosition(m,i.POSITION_AFTER_END),g&&(a=j.Walker.whitespaces(!0),(a=(m=m.next(a,1))&&m[0].nodeType==x.ELEMENT_NODE&&m.nodeName())&&d.$block[a]&&d[a]["#"]&&
f.moveToElementEditablePosition(m)),c.selectRanges([f]),this.focus(),e&&e.scrollIntoView(n,!1),b(this),e}}},insertHtml:function(a,e){var c=this,d;if(c.get("mode")===t){if(d=c.htmlDataProcessor)a=d.toDataFormat(a,null,e);c.focus();c.execCommand("save");var g=c.get("document")[0];d=0;if(m){var h=g.selection;"Control"==h.type&&h.clear();try{h.createRange().pasteHTML(a)}catch(f){}}else try{g.execCommand("inserthtml",i,a)}catch(l){setTimeout(function(){if(0==c.getSelection().getRanges().length){var e=
new j.Range(g),b=x.first(g.body,function(a){return 1==a.nodeType&&"br"!=x.nodeName(a)});b||(b=new v(g.createElement("p")),b._4e_appendBogus(n),g.body.appendChild(b[0]));e.setStartAt(b,j.RANGE.POSITION_AFTER_START);e.select()}g.execCommand("inserthtml",i,a)},d=100)}setTimeout(function(){c.getSelection().scrollIntoView()},d);b(c,d)}}});j._initIFrame=function(a){var e=d.getInstance(a),b=e.get("document")[0],a=b.getElementById("ke_active_script");x.remove(a);c(e);var g=b.body;m?(g.hideFocus=o,g.disabled=
o,g.contentEditable=o,g.removeAttribute("disabled")):setTimeout(function(){q.gecko||q.opera?g.contentEditable=o:q.webkit?g.parentNode.contentEditable=o:b.designMode="on"},0);if(q.gecko||q.opera){var f=b.documentElement;r.on(f,"mousedown",function(a){if(a.target==f){q.gecko&&h(b,i);e.activateGecko()}})}setTimeout(function(){m&&setTimeout(function(){if(b){g.runtimeStyle.marginBottom="0px";g.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){e.__docReady=1;e.fire("docReady");var a=e.get("disableObjectResizing"),
c=e.get("disableInlineTableEditing");if(a||c)try{b.execCommand("enableObjectResizing",i,!a);b.execCommand("enableInlineTableEditing",i,!c)}catch(d){r.on(g,m?"resizestart":"resize",function(e){var b=new v(e.target);(a||b.nodeName()==="table"&&c)&&e.preventDefault()})}},10)};return j},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/focusManager,editor/core/meta".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(f,j){var k={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(d){d.hasCommand("backColor")||d.addCommand("backColor",{exec:function(d,c){d.execCommand("save");j.applyColor(d,c,k);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(f,j,k,d){return{init:function(h){d.init(h);h.addButton({cmdType:"backColor",title:"\u80cc\u666f\u989c\u8272",contentCls:"ks-editor-toolbar-back-color"},void 0,k)}}},{requires:["editor","../color/btn","./cmd"]});KISSY.add("editor/plugin/bold/cmd",function(f,j,k){var d=new j.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(h){k.addButtonCmd(h,"bold",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(f,j,k,d){return{init:function(h){d.init(h);h.addButton({cmdType:"bold",contentCls:"ks-editor-toolbar-bold",title:"\u7c97\u4f53 "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubbleview/index",function(f,j,k){function d(b){var c=null,d=a[f.stamp(b.editor)];f.each(d,function(a){var d;if(d=a!==b)if(d=a.get("visible")){d=b.get("y");var e=d+b.get("el").outerHeight(),g=a.get("y"),h=g+a.get("el").outerHeight();d=d<=h&&e>=h||d<=g&&e>=g}d&&(c?c.get("y")<a.get("y")&&(c=a):c=a);return c})}var h=f.Event,c={}.a,g=f.DOM,b=j.extend({},{ATTRS:{zIndex:{value:k.baseZIndex(k.zIndexManager.BUBBLE_VIEW)},elCls:{value:"ks-editor-bubbleview-bubble"},prefixCls:{value:"ks-editor-"},
effect:{value:{effect:"fade",duration:0.3}}}}),a={};b.register=function(l){function j(){m&&(m.hide(),h.remove(r,"scroll",k))}function n(){var a;var e=m.selectedEl,b=m.editor;if(e){var i=b.get("window")[0],h=b.get("iframe").offset(),b=h.top,h=h.left,f=h+g.width(i),i=b+g.height(i),l=e.offset(c,window),j=l.top,l=l.left,o=l+e.width(),e=j+e.height(),n;e>i&&j<i?n=i-30:e>b&&e<i&&(n=e);o>h&&l<h?a=h:l>h&&l<f&&(a=l);a=a!==c&&n!==c?[a,n]:c}else a=c;if(a){m.set("xy",a);if(n=d(m))a[1]=n.get("y")+n.get("el").outerHeight(),
m.set("xy",a);m.get("visible")||m.show()}}function k(){m.selectedEl&&(m&&(m.get("el"),m.hide()),s())}function i(){h.on(r,"scroll",k);n()}var e=l.filter,q=l.editor,m=new b({editor:q}),x=f.stamp(q),v=a[x]=a[x]||[];m.init=l.init;if(m.init)m.on("afterRenderUI",function(){m.init()});v.push(m);m.editor=q;q.on("destroy",function(){delete a[x];m.destroy()});q.on("selectionChange",function(a){var a=a.path,b=a.elements;if(a&&b&&(a=a.lastElement))(a=e(a))?(m.selectedEl=a,m.hide(),f.later(i,10)):m&&j()});q.on("sourceMode",
j);var r=q.get("window")[0],s=f.buffer(n,350)};return b},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(f,j,k){function d(c){return c&&-1==c.indexOf("<")?c:0}var h=k.define([k.UIBase.Box.Render],{_updateHref:function(){this.get("el").attr("href","javascript:void('"+(d(this.get("text"))||d(this.get("title")))+"')")},bindUI:function(){var c=this,d=c.get("keepFocus"),b=c.get("el");b.on("click",c._action,c);d&&b.unselectable();b.on("mousedown",function(a){"off"==c.get("state")&&b.addClass("ks-editor-triplebutton-active");d&&a.halt()});b.on("mouseup mouseleave",
function(){"off"==c.get("state")&&b.hasClass("ks-editor-triplebutton-active")&&setTimeout(function(){b.removeClass("ks-editor-triplebutton-active")},300)})},_uiSetTitle:function(){this.get("el").attr("title",this.get("title"));this._updateHref()},_uiSetContentCls:function(c){var d=this.get("el");void 0!==c&&(d.html("<span class='ks-editor-toolbar-item "+c+"' />"),this.get("keepFocus")&&d.unselectable(void 0))},_uiSetText:function(c){this.get("el").html(c);this._updateHref()},_uiSetState:function(c,
d){this["_"+c](d)},disable:function(){this.set("state","disabled")},enable:function(){"disabled"==this.get("state")&&this.set("state",this._savedState)},_action:function(c){this.fire(this.get("state")+"Click",{TripleEvent:c});this.fire("click",{TripleClickType:this.get("state")+"Click"});this.get("keepFocus")||this.get("el")[0].focus()},bon:function(){this.set("state","on")},boff:function(){this.set("state","off")},_on:function(){this.get("el").removeClass("ks-editor-triplebutton-off ks-editor-triplebutton-disabled").addClass("ks-editor-triplebutton-on")},
_off:function(){this.get("el").removeClass("ks-editor-triplebutton-on ks-editor-triplebutton-disabled").addClass("ks-editor-triplebutton-off")},_disabled:function(c){var d=this.get("el");this._savedState=c.prevVal;d.removeClass("ks-editor-triplebutton-off ks-editor-triplebutton-on").addClass("ks-editor-triplebutton-disabled")}},{name:"editor/plugin/button",ATTRS:{state:{value:"off"},elCls:{value:"ks-editor-triplebutton ks-editor-triplebutton-off"},elTagName:{value:"a"},title:{},contentCls:{},text:{},
keepFocus:{value:!0}}});h.ON="on";h.OFF="off";h.DISABLED="disabled";h.ON_CLASS="ks-editor-triplebutton-on";h.OFF_CLASS="ks-editor-triplebutton-off";h.DISABLED_CLASS="ks-editor-triplebutton-disabled";j.TripleButton=h;j.prototype.addButton=function(c,d,b){var b=b||h,a=this,l=new b(f.mix({render:a.get("toolBarEl"),autoRender:!0,editor:a},c));f.mix(l,d);l.init&&l.init();a.on("selectionChange",function(){a.get("mode")!=j.SOURCE_MODE&&l.selectionChange&&l.selectionChange.apply(l,arguments)});l.on("click",
function(a){var b=a.TripleClickType;l[b]&&l[b].apply(l,arguments)});l.get("mode")==j.WYSIWYG_MODE&&(a.on("wysiwygMode",l.enable,l),a.on("sourceMode",l.disable,l));a.on("destroy",function(){l.destroy()});return l};return h},{requires:["editor","component"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(f,j){function k(c){this.editor=c;this._init()}var d=f.Node,h=j.SOURCE_MODE,c=j.WYSIWYG_MODE;f.augment(k,{_init:function(){var c=this.editor,b=c.get("statusBarEl");this.holder=(new d("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(b);(this.el=this.holder.one("input")).on("click",
this._check,this);c.on("wysiwygMode",this._wysiwygmode,this);c.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var d=this.editor;this.el.attr("checked")?d.set("mode",h):d.set("mode",c)},destroy:function(){this.holder.remove()}});return{init:function(c){var b=new k(c);c.on("destroy",function(){b.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(f,j,k,d,h){function c(){c.superclass.constructor.apply(this,arguments)}var g=f.Node;f.DOM.addStyleSheet(".ks-editor-color-panel a {display: block;color:black;text-decoration: none;}.ks-editor-color-panel a:hover {color:black;text-decoration: none;}.ks-editor-color-panel a:active {color:black;}.ks-editor-color-palette {    margin: 5px 8px 8px;}.ks-editor-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ks-editor-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ks-editor-color-a {    height: 18px;    width: 18px;}a.ks-editor-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ks-editor-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ks-editor-color-remove:hover {    background-color: #D6E9F8;}",
"ks-editor-color-plugin");var b=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],a;(function(){a="<div class='ks-editor-color-panel'><a class='ks-editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var c=0;3>c;c++){a+="<div class='ks-editor-color-palette'><table>";for(var d=b[c],g=d.length/8,h=0;h<g;h++){a+="<tr>";for(var i=0;8>i;i++){var e="#"+d[8*h+i];a+="<td>";a+="<a href='javascript:void(0);' class='ks-editor-color-a' style='background-color:"+e+"'></a>";a+="</td>"}a+="</tr>"}a+="</table></div>"}a+="<div><a class='ks-editor-button ks-editor-color-others'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();f.extend(c,k,{offClick:function(){this._prepare()},onClick:function(){this.colorWin&&this.colorWin.hide()},
_prepare:function(){var b=this,c=b.get("editor"),g;b.colorWin=new d({elAttrs:{tabindex:0},elCls:"ks-editor-popup",content:a,autoRender:!0,width:170,zIndex:j.baseZIndex(j.zIndexManager.POPUP_MENU)});var f=b.colorWin;g=f.get("contentEl");g.on("click",b._selectColor,b);f.get("el").on("blur",function(){f.hide()});f.on("show",b.bon,b);f.on("hide",b.boff,b);g.one(".ks-editor-color-others").on("click",function(a){a.halt();f.hide();h.useDialog(c,"color/colorPicker/dialog",b.get("cmdType"))});b._prepare=b._show;
b._show()},_show:function(){var a=this.get("el"),b=this.colorWin;b.align(a,["bl","tl"],[0,2]);b.show();b.get("el")[0].focus()},_selectColor:function(a){a.halt();a=new g(a.target);a.hasClass("ks-editor-color-a")&&this.get("editor").execCommand(this.get("cmdType"),a.style("background-color"))},destroy:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{mode:{value:j.WYSIWYG_MODE}}});return c},{requires:["editor","../button/","../overlay/","../dialogLoader/"]});
KISSY.add("editor/plugin/color/cmd",function(f,j){return{applyColor:function(f,d,h){var c=f.get("document")[0];f.execCommand("save");d?(new j.Style(h,{color:d})).apply(c):(new j.Style(h,{color:"inherit"})).remove(c);f.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(f,j,k){function d(){d.superclass.constructor.apply(this,arguments)}var h=f.all,c=f.Event;d.register=function(b){function a(){g.hide()}var g=new d(b),f=b.editor;g.editor=f;f.on("destroy",function(){g.destroy()});f.on("sourceMode",a);f.docReady(function(){var n=f.get("document")[0];c.on(n,"mousedown",a);c.delegate(n,"contextmenu",b.filter,function(a){d.hide(f);var b=h(a.target);a.halt();var e=a.pageX,c=a.pageY;e||(a=b._4e_getOffset(void 0),e=a.left,
c=a.top);setTimeout(function(){g.selectedEl=b;g.show(j.Utils.getXY(e,c,n,document));d.show(g)},30)})});return g};var g={};d.hide=function(b){(b=g[f.stamp(b)])&&b.hide()};d.show=function(b){g[f.stamp(b.editor)]=b};f.extend(d,f.Base,{_init:function(){var b=this,a=b.get("handlers");b.menu=new k({autoRender:!0,width:b.get("width"),elCls:"ks-editor-menu",prefixCls:"ks-editor-"});var c=b.menu.get("contentEl"),d;for(d in a){var g=h("<a href='#' class='ks-editor-menuitem'>"+d+"</a>");c.append(g);a.hasOwnProperty(d)&&
function(a,c){a.unselectable(void 0);a.on("click",function(e){e.halt();a.hasClass("ks-editor-menuitem-disable",void 0)||(b.hide(),f.later(c,30,!1,b))})}(g,a[d])}},destroy:function(){var b;(b=this.menu)&&b.destroy()},hide:function(){var b;(b=this.menu)&&b.hide()},_realShow:function(b){var a=this.menu;j.fire("contextmenu",{contextmenu:this});a.set("xy",[b.left,b.top]);var c=this.get("statusChecker"),d=this.editor;c&&a.get("contentEl").children("a").each(function(a){var b=c[f.trim(a.text())];b&&(b(d)?
a.removeClass("ks-editor-menuitem-disable",void 0):a.addClass("ks-editor-menuitem-disable",void 0))});a.show()},show:function(b){this._init();this.show=this._realShow;this.show(b)}});return d},{requires:["editor","overlay"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(f,j,k){function d(e){return e.nodeType==a.ELEMENT_NODE&&"li"==a.nodeName(e)}function h(e,b,c){for(var d=e.startContainer,i=e.endContainer;d&&!d.parent().equals(b);)d=d.parent();for(;i&&!i.parent().equals(b);)i=i.parent();if(d&&i){for(var h=d,d=[],f=!1;!f;)h.equals(i)&&(f=!0),d.push(h),h=h.next();if(!(1>d.length)){var p=b._4e_parents(!0,void 0);p.each(function(a,e){p[e]=a});for(i=0;i<p.length;i++)if(g[p[i].nodeName()]){b=p[i];break}for(var h="indent"==
c?1:-1,i=d[0],f=d[d.length-1],d={},t=k.listToArray(b,d),u=t[f.data("listarray_index")].indent,i=i.data("listarray_index");i<=f.data("listarray_index");i++){t[i].indent+=h;var B=t[i].parent;t[i].parent=new l(B[0].ownerDocument.createElement(B.nodeName()))}for(i=f.data("listarray_index")+1;i<t.length&&t[i].indent>u;i++)t[i].indent+=h;f=k.arrayToList(t,d,null,"p");h=[];if("outdent"==c){var C;if((C=b.parent())&&"li"==C.nodeName())for(var c=f.listNode.childNodes,A,i=c.length-1;0<=i;i--)(A=new l(c[i]))&&
"li"==A.nodeName()&&h.push(A)}f&&(a.insertBefore(f.listNode[0]||f.listNode,b[0]||b),b.remove());if(h&&h.length)for(i=0;i<h.length;i++){for(A=b=h[i];(A=A.next())&&A.nodeName()in g;)o.ie&&!b.first(function(a){return n(a)&&q(a)},1)&&b[0].appendChild(e.document.createTextNode("\u00a0")),b[0].appendChild(A[0]);a.insertAfter(b[0],C[0])}j.Utils.clearAllMarkers(d)}}}function c(a,b){var c=parseInt(a.style(p),10);isNaN(c)&&(c=0);c+=("indent"==b?1:-1)*i;if(0>c)return!1;c=Math.max(c,0);c=Math.ceil(c/i)*i;a.css(p,
c?c+e:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var g={ol:1,ul:1},b=j.Walker,a=f.DOM,l=f.Node,o=f.UA,n=b.whitespaces(!0),p="margin-left",i=40,e="px",q=b.bookmark(!1,!0);return{checkOutdentActive:function(a){var e=a.blockLimit;return a.contains(g)?!0:(a=a.block||e)&&a.style(p)},addCommand:function(e,i){e.hasCommand(i)||e.addCommand(i,{exec:function(e){e.execCommand("save");var f=e.getSelection(),j=f&&f.getRanges()[0];if(j){for(var l=j.startContainer,n=j.endContainer,m=j.getCommonAncestor();m&&
!(m[0].nodeType==a.ELEMENT_NODE&&g[m.nodeName()]);)m=m.parent();m&&l[0].nodeType==a.ELEMENT_NODE&&l.nodeName()in g&&(l=new b(j),l.evaluator=d,j.startContainer=l.next());m&&n[0].nodeType==a.ELEMENT_NODE&&n.nodeName()in g&&(l=new b(j),l.evaluator=d,j.endContainer=l.previous());n=f.createBookmarks(!0);if(m){for(l=m.first();l&&"li"!=l.nodeName();)l=l.next();var o=j.startContainer;(!(l[0]==o[0]||l.contains(o))||!c(m,i))&&h(j,m,i)}else{j=j.createIterator();j.enforceRealBlocks=!0;for(j.enlargeBr=!0;m=j.getNextParagraph();)c(m,
i)}f.selectBookmarks(n)}e.execCommand("save");e.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(f,j,k){var d,h={loading:function(){d||(d=new j({x:0,width:6==f.UA.ie?f.DOM.docWidth():"100%",y:0,zIndex:k.baseZIndex(k.zIndexManager.LOADING),prefixCls:"ks-editor-",elCls:"ks-editor-global-loading"}));d.set("height",f.DOM.docHeight());d.show();d.loading()},unloading:function(){d.hide()}};return{useDialog:function(c,d,b){c.hasDialog(d)?c.showDialog(d,b):(h.loading(),f.use("editor/plugin/"+d,function(a,f){h.unloading();c.addDialog(d,new f(c));c.showDialog(d,
b)}))}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(f,j,k,d,h){function c(a,b,c){for(a+="";a.length<b;)a=c+a;return a}function g(a){f.isNumber(a)&&(a=new Date(a));return a instanceof Date?[a.getFullYear(),"-",c(a.getMonth()+1,2,"0"),"-",c(a.getDate(),2,"0")," ",c(a.getHours(),2,"0"),":",c(a.getMinutes(),2,"0"),":",c(a.getSeconds(),2,"0")].join(""):a}function b(a){this.editor=a;this._init()}function a(a){var c=new b(a);a.on("destroy",function(){c.destroy()})}var l=f.Node,o=f.Event,n=f.JSON,p=j.Utils.addRes,
i=j.Utils.destroyRes;f.augment(b,{_getSaveKey:function(){var a=this.editor.get("pluginConfig");return a.draft&&a.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var a=k.getItem(this._getSaveKey()),b=[];a&&(b=k==window.localStorage?n.parse(decodeURIComponent(a)):a);this.drafts=b}return this.drafts},_init:function(){var a=this,b=a.editor,c=b.get("statusBarEl"),d=b.get("pluginConfig");d.draft=d.draft||{};a.draftInterval=d.draft.interval=d.draft.interval||5;a.draftLimit=
d.draft.limit=d.draft.limit||5;c=(new l("<div class='ks-editor-draft'><span class='ks-editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+d.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(c);a.timeTip=(new l("<span class='ks-editor-draft-time'/>")).appendTo(c);var g=(new l("<a href='#' onclick='return false;' class='ks-editor-button ks-editor-draft-save-btn' style='vertical-align:middle;padding:1px 9px;'><span class='ks-editor-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(c),i=new h({container:c,
menuContainer:document.body,doc:b.get("document")[0],width:"85px",popUpWidth:"225px",align:["r","t"],emptyText:"&nbsp;&nbsp;&nbsp;\u5c1a\u65e0\u7f16\u8f91\u5668\u5386\u53f2\u5b58\u5728",title:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});a.versions=i;i.on("select",function(){i.detach("select",arguments.callee);a.sync()});g.on("click",function(b){a.save(!1);b.halt()});p.call(a,g);b.get("textarea")[0].form&&function(){function c(){a.save(!0)}var d=b.get("textarea")[0].form;o.on(d,"submit",c);p.call(a,function(){o.remove(d,"submit",c)})}();var f=setInterval(function(){a.save(!0)},
6E4*a.draftInterval);p.call(a,function(){clearInterval(f)});i.on("click",a.recover,a);p.call(a,i);a.holder=c;if(d.draft.helpHtml){var n=(new l('<a tabindex="0" hidefocus="hidefocus" class="ks-editor-draft-help ks-editor-triplebutton-off" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(c);n.on("click",function(){n[0].focus();a.helpPopup&&a.helpPopup.get("visible")?a.helpPopup.hide():a._prepareHelp()});n.on("blur",function(){a.helpPopup&&a.helpPopup.hide()});
a.helpBtn=n;p.call(a,n);j.Utils.lazyRun(a,"_prepareHelp","_realHelp")}p.call(a,c)},_prepareHelp:function(){var a=this.editor.get("pluginConfig").draft,a=new l(a.helpHtml||""),b=new l("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
a.append(b);a.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new d({content:a,prefixCls:"ks-editor-",autoRender:!0,width:a.width()+"px",mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=b},_realHelp:function(){var a=this.helpPopup,b=this.helpBtn,c=a.arrow;a.show();b=b.offset();a.get("el").offset({left:b.left-a.get("el").width()+17,top:b.top-a.get("el").height()-7});c.offset({left:b.left-2,top:b.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var a=this.draftLimit,b=this.timeTip,c=this.versions,d=this._getDrafts();d.length>a&&d.splice(0,d.length-a);for(var a=[],i,h=0;h<d.length;h++)i=d[h],i=(i.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+g(i.date),a.push({name:i,value:h});c.set("items",a.reverse());b.html(i);k.setItem(this._getSaveKey(),k==window.localStorage?encodeURIComponent(n.stringify(d)):d)},save:function(a){var b=this._getDrafts(),c=this.editor.get("formatData");c&&(b[b.length-
1]&&c==b[b.length-1].content&&(b.length-=1),this.drafts=b.concat({content:c,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var b=this.editor,c=this.versions,d=this._getDrafts(),i=a.newVal;c.reset("value");confirm("\u786e\u8ba4\u6062\u590d "+g(d[i].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(b.execCommand("save"),b.set("data",d[i].content),b.execCommand("save"));a.halt()},destroy:function(){i.call(this)}});return{init:function(b){k.ready?k.ready(function(){a(b)}):a(b)}}},{requires:["editor","../localStorage/","overlay",
"../select/"]});
KISSY.add("editor/plugin/dragUpload/index",function(f,j){var k=f.Node,d=f.Event,h=j.Utils,c=f.DOM;return f.UA.ie?void 0:{init:function(g){function b(a){a=a.originalEvent.target;"img"==c.nodeName(a)&&a.src.match(/^file:\/\//)&&(m[a.src]=a)}function a(a,b){var e=new window.FileReader;e.onload=function(c){var d=a.name,c=c.target.result,g=new XMLHttpRequest;g.open("POST",i,!0);g.onreadystatechange=function(){if(4==g.readyState){if(200==g.status||304==g.status){if(""!=g.responseText){var a=window.JSON.parse(g.responseText);
b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();g.onreadystatechange=null}};d="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+o+'"; filename="'+encodeURIComponent(d)+'"\r\n');d+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";d+=c+"\r\n";p=j.Utils.normParams(p);for(var h in p)p.hasOwnProperty(h)&&(d+="------kissy-editor-yiminghe\r\n",d+='Content-Disposition: form-data; name="'+h+'"\r\n\r\n',d+=p[h]+"\r\n");d+="------kissy-editor-yiminghe--";g.setRequestHeader("Content-Type",
"multipart/form-data, boundary=----kissy-editor-yiminghe");g.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+d.length+"\r\n"+d+"\r\n");e.onload=null};e.readAsBinaryString(a)}var l=g.get("pluginConfig").dragUpload||{},o=l.fileInput||"Filedata",n=l.sizeLimit||Number.MAX_VALUE,p=l.serverParams||{},i=l.serverUrl||"",e=RegExp((l.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),q=g.get("document")[0],m={},x=!1;d.on(q,"dragenter",function(){x||
(d.on(q,"DOMNodeInserted",b),x=!0)});d.on(q,"drop",function(g){d.remove(q,"DOMNodeInserted",b);x=!1;g.halt();var g=g.originalEvent,i,j;f.isEmptyObject(m)?(j=q.elementFromPoint(g.clientX,g.clientY),i=j.lastChild):(f.each(m,function(a){"img"==c.nodeName(a)&&(i=a.nextSibling,j=a.parentNode,c.remove(a))}),m={});g=g.dataTransfer;g.dropEffect="copy";if(g=g.files)for(var l=0;l<g.length;l++){var o=g[l],p=o.size;if(o.name.match(e)&&!(p/1E3>n)){var p=new k("<img src='"+h.debugUrl("theme/tao-loading.gif")+"'/>"),
t=p[0];j.insertBefore(t,i);var u=c.nodeName(t.parentNode);("head"==u||"html"==u)&&c.insertBefore(t,q.body.firstChild);a(o,p)}}});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var e=new (window.BlobBuilder||window.WebKitBlobBuilder),c=a.length,d=new window.Uint8Array(c),g=0;g<c;g++)d[g]=a.charCodeAt(g);e.append(d.buffer);this.send(e.getBlob(b))})}}},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(f,j){function k(d){this.cfg=d;this._cache=[];this._init()}var d=f.Node;f.augment(k,{_init:function(){var h=this.cfg.editor;this.holder=new d("<span>");this.holder.appendTo(h.get("statusBarEl"),void 0);h.on("selectionChange",this._selectionChange,this);j.Utils.sourceDisable(h,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(h){var c=this.cfg.editor,g=this.holder,
h=h.path.elements,b,a;b=this._cache;for(a=0;a<b.length;a++)b[a].remove();this._cache=[];for(a=0;a<h.length;a++){b=h[a];var f=b.attr("_ke_real_element_type")||b.nodeName(),j=new d("<a href='javascript(\""+f+"\")' class='ks-editor-element-path'>"+f+"</a>");this._cache.push(j);(function(a){j.on("click",function(b){b.halt();c.focus();setTimeout(function(){c.getSelection().selectElement(a)},50)})})(b);g.prepend(j)}},destroy:function(){this.holder.remove()}});return{init:function(d){var c=new k({editor:d});
d.on("destroy",function(){c.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(f,j){var k=f.Node,d=f.DOM,h=j.Utils.debugUrl("theme/spacer.gif"),c=f.require("htmlparser");f.augment(j,{createFakeElement:function(b,a,c,d,g,j){var i=b.attr("style")||"";b.attr("width")&&(i="width:"+b.attr("width")+"px;"+i);b.attr("height")&&(i="height:"+b.attr("height")+"px;"+i);var e=f.trim(b.attr("class")),b={"class":a+" "+e,src:h,_ke_realelement:encodeURIComponent(g||b._4e_outerHtml(void 0)),_ke_real_node_type:b[0].nodeType,style:i};j&&delete j.width;
j&&delete j.height;j&&f.mix(b,j,!1);c&&(b._ke_real_element_type=c);d&&(b._ke_resizable=d);return new k("<img/>",b,this.get("document")[0])},restoreRealElement:function(b){if(b.attr("_ke_real_node_type")!=d.ELEMENT_NODE)return null;var b=decodeURIComponent(b.attr("_ke_realelement")),a=new k("<div>",null,this.get("document")[0]);a.html(b);return a.first().remove()}});var g={tags:{$:function(b){var a=b.getAttribute("_ke_realelement"),d;a&&(d=(new c.Parser(decodeURIComponent(a))).parse());if(a=d&&d.childNodes[0]){if(d=
b.getAttribute("style")){var g=/(?:^|\s)width\s*:\s*(\d+)/i.exec(d),b=g&&g[1];d=(g=/(?:^|\s)height\s*:\s*(\d+)/i.exec(d))&&g[1];b&&a.setAttribute("width",b);d&&a.setAttribute("height",d)}return a}}}};return{init:function(b){var a=(b=b.htmlDataProcessor)&&b.htmlFilter;b.createFakeParserElement||(a&&a.addRules(g),f.mix(b,{createFakeParserElement:function(a,b,d,g,i){var e;e=new c.BasicWriter;a.writeHtml(e);e=e.getHtml();var j=a.getAttribute("style")||"";a.getAttribute("width")&&(j="width:"+a.getAttribute("width")+
"px;"+j);a.getAttribute("height")&&(j="height:"+a.getAttribute("height")+"px;"+j);var m=f.trim(a.getAttribute("class")),a={"class":b+" "+m,src:h,_ke_realelement:encodeURIComponent(e),_ke_real_node_type:a.nodeType+"",style:j,align:a.getAttribute("align")||""};i&&delete i.width;i&&delete i.height;i&&f.mix(a,i,!1);d&&(a._ke_real_element_type=d);g&&(a._ke_resizable="_ke_resizable");return new c.Tag("img",a)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(f,j,k){function d(a){this._init(a)}function h(a){var b=f.isString(a)?a.match(/(\d)+/g):a;f.isArray(b)&&(a=parseFloat(b[0]+"."+c(b[1],3)+c(b[2],5)));return a||0}function c(a,b){for(var c=(a+"").length;c++<b;)a="0"+a;return a}var g={};f.augment(d,f.EventTarget,{_init:function(a){var b=f.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var c=a.flashVars,e=a.params;f.mix(a.attrs,{id:b,width:"100%",height:"100%"},
!1);f.mix(e,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);f.mix(c,{shareData:!1,useCompression:!1},!1);e={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(e={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});f.mix(c,e);g[b]=this;this.id=b;this.swf=k.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var b=this,c=0;c<a.length;c++)(function(a){b[a]=function(){return b._callSWF(a,f.makeArray(arguments))}})(a[c])},
_callSWF:function(a,b){b=b||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,b)}catch(c){var e="";0!==b.length&&(e="'"+b.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+e+");"))(this)}},_eventHandler:function(a){var b=a.type;"log"!==b&&b&&this.fire(b,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete g[this.id]}});d.EventHandler=function(a,b){var c=g[a];c&&setTimeout(function(){c._eventHandler.call(c,b)},100)};j.FlashBridge=
d;var b=f.UA,a,l,o=!0;b.fpv=function(b){if(b||o){o=!1;var c;if(navigator.plugins&&navigator.mimeTypes.length)c=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{c=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){}a=!c?void 0:c.match(/(\d)+/g);l=h(a)}return a};b.fpvGEQ=function(a,c){o&&b.fpv(c);return!!l&&l>=h(a)};return d},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(f,j,k,d,h,c){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var b=f.Node;g.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},contextMenuHandlers:{}};f.extend(g,f.Base,{_init:function(){var a=this,b=a.get("cls"),c=a.get("editor"),g=a.get("contextMenuHandlers");k.register({editor:c,filter:"."+b,width:"120px",handlers:g});d.register({filter:function(a){return a.hasClass(b,void 0)&&a},editor:c,init:function(){var b=this,d=b.get("contentEl");
d.html(f.substitute(' <a class="ks-editor-bubbleview-url" target="_blank" href="#">{label}</a>   |    <span class="ks-editor-bubbleview-link ks-editor-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubbleview-link ks-editor-bubbleview-remove">\u5220\u9664</span>',{label:a.get("label")}));var e=d.one(".ks-editor-bubbleview-url"),g=d.one(".ks-editor-bubbleview-change"),h=d.one(".ks-editor-bubbleview-remove");j.Utils.preventFocus(d);g.on("click",function(c){a.show(b.selectedEl);c.halt()});h.on("click",
function(a){if(f.UA.webkit){var e=c.getSelection().getRanges();if(e=e&&e[0])e.collapse(!0),e.select()}b.selectedEl.remove();b.hide();c.notifySelectionChange();a.halt()});b.on("show",function(){var c=b.selectedEl;c&&a._updateTip(e,c)})}});c.docReady(function(){c.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(a){return c.getUrl(a)},_updateTip:function(a,b){var c=this.get("editor").restoreRealElement(b);c&&(c=this._getFlashUrl(c),a.attr("href",c))},_dbClick:function(a){var c=new b(a.target);
"img"===c.nodeName()&&c.hasClass(this.get("cls"),void 0)&&(this.show(c),a.halt())},show:function(a){var b=this.get("editor");h.useDialog(b,this.get("type")+"/dialog",a)}});return g},{requires:["editor","../contextmenu/","../bubbleview/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(f){var j=f.DOM,k=f.Node,d=f.UA,h={insertFlash:function(c,d,b,a,f){d=h.createSWF(d,{attrs:b},c.get("document")[0]);b=c.createFakeElement(d.el,a||"ke_flash",f||"flash",!0,d.html,b);c.insertElement(b);return b},isFlashEmbed:function(c){return"application/x-shockwave-flash"==c.getAttribute("type")||/\.swf(?:$|\?)/i.test(c.getAttribute("src")||"")},getUrl:function(c){var d="";if("object"==c.nodeName())for(var c=c[0].childNodes,b=0;b<c.length;b++)1==
c[b].nodeType&&("movie"==(j.attr(c[b],"name")||"").toLowerCase()?d=j.attr(c[b],"value"):"embed"==j.nodeName(c[b])?d=j.attr(c[b],"src"):"object"==j.nodeName(c[b])&&(d=j.attr(c[b],"data")));else"embed"==c.nodeName()&&(d=c.attr("src"));return d},createSWF:function(c,d,b){var a=d.attrs||{},h=d.flashVars,j="",n="",d=d.params||{},p="",b=b||document;f.mix(a,{wmode:"transparent"});for(var i in a)a.hasOwnProperty(i)&&(j+=i+"='"+a[i]+"' ");f.mix(d,{quality:"high",movie:c,wmode:"transparent"});for(var e in d)d.hasOwnProperty(e)&&
(n+="<param name='"+e+"' value='"+d[e]+"'/>");if(h){for(var q in h)h.hasOwnProperty(q)&&(p+="&"+q+"="+encodeURIComponent(h[q]));p=p.substring(1)}c="<object "+j+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+n+(p?'<param name="flashVars" value="'+p+'"/>':"")+"<embed "+j+" "+(p?'FlashVars="'+p+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+c+'"  type="application/x-shockwave-flash"/></object>';return{el:new k(c,null,b),html:c}},createSWFRuntime2:function(c,
g,b){var b=b||document,a=(new k("<div style='width:0;height:0;overflow:hidden;'>",null,b)).appendTo(b.body),a=h.createSWF.apply(this,arguments).el.appendTo(a);d.ie||(a=a.one("object"));return a[0]},createSWFRuntime:function(c,g,b){var a=g.attrs||{},h=g.flashVars||{},o=g.params||{},n="",p="",i="",b=b||document;a.id=a.id||f.guid("ks-editor-runtimeflash-");for(var e in a)a.hasOwnProperty(e)&&(n+=e+"='"+a[e]+"' ");for(var q in o)o.hasOwnProperty(q)&&(p+="<param name='"+q+"' value='"+o[q]+"'/>");for(var m in h)h.hasOwnProperty(m)&&
(i+="&"+m+"="+encodeURIComponent(h[m]));var i=i.substring(1),c=d.ie?"<object "+n+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+p+'<param name="movie" value="'+c+'" />'+(i?'<param name="flashVars" value="'+i+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+c+"' "+n+">"+p+(i?'<param name="flashVars" value="'+i+'"/>':"")+"</object>",x=g.holder;x||(x=(new k("<div style='"+(g.style?g.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,b)).appendTo(b.body),
setTimeout(function(){x.offset({left:j.scrollLeft(),top:j.scrollTop()})},100));x.html(c);return b.getElementById(a.id)}};return h});
KISSY.add("editor/plugin/flash/index",function(f,j,k,d){return{init:function(h){var c=h.htmlDataProcessor;c.dataFilter.addRules({tags:{object:function(a){var b;if(!a.getAttribute("classid")){var g=a.childNodes;for(b=0;b<g.length;b++)if("embed"==g[b].nodeName)if(d.isFlashEmbed(g[b][b]))break;else return c.createFakeParserElement(a,"ke_flash","flash",!0);return null}return c.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return d.isFlashEmbed(a)?c.createFakeParserElement(a,"ke_flash",
"flash",!0):null}}},5);var g=h.get("pluginConfig").flash||{},b=new k({editor:h,cls:"ke_flash",type:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.selectedEl;a&&b.show(a)}}});!1!==g.btn&&h.addButton({contentCls:"ks-editor-toolbar-flash",title:"\u63d2\u5165Flash",mode:j.WYSIWYG_MODE},{offClick:function(){b.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/fontFamily/cmd",function(f,j,k){var d={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(h){k.addSelectCmd(h,"fontFamily",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(f,j,k,d){return{init:function(h){d.init(h);var c=h.get("pluginConfig").fontFamily,c=c||{};f.mix(c,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},{name:"Arial",value:"Arial"},{name:"Verdana",
value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},!1);f.each(c.items,function(c){var b=c.attrs||{},a=c.value;b.style=b.style||"";b.style+=";font-family:"+a;c.attrs=b});h.addSelect({cmdType:"fontFamily",title:"\u5b57\u4f53",width:"110px",mode:j.WYSIWYG_MODE,defaultValue:c.defaultValue,popUpWidth:c.width,items:c.items},void 0,k.Select)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(f,j,k){var d={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(h){k.addSelectCmd(h,"fontSize",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(f,j,k,d){return{init:function(h){d.init(h);var c=h.get("pluginConfig").fontSize,c=c||{};f.mix(c,{items:function(c){var b=[];f.each(c,function(a){b.push({name:a,value:a})});return b}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(",")),width:"55px"},!1);h.addSelect({cmdType:"fontSize",title:"\u5927\u5c0f",width:"30px",mode:j.WYSIWYG_MODE,showValue:!0,defaultValue:c.defaultValue,popUpWidth:c.width,items:c.items},void 0,k.Select)}}},{requires:["editor",
"../font/ui","./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(f,j){var k=j.Utils.getQueryCmd;return{addButtonCmd:function(d,h,c){var g=k(h);d.hasCommand(h)||(d.addCommand(h,{exec:function(b,a){var d=b.get("document")[0];b.execCommand("save");a||void 0===a?c.apply(d):c.remove(d);b.execCommand("save");b.notifySelectionChange()}}),d.addCommand(g,{exec:function(b,a){return c.checkActive(a)}}))},addSelectCmd:function(d,h,c){var g=k(h);d.hasCommand(h)||(d.addCommand(h,{exec:function(b,a,d){var a=new j.Style(c,{value:a}),
g=b.get("document")[0];b.execCommand("save");void 0===d||d?a.apply(g):a.remove(g);b.execCommand("save")}}),d.addCommand(g,{exec:function(b,a,d){return(new j.Style(c,{value:a})).checkElementRemovable(d,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(f,j,k,d){function h(){h.superclass.constructor.apply(this,arguments)}function c(){c.superclass.constructor.apply(this,arguments)}var g=j.Utils.getQueryCmd;f.extend(h,d,{click:function(b){var a=b.newVal,c=this.get("cmdType"),b=b.prevVal,d=this.get("editor");d.focus();a==b?d.execCommand(c,a,!1):d.execCommand(c,a)},selectionChange:function(b){for(var a=b.path,b=g(this.get("cmdType")),c=this.get("items"),d=this.get("editor"),a=a.elements,h=0,f;h<a.length;h++){f=
a[h];for(var i=0;i<c.length;i++){var e=c[i].value;if(d.execCommand(b,e,f)){this.set("value",e);return}}}(b=this.get("defaultValue"))?this.set("value",b):this.reset("value")}});f.extend(c,k,{offClick:function(){var b=this.get("cmdType"),a=this.get("editor");a.execCommand(b);a.focus()},onClick:function(){var b=this.get("cmdType"),a=this.get("editor");a.execCommand(b,!1);a.focus()},selectionChange:function(b){var a=this.get("editor"),c=g(this.get("cmdType"));a.execCommand(c,b.path)?this.set("state",
k.ON):this.set("state",k.OFF)}},{ATTRS:{mode:{value:j.WYSIWYG_MODE}}});return{Button:c,Select:h}},{requires:["editor","../button/","../select/"]});
KISSY.add("editor/plugin/foreColor/cmd",function(f,j){var k={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(d){return!("a"==d.nodeName()||d.all("a").length)}};return{init:function(d){d.hasCommand("foreColor")||d.addCommand("foreColor",{exec:function(d,c){d.execCommand("save");j.applyColor(d,c,k);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(f,j,k,d){return{init:function(h){d.init(h);h.addButton({cmdType:"foreColor",title:"\u6587\u672c\u989c\u8272",contentCls:"ks-editor-toolbar-fore-color"},void 0,k)}}},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(f,j){return{init:function(f){if(!f.hasCommand("heading")){f.addCommand("heading",{exec:function(d,c){d.execCommand("save");(new j.Style({element:c})).apply(d.get("document")[0]);d.execCommand("save")}});var d=j.Utils.getQueryCmd("heading");f.addCommand(d,{exec:function(d,c,g){return(new j.Style({element:g})).checkActive(c)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(f,j,k){return{init:function(d){k.init(d);var h=[],c={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},g={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},b;for(b in c)c.hasOwnProperty(b)&&h.push({name:b,value:c[b],attrs:{style:"font-size:"+g[c[b]]}});d.addSelect({items:h,title:"\u6807\u9898",width:"100px",mode:j.WYSIWYG_MODE},{click:function(a){var b=a.newVal;b!=a.prevVal?d.execCommand("heading",b):(d.execCommand("heading",
"p"),this.set("value","p"))},selectionChange:function(a){var a=a.path,b=j.Utils.getQueryCmd("heading"),c;for(c in g)if(g.hasOwnProperty(c)&&d.execCommand(b,a,c)){this.set("value",c);break}}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(f,j,k,d,h,c){var g=f.UA,b=f.Node,a=f.all,l=f.Event,o=function(b){b=a(b);return"img"===b.nodeName(b)&&!/(^|\s+)ke_/.test(b[0].className)&&b};return{init:function(f){function k(a){c.useDialog(f,"image/dialog",a)}f.addButton({contentCls:"ks-editor-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:j.WYSIWYG_MODE},{offClick:function(){k(null)}});h.register({editor:f,filter:o,width:"120px",handlers:{"\u56fe\u7247\u5c5e\u6027":function(){var b=o(this.selectedEl);b&&k(a(b))},"\u63d2\u5165\u65b0\u884c":function(){var a=
f.get("document")[0],c=new b(a.createElement("p"));g.ie||c._4e_appendBogus(void 0);a=new j.Range(a);a.setStartAfter(this.selectedEl);a.select();f.insertElement(c);a.moveToElementEditablePosition(c,1);a.select()}}});f.docReady(function(){l.on(f.get("document")[0],"dblclick",function(b){b.halt();b=a(b.target);o(b)&&k(b)})});d.register({editor:f,filter:o,init:function(){var a=this,b=a.get("contentEl");b.html('<a class="ks-editor-bubbleview-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ks-editor-bubbleview-link ks-editor-bubbleview-change" href="#">\u7f16\u8f91</a>  |  <a class="ks-editor-bubbleview-link ks-editor-bubbleview-remove" href="#">\u5220\u9664</a>');
var c=b.one(".ks-editor-bubbleview-url"),d=b.one(".ks-editor-bubbleview-change"),h=b.one(".ks-editor-bubbleview-remove");j.Utils.preventFocus(b);d.on("click",function(b){k(a.selectedEl);b.halt()});h.on("click",function(b){if(g.webkit){var c=f.getSelection().getRanges();c&&c[0]&&(c[0].collapse(),c[0].select())}a.selectedEl.remove();a.hide();f.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr("_ke_saved_src")||b.attr("src"),c.attr("href",b))})}})}}},{requires:["editor",
"../button/","../bubbleview/","../contextmenu/","../dialogLoader/"]});KISSY.add("editor/plugin/indent/cmd",function(f,j,k){var d=k.addCommand;return{init:function(h){d(h,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(f,j,k){return{init:function(d){k.init(d);d.addButton({title:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:j.WYSIWYG_MODE,contentCls:"ks-editor-toolbar-indent"},{offClick:function(){d.execCommand("indent")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/insertOrderedList/cmd",function(f,j,k){var d=k.queryActive,h=new k.ListCommand("ol");return{init:function(c){c.hasCommand("insertOrderedList")||c.addCommand("insertOrderedList",{exec:function(b){h.exec(b)}});var g=j.Utils.getQueryCmd("insertOrderedList");c.hasCommand(g)||c.addCommand(g,{exec:function(b,a){return d("ol",a)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/insertOrderedList/index",function(f,j,k,d){return{init:function(h){d.init(h);h.addButton({cmdType:"insertOrderedList",mode:j.WYSIWYG_MODE,contentCls:"ks-editor-toolbar-ol"},void 0,k)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/insertUnorderedList/cmd",function(f,j,k){var d=k.queryActive,h=new k.ListCommand("ul");return{init:function(c){c.hasCommand("insertUnorderedList")||c.addCommand("insertUnorderedList",{exec:function(b){h.exec(b)}});var g=j.Utils.getQueryCmd("insertUnorderedList");c.hasCommand(g)||c.addCommand(g,{exec:function(b,a){return d("ul",a)}})}}},{requires:["editor","../listUtils/cmd.js"]});
KISSY.add("editor/plugin/insertUnorderedList/index",function(f,j,k,d){return{init:function(h){d.init(h);h.addButton({cmdType:"insertUnorderedList",mode:j.WYSIWYG_MODE,contentCls:"ks-editor-toolbar-ul"},void 0,k)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(f,j,k){var d=new j.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(h){k.addButtonCmd(h,"italic",d)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(f,j,k,d){return{init:function(h){d.init(h);h.addButton({cmdType:"italic",contentCls:"ks-editor-toolbar-italic",title:"\u659c\u4f53 "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(f,j){return{init:function(f){j.addCommand(f,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(f,j,k){function d(){this.get("editor").execCommand("justifyCenter")}return{init:function(h){k.init(h);h.addButton({contentCls:"ks-editor-toolbar-justifyCenter",title:"\u5c45\u4e2d\u5bf9\u9f50",mode:j.WYSIWYG_MODE},{onClick:d,offClick:d,selectionChange:function(c){var d=j.Utils.getQueryCmd("justifyCenter");h.execCommand(d,c.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyLeft/cmd",function(f,j){return{init:function(f){j.addCommand(f,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(f,j,k){function d(){this.get("editor").execCommand("justifyLeft")}return{init:function(h){k.init(h);h.addButton({contentCls:"ks-editor-toolbar-justifyLeft",title:"\u5de6\u5bf9\u9f50",mode:j.WYSIWYG_MODE},{onClick:d,offClick:d,selectionChange:function(c){var d=j.Utils.getQueryCmd("justifyLeft");h.execCommand(d,c.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyRight/cmd",function(f,j){return{init:function(f){j.addCommand(f,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(f,j,k){function d(){this.get("editor").execCommand("justifyRight")}return{init:function(h){k.init(h);h.addButton({contentCls:"ks-editor-toolbar-justifyRight",title:"\u53f3\u5bf9\u9f50",mode:j.WYSIWYG_MODE},{onClick:d,offClick:d,selectionChange:function(c){var d=j.Utils.getQueryCmd("justifyRight");h.execCommand(d,c.path)?this.bon():this.boff()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(f,j){var k=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(d,h,c){d.hasCommand(h)||(d.addCommand(h,{exec:function(d){d.execCommand("save");for(var b=d.getSelection(),a=b.createBookmarks(),h=b.getRanges(),f,j,p=h.length-1;0<=p;p--){f=h[p].createIterator();for(f.enlargeBr=!0;j=f.getNextParagraph();)j.removeAttr("align"),(j.css("text-align").replace(k,"")||"left")==c?j.css("text-align",""):j.css("text-align",c)}b.selectBookmarks(a);d.execCommand("save");
d.notifySelectionChange()}}),d.addCommand(j.Utils.getQueryCmd(h),{exec:function(d,b){var a=b.block||b.blockLimit;return!a||"body"===a.nodeName()?!1:(a.css("text-align").replace(k,"")||"left")==c}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(f,j,k,d,h){function c(b){b=g(b);return b.closest("a",void 0)}var g=f.all;return{init:function(b){b.addButton({contentCls:"ks-editor-toolbar-link",title:"\u63d2\u5165\u94fe\u63a5",mode:j.WYSIWYG_MODE},{offClick:function(){h.useDialog(b,"link/dialog",void 0)}});k.register({editor:b,filter:c,init:function(){var a=this,c=a.get("contentEl");c.html('<a href=""  target="_blank" class="ks-editor-bubbleview-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ks-editor-bubbleview-link ks-editor-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubbleview-link ks-editor-bubbleview-remove">\u53bb\u9664</span>');
var g=c.one(".ks-editor-bubbleview-url"),f=c.one(".ks-editor-bubbleview-change"),k=c.one(".ks-editor-bubbleview-remove");j.Utils.preventFocus(c);f.on("click",function(c){h.useDialog(b,"link/dialog",a.selectedEl);c.halt()});k.on("click",function(c){d.removeLink(b,a.selectedEl);c.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr(d._ke_saved_href)||b.attr("href"),g.html(b),g.attr("href",b))})}})}}},{requires:["editor","../bubbleview/","./utils","../dialogLoader/"]});
KISSY.add("editor/plugin/link/utils",function(f,j){var k=f.Node,d=j.Style,h={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(c,g){c.execCommand("save");var b=c.getSelection(),a=b.getRanges()[0];if(a&&a.collapsed)a=b.createBookmarks(),g._4e_remove(!0),b.selectBookmarks(a);else if(a){for(var b=g[0],a=b.attributes,f={},j=0;j<a.length;j++){var k=a[j];k.specified&&(f[k.name]=k.value)}b.style.cssText&&(f.style=b.style.cssText);
(new d(h,f)).remove(c.get("document")[0])}c.execCommand("save");c.notifySelectionChange()},applyLink:function(c,g,b){g._ke_saved_href=g.href;b?(c.execCommand("save"),b.attr(g)):(b=(b=c.getSelection())&&b.getRanges()[0],!b||b.collapsed?(g=new k("<a>"+g.href+"</a>",g,c.get("document")[0]),c.insertElement(g)):(c.execCommand("save"),(new d(h,g)).apply(c.get("document")[0])));c.execCommand("save");c.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(f,j,k){function d(){d.superclass.constructor.apply(this,arguments)}function h(){var c=this.get("editor"),d=this.get("cmdType");c.execCommand(d)}f.extend(d,k,{offClick:h,onClick:h,selectionChange:function(c){var d=this.get("editor"),b=j.Utils.getQueryCmd(this.get("cmdType"));d.execCommand(b,c.path)?this.bon():this.boff()}});return d},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(f,j,k,d){function h(a){this.type=a}function c(a,b){var c,d,h=b.blockLimit,i=b.elements;if(!h)return!1;if(i)for(var f=0;f<i.length&&(c=i[f])&&c[0]!==h[0];f++)if(g[d=c.nodeName()]&&d==a)return!0;return!1}var g={ol:"insertOrderedList",ul:"insertUnorderedList"},b=j.RANGE,a=j.ElementPath,l=j.Walker,o=f.UA,n=f.Node,p=f.DOM,i=/^h[1-6]$/;h.prototype={changeListType:function(a,b,c,g){for(var h=k.listToArray(b.root,c,d,d,d),i=[],a=0;a<b.contents.length;a++){var f=
b.contents[a];if((f=f.closest("li",d))&&f[0]&&!f.data("list_item_processed"))i.push(f),f._4e_setMarker(c,"list_item_processed",!0,d)}f=new n(b.root[0].ownerDocument.createElement(this.type));for(a=0;a<i.length;a++){var j=i[a].data("listarray_index");h[j].parent=f}for(var c=k.arrayToList(h,c,null,"p"),l,h=c.listNode.childNodes.length,a=0;a<h&&(l=new n(c.listNode.childNodes[a]));a++)l.nodeName()==this.type&&g.push(l);c.listNode.insertBefore(b.root);b.root.remove()},createList:function(a,b,c){var g=
b.contents,a=b.root[0].ownerDocument,h=[];if(1==g.length&&g[0][0]===b.root[0]){var f=new n(a.createElement("div"));g[0][0].nodeType!=p.TEXT_NODE&&g[0]._4e_moveChildren(f,d,d);g[0][0].appendChild(f[0]);g[0]=f}b=b.contents[0].parent();for(f=0;f<g.length;f++)b=b._4e_commonAncestor(g[f].parent(),d);for(f=0;f<g.length;f++)for(var j=g[f],l;l=j.parent();){if(l[0]===b[0]){h.push(j);break}j=l}if(!(1>h.length)){g=new n(h[h.length-1][0].nextSibling);f=new n(a.createElement(this.type));for(c.push(f);h.length;)c=
h.shift(),j=new n(a.createElement("li")),i.test(c.nodeName())?j[0].appendChild(c[0]):(c._4e_copyAttributes(j,d,d),c._4e_moveChildren(j,d,d),c.remove()),f[0].appendChild(j[0]),o.ie||j._4e_appendBogus(d);g[0]?f.insertBefore(g,d):b.append(f)}},removeList:function(a,b,c){function g(c){if((z=new n(o[c?"firstChild":"lastChild"]))&&!(z[0].nodeType==p.ELEMENT_NODE&&z._4e_isBlockBoundary(d,d))&&(t=b.root[c?"prev":"next"](l.whitespaces(!0),1))&&!(z[0].nodeType==p.ELEMENT_NODE&&t._4e_isBlockBoundary({br:1},
d)))z[c?"before":"after"](a.get("document")[0].createElement("br"))}for(var f=k.listToArray(b.root,c,d,d,d),h=[],i=0;i<b.contents.length;i++){var j=b.contents[i];if((j=j.closest("li",d))&&!j.data("list_item_processed"))h.push(j),j._4e_setMarker(c,"list_item_processed",!0,d)}j=null;for(i=0;i<h.length;i++)j=h[i].data("listarray_index"),f[j].indent=-1;for(i=j+1;i<f.length;i++)if(f[i].indent>Math.max(f[i-1].indent,0)){h=f[i-1].indent+1-f[i].indent;for(j=f[i].indent;f[i]&&f[i].indent>=j;)f[i].indent+=
h,i++;i--}var o=k.arrayToList(f,c,null,"p").listNode,z,t;g(!0);g(d);b.root.before(o);b.root.remove()},exec:function(e){var f=e.getSelection(),i=f&&f.getRanges();if(i&&!(1>i.length)){for(var h=f.getStartElement(),h=new j.ElementPath(h),k=c(this.type,h),h=f.createBookmarks(!0),o=[],n={};0<i.length;){var w=i.shift(),y=w.getBoundaryNodes(),z=y.startNode,t=y.endNode;z[0].nodeType==p.ELEMENT_NODE&&"td"==z.nodeName()&&w.setStartAt(y.startNode,b.POSITION_AFTER_START);t[0].nodeType==p.ELEMENT_NODE&&"td"==
t.nodeName()&&w.setEndAt(y.endNode,b.POSITION_BEFORE_END);w=w.createIterator();for(w.forceBrBreak=!1;y=w.getNextParagraph();)if(!y.data("list_block")){y._4e_setMarker(n,"list_block",1,d);for(var t=new a(y),u=t.elements,B=null,C=!1,B=t.blockLimit,A,z=u.length-1;0<=z&&(A=u[z]);z--)if(g[A.nodeName()]&&B.contains(A)){B.removeData("list_group_object");(z=A.data("list_group_object"))?z.contents.push(y):(z={root:A,contents:[y]},o.push(z),A._4e_setMarker(n,"list_group_object",z,d));C=!0;break}C||(t=B||t.block,
t.data("list_group_object")?t.data("list_group_object").contents.push(y):(z={root:t,contents:[y]},t._4e_setMarker(n,"list_group_object",z,d),o.push(z)))}}for(i=[];0<o.length;)z=o.shift(),k?g[z.root.nodeName()]&&this.removeList(e,z,n):g[z.root.nodeName()]?this.changeListType(e,z,n,i):(j.Utils.clearAllMarkers(n),this.createList(e,z,i));for(var F=this,z=0;z<i.length;z++)B=i[z],e=function(a,b){var c=b[a?"prev":"next"](l.whitespaces(!0),1);c&&c[0]&&c.nodeName()==F.type&&(c.remove(),c._4e_moveChildren(b,
a?!0:!1,d))},e(d,B),e(!0,B);j.Utils.clearAllMarkers(n);f.selectBookmarks(h)}}};new h("ul");new h("ol");return{ListCommand:h,queryActive:c}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(f){var j={ol:1,ul:1},k=f.Node,d=f.DOM,h=f.UA,c={listToArray:function(g,b,a,f,h){if(!j[g.nodeName()])return[];f||(f=0);a||(a=[]);for(var n=0,p=g[0].childNodes.length;n<p;n++){var i=new k(g[0].childNodes[n]);if("li"==i.nodeName()){var e={parent:g,indent:f,element:i,contents:[]};h?e.grandparent=h:(e.grandparent=g.parent(),e.grandparent&&"li"==e.grandparent.nodeName()&&(e.grandparent=e.grandparent.parent()));b&&i._4e_setMarker(b,"listarray_index",a.length,
void 0);a.push(e);for(var q=0,m=i[0].childNodes.length,x;q<m;q++)x=new k(i[0].childNodes[q]),x[0].nodeType==d.ELEMENT_NODE&&j[x.nodeName()]?c.listToArray(x,b,a,f+1,e.grandparent):e.contents.push(x)}}return a},arrayToList:function(g,b,a,f){a||(a=0);if(!g||g.length<a+1)return null;for(var o=g[a].parent[0].ownerDocument,n=o.createDocumentFragment(),p=null,i=a,e=Math.max(g[a].indent,0),q=null;;){var m=g[i];if(m.indent==e){if(!p||g[i].parent.nodeName()!=p.nodeName())p=g[i].parent.clone(!1),n.appendChild(p[0]);
for(var q=p[0].appendChild(m.element.clone(!1)[0]),x=0;x<m.contents.length;x++)q.appendChild(m.contents[x].clone(!0)[0]);i++}else if(m.indent==Math.max(e,0)+1)i=c.arrayToList(g,null,i,f),q.appendChild(i.listNode),i=i.nextIndex;else if(-1==m.indent&&!a&&m.grandparent){j[m.grandparent.nodeName()]?q=m.element.clone(!1)[0]:"td"!=m.grandparent.nodeName()?(q=o.createElement(f),m.element._4e_copyAttributes(new k(q))):q=o.createDocumentFragment();for(x=0;x<m.contents.length;x++)p=m.contents[x].clone(!0),
q.nodeType==d.DOCUMENT_FRAGMENT_NODE&&m.element._4e_copyAttributes(new k(p)),q.appendChild(p[0]);q.nodeType==d.DOCUMENT_FRAGMENT_NODE&&i!=g.length-1&&(q.lastChild&&q.lastChild.nodeType==d.ELEMENT_NODE&&"_moz"==q.lastChild.getAttribute("type")&&d._4e_remove(q.lastChild),d._4e_appendBogus(q));q.nodeType==d.ELEMENT_NODE&&d.nodeName(q)==f&&q.firstChild&&(d._4e_trim(q),p=q.firstChild,p.nodeType==d.ELEMENT_NODE&&d._4e_isBlockBoundary(p)&&(p=o.createDocumentFragment(),d._4e_moveChildren(q,p),q=p));p=d.nodeName(q);
!h.ie&&("div"==p||"p"==p)&&d._4e_appendBogus(q);n.appendChild(q);p=null;i++}else return null;if(g.length<=i||Math.max(g[i].indent,0)<e)break}if(b)for(g=new k(n.firstChild);g&&g[0];)g[0].nodeType==d.ELEMENT_NODE&&g._4e_clearMarkers(b,!0),g=g._4e_nextSourceNode();return{listNode:n,nextIndex:i}}};return c},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(f,j,k,d){if(!f.UA.ie&&window.localStorage)return window.localStorage;var h=j.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),c=new d({movie:h,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});c.swf.height=138;var g=new k({width:"0px",prefixCls:"ks-editor-",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",
zIndex:j.baseZIndex(j.zIndexManager.STORE_FLASH_SHOW)});g.render();g.get("contentEl").append(c.swf);g.center();g.show();c.on("pending",function(){g.set("width",215);g.center();g.show();setTimeout(function(){c.retrySave()},1E3)});c.on("save",function(){g.set("width",0)});var b=c.setItem;f.mix(c,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,c){this.lastSave={k:a,v:c};b.call(this,a,c)}});c.on("contentReady",
function(){c._ready=1});return c},{attach:!1,requires:["editor","overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(f,j){function k(a){this.editor=a}var d=f.UA,h=d.ie,c=document,g=f.Node,b=f.Event,a=f.DOM,l;f.augment(k,{restoreWindow:function(){var a=this,c=a.editor;!1!==c.fire("beforeRestoreWindow")&&a._resize&&(b.remove(window,"resize",a._resize),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();c.notifySelectionChange();c.fire("restoreWindow")},30))},_restoreState:function(){var b=this.editor,d=this._savedParents;
if(d){for(var g=0;g<d.length;g++){var f=d[g];f.el.css("position",f.position)}this._savedParents=null}b.get("iframeWrapEl").css({height:this.iframeHeight});b.get("textarea").css({height:this.iframeHeight});a.css(c.body,{width:"",height:"",overflow:""});c.documentElement.style.overflow="";b=b.get("el")[0].style;b.position="static";b.width=this.editorElWidth;l.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>h&&this.editor.get("toolBarEl").removeClass("ks-editor-toolbar-padding",
void 0)},_saveSate:function(){var b=this.editor,c=[],d=b.get("el");this.iframeHeight=b.get("iframeWrapEl").style("height");this.editorElWidth=d.style("width");this.scrollLeft=a.scrollLeft();this.scrollTop=a.scrollTop();window.scrollTo(0,0);for(b=d.parent();b;)d=b.css("position"),"static"!=d&&(c.push({el:b,position:d}),b.css("position","static")),b=b.parent();this._savedParents=c;8>h&&this.editor.get("toolBarEl").addClass("ks-editor-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;
this.savedRanges=null;d.gecko&&a.__iframeFocus&&(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;d.gecko&&a.activateGecko();c&&b&&b.selectRanges(c);a.__iframeFocus&&b&&(a=b.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(b){var d=this.editor,g=d.get("el"),f=a.viewportHeight(),e=a.viewportWidth(),k=d.get("statusBarEl")?d.get("statusBarEl")[0].offsetHeight:0,m=d.get("toolBarEl")[0].offsetHeight;
h?c.body.style.overflow="hidden":a.css(c.body,{width:0,height:0,overflow:"hidden"});c.documentElement.style.overflow="hidden";g.css({position:"absolute",zIndex:j.baseZIndex(j.zIndexManager.MAXIMIZE),width:e+"px"});l.css({zIndex:j.baseZIndex(j.zIndexManager.MAXIMIZE-5),height:f+"px",width:e+"px"});g.offset({left:0,top:0});l.css({left:0,top:0});d.get("iframeWrapEl").css({height:f-k-m+"px"});d.get("textarea").css({height:f-k-m+"px"});!0!==b&&arguments.callee.call(this,!0)},_real:function(){var a=this,
c=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=f.buffer(function(){a._maximize();c.fire("maximizeWindow")},100)),b.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();c.notifySelectionChange();c.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(l||(l=(new g("<iframe  class='ks-editor-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(c.body,
void 0)),this._real())},destroy:function(){this._resize&&(b.remove(window,"resize",this._resize),this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var b=new k(a);a.addCommand("maximizeWindow",{exec:function(){b.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){b.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(f,j,k){return{init:function(d){k.init(d);d.addButton({title:"\u5168\u5c4f",contentCls:"ks-editor-toolbar-maximize"},{onClick:function(){d.execCommand("restoreWindow");this.boff();this.set("title","\u5168\u5c4f");this.set("contentCls","ks-editor-toolbar-maximize")},offClick:function(){d.execCommand("maximizeWindow");this.bon();this.set("title","\u53d6\u6d88\u5168\u5c4f");this.set("contentCls","ks-editor-toolbar-restore")}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/multipleUpload/index",function(f,j,k){return{init:function(d){d.addButton({contentCls:"ks-editor-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",mode:j.WYSIWYG_MODE},{offClick:function(){k.useDialog(d,"multipleUpload/dialog")}})}}},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/outdent/cmd",function(f,j,k){var d=k.addCommand,h=k.checkOutdentActive;return{init:function(c){d(c,"outdent");var g=j.Utils.getQueryCmd("outdent");c.hasCommand(g)||c.addCommand(g,{exec:function(b,a){return h(a)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(f,j,k){return{init:function(d){k.init(d);var f=j.Utils.getQueryCmd("outdent");d.addButton({title:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:j.WYSIWYG_MODE,contentCls:"ks-editor-toolbar-outdent"},{offClick:function(){d.execCommand("outdent")},selectionChange:function(c){d.execCommand(f,c.path)?this.enable():this.disable()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/focus",function(f,j){function k(){}var d=f.UA,h=j.focusManager;k.ATTRS={focus4e:{value:!0}};k.prototype={_uiSetFocus4e:function(c){c?(this.on("show",this._show4FocusExt,this),this.on("hide",this._hide4FocusExt,this)):(this.detach("show",this._show4FocusExt,this),this.detach("hide",this._hide4FocusExt,this))},_show4FocusExt:function(){var c=this._focusEditor=h.currentInstance();if(d.ie&&c){window.focus();document.body.focus();var g=c.get("document")[0].selection.createRange();
g&&g.item&&g.item(0).ownerDocument==c.get("document")[0]&&(c=document.body.createTextRange(),c.moveToElementText(this.get("el").first()[0]),c.collapse(!0),c.select())}},_hide4FocusExt:function(){var c=this._focusEditor;c&&c.focus()}};return k},{requires:["editor"]});
KISSY.add("editor/plugin/overlay/index",function(f,j,k,d){var h=k.extend([d],{},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:j.baseZIndex(j.zIndexManager.OVERLAY)}}});h.Dialog=k.Dialog.extend([d],{show:function(){this.center();var c=this.get("y");200<c-f.DOM.scrollTop()&&(c=f.DOM.scrollTop()+200,this.set("y",c));h.prototype.show.call(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},draggable:{value:!0},constrain:{value:!0},aria:{value:!0},zIndex:{value:j.baseZIndex(j.zIndexManager.OVERLAY)}}});
return h},{requires:["editor","overlay","./focus","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(f,j,k){var d=f.Node;return{init:function(f){k.init(f);var c=f.htmlDataProcessor;(c&&c.dataFilter).addRules({tags:{div:function(d){var b=d.getAttribute("style"),a;if(b)for(var f=d.childNodes,h=0;h<f.length;h++)1==f[h].nodeType&&(a=f[h]);if((a=a&&"span"==a.nodeName&&a.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(b)&&/display\s*:\s*none/i.test(a))return c.createFakeParserElement(d,"ke_pagebreak","div")}}});f.addButton({title:"\u5206\u9875",mode:j.WYSIWYG_MODE,
contentCls:"ks-editor-toolbar-pagebreak"},{offClick:function(){var c=this.get("editor"),b=new d('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,c.get("document")[0]),b=c.createFakeElement(b,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),a=c.getSelection();if(a=a&&a.getRanges()[0]){c.execCommand("save");for(var f=a.startContainer,h=f;"body"!==f.nodeName();)h=f,f=f.parent();a.collapse(!0);
a.splitElement(h);b.insertAfter(h);c.execCommand("save")}}})}}},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(){var f=window;return{init:function(j){j.addButton({title:"\u9884\u89c8",contentCls:"ks-editor-toolbar-preview"},{offClick:function(){var j=this.get("editor");try{var d=f.screen,h=Math.round(0.8*d.width),c=Math.round(0.7*d.height),g=Math.round(0.1*d.width)}catch(b){h=640,c=420,g=80}j=j.getDocHtml().replace(/\${title}/,"\u9884\u89c8");h=f.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+h+",height="+c+",left="+g);c=h.document;
c.open();c.write(j);c.close();h.focus()}})}}});
KISSY.add("editor/plugin/progressbar/index",function(f){function j(){j.superclass.constructor.apply(this,arguments);this._init()}var k=f.Node;j.ATTRS={container:{},width:{},height:{},progress:{value:0}};f.extend(j,f.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var d=this.get("height"),f=new k("<div class='ks-editor-progressbar'  style='width:"+this.get("width")+";height:"+d+";'></div>"),c=this.get("container"),d=(new k("<div style='overflow:hidden;'><div class='ks-editor-progressbar-inner' style='height:"+(parseInt(d)-
4)+"px'><div class='ks-editor-progressbar-inner-bg'></div></div></div>")).appendTo(f),g=(new k("<span class='ks-editor-progressbar-title'></span>")).appendTo(f);c&&f.appendTo(c);this.el=f;this._title=g;this._p=d;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(d){d=d.newVal;this._p.css("width",d+"%");this._title.html(d+"%")}});return j});
KISSY.add("editor/plugin/removeFormat/cmd",function(f,j){function k(a,b){for(var c=0;c<b.length;c++)a.removeAttr(b[c])}var d=j.RANGE,h=j.ElementPath,c=f.DOM,g="class,style,lang,width,height,align,hspace,valign".split(/,/),b=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(a){a.hasCommand("removeFormat")||a.addCommand("removeFormat",{exec:function(){a.focus();b.lastIndex=0;var f=a.getSelection().getRanges();
a.execCommand("save");for(var j=0,n;n=f[j];j++)if(!n.collapsed){n.enlarge(d.ENLARGE_ELEMENT);var p=n.createBookmark(),i=p.startNode,e=p.endNode,q=function(a){for(var c=new h(a),d=c.elements,e=1,g;(g=d[e])&&!g.equals(c.block)&&!g.equals(c.blockLimit);e++)b.test(g.nodeName())&&a._4e_breakParent(g)};q(i);q(e);for(i=i._4e_nextSourceNode(!0,c.ELEMENT_NODE,void 0,void 0);i&&!i.equals(e);)q=i._4e_nextSourceNode(!1,c.ELEMENT_NODE,void 0,void 0),"img"==i.nodeName()&&i.attr("_ke_realelement")||(b.test(i.nodeName())?
i._4e_remove(!0):k(i,g)),i=q;n.moveToBookmark(p)}a.getSelection().selectRanges(f);a.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(f,j,k){return{init:function(d){k.init(d);d.addButton({title:"\u6e05\u9664\u683c\u5f0f",mode:j.WYSIWYG_MODE,contentCls:"ks-editor-toolbar-removeformat"},{offClick:function(){d.execCommand("removeFormat")}})}}},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(f,j,k){var d=f.Node;return{init:function(h){var c=k.Draggable,g=h.get("statusBarEl");h.get("textarea");var b=(h.get("pluginConfig").resize||{}).direction||["x","y"],a="se-resize";1==b.length&&(a="x"==b[0]?"e-resize":"s-resize");var j=(new d("<div class='ks-editor-resizer' style='cursor: "+a+"'></div>")).appendTo(g);h.on("maximizeWindow",function(){j.css("display","none")});h.on("restoreWindow",function(){j.css("display","")});var o=new c({node:j}),n=
0,p=0,i=h.get("el"),e=h.get("el");o.on("dragstart",function(){n=i.height();p=e.width();h.fire("resizeStart")});o.on("drag",function(a){var c=a.left-this.startNodePos.left,a=a.top-this.startNodePos.top;f.inArray("y",b)&&h.set("height",n+a);f.inArray("x",b)&&h.set("width",p+c);h.fire("resize")});h.on("destroy",function(){o.destroy();j.remove()})}}},{requires:["editor","dd"]});
KISSY.add("editor/plugin/select/index",function(f,j,k,d){function h(a){h.superclass.constructor.call(this,a);this._init()}function c(a){return a&&-1==a.indexOf("<")?a:0}var g=f.Node,b=g.all,a=f.Event,l=f.DOM,o=j.XHTML_DTD;h.DISABLED=0;h.ENABLED=1;h.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},popUpWidth:{},title:{},items:{},emptyText:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var a=this.el.parent();a;){var c=a.nodeName();if(o[c]&&o[c].div)return a;a=
a.parent()}return b(document.body)}},state:{value:1}};h.decorate=function(a){var b=a.width(),c=[];a.all("option").each(function(a){c.push({name:a.html(),value:a.val()})});return new h({width:b+"px",title:a.attr("title"),el:a,items:c,cls:"ks-editor-combox",value:a.val()})};var n=j.Utils.addRes,p=j.Utils.destroyRes;f.extend(h,f.Base,{_init:function(){var a=this,e=a.get("container"),g=a.get("el"),f=b("<span class='ks-editor-select-wrap'><a class='ks-editor-select'  hidefocus='hidefocus' tabindex='0'><span class='ks-editor-select-text'><span class='ks-editor-select-text-inner'></span></span><span class='ks-editor-select-drop-wrap'><span class='ks-editor-select-drop'></span></span></a></span>"),
h=f.one("a"),k=a.get("title")||"",l=a.get("cls"),n=f.one(".ks-editor-select-text"),o=f.one(".ks-editor-select-text-inner");f.one(".ks-editor-select-drop");a.get("value")!==d?o.html(a._findNameByV(a.get("value"))):o.html(k);f.unselectable(d);n.css("width",a.get("width"));k&&f.attr("title",k);h.attr("href","javascript:void('"+c(k)+"')");l&&f.addClass(l,d);g?g[0].parentNode.replaceChild(f[0],g[0]):e&&f.appendTo(e,d);f.on("click",a._click,a);f.on("keydown",a._keydown,a);a.el=f;a.title=o;a._focusA=f.one("a.ks-editor-select");
a._focusA.on("blur",function(){a.menu&&a.menu.hide()});j.Utils.lazyRun(this,"_prepare","_real");a.on("afterValueChange",a._valueChange,a);a.on("afterStateChange",a._stateChange,a)},_keydown:function(c){var e;switch(c.keyCode){case a.KeyCodes.DOWN:c.halt();if(!this._isShown()){this._click();this._findCurrent()||b(this.as[0]).addClass("ks-editor-menu-selected",d);break}c=b(this._findCurrent());c.removeClass("ks-editor-menu-selected",d);(e=c.next())?e.addClass("ks-editor-menu-selected",d):b(this.as[0]).addClass("ks-editor-menu-selected",
d);break;case a.KeyCodes.UP:c.halt();if(!this._isShown())break;c=b(this._findCurrent());c.removeClass("ks-editor-menu-selected",d);(e=c.prev(d,d))?e.addClass("ks-editor-menu-selected",d):b(this.as[this.as.length-1]).addClass("ks-editor-menu-selected",d);break;case a.KeyCodes.ENTER:c.halt();if(!this._isShown()){this._click();this._findCurrent()||b(this.as[0]).addClass("ks-editor-menu-selected",d);break}c=b(this._findCurrent());if(!c)break;this._select({target:c});break;case a.KeyCodes.ESC:c.halt();
if(!this._isShown())break;this.menu.hide()}},_findCurrent:function(){var a=d;this.as.each(function(b){if(b.hasClass("ks-editor-menu-selected",d))return a=b,!1});return a},_isShown:function(){return this.menu&&this.menu.get("visible")},_findNameByV:function(a){var b=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return a||b;f.each(c,function(c){if(c.value==a)return b=c.name,!1});return b},_valueChange:function(a){this.title.html(this._findNameByV(a.newVal))},_itemsChange:function(a){var e,
a=a.newVal,h=this._selectList;h.html("");if(a&&a.length)for(e=0;e<a.length;e++){var j=a[e];(new g(f.substitute("<a class='ks-editor-select-menuitem' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:c(j.name),value:j.value,name:j.name}),j.attrs)).unselectable(d).appendTo(h,d)}else(e=this.get("emptyText"))&&b(f.substitute("<a class='ks-editor-select-menuitem' tabindex='-1' href='javascript:void(\"{tip}\")' data-value='{value}'>{name}</a>",{tip:c(e),value:"",name:e})).appendTo(h,
d);this.as=h.all("a")},val:function(a){return a!==d?(this.set("value",a),this):this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var c=this,e=c.el,g=c._focusA,f=c.get("popUpWidth"),f=new k({prefixCls:"ks-editor-",autoRender:!0,render:c.get("menuContainer"),content:"<div>",elCls:"ks-editor-menu",width:f?f:e.width(),zIndex:j.baseZIndex(j.zIndexManager.SELECT)}),h=c.get("items");f.on("hide",function(){g.removeClass("ks-editor-select-active",d)});f.on("show",
function(){g.addClass("ks-editor-select-active",d)});n.call(c,f);e=f.get("contentEl").one("div");c.menu=f;f.get("el").on("mousedown",function(a){a.halt()});a.on(window,"resize",c._resize,c);n.call(c,function(){a.remove(window,"resize",c._resize,c)});c.get("title")&&b("<div class='ks-editor-menu-title ks-editor-select-menuitem' style='margin-top:-6px;' >"+c.get("title")+"</div>").appendTo(e,d);c._selectList=b("<div>").appendTo(e,d);c._itemsChange({newVal:h});e.on("click",c._select,c);c.as=c._selectList.all("a");
e.on("mouseenter",function(){c.as.removeClass("ks-editor-menu-selected",d)});n.call(c,e);c.on("afterItemsChange",c._itemsChange,c);c.menuNode=e},_stateChange:function(a){var b=this.el;1==a.newVal?b.removeClass("ks-editor-select-disabled",d):b.addClass("ks-editor-select-disabled",d)},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(a){a&&a.halt&&a.halt();var c=this.menu,f=this.menuNode;if((a=b(a.target).closest(function(a){return l.contains(f,a)&&"a"==
l.nodeName(a)},d))&&a.attr("data-value")){var g=this.get("value"),h=a.attr("data-value");this.set("value",h);this.fire("click",{newVal:h,prevVal:g,name:a.html()});c.hide()}},_real:function(){var a=this.el,b=a.offset(),c=f.clone(b),d=this.menu.get("el").height(),g=this.menu.get("el").width(),h=l.scrollTop(),j=l.scrollLeft(),k=l.viewportHeight(),n=l.viewportWidth(),n=j+n-60,k=h+k,o=b.top+(a.height()-2),a=b.left+a.width()-2,p=this.get("align"),t=p[0];"b"==p[1]?(b.top=o,b.top+d>k&&c.top-h>k-o&&(b.top=
c.top-d)):(b.top=c.top-d,b.top<h&&c.top-h<k-o&&(b.top=o));"l"==t?b.left+g>n&&a-j>n-c.left&&(b.left=a-g):(b.left=a-g,b.left<j&&a-j<n-c.left&&(b.left=c.left));this.menu.set("xy",[b.left,b.top]);this.menu.show()},_click:function(a){a&&a.halt();var a=this.el,b=this.menu,c=this.get("value");if(b&&b.get("visible"))b.hide();else{this._focusA[0].focus();if(a.hasClass("ks-editor-select-disabled",d))return!1;this.fire("select");this._prepare();c&&b&&this.as.each(function(a){a.attr("data-value")==c?a.addClass("ks-editor-menu-selected",
d):a.removeClass("ks-editor-menu-selected",d)})}},destroy:function(){p.call(this);this.el.remove()}});j.prototype.addSelect=function(a,b,c){var c=c||h,d=this;a.editor=d;var g=new c(f.mix({container:d.get("toolBarEl"),doc:d.get("document")[0]},a));f.mix(g,b);d.on("selectionChange",function(){d.get("mode")!=j.SOURCE_MODE&&g.selectionChange&&g.selectionChange.apply(g,arguments)});d.on("destroy",function(){g.destroy()});g.on("click",function(a){var b=a.type;g[b]&&g[b].apply(g,arguments);a.halt()});a.mode==
j.WYSIWYG_MODE&&(d.on("wysiwygMode",g.enable,g),d.on("sourceMode",g.disable,g));g.init&&g.init();return g};return h},{requires:["editor","overlay"]});KISSY.add("editor/plugin/separator/index",function(f){return{init:function(j){var k=(new f.Node('<span class="ks-editor-toolbar-separator">&nbsp;</span>')).appendTo(j.get("toolBarEl"));j.on("destroy",function(){k.remove()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(f,j,k){for(var d="<div class='ks-editor-smiley-sprite'>",h=0;98>=h;h++)d+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+h+".gif'></a>";d+="</div>";return{init:function(c){c.addButton({contentCls:"ks-editor-toolbar-smiley",title:"\u63d2\u5165\u8868\u60c5",keepFocus:!1,mode:j.WYSIWYG_MODE},{init:function(){var c=this;c.get("el").on("blur",function(){c.smiley&&setTimeout(function(){c.smiley.hide()},100)})},offClick:function(){this.smiley||
(this.smiley=new k({content:d,focus4e:!1,width:"297px",autoRender:!0,elCls:"ks-editor-popup",zIndex:j.baseZIndex(j.zIndexManager.POPUP_MENU),mask:!1}),this.smiley.get("el").on("click",function(d){var d=new f.Node(d.target),b;if("a"==d.nodeName()&&(b=d.attr("data-icon")))b=new f.Node("<img alt='' src='"+b+"'/>",null,c.get("document")[0]),c.insertElement(b)}));this.smiley.set("align",{node:this.get("el"),points:["bl","tl"]});this.smiley.show()},onClick:function(){this.smiley.hide()},destructor:function(){this.smiley&&
this.smiley.destroy()}})}}},{requires:["editor","../overlay/"]});KISSY.add("editor/plugin/sourceArea/index",function(f,j){var k=j.SOURCE_MODE,d=j.WYSIWYG_MODE;return{init:function(f){f.addButton({title:"\u6e90\u7801",contentCls:"ks-editor-toolbar-source"},{init:function(){f.on("wysiwygMode",this.boff,this);f.on("sourceMode",this.bon,this)},offClick:function(){f.set("mode",k)},onClick:function(){f.set("mode",d)}})}}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(f,j,k){var d=new j.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(f){k.addButtonCmd(f,"strikeThrough",d)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(f,j,k,d){return{init:function(f){d.init(f);f.addButton({cmdType:"strikeThrough",contentCls:"ks-editor-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(f,j,k,d){function h(a){function b(a){!(0<f.length)&&a[0].nodeType==e.ELEMENT_NODE&&x.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(g,"selected_cell",!0,void 0),f.push(a))}for(var c=a.createBookmarks(),d=a.getRanges(),f=[],g={},h=0;h<d.length;h++){var i=d[h];if(i.collapsed)i=i.getCommonAncestor(),(i=i.closest("td",void 0)||i.closest("th",void 0))&&f.push(i);else{var i=new Walker(i),k;for(i.guard=b;k=i.next();)if((k=k.parent())&&x.test(k.nodeName())&&
!k.data("selected_cell"))k._4e_setMarker(g,"selected_cell",!0,void 0),f.push(k)}}j.Utils.clearAllMarkers(g);a.selectBookmarks(c);return f}function c(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",i.ie||(new q(c[d]))._4e_appendBogus(void 0)}}function g(a){if(a instanceof j.Selection){for(var b=h(a),c=b.length,a=[],d,e,f=0;f<c;f++){var i=b[f].parent(),k=i[0].rowIndex;!f&&(d=k-1);a[k]=i;f==c-1&&(e=k+
1)}f=i.parent("table");d=new q(e<f[0].rows.length&&f[0].rows[e]||0<d&&f[0].rows[d]||f[0].parentNode);for(f=a.length;0<=f;f--)a[f]&&g(a[f]);return d}a instanceof q&&(f=a.parent("table"),1==f[0].rows.length?f.remove():a.remove());return 0}function b(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),e=c[0].cellIndex,f=0;f<d[0].rows.length;f++){var g=d[0].rows[f];g.cells.length<e+1||(c=new q(g.cells[e].cloneNode(void 0)),i.ie||c._4e_appendBogus(void 0),
g=new q(g.cells[e]),b?c.insertBefore(g):c.insertAfter(g))}}function a(b){if(b instanceof j.Selection){var c=h(b),d,e=[],b=c[0]&&c[0].parent("table"),f,i,k;f=0;for(i=c.length;f<i;f++)e.push(c[f][0].cellIndex);e.sort();f=1;for(i=e.length;f<i;f++)if(1<e[f]-e[f-1]){k=e[f-1]+1;break}k||(k=0<e[0]?e[0]-1:e[e.length-1]+1);e=b[0].rows;f=0;for(i=e.length;f<i&&!(d=e[f].cells[k]);f++);d=d?new q(d):b.prev();for(k=c.length-1;0<=k;k--)c[k]&&a(c[k]);return d}if(b instanceof q){c=b.parent("table");if(!c)return null;
d=b[0].cellIndex;for(k=c[0].rows.length-1;0<=k;k--)b=new q(c[0].rows[k]),!d&&1==b[0].cells.length?g(b):b[0].cells[d]&&b[0].removeChild(b[0].cells[d])}return null}function l(a,b){var c=new j.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function o(a){var b=(a=a.getSelection())&&a.getStartElement(),c=b&&b.closest("table",void 0);if(c)return a=b.closest(function(a){var b=e.nodeName(a);return c.contains(a)&&("td"==
b||"th"==b)},void 0),b=b.closest(function(a){var b=e.nodeName(a);return c.contains(a)&&"tr"==b},void 0),{table:c,td:a,tr:b}}function n(a){return(a=o(a))&&a.td}function p(a){return(a=o(a))&&a.tr}var i=f.UA,e=f.DOM,q=f.Node,m=["tr","th","td","tbody","table"],x=/^(?:td|th)$/,v={"\u8868\u683c\u5c5e\u6027":o,"\u5220\u9664\u8868\u683c":n,"\u5220\u9664\u5217":n,"\u5220\u9664\u884c":p,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":p,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":p,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":n,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":n},r=(6===i.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),s={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},w={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=f.trim(b.replace("ke_show_border","")))}}};return{init:function(h){h.addCustomStyle(r);var i=h.htmlDataProcessor,n=i&&i.htmlFilter;(i&&i.dataFilter).addRules(s);n.addRules(w);d.register({editor:h,filter:function(a){if(f.inArray(e.nodeName(a),m))return!0},statusChecker:v,
width:"120px",handlers:{"\u8868\u683c\u5c5e\u6027":function(){var a=o(h);a&&k.useDialog(h,"table/dialog",{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){var a=h.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){var a=h.getSelection();l(g(a),void 0)},"\u5220\u9664\u5217 ":function(){var b=h.getSelection();
(b=a(b))&&l(b,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){var a=h.getSelection();c(a,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){var a=h.getSelection();c(a,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){var a=h.getSelection();b(a,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){var a=h.getSelection();b(a,void 0)}}});h.addButton({contentCls:"ks-editor-toolbar-table",mode:j.WYSIWYG_MODE,title:"\u63d2\u5165\u8868\u683c"},{offClick:function(){k.useDialog(h,"table/dialog",{selectedTable:0,selectedTd:0})}})}}},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(f,j,k){var d=new j.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(f){k.addButtonCmd(f,"underline",d)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(f,j,k,d){return{init:function(f){d.init(f);f.addButton({cmdType:"underline",contentCls:"ks-editor-toolbar-underline",title:"\u4e0b\u5212\u7ebf "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(f,j,k){function d(){this.get("editor").on("afterSave afterRestore",this._respond,this);this.disable()}function h(){h.superclass.constructor.apply(this,arguments);d.call(this)}function c(){c.superclass.constructor.apply(this,arguments);d.call(this)}f.extend(h,k,{offClick:function(){this.get("editor").execCommand("undo")},_respond:function(c){0<c.index?this.boff():this.disable()}});f.extend(c,k,{offClick:function(){this.get("editor").execCommand("redo")},
_respond:function(c){c.index<c.history.length-1?this.boff():this.disable()}});return{RedoBtn:c,UndoBtn:h}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(f,j){function k(a){var b=a.get("document")[0].body.innerHTML,c;b&&(c=a.getSelection());this.contents=b;this.bookmarks=c&&c.createBookmarks2(!0)}function d(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=f.buffer(this.save,500,this);this._init()}var h=j.Utils.arrayCompare,c=f.UA;f.augment(k,{equals:function(a){if(this.contents!=a.contents)return!1;var b=this.bookmarks,a=a.bookmarks;if(b||a){if(!b||!a||b.length!=a.length)return!1;for(var c=
0;c<b.length;c++){var d=b[c],f=a[c];if(d.startOffset!=f.startOffset||d.endOffset!=f.endOffset||!h(d.start,f.start)||!h(d.end,f.end))return!1}}return!0}});var g={16:1,17:1,18:1},b={37:1,38:1,39:1,40:1,33:1,34:1};f.augment(d,{_keyMonitor:function(){var a=this,c=a.editor;c.docReady(function(){c.get("document").on("keydown",function(d){var f=d.keyCode;f in b||f in g||(90===f&&(d.ctrlKey||d.metaKey)?(!1!==c.fire("restore",{direction:-1})&&a.restore(-1),d.halt()):89===f&&(d.ctrlKey||d.metaKey)?(!1!==c.fire("restore",
{direction:1})&&a.restore(1),d.halt()):!1!==c.fire("save",{buffer:1})&&a.save(1))})})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){if(this.editor.get("mode")==j.WYSIWYG_MODE)if(a)this.bufferRunner();else{var a=this.history,b=this.index;a.length>b+1&&a.splice(b+1,a.length-b-1);var c=this.editor,b=a[a.length-1],d=new k(c);if(!b||!b.equals(d))30===a.length&&a.shift(),a.push(d),this.index=b=a.length-1,c.fire("afterSave",{history:a,index:b})}},restore:function(a){if(this.editor.get("mode")==
j.WYSIWYG_MODE){var b=this.history,d=this.editor,f=d.get("document")[0].body,g=b[this.index+a];g&&(f.innerHTML=g.contents,g.bookmarks?d.getSelection().selectBookmarks(g.bookmarks):c.ie&&(f=f.createTextRange(),f.collapse(!0),f.select()),(f=d.getSelection())&&f.scrollIntoView(),this.index+=a,d.fire("afterRestore",{history:b,index:this.index}),d.notifySelectionChange());return g}}});return{init:function(a){if(!a.hasCommand("save")){var b=new d(a);a.addCommand("save",{exec:function(a,c){b.save(c)}});
a.addCommand("undo",{exec:function(){b.restore(-1)}});a.addCommand("redo",{exec:function(){b.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(f,j,k,d){return{init:function(f){d.init(f);f.addButton({mode:j.WYSIWYG_MODE,title:"\u64a4\u9500",editor:f,contentCls:"ks-editor-toolbar-undo"},void 0,k.UndoBtn);f.addButton({mode:j.WYSIWYG_MODE,title:"\u91cd\u505a",editor:f,contentCls:"ks-editor-toolbar-redo"},void 0,k.RedoBtn)}}},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(f,j,k,d){return{init:function(f){function c(b){for(var c=0;c<a.length;c++){var d=a[c];if(d.reg.test(b))return d}}var g=f.htmlDataProcessor,b=g&&g.dataFilter,a=[],l=f.get("pluginConfig");l.video=l.video||{};l=l.video;l.providers&&a.push.apply(a,l.providers);l.getProvider=c;b&&b.addRules({elements:{object:function(a){var b=a.getAttribute("classid"),d=a.childNodes;if(!b){for(b=0;b<d.length;b++)if("embed"==d[b].name){if(!k.isFlashEmbed(d[b]))break;if(c(d[b].getAttribute("src")))return g.createFakeParserElement(a,
"ke_video","video",!0)}return null}for(b=0;b<d.length;b++){var e=d[b];if("param"==e.nodeName&&"movie"==e.getAttribute("name").toLowerCase()&&c(e.getAttribute("value")))return g.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!k.isFlashEmbed(a))return null;if(c(a.getAttribute("src")))return g.createFakeParserElement(a,"ke_video","video",!0)}}},4);var o=new d({editor:f,cls:"ke_video",type:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.selectedEl;a&&o.show(a)}}});f.addButton({contentCls:"ks-editor-toolbar-video",
title:"\u63d2\u5165\u89c6\u9891",mode:j.WYSIWYG_MODE},{offClick:function(){o.show()}})}}},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(f,j,k,d){function h(){h.superclass.constructor.apply(this,arguments)}f.extend(h,k,{_updateTip:function(c,d){var b=this.get("editor").restoreRealElement(d);b&&(c.html(d.attr("title")),c.attr("href",this._getFlashUrl(b)))}});return{init:function(c){function f(a){return/xiami\.com/i.test(a)}var b=c.htmlDataProcessor,a=b&&b.dataFilter;a&&a.addRules({tags:{object:function(a){var c=a.getAttribute("title"),h,i;h=a.getAttribute("classid");var e=a.childNodes;
if(!h){for(h=0;h<e.length;h++)if(i=e[h],"embed"==i.nodeName){if(!d.isFlashEmbed(i))break;if(f(i.attributes.src))return b.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:c})}return null}for(h=0;h<e.length;h++)if(i=e[h],"param"==i.nodeName&&"movie"==i.getAttribute("name")&&f(i.getAttribute("value")))return b.createFakeParserElement(a,"ke_xiami","xiamiMusic",!0,{title:c})},embed:function(a){if(d.isFlashEmbed(a)&&f(a.getAttribute("src")))return b.createFakeParserElement(a,"ke_xiami","xiamiMusic",
!0,{title:a.getAttribute("title")})}}},4);var k=new h({editor:c,cls:"ke_xiami",type:"xiamiMusic",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.selectedEl;a&&k.show(a)}}});c.addButton({contentCls:"ks-editor-toolbar-music",title:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",mode:j.WYSIWYG_MODE},{offClick:function(){k.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});KISSY.add("editor/full",function(f,j){return j},{requires:["editor"]});
