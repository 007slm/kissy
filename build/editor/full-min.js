/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 7 00:48
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(f,h,k){h=k.Controller.extend({initializer:function(){this.__commands={};this.__dialogs={};this.__controls={}},use:function(e,j){var b=this,d=b.__CORE_PLUGINS||["htmlDataProcessor","enterKey","clipboard","selection"];f.isString(e)&&(e=e.split(","));for(var a=e.length-1;0<=a;a--)e[a]||e.splice(a,1);for(a=0;a<d.length;a++){var c=d[a];f.inArray(c,e)||e.unshift(c)}f.each(e,function(a,b){e[b]&&(e[b]="editor/plugin/"+a+"/")});f.use(e,function(){var a=f.makeArray(arguments);
a.shift();for(var c=0;c<a.length;c++)a[c]&&a[c].init(b);j&&j.call(b);b.adjustHeight()});b.__CORE_PLUGINS=[];return b}},{Config:{},XHTML_DTD:h.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},iframeWrapEl:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(e){return this._setData(e)}},formatData:{getter:function(){return this._getData(1)},setter:function(e){return this._setData(e)}},customStyle:{value:""},
customLink:{value:[]}}},{xclass:"editor"});h.HTML_PARSER={textarea:function(e){return e.one(this.get("prefixCls")+".editor-textarea")}};f.mix(h,f.EventTarget);return KISSY.Editor=h},{requires:["htmlparser","component","core"]});
KISSY.add("editor/plugin/clipboard/index",function(f){function h(g){this.editor=g;this._init()}function k(g){if(b.ie&&"BackCompat"!=g.get("document")[0].compatMode){var a=g.getSelection(),c;if(a.getType()==q.SELECTION_ELEMENT&&(c=a.getSelectedElement())){var d=a.getRanges()[0],o=new j(g.get("document")[0].createTextNode(""));o.insertBefore(c);d.setStartBefore(o);d.setEndAfter(c);a.selectRanges([d]);setTimeout(function(){c.parent()&&(o.remove(),a.selectElement(c))},0)}}}var e=f.Editor,j=f.Node,b=f.UA,
d=e.Range,a=e.RANGE,c=f.Event;f.augment(h,{_init:function(){var g=this.editor;c.on(g.get("document")[0].body,b.webkit?"paste":b.gecko?"paste":"beforepaste",this._paste,this);c.on(g.get("document")[0].body,"contextmenu",function(){o=1;setTimeout(function(){o=0},10)});g.addCommand("copy",new n("copy"));g.addCommand("cut",new n("cut"));g.addCommand("paste",new n("paste"))},_paste:function(){if(!o){var g=this.editor,c=g.get("document")[0];if(!c.getElementById("ke_pastebin")){var e=g.getSelection(),s=
new d(c),p=new j(b.webkit?"<body></body>":"<div></div>",null,c);p.attr("id","ke_pastebin");b.webkit&&p[0].appendChild(c.createTextNode("\u00a0"));c.body.appendChild(p[0]);p.css({position:"absolute",top:e.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});p.css("left","-1000px");var i=e.createBookmarks();s.setStartAt(p,a.POSITION_AFTER_START);s.setEndAt(p,a.POSITION_BEFORE_END);s.select(!0);setTimeout(function(){p.remove();var a;p=b.webkit&&(a=p.first())&&a.hasClass("Apple-style-span")?
a:p;e.selectBookmarks(i);a=p.html();if(a=f.trim(a.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){var c=g.fire("paste",{html:a,holder:p});void 0!==c&&(a=c);c=null;/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(a)&&(c=g.htmlDataProcessor.wordFilter);g.insertHtml(a,c)}},0)}}}});var i=function(g,a){var c=g.get("document")[0],d=new j(c.body),o=!1,e=function(){o=!0};d.on(a,e);(7<b.ie?c:c.selection.createRange()).execCommand(a);d.detach(a,e);return o},m=b.ie?function(g,a){return i(g,
a)}:function(g,a){try{return g.get("document")[0].execCommand(a)}catch(c){return!1}},l={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},n=function(g){this.type=g};n.prototype={exec:function(g){"cut"==this.type&&k(g);(g=m(g,this.type))||alert(l[this.type]);return g}};var q=e.Selection,g={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},o;e.on("contextmenu",function(a){var c=a.contextmenu,b=c.get("editor"),
d=c.menu.get("contentEl"),o={copy:0,cut:0,paste:0},e;for(e in o)o.hasOwnProperty(e)&&(o[e]=d.one(".ks-editor-paste-"+e),o[e]||function(a){var r=(new j("<a href='#'class='ks-editor-paste-"+a+"'>"+g[a]+"</a>")).appendTo(d);r.on("click",function(g){g.halt();c.hide();setTimeout(function(){b.execCommand(a)},30)});o[a]=r}(e))});return{init:function(g){g.docReady(function(){new h(g)})}}},{requires:["editor"]});
KISSY.add("editor/core/dom",function(f,h,k){function e(g,a){var b=g[a?"next":"prev"](j,1);if(b&&b[0].nodeType==d.ELEMENT_NODE){for(var e=[];b.attr("_ke_bookmark")||b._4e_isEmptyInlineRemovable(j);)if(e.push(b),b=a?b.next(j,1):b.prev(j,1),!b)return;if(g._4e_isIdentical(b,j)){for(var i=new c(a?g[0].lastChild:g[0].firstChild);e.length;)e.shift()._4e_move(g,!a,j);b._4e_moveChildren(g,!a,j);b.remove();i[0]&&i[0].nodeType==d.ELEMENT_NODE&&i._4e_mergeSiblings()}}}var j=j,b=h.XHTML_DTD,d=f.DOM,a=f.UA,c=f.Node,
i={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};h.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var m=h.POSITION,l={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,
"table-cell":1,"table-caption":1},n={hr:1},q=function(g){return g&&(g[0]||g)};k.injectDom({_4e_sameLevel:function(g,a){var a=q(a),c=g.parentNode;return c&&c==a.parentNode},_4e_isBlockBoundary:function(g,a){var c=f.merge(n,a);return!(!l[d.css(g,"display")]&&!c[d.nodeName(g)])},_4e_index:function(g,a){for(var c=g.parentNode.childNodes,b,d=-1,s=0;s<c.length;s++)if(b=c[s],!a||!(3==b.nodeType&&b.previousSibling&&3==b.previousSibling.nodeType))if(d++,b===g)return d;return-1},_4e_move:function(g,a,c){a=
q(a);c?a.insertBefore(g,a.firstChild):a.appendChild(g)},_4e_isIdentical:function(g,a){if(!a)return!1;a=q(a);if(d.nodeName(g)!=d.nodeName(a))return!1;var c=g.attributes,b=a.attributes,e=c.length,s=b.length;if(e!=s)return!1;for(var p=0;p<e;p++){var i=c[p],f=i.name;if(i.specified&&d.attr(g,f)!=d.attr(a,f))return!1}if(8>k.ieEngine)for(p=0;p<s;p++)if(i=b[p],f=i.name,i.specified&&d.attr(g,f)!=d.attr(a,f))return!1;return!0},_4e_isEmptyInlineRemovable:function(g){if(!b.$removeEmpty[d.nodeName(g)])return!1;
for(var g=g.childNodes,a=0,c=g.length;a<c;a++){var e=g[a],i=e.nodeType;if(!(i==d.ELEMENT_NODE&&e.getAttribute("_ke_bookmark"))&&(i==d.ELEMENT_NODE&&!d._4e_isEmptyInlineRemovable(e)||i==d.TEXT_NODE&&f.trim(e.nodeValue)))return!1}return!0},_4e_moveChildren:function(g,a,c){a=q(a);if(g!=a)if(c)for(;c=g.lastChild;)a.insertBefore(g.removeChild(c),a.firstChild);else for(;c=g.firstChild;)a.appendChild(g.removeChild(c))},_4e_mergeSiblings:function(g){g=new c(g);i[g.nodeName()]&&(e(g,!0),e(g))},_4e_splitText:function(g,
c){var b=g.ownerDocument;if(g.nodeType==d.TEXT_NODE){if(a.ie&&c==g.nodeValue.length){var e=b.createTextNode("");d.insertAfter(e,g);return e}e=g.splitText(c);b.documentMode&&(b=b.createTextNode(""),d.insertAfter(b,e),d.remove(b));return e}},_4e_parents:function(g,a){var c=[];c.__IS_NODELIST=1;do c[a?"push":"unshift"](g);while(g=g.parentNode);return c},_4e_nextSourceNode:function(g,a,c,b){if(b&&!b.call)var e=q(b),b=function(g){return g!==e};var a=!a&&g.firstChild,s=g;if(!a){if(g.nodeType==d.ELEMENT_NODE&&
b&&!1===b(g,!0))return null;a=g.nextSibling}for(;!a&&(s=s.parentNode);){if(b&&!1===b(s,!0))return null;a=s.nextSibling}return!a||b&&!1===b(a)?null:c&&c!=a.nodeType?d._4e_nextSourceNode(a,!1,c,b):a},_4e_previousSourceNode:function(g,a,c,b){if(b&&!b.call)var e=q(b),b=function(a){return a!==e};var a=!a&&g.lastChild,s=g;if(!a){if(g.nodeType==d.ELEMENT_NODE&&b&&!1===b(g,!0))return null;a=g.previousSibling}for(;!a&&(s=s.parentNode);){if(b&&!1===b(s,!0))return null;a=s.previousSibling}return!a||b&&!1===
b(a)?null:c&&a.nodeType!=c?d._4e_previousSourceNode(a,!1,c,b):a},_4e_commonAncestor:function(a,c){c=q(c);if(a===c)return a;if(d.contains(c,a))return c;var b=a;do if(d.contains(b,c))return b;while(b=b.parentNode);return null},_4e_hasAttributes:9>k.ieEngine?function(a){for(var c=a.attributes,b=0;b<c.length;b++){var d=c[b];switch(d.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(d.specified)return!0}}return!1}:function(g){a.gecko&&g.removeAttribute("_moz_dirty");return g.hasAttributes()},
_4e_position:function(a,c){var b=q(c);if(a.compareDocumentPosition)return a.compareDocumentPosition(b);if(a==b)return m.POSITION_IDENTICAL;if(a.nodeType==d.ELEMENT_NODE&&b.nodeType==d.ELEMENT_NODE){if(d.contains(a,b))return m.POSITION_CONTAINS+m.POSITION_PRECEDING;if(d.contains(b,a))return m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>b.sourceIndex?m.POSITION_DISCONNECTED:a.sourceIndex<b.sourceIndex?m.POSITION_PRECEDING:m.POSITION_FOLLOWING}for(var e=
d._4e_address(a),b=d._4e_address(b),i=Math.min(e.length,b.length),s=0;s<=i-1;s++)if(e[s]!=b[s])return e[s]<b[s]?m.POSITION_PRECEDING:m.POSITION_FOLLOWING;return e.length<b.length?m.POSITION_CONTAINS+m.POSITION_PRECEDING:m.POSITION_IS_CONTAINED+m.POSITION_FOLLOWING},_4e_address:function(a,b){for(var c=[],e=a.ownerDocument.documentElement,i=a;i&&i!=e;)c.unshift(d._4e_index(i,b)),i=i.parentNode;return c},_4e_remove:function(a,b){var c=a.parentNode;if(c){if(b)for(var d;d=a.firstChild;)c.insertBefore(a.removeChild(d),
a);c.removeChild(a)}return a},_4e_trim:function(a){d._4e_ltrim(a);d._4e_rtrim(a)},_4e_ltrim:function(a){for(var b;b=a.firstChild;){if(b.nodeType==d.TEXT_NODE){var c=k.ltrim(b.nodeValue),e=b.nodeValue.length;if(c)c.length<e&&(d._4e_splitText(b,e-c.length),a.removeChild(a.firstChild));else{a.removeChild(b);continue}}break}},_4e_rtrim:function(b){for(var c;c=b.lastChild;){if(c.type==d.TEXT_NODE){var e=k.rtrim(c.nodeValue),i=c.nodeValue.length;if(e)e.length<i&&(d._4e_splitText(c,e.length),b.removeChild(b.lastChild));
else{b.removeChild(c);continue}}break}!a.ie&&!a.opera&&(c=b.lastChild)&&1==c.nodeType&&"br"==d.nodeName(c)&&b.removeChild(c)},_4e_appendBogus:function(b){for(var c=b.lastChild;c&&c.nodeType==d.TEXT_NODE&&!f.trim(c.nodeValue);)c=c.previousSibling;if(!c||c.nodeType==d.TEXT_NODE||"br"!==d.nodeName(c))c=a.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br"),a.gecko&&c.setAttribute("type","_moz"),b.appendChild(c)},_4e_outerHtml:function(a){if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,
"");var c=a.ownerDocument.createElement("div");c.appendChild(a.cloneNode(!0));return c.innerHTML},_4e_setMarker:function(a,b,d,e){var a=new c(a),i=a.data("list_marker_id")||a.data("list_marker_id",f.guid()).data("list_marker_id"),s=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[i]=a;s[d]=1;return a.data(d,e)},_4e_clearMarkers:function(a,b,d){var a=new c(a),e=a.data("list_marker_names"),i=a.data("list_marker_id"),s;for(s in e)e.hasOwnProperty(s)&&a.removeData(s);
a.removeData("list_marker_names");d&&(a.removeData("list_marker_id"),delete b[i])},_4e_copyAttributes:function(b,e,i){for(var e=new c(e),f=b.attributes,i=i||{},j=0;j<f.length;j++){var s=f[j],p=s.name.toLowerCase(),l;if(!(p in i))if("checked"==p&&(l=d.attr(b,p)))e.attr(p,l);else if(s.specified||a.ie&&s.value&&"value"==p)l=d.attr(b,p),null===l&&(l=s.nodeValue),e.attr(p,l)}""!==b.style.cssText&&(e[0].style.cssText=b.style.cssText)},_4e_isEditable:function(a){a=d.nodeName(a);return(a=!b.$nonEditable[a]&&
(b[a]||b.span))&&a["#"]},_4e_getByAddress:function(a,b,c){for(var a=a.documentElement,d=0;a&&d<b.length;d++){var e=b[d];if(c)for(var i=-1,p=0;p<a.childNodes.length;p++){var f=a.childNodes[p];if(!(!0===c&&3==f.nodeType&&f.previousSibling&&3==f.previousSibling.nodeType)&&(i++,i==e)){a=f;break}}else a=a.childNodes[e]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(f){function h(a){1>arguments.length||(this.range=a,this.forceBrBreak=e,this.enlargeBr=k,this.enforceRealBlocks=e,this._||(this._={}))}var k=!0,e=!1,j=f.Editor,b=f.UA,d=j.Walker,a=j.Range,c=j.RANGE,i=j.ElementPath,m=f.Node,l=f.DOM,n=/^[\r\n\t ]*$/;f.augment(h,{getNextParagraph:function(j){var g,h,r,t,z;if(!this._.lastNode){h=this.range.clone();h.shrink(c.SHRINK_ELEMENT,k);h.enlarge(this.forceBrBreak||!this.enlargeBr?c.ENLARGE_LIST_ITEM_CONTENTS:c.ENLARGE_BLOCK_CONTENTS);
var s=new d(h),p=d.bookmark(k,k);s.evaluator=p;this._.nextNode=s.next();s=new d(h);s.evaluator=p;s=s.previous();this._.lastNode=s._4e_nextSourceNode(k);this._.lastNode&&this._.lastNode[0].nodeType==l.TEXT_NODE&&!f.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(p=new a(h.document),p.moveToPosition(this._.lastNode,c.POSITION_AFTER_END),p.checkEndOfBlock()&&(p=new i(p.endContainer),this._.lastNode=(p.block||p.blockLimit)._4e_nextSourceNode(k)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new m(h.document.createTextNode("")),l.insertAfter(this._.lastNode[0],s[0]));h=null}p=this._.nextNode;s=this._.lastNode;for(this._.nextNode=null;p;){var v=e,u=p[0].nodeType!=l.ELEMENT_NODE,y=e;if(u)p[0].nodeType==l.TEXT_NODE&&n.test(p[0].nodeValue)&&(u=e);else{var w=p.nodeName();if(p._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==w)u=k;else if(!h&&!p[0].childNodes.length&&"hr"!=w){g=p;r=p.equals(s);break}h&&(h.setEndAt(p,c.POSITION_BEFORE_START),"br"!=
w&&(this._.nextNode=p));v=k}else{if(p[0].firstChild){h||(h=new a(this.range.document),h.setStartAt(p,c.POSITION_BEFORE_START));p=new m(p[0].firstChild);continue}u=k}}u&&!h&&(h=new a(this.range.document),h.setStartAt(p,c.POSITION_BEFORE_START));r=(!v||u)&&p.equals(s);if(h&&!v)for(;!p[0].nextSibling&&!r;){w=p.parent();if(w._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){v=k;r||w.equals(s);break}p=w;u=k;r=p.equals(s);y=k}u&&h.setEndAt(p,c.POSITION_AFTER_END);p=p._4e_nextSourceNode(y,null,s);if((r=!p)||
v&&h)break}if(!g){if(!h)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;g=new i(h.startContainer);p=g.blockLimit;v={div:1,th:1,td:1};g=g.block;if((!g||!g[0])&&!this.enforceRealBlocks&&v[p.nodeName()]&&h.checkStartOfBlock()&&h.checkEndOfBlock())g=p;else if(!g||this.enforceRealBlocks&&"li"==g.nodeName())g=new m(this.range.document.createElement(j||"p")),g[0].appendChild(h.extractContents()),g._4e_trim(),h.insertNode(g),t=z=k;else if("li"!=g.nodeName()){if(!h.checkStartOfBlock()||
!h.checkEndOfBlock())g=g.clone(e),g[0].appendChild(h.extractContents()),g._4e_trim(),z=h.splitBlock(),t=!z.wasStartOfBlock,z=!z.wasEndOfBlock,h.insertNode(g)}else r||(this._.nextNode=g.equals(s)?null:h.getBoundaryNodes().endNode._4e_nextSourceNode(k,null,s))}t&&(h=new m(g[0].previousSibling),h[0]&&h[0].nodeType==l.ELEMENT_NODE&&("br"==h.nodeName()?h._4e_remove():h[0].lastChild&&"br"==l.nodeName(h[0].lastChild)&&l._4e_remove(h[0].lastChild)));z&&(h=d.bookmark(e,k),t=new m(g[0].lastChild),t[0]&&t[0].nodeType==
l.ELEMENT_NODE&&"br"==t.nodeName()&&(b.ie||t.prev(h,1)||t.next(h,1))&&t.remove());this._.nextNode||(this._.nextNode=r||g.equals(s)?null:g._4e_nextSourceNode(k,null,s));return g}});a.prototype.createIterator=function(){return new h(this)}},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(f){function h(c){for(var i=b,f=b,l=[];c;){if(c[0].nodeType==e.ELEMENT_NODE){this.lastElement||(this.lastElement=c);var h=c.nodeName();if(!f&&(!i&&d[h]&&(i=c),a[h])){var k;if(k=!i)if(k="div"==h){a:{k=c[0].childNodes;for(var g=0,o=k.length;g<o;g++){var r=k[g];if(r.nodeType==e.ELEMENT_NODE&&j.$block[r.nodeName.toLowerCase()]){k=!0;break a}}k=!1}k=!k}k?i=c:f=c}l.push(c);if("body"==h)break}c=c.parent()}this.block=i;this.blockLimit=f;this.elements=l}var k=f.Editor,
e=f.DOM,j=k.XHTML_DTD,b=null,d={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},a={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};h.prototype={compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var d=0;d<b.length;d++)if(!e.equals(b[d],a[d]))return!1;return!0},contains:function(a){for(var d=this.elements,e=0;e<d.length;e++)if(d[e].nodeName()in a)return d[e];return b},toString:function(){var a=this.elements,
b,d=[];for(b=0;b<a.length;b++)d.push(a[b].nodeName());return d.toString()}};return k.ElementPath=h},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/enterKey/index",function(f){function h(c){var e;e=c.getSelection().getRanges();for(var h=e.length-1;0<h;h--)e[h].deleteContents();e=e[0];h=e.document;if(e.checkStartOfBlock()&&e.checkEndOfBlock()){var g=(new m(e.startContainer)).block;if(g&&("li"==g.nodeName()||"li"==g.parent().nodeName()))return c.hasCommand("outdent")?(c.execCommand("save"),c.execCommand("outdent"),c.execCommand("save"),!0):!1}var k=e.splitBlock("p");if(!k)return!0;var c=k.previousBlock,g=k.nextBlock,r=
k.wasStartOfBlock,t=k.wasEndOfBlock,z;if(g)z=g.parent(),"li"==z.nodeName()&&(g._4e_breakParent(z),g._4e_move(g.next(),!0));else if(c&&(z=c.parent())&&"li"==z.nodeName())c._4e_breakParent(z),e.moveToElementEditablePosition(c.next()),c._4e_move(c.prev());if(!r&&!t){if("li"==g.nodeName()&&(z=g.first(i.invisible(!0)))&&f.inArray(z.nodeName(),["ul","ol"]))(j.ie?new a(h.createTextNode("\u00a0")):new a(h.createElement("br"))).insertBefore(z);g&&e.moveToElementEditablePosition(g)}else{var s;if(c){if("li"==c.nodeName()||
!b.test(c.nodeName()))s=c.clone()}else g&&(s=g.clone());s||(s=new a("<p>",null,h));if(z=k.elementPath)for(var k=0,p=z.elements.length;k<p;k++){var v=z.elements[k];if(v.equals(z.block)||v.equals(z.blockLimit))break;d.$removeEmpty[v.nodeName()]&&(v=v.clone(),s._4e_moveChildren(v),s.append(v))}j.ie||s._4e_appendBogus();e.insertNode(s);if(j.ie&&r&&(!t||!c[0].childNodes.length))e.moveToElementEditablePosition(t?c:s),e.select();e.moveToElementEditablePosition(r&&!t?g:s)}j.ie||(g?(s=new a(h.createElement("span")),
s.html("&nbsp;"),e.insertNode(s),s.scrollIntoView(void 0,!1),e.deleteContents()):s.scrollIntoView(void 0,!1));e.select();return!0}function k(a){var b=a.get("document")[0];c.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var c=a.execCommand("enterBlock");a.execCommand("save");!1!==c&&b.preventDefault()}})}var e=f.Editor,j=f.UA,b=/^h[1-6]$/,d=e.XHTML_DTD,a=f.Node,c=f.Event,i=e.Walker,m=e.ElementPath;return{init:function(a){a.addCommand("enterBlock",
{exec:h});a.docReady(function(){k(a)})}}},{requires:["editor"]});
KISSY.add("editor/core/focusManager",function(f){function h(){var b=this;b.__iframeFocus=i;c=b;a&&clearTimeout(a);a=setTimeout(function(){b.fire("focus")},100)}function k(){var b=this;b.__iframeFocus=m;c=l;a&&clearTimeout(a);a=setTimeout(function(){b.fire("blur")},100)}var e=f.Editor,j=f.DOM,b=f.Event,d={},a,c,f={refreshAll:function(){for(var a in d)if(d.hasOwnProperty(a)){var b=d[a].get("document")[0];b.designMode="off";b.designMode="on"}},currentInstance:function(){return c},getInstance:function(a){return d[a]},
add:function(a){var c=j._getWin(a.get("document")[0]);b.on(c,"focus",h,a);b.on(c,"blur",k,a)},register:function(a){d[a._UUID]=a},remove:function(a){delete d[a._UUID];var c=j._getWin(a.get("document")[0]);b.remove(c,"focus",h,a);b.remove(c,"blur",k,a)}},i=!0,m=!1,l=null;f.refreshAll=f.refreshAll;e.focusManager=f;e.getInstances=function(){return d};return f},{requires:["./base","./dom"]});
KISSY.add("editor/plugin/htmlDataProcessor/index",function(f){return{init:function(h){function k(a){return a.replace(q,function(a,b,c){return"<"+b+c.replace(g,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function e(a){return a.replace(/<\!--(?!{ke_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+o+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function j(a){return a.replace(/<\!--\{ke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}
var b=b,d=f.Editor,a=f.Node,c=f.UA,i=f.require("htmlparser"),m=new i.Filter,l=new i.Filter,n=new i.Filter;(function(){var a=function(a,b){return function(c,d){var e=[];(""+c).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(c,g,C){g=g.toLowerCase();"font-family"==g&&(C=C.replace(/["']/g,""));for(var i,f,h,j=0;j<a.length;j++)if(a[j]&&(c=a[j][0],i=a[j][1],f=a[j][2],h=a[j][3],g.match(c)&&(!i||C.match(i)))){g=h||g;b&&(f=f||C);"function"==typeof f&&(f=f(C,d,g));f&&f.push&&
(g=f[0],f=f[1]);"string"==typeof f&&e.push([g,f]);return}!b&&e.push([g,C])});for(var g=0;g<e.length;g++)e[g]=e[g].join(":");return e.length?e.join(";")+";":!1}}([[/mso/i],[/w:WordDocument/i],[/^-ms/i],[/^-moz/i],[/^-webkit/i]],b),d={tagNames:[[/^script$/i,""],[/^iframe$/i,""],[/^style$/i,""],[/^link$/i,""],[/^meta$/i,""],[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],root:function(a){a.filterChildren()},tags:{p:function(a){a.filterChildren()},$:function(a){var b=a.nodeName||"";if(-1!=b.indexOf(":")&&
!/^ke/.test(b))if("v:imagedata"==b){if(b=a.getAttribute("o:href"))a.setAttribute("src",b),a.removeAttribute("o:href");if(b=a.getAttribute("o:title"))a.setAttribute("title",b),a.removeAttribute("o:title");a.setTagName("img")}else a.setTagName("")}},attributes:{"class":function(a){return!a||/(^|\s+)Mso/.test(a)?!1:a},style:function(b){b=a(b);return!b?!1:b}},attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]]},e={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=
["name","href","src"],c,d=0;d<b.length;d++)c="_ke_saved_"+b[d],a.getAttribute(c)&&a.removeAttribute(b[d]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1}},attributes:{style:function(a){if(!f.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,
""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^_ks.*/,""],[/^ke:.*$/,""]],comment:function(a){return a.substr(0,o.length)==o?(a="{C}"==a.substr(o.length,3)?a.substr(o.length+3):a.substr(o.length),new i.CData(decodeURIComponent(a))):a}};c.ie&&(e.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});m.addRules(e);l.addRules(d);n.addRules(d)})();(function(){function a(b){for(var b=b.childNodes,c=b.length,d=b[c-1];d&&3==d.nodeType&&!f.trim(d.nodeValue);)d=b[--c];return d}
function b(d,g){var e=a(d);e&&((g||!c.ie)&&1==e.nodeType&&"br"==e.nodeName?d.removeChild(e):3==e.nodeType&&h.test(e.nodeValue)&&d.removeChild(e))}function g(b){var c=a(b);return!c||1==c.nodeType&&"br"==c.nodeName||"form"==b.nodeName&&"input"==c.nodeName}function e(a){b(a,!0);g(a)&&(c.ie?a.appendChild(new i.Text("\u00a0")):(a.appendChild(new i.Text("&nbsp;")),a.appendChild(new i.Tag("br"))))}function j(a){b(a,!1);g(a)&&a.appendChild(new i.Text("\u00a0"))}var h=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,u=d.XHTML_DTD,k=f.merge(u.$block,
u.$listItem,u.$tableContent),o;for(o in k)k.hasOwnProperty(o)&&("br"in u[o]||delete k[o]);delete k.td;delete k.pre;var u={tags:{}},x={tags:{}};for(o in k)k.hasOwnProperty(o)&&(u.tags[o]=e,x.tags[o]=j);l.addRules(u);m.addRules(x);n.addRules(u)})();(function(){m.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}})})();var q=/<(a|area|img|input)\b([^>]*)>/gi,g=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,o="{ke_protected}";h.htmlDataProcessor={wordFilter:n,dataFilter:l,
htmlFilter:m,toHtml:function(a){var b=new i.BeautifyWriter;(new i.Parser(a)).parse().writeHtml(b,m);return b.getHtml()},toDataFormat:function(b,d,g){g=g||l;c.gecko&&(b=b.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));b=k(b);d=new a("<div>");d.html("a"+b);b=d.html().substr(1);b=j(b);d=new i.BeautifyWriter;(new i.Parser(b)).parse().writeHtml(d,g);b=d.getHtml();return b=e(b)},toServer:function(a){var b=new i.MinifyWriter;(new i.Parser(a)).parse().writeHtml(b,m);return b.getHtml()}}}}},
{requires:["editor"]});
KISSY.add("editor/core/meta",function(){var f={backColor:["../color/btn","./cmd"],localStorage:["../flashBridge/"],bold:["../font/ui","./cmd"],draft:["../localStorage/","../select/"],flash:["../flashCommon/baseClass","../flashCommon/utils"],fontFamily:["../font/ui","./cmd"],fontSize:["../font/ui","./cmd"],foreColor:["../color/btn","./cmd"],heading:["./cmd"],image:["../button/","../bubbleview/","../contextmenu/","../dialogLoader/"],indent:["./cmd"],orderedList:["../listUtils/btn","./cmd"],unorderedList:["../listUtils/btn",
"./cmd"],italic:["../font/ui","./cmd"],justifyCenter:["./cmd"],justifyLeft:["./cmd"],justifyRight:["./cmd"],link:["../bubbleview/","./utils","../dialogLoader/"],maximize:["./cmd"],multipleUpload:["../dialogLoader/"],outdent:["./cmd"],overlay:["./focus","dd"],pageBreak:["../fakeObjects/"],removeFormat:["./cmd","../button/"],resize:["dd"],smiley:["../overlay/"],sourceArea:["../button/"],strikeThrough:["../font/ui","./cmd"],table:["../dialogLoader/","../contextmenu/"],underline:["../font/ui","./cmd"],
undo:["./btn","./cmd"],video:["../flashCommon/utils","../flashCommon/baseClass"],xiamiMusic:["../flashCommon/baseClass","../flashCommon/utils"]},h,k,e={"backColor/cmd":["../color/cmd"],"bold/cmd":["../font/cmd"],"color/btn":["../button/","../overlay/","../dialogLoader/"],"color/colorPicker/dialog":["../../overlay/"],"dentUtils/cmd":["../listUtils/"],"flash/dialog":["../flashCommon/utils","../overlay/","../select/"],"flashCommon/baseClass":["../contextmenu/","../bubbleview/","../dialogLoader/","./utils"],
"font/ui":["../button/","../select/"],"fontFamily/cmd":["../font/cmd"],"fontSize/cmd":["../font/cmd"],"foreColor/cmd":["../color/cmd"],"image/dialog":["../overlay/","switchable","../select/"],"indent/cmd":["../dentUtils/cmd"],"orderedList/cmd":["../listUtils/cmd"],"unorderedList/cmd":["../listUtils/cmd"],"italic/cmd":["../font/cmd"],"justifyCenter/cmd":["../justifyUtils/cmd"],"justifyLeft/cmd":["../justifyUtils/cmd"],"justifyRight/cmd":["../justifyUtils/cmd"],"link/dialog":["../overlay/","./utils"],
"listUtils/btn":["../button/"],"listUtils/cmd":["../listUtils/"],"multipleUpload/dialog":["../progressbar/","../overlay/","../flashBridge/","../localStorage/"],"outdent/cmd":["../dentUtils/cmd"],"strikeThrough/cmd":["../font/cmd"],"table/dialog":["../overlay/","../select/"],"underline/cmd":["../font/cmd"],"undo/btn":["../button/"],"video/dialog":["../flash/dialog","../select/"],"xiamiMusic/dialog":["../flash/dialog","../select/"]},j={};for(h in f)k="editor/plugin/"+h+"/index",j[k]={requires:f[h]};
for(h in e)k="editor/plugin/"+h,j[k]={requires:e[h]};KISSY.add(j)});
KISSY.add("editor/core/range",function(f,h,k,e,j){function b(a){var b=a.nodeType!=r.TEXT_NODE&&r.nodeName(a)in z.$removeEmpty,c=a.nodeType==r.TEXT_NODE&&!f.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return b||c||a}function d(a){return!u(a)&&!y(a)}function a(a){var b=n;return function(c){if(y(c))return l;if(c.nodeType==r.TEXT_NODE){if(f.trim(c.nodeValue).length)return n}else if(c.nodeType==r.ELEMENT_NODE&&(c=r.nodeName(c),!B[c]))if(!a&&!t.ie&&"br"==c&&!b)b=l;else return n;return l}}
function c(a,b){var c=a.startContainer,d=a.endContainer,e=a.startOffset,g=a.endOffset,i,f=n,j=n,h=void 0,p=a.document,m;if(a.collapsed)return h;0<b&&(h=p.createDocumentFragment());a.optimizeBookmark();d[0].nodeType==r.TEXT_NODE?(j=l,d=d._4e_splitText(g)):0<d[0].childNodes.length&&(g>=d[0].childNodes.length?(d=new s(d[0].appendChild(p.createTextNode(""))),m=l):d=new s(d[0].childNodes[g]));c[0].nodeType==r.TEXT_NODE?(f=l,c._4e_splitText(e)):e?e>=c[0].childNodes.length?(c=new s(c[0].appendChild(p.createTextNode(""))),
i=l):c=new s(c[0].childNodes[e].previousSibling):(i=new s(p.createTextNode("")),c.prepend(i),c=i,i=l);var k=c._4e_parents(),z=d._4e_parents();k.each(function(a,b){k[b]=a});z.each(function(a,b){z[b]=a});for(var u,x,p=0;p<k.length&&!(u=k[p],x=z[p],!u.equals(x));p++);for(var e=h,o,v,q=p;q<k.length;q++){o=k[q];g=0<b&&!o.equals(c)?e.appendChild(o.clone()[0]):null;o=o[0].nextSibling;v=z[q];for(var y=d[0],B=v&&v[0];o&&!(B==o||y==o);)v=o.nextSibling,2==b?e.appendChild(o.cloneNode(l)):(r._4e_remove(o),1==
b&&e.appendChild(o)),o=v;g&&(e=g)}for(e=h;p<z.length;p++){o=z[p];g=0<b&&!o.equals(d)?e.appendChild(o.clone()[0]):null;if(!k[p]||!o._4e_sameLevel(k[p]))for(o=o[0].previousSibling;o;)v=o.previousSibling,2==b?e.insertBefore(o.cloneNode(l),e.firstChild):(r._4e_remove(o),1==b&&e.insertBefore(o,e.firstChild)),o=v;g&&(e=g)}if(2==b){if(f&&(u=c[0],u.nodeType==r.TEXT_NODE&&u.nextSibling&&u.nextSibling.nodeType==r.TEXT_NODE&&(u.data+=u.nextSibling.data,u.parentNode.removeChild(u.nextSibling))),j)j=d[0],j.nodeType==
r.TEXT_NODE&&j.previousSibling&&j.previousSibling.nodeType==r.TEXT_NODE&&(j.previousSibling.data+=j.data,j.parentNode.removeChild(j))}else{if(u&&x&&(!c._4e_sameLevel(u)||!d._4e_sameLevel(x)))j=u._4e_index(),i&&u._4e_sameLevel(c)&&j--,a.setStart(u.parent(),j+1);a.collapse(l)}i&&c.remove();m&&d.remove();return h}function i(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==a.endContainer[0]&&a.startOffset==a.endOffset}function m(a){this.endOffset=this.endContainer=this.startOffset=
this.startContainer=q;this.collapsed=l;this.document=a}h.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var l=!0,n=!1,q=null,g=h.RANGE,o=h.POSITION,r=f.DOM,t=f.UA,z=h.XHTML_DTD,s=f.Node,p=s.all,v={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},u=new e.whitespaces,y=new e.bookmark,w=e.whitespaces(l),x=e.bookmark(!1,
!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};f.augment(m,{toString:function(){var a=[],b=this.startContainer[0],c=this.endContainer[0];a.push((b.id||b.nodeName)+":"+this.startOffset);a.push((c.id||c.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=this.startContainer,b=this.startOffset;a[0].nodeType!=r.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&
this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a[0].nodeType!=r.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,
b=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setEndAfter(b)},setStart:function(a,b){a[0].nodeType==r.ELEMENT_NODE&&v[a.nodeName()]&&(a=a.parent(),b=a._4e_index());this.startContainer=a;this.startOffset=b;this.endContainer||(this.endContainer=a,this.endOffset=b);i(this)},setEnd:function(a,b){a[0].nodeType==r.ELEMENT_NODE&&v[a.nodeName()]&&(a=a.parent(),b=a._4e_index()+1);this.endContainer=a;this.endOffset=
b;this.startContainer||(this.startContainer=a,this.startOffset=b);i(this)},setStartAt:function(a,b){switch(b){case g.POSITION_AFTER_START:this.setStart(a,0);break;case g.POSITION_BEFORE_END:a[0].nodeType==r.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setStartBefore(a);break;case g.POSITION_AFTER_END:this.setStartAfter(a)}i(this)},setEndAt:function(a,b){switch(b){case g.POSITION_AFTER_START:this.setEnd(a,0);break;
case g.POSITION_BEFORE_END:a[0].nodeType==r.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case g.POSITION_BEFORE_START:this.setEndBefore(a);break;case g.POSITION_AFTER_END:this.setEndAfter(a)}i(this)},cloneContents:function(){return c(this,2)},deleteContents:function(){return c(this,0)},extractContents:function(){return c(this,1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,
this.startOffset=this.endOffset);this.collapsed=l},clone:function(){var a=new m(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=r.ELEMENT_NODE||a.endContainer[0].nodeType!=r.ELEMENT_NODE)return q;var b=new e(a);b.evaluator=function(a){return w(a)&&x(a)};a=b.next();b.reset();b=
b.previous();return a&&a.equals(b)?a:q},shrink:function(a,b){if(!this.collapsed){var a=a||g.SHRINK_TEXT,c=this.clone(),d=this.startContainer,i=this.endContainer,f=this.startOffset,j=this.endOffset,h=l,p,s,m=l;d&&d[0].nodeType==r.TEXT_NODE&&(f?f>=d[0].nodeValue.length?c.setStartAfter(d):(c.setStartBefore(d),h=n):c.setStartBefore(d));i&&i[0].nodeType==r.TEXT_NODE&&(j?j>=i[0].nodeValue.length?c.setEndAfter(i):(c.setEndAfter(i),m=n):c.setEndBefore(i));if(h||m)s=new e(c),s.evaluator=function(b){return b.nodeType==
(a==g.SHRINK_ELEMENT?r.ELEMENT_NODE:r.TEXT_NODE)},s.guard=function(b,c){if(a==g.SHRINK_ELEMENT&&b.nodeType==r.TEXT_NODE||c&&b==p)return n;!c&&b.nodeType==r.ELEMENT_NODE&&(p=b);return l};h&&(c=s[a==g.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,b?g.POSITION_AFTER_START:g.POSITION_BEFORE_START);m&&(s.reset(),(s=s[a==g.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(s,b?g.POSITION_BEFORE_END:g.POSITION_AFTER_END));return h||m}},createBookmark2:function(a){var b=this.startContainer,
c=this.endContainer,d=this.startOffset,e=this.endOffset,g,i;if(!b||!c)return{start:0,end:0};if(a){if(b[0].nodeType==r.ELEMENT_NODE&&(g=new s(b[0].childNodes[d]))&&g[0]&&g[0].nodeType==r.TEXT_NODE&&0<d&&g[0].previousSibling.nodeType==r.TEXT_NODE)b=g,d=0;for(;b[0].nodeType==r.TEXT_NODE&&(i=b.prev(void 0,1))&&i[0].nodeType==r.TEXT_NODE;)b=i,d+=i[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==r.ELEMENT_NODE&&(g=new s(c[0].childNodes[e]))&&g[0]&&g[0].nodeType==r.TEXT_NODE&&0<e&&g[0].previousSibling.nodeType==
r.TEXT_NODE)c=g,e=0;for(;c[0].nodeType==r.TEXT_NODE&&(i=c.prev(void 0,1))&&i[0].nodeType==r.TEXT_NODE;)c=i,e+=i[0].nodeValue.length}}return{start:b._4e_address(a),end:this.collapsed?q:c._4e_address(a),startOffset:d,endOffset:e,normalized:a,is2:l}},createBookmark:function(a){var b,c,d,e,i=this.collapsed;b=new s("<span>",q,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");a&&(d=f.guid("ke_bm_"),b.attr("id",d+"S"));i||(c=b.clone(),c.html("&nbsp;"),a&&c.attr("id",d+"E"),
e=this.clone(),e.collapse(),e.insertNode(c));e=this.clone();e.collapse(l);e.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,g.POSITION_AFTER_END);return{startNode:a?d+"S":b,endNode:a?d+"E":c,serializable:a,collapsed:i}},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(l)},trim:function(a,b){var c=this.startContainer,d=this.startOffset,e=this.collapsed;if((!a||e)&&c[0]&&c[0].nodeType==r.TEXT_NODE){if(d)if(d>=c[0].nodeValue.length)d=c._4e_index()+1,
c=c.parent();else{var g=c._4e_splitText(d),d=c._4e_index()+1,c=c.parent();r.equals(this.startContainer,this.endContainer)?this.setEnd(g,this.endOffset-this.startOffset):r.equals(c,this.endContainer)&&(this.endOffset+=1)}else d=c._4e_index(),c=c.parent();this.setStart(c,d);if(e){this.collapse(l);return}}c=this.endContainer;d=this.endOffset;!b&&!e&&c[0]&&c[0].nodeType==r.TEXT_NODE&&(d?(d>=c[0].nodeValue.length||c._4e_splitText(d),d=c._4e_index()+1):d=c._4e_index(),c=c.parent(),this.setEnd(c,d))},insertNode:function(a){this.optimizeBookmark();
this.trim(n,l);var b=this.startContainer;b[0].insertBefore(a[0],b[0].childNodes[this.startOffset]||null);b[0]==this.endContainer[0]&&this.endOffset++;this.setStartBefore(a)},moveToBookmark:function(a){var b=p(this.document);if(a.is2){var c=b._4e_getByAddress(a.start,a.normalized),d=a.startOffset,b=a.end&&b._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(c,d);b?this.setEnd(b,a):this.collapse(l)}else c=(d=a.serializable)?f.one("#"+a.startNode,b):a.startNode,a=d?f.one("#"+a.endNode,
b):a.endNode,this.setStartBefore(c),c._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(l)},getCommonAncestor:function(a,b){var c=this.startContainer,d=this.endContainer,c=c[0]==d[0]?a&&c[0].nodeType==r.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new s(c[0].childNodes[this.startOffset]):c:c._4e_commonAncestor(d);return b&&c[0].nodeType==r.TEXT_NODE?c.parent():c},enlarge:function(){function a(b,c,d,e){var g=b[c?"startContainer":"endContainer"],i,f=c?0:1,j=0,h=c?"previousSibling":
"nextSibling";i=b[c?"startOffset":"endOffset"];if(g[0].nodeType==r.TEXT_NODE){if(c){if(i)return}else if(i<g[0].nodeValue.length)return;i=g[0][h];g=g[0].parentNode}else i=g[0].childNodes[i+(c?-1:1)]||null,g=g[0];for(;g;){for(;i;)if(u(i)||y(i))i=i[h];else break;if(i){if(!j)b[c?"setStartAfter":"setEndBefore"](p(i));break}g=p(g);if("body"==g.nodeName())break;if(j||g.equals(e))d[f]=g,j=1;else b[c?"setStartBefore":"setEndAfter"](g);i=g[0][h];g=g[0].parentNode}}return function(b){switch(b){case g.ENLARGE_ELEMENT:if(this.collapsed)break;
var b=this.getCommonAncestor(),c=[];a(this,1,c,b);a(this,0,c,b);c[0]&&c[1]&&(b=c[0].contains(c[1])?c[1]:c[0],this.setStartBefore(b),this.setEndAfter(b));break;case g.ENLARGE_BLOCK_CONTENTS:case g.ENLARGE_LIST_ITEM_CONTENTS:var d=new m(this.document),c=new s(this.document.body);d.setStartAt(c,g.POSITION_AFTER_START);d.setEnd(this.startContainer,this.startOffset);var d=new e(d),i,f,j=e.blockBoundary(b==g.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:q),h=function(a){var b=j(a);b||(i=p(a));return b},l=function(a){var b=
h(a);!b&&"br"==r.nodeName(a)&&(f=p(a));return b};d.guard=h;d=d.lastBackward();i=i||c;this.setStartAt(i,"br"!=i.nodeName()&&(!d&&this.checkStartOfBlock()||d&&i.contains(d))?g.POSITION_AFTER_START:g.POSITION_AFTER_END);d=this.clone();d.collapse();d.setEndAt(c,g.POSITION_BEFORE_END);d=new e(d);d.guard=b==g.ENLARGE_LIST_ITEM_CONTENTS?l:h;i=q;d=d.lastForward();i=i||c;this.setEndAt(i,!d&&this.checkEndOfBlock()||d&&i.contains(d)?g.POSITION_BEFORE_END:g.POSITION_BEFORE_START);f&&this.setEndAfter(f)}}}(),
checkStartOfBlock:function(){var b=this.startContainer,c=this.startOffset;if(c&&b[0].nodeType==r.TEXT_NODE&&f.trim(b[0].nodeValue.substring(0,c)).length)return n;this.trim();b=new j(this.startContainer);c=this.clone();c.collapse(l);c.setStartAt(b.block||b.blockLimit,g.POSITION_AFTER_START);b=new e(c);b.evaluator=a(l);return b.checkBackward()},checkEndOfBlock:function(){var b=this.endContainer,c=this.endOffset;if(b[0].nodeType==r.TEXT_NODE&&f.trim(b[0].nodeValue.substring(c)).length)return n;this.trim();
b=new j(this.endContainer);c=this.clone();c.collapse(n);c.setEndAt(b.block||b.blockLimit,g.POSITION_BEFORE_END);b=new e(c);b.evaluator=a(n);return b.checkForward()},checkBoundaryOfElement:function(a,c){var d=this.clone();d[c==g.START?"setStartAt":"setEndAt"](a,c==g.START?g.POSITION_AFTER_START:g.POSITION_BEFORE_END);d=new e(d);d.evaluator=b;return d[c==g.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,c=this.startOffset,d=this.endOffset,
g;if(a[0].nodeType==r.ELEMENT_NODE)if(g=a[0].childNodes.length,g>c)a=p(a[0].childNodes[c]);else if(0==g)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=p(a);a=a._4e_nextSourceNode()||a}if(b[0].nodeType==r.ELEMENT_NODE)if(g=b[0].childNodes.length,g>d)b=p(b[0].childNodes[d])._4e_previousSourceNode(l);else if(0==g)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=p(b)}a._4e_position(b)&o.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},fixBlock:function(a,
b){var c=this.createBookmark(),d=p(this.document.createElement(b));this.collapse(a);this.enlarge(g.ENLARGE_BLOCK_CONTENTS);d[0].appendChild(this.extractContents());d._4e_trim();t.ie||d._4e_appendBogus();this.insertNode(d);this.moveToBookmark(c);return d},splitBlock:function(a){var b=new j(this.startContainer),c=new j(this.endContainer),d=b.block,e=c.block,i=q;if(!b.blockLimit.equals(c.blockLimit))return q;"br"!=a&&(d||(d=this.fixBlock(l,a),e=(new j(this.endContainer)).block),e||(e=this.fixBlock(n,
a)));a=d&&this.checkStartOfBlock();b=e&&this.checkEndOfBlock();this.deleteContents();d&&d[0]==e[0]&&(b?(i=new j(this.startContainer),this.moveToPosition(e,g.POSITION_AFTER_END),e=q):a?(i=new j(this.startContainer),this.moveToPosition(d,g.POSITION_BEFORE_START),d=q):(e=this.splitElement(d),!t.ie&&!f.inArray(d.nodeName(),["ul","ol"])&&d._4e_appendBogus()));return{previousBlock:d,nextBlock:e,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:i}},splitElement:function(a){if(!this.collapsed)return q;this.setEndAt(a,
g.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(n);c[0].appendChild(b);c.insertAfter(a);this.moveToPosition(a,g.POSITION_AFTER_END);return c},moveToElementEditablePosition:function(a,b){for(var c=0;a;){if(a[0].nodeType==r.TEXT_NODE){this.moveToPosition(a,b?g.POSITION_AFTER_END:g.POSITION_BEFORE_START);c=1;break}a[0].nodeType==r.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,b?g.POSITION_BEFORE_END:g.POSITION_AFTER_START),c=1);var e=a,i=c,f=void 0;e[0].nodeType==r.ELEMENT_NODE&&
e._4e_isEditable()&&(f=e[b?"last":"first"](d,1));!i&&!f&&(f=e[b?"prev":"next"](d,1));a=f}return!!c},selectNodeContents:function(a){var b=a[0];this.setStart(a,0);this.setEnd(a,b.nodeType==r.TEXT_NODE?b.nodeValue.length:b.childNodes.length)},insertNodeByDtd:function(a){var b,c,d,e=a.nodeName();b=z.$block[e];this.deleteContents();if(b){for(b=this.getCommonAncestor(n,l);(c=z[b.nodeName()])&&(!c||!c[e]);){var g=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(l),
b.remove()):d=b;b=g}d&&this.splitElement(d)}this.insertNode(a)}});k.injectDom({_4e_breakParent:function(a,b){var b=p(b),a=p(a),c,d=new h.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(b);c=d.extractContents();d.insertNode(a.remove());a.after(c)}});h.Range=m},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(f){function h(a){this.document=a;this._={cache:{}};if(l){var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=j}}function k(a){a=new h(a);return!a||a.isInvalid?b:a}var e=f.Editor;e.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var j=!0,b=null,d=f.UA,a=f.DOM,c=f.Node,i=e.SELECTION,m=e.RANGE,l=d.ie,n=e.Walker,q=e.Range,g={img:1,hr:1,li:1,table:1,
tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};f.augment(h,{getNative:!l?function(){var b=this._.cache;return b.nativeSel||(b.nativeSel=a._getWin(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!l?function(){var b=this._.cache;if(b.type)return b.type;var c=i.SELECTION_TEXT,d=this.getNative();if(d){if(1==d.rangeCount){var d=d.getRangeAt(0),e=d.startContainer;
e==d.endContainer&&e.nodeType==a.ELEMENT_NODE&&1==Number(d.endOffset-d.startOffset)&&g[e.childNodes[d.startOffset].nodeName.toLowerCase()]&&(c=i.SELECTION_ELEMENT)}}else c=i.SELECTION_NONE;return b.type=c}:function(){var a=this._.cache;if(a.type)return a.type;var b=i.SELECTION_NONE;try{var c=this.getNative(),d=c.type;"Text"==d&&(b=i.SELECTION_TEXT);"Control"==d&&(b=i.SELECTION_ELEMENT);c.createRange().parentElement&&(b=i.SELECTION_TEXT)}catch(e){}return a.type=b},getRanges:l?function(){var d=function(c,
d){c=c.duplicate();c.collapse(d);for(var e=c.parentElement(),g=e.childNodes,i,f=0;f<g.length;f++){var j=g[f];if(j.nodeType==a.ELEMENT_NODE){i=c.duplicate();i.moveToElementText(j);var j=i.compareEndPoints("StartToStart",c),h=i.compareEndPoints("EndToStart",c);i.collapse();if(0<j)break;else{if(!j||1==h&&-1==j)return{container:e,offset:f};if(!h)return{container:e,offset:f+1}}i=b}}i||(i=c.duplicate(),i.moveToElementText(e),i.collapse(!1));i.setEndPoint("StartToStart",c);i=(""+i.text).replace(/\r\n|\r/g,
"\n").length;try{for(;0<i;)i-=g[--f].nodeValue.length}catch(l){i=0}return 0===i?{container:e,offset:f}:{container:g[f],offset:-i}};return function(a){var b=this._.cache;if(b.ranges&&!a)return b.ranges;var e=this.getNative(),a=e&&e.createRange(),g=this.getType();if(!e)return[];if(g==i.SELECTION_TEXT)return e=new q(this.document),g=d(a,j),e.setStart(new c(g.container),g.offset),g=d(a),e.setEnd(new c(g.container),g.offset),b.ranges=[e];if(g==i.SELECTION_ELEMENT){b=b.ranges=[];for(g=0;g<a.length;g++){for(var f=
a.item(g),h=f.parentNode,l=0,e=new q(this.document);l<h.childNodes.length&&h.childNodes[l]!=f;l++);e.setStart(new c(h),l);e.setEnd(new c(h),l+1);b.push(e)}return b}return b.ranges=[]}}():function(a){var b=this._.cache;if(b.ranges&&!a)return b.ranges;var a=[],d=this.getNative();if(!d)return[];for(var e=0;e<d.rangeCount;e++){var g=d.getRangeAt(e),i=new q(this.document);i.setStart(new c(g.startContainer),g.startOffset);i.setEnd(new c(g.endContainer),g.endOffset);a.push(i)}return b.ranges=a},getStartElement:function(){var b=
this._.cache;if(void 0!==b.startElement)return b.startElement;var d,e=this.getNative();switch(this.getType()){case i.SELECTION_ELEMENT:return this.getSelectedElement();case i.SELECTION_TEXT:var g=this.getRanges()[0];if(g&&!g.collapsed){for(g.optimize();j;)if(d=g.startContainer,g.startOffset==(d[0].nodeType===a.ELEMENT_NODE?d[0].childNodes.length:d[0].nodeValue.length)&&!d._4e_isBlockBoundary())g.setStartAfter(d);else break;d=g.startContainer;if(d[0].nodeType!=a.ELEMENT_NODE)return d.parent();d=new c(d[0].childNodes[g.startOffset]);
if(!d[0]||d[0].nodeType!=a.ELEMENT_NODE)return g.startContainer;for(g=d[0].firstChild;g&&g.nodeType==a.ELEMENT_NODE;)d=new c(g),g=g.firstChild;return d}if(l)g=e.createRange(),g.collapse(j),d=new c(g.parentElement());else{if((d=e.anchorNode)&&d.nodeType!=a.ELEMENT_NODE)d=d.parentNode;d&&(d=new c(d))}}return b.startElement=d},getSelectedElement:function(){var b,d=this._.cache;if(void 0!==d.selectedElement)return d.selectedElement;l&&(b=this.getNative().createRange(),b=b.item&&b.item(0));var e;if(b)e=
new c(b);else{b=this.getRanges()[0];for(var i,f=2;f&&(!(e=b.getEnclosedNode())||!(e[0].nodeType==a.ELEMENT_NODE&&g[e.nodeName()]&&(i=e)));f--)b.shrink(m.SHRINK_ELEMENT);e=i}return d.selectedElement=e},reset:function(){this._.cache={}},selectElement:function(a){var b,c=this.document;if(l)try{b=c.body.createControlRange(),b.addElement(a[0]),b.select()}catch(d){b=c.body.createTextRange(),b.moveToElementText(a[0]),b.select()}finally{}else b=c.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),
a.addRange(b);this.reset()},selectRanges:function(b){if(l){if(1<b.length){var c=b[b.length-1];b[0].setEnd(c.endContainer,c.endOffset);b.length=1}b[0]&&b[0].select()}else{c=this.getNative();if(!c)return;c.removeAllRanges();for(var e=0;e<b.length;e++){var g=b[e],i=this.document.createRange(),f=g.startContainer;if(g.collapsed&&(d.gecko&&1.09>d.gecko||d.opera||d.webkit)&&f[0].nodeType==a.ELEMENT_NODE&&!f[0].childNodes.length)f[0].appendChild(this.document.createTextNode(d.webkit?"\u200b":"")),g.startOffset++,
g.endOffset++;i.setStart(f[0],g.startOffset);i.setEnd(g.endContainer[0],g.endOffset);c.addRange(i)}}this.reset()},createBookmarks2:function(a){for(var b=[],c=this.getRanges(),d=0;d<c.length;d++)b.push(c[d].createBookmark2(a));return b},createBookmarks:function(b,c){for(var d=[],g=this.document,e,c=c||this.getRanges(),i=c.length,h=0;h<i;h++){d.push(e=c[h].createBookmark(b,j));var l=(b=e.serializable)?f.one("#"+e.startNode,g):e.startNode;e=b?f.one("#"+e.endNode,g):e.endNode;for(var m=h+1;m<i;m++){var k=
c[m],r=k.startContainer,n=k.endContainer;a.equals(r,l.parent())&&k.startOffset++;a.equals(r,e.parent())&&k.startOffset++;a.equals(n,l.parent())&&k.endOffset++;a.equals(n,e.parent())&&k.endOffset++}}return d},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var d=new q(this.document);d.moveToBookmark(a[c]);b.push(d)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=
this.getStartElement();a&&a.scrollIntoView(void 0,!1)},removeAllRanges:function(){var a=this.getNative();l?a&&a.clear():a&&a.removeAllRanges()}});var o={table:1,tbody:1,tr:1},r=n.whitespaces(j),t=/\ufeff|\u00a0/;q.prototype.select=q.prototype.select=!l?function(){var b=this.startContainer;this.collapsed&&b[0].nodeType==a.ELEMENT_NODE&&!b[0].childNodes.length&&b[0].appendChild(this.document.createTextNode(""));var c=this.document.createRange();c.setStart(b[0],this.startOffset);try{c.setEnd(this.endContainer[0],
this.endOffset)}catch(d){if(0<=d.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(j),c.setEnd(this.endContainer[0],this.endOffset);else throw d;}b=k(this.document).getNative();b.removeAllRanges();b.addRange(c)}:function(b){var d=this.collapsed,e,g;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var i=this.startContainer[0].childNodes[this.startOffset];if(i.nodeType==a.ELEMENT_NODE){(new h(this.document)).selectElement(new c(i));return}}(this.startContainer[0].nodeType==
a.ELEMENT_NODE&&this.startContainer.nodeName()in o||this.endContainer[0].nodeType==a.ELEMENT_NODE&&this.endContainer.nodeName()in o)&&this.shrink(m.SHRINK_ELEMENT,j);var f=this.createBookmark(),i=f.startNode,l;d||(l=f.endNode);f=this.document.body.createTextRange();f.moveToElementText(i[0]);f.moveStart("character",1);if(l)b=this.document.body.createTextRange(),b.moveToElementText(l[0]),f.setEndPoint("EndToEnd",b),f.moveEnd("character",-1);else{for(e=i[0].nextSibling;e&&!r(e);)e=e.nextSibling;e=!(e&&
e.nodeValue&&e.nodeValue.match(t))&&(b||!i[0].previousSibling||i[0].previousSibling&&"br"==a.nodeName(i[0].previousSibling));g=new c(this.document.createElement("span"));g.html("&#65279;");g.insertBefore(i);e&&a.insertBefore(this.document.createTextNode("\ufeff"),i[0]||i)}this.setStartBefore(i);i._4e_remove();if(d){if(e?(f.moveStart("character",-1),f.select(),this.document.selection.clear()):f.select(),g)this.moveToPosition(g,m.POSITION_BEFORE_START),g._4e_remove()}else this.setEndBefore(l),l._4e_remove(),
f.select()};h.getSelection=k;return e.Selection=h},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/plugin/selection/index",function(f,h){function k(a){function b(a,d){var e=h.body.createTextRange();try{e.moveToPoint(a,d)}catch(g){e=c}return e}function d(){var a=h.selection.createRange();j&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&j.select();m.remove(h,"mouseup",d);m.remove(h,"mousemove",e);j=i=0}function e(a){if(a.button){if(a=b(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",j)?a.setEndPoint("StartToStart",j):a.setEndPoint("EndToEnd",j),a.select()}else d()}var i,
f=a.get("window")[0],h=a.get("document")[0],j;m.on(h,"mousedown contextmenu",function(a){var c=h.documentElement;if(a.target===c&&(i&&d(),!(c.scrollHeight>c.clientHeight)&&(i=1,j=b(a.pageX,a.pageY))))m.on(h,"mouseup",d),m.on(h,"mousemove",e),f.focus(),j.select()})}function e(b){function e(a){if(m){var c=b.getSelection(),f=c&&c.getType(),j=c&&i.selection;if(a&&j&&f==q.SELECTION_NONE&&!i.queryCommandEnabled("InsertImage"))setTimeout(function(){e(d)},50);else{var h;if(!j||!j.type||!("Control"!=j.type&&
(h=j.createRange())&&(h=h.parentElement())&&(h=h.nodeName)&&h.toLowerCase()in{input:1,textarea:1}))l=j&&c.getRanges()[0],b.checkSelectionChange()}}}var i=b.get("document")[0],f=new n(i.body),j=new n(i.documentElement);if(8>h.Utils.ieEngine)j.on("click",function(a){"html"===(new n(a.target)).nodeName()&&b.getSelection().getNative().createRange().select()});var l,m,k=d;j.on("mousedown",function(){k=a});j.on("mouseup",function(){k=d});f.on("focusin",function(a){if("body"==(new n(a.target)).nodeName()&&
l){try{k&&l.select()}catch(b){}l=c}});f.on("focus",function(){m=d;e()});f.on("beforedeactivate",function(b){b.relatedTarget||(m=a,k=d)});f.on("mousedown",function(){m=a});f.on("mouseup",function(){m=d;setTimeout(function(){e(d)},0)});f.on("keydown",function(){m=a});f.on("keyup",function(){m=d;setTimeout(function(){e()},0)})}function j(a){var b=a.get("document")[0];m.on(b,"mouseup keyup",function(){a.checkSelectionChange()})}function b(b){function c(a){var b=h.XHTML_DTD;return a._4e_isBlockBoundary()&&
b.$empty[a.nodeName()]}function e(a){return m(a)&&k(a)}var f=b.get("document")[0],j=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,m=h.Walker.whitespaces(d),k=h.Walker.bookmark(a,d),q=function(a){return m(a)&&8!=a.nodeType};b.on("selectionChange",function(m){var k=m.path,p=new n(b.get("document")[0].body),m=(m=m.selection)&&m.getRanges()[0],x=k.blockLimit;if(i.gecko){var s=k.block||k.blockLimit,C=s&&s.last(e);s&&s._4e_isBlockBoundary()&&
(!C||!(1==C[0].nodeType&&C._4e_isBlockBoundary()))&&"pre"!=s.nodeName()&&!s._4e_getBogus()&&s._4e_appendBogus()}if(m&&m.collapsed&&!k.block){if("body"==x.nodeName()){if((k=m.fixBlock(d,"p"))&&k[0]!=p[0].lastChild&&k._4e_outerHtml().match(j))if((x=k.next(q,1))&&x[0].nodeType==l.ELEMENT_NODE&&!c[x])m.moveToElementEditablePosition(x),k._4e_remove();else if((x=k.prev(q,1))&&x[0].nodeType==l.ELEMENT_NODE&&!c[x])m.moveToElementEditablePosition(x,x._4e_outerHtml().match(j)?a:d),k._4e_remove();m.select();
b.notifySelectionChange()}k=new h.Range(f);k.moveToElementEditablePosition(p,d);"body"!==(new h.ElementPath(k.startContainer)).blockLimit.nodeName()&&(p=(new n(f.createElement("p"))).appendTo(p),i.ie||p._4e_appendBogus())}})}var d=!0,a=!1,c=null,i=f.UA,m=f.Event,l=f.DOM,n=f.Node,q=h.SELECTION;return{init:function(a){a.docReady(function(){i.ie?(k(a),e(a)):j(a)});b(a)}}},{requires:["editor"]});
KISSY.add("editor/core/styles",function(f){function h(a){return!w.attr(a,"_ke_bookmark")}function k(a,b){for(var c in a)a.hasOwnProperty(c)&&(f.isString(a[c])?a[c]=a[c].replace(L,function(a,c){return b[c]}):k(a[c],b))}function e(a,b){b&&(a=f.clone(a),k(a,b));var c=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#"==c||K[c]?x.STYLE_BLOCK:I[c]?x.STYLE_OBJECT:x.STYLE_INLINE;this._={definition:a}}function j(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();
for(var d=new C(a),e=d.getRanges(),g=0;g<e.length;g++)c.call(this,e[g]);d.selectRanges(e)}function b(a,b,c){var d=a.element;"*"==d&&(d="span");b=new D(b.createElement(d));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=e.getStyleText(c);if(a)for(var g in a)a.hasOwnProperty(g)&&b.attr(g,a[g]);c&&(b[0].style.cssText=c);return b}function d(d){var e=d.createBookmark(v),g=d.createIterator();g.enforceRealBlocks=v;g.enlargeBr=v;for(var f,j=d.document;f=g.getNextParagraph();){var h=b(this,j,
f),m=h,h="pre"==m.nodeName,l="pre"==f.nodeName,k=!h&&l;h&&!l?(l=f,k=l.html(),k=a(k,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),k=k.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),k=k.replace(/([ \t\n\r]+|&nbsp;)/g," "),k=k.replace(/<br\b[^>]*>/gi,"\n"),G.ie?(l=l[0].ownerDocument.createElement("div"),l.appendChild(m[0]),m[0].outerHTML="<pre>"+k+"</pre>",m=new D(l.firstChild),m._4e_remove()):m.html(k)):k?m=i(c(f),m):f._4e_moveChildren(m);f[0].parentNode.replaceChild(m[0],f[0]);if(h&&(f=m,h=void 0,(h=f._4e_previousSourceNode(v,
w.ELEMENT_NODE))&&"pre"==h.nodeName()))m=a(h.html(),/\n$/,"")+"\n\n"+a(f.html(),/^\n/,""),G.ie?f[0].outerHTML="<pre>"+m+"</pre>":f.html(m),h._4e_remove()}d.moveToBookmark(e)}function a(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function c(b){var c=[];a(b._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+
c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,b){c.push(b)});return c}function i(b,c){for(var d=c[0].ownerDocument.createDocumentFragment(),e=0;e<b.length;e++){var g=b[e],g=g.replace(/(\r\n|\r)/g,"\n"),g=a(g,/^[ \t]*\n/,""),g=a(g,/\n$/,""),g=a(g,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),g=g.replace(/\n/g,"<br>"),g=g.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),
i=c.clone();i.html(g);d.appendChild(i[0])}return d}function m(a){var c=a.document;if(a.collapsed)c=b(this,c,void 0),a.insertNode(c),a.moveToPosition(c,B.POSITION_BEFORE_END);else{var d=this.element,e=this._.definition,g,i=E[d];i||(g=v,i=E.span);var f=a.createBookmark();a.enlarge(B.ENLARGE_ELEMENT);a.trim();for(var j=a.createBookmark(),m=j.startNode,j=j.endNode,l=m,k;l&&l[0];){var n=u;if(w.equals(l,j))l=y,n=v;else{var x=l[0].nodeType,r=x==w.ELEMENT_NODE?l.nodeName():y;if(r&&l.attr("_ke_bookmark")){l=
l._4e_nextSourceNode(v);continue}if(!r||i[r]&&(l._4e_position(j)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(l))){var p=l.parent();if(p&&"a"==d&&p.nodeName()==d)x=b(this,c,void 0),p._4e_moveChildren(x),p[0].parentNode.replaceChild(x[0],p[0]),x._4e_mergeSiblings();else if(p&&p[0]&&((E[p.nodeName()]||E.span)[d]||g)&&(!e.parentRule||e.parentRule(p))){if(!k&&(!r||!E.$removeEmpty[r]||(l._4e_position(j)|
A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))k=new F(c),k.setStartBefore(l);if(x==w.TEXT_NODE||x==w.ELEMENT_NODE&&!l[0].childNodes.length){p=l;for(x=null;(n=!p.next(h,1))&&(x=p.parent())&&i[x.nodeName()]&&(x._4e_position(m)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(x));)p=x;k.setEndAfter(p)}}else n=
v}else n=v;l=l._4e_nextSourceNode()}if(n&&k&&!k.collapsed){for(var n=b(this,c,void 0),p=k.getCommonAncestor(),x={},r={},o,q=null,s;n&&p&&n[0]&&p[0];){if(p.nodeName()==d){for(o in e.attributes)if(e.attributes.hasOwnProperty(o)&&!r[o]&&(s=p.attr(q)))n.attr(o)==s?n.removeAttr(o):r[o]=1;for(q in e.styles)if(e.styles.hasOwnProperty(q)&&!x[q]&&(s=p.style(q)))n.style(q)==s?n.style(q,""):x[q]=1;if(!n._4e_hasAttributes()){n=y;break}}p=p.parent()}n?(n[0].appendChild(k.extractContents()),t(this,n),k.insertNode(n),
n._4e_mergeSiblings(),G.ie||n[0].normalize()):(n=new D(c.createElement("span")),n[0].appendChild(k.extractContents()),k.insertNode(n),t(this,n),n._4e_remove(!0));k=y}}m._4e_remove();j._4e_remove();a.moveToBookmark(f);a.shrink(B.SHRINK_TEXT)}}function l(a){a.enlarge(B.ENLARGE_ELEMENT);var b=a.createBookmark(),c=b.startNode;if(a.collapsed){for(var d=new H(c.parent()),e,i=0,f;i<d.elements.length&&(f=d.elements[i])&&!(f==d.block||f==d.blockLimit);i++)if(this.checkElementRemovable(f)){var j=a.checkBoundaryOfElement(f,
B.END),h=!j&&a.checkBoundaryOfElement(f,B.START);h||j?(e=f,e.match=h?"start":"end"):(f._4e_mergeSiblings(),f.nodeName()!=this.element?(j=g(this),z(f,j[f.nodeName()]||j["*"])):o(this,f))}if(e){f=c;for(i=0;;i++){j=d.elements[i];if(w.equals(j,e))break;else if(j.match)continue;else j=j.clone();j[0].appendChild(f[0]);f=j}f["start"==e.match?"insertBefore":"insertAfter"](e)}}else{var l=b.endNode,m=this,d=function(){for(var a=new H(c.parent()),b=new H(l.parent()),d=y,e=y,g=0;g<a.elements.length;g++){var i=
a.elements[g];if(i==a.block||i==a.blockLimit)break;m.checkElementRemovable(i)&&(d=i)}for(g=0;g<b.elements.length;g++){i=b.elements[g];if(i==b.block||i==b.blockLimit)break;m.checkElementRemovable(i)&&(e=i)}e&&l._4e_breakParent(e);d&&c._4e_breakParent(d)};d();for(e=new D(c[0].nextSibling);e[0]!==l[0];){i=e._4e_nextSourceNode();if(e[0]&&e[0].nodeType==w.ELEMENT_NODE&&this.checkElementRemovable(e)&&(e.nodeName()==this.element?o(this,e):(f=g(this),z(e,f[e.nodeName()]||f["*"])),i[0].nodeType==w.ELEMENT_NODE&&
i.contains(c)))d(),i=new D(c[0].nextSibling);e=i}}a.moveToBookmark(b)}function n(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function q(a,b){var c="";b!==u?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function g(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;
if(c){f.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var e=c[d],g,i,j;"string"==typeof e?g=e.toLowerCase():(g=e.element?e.element.toLowerCase():a.element,i=e.attributes,j=e.styles);e=b[g]||(b[g]={});if(i){g=e.attributes=e.attributes||[];for(var h in i)i.hasOwnProperty(h)&&g.push([h.toLowerCase(),i[h]])}if(j){var e=e.styles=e.styles||[],l;for(l in j)j.hasOwnProperty(l)&&e.push([l.toLowerCase(),j[l]])}}}return b}function o(a,b){var c=a._.definition,d=g(a),e=f.merge(c.attributes,(d[b.nodeName()]||
d["*"]||{}).attributes),c=f.merge(c.styles,(d[b.nodeName()]||d["*"]||{}).styles),d=f.isEmptyObject(e)&&f.isEmptyObject(c),i;for(i in e)if(e.hasOwnProperty(i)&&!(("class"==i||a._.definition.fullMatch)&&b.attr(i)!=r(i,e[i])))d=d||!!b.hasAttr(i),b.removeAttr(i);for(var j in c)c.hasOwnProperty(j)&&!(a._.definition.fullMatch&&b.style(j)!=r(j,c[j],v))&&(d=d||!!b.style(j),b.style(j,""));s(b)}function r(a,b,c){var d=new D("<span>");d[c?"style":"attr"](a,b);return d[c?"style":"attr"](a)}function t(a,b){for(var c=
g(a),d=b.all(a.element),e=d.length;0<=--e;)o(a,new D(d[e]));for(var i in c)if(c.hasOwnProperty(i)&&i!=a.element){d=b.all(i);for(e=d.length-1;0<=e;e--){var f=new D(d[e]);z(f,c[i])}}}function z(a,b){var c,d=b&&b.attributes;if(d)for(c=0;c<d.length;c++){var e=d[c][0],g;if(g=a.attr(e)){var i=d[c][1];(i===y||i.test&&i.test(g)||"string"==typeof i&&g==i)&&a[0].removeAttribute(e)}}if(d=b&&b.styles)for(c=0;c<d.length;c++)if(e=d[c][0],i=a.css(e)){var f=d[c][1];(f===y||f.test&&f.test(g)||"string"==typeof f&&
i==f)&&a.css(e,"")}s(a)}function s(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(v);b&&(b.nodeType==w.ELEMENT_NODE&&w._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==w.ELEMENT_NODE&&w._4e_mergeSiblings(c))}}var p=f.Editor,v=!0,u=!1,y=null,w=f.DOM,x={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},B=p.RANGE,C=p.Selection,A=p.POSITION,F=p.Range,D=f.Node,G=f.UA,H=p.ElementPath,K={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},E=p.XHTML_DTD,I={embed:1,hr:1,img:1,li:1,
object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,L=/#\((.+?)\)/g;p.STYLE=x;e.prototype={apply:function(a){j.call(this,a,u)},remove:function(a){j.call(this,a,v)},applyToRange:function(a){return(this.applyToRange=this.type==x.STYLE_INLINE?m:this.type==x.STYLE_BLOCK?d:y).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==x.STYLE_INLINE?l:y).call(this,a)},checkElementRemovable:function(a,b){if(!a)return u;var c=this._.definition,d;if(a.nodeName()==
this.element){if(!b&&!a._4e_hasAttributes())return v;var i=c._AC;if(i)c=i;else{var i={},f=0,j=c.attributes;if(j)for(var h in j)j.hasOwnProperty(h)&&(f++,i[h]=j[h]);if(j=e.getStyleText(c))i.style||f++,i.style=j;i._length=f;c=c._AC=i}if(c._length){for(var l in c)if("_length"!=l&&c.hasOwnProperty(l)){f=a.attr(l)||"";if("style"==l)a:{i=c[l];f=q(f,u);"string"==typeof i&&(i=n(i));"string"==typeof f&&(f=n(f));j=void 0;for(j in i)if(i.hasOwnProperty(j)&&!(j in f&&(f[j]==i[j]||"inherit"==i[j]||"inherit"==
f[j]))){i=u;break a}i=v}else i=c[l]==f;if(i){if(!b)return v}else if(b)return u}if(b)return v}else return v}l=g(this);if(l=l[a.nodeName()]||l["*"]){if(!(c=l.attributes)&&!(d=l.styles))return v;if(c)for(i=0;i<c.length;i++)if(l=c[i][0],l=a.attr(l))if(f=c[i][1],f===y||"string"==typeof f&&l==f||f.test&&f.test(l))return v;if(d)for(i=0;i<d.length;i++)if(l=a.css(d[i][0]))if(c=d[i][1],c===y||"string"==typeof c&&l==c||c.test&&c.test(l))return v}return u},checkActive:function(a){switch(this.type){case x.STYLE_BLOCK:return this.checkElementRemovable(a.block||
a.blockLimit,v);case x.STYLE_OBJECT:case x.STYLE_INLINE:for(var b=a.elements,c=0,d;c<b.length;c++)if(d=b[c],!(this.type==x.STYLE_INLINE&&(w.equals(d,a.block)||w.equals(d,a.blockLimit))))if((this.type!=x.STYLE_OBJECT||d.nodeName()in I)&&this.checkElementRemovable(d,v))return v}return u}};e.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(J,";"));for(var e in b)if(b.hasOwnProperty(e)){var g=b[e],i=(e+":"+g).replace(J,
";");"inherit"==g?d+=i:c+=i}c.length&&(c=q(c));return a._ST=c+d};p.Style=e},{requires:["./range","./selection","./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(f){var h=f.Node,k=f.DOM,e=f.UA,j={debugUrl:function(b){var d=f.Config;d.debug||(b=b.replace(/\.(js|css)/i,"-min.$1"));-1==b.indexOf("?t")&&(b=-1!=b.indexOf("?")?b+"&":b+"?",b+="t="+encodeURIComponent(d.tag));return d.base+"editor/"+b},lazyRun:function(b,d,a){var c=b[d],e=b[a];b[d]=function(){c.apply(this,arguments);b[d]=b[a];return e.apply(this,arguments)}},getXY:function(b,d,a,c){a=a.defaultView||a.parentWindow;b-=k.scrollLeft(a);d-=k.scrollTop(a);c&&(c=c.defaultView||
c.parentWindow,a!=c&&a.frameElement&&(c=k.offset(a.frameElement,void 0,c),b+=c.left,d+=c.top));return{left:b,top:d}},tryThese:function(b){for(var d,a=0,c=arguments.length;a<c;a++){var e=arguments[a];try{d=e();break}catch(f){}}return d},arrayCompare:function(b,d){if(!b&&!d)return!0;if(!b||!d||b.length!=d.length)return!1;for(var a=0;a<b.length;a++)if(b[a]!==d[a])return!1;return!0},clearAllMarkers:function(b){for(var d in b)b.hasOwnProperty(d)&&b[d]._4e_clearMarkers(b,!0,void 0)},ltrim:function(b){return b.replace(/^\s+/,
"")},rtrim:function(b){return b.replace(/\s+$/,"")},isNumber:function(b){return/^\d+(.\d+)?$/.test(f.trim(b))},verifyInputs:function(b){for(var d=0;d<b.length;d++){var a=new h(b[d]),c=f.trim(j.valInput(a)),e=a.attr("data-verify"),a=a.attr("data-warning");if(e&&!RegExp(e).test(c))return alert(a),!1}return!0},sourceDisable:function(b,d){b.on("sourceMode",d.disable,d);b.on("wysiwygMode",d.enable,d)},resetInput:function(b){var d=b.attr("placeholder");d&&e.ie?(b.addClass("ks-editor-input-tip"),b.val(d)):
e.ie||b.val("")},valInput:function(b,d){if(void 0===d)return b.hasClass("ks-editor-input-tip")?"":b.val();b.removeClass("ks-editor-input-tip");b.val(d)},placeholder:function(b,d){b.attr("placeholder",d);e.ie&&(b.on("blur",function(){f.trim(b.val())||(b.addClass("ks-editor-input-tip"),b.val(d))}),b.on("focus",function(){b.removeClass("ks-editor-input-tip");f.trim(b.val())==d&&b.val("")}))},htmlEncode:function(b){return!b?b:(""+b).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,
"&quot;")},normParams:function(b){var b=f.clone(b),d;for(d in b)if(b.hasOwnProperty(d)){var a=b[d];f.isFunction(a)&&(b[d]=a())}return b},map:function(b,d){for(var a=0;a<b.length;a++)b[a]=d(b[a]);return b},ieEngine:document.documentMode||e.ie,preventFocus:function(b){e.ie?b.unselectable(void 0):b.attr("onmousedown","return false;")},injectDom:function(b){f.mix(k,b);for(var d in b)b.hasOwnProperty(d)&&function(a){h.prototype[a]=function(){var c=[].slice.call(arguments,0);c.unshift(this[0]);return(c=
b[a].apply(null,c))&&(c.nodeType||f.isWindow(c))?new h(c):f.isArray(c)&&(c.__IS_NODELIST||c[0]&&c[0].nodeType)?new h(c):c}}(d)},addRes:function(){var b=this.__res=this.__res||[];b.push.apply(b,f.makeArray(arguments))},destroyRes:function(){for(var b=this.__res||[],d=0;d<b.length;d++){var a=b[d];f.isFunction(a)?a():(a.destroy&&a.destroy(),a.remove&&a.remove())}this.__res=[]},getQueryCmd:function(b){return"query"+("-"+b).replace(/-(\w)/g,function(b,a){return a.toUpperCase()})+"Active"}};return f.Editor.Utils=
j},{requires:["./base"]});
KISSY.add("editor/core/walker",function(f,h){function k(c,e){if(this._.end)return a;var g,f=this.range,j,h=this.guard,m=this.type,k=c?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,f.trim(),f.collapsed))return this.end(),a;if(!c&&!this._.guardLTR){var n=f.endContainer[0],x=n.childNodes[f.endOffset];this._.guardLTR=function(a,b){return b&&(n==a||"body"==i.nodeName(a))?!1:a!=x}}if(c&&!this._.guardRTL){var o=f.startContainer[0],q=0<f.startOffset&&o.childNodes[f.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(o==a||"body"==i.nodeName(a))?!1:a!=q}}var A=c?this._.guardRTL:this._.guardLTR;j=h?function(a,b){return A(a,b)===d?d:h(a,b)}:A;this.current?g=this.current[k](d,m,j):c?(g=f.endContainer,0<f.endOffset?(g=new l(g[0].childNodes[f.endOffset-1]),j(g[0])===d&&(g=a)):g=j(g,b)===d?a:g._4e_previousSourceNode(b,m,j,void 0)):(g=f.startContainer,g=new l(g[0].childNodes[f.startOffset]),g.length?j(g[0])===d&&(g=a):g=j(f.startContainer,b)===d?a:f.startContainer._4e_nextSourceNode(b,
m,j,void 0));for(;g&&!this._.end;){this.current=g;if(!this.evaluator||this.evaluator(g[0])!==d){if(!e)return g}else if(e&&this.evaluator)return d;g=g[k](d,m,j)}this.end();return this.current=a}function e(b){for(var c,d=a;c=k.call(this,b);)d=c;return d}function j(b){this.range=b;this.guard=this.evaluator=a;this._={}}var b=!0,d=!1,a=null,c=f.UA,i=f.DOM,m=h.XHTML_DTD,l=f.Node;f.augment(j,{end:function(){this._.end=1},next:function(){return k.call(this)},previous:function(){return k.call(this,b)},checkForward:function(){return k.call(this,
d,b)!==d},checkBackward:function(){return k.call(this,b,b)!==d},lastForward:function(){return e.call(this)},lastBackward:function(){return e.call(this,b)},reset:function(){delete this.current;this._={}},_iterator:k});f.mix(j,{blockBoundary:function(a){return function(b){return!(b.nodeType==i.ELEMENT_NODE&&i._4e_isBlockBoundary(b,a))}},bookmark:function(a,b){function c(a){return"span"==i.nodeName(a)&&i.attr(a,"_ke_bookmark")}return function(d){var e,g;e=d.nodeType==i.TEXT_NODE&&(g=d.parentNode)&&c(g);
e=a?e:e||c(d);return!!(b^e)}},whitespaces:function(a){return function(b){b=b.nodeType==i.TEXT_NODE&&!f.trim(b.nodeValue);return!!(a^b)}},invisible:function(a){var b=j.whitespaces();return function(c){c=b(c)||c.nodeType==i.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var n=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,q=j.whitespaces(),g=j.bookmark(),o=function(a){var b=i.nodeName(a);return g(a)||q(a)||1==a.nodeType&&b in m.$inline&&!(b in m.$empty)};h.Utils.injectDom({_4e_getBogus:function(a){a=new l(a);do a=
a._4e_previousSourceNode();while(a&&o(a[0]));return a&&(!c.ie?"br"==a.nodeName():3==a[0].nodeType&&n.test(a.text()))?a[0]:!1}});return h.Walker=j},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(f){var h=f.Editor;h.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};h.baseZIndex=function(f){return(h.Config.baseZIndex||1E4)+f}},{requires:["./base"]});
KISSY.add("editor",function(f,h,k,e){function j(a,b){var c=a.body;p(function(){a.designMode="on";setTimeout(function(){a.designMode="off";c.focus();arguments.callee.retry||(arguments.callee.retry=m)},50)},function(){a.designMode="off";t.attr(c,"contentEditable",q);t.attr(c,"contentEditable",m);!b&&j(a,1)})}function b(a){a.get("iframe");var b=a.get("textarea")[0],c=a.get("window")[0],d=a.get("document")[0];o.webkit&&(s.on(d,"click",function(a){var b=new z(a.target);f.inArray(b.nodeName(),["input",
"select"])&&a.preventDefault()}),s.on(d,"mouseup",function(a){var b=new z(a.target);f.inArray(b.nodeName(),["input","textarea"])&&a.preventDefault()}));if(o.gecko||r||o.opera){var g;g=(new z('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(b);g.on("focus",function(){a.focus()});a.activateGecko=function(){o.gecko&&a.__iframeFocus&&g[0].focus()};a.on("destroy",function(){g.detach();g.remove()})}s.on(c,"focus",function(){o.gecko?j(d,q):o.opera&&d.body.focus();
a.notifySelectionChange()});if(o.gecko)s.on(d,"mousedown",function(){a.__iframeFocus||j(d,q)});if(r&&(s.on(d,"keydown",function(b){if(b.keyCode in{8:1,46:1}){var c=a.getSelection(),d=c.getSelectedElement();if(d){a.fire("save");var e=c.getRanges()[0].createBookmark();d.remove();c.selectBookmarks([e]);a.fire("save");b.preventDefault()}}}),"CSS1Compat"==d.compatMode)){var i={33:1,34:1};s.on(d,"keydown",function(b){b.keyCode in i&&setTimeout(function(){a.getSelection().scrollIntoView()},0)})}if(o.webkit)s.on(d,
"mousedown",function(b){b=new z(b.target);f.inArray(b.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(b)});if(o.gecko)s.on(d,"dragstart",function(a){var b=new z(a.target);b.nodeName()==="img"&&/ke_/.test(b[0].className)&&a.preventDefault()});e.add(a)}function d(a,b,c,d){var e="",i,j=k.debugUrl("theme/editor-iframe.css");for(i=0;i<c.length;i++)e+=f.substitute('<link href="{href}" rel="stylesheet" />',{href:c[i]});return f.substitute(v,{doctype:8===g.documentMode?
'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:j,style:b,data:d||"&nbsp;",script:a?'<script id="ke_active_script">'+(t.isCustomDomain()?'document.domain="'+g.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function a(a,b){a.__saveTimer&&(clearTimeout(a.__saveTimer),a.__saveTimer=null);a.__saveTimer=setTimeout(function(){a.execCommand("save")},b||0)}function c(a,b){function c(){j=f.document;a.__set("document",new z(j));a.__set("window",new z(f));
e.detach();j.open("text/html","replace");j.write(g);j.close()}var e=a.get("iframe"),g=d(a._UUID,a.get("customStyle"),a.get("customLink"),b),i=e[0],f=i.contentWindow,j;e.__loaded=1;try{j=f.document}catch(h){if(i.src=i.src,7>r){setTimeout(c,10);return}}c()}function i(a,b){var d=new z(y),e=a.get("textarea");e.hasAttr("tabindex")&&d.attr("tabIndex",o.webkit?-1:e.attr("tabIndex"));a.get("iframeWrapEl").prepend(d);a.set("iframe",d);a.__docReady=0;if(o.gecko&&!d.__loaded)d.on("load",function(){c(a,b)},a);
else c(a,b)}var m=!0,l=l,n=f.all,q=!1,g=document,o=f.UA,r=o.ie,t=f.DOM,z=f.Node,s=f.Event,p=k.tryThese,v="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor'>{data}{script}</body></html>",u=t.getEmptyIframeSrc(),y='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true" '+(u?' src="'+u+'"':"")+"</iframe>";f.mix(h,{SOURCE_MODE:0,WYSIWYG_MODE:1});
var w=h.WYSIWYG_MODE;f.augment(h,{createDom:function(){var a,b=this.get("textarea"),c;b||this.set("textarea",b=n("<textarea class='ks-editor-textarea'></textarea>"));c=this.get("el");c.html('<div class="ks-editor-tools"></div><div class="ks-editor-textarea-wrap"></div><div class=\'ks-editor-status\'></div>');this._UUID=f.guid();this.set({iframeWrapEl:a=c.one(".ks-editor-textarea-wrap"),toolBarEl:c.one(".ks-editor-tools"),statusBarEl:c.one(".ks-editor-status")},{silent:1});b.css("width","100%");b.css("display",
"none");a.append(b);e.register(this)},_uiSetHeight:function(a){var b=this.get("toolBarEl"),c=this.get("statusBarEl"),a=parseInt(a,10),a=a-((b&&b.outerHeight()||0)+(c&&c.outerHeight()||0));this.get("iframeWrapEl").css("height",a);this.get("textarea").css("height",a)},adjustHeight:function(){var a;(a=this.get("height"))&&this._uiSetHeight(a)},_uiSetMode:function(a){var b=this,c,d=b.get("iframe"),e=b.get("textarea");a==w?(b.execCommand("save"),b.on("docReady",c=function(){b.execCommand("save");b.detach("docReady",
c)}),b._setData(e.val()),b.fire("wysiwygMode")):(e.val(b._getData(1,w)),e[0].focus(),e.show(),d.hide(),b.fire("sourceMode"))},_uiSetFocused:function(a){a&&this.__docReady&&this.focus()},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,c,d=b.get("prefixCls"),e=b.get("textarea");if(b.get("attachForm")&&(c=e[0].form))t.on(c,"submit",b.sync,b),b.on("destroy",function(){t.detach(c,"submit",b.sync,b)});b.on("docReady",
a);b.on("blur",function(){b.get("el").removeClass(d+"editor-focused")});b.on("focus",function(){b.get("el").addClass(d+"editor-focused")})},destructor:function(){var a=this.get("document")[0],b=this.get("window");this.sync();e.remove(this);s.remove([a,a.documentElement,a.body,b[0]]);f.each(this.__dialogs,function(a){a.destroy&&a.destroy()});f.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__dialogs={};this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},
addControl:function(a,b){this.__controls[a]=b},addDialog:function(a,b){this.__dialogs[a]=b},showDialog:function(a,b){var c=this.__dialogs[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},hasDialog:function(a){return!!this.__dialogs[a]},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},execCommand:function(a){var b=this.__commands[a],c=f.makeArray(arguments);c.shift();c.unshift(this);if(b)return b.exec.apply(b,c)},_getData:function(a,
b){var c=this.htmlDataProcessor,d;b==l&&(b=this.get("mode"));d=b==w?this.get("document")[0].body.innerHTML:c.toDataFormat(this.get("textarea").val());d=a?c.toHtml(d):c.toServer(d);d=f.trim(d);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(d)&&(d="");return d},_setData:function(a){var b,c=a;if(this.get("mode")!=w)this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a,"p");if(this.get("iframe")){a=this.get("iframe");b=this.get("window")[0];var d=this.get("document")[0];s.remove([d,
d.documentElement,d.body,b]);a.remove()}i(this,c)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return d(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getSelection:function(){return h.Selection.getSelection(this.get("document")[0])},focus:function(){var a=this.get("document")[0],b=t._getWin(a);o.ie||b&&b.parent&&b.parent.focus();b&&b.focus();a.body.focus();this.notifySelectionChange()},blur:function(){t._getWin(this.get("document")[0]).blur();
this.get("document")[0].body.blur()},addCustomStyle:function(a,b){var c=this.get("customStyle")||"",c=c+("\n"+a);this.set("customStyle",c);t.addStyleSheet(this.get("window"),c,b)},removeCustomStyle:function(a){t.remove(t.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var b=this.get("customLink")||[],c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);b.href=a},removeCustomLink:function(a){for(var b=
this.get("document")[0],b=t.query("link",b),c=0;c<b.length;c++)t.attr(b[c],"href")==a&&t.remove(b[c]);b=this.get("customLink")||[];a=f.indexOf(a,b);-1!=a&&b.splice(a,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},checkSelectionChange:function(){var a=this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=b.getStartElement(),d=new h.ElementPath(c);if(!a.__previousPath||
!a.__previousPath.compare(d))a.__previousPath=d,a.fire("selectionChange",{selection:b,path:d,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(b){if(this.get("mode")===w){this.focus();var c,d=b.nodeName(),e=h.XHTML_DTD,g=e.$block[d],i=h.RANGE,f=(d=this.getSelection())&&d.getRanges(),j,k,n;if(f&&0!=f.length){this.execCommand("save");for(k=f.length-1;0<=k;k--)j=f[k],c=!k&&b||b.clone(m),j.insertNodeByDtd(c),n||(n=c);if(n)return j.moveToPosition(n,
i.POSITION_AFTER_END),g&&(b=h.Walker.whitespaces(!0),(b=(n=n.next(b,1))&&n[0].nodeType==t.ELEMENT_NODE&&n.nodeName())&&e.$block[b]&&e[b]["#"]&&j.moveToElementEditablePosition(n)),d.selectRanges([j]),this.focus(),c&&c.scrollIntoView(l,!1),a(this),c}}},insertHtml:function(b,c){var d=this,e;if(d.get("mode")===w){if(e=d.htmlDataProcessor)b=e.toDataFormat(b,null,c);d.focus();d.execCommand("save");var g=d.get("document")[0];e=0;if(r){var i=g.selection;"Control"==i.type&&i.clear();try{i.createRange().pasteHTML(b)}catch(f){}}else try{g.execCommand("inserthtml",
q,b)}catch(j){setTimeout(function(){if(0==d.getSelection().getRanges().length){var a=new h.Range(g),c=t.first(g.body,function(a){return 1==a.nodeType&&"br"!=t.nodeName(a)});c||(c=new z(g.createElement("p")),c._4e_appendBogus(l),g.body.appendChild(c[0]));a.setStartAt(c,h.RANGE.POSITION_AFTER_START);a.select()}g.execCommand("inserthtml",q,b)},e=100)}setTimeout(function(){d.getSelection().scrollIntoView()},e);a(d,e)}}});h._initIFrame=function(a){var c=e.getInstance(a),d=c.get("document")[0],a=d.getElementById("ke_active_script");
t.remove(a);b(c);var g=d.body;r?(g.hideFocus=m,g.disabled=m,g.contentEditable=m,g.removeAttribute("disabled")):setTimeout(function(){o.gecko||o.opera?g.contentEditable=m:o.webkit?g.parentNode.contentEditable=m:d.designMode="on"},0);if(o.gecko||o.opera){var i=d.documentElement;s.on(i,"mousedown",function(a){if(a.target==i){o.gecko&&j(d,q);c.activateGecko()}})}setTimeout(function(){r&&setTimeout(function(){if(d){g.runtimeStyle.marginBottom="0px";g.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){c.__docReady=
1;c.fire("docReady");var a=c.get("disableObjectResizing"),b=c.get("disableInlineTableEditing");if(a||b)try{d.execCommand("enableObjectResizing",q,!a);d.execCommand("enableInlineTableEditing",q,!b)}catch(e){s.on(g,r?"resizestart":"resize",function(c){var d=new z(c.target);(a||d.nodeName()==="table"&&b)&&c.preventDefault()})}},10)};return h},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/focusManager,editor/core/meta".split(",")});
KISSY.add("editor/plugin/backColor/cmd",function(f,h){var k={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(e){e.hasCommand("backColor")||e.addCommand("backColor",{exec:function(e,b){e.execCommand("save");h.applyColor(e,b,k);e.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/backColor/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("backColor",{cmdType:"backColor",tooltip:"\u80cc\u666f\u989c\u8272"},void 0,k)}}},{requires:["editor","../color/btn","./cmd"]});KISSY.add("editor/plugin/bold/cmd",function(f,h,k){var e=new h.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(f){k.addButtonCmd(f,"bold",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("bold",{cmdType:"bold",tooltip:"\u7c97\u4f53 "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubbleview/index",function(f,h,k){function e(a){var b=null,d=c[f.stamp(a.editor)];f.each(d,function(c){var d;if(d=c!==a)if(d=c.get("visible")){d=a.get("y");var e=d+a.get("el").outerHeight(),f=c.get("y"),j=f+c.get("el").outerHeight();d=d<=j&&e>=j||d<=f&&e>=f}d&&(b?b.get("y")<c.get("y")&&(b=c):b=c);return b})}var j=f.Event,b={}.a,d=f.DOM,a=h.extend({},{ATTRS:{zIndex:{value:k.baseZIndex(k.zIndexManager.BUBBLE_VIEW)},elCls:{value:"ks-editor-bubbleview-bubble"},prefixCls:{value:"ks-editor-"},
effect:{value:{effect:"fade",duration:0.3}}}}),c={};a.register=function(i){function h(){r&&(r.hide(),j.remove(s,"scroll",k))}function l(){var a;var c=r.selectedEl,g=r.editor;if(c){var i=g.get("window")[0],f=g.get("iframe").offset(),g=f.top,f=f.left,j=f+d.width(i),i=g+d.height(i),h=c.offset(b,window),l=h.top,h=h.left,k=h+c.width(),c=l+c.height(),m;c>i&&l<i?m=i-30:c>g&&c<i&&(m=c);k>f&&h<f?a=f:h>f&&h<j&&(a=h);a=a!==b&&m!==b?[a,m]:b}else a=b;if(a){r.set("xy",a);if(m=e(r))a[1]=m.get("y")+m.get("el").outerHeight(),
r.set("xy",a);r.get("visible")||r.show()}}function k(){r.selectedEl&&(r&&(r.get("el"),r.hide()),p())}function q(){j.on(s,"scroll",k);l()}var g=i.filter,o=i.editor,r=new a({editor:o}),t=f.stamp(o),z=c[t]=c[t]||[];r.init=i.init;if(r.init)r.on("afterRenderUI",function(){r.init()});z.push(r);r.editor=o;o.on("destroy",function(){delete c[t];r.destroy()});o.on("selectionChange",function(a){var a=a.path,b=a.elements;if(a&&b&&(a=a.lastElement))(a=g(a))?(r.selectedEl=a,r.hide(),f.later(q,10)):r&&h()});o.on("sourceMode",
h);var s=o.get("window")[0],p=f.buffer(l,350)};return a},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(f,h,k){h.prototype.addButton=function(e,j,b,d){void 0===d&&(d=j.checkable?k.Toggle:k,delete j.checkable);var a=this,c=a.get("prefixCls")+"editor-",i=new d(f.mix({render:a.get("toolBarEl"),elAttrs:{hideFocus:"hideFocus"},autoRender:!0,content:'<span class="'+c+"toolbar-item "+c+"toolbar-"+e+'"></span>',elCls:c+"toolbar-button",prefixCls:c,editor:a},j)),m=i.get("el").one("span");i.get("el").unselectable();i.on("afterContentClsChange",function(a){m[0].className=
c+"toolbar-item "+c+"toolbar-"+a.newVal});f.mix(i,b);i.init&&i.init();if(i.selectionChange)a.on("selectionChange",function(b){a.get("mode")!=h.SOURCE_MODE&&i.selectionChange(b)});if(i.onClick||i.offClick)i.on("click",function(a){var b=i.get("checked"),b=b===true||b===void 0?"offClick":"onClick";if(i[b])i[b](a)});i.get("mode")==h.WYSIWYG_MODE&&(a.on("wysiwygMode",function(){i.set("disabled",false)}),a.on("sourceMode",function(){i.set("disabled",true)}));a.addControl(e,i);return i};return k},{requires:["editor",
"button"]});
KISSY.add("editor/plugin/checkboxSourcearea/index",function(f,h){function k(b){this.editor=b;this._init()}var e=f.Node,j=h.SOURCE_MODE,b=h.WYSIWYG_MODE;f.augment(k,{_init:function(){var b=this.editor,a=b.get("statusBarEl");this.holder=(new e("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(a);(this.el=this.holder.one("input")).on("click",this._check,
this);b.on("wysiwygMode",this._wysiwygmode,this);b.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var d=this.editor;this.el.attr("checked")?d.set("mode",j):d.set("mode",b)},destroy:function(){this.holder.remove()}});return{init:function(b){var a=new k(b);b.on("destroy",function(){a.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/color/btn",function(f,h,k,e,j){var b=f.Node;f.DOM.addStyleSheet(window,".ks-editor-color-panel a {display: block;color:black;text-decoration: none;}.ks-editor-color-panel a:hover {color:black;text-decoration: none;}.ks-editor-color-panel a:active {color:black;}.ks-editor-color-palette {    margin: 5px 8px 8px;}.ks-editor-color-palette table {    border: 1px solid #666666;    border-collapse: collapse;}.ks-editor-color-palette td {    border-right: 1px solid #666666;    height: 18px;    width: 18px;}a.ks-editor-color-a {    height: 18px;    width: 18px;}a.ks-editor-color-a:hover {    border: 1px solid #ffffff;    height: 16px;    width: 16px;}a.ks-editor-color-remove {  padding:3px 8px;  margin:2px 0 3px 0;}a.ks-editor-color-remove:hover {    background-color: #D6E9F8;}",
"ks-editor-color-plugin");var d=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],a;(function(){a="<div class='ks-editor-color-panel'><a class='ks-editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";
for(var b=0;3>b;b++){a+="<div class='ks-editor-color-palette'><table>";for(var e=d[b],f=e.length/8,j=0;j<f;j++){a+="<tr>";for(var h=0;8>h;h++){var k="#"+e[8*j+h];a+="<td>";a+="<a href='javascript:void(0);' class='ks-editor-color-a' style='background-color:"+k+"'></a>";a+="</td>"}a+="</tr>"}a+="</table></div>"}a+="<div><a class='ks-editor-button ks-editor-color-others ks-inline-block'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();return k.Toggle.extend({init:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.onClick()},
150)})},offClick:function(){this._prepare()},onClick:function(){this.colorWin&&this.colorWin.hide()},_prepare:function(){var b=this,d=b.get("editor"),f;b.colorWin=new e({elAttrs:{tabindex:0},elCls:"ks-editor-popup",content:a,autoRender:!0,width:170,zIndex:h.baseZIndex(h.zIndexManager.POPUP_MENU)});var l=b.colorWin;f=l.get("contentEl");f.on("click",b._selectColor,b);l.on("hide",function(){b.set("checked",!1)});f.one(".ks-editor-color-others").on("click",function(a){a.halt();l.hide();j.useDialog(d,
"color/colorPicker/dialog",b.get("cmdType"))});b._prepare=b._show;b._show()},_show:function(){var a=this.get("el"),b=this.colorWin;b.align(a,["bl","tl"],[0,2]);b.show()},_selectColor:function(a){a.halt();a=new b(a.target);a.hasClass("ks-editor-color-a")&&this.get("editor").execCommand(this.get("cmdType"),a.style("background-color"))},destroy:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{mode:{value:h.WYSIWYG_MODE}}})},{requires:["editor","../button/","../overlay/","../dialogLoader/"]});
KISSY.add("editor/plugin/color/cmd",function(f,h){return{applyColor:function(f,e,j){var b=f.get("document")[0];f.execCommand("save");e?(new h.Style(j,{color:e})).apply(b):(new h.Style(j,{color:"inherit"})).remove(b);f.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(f,h,k){function e(){e.superclass.constructor.apply(this,arguments)}var j=f.all,b=f.Event;e.register=function(a){function c(){d.hide()}var d=new e(a),f=a.editor;d.editor=f;f.on("destroy",function(){d.destroy()});f.on("sourceMode",c);f.docReady(function(){var l=f.get("document")[0];b.on(l,"mousedown",c);b.delegate(l,"contextmenu",a.filter,function(a){e.hide(f);var b=j(a.target);a.halt();var c=a.pageX,k=a.pageY;c||(a=b._4e_getOffset(void 0),c=a.left,
k=a.top);setTimeout(function(){d.selectedEl=b;d.show(h.Utils.getXY(c,k,l,document));e.show(d)},30)})});return d};var d={};e.hide=function(a){(a=d[f.stamp(a)])&&a.hide()};e.show=function(a){d[f.stamp(a.editor)]=a};f.extend(e,f.Base,{_init:function(){var a=this,b=a.get("handlers");a.menu=new k({autoRender:!0,width:a.get("width"),elCls:"ks-editor-menu",prefixCls:"ks-editor-"});var d=a.menu.get("contentEl"),e;for(e in b){var h=j("<a href='#' class='ks-editor-menuitem'>"+e+"</a>");d.append(h);b.hasOwnProperty(e)&&
function(b,c){b.unselectable(void 0);b.on("click",function(d){d.halt();b.hasClass("ks-editor-menuitem-disable",void 0)||(a.hide(),f.later(c,30,!1,a))})}(h,b[e])}},destroy:function(){var a;(a=this.menu)&&a.destroy()},hide:function(){var a;(a=this.menu)&&a.hide()},_realShow:function(a){var b=this.menu;h.fire("contextmenu",{contextmenu:this});b.set("xy",[a.left,a.top]);var d=this.get("statusChecker"),e=this.editor;d&&b.get("contentEl").children("a").each(function(a){var b=d[f.trim(a.text())];b&&(b(e)?
a.removeClass("ks-editor-menuitem-disable",void 0):a.addClass("ks-editor-menuitem-disable",void 0))});b.show()},show:function(a){this._init();this.show=this._realShow;this.show(a)}});return e},{requires:["editor","overlay"]});
KISSY.add("editor/plugin/dentUtils/cmd",function(f,h,k){function e(a){return a.nodeType==c.ELEMENT_NODE&&"li"==c.nodeName(a)}function j(a,b,e){for(var g=a.startContainer,f=a.endContainer;g&&!g.parent().equals(b);)g=g.parent();for(;f&&!f.parent().equals(b);)f=f.parent();if(g&&f){for(var j=g,g=[],n=!1;!n;)j.equals(f)&&(n=!0),g.push(j),j=j.next();if(!(1>g.length)){var q=b._4e_parents(!0,void 0);q.each(function(a,b){q[b]=a});for(f=0;f<q.length;f++)if(d[q[f].nodeName()]){b=q[f];break}for(var j="indent"==
e?1:-1,f=g[0],n=g[g.length-1],g={},w=k.listToArray(b,g),x=w[n.data("listarray_index")].indent,f=f.data("listarray_index");f<=n.data("listarray_index");f++){w[f].indent+=j;var B=w[f].parent;w[f].parent=new i(B[0].ownerDocument.createElement(B.nodeName()))}for(f=n.data("listarray_index")+1;f<w.length&&w[f].indent>x;f++)w[f].indent+=j;n=k.arrayToList(w,g,null,"p");j=[];if("outdent"==e){var C;if((C=b.parent())&&"li"==C.nodeName())for(var e=n.listNode.childNodes,A,f=e.length-1;0<=f;f--)(A=new i(e[f]))&&
"li"==A.nodeName()&&j.push(A)}n&&(c.insertBefore(n.listNode[0]||n.listNode,b[0]||b),b.remove());if(j&&j.length)for(f=0;f<j.length;f++){for(A=b=j[f];(A=A.next())&&A.nodeName()in d;)m.ie&&!b.first(function(a){return l(a)&&o(a)},1)&&b[0].appendChild(a.document.createTextNode("\u00a0")),b[0].appendChild(A[0]);c.insertAfter(b[0],C[0])}h.Utils.clearAllMarkers(g)}}}function b(a,b){var c=parseInt(a.style(n),10);isNaN(c)&&(c=0);c+=("indent"==b?1:-1)*q;if(0>c)return!1;c=Math.max(c,0);c=Math.ceil(c/q)*q;a.css(n,
c?c+g:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var d={ol:1,ul:1},a=h.Walker,c=f.DOM,i=f.Node,m=f.UA,l=a.whitespaces(!0),n="margin-left",q=40,g="px",o=a.bookmark(!1,!0);return{checkOutdentActive:function(a){var b=a.blockLimit;return a.contains(d)?!0:(a=a.block||b)&&a.style(n)},addCommand:function(g,f){g.hasCommand(f)||g.addCommand(f,{exec:function(g){g.execCommand("save");var i=g.getSelection(),h=i&&i.getRanges()[0];if(h){for(var l=h.startContainer,k=h.endContainer,m=h.getCommonAncestor();m&&
!(m[0].nodeType==c.ELEMENT_NODE&&d[m.nodeName()]);)m=m.parent();m&&l[0].nodeType==c.ELEMENT_NODE&&l.nodeName()in d&&(l=new a(h),l.evaluator=e,h.startContainer=l.next());m&&k[0].nodeType==c.ELEMENT_NODE&&k.nodeName()in d&&(l=new a(h),l.evaluator=e,h.endContainer=l.previous());k=i.createBookmarks(!0);if(m){for(l=m.first();l&&"li"!=l.nodeName();)l=l.next();var n=h.startContainer;(!(l[0]==n[0]||l.contains(n))||!b(m,f))&&j(h,m,f)}else{h=h.createIterator();h.enforceRealBlocks=!0;for(h.enlargeBr=!0;m=h.getNextParagraph();)b(m,
f)}i.selectBookmarks(k)}g.execCommand("save");g.notifySelectionChange()}})}}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/dialogLoader/index",function(f,h,k){var e,j={loading:function(){e||(e=new h({x:0,width:6==f.UA.ie?f.DOM.docWidth():"100%",y:0,zIndex:k.baseZIndex(k.zIndexManager.LOADING),prefixCls:"ks-editor-",elCls:"ks-editor-global-loading"}));e.set("height",f.DOM.docHeight());e.show();e.loading()},unloading:function(){e.hide()}};return{useDialog:function(b,d,a){b.hasDialog(d)?b.showDialog(d,a):(j.loading(),f.use("editor/plugin/"+d,function(c,e){j.unloading();b.addDialog(d,new e(b));b.showDialog(d,
a)}))}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(f,h,k,e,j){function b(a,b,c){for(a+="";a.length<b;)a=c+a;return a}function d(a){f.isNumber(a)&&(a=new Date(a));return a instanceof Date?[a.getFullYear(),"-",b(a.getMonth()+1,2,"0"),"-",b(a.getDate(),2,"0")," ",b(a.getHours(),2,"0"),":",b(a.getMinutes(),2,"0"),":",b(a.getSeconds(),2,"0")].join(""):a}function a(a){this.editor=a;this._init()}function c(b){var c=new a(b);b.on("destroy",function(){c.destroy()})}var i=f.Node,m=f.Event,l=f.JSON,n=h.Utils.addRes,
q=h.Utils.destroyRes;f.augment(a,{_getSaveKey:function(){var a=this.editor.get("pluginConfig");return a.draft&&a.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var a=k.getItem(this._getSaveKey()),b=[];a&&(b=k==window.localStorage?l.parse(decodeURIComponent(a)):a);this.drafts=b}return this.drafts},_init:function(){var a=this,b=a.editor,c=b.get("statusBarEl"),d=b.get("pluginConfig");d.draft=d.draft||{};a.draftInterval=d.draft.interval=d.draft.interval||5;a.draftLimit=
d.draft.limit=d.draft.limit||5;c=(new i("<div class='ks-editor-draft'><span class='ks-editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+d.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(c);a.timeTip=(new i("<span class='ks-editor-draft-time'/>")).appendTo(c);var e=(new i("<a href='#' onclick='return false;' class='ks-editor-button ks-editor-draft-save-btn ks-inline-block' style='vertical-align:middle;padding:1px 9px;'><span class='ks-editor-draft-mansave'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>")).unselectable().appendTo(c),f=
new j({container:c,menuContainer:document.body,doc:b.get("document")[0],width:"85px",popUpWidth:"225px",align:["r","t"],emptyText:"&nbsp;&nbsp;&nbsp;\u5c1a\u65e0\u7f16\u8f91\u5668\u5386\u53f2\u5b58\u5728",tooltip:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"});a.versions=f;f.on("select",function(){f.detach("select",arguments.callee);a.sync()});e.on("click",function(b){a.save(!1);b.halt()});n.call(a,e);b.get("textarea")[0].form&&function(){function c(){a.save(!0)}var d=b.get("textarea")[0].form;m.on(d,"submit",c);n.call(a,function(){m.remove(d,"submit",c)})}();var l=setInterval(function(){a.save(!0)},
6E4*a.draftInterval);n.call(a,function(){clearInterval(l)});f.on("click",a.recover,a);n.call(a,f);a.holder=c;if(d.draft.helpHtml){var k=(new i('<a tabindex="0" hidefocus="hidefocus" class="ks-editor-draft-help ks-editor-triplebutton-off" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable().appendTo(c);k.on("click",function(){k[0].focus();a.helpPopup&&a.helpPopup.get("visible")?a.helpPopup.hide():a._prepareHelp()});k.on("blur",function(){a.helpPopup&&a.helpPopup.hide()});
a.helpBtn=k;n.call(a,k);h.Utils.lazyRun(a,"_prepareHelp","_realHelp")}n.call(a,c)},_prepareHelp:function(){var a=this.editor.get("pluginConfig").draft,a=new i(a.helpHtml||""),b=new i("<div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;fontSize:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
a.append(b);a.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=new e({content:a,prefixCls:"ks-editor-",autoRender:!0,width:a.width()+"px",zIndex:h.baseZIndex(h.zIndexManager.OVERLAY),mask:!1});this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=b},_realHelp:function(){var a=this.helpPopup,b=this.helpBtn,c=a.arrow;a.show();b=b.offset();a.get("el").offset({left:b.left-a.get("el").width()+17,top:b.top-a.get("el").height()-7});c.offset({left:b.left-2,top:b.top-8})},
disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var a=this.draftLimit,b=this.timeTip,c=this.versions,e=this._getDrafts();e.length>a&&e.splice(0,e.length-a);for(var a=[],f,i=0;i<e.length;i++)f=e[i],f=(f.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+d(f.date),a.push({name:f,value:i});c.set("items",a.reverse());b.html(f);k.setItem(this._getSaveKey(),k==window.localStorage?encodeURIComponent(l.stringify(e)):e)},save:function(a){var b=this._getDrafts(),
c=this.editor.get("formatData");c&&(b[b.length-1]&&c==b[b.length-1].content&&(b.length-=1),this.drafts=b.concat({content:c,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var b=this.editor,c=this.versions,e=this._getDrafts(),f=a.newVal;c.reset("value");confirm("\u786e\u8ba4\u6062\u590d "+d(e[f].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(b.execCommand("save"),b.set("data",e[f].content),b.execCommand("save"));a.halt()},destroy:function(){q.call(this)}});return{init:function(a){k.ready?k.ready(function(){c(a)}):c(a)}}},{requires:["editor",
"../localStorage/","overlay","../select/"]});
KISSY.add("editor/plugin/dragUpload/index",function(f,h){var k=f.Node,e=f.Event,j=h.Utils,b=f.DOM;return f.UA.ie?void 0:{init:function(d){function a(a){a=a.originalEvent.target;"img"==b.nodeName(a)&&a.src.match(/^file:\/\//)&&(r[a.src]=a)}function c(a,b){var c=new window.FileReader;c.onload=function(d){var e=a.name,d=d.target.result,f=new XMLHttpRequest;f.open("POST",q,!0);f.onreadystatechange=function(){if(4==f.readyState){if(200==f.status||304==f.status){if(""!=f.responseText){var a=window.JSON.parse(f.responseText);
b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();f.onreadystatechange=null}};e="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+m+'"; filename="'+encodeURIComponent(e)+'"\r\n');e+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";e+=d+"\r\n";n=h.Utils.normParams(n);for(var g in n)n.hasOwnProperty(g)&&(e+="------kissy-editor-yiminghe\r\n",e+='Content-Disposition: form-data; name="'+g+'"\r\n\r\n',e+=n[g]+"\r\n");e+="------kissy-editor-yiminghe--";f.setRequestHeader("Content-Type",
"multipart/form-data, boundary=----kissy-editor-yiminghe");f.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+e.length+"\r\n"+e+"\r\n");c.onload=null};c.readAsBinaryString(a)}var i=d.get("pluginConfig").dragUpload||{},m=i.fileInput||"Filedata",l=i.sizeLimit||Number.MAX_VALUE,n=i.serverParams||{},q=i.serverUrl||"",g=RegExp((i.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),o=d.get("document")[0],r={},t=!1;e.on(o,"dragenter",function(){t||
(e.on(o,"DOMNodeInserted",a),t=!0)});e.on(o,"drop",function(d){e.remove(o,"DOMNodeInserted",a);t=!1;d.halt();var d=d.originalEvent,i,h;f.isEmptyObject(r)?(h=o.elementFromPoint(d.clientX,d.clientY),i=h.lastChild):(f.each(r,function(a){"img"==b.nodeName(a)&&(i=a.nextSibling,h=a.parentNode,b.remove(a))}),r={});d=d.dataTransfer;d.dropEffect="copy";if(d=d.files)for(var m=0;m<d.length;m++){var n=d[m],q=n.size;if(n.name.match(g)&&!(q/1E3>l)){var q=new k("<img src='"+j.debugUrl("theme/tao-loading.gif")+"'/>"),
w=q[0];h.insertBefore(w,i);var x=b.nodeName(w.parentNode);("head"==x||"html"==x)&&b.insertBefore(w,o.body.firstChild);c(n,q)}}});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var c=new (window.BlobBuilder||window.WebKitBlobBuilder),d=a.length,e=new window.Uint8Array(d),f=0;f<d;f++)e[f]=a.charCodeAt(f);c.append(e.buffer);this.send(c.getBlob(b))})}}},{requires:["editor"]});
KISSY.add("editor/plugin/elementPath/index",function(f,h){function k(e){this.cfg=e;this._cache=[];this._init()}var e=f.Node;f.augment(k,{_init:function(){var f=this.cfg.editor;this.holder=new e("<span>");this.holder.appendTo(f.get("statusBarEl"),void 0);f.on("selectionChange",this._selectionChange,this);h.Utils.sourceDisable(f,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(f){var b=this.cfg.editor,d=this.holder,
f=f.path.elements,a,c;a=this._cache;for(c=0;c<a.length;c++)a[c].remove();this._cache=[];for(c=0;c<f.length;c++){a=f[c];var i=a.attr("_ke_real_element_type")||a.nodeName(),h=new e("<a href='javascript(\""+i+"\")' class='ks-editor-element-path'>"+i+"</a>");this._cache.push(h);(function(a){h.on("click",function(c){c.halt();b.focus();setTimeout(function(){b.getSelection().selectElement(a)},50)})})(a);d.prepend(h)}},destroy:function(){this.holder.remove()}});return{init:function(e){var b=new k({editor:e});
e.on("destroy",function(){b.destroy()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/fakeObjects/index",function(f,h){var k=f.Node,e=f.DOM,j=h.Utils.debugUrl("theme/spacer.gif"),b=f.require("htmlparser");f.augment(h,{createFakeElement:function(a,b,d,e,h,n){var q=a.attr("style")||"";a.attr("width")&&(q="width:"+a.attr("width")+"px;"+q);a.attr("height")&&(q="height:"+a.attr("height")+"px;"+q);var g=f.trim(a.attr("class")),a={"class":b+" "+g,src:j,_ke_realelement:encodeURIComponent(h||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:q};n&&delete n.width;
n&&delete n.height;n&&f.mix(a,n,!1);d&&(a._ke_real_element_type=d);e&&(a._ke_resizable=e);return new k("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=e.ELEMENT_NODE)return null;var a=decodeURIComponent(a.attr("_ke_realelement")),b=new k("<div>",null,this.get("document")[0]);b.html(a);return b.first().remove()}});var d={tags:{$:function(a){var c=a.getAttribute("_ke_realelement"),d;c&&(d=(new b.Parser(decodeURIComponent(c))).parse());if(c=d&&d.childNodes[0]){if(d=
a.getAttribute("style")){var e=/(?:^|\s)width\s*:\s*(\d+)/i.exec(d),a=e&&e[1];d=(e=/(?:^|\s)height\s*:\s*(\d+)/i.exec(d))&&e[1];a&&c.setAttribute("width",a);d&&c.setAttribute("height",d)}return c}}}};return{init:function(a){var c=(a=a.htmlDataProcessor)&&a.htmlFilter;a.createFakeParserElement||(c&&c.addRules(d),f.mix(a,{createFakeParserElement:function(a,c,d,e,h){var g;g=new b.BasicWriter;a.writeHtml(g);g=g.getHtml();var k=a.getAttribute("style")||"";a.getAttribute("width")&&(k="width:"+a.getAttribute("width")+
"px;"+k);a.getAttribute("height")&&(k="height:"+a.getAttribute("height")+"px;"+k);var r=f.trim(a.getAttribute("class")),a={"class":c+" "+r,src:j,_ke_realelement:encodeURIComponent(g),_ke_real_node_type:a.nodeType+"",style:k,align:a.getAttribute("align")||""};h&&delete h.width;h&&delete h.height;h&&f.mix(a,h,!1);d&&(a._ke_real_element_type=d);e&&(a._ke_resizable="_ke_resizable");return new b.Tag("img",a)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flashBridge/index",function(f,h,k){function e(a){this._init(a)}function j(a){var c=f.isString(a)?a.match(/(\d)+/g):a;f.isArray(c)&&(a=parseFloat(c[0]+"."+b(c[1],3)+b(c[2],5)));return a||0}function b(a,b){for(var c=(a+"").length;c++<b;)a="0"+a;return a}var d={};f.augment(e,f.EventTarget,{_init:function(a){var b=f.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var c=a.flashVars,e=a.params;f.mix(a.attrs,{id:b,width:"100%",height:"100%"},
!1);f.mix(e,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);f.mix(c,{shareData:!1,useCompression:!1},!1);e={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(e={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});f.mix(c,e);d[b]=this;this.id=b;this.swf=k.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var b=this,c=0;c<a.length;c++)(function(a){b[a]=function(){return b._callSWF(a,f.makeArray(arguments))}})(a[c])},
_callSWF:function(a,b){b=b||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,b)}catch(c){var d="";0!==b.length&&(d="'"+b.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+d+");"))(this)}},_eventHandler:function(a){var b=a.type;"log"!==b&&b&&this.fire(b,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete d[this.id]}});e.EventHandler=function(a,b){var c=d[a];c&&setTimeout(function(){c._eventHandler.call(c,b)},100)};h.FlashBridge=
e;var a=f.UA,c,i,m=!0;a.fpv=function(a){if(a||m){m=!1;var b;if(navigator.plugins&&navigator.mimeTypes.length)b=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{b=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){}c=!b?void 0:b.match(/(\d)+/g);i=j(c)}return c};a.fpvGEQ=function(b,c){m&&a.fpv(c);return!!i&&i>=j(b)};return e},{requires:["editor","../flashCommon/utils"]});
KISSY.add("editor/plugin/flashCommon/baseClass",function(f,h,k,e,j,b){function d(){d.superclass.constructor.apply(this,arguments);this._init()}var a=f.Node;d.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},contextMenuHandlers:{}};f.extend(d,f.Base,{_init:function(){var a=this,b=a.get("cls"),d=a.get("editor"),j=a.get("contextMenuHandlers");k.register({editor:d,filter:"."+b,width:"120px",handlers:j});e.register({filter:function(a){return a.hasClass(b,void 0)&&a},editor:d,init:function(){var b=this,e=b.get("contentEl");
e.html(f.substitute(' <a class="ks-editor-bubbleview-url" target="_blank" href="#">{label}</a>   |    <span class="ks-editor-bubbleview-link ks-editor-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubbleview-link ks-editor-bubbleview-remove">\u5220\u9664</span>',{label:a.get("label")}));var g=e.one(".ks-editor-bubbleview-url"),i=e.one(".ks-editor-bubbleview-change"),j=e.one(".ks-editor-bubbleview-remove");h.Utils.preventFocus(e);i.on("click",function(d){a.show(b.selectedEl);d.halt()});j.on("click",
function(a){if(f.UA.webkit){var c=d.getSelection().getRanges();if(c=c&&c[0])c.collapse(!0),c.select()}b.selectedEl.remove();b.hide();d.notifySelectionChange();a.halt()});b.on("show",function(){var d=b.selectedEl;d&&a._updateTip(g,d)})}});d.docReady(function(){d.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(a){return b.getUrl(a)},_updateTip:function(a,b){var d=this.get("editor").restoreRealElement(b);d&&(d=this._getFlashUrl(d),a.attr("href",d))},_dbClick:function(b){var d=new a(b.target);
"img"===d.nodeName()&&d.hasClass(this.get("cls"),void 0)&&(this.show(d),b.halt())},show:function(a){var b=this.get("editor");j.useDialog(b,this.get("type")+"/dialog",a)}});return d},{requires:["editor","../contextmenu/","../bubbleview/","../dialogLoader/","./utils"]});
KISSY.add("editor/plugin/flashCommon/utils",function(f){var h=f.DOM,k=f.Node,e=f.UA,j={insertFlash:function(b,d,a,c,e){d=j.createSWF(d,{attrs:a},b.get("document")[0]);a=b.createFakeElement(d.el,c||"ke_flash",e||"flash",!0,d.html,a);b.insertElement(a);return a},isFlashEmbed:function(b){return"application/x-shockwave-flash"==b.getAttribute("type")||/\.swf(?:$|\?)/i.test(b.getAttribute("src")||"")},getUrl:function(b){var d="";if("object"==b.nodeName())for(var b=b[0].childNodes,a=0;a<b.length;a++)1==
b[a].nodeType&&("movie"==(h.attr(b[a],"name")||"").toLowerCase()?d=h.attr(b[a],"value"):"embed"==h.nodeName(b[a])?d=h.attr(b[a],"src"):"object"==h.nodeName(b[a])&&(d=h.attr(b[a],"data")));else"embed"==b.nodeName()&&(d=b.attr("src"));return d},createSWF:function(b,d,a){var c=d.attrs||{},e=d.flashVars,j="",h="",d=d.params||{},n="",a=a||document;f.mix(c,{wmode:"transparent"});for(var q in c)c.hasOwnProperty(q)&&(j+=q+"='"+c[q]+"' ");f.mix(d,{quality:"high",movie:b,wmode:"transparent"});for(var g in d)d.hasOwnProperty(g)&&
(h+="<param name='"+g+"' value='"+d[g]+"'/>");if(e){for(var o in e)e.hasOwnProperty(o)&&(n+="&"+o+"="+encodeURIComponent(e[o]));n=n.substring(1)}b="<object "+j+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+h+(n?'<param name="flashVars" value="'+n+'"/>':"")+"<embed "+j+" "+(n?'FlashVars="'+n+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+b+'"  type="application/x-shockwave-flash"/></object>';return{el:new k(b,null,a),html:b}},createSWFRuntime2:function(b,
d,a){var a=a||document,c=(new k("<div style='width:0;height:0;overflow:hidden;'>",null,a)).appendTo(a.body),c=j.createSWF.apply(this,arguments).el.appendTo(c);e.ie||(c=c.one("object"));return c[0]},createSWFRuntime:function(b,d,a){var c=d.attrs||{},i=d.flashVars||{},j=d.params||{},l="",n="",q="",a=a||document;c.id=c.id||f.guid("ks-editor-runtimeflash-");for(var g in c)c.hasOwnProperty(g)&&(l+=g+"='"+c[g]+"' ");for(var o in j)j.hasOwnProperty(o)&&(n+="<param name='"+o+"' value='"+j[o]+"'/>");for(var r in i)i.hasOwnProperty(r)&&
(q+="&"+r+"="+encodeURIComponent(i[r]));var q=q.substring(1),b=e.ie?"<object "+l+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+n+'<param name="movie" value="'+b+'" />'+(q?'<param name="flashVars" value="'+q+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+b+"' "+l+">"+n+(q?'<param name="flashVars" value="'+q+'"/>':"")+"</object>",t=d.holder;t||(t=(new k("<div style='"+(d.style?d.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,a)).appendTo(a.body),
setTimeout(function(){t.offset({left:h.scrollLeft(),top:h.scrollTop()})},100));t.html(b);return a.getElementById(c.id)}};return j});
KISSY.add("editor/plugin/flash/index",function(f,h,k,e){return{init:function(f){var b=f.htmlDataProcessor;b.dataFilter.addRules({tags:{object:function(a){var d;if(!a.getAttribute("classid")){var f=a.childNodes;for(d=0;d<f.length;d++)if("embed"==f[d].nodeName)if(e.isFlashEmbed(f[d][d]))break;else return b.createFakeParserElement(a,"ke_flash","flash",!0);return null}return b.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return e.isFlashEmbed(a)?b.createFakeParserElement(a,"ke_flash",
"flash",!0):null}}},5);var d=f.get("pluginConfig").flash||{},a=new k({editor:f,cls:"ke_flash",type:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var b=this.selectedEl;b&&a.show(b)}}});!1!==d.btn&&f.addButton("flash",{tooltip:"\u63d2\u5165Flash",mode:h.WYSIWYG_MODE},{offClick:function(){a.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});
KISSY.add("editor/plugin/fontFamily/cmd",function(f,h,k){var e={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(f){k.addSelectCmd(f,"fontFamily",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontFamily/index",function(f,h,k,e){return{init:function(j){e.init(j);var b=j.get("pluginConfig").fontFamily,b=b||{};f.mix(b,{children:[{content:"\u5b8b\u4f53",value:"SimSun"},{content:"\u9ed1\u4f53",value:"SimHei"},{content:"\u96b6\u4e66",value:"LiSu"},{content:"\u6977\u4f53",value:"KaiTi_GB2312"},{content:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{content:"Georgia",value:"Georgia"},{content:"Times New Roman",value:"Times New Roman"},{content:"Impact",value:"Impact"},{content:"Courier New",value:"Courier New"},{content:"Arial",
value:"Arial"},{content:"Verdana",value:"Verdana"},{content:"Tahoma",value:"Tahoma"}],width:"130px"},!1);f.each(b.children,function(b){var a=b.elAttrs||{},c=b.value;a.style=a.style||"";a.style+=";font-family:"+c;b.elAttrs=a});j.addSelect("fontFamily",{cmdType:"fontFamily",defaultCaption:"\u5b57\u4f53",width:130,mode:h.WYSIWYG_MODE,menu:{width:b.width,children:b.children}},void 0,k.Select)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/fontSize/cmd",function(f,h,k){var e={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(f){k.addSelectCmd(f,"fontSize",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/fontSize/index",function(f,h,k,e){return{init:function(j){e.init(j);var b=j.get("pluginConfig").fontSize,b=b||{};f.mix(b,{children:function(b){var a=[];f.each(b,function(b){a.push({content:b,value:b})});return a}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(",")),width:"55px"},!1);j.addSelect("fontSize",{cmdType:"fontSize",defaultCaption:"\u5927\u5c0f",width:"55px",mode:h.WYSIWYG_MODE,menu:{width:b.width,children:b.children}},void 0,k.Select)}}},{requires:["editor",
"../font/ui","./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(f,h){var k=h.Utils.getQueryCmd;return{addButtonCmd:function(e,f,b){var d=k(f);e.hasCommand(f)||(e.addCommand(f,{exec:function(a,c){var d=a.get("document")[0];a.execCommand("save");c||void 0===c?b.apply(d):b.remove(d);a.execCommand("save");a.notifySelectionChange()}}),e.addCommand(d,{exec:function(a,c){return b.checkActive(c)}}))},addSelectCmd:function(e,f,b){var d=k(f);e.hasCommand(f)||(e.addCommand(f,{exec:function(a,c,d){var c=new h.Style(b,{value:c}),
e=a.get("document")[0];a.execCommand("save");void 0===d||d?c.apply(e):c.remove(e);a.execCommand("save")}}),e.addCommand(d,{exec:function(a,c,d){return(new h.Style(b,{value:c})).checkElementRemovable(d,!0)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(f,h,k,e){var j=h.Utils.getQueryCmd,f=e.extend({click:function(b){var d=b.target.get("value"),a=this.get("cmdType"),b=b.prevTarget&&b.prevTarget.get("value"),c=this.get("editor");c.focus();d==b?c.execCommand(a,d,!1):c.execCommand(a,d)},selectionChange:function(b){var d=b.path,b=j(this.get("cmdType")),a=this.get("menu"),a=a.get&&a.get("children"),c=this.get("editor"),d=d.elements;if(a){for(var e=0,f;e<d.length;e++){f=d[e];for(var h=0;h<a.length;h++){var k=
a[h].get("value");if(c.execCommand(b,k,f)){this.set("value",k);return}}}this.set("value",null)}}});return{Button:k.Toggle.extend({offClick:function(){var b=this.get("cmdType"),d=this.get("editor");d.execCommand(b);d.focus()},onClick:function(){var b=this.get("cmdType"),d=this.get("editor");d.execCommand(b,!1);d.focus()},selectionChange:function(b){var d=this.get("editor"),a=j(this.get("cmdType"));d.execCommand(a,b.path)?this.set("checked",!0):this.set("checked",!1)}},{ATTRS:{mode:{value:h.WYSIWYG_MODE}}}),
Select:f}},{requires:["editor","../button/","../select/"]});KISSY.add("editor/plugin/foreColor/cmd",function(f,h){var k={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(e){return!("a"==e.nodeName()||e.all("a").length)}};return{init:function(e){e.hasCommand("foreColor")||e.addCommand("foreColor",{exec:function(e,b){e.execCommand("save");h.applyColor(e,b,k);e.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/foreColor/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("foreColor",{cmdType:"foreColor",tooltip:"\u6587\u672c\u989c\u8272"},void 0,k)}}},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(f,h){return{init:function(f){if(!f.hasCommand("heading")){f.addCommand("heading",{exec:function(e,b){e.execCommand("save");(new h.Style({element:b})).apply(e.get("document")[0]);e.execCommand("save")}});var e=h.Utils.getQueryCmd("heading");f.addCommand(e,{exec:function(e,b,d){return(new h.Style({element:d})).checkActive(b)}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(f,h,k){return{init:function(e){k.init(e);var f=[],b={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},d={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},a;for(a in b)b.hasOwnProperty(a)&&f.push({content:a,value:b[a],elAttrs:{style:"font-size:"+d[b[a]]}});e.addSelect("heading",{defaultCaption:"\u6807\u9898",width:"120px",menu:{width:"120px",children:f},mode:h.WYSIWYG_MODE},{click:function(a){var b=a.target.get("value"),
a=a.prevTarget&&a.prevTarget.get("value");b!=a?e.execCommand("heading",b):(e.execCommand("heading","p"),this.set("value","p"))},selectionChange:function(a){var a=a.path,b=h.Utils.getQueryCmd("heading"),f;for(f in d)if(d.hasOwnProperty(f)&&e.execCommand(b,a,f)){this.set("value",f);break}}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(f,h,k,e,j,b){var d=f.UA,a=f.Node,c=f.all,i=f.Event,m=function(a){a=c(a);return"img"===a.nodeName(a)&&!/(^|\s+)ke_/.test(a[0].className)&&a};return{init:function(f){function k(a){b.useDialog(f,"image/dialog",a)}f.addButton("image",{tooltip:"\u63d2\u5165\u56fe\u7247",mode:h.WYSIWYG_MODE},{offClick:function(){k(null)}});j.register({editor:f,filter:m,width:"120px",handlers:{"\u56fe\u7247\u5c5e\u6027":function(){var a=m(this.selectedEl);a&&k(c(a))},"\u63d2\u5165\u65b0\u884c":function(){var b=f.get("document")[0],c=
new a(b.createElement("p"));d.ie||c._4e_appendBogus(void 0);b=new h.Range(b);b.setStartAfter(this.selectedEl);b.select();f.insertElement(c);b.moveToElementEditablePosition(c,1);b.select()}}});f.docReady(function(){i.on(f.get("document")[0],"dblclick",function(a){a.halt();a=c(a.target);m(a)&&k(a)})});e.register({editor:f,filter:m,init:function(){var a=this,b=a.get("contentEl");b.html('<a class="ks-editor-bubbleview-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="ks-editor-bubbleview-link ks-editor-bubbleview-change" href="#">\u7f16\u8f91</a>  |  <a class="ks-editor-bubbleview-link ks-editor-bubbleview-remove" href="#">\u5220\u9664</a>');
var c=b.one(".ks-editor-bubbleview-url"),e=b.one(".ks-editor-bubbleview-change"),i=b.one(".ks-editor-bubbleview-remove");h.Utils.preventFocus(b);e.on("click",function(b){k(a.selectedEl);b.halt()});i.on("click",function(b){if(d.webkit){var c=f.getSelection().getRanges();c&&c[0]&&(c[0].collapse(),c[0].select())}a.selectedEl.remove();a.hide();f.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr("_ke_saved_src")||b.attr("src"),c.attr("href",b))})}})}}},{requires:["editor",
"../button/","../bubbleview/","../contextmenu/","../dialogLoader/"]});KISSY.add("editor/plugin/indent/cmd",function(f,h,k){var e=k.addCommand;return{init:function(f){e(f,"indent")}}},{requires:["editor","../dentUtils/cmd"]});KISSY.add("editor/plugin/indent/index",function(f,h,k){return{init:function(e){k.init(e);e.addButton("indent",{tooltip:"\u589e\u52a0\u7f29\u8fdb\u91cf ",mode:h.WYSIWYG_MODE},{offClick:function(){e.execCommand("indent");e.focus()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(f,h,k){var e=new h.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(f){k.addButtonCmd(f,"italic",e)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/italic/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("italic",{cmdType:"italic",tooltip:"\u659c\u4f53 "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justifyCenter/cmd",function(f,h){return{init:function(f){h.addCommand(f,"justifyCenter","center")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyCenter/index",function(f,h,k){function e(){var e=this.get("editor");e.execCommand("justifyCenter");e.focus()}return{init:function(f){k.init(f);f.addButton("justifyCenter",{tooltip:"\u5c45\u4e2d\u5bf9\u9f50",checkable:!0,mode:h.WYSIWYG_MODE},{onClick:e,offClick:e,selectionChange:function(b){var d=h.Utils.getQueryCmd("justifyCenter");f.execCommand(d,b.path)?this.set("checked",!0):this.set("checked",!1)}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyLeft/cmd",function(f,h){return{init:function(f){h.addCommand(f,"justifyLeft","left")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyLeft/index",function(f,h,k){function e(){var e=this.get("editor");e.execCommand("justifyLeft");e.focus()}return{init:function(f){k.init(f);f.addButton("justifyLeft",{tooltip:"\u5de6\u5bf9\u9f50",checkable:!0,mode:h.WYSIWYG_MODE},{onClick:e,offClick:e,selectionChange:function(b){var d=h.Utils.getQueryCmd("justifyLeft");f.execCommand(d,b.path)?this.set("checked",!0):this.set("checked",!1)}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyRight/cmd",function(f,h){return{init:function(f){h.addCommand(f,"justifyRight","right")}}},{requires:["../justifyUtils/cmd"]});
KISSY.add("editor/plugin/justifyRight/index",function(f,h,k){function e(){var e=this.get("editor");e.execCommand("justifyRight");e.focus()}return{init:function(f){k.init(f);f.addButton("justifyRight",{tooltip:"\u53f3\u5bf9\u9f50",checkable:!0,mode:h.WYSIWYG_MODE},{onClick:e,offClick:e,selectionChange:function(b){var d=h.Utils.getQueryCmd("justifyRight");f.execCommand(d,b.path)?this.set("checked",!0):this.set("checked",!1)}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justifyUtils/cmd",function(f,h){var k=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(e,f,b){e.hasCommand(f)||(e.addCommand(f,{exec:function(d){d.execCommand("save");for(var a=d.getSelection(),c=a.createBookmarks(),e=a.getRanges(),f,h,j=e.length-1;0<=j;j--){f=e[j].createIterator();for(f.enlargeBr=!0;h=f.getNextParagraph();)h.removeAttr("align"),(h.css("text-align").replace(k,"")||"left")==b?h.css("text-align",""):h.css("text-align",b)}a.selectBookmarks(c);d.execCommand("save");
d.notifySelectionChange()}}),e.addCommand(h.Utils.getQueryCmd(f),{exec:function(d,a){var c=a.block||a.blockLimit;return!c||"body"===c.nodeName()?!1:(c.css("text-align").replace(k,"")||"left")==b}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(f,h,k,e,j){function b(a){a=d(a);return a.closest("a",void 0)}var d=f.all;return{init:function(a){a.addButton("link",{tooltip:"\u63d2\u5165\u94fe\u63a5",mode:h.WYSIWYG_MODE},{offClick:function(){j.useDialog(a,"link/dialog",void 0)}});k.register({editor:a,filter:b,init:function(){var b=this,d=b.get("contentEl");d.html('<a href=""  target="_blank" class="ks-editor-bubbleview-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="ks-editor-bubbleview-link ks-editor-bubbleview-change">\u7f16\u8f91</span>   |    <span class="ks-editor-bubbleview-link ks-editor-bubbleview-remove">\u53bb\u9664</span>');
var f=d.one(".ks-editor-bubbleview-url"),k=d.one(".ks-editor-bubbleview-change"),n=d.one(".ks-editor-bubbleview-remove");h.Utils.preventFocus(d);k.on("click",function(d){j.useDialog(a,"link/dialog",b.selectedEl);d.halt()});n.on("click",function(d){e.removeLink(a,b.selectedEl);d.halt()});b.on("show",function(){var a=b.selectedEl;a&&(a=a.attr(e._ke_saved_href)||a.attr("href"),f.html(a),f.attr("href",a))})}})}}},{requires:["editor","../bubbleview/","./utils","../dialogLoader/"]});
KISSY.add("editor/plugin/link/utils",function(f,h){var k=f.Node,e=h.Style,j={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(b,d){b.execCommand("save");var a=b.getSelection(),c=a.getRanges()[0];if(c&&c.collapsed)c=a.createBookmarks(),d._4e_remove(!0),a.selectBookmarks(c);else if(c){for(var a=d[0],c=a.attributes,f={},h=0;h<c.length;h++){var k=c[h];k.specified&&(f[k.name]=k.value)}a.style.cssText&&(f.style=a.style.cssText);
(new e(j,f)).remove(b.get("document")[0])}b.execCommand("save");b.notifySelectionChange()},applyLink:function(b,d,a){d._ke_saved_href=d.href;a?(b.execCommand("save"),a.attr(d)):(a=(a=b.getSelection())&&a.getRanges()[0],!a||a.collapsed?(d=new k("<a>"+d.href+"</a>",d,b.get("document")[0]),b.insertElement(d)):(b.execCommand("save"),(new e(j,d)).apply(b.get("document")[0])));b.execCommand("save");b.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/listUtils/btn",function(f,h,k){function e(){var e=this.get("editor"),b=this.get("cmdType");e.execCommand(b);e.focus()}return k.Toggle.extend({offClick:e,onClick:e,selectionChange:function(e){var b=this.get("editor"),d=h.Utils.getQueryCmd(this.get("cmdType"));b.execCommand(d,e.path)?this.set("checked",!0):this.set("checked",!1)}},{ATTRS:{mode:{value:h.WYSIWYG_MODE}}})},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/listUtils/cmd",function(f,h,k,e){function j(a){this.type=a}function b(a,b){var c,e,f=b.blockLimit,i=b.elements;if(!f)return!1;if(i)for(var h=0;h<i.length&&(c=i[h])&&c[0]!==f[0];h++)if(d[e=c.nodeName()]&&e==a)return!0;return!1}var d={ol:"insertOrderedList",ul:"insertUnorderedList"},a=h.RANGE,c=h.ElementPath,i=h.Walker,m=f.UA,l=f.Node,n=f.DOM,q=/^h[1-6]$/;j.prototype={changeListType:function(a,b,c,d){for(var f=k.listToArray(b.root,c,e,e,e),i=[],a=0;a<b.contents.length;a++){var h=
b.contents[a];if((h=h.closest("li",e))&&h[0]&&!h.data("list_item_processed"))i.push(h),h._4e_setMarker(c,"list_item_processed",!0,e)}h=new l(b.root[0].ownerDocument.createElement(this.type));for(a=0;a<i.length;a++){var j=i[a].data("listarray_index");f[j].parent=h}for(var c=k.arrayToList(f,c,null,"p"),m,f=c.listNode.childNodes.length,a=0;a<f&&(m=new l(c.listNode.childNodes[a]));a++)m.nodeName()==this.type&&d.push(m);b.root.before(c.listNode);b.root.remove()},createList:function(a,b,c){var d=b.contents,
a=b.root[0].ownerDocument,f=[];if(1==d.length&&d[0][0]===b.root[0]){var i=new l(a.createElement("div"));d[0][0].nodeType!=n.TEXT_NODE&&d[0]._4e_moveChildren(i,e,e);d[0][0].appendChild(i[0]);d[0]=i}b=b.contents[0].parent();for(i=0;i<d.length;i++)b=b._4e_commonAncestor(d[i].parent(),e);for(i=0;i<d.length;i++)for(var h=d[i],j;j=h.parent();){if(j[0]===b[0]){f.push(h);break}h=j}if(!(1>f.length)){d=new l(f[f.length-1][0].nextSibling);i=new l(a.createElement(this.type));for(c.push(i);f.length;)c=f.shift(),
h=new l(a.createElement("li")),q.test(c.nodeName())?h[0].appendChild(c[0]):(c._4e_copyAttributes(h,e,e),c._4e_moveChildren(h,e,e),c.remove()),i[0].appendChild(h[0]),m.ie||h._4e_appendBogus(e);d[0]?i.insertBefore(d,e):b.append(i)}},removeList:function(a,b,c){function d(c){if((y=new l(q[c?"firstChild":"lastChild"]))&&!(y[0].nodeType==n.ELEMENT_NODE&&y._4e_isBlockBoundary(e,e))&&(w=b.root[c?"prev":"next"](i.whitespaces(!0),1))&&!(y[0].nodeType==n.ELEMENT_NODE&&w._4e_isBlockBoundary({br:1},e)))y[c?"before":
"after"](a.get("document")[0].createElement("br"))}for(var f=k.listToArray(b.root,c,e,e,e),h=[],j=0;j<b.contents.length;j++){var m=b.contents[j];if((m=m.closest("li",e))&&!m.data("list_item_processed"))h.push(m),m._4e_setMarker(c,"list_item_processed",!0,e)}m=null;for(j=0;j<h.length;j++)m=h[j].data("listarray_index"),f[m].indent=-1;for(j=m+1;j<f.length;j++)if(f[j].indent>Math.max(f[j-1].indent,0)){h=f[j-1].indent+1-f[j].indent;for(m=f[j].indent;f[j]&&f[j].indent>=m;)f[j].indent+=h,j++;j--}var q=k.arrayToList(f,
c,null,"p").listNode,y,w;d(!0);d(e);b.root.before(q);b.root.remove()},exec:function(f){var j=f.getSelection(),k=j&&j.getRanges();if(k&&!(1>k.length)){for(var m=j.getStartElement(),m=new h.ElementPath(m),l=b(this.type,m),m=j.createBookmarks(!0),q=[],p={};0<k.length;){var v=k.shift(),u=v.getBoundaryNodes(),y=u.startNode,w=u.endNode;y[0].nodeType==n.ELEMENT_NODE&&"td"==y.nodeName()&&v.setStartAt(u.startNode,a.POSITION_AFTER_START);w[0].nodeType==n.ELEMENT_NODE&&"td"==w.nodeName()&&v.setEndAt(u.endNode,
a.POSITION_BEFORE_END);v=v.createIterator();for(v.forceBrBreak=!1;u=v.getNextParagraph();)if(!u.data("list_block")){u._4e_setMarker(p,"list_block",1,e);for(var w=new c(u),x=w.elements,B=null,C=!1,B=w.blockLimit,A,y=x.length-1;0<=y&&(A=x[y]);y--)if(d[A.nodeName()]&&B.contains(A)){B.removeData("list_group_object");(y=A.data("list_group_object"))?y.contents.push(u):(y={root:A,contents:[u]},q.push(y),A._4e_setMarker(p,"list_group_object",y,e));C=!0;break}C||(w=B||w.block,w.data("list_group_object")?w.data("list_group_object").contents.push(u):
(y={root:w,contents:[u]},w._4e_setMarker(p,"list_group_object",y,e),q.push(y)))}}for(k=[];0<q.length;)y=q.shift(),l?d[y.root.nodeName()]&&this.removeList(f,y,p):d[y.root.nodeName()]?this.changeListType(f,y,p,k):(h.Utils.clearAllMarkers(p),this.createList(f,y,k));for(var F=this,y=0;y<k.length;y++)B=k[y],f=function(a,b){var c=b[a?"prev":"next"](i.whitespaces(!0),1);c&&c[0]&&c.nodeName()==F.type&&(c.remove(),c._4e_moveChildren(b,a?!0:!1,e))},f(e,B),f(!0,B);h.Utils.clearAllMarkers(p);j.selectBookmarks(m)}}};
new j("ul");new j("ol");return{ListCommand:j,queryActive:b}},{requires:["editor","../listUtils/"]});
KISSY.add("editor/plugin/listUtils/index",function(f){var h={ol:1,ul:1},k=f.Node,e=f.DOM,j=f.UA,b={listToArray:function(d,a,c,f,j){if(!h[d.nodeName()])return[];f||(f=0);c||(c=[]);for(var l=0,n=d[0].childNodes.length;l<n;l++){var q=new k(d[0].childNodes[l]);if("li"==q.nodeName()){var g={parent:d,indent:f,element:q,contents:[]};j?g.grandparent=j:(g.grandparent=d.parent(),g.grandparent&&"li"==g.grandparent.nodeName()&&(g.grandparent=g.grandparent.parent()));a&&q._4e_setMarker(a,"listarray_index",c.length,
void 0);c.push(g);for(var o=0,r=q[0].childNodes.length,t;o<r;o++)t=new k(q[0].childNodes[o]),t[0].nodeType==e.ELEMENT_NODE&&h[t.nodeName()]?b.listToArray(t,a,c,f+1,g.grandparent):g.contents.push(t)}}return c},arrayToList:function(d,a,c,f){c||(c=0);if(!d||d.length<c+1)return null;for(var m=d[c].parent[0].ownerDocument,l=m.createDocumentFragment(),n=null,q=c,g=Math.max(d[c].indent,0),o=null;;){var r=d[q];if(r.indent==g){if(!n||d[q].parent.nodeName()!=n.nodeName())n=d[q].parent.clone(!1),l.appendChild(n[0]);
for(var o=n[0].appendChild(r.element.clone(!1)[0]),t=0;t<r.contents.length;t++)o.appendChild(r.contents[t].clone(!0)[0]);q++}else if(r.indent==Math.max(g,0)+1)q=b.arrayToList(d,null,q,f),o.appendChild(q.listNode),q=q.nextIndex;else if(-1==r.indent&&!c&&r.grandparent){h[r.grandparent.nodeName()]?o=r.element.clone(!1)[0]:"td"!=r.grandparent.nodeName()?(o=m.createElement(f),r.element._4e_copyAttributes(new k(o))):o=m.createDocumentFragment();for(t=0;t<r.contents.length;t++)n=r.contents[t].clone(!0),
o.nodeType==e.DOCUMENT_FRAGMENT_NODE&&r.element._4e_copyAttributes(new k(n)),o.appendChild(n[0]);o.nodeType==e.DOCUMENT_FRAGMENT_NODE&&q!=d.length-1&&(o.lastChild&&o.lastChild.nodeType==e.ELEMENT_NODE&&"_moz"==o.lastChild.getAttribute("type")&&e._4e_remove(o.lastChild),e._4e_appendBogus(o));o.nodeType==e.ELEMENT_NODE&&e.nodeName(o)==f&&o.firstChild&&(e._4e_trim(o),n=o.firstChild,n.nodeType==e.ELEMENT_NODE&&e._4e_isBlockBoundary(n)&&(n=m.createDocumentFragment(),e._4e_moveChildren(o,n),o=n));n=e.nodeName(o);
!j.ie&&("div"==n||"p"==n)&&e._4e_appendBogus(o);l.appendChild(o);n=null;q++}else return null;if(d.length<=q||Math.max(d[q].indent,0)<g)break}if(a)for(d=new k(l.firstChild);d&&d[0];)d[0].nodeType==e.ELEMENT_NODE&&d._4e_clearMarkers(a,!0),d=d._4e_nextSourceNode();return{listNode:l,nextIndex:q}}};return b},{requires:["editor"]});
KISSY.add("editor/plugin/localStorage/index",function(f,h,k,e){if(!f.UA.ie&&window.localStorage)return window.localStorage;var j=h.Utils.debugUrl("plugin/localStorage/swfstore.swf?t="+ +new Date),b=new e({movie:j,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});b.swf.height=138;var d=new k({width:"0px",prefixCls:"ks-editor-",elStyle:{overflow:"hidden"},content:"<h1 style='border:1px solid black;border-bottom:none;background:white;text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",
zIndex:h.baseZIndex(h.zIndexManager.STORE_FLASH_SHOW)});d.render();d.get("contentEl").append(b.swf);d.center();d.show();b.on("pending",function(){d.set("width",215);d.center();d.show();setTimeout(function(){b.retrySave()},1E3)});b.on("save",function(){d.set("width",0)});var a=b.setItem;f.mix(b,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(b,d){this.lastSave={k:b,v:d};a.call(this,b,d)}});b.on("contentReady",
function(){b._ready=1});return b},{attach:!1,requires:["editor","overlay","../flashBridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(f,h){function k(a){this.editor=a}var e=f.UA,j=e.ie,b=document,d=f.Node,a=f.Event,c=f.DOM,i;f.augment(k,{restoreWindow:function(){var b=this,c=b.editor;!1!==c.fire("beforeRestoreWindow")&&b._resize&&(a.remove(window,"resize",b._resize),b._resize=0,b._saveEditorStatus(),b._restoreState(),setTimeout(function(){b._restoreEditorStatus();c.notifySelectionChange();c.fire("restoreWindow")},30))},_restoreState:function(){var a=this.editor,d=this._savedParents;
if(d){for(var e=0;e<d.length;e++){var f=d[e];f.el.css("position",f.position)}this._savedParents=null}a.get("iframeWrapEl").css({height:this.iframeHeight});a.get("textarea").css({height:this.iframeHeight});c.css(b.body,{width:"",height:"",overflow:""});b.documentElement.style.overflow="";a=a.get("el")[0].style;a.position="static";a.width=this.editorElWidth;i.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>j&&this.editor.get("toolBarEl").removeClass("ks-editor-toolbar-padding",
void 0)},_saveSate:function(){var a=this.editor,b=[],d=a.get("el");this.iframeHeight=a.get("iframeWrapEl").style("height");this.editorElWidth=d.style("width");this.scrollLeft=c.scrollLeft();this.scrollTop=c.scrollTop();window.scrollTo(0,0);for(a=d.parent();a;)d=a.css("position"),"static"!=d&&(b.push({el:a,position:d}),a.css("position","static")),a=a.parent();this._savedParents=b;8>j&&this.editor.get("toolBarEl").addClass("ks-editor-toolbar-padding",void 0)},_saveEditorStatus:function(){var a=this.editor;
this.savedRanges=null;e.gecko&&a.__iframeFocus&&(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;e.gecko&&a.activateGecko();c&&b&&b.selectRanges(c);a.__iframeFocus&&b&&(a=b.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(a){var d=this.editor,e=d.get("el"),f=c.viewportHeight(),g=c.viewportWidth(),k=d.get("statusBarEl")?d.get("statusBarEl")[0].offsetHeight:0,r=d.get("toolBarEl")[0].offsetHeight;
j?b.body.style.overflow="hidden":c.css(b.body,{width:0,height:0,overflow:"hidden"});b.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:h.baseZIndex(h.zIndexManager.MAXIMIZE),width:g+"px"});i.css({zIndex:h.baseZIndex(h.zIndexManager.MAXIMIZE-5),height:f+"px",width:g+"px"});e.offset({left:0,top:0});i.css({left:0,top:0});d.get("iframeWrapEl").css({height:f-k-r+"px"});d.get("textarea").css({height:f-k-r+"px"});!0!==a&&arguments.callee.call(this,!0)},_real:function(){var b=this,
c=b.editor;b._resize||(b._saveEditorStatus(),b._saveSate(),b._maximize(),b._resize||(b._resize=f.buffer(function(){b._maximize();c.fire("maximizeWindow")},100)),a.on(window,"resize",b._resize),setTimeout(function(){b._restoreEditorStatus();c.notifySelectionChange();c.fire("maximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(i||(i=(new d("<iframe  class='ks-editor-maximize-shim' style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(b.body,
void 0)),this._real())},destroy:function(){this._resize&&(a.remove(window,"resize",this._resize),this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var b=new k(a);a.addCommand("maximizeWindow",{exec:function(){b.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){b.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(f,h,k){return{init:function(e){k.init(e);e.addButton("maximize",{tooltip:"\u5168\u5c4f",checkable:!0},{onClick:function(){e.execCommand("restoreWindow");this.set("tooltip","\u5168\u5c4f");this.set("contentCls","maximize");e.focus()},offClick:function(){e.execCommand("maximizeWindow");this.set("tooltip","\u53d6\u6d88\u5168\u5c4f");this.set("contentCls","restore");e.focus()}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/multipleUpload/index",function(f,h,k){return{init:function(e){e.addButton("multipleUpload",{tooltip:"\u6279\u91cf\u63d2\u56fe",mode:h.WYSIWYG_MODE},{offClick:function(){k.useDialog(e,"multipleUpload/dialog")}})}}},{requires:["editor","../dialogLoader/"]});
KISSY.add("editor/plugin/orderedList/cmd",function(f,h,k){var e=k.queryActive,j=new k.ListCommand("ol");return{init:function(b){b.hasCommand("insertOrderedList")||b.addCommand("insertOrderedList",{exec:function(a){j.exec(a)}});var d=h.Utils.getQueryCmd("insertOrderedList");b.hasCommand(d)||b.addCommand(d,{exec:function(a,b){return e("ol",b)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/orderedList/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("orderedList",{cmdType:"insertOrderedList",mode:h.WYSIWYG_MODE},void 0,k)}}},{requires:["editor","../listUtils/btn","./cmd"]});KISSY.add("editor/plugin/outdent/cmd",function(f,h,k){var e=k.addCommand,j=k.checkOutdentActive;return{init:function(b){e(b,"outdent");var d=h.Utils.getQueryCmd("outdent");b.hasCommand(d)||b.addCommand(d,{exec:function(a,b){return j(b)}})}}},{requires:["editor","../dentUtils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(f,h,k){return{init:function(e){k.init(e);var f=h.Utils.getQueryCmd("outdent");e.addButton("outdent",{tooltip:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",mode:h.WYSIWYG_MODE},{offClick:function(){e.execCommand("outdent");e.focus()},selectionChange:function(b){e.execCommand(f,b.path)?this.set("disabled",!1):this.set("disabled",!0)}})}}},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/focus",function(f,h){function k(){}var e=f.UA,j=h.focusManager;k.ATTRS={focus4e:{value:!0}};k.prototype={_uiSetFocus4e:function(b){b?(this.on("show",this._show4FocusExt,this),this.on("hide",this._hide4FocusExt,this)):(this.detach("show",this._show4FocusExt,this),this.detach("hide",this._hide4FocusExt,this))},_show4FocusExt:function(){var b=this._focusEditor=j.currentInstance();if(e.ie&&b){window.focus();document.body.focus();var d=b.get("document")[0].selection.createRange();
d&&d.item&&d.item(0).ownerDocument==b.get("document")[0]&&(b=document.body.createTextRange(),b.moveToElementText(this.get("el").first()[0]),b.collapse(!0),b.select())}},_hide4FocusExt:function(){var b=this._focusEditor;b&&b.focus()}};return k},{requires:["editor"]});
KISSY.add("editor/plugin/overlay/index",function(f,h,k,e){var j=k.extend([e],{},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:h.baseZIndex(h.zIndexManager.OVERLAY)}}});j.Dialog=k.Dialog.extend([e],{show:function(){this.center();var b=this.get("y");200<b-f.DOM.scrollTop()&&(b=f.DOM.scrollTop()+200,this.set("y",b));j.prototype.show.call(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},draggable:{value:!0},constrain:{value:!0},aria:{value:!0},zIndex:{value:h.baseZIndex(h.zIndexManager.OVERLAY)}}});
return j},{requires:["editor","overlay","./focus","dd"]});
KISSY.add("editor/plugin/pageBreak/index",function(f,h,k){var e=f.Node;return{init:function(f){k.init(f);var b=f.htmlDataProcessor;(b&&b.dataFilter).addRules({tags:{div:function(d){var a=d.getAttribute("style"),c;if(a)for(var e=d.childNodes,f=0;f<e.length;f++)1==e[f].nodeType&&(c=e[f]);if((c=c&&"span"==c.nodeName&&c.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(a)&&/display\s*:\s*none/i.test(c))return b.createFakeParserElement(d,"ke_pagebreak","div")}}});f.addButton("pageBreak",{tooltip:"\u5206\u9875",
mode:h.WYSIWYG_MODE},{offClick:function(){var b=this.get("editor"),a=new e('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,b.get("document")[0]),a=b.createFakeElement(a,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>'),c=b.getSelection();if(c=c&&c.getRanges()[0]){b.execCommand("save");for(var f=c.startContainer,h=f;"body"!==f.nodeName();)h=f,f=f.parent();c.collapse(!0);c.splitElement(h);a.insertAfter(h);
b.execCommand("save")}}})}}},{requires:["editor","../fakeObjects/"]});
KISSY.add("editor/plugin/preview/index",function(){var f=window;return{init:function(h){h.addButton("preview",{tooltip:"\u9884\u89c8"},{offClick:function(){var h=this.get("editor");try{var e=f.screen,j=Math.round(0.8*e.width),b=Math.round(0.7*e.height),d=Math.round(0.1*e.width)}catch(a){j=640,b=420,d=80}h=h.getDocHtml().replace(/\${title}/,"\u9884\u89c8");j=f.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+j+",height="+b+",left="+d);b=j.document;b.open();b.write(h);b.close();
j.focus()}})}}});
KISSY.add("editor/plugin/progressbar/index",function(f){function h(){h.superclass.constructor.apply(this,arguments);this._init()}var k=f.Node;h.ATTRS={container:{},width:{},height:{},progress:{value:0}};f.extend(h,f.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var e=this.get("height"),f=new k("<div class='ks-editor-progressbar'  style='width:"+this.get("width")+";height:"+e+";'></div>"),b=this.get("container"),e=(new k("<div style='overflow:hidden;'><div class='ks-editor-progressbar-inner' style='height:"+(parseInt(e)-
4)+"px'><div class='ks-editor-progressbar-inner-bg'></div></div></div>")).appendTo(f),d=(new k("<span class='ks-editor-progressbar-title'></span>")).appendTo(f);b&&f.appendTo(b);this.el=f;this._title=d;this._p=e;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},_progressChange:function(e){e=e.newVal;this._p.css("width",e+"%");this._title.html(e+"%")}});return h});
KISSY.add("editor/plugin/removeFormat/cmd",function(f,h){function k(a,b){for(var d=0;d<b.length;d++)a.removeAttr(b[d])}var e=h.RANGE,j=h.ElementPath,b=f.DOM,d="class,style,lang,width,height,align,hspace,valign".split(/,/),a=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(c){c.hasCommand("removeFormat")||c.addCommand("removeFormat",{exec:function(){c.focus();a.lastIndex=0;var f=c.getSelection().getRanges();
c.execCommand("save");for(var h=0,l;l=f[h];h++)if(!l.collapsed){l.enlarge(e.ENLARGE_ELEMENT);var n=l.createBookmark(),q=n.startNode,g=n.endNode,o=function(b){for(var c=new j(b),d=c.elements,e=1,f;(f=d[e])&&!f.equals(c.block)&&!f.equals(c.blockLimit);e++)a.test(f.nodeName())&&b._4e_breakParent(f)};o(q);o(g);for(q=q._4e_nextSourceNode(!0,b.ELEMENT_NODE,void 0,void 0);q&&!q.equals(g);)o=q._4e_nextSourceNode(!1,b.ELEMENT_NODE,void 0,void 0),"img"==q.nodeName()&&q.attr("_ke_realelement")||(a.test(q.nodeName())?
q._4e_remove(!0):k(q,d)),q=o;l.moveToBookmark(n)}c.getSelection().selectRanges(f);c.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/removeFormat/index",function(f,h,k){return{init:function(e){k.init(e);e.addButton("removeFormat",{tooltip:"\u6e05\u9664\u683c\u5f0f",mode:h.WYSIWYG_MODE},{offClick:function(){e.execCommand("removeFormat")}})}}},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(f,h,k){var e=f.Node;return{init:function(h){var b=k.Draggable,d=h.get("statusBarEl");h.get("textarea");var a=(h.get("pluginConfig").resize||{}).direction||["x","y"],c="se-resize";1==a.length&&(c="x"==a[0]?"e-resize":"s-resize");var i=(new e("<div class='ks-editor-resizer' style='cursor: "+c+"'></div>")).appendTo(d);h.on("maximizeWindow",function(){i.css("display","none")});h.on("restoreWindow",function(){i.css("display","")});var m=new b({node:i}),l=
0,n=0,q=h.get("el"),g=h.get("el");m.on("dragstart",function(){l=q.height();n=g.width();h.fire("resizeStart")});m.on("drag",function(b){var c=b.left-this.startNodePos.left,b=b.top-this.startNodePos.top;f.inArray("y",a)&&h.set("height",l+b);f.inArray("x",a)&&h.set("width",n+c);h.fire("resize")});h.on("destroy",function(){m.destroy();i.remove()})}}},{requires:["editor","dd"]});
KISSY.add("editor/plugin/select/index",function(f,h,k){h.prototype.addSelect=function(e,j,b,d){var d=d||k.Select,a=this,c=a.get("prefixCls")+"editor-";j&&(j.editor=a,j.menu&&(j.menu.zIndex=h.baseZIndex(h.zIndexManager.SELECT),j.menu.xclass="popupmenu",f.each(j.menu.children,function(a){a.xclass="option"})));var i=new d(f.mix({elAttrs:{hideFocus:"hideFocus"},render:a.get("toolBarEl"),prefixCls:c,autoRender:!0},j));i.get("el").unselectable();f.mix(i,b);if(i.selectionChange)a.on("selectionChange",function(){a.get("mode")!=
h.SOURCE_MODE&&i.selectionChange.apply(i,arguments)});if(i.click)i.on("click",function(a){i.click.apply(i,arguments);a.halt()});j.mode==h.WYSIWYG_MODE&&(a.on("wysiwygMode",function(){i.set("disabled",false)}),a.on("sourceMode",function(){i.set("disabled",true)}));i.init&&i.init();a.addControl(e,i);return i};return k.Select},{requires:["editor","menubutton"]});
KISSY.add("editor/plugin/separator/index",function(f){return{init:function(h){var k=(new f.Node('<span class="ks-editor-toolbar-separator">&nbsp;</span>')).appendTo(h.get("toolBarEl"));h.on("destroy",function(){k.remove()})}}},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(f,h,k){for(var e="<div class='ks-editor-smiley-sprite'>",j=0;98>=j;j++)e+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+j+".gif'></a>";e+="</div>";return{init:function(b){b.addButton("smiley",{tooltip:"\u63d2\u5165\u8868\u60c5",checkable:!0,mode:h.WYSIWYG_MODE},{init:function(){var b=this;b.on("blur",function(){setTimeout(function(){b.onClick()},150)})},offClick:function(){var d=this,a;if(!(a=d.smiley))a=d.smiley=new k({content:e,
focus4e:!1,width:"297px",autoRender:!0,elCls:"ks-editor-popup",zIndex:h.baseZIndex(h.zIndexManager.POPUP_MENU),mask:!1}),a.get("el").on("click",function(a){var a=new f.Node(a.target),d;if("a"==a.nodeName()&&(d=a.attr("data-icon")))d=new f.Node("<img alt='' src='"+d+"'/>",null,b.get("document")[0]),b.insertElement(d)}),a.on("hide",function(){d.set("checked",!1)});a.set("align",{node:this.get("el"),points:["bl","tl"]});a.show()},onClick:function(){this.smiley&&this.smiley.hide()},destructor:function(){this.smiley&&
this.smiley.destroy()}})}}},{requires:["editor","../overlay/"]});KISSY.add("editor/plugin/sourceArea/index",function(f,h){var k=h.SOURCE_MODE,e=h.WYSIWYG_MODE;return{init:function(f){f.addButton("sourceArea",{tooltip:"\u6e90\u7801",checkable:!0},{init:function(){var b=this;f.on("wysiwygMode",function(){b.set("checked",!1)});f.on("sourceMode",function(){b.set("checked",!0)})},offClick:function(){f.set("mode",k)},onClick:function(){f.set("mode",e)}})}}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strikeThrough/cmd",function(f,h,k){var e=new h.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(f){k.addButtonCmd(f,"strikeThrough",e)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strikeThrough/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("strikeThrough",{cmdType:"strikeThrough",tooltip:"\u5220\u9664\u7ebf "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(f,h,k,e){function j(a){function b(a){!(0<e.length)&&a[0].nodeType==g.ELEMENT_NODE&&t.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(f,"selected_cell",!0,void 0),e.push(a))}for(var c=a.createBookmarks(),d=a.getRanges(),e=[],f={},i=0;i<d.length;i++){var j=d[i];if(j.collapsed)j=j.getCommonAncestor(),(j=j.closest("td",void 0)||j.closest("th",void 0))&&e.push(j);else{var j=new Walker(j),k;for(j.guard=b;k=j.next();)if((k=k.parent())&&t.test(k.nodeName())&&
!k.data("selected_cell"))k._4e_setMarker(f,"selected_cell",!0,void 0),e.push(k)}}h.Utils.clearAllMarkers(f);a.selectBookmarks(c);return e}function b(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",q.ie||(new o(c[d]))._4e_appendBogus(void 0)}}function d(a){if(a instanceof h.Selection){for(var b=j(a),c=b.length,a=[],e,f,g=0;g<c;g++){var i=b[g].parent(),k=i[0].rowIndex;!g&&(e=k-1);a[k]=i;g==c-1&&(f=k+
1)}g=i.parent("table");e=new o(f<g[0].rows.length&&g[0].rows[f]||0<e&&g[0].rows[e]||g[0].parentNode);for(g=a.length;0<=g;g--)a[g]&&d(a[g]);return e}a instanceof o&&(g=a.parent("table"),1==g[0].rows.length?g.remove():a.remove());return 0}function a(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),e=c[0].cellIndex,f=0;f<d[0].rows.length;f++){var g=d[0].rows[f];g.cells.length<e+1||(c=new o(g.cells[e].cloneNode(void 0)),q.ie||c._4e_appendBogus(void 0),
g=new o(g.cells[e]),b?c.insertBefore(g):c.insertAfter(g))}}function c(a){if(a instanceof h.Selection){var b=j(a),e,f=[],a=b[0]&&b[0].parent("table"),g,i,k;g=0;for(i=b.length;g<i;g++)f.push(b[g][0].cellIndex);f.sort();g=1;for(i=f.length;g<i;g++)if(1<f[g]-f[g-1]){k=f[g-1]+1;break}k||(k=0<f[0]?f[0]-1:f[f.length-1]+1);f=a[0].rows;g=0;for(i=f.length;g<i&&!(e=f[g].cells[k]);g++);e=e?new o(e):a.prev();for(k=b.length-1;0<=k;k--)b[k]&&c(b[k]);return e}if(a instanceof o){b=a.parent("table");if(!b)return null;
e=a[0].cellIndex;for(k=b[0].rows.length-1;0<=k;k--)a=new o(b[0].rows[k]),!e&&1==a[0].cells.length?d(a):a[0].cells[e]&&a[0].removeChild(a[0].cells[e])}return null}function i(a,b){var c=new h.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function m(a){var b=(a=a.getSelection())&&a.getStartElement(),c=b&&b.closest("table",void 0);if(c)return a=b.closest(function(a){var b=g.nodeName(a);return c.contains(a)&&("td"==
b||"th"==b)},void 0),b=b.closest(function(a){var b=g.nodeName(a);return c.contains(a)&&"tr"==b},void 0),{table:c,td:a,tr:b}}function l(a){return(a=m(a))&&a.td}function n(a){return(a=m(a))&&a.tr}var q=f.UA,g=f.DOM,o=f.Node,r=["tr","th","td","tbody","table"],t=/^(?:td|th)$/,z={"\u8868\u683c\u5c5e\u6027":m,"\u5220\u9664\u8868\u683c":l,"\u5220\u9664\u5217":l,"\u5220\u9664\u884c":n,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":n,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":n,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":l,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":l},s=(6===q.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),p={elements:{table:function(a){var a=a.attributes,b=a["class"],c=parseInt(a.border,10);if(!c||0>=c)a["class"]=(b||"")+" ke_show_border"}}},v={elements:{table:function(a){var a=a.attributes,b=a["class"];b&&(a["class"]=f.trim(b.replace("ke_show_border","")))}}};return{init:function(j){j.addCustomStyle(s);var l=j.htmlDataProcessor,n=l&&l.htmlFilter;(l&&l.dataFilter).addRules(p);n.addRules(v);e.register({editor:j,filter:function(a){if(f.inArray(g.nodeName(a),r))return!0},statusChecker:z,
width:"120px",handlers:{"\u8868\u683c\u5c5e\u6027":function(){var a=m(j);a&&k.useDialog(j,"table/dialog",{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){var a=j.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove()}},"\u5220\u9664\u884c ":function(){var a=j.getSelection();i(d(a),void 0)},"\u5220\u9664\u5217 ":function(){var a=j.getSelection();
(a=c(a))&&i(a,!0)},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){var a=j.getSelection();b(a,!0)},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){var a=j.getSelection();b(a,void 0)},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){var b=j.getSelection();a(b,!0)},"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){var b=j.getSelection();a(b,void 0)}}});j.addButton("table",{mode:h.WYSIWYG_MODE,tooltip:"\u63d2\u5165\u8868\u683c"},{offClick:function(){k.useDialog(j,"table/dialog",{selectedTable:0,selectedTd:0})}})}}},{requires:["editor","../dialogLoader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(f,h,k){var e=new h.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(f){k.addButtonCmd(f,"underline",e)}}},{requires:["editor","../font/cmd"]});KISSY.add("editor/plugin/underline/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("underline",{cmdType:"underline",tooltip:"\u4e0b\u5212\u7ebf "},void 0,k.Button)}}},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(f,h,k){function e(e){e.get("editor").on("afterSave afterRestore",e._respond,e)}f=k.extend({bindUI:function(){e(this)},offClick:function(){this.get("editor").execCommand("undo")},_respond:function(e){0<e.index?this.set("disabled",!1):this.set("disabled",!0)}},{ATTRS:{mode:{value:h.WYSIWYG_MODE},disabled:{value:!0}}});return{RedoBtn:k.extend({bindUI:function(){e(this)},offClick:function(){this.get("editor").execCommand("redo")},_respond:function(e){e.index<
e.history.length-1?this.set("disabled",!1):this.set("disabled",!0)}},{mode:{value:h.WYSIWYG_MODE},ATTRS:{disabled:{value:!0}}}),UndoBtn:f}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(f,h){function k(a){var b=a.get("document")[0].body.innerHTML,d;b&&(d=a.getSelection());this.contents=b;this.bookmarks=d&&d.createBookmarks2(!0)}function e(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=f.buffer(this.save,500,this);this._init()}var j=h.Utils.arrayCompare,b=f.UA;f.augment(k,{equals:function(a){if(this.contents!=a.contents)return!1;var b=this.bookmarks,a=a.bookmarks;if(b||a){if(!b||!a||b.length!=a.length)return!1;for(var d=
0;d<b.length;d++){var e=b[d],f=a[d];if(e.startOffset!=f.startOffset||e.endOffset!=f.endOffset||!j(e.start,f.start)||!j(e.end,f.end))return!1}}return!0}});var d={16:1,17:1,18:1},a={37:1,38:1,39:1,40:1,33:1,34:1};f.augment(e,{_keyMonitor:function(){var b=this,e=b.editor;e.docReady(function(){e.get("document").on("keydown",function(f){var h=f.keyCode;h in a||h in d||(90===h&&(f.ctrlKey||f.metaKey)?(!1!==e.fire("restore",{direction:-1})&&b.restore(-1),f.halt()):89===h&&(f.ctrlKey||f.metaKey)?(!1!==e.fire("restore",
{direction:1})&&b.restore(1),f.halt()):!1!==e.fire("save",{buffer:1})&&b.save(1))})})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){if(this.editor.get("mode")==h.WYSIWYG_MODE)if(a)this.bufferRunner();else{var a=this.history,b=this.index;a.length>b+1&&a.splice(b+1,a.length-b-1);var d=this.editor,b=a[a.length-1],e=new k(d);if(!b||!b.equals(e))30===a.length&&a.shift(),a.push(e),this.index=b=a.length-1,d.fire("afterSave",{history:a,index:b})}},restore:function(a){if(this.editor.get("mode")==
h.WYSIWYG_MODE){var d=this.history,e=this.editor,f=e.get("document")[0].body,j=d[this.index+a];j&&(f.innerHTML=j.contents,j.bookmarks?e.getSelection().selectBookmarks(j.bookmarks):b.ie&&(f=f.createTextRange(),f.collapse(!0),f.select()),(f=e.getSelection())&&f.scrollIntoView(),this.index+=a,e.fire("afterRestore",{history:d,index:this.index}),e.notifySelectionChange());return j}}});return{init:function(a){if(!a.hasCommand("save")){var b=new e(a);a.addCommand("save",{exec:function(a,c){b.save(c)}});
a.addCommand("undo",{exec:function(){b.restore(-1)}});a.addCommand("redo",{exec:function(){b.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("undo",{mode:h.WYSIWYG_MODE,tooltip:"\u64a4\u9500",editor:f},void 0,k.UndoBtn);f.addButton("redo",{mode:h.WYSIWYG_MODE,tooltip:"\u91cd\u505a",editor:f},void 0,k.RedoBtn)}}},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/unorderedList/cmd",function(f,h,k){var e=k.queryActive,j=new k.ListCommand("ul");return{init:function(b){b.hasCommand("insertUnorderedList")||b.addCommand("insertUnorderedList",{exec:function(a){j.exec(a)}});var d=h.Utils.getQueryCmd("insertUnorderedList");b.hasCommand(d)||b.addCommand(d,{exec:function(a,b){return e("ul",b)}})}}},{requires:["editor","../listUtils/cmd"]});
KISSY.add("editor/plugin/unorderedList/index",function(f,h,k,e){return{init:function(f){e.init(f);f.addButton("unorderedList",{cmdType:"insertUnorderedList",mode:h.WYSIWYG_MODE},void 0,k)}}},{requires:["editor","../listUtils/btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(f,h,k,e){return{init:function(f){function b(a){for(var b=0;b<c.length;b++){var d=c[b];if(d.reg.test(a))return d}}var d=f.htmlDataProcessor,a=d&&d.dataFilter,c=[],i=f.get("pluginConfig");i.video=i.video||{};i=i.video;i.providers&&c.push.apply(c,i.providers);i.getProvider=b;a&&a.addRules({elements:{object:function(a){var c=a.getAttribute("classid"),e=a.childNodes;if(!c){for(c=0;c<e.length;c++)if("embed"==e[c].name){if(!k.isFlashEmbed(e[c]))break;if(b(e[c].getAttribute("src")))return d.createFakeParserElement(a,
"ke_video","video",!0)}return null}for(c=0;c<e.length;c++){var f=e[c];if("param"==f.nodeName&&"movie"==f.getAttribute("name").toLowerCase()&&b(f.getAttribute("value")))return d.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!k.isFlashEmbed(a))return null;if(b(a.getAttribute("src")))return d.createFakeParserElement(a,"ke_video","video",!0)}}},4);var m=new e({editor:f,cls:"ke_video",type:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.selectedEl;a&&m.show(a)}}});f.addButton("video",
{tooltip:"\u63d2\u5165\u89c6\u9891",mode:h.WYSIWYG_MODE},{offClick:function(){m.show()}})}}},{requires:["editor","../flashCommon/utils","../flashCommon/baseClass"]});
KISSY.add("editor/plugin/xiamiMusic/index",function(f,h,k,e){function j(){j.superclass.constructor.apply(this,arguments)}f.extend(j,k,{_updateTip:function(b,d){var a=this.get("editor").restoreRealElement(d);a&&(b.html(d.attr("title")),b.attr("href",this._getFlashUrl(a)))}});return{init:function(b){function d(a){return/xiami\.com/i.test(a)}var a=b.htmlDataProcessor,c=a&&a.dataFilter;c&&c.addRules({tags:{object:function(b){var c=b.getAttribute("title"),f,h;f=b.getAttribute("classid");var g=b.childNodes;
if(!f){for(f=0;f<g.length;f++)if(h=g[f],"embed"==h.nodeName){if(!e.isFlashEmbed(h))break;if(d(h.attributes.src))return a.createFakeParserElement(b,"ke_xiami","xiamiMusic",!0,{title:c})}return null}for(f=0;f<g.length;f++)if(h=g[f],"param"==h.nodeName&&"movie"==h.getAttribute("name")&&d(h.getAttribute("value")))return a.createFakeParserElement(b,"ke_xiami","xiamiMusic",!0,{title:c})},embed:function(b){if(e.isFlashEmbed(b)&&d(b.getAttribute("src")))return a.createFakeParserElement(b,"ke_xiami","xiamiMusic",
!0,{title:b.getAttribute("title")})}}},4);var f=new j({editor:b,cls:"ke_xiami",type:"xiamiMusic",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.selectedEl;a&&f.show(a)}}});b.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",mode:h.WYSIWYG_MODE},{offClick:function(){f.show()}})}}},{requires:["editor","../flashCommon/baseClass","../flashCommon/utils"]});KISSY.add("editor/full",function(f,h){return h},{requires:["editor"]});
