/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 7 15:13
*/
KISSY.add("editor/plugin/image/index",function(c,h,p,l,q,m){var i=c.UA,n=c.Node,f=c.all,o=c.Event,e=function(b){b=f(b);return"img"===b.nodeName(b)&&!/(^|\s+)ke_/.test(b[0].className)&&b};return{init:function(b){function g(a){m.useDialog(b,"image/dialog",a)}b.addButton("image",{tooltip:"插入图片",mode:h.WYSIWYG_MODE},{offClick:function(){g(null)}});var j=[{content:"图片属性",fn:function(){var a=e(this.get("editorSelectedEl"));a&&(this.hide(),g(f(a)))}},{content:"插入新行",fn:function(){this.hide();var a=b.get("document")[0],
d=new n(a.createElement("p"));i.ie||d._4e_appendBogus(void 0);a=new h.Range(a);a.setStartAfter(this.get("editorSelectedEl"));a.select();b.insertElement(d);a.moveToElementEditablePosition(d,1);a.select()}}],k=[];c.each(j,function(a){k.push({content:a.content})});b.addContextMenu("image-contextmenu",e,{width:120,children:k,listeners:{click:{fn:function(a){var b=this,e=a.target.get("content");c.each(j,function(a){a.content==e&&a.fn.call(b)})}}}});b.docReady(function(){o.on(b.get("document")[0],"dblclick",
function(a){a.halt();a=f(a.target);e(a)&&g(a)})});l.register({editor:b,filter:e,init:function(){var a=this,d=a.get("contentEl");d.html('<a class="ks-editor-bubbleview-url" target="_blank" href="#">在新窗口查看</a>  |  <a class="ks-editor-bubbleview-link ks-editor-bubbleview-change" href="#">编辑</a>  |  <a class="ks-editor-bubbleview-link ks-editor-bubbleview-remove" href="#">删除</a>');var c=d.one(".ks-editor-bubbleview-url"),e=d.one(".ks-editor-bubbleview-change"),f=d.one(".ks-editor-bubbleview-remove");
h.Utils.preventFocus(d);e.on("click",function(b){g(a.selectedEl);b.halt()});f.on("click",function(d){if(i.webkit){var c=b.getSelection().getRanges();c&&c[0]&&(c[0].collapse(),c[0].select())}a.selectedEl.remove();a.hide();b.notifySelectionChange();d.halt()});a.on("show",function(){var b=a.selectedEl;b&&(b=b.attr("_ke_saved_src")||b.attr("src"),c.attr("href",b))})}})}}},{requires:["editor","../button/","../bubbleview/","../contextmenu/","../dialogLoader/"]});
