/*
Copyright 2010, KISSY UI Library v1.1.5
MIT Licensed
build time: Nov 8 16:12
*/
KISSY.add("mask",function(b,m){function h(i){if(!(this instanceof h))return new h(i);i=b.merge(d,i);var j=i.shim,l=j?a:c+i.style,n=j?0:i.opacity,o=g("<iframe>",l,n,!j);if(!j&&k)this.layer=g("<div>",l,n,true);this.config=i;this.iframe=o}function g(i,j,l,n){i=f.create(i);f.attr(i,"style",j);f.css(i,"opacity",l);if(n){f.height(i,f.docHeight());e&&f.width(i,f.docWidth())}document.body.appendChild(i);return i}var f=b.DOM,k=b.UA.ie,e=k===6,c="position:absolute;left:0;top:0;width:100%;border:0;background:black;z-index:9998;display:none;",
a="position:absolute;z-index:9997;border:0;display:none;",d={shim:false,opacity:0.6,style:""};b.augment(h,{show:function(){f.show([this.iframe,this.layer])},hide:function(){f.hide([this.iframe,this.layer])},dispose:function(){this.iframe&&f.remove(this.iframe);this.layer&&f.remove(this.layer)},toggle:function(){this[f.css(this.iframe,"display")!=="none"?"hide":"show"]()},setSize:function(i,j){var l=this.iframe;if(l){f.width(l,i+20);f.height(l,j+20)}if(l=this.layer){f.width(l,i+20);f.height(l,j+20)}},
setOffset:function(i,j){var l=i;if(j!==m)l={left:i,top:j};f.offset([this.iframe,this.layer],l)}});b.Mask=h},{host:"overlay"});
KISSY.add("overlay",function(b,m){function h(a,d){d=d||{};if(b.isPlainObject(a))d=a;else d.container=a;h.superclass.constructor.call(this,d);this.container=b.get(d.container);this.trigger=b.makeArray(b.query(d.trigger));this.currentTrigger=this.trigger[0];this._init()}var g=document,f=b.DOM,k=b.Event,e=b.UA.ie===6,c;b.extend(h,b.Base);h.ATTRS={container:{value:null},containerCls:{value:"ks-overlay"},bdCls:{value:"ks-overlay-bd"},trigger:{value:null},triggerType:{value:"click"},x:{value:0},y:{value:0},
xy:{value:null,setter:function(a){var d=b.makeArray(a);if(d.length){d[0]&&this.set("x",d[0]);d[1]&&this.set("y",d[1])}return a}},width:{value:0,setter:function(a){return parseInt(a)||0}},height:{value:0,setter:function(a){return parseInt(a)||0}},content:{value:m},mask:{value:false},shim:{value:e},zIndex:{value:9999}};h.Plugins=[];b.augment(h,{_init:function(){var a=this;a._onAttrChanges();a.trigger.length>0&&a._bindTrigger();b.each(h.Plugins,function(d){d.init&&d.init(a)})},_onAttrChanges:function(){var a=
this;a.on("afterContainerChange",function(d){a.container=b.get(d.newVal)});a.on("afterTriggerChange",function(d){a.trigger=b.makeArray(b.query(d.newVal));a.currentTrigger=a.trigger[0]});a.on("afterXChange",function(d){d={left:d.newVal};f.offset(a.container,d);a.shim&&a.shim.setOffset(d)});a.on("afterYChange",function(d){d={top:d.newVal};f.offset(a.container,d);a.shim&&a.shim.setOffset(d)});a.on("afterWidthChange",function(d){if(d=d.newVal){f.width(a.container,d);a.shim&&a.shim.setSize(d,a.get("height"))}});
a.on("afterHeightChange",function(d){if(d=d.newVal){f.height(a.container,d);a.shim&&a.shim.setSize(a.get("width"),d)}});a.on("afterContentChange",function(d){f.html(a.body,d.newVal)})},_bindTrigger:function(){this.get("triggerType")==="mouse"?this._bindTriggerMouse():this._bindTriggerClick()},_bindTriggerMouse:function(){var a=this;b.each(a.trigger,function(d){var i;k.on(d,"mouseenter",function(){a._clearHiddenTimer();i=b.later(function(){a.currentTrigger=d;a.show();i=m},100)});k.on(d,"mouseleave",
function(){if(i){i.cancel();i=m}a._setHiddenTimer()})})},_bindContainerMouse:function(){var a=this;k.on(a.container,"mouseleave",function(){a._setHiddenTimer()});k.on(a.container,"mouseenter",function(){a._clearHiddenTimer()})},_setHiddenTimer:function(){var a=this;a._hiddenTimer=b.later(function(){a.hide()},120)},_clearHiddenTimer:function(){if(this._hiddenTimer){this._hiddenTimer.cancel();this._hiddenTimer=m}},_bindTriggerClick:function(){var a=this;b.each(a.trigger,function(d){k.on(d,"click",function(i){i.halt();
a.currentTrigger=d;a.show()})})},show:function(){this._firstShow()},_firstShow:function(){this._prepareMarkup();this._setDisplay();this._setSize();this._setPosition();this.fire("create");this._realShow();this._firstShow=this._realShow},_realShow:function(){this._toggle(false)},_toggle:function(a){f.css(this.container,"visibility",a?"hidden":"");this.shim&&this.shim.toggle();this.get("mask")&&c[a?"hide":"show"]();this[a?"_unbindUI":"_bindUI"]();this.fire(a?"hide":"show")},hide:function(){this._toggle(true)},
_prepareMarkup:function(){var a=this.container;if(this.get("mask")&&!c)c=new b.Mask;if(this.get("shim"))this.shim=new b.Mask({shim:true});if(a){this.body=b.get("."+this.get("bdCls"),a)||a;a.style.cssText+="visibility:hidden;position:absolute;";f.html(this.body,this.get("content"))}else{a=this.container=f.create(b.substitute('<div class="{containerCls}" style="visibility:hidden;position:absolute;"><div class="{bdCls}">{content}</div></div>',{containerCls:this.get("containerCls"),bdCls:this.get("bdCls"),
content:this.get("content")}));this.body=f.children(a)[0];g.body.appendChild(a)}f.css(a,"zIndex",this.get("zIndex"));this.get("triggerType")==="mouse"&&this._bindContainerMouse()},_setDisplay:function(){f.css(this.container,"display")==="none"&&f.css(this.container,"display","block")},_setSize:function(){var a,d,i=this.container;a=this.get("width")||f.width(i);d=this.get("height")||f.height(i);f.width(i,a);f.height(i,d);this.shim&&this.shim.setSize(a,d)},_setPosition:function(){var a={left:this.get("x"),
top:this.get("y")};f.offset(this.container,a);this.shim&&this.shim.setOffset(a)},move:function(a,d){if(b.isArray(a)){d=a[1];a=a[0]}this.set("x",a);d&&this.set("y",d)},_bindUI:function(){k.on(g,"keydown",this._esc,this)},_unbindUI:function(){k.remove(g,"keydown",this._esc,this)},_esc:function(a){a.keyCode===27&&this.hide()},setBody:function(a){this.set("content",a)},dispose:function(){var a=this;a._toggle(true);a.detach();k.remove(a.container);b.each(a.trigger,function(d){k.remove(d,a.get("triggerType")===
"mouse"?"mouseenter mouseleave":"click")});f.remove(a.container)}});b.Overlay=h},{requires:["core"]});KISSY.add("popup",function(b){function m(g,f){if(!(this instanceof m))return new m(g,f);f=f||{};if(b.isPlainObject(g))f=g;else f.container=g;m.superclass.constructor.call(this,b.merge(h,f))}var h={triggerType:"mouse",align:{node:"trigger",points:["cr","ct"],offset:[10,0]}};b.extend(m,b.Overlay);b.Popup=m},{host:"overlay"});
KISSY.add("dialog",function(b,m){function h(e,c){if(!(this instanceof h))return new h(e,c);c=c||{};if(b.isPlainObject(e))c=e;else c.container=e;h.superclass.constructor.call(this,b.merge(k,c));this.manager=b.DialogManager;this.ID=this.manager.register(this)}var g=b.DOM,f=b.Event,k={containerCls:"ks-overlay ks-dialog",bdCls:"ks-dialog-bd",width:400,height:300};h.ATTRS={header:{value:""},footer:{value:""},hdCls:{value:"ks-dialog-hd"},ftCls:{value:"ks-dialog-ft"},closeBtnCls:{value:"ks-dialog-close"},
closable:{value:true}};b.extend(h,b.Overlay);b.Dialog=h;b.augment(h,b.EventTarget,{_onAttrChanges:function(){var e=this;h.superclass._onAttrChanges.call(e);e.on("afterHeaderChange",function(c){g.html(e.header,c.newVal)});e.on("afterFooterChange",function(c){g.html(e.footer,c.newVal)})},_prepareMarkup:function(){var e;e=this.get("hdCls");var c=this.get("ftCls");h.superclass._prepareMarkup.call(this);this.header=b.get("."+e,this.container);if(!this.header){this.header=g.create("<div>",{"class":e});
g.insertBefore(this.header,this.body)}g.html(this.header,this.get("header"));if(e=this.get("footer")){this.footer=b.get("."+c,this.container);if(!this.footer){this.footer=g.create("<div>",{"class":c});this.container.appendChild(this.footer)}g.html(this.footer,e)}this.get("closable")&&this._initClose()},_initClose:function(){var e=this,c=g.create("<div>",{"class":e.get("closeBtnCls")});g.html(c,"close");f.on(c,"click",function(a){a.halt();e.hide()});e.header.appendChild(c)},setHeader:function(e){this.set("header",
e)},setFooter:function(e){this.set("footer",e)}});b.DialogManager={register:function(e){if(e instanceof h){var c=b.guid();this._dialog[c]=e;return c}return-1},_dialog:{},hideAll:function(){b.each(this._dialog,function(e){e&&e.hide()})},get:function(e){if(!e)return m;try{return this._dialog[e]}catch(c){return m}}}},{host:"overlay"});
KISSY.add("alignment",function(b,m){var h=b.DOM,g=b.Overlay,f={TL:"tl",TC:"tc",TR:"tr",CL:"cl",CC:"cc",CR:"cr",BL:"bl",BC:"bc",BR:"br"},k={node:null,points:[f.CC,f.CC],offset:[0,0]};b.mix(g.ATTRS,{align:{value:k,setter:function(e){return b.merge(this.get("align"),e)},getter:function(e){return b.merge(k,e)}}});g.Plugins.push({name:"align",init:function(e){e.on("create",function(){var c=this;c.on("afterAlignChange",function(){c.align()})})}});b.augment(g,{align:function(e,c,a){var d=this.get("align");
if(this.container){e=e||d.node;e=e==="trigger"?this.currentTrigger:b.get(e);c=c||d.points;a=a===m?d.offset:a;d=h.offset(this.container);e=this._getAlignOffset(e,c[0]);c=this._getAlignOffset(this.container,c[1]);c=[c.left-e.left,c.top-e.top];this.move(d.left-c[0]+ +a[0],d.top-c[1]+ +a[1])}},_getAlignOffset:function(e,c){var a=c.charAt(0),d=c.charAt(1),i,j,l,n;if(e){i=h.offset(e);j=e.offsetWidth;l=e.offsetHeight}else{i={left:h.scrollLeft(),top:h.scrollTop()};j=h.viewportWidth();l=h.viewportHeight()}n=
i.left;i=i.top;if(a==="c")i+=l/2;else if(a==="b")i+=l;if(d==="c")n+=j/2;else if(d==="r")n+=j;return{left:n,top:i}},center:function(){this.align("viewport",[f.CC,f.CC],[0,0])},_setPosition:function(){var e;if(this.get("xy")){e={left:this.get("x"),top:this.get("y")};h.offset(this.container,e);this.shim&&this.shim.setOffset(e)}else this.align()}})},{host:"overlay"});
KISSY.add("constrain",function(b,m){var h=b.DOM,g=b.Overlay,f=Math.min,k=Math.max,e={node:m,mode:false};b.mix(g.ATTRS,{constrain:{value:e,setter:function(c){return b.merge(this.get("constrain"),c)},getter:function(c){return b.merge(e,c)}},x:{value:0,setter:function(c){var a=this._getConstrainRegion();if(a)c=f(k(a.left,c),a.maxLeft);return c}},y:{value:0,setter:function(c){var a=this._getConstrainRegion();if(a)c=f(k(a.top,c),a.maxTop);return c}}});g.Plugins.push({name:"constrain",init:function(c){c.on("create",
function(){var a=this;a.on("afterConstrainChange",function(){a.align&&a.align()})})}});b.augment(g,{_getConstrainRegion:function(){var c=this.get("constrain"),a=b.get(c.node);if(!c.mode)return m;if(a){c=h.offset(a);b.mix(c,{maxLeft:c.left+h.width(a)-h.width(this.container),maxTop:c.top+h.height(a)-h.height(this.container)})}else{c={left:h.scrollLeft(),top:h.scrollTop()};b.mix(c,{maxLeft:c.left+h.viewportWidth()-h.width(this.container),maxTop:c.top+h.viewportHeight()-h.height(this.container)})}return c},
constrain:function(c){this.set("constrain",{node:c,mode:true})},toggleConstrain:function(c){this.set("constrain",{node:this.get("constrain").node,mode:!!c})}})},{host:"overlay"});
KISSY.add("overlay-fixed",function(b){function m(){}function h(j,l){if(j.container){var n;n=g.offset(j.container);g.offset(j.container,{left:n.left+(l?-g.scrollLeft():g.scrollLeft()),top:n.top+(l?-g.scrollTop():g.scrollTop())});if(l)if(a){g.css(j.container,e,c);d||(d=new m);d.add(j)}else g.css(j.container,e,k);else a?d.remove(j):g.css(j.container,e,c)}}var g=b.DOM,f=b.Overlay,k="fixed",e="position",c="absolute",a=b.UA.ie===6,d,i=document.body;b.mix(f.ATTRS,{fixed:{value:false}});f.Plugins.push({name:k,
init:function(j){j.on("create",function(){var l=this;l.get(k)&&h(l,true);l.on("afterFixedChange",function(n){h(l,n.newVal)})})}});b.augment(m,{create:function(){i=document.body;if(i.currentStyle.backgroundAttachment!==k){if(i.currentStyle.backgroundImage==="none"){i.runtimeStyle.backgroundRepeat="no-repeat";i.runtimeStyle.backgroundImage="url(about:blank)"}i.runtimeStyle.backgroundAttachment=k}this.container=document.createElement("<div class=ks-overlay-"+k+" style='position:absolute;border:0;padding:0;margin:0;overflow:hidden;background:transparent;top:expression((document).documentElement.scrollTop);left:expression((document).documentElement.scrollLeft);width:expression((document).documentElement.clientWidth);height:expression((document).documentElement.clientHeight);display:block;'>");
i.appendChild(this.container);this.create=this.empty},empty:function(){},add:function(j){this.create();j._parent=j.container.parentNode;j.shim&&this.container.appendChild(j.shim.iframe);this.container.appendChild(j.container)},remove:function(j){var l;if(j.container.parentNode===this.container){l=j._parent||i;l.appendChild(j.container);j.shim&&j.shim&&l.appendChild(j.shim.iframe);j._parent=undefined}}})},{host:"overlay"});
KISSY.add("overlay-draggable",function(b){function m(g,f){if(g.header)try{if(f){if(!g._dd){var k=new b.Draggable({node:new b.Node(g.container),handlers:[new b.Node(g.header)]});k.on("drag",function(c){g.move(c.left,c.top)});g._dd=k}}else g._dd&&g._dd.remove("drag")}catch(e){}}var h=b.Overlay;b.mix(h.ATTRS,{draggable:{value:false}});h.Plugins.push({name:"draggable",init:function(g){g.on("create",function(){var f=this;f.get("draggable")&&m(f,true);f.on("afterDraggableChange",function(k){m(f,k.newVal)})})}})},
{host:"overlay",requires:["dd"]});KISSY.add("autorender",function(b){b.Overlay.autoRender=function(m,h){m="."+(m||"KS_Widget");b.query(m,h).each(function(g){var f=g.getAttribute("data-widget-type"),k;if(f&&"Dialog Popup".indexOf(f)>-1)try{if(k=g.getAttribute("data-widget-config"))k=k.replace(/'/g,'"');new b[f](g,b.JSON.parse(k))}catch(e){}})}},{host:"overlay"});
