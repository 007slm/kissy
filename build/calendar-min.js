/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Feb 20 10:27
*/
KISSY.add("calendar/base",function(k,n,l,m){function h(a,b){this._init(a,b)}var f=n.all;k.augment(h,l.Target,{_init:function(a,b){var d=f(a);this.id=this._stamp(d);this._buildParam(b);if(this.popup){this.trigger=d;this.con=new n("<div>");f(document.body).append(this.con);this.con.css({top:"0px",position:"absolute",background:"white",visibility:"hidden","z-index":99999999})}else this.con=d;this.C_Id=this._stamp(this.con);this.render();this._buildEvent();return this},render:function(a){var b=0,d,e,
c;a=a||{};this._parseParam(a);this.con.addClass("ks-cal-call ks-clearfix ks-cal-call-multi-"+this.pages);this.ca=this.ca||[];for(b=0;b<this.ca.length;b++)this.ca[b].detachEvent();this.con.html("");this.ca.length=this.pages;a=b=false;if(this.range){if(this.range.start)b=true;if(this.range.end)a=true}c=b&&!this.rangeLinkage?[this.range.start.getFullYear(),this.range.start.getMonth()]:[this.year,this.month];for(b=0;b<this.pages;b++){if(b===0)d=true;else if(this.rangeLinkage){d=false;c=this._computeNextMonth(c)}else{d=
true;c=a&&b+1==this.pages?[this.range.end.getFullYear(),this.range.end.getMonth()]:this._computeNextMonth(c)}e=this.rangeLinkage?b==this.pages-1:true;var g=this.ca[b];if(!this.rangeLinkage&&g&&(g.year!=c[0]||g.month!=c[1]))c=[g.year,g.month];this.ca[b]=new this.Page({year:c[0],month:c[1],prevArrow:d,nextArrow:e,showTime:this.showTime},this);this.ca[b].render()}return this},destroy:function(){for(var a=0;a<this.ca.length;a++)this.ca[a].detachEvent();k.each(this.EV,function(b){b&&b.target.detach(b.type,
b.fn)});this.con.remove()},_stamp:function(a){a.attr("id")||a.attr("id",k.guid("K_Calendar"));return a.attr("id")},_buildEvent:function(){var a=this,b,d;if(!a.popup)return this;k.each(a.EV,function(e){e&&e.target.detach(e.type,e.fn)});a.EV=a.EV||[];b=a.EV[0]={target:f(document),type:"click"};b.fn=function(e){var c=f(e.target);if(c.attr("id")!==a.C_Id)if(!((c.hasClass("ks-next")||c.hasClass("ks-prev"))&&c[0].tagName==="A"))if(c.attr("id")!=a.id)if(a.con.css("visibility")!="hidden")a.con.contains(c)&&
(c[0].nodeName.toLowerCase()==="option"||c[0].nodeName.toLowerCase()==="select")||function(g,i){return g[0]>i[0].x&&g[0]<i[1].x&&g[1]>i[0].y&&g[1]<i[1].y}([e.pageX,e.pageY],[{x:a.con.offset().left,y:a.con.offset().top},{x:a.con.offset().left+a.con.width(),y:a.con.offset().top+a.con.height()}])||a.hide()};b.target.on(b.type,b.fn);for(d=0;d<a.triggerType.length;d++){b=a.EV[d+1]={target:f("#"+a.id),type:a.triggerType[d],fn:function(e){e.target=f(e.target);e.preventDefault();var c=a.triggerType;if(k.inArray("click",
c)&&k.inArray("focus",c))e.type=="focus"&&a.toggle();else if(k.inArray("click",c)&&!k.inArray("focus",c))e.type=="click"&&a.toggle();else!k.inArray("click",c)&&k.inArray("focus",c)?setTimeout(function(){a.toggle()},170):a.toggle()}};b.target.on(b.type,b.fn)}return this},__getAlignOffset:function(a,b){var d=b.charAt(0),e=b.charAt(1),c,g,i,j;if(a){a=n.one(a);c=a.offset();g=a.outerWidth();i=a.outerHeight()}else{c={left:DOM.scrollLeft(),top:DOM.scrollTop()};g=DOM.viewportWidth();i=DOM.viewportHeight()}j=
c.left;c=c.top;if(d==="c")c+=i/2;else if(d==="b")c+=i;if(e==="c")j+=g/2;else if(e==="r")j+=g;return{left:j,top:c}},toggle:function(){this.con.css("visibility")=="hidden"?this.show():this.hide()},show:function(){this.con.css("visibility","");var a=this.align.points,b=this.align.offset||[0,0],d=this.con.offset(),e=this.__getAlignOffset(this.trigger,a[0]);a=this.__getAlignOffset(this.con,a[1]);e=[a.left-e.left,a.top-e.top];a=d.top-e[1]+b[1];this.con.css("left",(d.left-e[0]+b[0]).toString()+"px");this.con.css("top",
a.toString()+"px");this.fire("show");return this},hide:function(){this.con.css("visibility","hidden");this.fire("hide");return this},_buildParam:function(a){var b=this;if(a===m||a===null)a={};k.each({date:new Date,selected:null,startDay:0,pages:1,closable:false,rangeSelect:false,minDate:false,maxDate:false,multiSelect:false,multi:null,navigator:true,popup:false,showTime:false,triggerType:["click"],disabled:null,range:null,rangeLinkage:true,align:{points:["bl","tl"],offset:[0,0]},notLimited:false},
function(d,e){var c=a[e];b[e]=c===m||c===null?d:c});return this},_parseParam:function(a){var b;if(a===m||a===null)a={};for(b in a)this[b]=a[b];if(typeof this.triggerType==="string")this.triggerType=[this.triggerType];this.startDay%=7;if(this.startDay<0)this.startDay+=7;this.EV=[];this._handleDate();if(this.multiSelect){this.rangeSelect=false;this.selected=this.range=null;if(this.multi)for(b=0;b<this.multi.length;b++)if(this.multi[b]instanceof Date)this.multi[b]=this._handleDate2String(this.multi[b])}return this},
_templetShow:function(a,b){var d,e,c,g;if(b instanceof Array){d="";for(e=0;e<b.length;e++)d+=arguments.callee(a,b[e]);a=d}else{d=a.match(/{\$(.*?)}/g);if(b!==m&&d!==null){e=0;for(c=d.length;e<c;e++){g=d[e].replace(/({\$)|}/g,"");g=b[g]!==m?b[g]:"";a=a.replace(d[e],g)}}}return a},_handleDate:function(){var a=this.date;this.weekday=a.getDay()+1;this.day=a.getDate();this.month=a.getMonth();this.year=a.getFullYear();return this},_handleDate2String:function(a){var b=a.getFullYear(),d=a.getMonth();a=a.getDate();
return b+"-"+(d>8?d+1:"0"+(d+1))+"-"+(a>9?a:"0"+a)},_handleString2Date:function(a){a=a.toString().split("-");if(a.length==3){date=new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10));if(date instanceof Date&&date!="Invalid Date"&&!isNaN(date))return date}},_getHeadStr:function(a,b){return a.toString()+"\u5e74"+(Number(b)+1).toString()+"\u6708"},_monthAdd:function(){if(this.month==11){this.year++;this.month=0}else this.month++;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+
"/1");return this},_monthMinus:function(){if(this.month===0){this.year--;this.month=11}else this.month--;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},_yearAdd:function(){this.year++;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},_yearMinus:function(){this.year--;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},_computeNextMonth:function(a){var b=a[0];a=a[1];if(a==11){b++;a=
0}else a++;return[b,a]},_handleOffset:function(){var a=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],b=this.startDay,d="";d=[];for(var e=0;e<7;e++)d[e]={day:a[(e+b)%7]};d=this._templetShow("<span>{$day}</span>",d);return{day_html:d}},_handleRange:function(a){this.range=this.range||{start:null,end:null};if(this.range.start===null&&this.range.end===null||this.range.start!==null&&this.range.end!==null){this.range.start=a;this.range.end=null;this.render()}else if(this.range.start!==null&&this.range.end===null){this.range.end=
a;if(this.range.start.getTime()>this.range.end.getTime()){a=this.range.start;this.range.start=this.range.end;this.range.end=a}this.fire("rangeSelect",this.range);this.render();this.popup&&this.closable&&this.hide()}return this},_handleMultiSelectStart:function(a){this.multiStart=a},_handleMultiSelectEnd:function(a){if(this.multiStart){this.multi=this.multi||[];if(a<this.multiStart){this.multiEnd=this.multiStart;this.multiStart=a}else this.multiEnd=a;if(this.minDate&&this.multiStart<this.minDate)this.multiStart=
new Date(this.minDate.getFullYear(),this.minDate.getMonth(),this.minDate.getDate());if(this.maxDate&&this.multiEnd>this.maxDate)this.multiEnd=new Date(this.maxDate.getFullYear(),this.maxDate.getMonth(),this.maxDate.getDate());for(;this.multiStart<=this.multiEnd;){a=false;if(this.disabled&&this.disabled.length>0)for(var b=0;b<this.disabled.length;b++)if(this.disabled[b].getTime()==this.multiStart.getTime()){a=true;break}if(!a){a=this._handleDate2String(this.multiStart);k.inArray(a,this.multi)?this.multi.splice(k.indexOf(a,
this.multi),1):this.multi.push(a);this.multiStart.setDate(this.multiStart.getDate()+1)}}this.multiStart=null;this.render()}},_handleMultiSelect:function(){this.multi=this.multi||[];this.multi.sort(function(b,d){if(b>d)return 1;return-1});for(var a=0;a<this.multi.length;a++)this.multi[a]=this._handleString2Date(this.multi[a]);this.fire("multiSelect",{multi:this.multi});this.popup&&this.closable&&this.hide()}});return h},{requires:["node","event"]});
KISSY.add("calendar",function(k,n,l,m,h){k.Date=n.Date=h;return k.Calendar=n},{requires:["calendar/base","calendar/page","calendar/time","calendar/date"]});
KISSY.add("calendar/date",function(){function k(l,m){var h=null;m=m||"-";if(h instanceof Date)return h;else h=new Date(l);if(h instanceof Date&&h!="Invalid Date"&&!isNaN(h))return h;else{h=l.toString().split(m);if(h.length==3){h=new Date(h[0],parseInt(h[1],10)-1,h[2]);if(h instanceof Date&&h!="Invalid Date"&&!isNaN(h))return h}}return null}var n=function(){var l=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,m=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,
h=/[^-+\dA-Z]/g,f=function(d,e){d=String(d);for(e=e||2;d.length<e;)d="0"+d;return d},a={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",
localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},b={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(d,e,c){if(arguments.length==1&&Object.prototype.toString.call(d)==
"[object String]"&&!/\d/.test(d)){e=d;d=undefined}d=d?new Date(d):new Date;if(isNaN(d))throw SyntaxError("invalid date");e=String(a[e]||e||a["default"]);if(e.slice(0,4)=="UTC:"){e=e.slice(4);c=true}var g=c?"getUTC":"get",i=d[g+"Date"](),j=d[g+"Day"](),o=d[g+"Month"](),s=d[g+"FullYear"](),p=d[g+"Hours"](),t=d[g+"Minutes"](),u=d[g+"Seconds"]();g=d[g+"Milliseconds"]();var r=c?0:d.getTimezoneOffset(),v={d:i,dd:f(i,undefined),ddd:b.dayNames[j],dddd:b.dayNames[j+7],w:b.dayNames[j+14],m:o+1,mm:f(o+1,undefined),
mmm:b.monthNames[o],mmmm:b.monthNames[o+12],yy:String(s).slice(2),yyyy:s,h:p%12||12,hh:f(p%12||12,undefined),H:p,HH:f(p,undefined),M:t,MM:f(t,undefined),s:u,ss:f(u,undefined),l:f(g,3),L:f(g>99?Math.round(g/10):g,undefined),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:c?"UTC":(String(d).match(m)||[""]).pop().replace(h,""),o:(r>0?"-":"+")+f(Math.floor(Math.abs(r)/60)*100+Math.abs(r)%60,4),S:["th","st","nd","rd"][i%10>3?0:(i%100-i%10!=10)*i%10]};return e.replace(l,function(q){return q in
v?v[q]:q.slice(1,q.length-1)})}}();return{format:function(l,m,h){return n(l,m,h)},parse:function(l,m){return k(l,m)}}});
KISSY.add("calendar/page",function(k,n,l,m){k.augment(m,{Page:function(h,f){this.father=f;this.month=Number(h.month);this.year=Number(h.year);this.prevArrow=h.prevArrow;this.nextArrow=h.nextArrow;this.timmer=this.node=null;this.id="";this.html=['<div class="ks-cal-box" id="{$id}"><div class="ks-cal-hd"><a href="javascript:void(0);" class="ks-prev-year {$prev}"><</a><a href="javascript:void(0);" class="ks-prev-month {$prev}"><</a><a href="javascript:void(0);" class="ks-title">{$title}</a><a href="javascript:void(0);" class="ks-next-month {$next}">></a><a href="javascript:void(0);" class="ks-next-year {$next}">></a></div><div class="ks-cal-bd"><div class="ks-whd">',f._handleOffset().day_html,
'</div><div class="ks-dbd ks-clearfix">{$ds}<div style="clear:both;"></div></div></div><div class="ks-setime hidden"></div><div class="{$notlimited}"><a href="#" class="ks-cal-notLimited {$notlimitedCls}">\u4e0d\u9650</a></div><div class="ks-multi-select {$multiSelect}"><button class="ks-multi-select-btn">\u786e\u5b9a</button></div><div class="ks-cal-ft {$showtime}"><div class="ks-cal-time">\u65f6\u95f4\uff1a00:00 &hearts;</div></div><div class="ks-selectime hidden"></div></div><!--#ks-cal-box--\>'].join("");this.nav_html='<p>\u6708<select value="{$the_month}"><option class="m1" value="1">01</option><option class="m2" value="2">02</option><option class="m3" value="3">03</option><option class="m4" value="4">04</option><option class="m5" value="5">05</option><option class="m6" value="6">06</option><option class="m7" value="7">07</option><option class="m8" value="8">08</option><option class="m9" value="9">09</option><option class="m10" value="10">10</option><option class="m11" value="11">11</option><option class="m12" value="12">12</option></select></p><p>\u5e74<input type="text" value="{$the_year}" onfocus="this.select()"/></p><p><button class="ok">\u786e\u5b9a</button><button class="cancel">\u53d6\u6d88</button></p>';
this.Verify=function(){return{isDay:function(a){if(!/^\d+$/i.test(a))return false;a=Number(a);return!(a<1||a>31)},isYear:function(a){if(!/^\d+$/i.test(a))return false;a=Number(a);return!(a<100||a>1E4)},isMonth:function(a){if(!/^\d+$/i.test(a))return false;a=Number(a);return!(a<1||a>12)}}};this._renderUI=function(){var a={};this.HTML="";a.prev="";a.next="";a.title="";a.ds="";a.notlimited="";a.notlimitedClass="";if(!this.prevArrow)a.prev="hidden";if(!this.nextArrow)a.next="hidden";if(!this.father.showTime)a.showtime=
"hidden";if(!this.father.notLimited)a.notlimited="hidden";if(!this.father.multiSelect)a.multiSelect="hidden";if(this.father.showTime&&this.father.notLimited)a.notlimitedCls="ks-cal-notLimited-showTime";if(this.father.notLimited&&!this.father.selected)a.notlimitedCls+=" ks-cal-notLimited-selected";a.id=this.id="ks-cal-"+Math.random().toString().replace(/.\./i,"");a.title=this.father._getHeadStr(this.year,this.month);this.createDS();a.ds=this.ds;this.father.con.append(this.father._templetShow(this.html,
a));this.node=l.one("#"+this.id);if(this.father.showTime){a=this.node.one(".ks-cal-ft");this.timmer=new this.father.TimeSelector(a,this.father)}return this};this.detachEvent=function(){this.EV=this.EV||[];k.each(this.EV,function(a){a&&a.target.detach(a.type,a.fn)})};this._buildEvent=function(){function a(){d.target.on(d.type,d.fn)}var b=this,d,e=l.one("#"+b.id);b.EV=[];if(!b.father.multiSelect){d=b.EV[b.EV.length]={target:e.one("div.ks-dbd"),type:"click",fn:function(c){c.preventDefault();if(c.target.tagName==
"A"){c.target=l(c.target);if(!c.target.hasClass("ks-null"))if(!c.target.hasClass("ks-disabled")){c=new Date(b.year,b.month,Number(c.target.html()));b.father.dt_date=c;b.father.fire("select",{date:c});b.father.popup&&b.father.closable&&!b.father.showTime&&!b.father.rangeSelect&&b.father.hide();b.father.rangeSelect&&b.father._handleRange(c);b.father.render({selected:c})}}}};a()}d=b.EV[b.EV.length]={target:e.one("a.ks-prev-month"),type:"click",fn:function(c){c.preventDefault();b.father.rangeLinkage||
b._monthMinus();b.father._monthMinus().render();b.father.fire("monthChange",{date:new Date(b.father.year+"/"+(b.father.month+1)+"/01")})}};a();d=b.EV[b.EV.length]={target:e.one("a.ks-next-month"),type:"click",fn:function(c){c.preventDefault();b.father.rangeLinkage||b._monthAdd();b.father._monthAdd().render();b.father.fire("monthChange",{date:new Date(b.father.year+"/"+(b.father.month+1)+"/01")})}};a();d=b.EV[b.EV.length]={target:e.one("a.ks-prev-year"),type:"click",fn:function(c){c.preventDefault();
b.father.rangeLinkage||b._yearMinus();b.father._yearMinus().render();b.father.fire("monthChange",{date:new Date(b.father.year+"/"+(b.father.month+1)+"/01")})}};a();d=b.EV[b.EV.length]={target:e.one("a.ks-next-year"),type:"click",fn:function(c){c.preventDefault();b.father.rangeLinkage||b._yearAdd();b.father._yearAdd().render();b.father.fire("monthChange",{date:new Date(b.father.year+"/"+(b.father.month+1)+"/01")})}};a();if(b.father.navigator){d=b.EV[b.EV.length]={target:e.one("a.ks-title"),type:"click",
fn:function(c){try{b.timmer.hidePopup();c.preventDefault()}catch(g){}c.target=l(c.target);c=e.one(".ks-setime");c.html("");var i=b.father._templetShow(b.nav_html,{the_month:b.month+1,the_year:b.year});c.html(i);c.removeClass("hidden");e.one("input").on("keydown",function(j){j.target=l(j.target);if(j.keyCode==38){j.target.val(Number(j.target.val())+1);j.target[0].select()}if(j.keyCode==40){j.target.val(Number(j.target.val())-1);j.target[0].select()}if(j.keyCode==13){j=e.one(".ks-setime").one("select").val();
var o=e.one(".ks-setime").one("input").val();e.one(".ks-setime").addClass("hidden");if(b.Verify().isYear(o))if(b.Verify().isMonth(j)){b.father.render({date:new Date(o+"/"+j+"/01")});b.father.fire("monthChange",{date:new Date(o+"/"+j+"/01")})}}})}};a();d=b.EV[b.EV.length]={target:e.one(".ks-setime"),type:"click",fn:function(c){c.preventDefault();c.target=l(c.target);if(c.target.hasClass("ok")){c=e.one(".ks-setime").one("select").val();var g=e.one(".ks-setime").one("input").val();e.one(".ks-setime").addClass("hidden");
if(b.Verify().isYear(g))if(b.Verify().isMonth(c)){b.father.render({date:new Date(g+"/"+c+"/01")});b.father.fire("monthChange",{date:new Date(g+"/"+c+"/01")})}}else c.target.hasClass("cancel")&&e.one(".ks-setime").addClass("hidden")}};a()}if(b.father.notLimited){d=b.EV[b.EV.length]={target:e.one(".ks-cal-notLimited"),type:"click",fn:function(c){c.preventDefault();b.father.range={start:null,end:null};b.father.fire("select",{date:null});b.father.popup&&b.father.closable&&b.father.hide();b.father.render({selected:null})}};
a()}if(b.father.multiSelect){d=b.EV[b.EV.length]={target:e.one("div.ks-dbd"),type:"mousedown",fn:function(c){c.preventDefault();if(c.target.tagName=="A"){c.target=l(c.target);if(!c.target.hasClass("ks-null"))if(!c.target.hasClass("ks-disabled")){c=new Date(b.year,b.month,Number(c.target.html()));b.father._handleMultiSelectStart(c)}}}};a();d=b.EV[b.EV.length]={target:e.one("div.ks-dbd"),type:"mouseup",fn:function(c){c.preventDefault();if(c.target.tagName=="A"){c.target=l(c.target);if(!c.target.hasClass("ks-null"))if(!c.target.hasClass("ks-disabled")){c=
new Date(b.year,b.month,Number(c.target.html()));b.father._handleMultiSelectEnd(c)}}}};a();d=b.EV[b.EV.length]={target:e.one(".ks-multi-select-btn"),type:"click",fn:function(c){c.preventDefault();b.father._handleMultiSelect()}};a()}return this};this._monthAdd=function(){if(this.month==11){this.year++;this.month=0}else this.month++};this._monthMinus=function(){if(this.month===0){this.year--;this.month=11}else this.month--};this._yearAdd=function(){this.year++};this._yearMinus=function(){this.year--};
this._getNode=function(){return this.node};this._getNumOfDays=function(a,b){return 32-(new Date(a,b-1,32)).getDate()};this._isDisabled=function(a,b){if(a&&a.length>0)for(var d=0;d<a.length;d++){var e=a[d];if(b.getFullYear()==e.getFullYear()&&b.getMonth()==e.getMonth()&&b.getDate()==e.getDate())return true}return false};this.isInMulit=function(a,b){if(a&&a.length>0)for(var d=0;d<a.length;d++){var e=a[d].split("-");if(b.getFullYear()==parseInt(e[0],10)&&b.getMonth()==parseInt(e[1],10)-1&&b.getDate()==
parseInt(e[2],10))return true}return false};this.createDS=function(){var a="",b=(7-this.father.startDay+(new Date(this.year+"/"+(this.month+1)+"/01")).getDay())%7,d=this._getNumOfDays(this.year,this.month+1),e=this.father.selected,c=new Date,g;for(g=0;g<b;g++)a+='<a href="javascript:void(0);" class="ks-null">0</a>';for(g=1;g<=d;g++){b="";var i=new Date(this.year,this.month,g);if(this.father.minDate&&new Date(this.year,this.month,g+1)<this.father.minDate||this.father.maxDate&&i>this.father.maxDate||
this._isDisabled(this.father.disabled,i))b="ks-disabled";else if(this.father.range&&i>=this.father.range.start&&i<=this.father.range.end)b="ks-range";else if(e&&e.getFullYear()==this.year&&e.getMonth()==this.month&&e.getDate()==g||this.isInMulit(this.father.multi,i))b="ks-selected";if(c.getFullYear()==this.year&&c.getMonth()==this.month&&c.getDate()==g)b+=" ks-today";a+="<a "+(b?"class="+b:"")+' href="javascript:void(0);">'+g+"</a>"}this.ds=a;return this};this.render=function(){this._renderUI();this._buildEvent();
return this}}});return m},{requires:["ua","node","calendar/base"]});
KISSY.add("calendar/time",function(k,n,l){k.augment(l,{TimeSelector:function(m,h){this.father=h;this.fcon=m.parent(".ks-cal-box");this.popupannel=this.fcon.one(".ks-selectime");if(typeof h._time=="undefined")h._time=new Date;this.time=h._time;this.status="s";this.ctime=n('<div class="ks-cal-time">\u65f6\u95f4\uff1a<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--\><div class="cta"><button class="u"></button><button class="d"></button></div><!--arrow}}--\></div>');this.button=
n('<button class="ct-ok">\u786e\u5b9a</button>');this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];this.m_a=["00","10","20","30","40","50"];this.s_a=["00","10","20","30","40","50"];this.parseSubHtml=function(f){for(var a="",b=0;b<f.length;b++)a+='<a href="javascript:void(0);" class="item">'+f[b]+"</a>";a+='<a href="javascript:void(0);" class="x">x</a>';return a};this.showPopup=function(f){this.popupannel.html(f);this.popupannel.removeClass("hidden");
f=this.status;this.ctime.all("span").removeClass("on");switch(f){case "h":this.ctime.all(".h").addClass("on");break;case "m":this.ctime.all(".m").addClass("on");break;case "s":this.ctime.all(".s").addClass("on")}};this.hidePopup=function(){this.popupannel.addClass("hidden")};this.render=function(){var f=this.get("h"),a=this.get("m"),b=this.get("s");this.father._time=this.time;this.ctime.all(".h").html(f);this.ctime.all(".m").html(a);this.ctime.all(".s").html(b);return this};this.set=function(f,a){a=
Number(a);switch(f){case "h":this.time.setHours(a);break;case "m":this.time.setMinutes(a);break;case "s":this.time.setSeconds(a)}this.render()};this.get=function(f){var a=this.time;switch(f){case "h":return a.getHours();case "m":return a.getMinutes();case "s":return a.getSeconds()}};this.add=function(){var f=this.status,a=this.get(f);a++;this.set(f,a)};this.minus=function(){var f=this.status,a=this.get(f);a--;this.set(f,a)};this._init=function(){var f=this;m.html("").append(f.ctime);m.append(f.button);
f.render();f.popupannel.on("click",function(a){a=n(a.target);if(a.hasClass("x"))f.hidePopup();else if(a.hasClass("item")){a=Number(a.html());f.set(f.status,a);f.hidePopup()}});f.button.on("click",function(){var a=typeof f.father.dt_date=="undefined"?f.father.date:f.father.dt_date;a.setHours(f.get("h"));a.setMinutes(f.get("m"));a.setSeconds(f.get("s"));f.father.fire("timeSelect",{date:a});f.father.popup&&f.father.closable&&f.father.hide()});f.ctime.on("keyup",function(a){if(a.keyCode==38||a.keyCode==
37){a.preventDefault();f.add()}if(a.keyCode==40||a.keyCode==39){a.preventDefault();f.minus()}});f.ctime.one(".u").on("click",function(){f.hidePopup();f.add()});f.ctime.one(".d").on("click",function(){f.hidePopup();f.minus()});f.ctime.one(".h").on("click",function(){var a=f.parseSubHtml(f.h_a);f.status="h";f.showPopup(a)});f.ctime.one(".m").on("click",function(){var a=f.parseSubHtml(f.m_a);f.status="m";f.showPopup(a)});f.ctime.one(".s").on("click",function(){var a=f.parseSubHtml(f.s_a);f.status="s";
f.showPopup(a)})};this._init()}});return l},{requires:["node","calendar/base"]});
