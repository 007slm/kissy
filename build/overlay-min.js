/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 9 16:26
*/
KISSY.add("overlay/base",function(d,c,b){function a(a){var h=a.get("el"),i=d.all,h=h[0].cloneNode(!0);h.style.visibility="";h.style.overflow="hidden";h.className+=" "+a.get("prefixCls")+"overlay-ghost";var e;if(e=a.get("body"))a=i("."+a.get("prefixCls")+"stdmod-body",h),a.css({height:e.height(),width:e.width()}),a.html("");return i(h)}function i(j,h,i){j.__effectGhost&&j.__effectGhost.stop(1);var e=j.get("el"),k=d.all,b=j.get("effect"),c=k(b.target),k=b.duration,c=d.mix(c.offset(),{width:c.width(),
height:c.height()}),f=d.mix(e.offset(),{width:e.width(),height:e.height()}),g=a(j),b=b.easing;g.insertAfter(e);e.hide();h?(h=c,c=f):h=f;g.css(h);j.__effectGhost=g;g.animate(c,{duration:k,easing:b,complete:function(){j.__effectGhost=null;g.remove();e.show();i()}})}function f(a,h,c){var d=a.get("el"),b=a.get("effect"),g=b.effect||e,f=b.target;if(g==e&&!f)c();else if(f)i(a,h,c);else{var a=b.duration,b=b.easing,l=d.css("visibility"),f=h?1:0;d.stop(1,1);d.css({visibility:"visible",display:h?"none":"block"});
d[g+k[g][f]](a,function(){d.css({display:"block",visibility:l});c()},b)}}function g(a){return d.require("component/uibase/"+a)}var e="none",k={fade:["Out","In"],slide:["Up","Down"]};return c.Controller.extend([g("content-box"),g("position"),g("loading"),g("align"),g("close"),g("resize"),g("mask")],{_uiSetVisible:function(a){var e=this;e.get("rendered")&&f(e,a,function(){e.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var e=
a.effect;"string"==typeof e&&!k[e]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:b}}},{xclass:"overlay",priority:10})},{requires:["component","./overlay-render"]});
KISSY.add("overlay/dialog-render",function(d,c){return c.extend([d.require("component/uibase/stdmod-render")],{createDom:function(){var b=this.get("el"),a,i=this.get("header");if(!(a=i.attr("id")))i.attr("id",a=d.guid("ks-dialog-header"));b.attr("role","dialog").attr("aria-labelledby",a);b.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render"]});
KISSY.add("overlay/dialog",function(d,c,b,a){var i=a.all,f=c.extend([d.require("component/uibase/stdmod"),d.require("component/uibase/drag")],{initializer:function(){var a=this,b;if((b=a.get("draggable"))&&!b.handlers)b.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(e){if(this.get("escapeToClose")&&e.keyCode===a.KeyCodes.ESC){if("select"!=e.target.nodeName.toLowerCase()||e.target.disabled)this.close(),e.halt()}else a:if(e.keyCode==g){var b=this.get("el"),d=i(e.target),
c=b.last();if(d.equals(b)&&e.shiftKey)c[0].focus(),e.halt();else if(d.equals(c)&&!e.shiftKey)b[0].focus(),e.halt();else if(d.equals(b)||b.contains(d))break a;e.halt()}},_uiSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());f.superclass._uiSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:b},focusable:{value:!0},
escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),g=a.KeyCodes.TAB;return f},{requires:["./base","./dialog-render","node"]});KISSY.add("overlay/overlay-render",function(d,c,b){function a(a){return d.require("component/uibase/"+a)}return b.Render.extend([a("content-box-render"),a("position-render"),a("loading-render"),6===c.ie?a("shim-render"):null,a("close-render"),a("mask-render")])},{requires:["ua","component"]});
KISSY.add("overlay",function(d,c,b,a,i,f){c.Render=b;a.Render=i;c.Dialog=a;d.Dialog=a;c.Popup=f;return d.Overlay=c},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(d,c,b){return c.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),f;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();f=d.later(function(){a._showing(c);f=b},1E3*a.get("mouseDelay"))};c.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){f&&
(f.cancel(),f=b);a._setHiddenTimer()};c.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=d.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=b)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](b);else a._showing(b)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",d.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",b);this.hide()},destructor:function(){var a,b=this.get("trigger");b&&(this.__clickPopup&&b.detach("click",this.__clickPopup),this.__mouseEnterPopup&&b.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&b.detach("mouseleave",this._mouseLeavePopup));(a=this.get("el"))&&a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return d.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
