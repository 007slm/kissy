/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 22 19:11
*/
KISSY.add("overlay/base",function(e,f,b,a,c,d,g,h){function k(a){var b=a.get("el"),c=e.all,b=b[0].cloneNode(!0);b.style.visibility="";b.style.overflow="hidden";b.className+=" "+a.get("prefixCls")+"overlay-ghost";var g;if(g=a.get("body"))a=c("."+a.get("prefixCls")+"stdmod-body",b),a.css({height:g.height(),width:g.width()}),a.html("");return c(b)}function i(a,b,g){a.__effectGhost&&a.__effectGhost.stop(1);var c=a.get("el"),h=e.all,d=a.get("effect"),i=h(d.target),h=d.duration,i=e.mix(i.offset(),{width:i.width(),
height:i.height()}),f=e.mix(c.offset(),{width:c.width(),height:c.height()}),j=k(a),d=d.easing;j.insertAfter(c);c.hide();b?(b=i,i=f):b=f;j.css(b);a.__effectGhost=j;j.animate(i,{duration:h,easing:d,complete:function(){a.__effectGhost=null;j.remove();c.show();g()}})}function j(a,b,c){var g=a.get("el"),d=a.get("effect"),h=d.effect||m,e=d.target;if(h==m&&!e)c();else if(e)i(a,b,c);else{var a=d.duration,d=d.easing,f=g.css("visibility"),e=b?1:0;g.stop(1,1);g.css({visibility:"visible",display:b?"none":"block"});
g[h+l[h][e]](a,function(){g.css({display:"block",visibility:f});c()},d)}}var m="none",l={fade:["Out","In"],slide:["Up","Down"]};return f.Controller.extend([b.ContentBox,b.Position,a,b.Align,c,d,g],{_onSetVisible:function(a){var b=this;b.get("rendered")&&j(b,a,function(){b.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=a.effect;"string"==typeof b&&!l[b]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},
closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:h}}},{xclass:"overlay",priority:10})},{requires:"component/base,component/extension,./extension/loading,./extension/close,./extension/resize,./extension/mask,./overlay-render".split(",")});
KISSY.add("overlay/dialog-render",function(e,f,b){return f.extend([b],{createDom:function(){var a=this.get("el"),b,d=this.get("header");if(!(b=d.attr("id")))d.attr("id",b=e.guid("ks-dialog-header"));a.attr("role","dialog").attr("aria-labelledby",b);a.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render","./extension/stdmod-render"]});
KISSY.add("overlay/dialog",function(e,f,b,a,c,d){var g=a.all,h=f.extend([c,d],{initializer:function(){var a=this,b;if((b=a.get("draggable"))&&!b.handlers)b.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(b){if(this.get("escapeToClose")&&b.keyCode===a.KeyCodes.ESC){if("select"!=b.target.nodeName.toLowerCase()||b.target.disabled)this.close(),b.halt()}else a:if(b.keyCode==k){var c=this.get("el"),d=g(b.target),h=c.last();if(d.equals(c)&&b.shiftKey)h[0].focus(),b.halt();
else if(d.equals(h)&&!b.shiftKey)c[0].focus(),b.halt();else if(d.equals(c)||c.contains(d))break a;b.halt()}},_onSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());h.superclass._onSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:b},focusable:{value:!0},escapeToClose:{value:!0}}},{xclass:"dialog",
priority:20}),k=a.KeyCodes.TAB;return h},{requires:["./base","./dialog-render","node","./extension/stdmod","./extension/drag"]});
KISSY.add("overlay/extension/close-render",function(e,f){function b(a){return new f("<a tabindex='0' href='javascript:void(\"\u5173\u95ed\")' role='button' style='z-index:9' class='"+a+c+"close'><span class='"+a+c+"close-x'>\u5173\u95ed</span></a>")}function a(){}var c="ext-";a.ATTRS={closable:{value:!0},closeBtn:{}};a.HTML_PARSER={closeBtn:function(a){return a.one("."+this.get("prefixCls")+c+"close")}};a.prototype={_onSetClosable:function(a){var c=this.get("closeBtn");a?(c||this.setInternal("closeBtn",c=b(this.get("prefixCls"))),
this.get("el").prepend(c)):c&&c.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/extension/close",function(){function e(){}e.ATTRS={closable:{view:1},closeBtn:{view:1},closeAction:{value:"hide"}};var f={hide:"hide",destroy:"destroy"};e.prototype={_onSetClosable:function(b){var a=this;b&&!a.__bindCloseEvent&&(a.__bindCloseEvent=1,a.get("closeBtn").on("click",function(b){a.close();b.preventDefault()}))},close:function(){this[f[this.get("closeAction")]||"hide"]();return this},__destructor:function(){var b=this.get("closeBtn");b&&b.detach()}};return e});
KISSY.add("overlay/extension/drag",function(e){function f(){}f.ATTRS={draggable:{setter:function(b){if(!0===b)return{}},value:{}}};f.prototype={_onSetDraggable:function(b){var a=this,c,d=e.require("dd/base"),g,h,f;h=a.__drag;var i=a.__constrain,j=a.get("el");if(b&&!h&&d){h=d.Draggable;h=a.__drag=new h({node:j,move:1});if(b.proxy&&(c=e.require("dd/proxy")))b.proxy.moveOnEnd=!0,h.plug(new c(b.proxy));h.on("dragend",function(){var b;b=j.offset();a.set("x",b.left);a.set("y",b.top)});(f=b.scroll)&&(g=
e.require("dd/scroll"))&&h.plug(new g(f))}h&&h.set("disabled",!b);if(b&&h){c=b.handlers;if(g=e.require("dd/constrain"))(b=b.constrain)?(i||(i=a.__constrain=new g,h.plug(i)),i.set("constrain",b)):i&&i.set("constrain",!1);c&&0<c.length&&h.set("handlers",c)}},__destructor:function(){var b=this.__drag;b&&b.destroy()}};return f});
KISSY.add("overlay/extension/loading-render",function(e,f){function b(){}b.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new f("<div class='"+this.get("prefixCls")+"ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'/>")).appendTo(this.get("el")));this._loadingExtEl.show()},unloading:function(){var a=this._loadingExtEl;a&&a.hide()}};return b},{requires:["node"]});
KISSY.add("overlay/extension/loading",function(){function e(){}e.prototype={loading:function(){this.get("view").loading();return this},unloading:function(){this.get("view").unloading();return this}};return e});
KISSY.add("overlay/extension/mask-render",function(e,f,b){function a(a){a=a.get("prefixCls")+"ext-mask "+a.getCssClassWithState("-mask");a=g("<div  style='width:"+(d?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(d?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(d?"absolute":"fixed")+";' class='"+a+"'>"+(d?"<iframe style='position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'></iframe>":
"")+"</div>").prependTo("body");a.unselectable();a.on("mousedown",function(a){a.preventDefault()});return a}function c(){}var d=6===f.ie,g=b.all;c.ATTRS={mask:{value:!1},maskNode:{}};c.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",a(this))},__syncUI:function(){this.get("mask")&&this.ksSetMaskVisible(this.get("visible"),1)},ksSetMaskVisible:function(a,b){var c=this.getCssClassWithState("-mask-shown"),g=this.get("maskNode"),d=this.getCssClassWithState("-mask-hidden");a?g.removeClass(d).addClass(c):
g.removeClass(c).addClass(d);b||g.css("visibility",a?"visible":"hidden")},__destructor:function(){var a;(a=this.get("maskNode"))&&a.remove()}};return c},{requires:["ua","node"]});
KISSY.add("overlay/extension/mask",function(e,f){function b(){}b.ATTRS={mask:{view:1},maskNode:{view:1}};var a={fade:["Out","In"],slide:["Up","Down"]};b.prototype={__bindUI:function(){var b=this,d,g,e=b.get("el"),k=b.get("view");if(g=b.get("mask")){d=b.get("maskNode");if(g.hideOnClick)d.on(f.Gesture.tap,function(){b.hide()});b.on("afterVisibleChange",function(b){if(b=b.newVal){var c=parseInt(e.css("z-index"))||1;d.css("z-index",c-1)}c=g.effect||"none";if("none"==c)k.ksSetMaskVisible(b);else{k.ksSetMaskVisible(b,
1);var f=g.duration,l=g.easing,n=b?1:0;d.stop(1,1);d.css("display",b?"none":"block");d[c+a[c][n]](f,null,l)}})}}};return b},{requires:["event"]});KISSY.add("overlay/extension/resize",function(e){function f(){}f.ATTRS={resize:{value:{}}};f.prototype={__destructor:function(){var b=this.resizer;b&&b.destroy()},_onSetResize:function(b){var a=e.require("resizable");this.resizer&&this.resizer.destroy();a&&b&&(b.node=this.get("el"),this.resizer=new a(b))}};return f});
KISSY.add("overlay/extension/stdmod-render",function(e,f){function b(){}function a(a,b){var c=a.get("contentEl"),e=a.get(b);e||(e=new f("<div class='"+a.get("prefixCls")+d+b+"'  ></div>"),e.appendTo(c),a.setInternal(b,e))}function c(a,b,c){b=a.get(b);"string"==typeof c?b.html(c):b.html("").append(c)}var d="stdmod-";b.ATTRS={header:{},body:{},footer:{},bodyStyle:{},footerStyle:{},headerStyle:{},headerContent:{},bodyContent:{},footerContent:{}};b.HTML_PARSER={header:function(a){return a.one("."+this.get("prefixCls")+
d+"header")},body:function(a){return a.one("."+this.get("prefixCls")+d+"body")},footer:function(a){return a.one("."+this.get("prefixCls")+d+"footer")}};b.prototype={__createDom:function(){a(this,"header");a(this,"body");a(this,"footer")},_onSetBodyStyle:function(a){this.get("body").css(a)},_onSetHeaderStyle:function(a){this.get("header").css(a)},_onSetFooterStyle:function(a){this.get("footer").css(a)},_onSetBodyContent:function(a){c(this,"body",a)},_onSetHeaderContent:function(a){c(this,"header",
a)},_onSetFooterContent:function(a){c(this,"footer",a)}};return b},{requires:["node"]});KISSY.add("overlay/extension/stdmod",function(){function e(){}e.ATTRS={header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{view:1},footerStyle:{view:1},headerStyle:{view:1},headerContent:{view:1},bodyContent:{view:1},footerContent:{view:1}};return e});
KISSY.add("overlay/overlay-render",function(e,f,b,a,c,d,g){return b.Render.extend([a.ContentBox.Render,a.Position.Render,c,6===f.ie?a.Shim.Render:null,d,g])},{requires:"ua,component/base,component/extension,./extension/loading-render,./extension/close-render,./extension/mask-render".split(",")});
KISSY.add("overlay",function(e,f,b,a,c,d){f.Render=b;a.Render=c;f.Dialog=a;e.Dialog=a;f.Popup=d;return e.Overlay=f},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(e,f,b){return f.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),d;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();d=e.later(function(){a._showing(c);d=b},1E3*a.get("mouseDelay"))};c.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){d&&
(d.cancel(),d=b);a._setHiddenTimer()};c.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=e.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=b)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](b);else a._showing(b)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",e.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",b);this.hide()},destructor:function(){var a,b=this.get("trigger");b&&(this.__clickPopup&&b.detach("click",this.__clickPopup),this.__mouseEnterPopup&&b.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&b.detach("mouseleave",this._mouseLeavePopup));(a=this.get("el"))&&a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return e.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
