/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 10 13:59
*/
KISSY.add("overlay/base",function(b,c,e){function a(a){var i=a.get("el"),g=b.all,i=i[0].cloneNode(!0);i.style.visibility="";i.style.overflow="hidden";i.className+=" "+a.get("prefixCls")+"overlay-ghost";var d;if(d=a.get("body"))a=g("."+a.get("prefixCls")+"stdmod-body",i),a.css({height:d.height(),width:d.width()}),a.html("");return g(i)}function g(g,d,l){g.__effectGhost&&g.__effectGhost.stop(1);var h=g.get("el"),f=b.all,e=g.get("effect"),c=f(e.target),f=e.duration,c=b.mix(c.offset(),{width:c.width(),
height:c.height()}),m=b.mix(h.offset(),{width:h.width(),height:h.height()}),k=a(g),e=e.easing;k.insertAfter(h);h.hide();d?(d=c,c=m):d=m;k.css(d);g.__effectGhost=k;k.animate(c,{duration:f,easing:e,complete:function(){g.__effectGhost=null;k.remove();h.show();l()}})}function f(a,d,b){var c=a.get("el"),e=a.get("effect"),f=e.effect||l,j=e.target;f==l&&!j?b():j?g(a,d,b):(a=e.duration,e=e.easing,j=d?1:0,c.stop(1,1),c.css({visibility:"visible",display:m[j]}),c[f+h[f][j]](a,function(){c.css({display:m[0],
visibility:d?"visible":"hidden"});b()},e))}function d(a){return b.require("component/uibase/"+a)}var l="none",h={fade:["Out","In"],slide:["Up","Down"]},m=["block",l];return c.Controller.extend([d("content-box"),d("position"),d("loading"),d("align"),d("close"),d("resize"),d("mask")],{_uiSetVisible:function(a){var d=this;d.get("rendered")&&f(d,a,function(){d.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var d=a.effect;b.isString(d)&&
!h[d]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:e}}},{xclass:"overlay",priority:10})},{requires:["component","./overlay-render"]});
KISSY.add("overlay/dialog-render",function(b,c){return c.extend([b.require("component/uibase/stdmod-render")],{createDom:function(){var e=this.get("el"),a,g=this.get("header");if(!(a=g.attr("id")))g.attr("id",a=b.guid("ks-dialog-header"));e.attr("role","dialog").attr("aria-labelledby",a);e.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render"]});
KISSY.add("overlay/dialog",function(b,c,e,a){var g=a.all,f=c.extend([b.require("component/uibase/stdmod"),b.require("component/uibase/drag")],{initializer:function(){var a=this,d;if((d=a.get("draggable"))&&!d.handlers)d.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(b){if(this.get("escapeToClose")&&b.keyCode===a.KeyCodes.ESC){if("select"!=b.target.nodeName.toLowerCase()||b.target.disabled)this.close(),b.halt()}else a:if(b.keyCode==d){var e=this.get("el"),c=g(b.target),
f=e.last();if(c.equals(e)&&b.shiftKey)f[0].focus(),b.halt();else if(c.equals(f)&&!b.shiftKey)e[0].focus(),b.halt();else if(c.equals(e)||e.contains(c))break a;b.halt()}},_uiSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());f.superclass._uiSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:e},focusable:{value:!0},
escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),d=a.KeyCodes.TAB;return f},{requires:["./base","./dialog-render","node"]});KISSY.add("overlay/overlay-render",function(b,c,e){function a(a){return b.require("component/uibase/"+a)}return e.Render.extend([a("content-box-render"),a("position-render"),a("loading-render"),6===c.ie?a("shim-render"):null,a("close-render"),a("mask-render")])},{requires:["ua","component"]});
KISSY.add("overlay",function(b,c,e,a,g,f){c.Render=e;a.Render=g;c.Dialog=a;b.Dialog=a;c.Popup=f;return b.Overlay=c},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(b,c,e){return c.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),f;a.__mouseEnterPopup=function(d){a._clearHiddenTimer();f=b.later(function(){a._showing(d);f=e},1E3*a.get("mouseDelay"))};b.each(c,function(d){b.one(d).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=
function(){f&&(f.cancel(),f=e);a._setHiddenTimer()};b.each(c,function(d){b.one(d).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=b.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=e)},_bindTriggerClick:function(){var a=this;
a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?"_hiding":"_showing"](b);else a._showing(b)};b.each(a.get("trigger"),function(c){b.one(c).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",b.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",e);this.hide()},destructor:function(){var a=this,b,c=a.get("trigger");c&&(a.__clickPopup&&c.each(function(b){b.detach("click",a.__clickPopup)}),a.__mouseEnterPopup&&c.each(function(b){b.detach("mouseenter",
a.__mouseEnterPopup)}),a._mouseLeavePopup&&c.each(function(b){b.detach("mouseleave",a._mouseLeavePopup)}));(b=a.get("el"))&&b.detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,a)}},{ATTRS:{trigger:{setter:function(a){b.isString(a)&&(a=b.all(a));return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
