/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 14 11:47
*/
KISSY.add("overlay/aria",function(c,f){function h(){}h.ATTRS={aria:{view:true}};h.prototype={__bindUI:function(){var g=this,e=g.get("el");g.get("aria")&&e.on("keydown",function(a){if(a.keyCode===f.KeyCodes.ESC){g.hide();a.halt()}})}};return h},{requires:["event"]});
KISSY.add("overlay/ariarender",function(c,f){function h(){}function g(b){var d=b.keyCode,i=this.get("el");if(d==a){d=e(b.target);var j=this.__ariaArchor;if(d.equals(i)&&b.shiftKey){j[0].focus();b.halt()}else if(d.equals(j)&&!b.shiftKey){i[0].focus();b.halt()}else if(d.equals(i)||i.contains(d))return;b.halt()}}var e=f.all,a=f.KeyCodes.TAB;h.prototype={__renderUI:function(){var b=this.get("el"),d=this.get("header");if(this.get("aria")){b.attr("role","dialog");b.attr("tabindex",0);d.attr("id")||d.attr("id",
c.guid("ks-dialog-header"));b.attr("aria-labelledby",d.attr("id"));this.__ariaArchor=e("<div tabindex='0'></div>").appendTo(b)}},__bindUI:function(){var b=this;if(b.get("aria")){var d=b.get("el"),i;b.on("afterVisibleChange",function(j){if(j.newVal){i=d[0].ownerDocument.activeElement;d[0].focus();d.attr("aria-hidden","false");d.on("keydown",g,b)}else{d.attr("aria-hidden","true");d.detach("keydown",g,b);i&&i.focus()}})}}};return h},{requires:["node"]});
KISSY.add("overlay/base",function(c,f,h,g,e){function a(b){return c.require("uibase/"+b)}f=f.create(h.ModelControl,[a("contentbox"),a("position"),a("loading"),a("align"),a("close"),a("resize"),a("mask"),e],{},{ATTRS:{focusable:{value:false},closable:{value:false},handleMouseEvents:{value:false},allowTextSelection_:{value:true},visibleMode:{value:"visibility"}}});f.DefaultRender=g;h.UIStore.setUIByClass("overlay",{priority:h.UIStore.PRIORITY.LEVEL1,ui:f});return f},{requires:["uibase","component",
"./overlayrender","./effect"]});KISSY.add("overlay/dialog",function(c,f,h,g,e,a){c=g.create(h,[c.require("uibase/stdmod"),c.require("uibase/drag"),c.require("uibase/constrain"),a],{},{ATTRS:{closable:{value:true},handlers:{valueFn:function(){var b=this;return[function(){return b.get("view").get("header")}]}}}});c.DefaultRender=e;f.UIStore.setUIByClass("dialog",{priority:f.UIStore.PRIORITY.LEVEL2,ui:c});return c},{requires:["component","overlay/base","uibase","overlay/dialogrender","./aria"]});
KISSY.add("overlay/dialogrender",function(c,f,h,g){return f.create(h,[c.require("uibase/stdmodrender"),g])},{requires:["uibase","./overlayrender","./ariarender"]});
KISSY.add("overlay/effect",function(c){function f(){}var h={fade:["Out","In"],slide:["Up","Down"]},g=["block","none"];f.ATTRS={effect:{value:{effect:"none",duration:0.5,easing:"easeOut"},setter:function(e){var a=e.effect;if(c.isString(a)&&!h[a])e.effect="none"}}};f.prototype={__bindUI:function(){var e=this,a,b=e.get("el");e.on("beforeVisibleChange",function(d){d.newVal||(a={left:b.css("left"),top:b.css("top")})});e.on("afterVisibleChange",function(d){var i=e.get("effect"),j=i.effect,n=i.duration;
i=i.easing;if(j!="none"){var k=d.newVal;d=k?1:0;b.stop(1,1);var m={visibility:"visible",display:g[d]};k||c.mix(m,a);b.css(m);b[j+h[j][d]](n,function(){var l={display:g[0],visibility:k?"visible":"hidden"};if(!k){l.left=-9999;l.top=-9999}b.css(l)},i)}})}};return f},{requires:["anim"]});KISSY.add("overlay",function(c,f,h,g,e,a){f.Render=h;g.Render=e;f.Dialog=g;c.Dialog=g;f.Popup=c.Popup=a;return f},{requires:["overlay/base","overlay/overlayrender","overlay/dialog","overlay/dialogrender","overlay/popup"]});
KISSY.add("overlay/overlayrender",function(c,f,h,g){function e(a){return c.require("uibase/"+a)}return h.create(g.Render,[e("contentboxrender"),e("positionrender"),e("loadingrender"),f.ie===6?e("shimrender"):null,e("closerender"),e("maskrender")])},{requires:["ua","uibase","component"]});
KISSY.add("overlay/popup",function(c,f,h,g){function e(a,b){if(c.isUndefined(b))b=a;else b.srcNode=a;e.superclass.constructor.call(this,b)}e.ATTRS={trigger:{setter:function(a){if(c.isString(a))a=c.all(a);return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:100},toggle:{value:false}};c.extend(e,h,{initializer:function(){var a=this;if(a.get("trigger"))if(a.get("triggerType")==="mouse"){a._bindTriggerMouse();a.on("bindUI",function(){a._bindContainerMouse()})}else a._bindTriggerClick()},
_bindTriggerMouse:function(){var a=this,b=a.get("trigger"),d;a.__mouseEnterPopup=function(i){a._clearHiddenTimer();d=c.later(function(){a._showing(i);d=g},a.get("mouseDelay"))};c.each(b,function(i){c.one(i).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=function(){if(d){d.cancel();d=g}a._setHiddenTimer()};c.each(b,function(i){c.one(i).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,
this)},_setHiddenTimer:function(a){var b=this;b._hiddenTimer=c.later(function(){b._hiding(a)},b.get("mouseDelay"))},_clearHiddenTimer:function(){if(this._hiddenTimer){this._hiddenTimer.cancel();this._hiddenTimer=g}},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();a.get("toggle")?a[a.get("visible")?"_hiding":"_showing"](b):a._showing(b)};c.each(a.get("trigger"),function(b){c.one(b).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",c.one(a.target));
this.show()},_hiding:function(){this.set("currentTrigger",g);this.hide()},destructor:function(){var a=this,b=a.get("trigger");if(b){a.__clickPopup&&c.each(b,function(d){c.one(d).detach("click",a.__clickPopup)});a.__mouseEnterPopup&&c.each(b,function(d){c.one(d).detach("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup&&c.each(b,function(d){c.one(d).detach("mouseleave",a._mouseLeavePopup)})}a.get("el")&&a.get("el").detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,
a)}});f.UIStore.setUIByClass("popup",{priority:f.UIStore.PRIORITY.LEVEL1,ui:e});return e},{requires:["component","./base"]});
