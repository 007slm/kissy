/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 15 14:05
*/
KISSY.add("overlay/base",function(c,d,e){function a(a){var i=a.get("el"),g=c.all,i=i[0].cloneNode(!0);i.style.visibility="";i.style.overflow="hidden";i.className+=" "+a.get("prefixCls")+"overlay-ghost";var b;if(b=a.get("body"))a=g("."+a.get("prefixCls")+"stdmod-body",i),a.css({height:b.height(),width:b.width()}),a.html("");return g(i)}function g(g,b,l){g.__effectGhost&&g.__effectGhost.stop(1);var h=g.get("el"),f=c.all,e=g.get("effect"),d=f(e.target),f=e.duration,d=c.mix(d.offset(),{width:d.width(),
height:d.height()}),m=c.mix(h.offset(),{width:h.width(),height:h.height()}),k=a(g),e=e.easing;k.insertAfter(h);h.hide();b?(b=d,d=m):b=m;k.css(b);g.__effectGhost=k;k.animate(d,{duration:f,easing:e,complete:function(){g.__effectGhost=null;k.remove();h.show();l()}})}function f(a,b,c){var d=a.get("el"),e=a.get("effect"),f=e.effect||l,j=e.target;f==l&&!j?c():j?g(a,b,c):(a=e.duration,e=e.easing,j=b?1:0,d.stop(1,1),d.css({visibility:"visible",display:m[j]}),d[f+h[f][j]](a,function(){d.css({display:m[0],
visibility:b?"visible":"hidden"});c()},e))}function b(a){return c.require("component/uibase/"+a)}var l="none",h={fade:["Out","In"],slide:["Up","Down"]},m=["block",l];return d.Controller.extend([b("content-box"),b("position"),b("loading"),b("align"),b("close"),b("resize"),b("mask")],{_uiSetVisible:function(a){var b=this;b.get("rendered")&&f(b,a,function(){b.fire(a?"show":"hide")})}},{ATTRS:{effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=a.effect;"string"==
typeof b&&!h[b]&&(a.effect="")}},focusable:{value:!1},allowTextSelection:{value:!0},closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:e}}},{xclass:"overlay",priority:10})},{requires:["component","./overlay-render"]});
KISSY.add("overlay/dialog-render",function(c,d){return d.extend([c.require("component/uibase/stdmod-render")],{createDom:function(){var e=this.get("el"),a,g=this.get("header");if(!(a=g.attr("id")))g.attr("id",a=c.guid("ks-dialog-header"));e.attr("role","dialog").attr("aria-labelledby",a);e.append("<div tabindex='0' style='position:absolute;'></div>")}})},{requires:["./overlay-render"]});
KISSY.add("overlay/dialog",function(c,d,e,a){var g=a.all,f=d.extend([c.require("component/uibase/stdmod"),c.require("component/uibase/drag")],{initializer:function(){var a=this,b;if((b=a.get("draggable"))&&!b.handlers)b.handlers=[function(){return a.get("header")}]},handleKeyEventInternal:function(c){if(this.get("escapeToClose")&&c.keyCode===a.KeyCodes.ESC){if("select"!=c.target.nodeName.toLowerCase()||c.target.disabled)this.close(),c.halt()}else a:if(c.keyCode==b){var e=this.get("el"),d=g(c.target),
f=e.last();if(d.equals(e)&&c.shiftKey)f[0].focus(),c.halt();else if(d.equals(f)&&!c.shiftKey)e[0].focus(),c.halt();else if(d.equals(e)||e.contains(d))break a;c.halt()}},_uiSetVisible:function(a){var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus&&b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus());f.superclass._uiSetVisible.apply(this,arguments)}},{ATTRS:{closable:{value:!0},xrender:{value:e},focusable:{value:!0},
escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),b=a.KeyCodes.TAB;return f},{requires:["./base","./dialog-render","node"]});KISSY.add("overlay/overlay-render",function(c,d,e){function a(a){return c.require("component/uibase/"+a)}return e.Render.extend([a("content-box-render"),a("position-render"),a("loading-render"),6===d.ie?a("shim-render"):null,a("close-render"),a("mask-render")])},{requires:["ua","component"]});
KISSY.add("overlay",function(c,d,e,a,g,f){d.Render=e;a.Render=g;d.Dialog=a;c.Dialog=a;d.Popup=f;return c.Overlay=d},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(c,d,e){return d.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,d=a.get("trigger"),f;a.__mouseEnterPopup=function(b){a._clearHiddenTimer();f=c.later(function(){a._showing(b);f=e},1E3*a.get("mouseDelay"))};c.each(d,function(b){c.one(b).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=
function(){f&&(f.cancel(),f=e);a._setHiddenTimer()};c.each(d,function(b){c.one(b).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=c.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=e)},_bindTriggerClick:function(){var a=this;
a.__clickPopup=function(c){c.halt();if(a.get("toggle"))a[a.get("visible")?"_hiding":"_showing"](c);else a._showing(c)};c.each(a.get("trigger"),function(d){c.one(d).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",c.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",e);this.hide()},destructor:function(){var a=this,c,d=a.get("trigger");d&&(a.__clickPopup&&d.each(function(b){b.detach("click",a.__clickPopup)}),a.__mouseEnterPopup&&d.each(function(b){b.detach("mouseenter",
a.__mouseEnterPopup)}),a._mouseLeavePopup&&d.each(function(b){b.detach("mouseleave",a._mouseLeavePopup)}));(c=a.get("el"))&&c.detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,a)}},{ATTRS:{trigger:{setter:function(a){"string"==typeof a&&(a=c.all(a));return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
