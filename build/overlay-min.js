/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Sep 6 21:55
*/
KISSY.add("overlay/base",function(b,e,d,a){function c(a){return b.require("component/uibase/"+a)}return e.Controller.extend([c("contentbox"),c("position"),c("loading"),c("align"),c("close"),c("resize"),c("mask"),a],{},{ATTRS:{focusable:{value:!1},allowTextSelection:{value:!0},closable:{value:!1},handleMouseEvents:{value:!1},xrender:{value:d}}},{xclass:"overlay",priority:10})},{requires:["component","./overlay-render","./effect"]});
KISSY.add("overlay/dialog-render",function(b,e){return e.extend([b.require("component/uibase/stdmodrender")],{createDom:function(){var d=this.get("el"),a,c=this.get("header");if(!(a=c.attr("id")))c.attr("id",a=b.guid("ks-dialog-header"));d.attr("role","dialog").attr("aria-labelledby",a);d.append("<div tabindex='0'></div>")}})},{requires:["./overlay-render"]});
KISSY.add("overlay/dialog",function(b,e,d,a){var c=a.all,f=e.extend([b.require("component/uibase/stdmod"),b.require("component/uibase/drag")],{initializer:function(){var a;if((a=this.get("draggable"))&&!a.handlers)a.handlers=[this.get("header")]},handleKeyEventInternal:function(b){if(b.keyCode===a.KeyCodes.ESC)this.hide(),b.halt();else a:{var d=b.keyCode,f=this.get("el");if(d==g){var d=c(b.target),n=f.last();if(d.equals(f)&&b.shiftKey)n[0].focus(),b.halt();else if(d.equals(n)&&!b.shiftKey)f[0].focus(),
b.halt();else if(d.equals(f)||f.contains(d))break a;b.halt()}}},_uiSetVisible:function(a){f.superclass._uiSetVisible.apply(this,arguments);var b=this.get("el");a?(this.__lastActive=b[0].ownerDocument.activeElement,b[0].focus(),b.attr("aria-hidden","false")):(b.attr("aria-hidden","true"),this.__lastActive&&this.__lastActive.focus())}},{ATTRS:{closable:{value:!0},xrender:{value:d},focusable:{value:!0}}},{xclass:"dialog",priority:20}),g=a.KeyCodes.TAB;return f},{requires:["./base","./dialog-render",
"node"]});
KISSY.add("overlay/effect",function(b,e,d){function a(){}function c(a){var c=a.get("el"),f=b.all,c=c[0].cloneNode(!0);c.style.visibility="";c.style.overflow="hidden";c.className+=" "+a.get("prefixCls")+"overlay-ghost";var g;if(g=a.get("body"))a=d.get("."+a.get("prefixCls")+"-stdmod-body",c),f(a).css({height:g.height(),width:g.width()}),a.innerHTML="";return f(c)}function f(a,f){a.__effectGhost&&a.__effectGhost.stop(1);var d=a.get("el"),g=b.all,e=a.get("effect"),h=g(e.target),g=e.duration,h=b.mix(h.offset(),
{width:h.width(),height:h.height()}),k=b.mix(d.offset(),{width:d.width(),height:d.height()}),i=c(a),j=e.easing;i.insertAfter(d);d.hide();f?(e=h,h=k):e=k;i.css(e);a.__effectGhost=i;i.animate(h,{duration:g,easing:j,complete:function(){a.__effectGhost=null;i[0].parentNode.removeChild(i[0]);d.show()}})}function g(a,b){var c=a.get("el"),d=a.get("effect"),g=d.effect||j,e=d.target;if(g!=j||e)if(e)f(a,b);else{var e=d.duration,d=d.easing,k=b?1:0;c.stop(1,1);c.css({visibility:"visible",display:m[k]});c[g+l[g][k]](e,
function(){c.css({display:m[0],visibility:b?"visible":"hidden"})},d)}}var j="none",l={fade:["Out","In"],slide:["Up","Down"]},m=["block",j];a.ATTRS={effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var c=a.effect;b.isString(c)&&!l[c]&&(a.effect="")}}};a.prototype={__bindUI:function(){var a=this;a.on("hide",function(){g(a,0)});a.on("show",function(){g(a,1)})}};return a},{requires:["anim","dom"]});
KISSY.add("overlay/overlay-render",function(b,e,d){function a(a){return b.require("component/uibase/"+a)}return d.Render.extend([a("contentboxrender"),a("positionrender"),a("loadingrender"),6===e.ie?a("shimrender"):null,a("closerender"),a("maskrender")])},{requires:["ua","component"]});KISSY.add("overlay",function(b,e,d,a,c,f){e.Render=d;a.Render=c;e.Dialog=a;b.Dialog=a;e.Popup=f;return b.Overlay=e},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(b,e,d){return e.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),f;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();f=b.later(function(){a._showing(c);f=d},1E3*a.get("mouseDelay"))};b.each(c,function(c){b.one(c).on("mouseenter",a.__mouseEnterPopup)});a._mouseLeavePopup=
function(){f&&(f.cancel(),f=d);a._setHiddenTimer()};b.each(c,function(c){b.one(c).on("mouseleave",a._mouseLeavePopup)})},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=b.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=d)},_bindTriggerClick:function(){var a=this;
a.__clickPopup=function(c){c.halt();if(a.get("toggle"))a[a.get("visible")?"_hiding":"_showing"](c);else a._showing(c)};b.each(a.get("trigger"),function(c){b.one(c).on("click",a.__clickPopup)})},_showing:function(a){this.set("currentTrigger",b.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",d);this.hide()},destructor:function(){var a=this,c,b=a.get("trigger");b&&(a.__clickPopup&&b.each(function(b){b.detach("click",a.__clickPopup)}),a.__mouseEnterPopup&&b.each(function(b){b.detach("mouseenter",
a.__mouseEnterPopup)}),a._mouseLeavePopup&&b.each(function(b){b.detach("mouseleave",a._mouseLeavePopup)}));(c=a.get("el"))&&c.detach("mouseleave",a._setHiddenTimer,a).detach("mouseenter",a._clearHiddenTimer,a)}},{ATTRS:{trigger:{setter:function(a){b.isString(a)&&(a=b.all(a));return a}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
