/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event/base",function(o,f,l,i){function m(c,d,a,e,b){if((a=o.trim(a))&&a.indexOf(x)>0){o.each(a.split(x),function(k){p[c](d,k,e,b)});return true}return i}function g(c){return c&&c.nodeType!==3&&c.nodeType!==8}var j=document,r=j.addEventListener?function(c,d,a,e){c.addEventListener&&c.addEventListener(d,a,!!e)}:function(c,d,a){c.attachEvent&&c.attachEvent("on"+d,a)},n=j.removeEventListener?function(c,d,a,e){c.removeEventListener&&c.removeEventListener(d,a,!!e)}:function(c,d,a){c.detachEvent&&
c.detachEvent("on"+d,a)},x=" ",t="ksEventTargetId"+o.now(),p={EVENT_GUID:t,special:{},add:function(c,d,a,e){if(m("add",c,d,a,e))return c;f.query(c).each(function(b){var k=!b.isCustomEventTarget,h,q,s;if(!(!b||!d||!o.isFunction(a)||k&&!g(b))){(h=f.data(b,t))||f.data(b,t,h={});q=h.events=h.events||{};s=h.handler;if(!s){s=h.handler=function(v,w){var y=s.target;if(!v||!v.fixed)v=new l(y,v);o.isPlainObject(w)&&o.mix(v,w);return p._handle(y,v)};s.target=b}var u=q[d];h=p.special[d]||{};if(!u){u=q[d]=[];
if((!h.setup||h.setup.call(b)===false)&&k)r(b,d,s)}u.push({fn:a,scope:e||b});b=null}});return c},__getListeners:function(c,d){return(p.__getEvents(c)||{})[d]||[]},__getEvents:function(c){return(c=f.data(c,t))&&c.events},remove:function(c,d,a,e){if(m("remove",c,d,a,e))return c;f.query(c).each(function(b){var k=f.data(b,t),h=k&&k.events,q,s,u,v,w,y=!b.isCustomEventTarget,z=y&&p.special[d]||{};if(!(!b||!y&&!g(b)||!h))if(d===i)for(d in h)p.remove(b,d,i,i);else{e=e||b;if(q=h[d]){s=q.length;if(o.isFunction(a)&&
s){v=u=0;for(w=[];u<s;++u)if(a!==q[u].fn||e!==q[u].scope)w[v++]=q[u];h[d]=w;s=w.length}if(a===i||s===0){if(y)if(!z.tearDown||z.tearDown.call(b)===false)n(b,d,k.handler);delete h[d]}}if(o.isEmptyObject(h)){k.handler.target=null;delete k.handler;delete k.events;f.removeData(b,t)}}});return c},_handle:function(c,d){for(var a=p.__getListeners(c,d.type).slice(0),e,b,k=0,h=a.length;k<h;++k){e=a[k];e=e.fn.call(e.scope,d);if(b!==false)b=e;e!==i&&e===false&&d.halt();if(d.isImmediatePropagationStopped)break}return b},
fire:function(c,d,a){var e;f.query(c).each(function(b){var k=!b.isCustomEventTarget;a=a||{};a.type=d;if(k){if(g(b)){k=new l(b,a);var h=k.target=b,q="on"+d;do{var s=(f.data(h,t)||{}).handler;k.currentTarget=h;s&&s.call(h,k);if(h[q]&&h[q].call(h)===false){e=false;k.preventDefault()}h=h.parentNode||h.ownerDocument||h===b.ownerDocument&&window}while(h&&!k.isPropagationStopped);if(!k.isDefaultPrevented)if(!(d!=="click"&&b.nodeName.toLowerCase()=="a")){var u;try{if(q&&b[d]){if(u=b[q])b[q]=null;b[d]()}}catch(v){}if(u)b[q]=
u}}}else if((b=f.data(b,t))&&o.isFunction(b.handler))e=b.handler(i,a)});return e},_simpleAdd:r,_simpleRemove:n};p.on=p.add;p.detach=p.remove;return p},{requires:["dom","event/object"]});
KISSY.add("event/focusin",function(o,f,l){f.ie||o.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(i){function m(j){l.fire(j.target,i.name)}var g=0;l.special[i.name]={setup:function(){g++===0&&document.addEventListener(i.fix,m,true)},tearDown:function(){--g===0&&document.removeEventListener(i.fix,m,true)}}});return l},{requires:["ua","./base"]});
KISSY.add("event/mouseenter",function(o,f,l,i){i.ie||o.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(m){function g(j){var r=this,n=j.relatedTarget;j.type=m.name;try{if(!(n&&n!==document&&!n.parentNode)){n=l.closest(n,function(t){return t==r});n!==r&&f._handle(r,j)}}catch(x){}}f.special[m.name]={setup:function(){f.add(this,m.fix,g)},tearDown:function(){f.remove(this,m.fix,g)}}});return f},{requires:["./base","dom","ua"]});
KISSY.add("event/object",function(o,f){function l(g,j,r){this.currentTarget=g;this.originalEvent=j||{};if(j){this.type=j.type;this._fix()}else{this.type=r;this.target=g}this.currentTarget=g;this.fixed=true}var i=document,m="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
o.augment(l,{_fix:function(){var g=this.originalEvent,j=m.length,r,n=this.currentTarget;for(n=n.nodeType===9?n:n.ownerDocument||i;j;){r=m[--j];this[r]=g[r]}if(!this.target)this.target=this.srcElement||i;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===f&&this.clientX!==f){g=n.documentElement;j=n.body;this.pageX=this.clientX+(g&&g.scrollLeft||j&&j.scrollLeft||
0)-(g&&g.clientLeft||j&&j.clientLeft||0);this.pageY=this.clientY+(g&&g.scrollTop||j&&j.scrollTop||0)-(g&&g.clientTop||j&&j.clientTop||0)}if(this.which===f)this.which=this.charCode!==f?this.charCode:this.keyCode;if(this.metaKey===f)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==f)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var g=this.originalEvent;if(g.preventDefault)g.preventDefault();else g.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var g=
this.originalEvent;if(g.stopPropagation)g.stopPropagation();else g.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var g=this.originalEvent;g.stopImmediatePropagation?g.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(g){g?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});return l});
KISSY.add("event/target",function(o,f){return{isCustomEventTarget:true,fire:function(l,i){return f.fire(this,l,i)},on:function(l,i,m){f.add(this,l,i,m);return this},detach:function(l,i,m){f.remove(this,l,i,m);return this}}},{requires:["event/base","dom"]});
KISSY.add("event/valuechange",function(o,f,l){function i(a){var e=l.data(a,t);if(!e){e=+new Date;l.data(a,t,e)}return e}function m(a){a=i(a);delete p[a];if(c[a]){clearTimeout(c[a]);delete c[a]}}function g(a){m(a.target)}function j(a){var e=i(a);c[e]||(c[e]=setTimeout(function(){var b=a.value;if(b!==p[e]){f._handle(a,{type:x,prevVal:p[e],newVal:b});p[e]=b}c[e]=setTimeout(arguments.callee,d)},d))}function r(a){var e=a.target;if(a.type=="focus"){a=i(e);p[a]=e.value}j(e)}function n(a){m(a);f.remove(a,
"blur",g);f.remove(a,"mousedown keyup keydown focus",r);l.removeData(a,t)}var x="valueChange",t="event/valuechange",p={},c={},d=50;f.special[x]={fix:false,setup:function(){var a=this.nodeName.toLowerCase();if("input"==a||"textarea"==a){n(this);f.on(this,"blur",g);f.on(this,"mousedown keyup keydown focus",r)}},tearDown:function(a){a=this;n(a)}};return f},{requires:["./base","dom"]});
KISSY.add("event",function(o,f,l){f.Target=l;return f},{requires:["event/base","event/target","event/object","event/focusin","event/mouseenter"]});
