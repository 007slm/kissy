/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event/base",function(o,d,l,j){function m(a,b,i){if((i=o.trim(i))&&i.indexOf(v)>0){var p=o.makeArray(arguments);o.each(i.split(v),function(n){var h=o.clone(p);h.splice(0,3,b,n);s[a].apply(s,h)});return true}return j}function c(a){return a&&a.nodeType!==3&&a.nodeType!==8}var k=document,f=k.addEventListener?function(a,b,i,p){a.addEventListener&&a.addEventListener(b,i,!!p)}:function(a,b,i){a.attachEvent&&a.attachEvent("on"+b,i)},g=k.removeEventListener?function(a,b,i,p){a.removeEventListener&&
a.removeEventListener(b,i,!!p)}:function(a,b,i){a.detachEvent&&a.detachEvent("on"+b,i)},v=" ",t="",u="trigger-none-"+o.now(),e="ksEventTargetId"+o.now(),s={EVENT_GUID:e,special:{},add:function(a,b,i,p,n){if(m("add",a,b,i,p,n))return a;d.query(a).each(function(h){var q=!h.isCustomEventTarget,r,y,w;if(!(!h||!b||!o.isFunction(i)||q&&!c(h))){(r=d.data(h,e))||d.data(h,e,r={});y=r.events=r.events||{};w=r.handler;if(!w){w=r.handler=function(x,z){if(!(x&&x.type==t)){var C=w.target;if(!x||!x.fixed)x=new l(C,
x);o.isPlainObject(z)&&o.mix(x,z);return s._handle(C,x)}};w.target=h}var A=y[b];r=s.special[b]||{};if(!A){A=y[b]=[];if((!r.setup||r.setup.call(h)===false)&&q)f(h,b,w)}q={fn:i,scope:p||h,data:n};r.add&&r.add.call(h,q);A.push(q);h=null}});return a},__getListeners:function(a,b){return(s.__getEvents(a)||{})[b]||[]},__getEvents:function(a){return(a=d.data(a,e))&&a.events},remove:function(a,b,i,p,n){if(m("remove",a,b,i,p))return a;d.query(a).each(function(h){var q=d.data(h,e),r=q&&q.events,y,w,A,x,z,C=
!h.isCustomEventTarget,E=C&&s.special[b]||{};if(!(!h||!C&&!c(h)||!r))if(b===j)for(b in r)s.remove(h,b);else{p=p||h;if(y=r[b]){w=y.length;if(o.isFunction(i)&&w){x=A=0;for(z=[];A<w;++A){var F=false,B=y[A];if(i!==B.fn||p!==B.scope){z[x++]=B;F=true}else if(n!==D){var D=B.data;if(!n&&D||D&&!n){z[x++]=B;F=true}else if(n&&D)if(!n.equals||!D.equals)o.error("no equals in data");else if(!n.equals(D)){z[x++]=B;F=true}}!F&&E.remove&&E.remove.call(h,B)}r[b]=z;w=z.length}if(i===j||w===0){if(C)if(!E.tearDown||E.tearDown.call(h)===
false)g(h,b,q.handler);delete r[b]}}if(o.isEmptyObject(r)){q.handler.target=null;delete q.handler;delete q.events;d.removeData(h,e)}}});return a},_handle:function(a,b){for(var i=s.__getListeners(a,b.type).slice(0),p,n,h=0,q=i.length;h<q;++h){p=i[h];p=p.fn.call(p.scope,b,p.data);if(p!==j)if(p===false){n=p;b.halt()}if(b.isImmediatePropagationStopped)break}return n},fire:function(a,b,i){if(!m("fire",a,b,i)){var p;d.query(a).each(function(n){var h=!n.isCustomEventTarget;i=i||{};i.type=b;if(h){if(c(n)){h=
new l(n,i);var q=h.target=n,r="on"+b;do{var y=(d.data(q,e)||{}).handler;h.currentTarget=q;y&&y.call(q,h);if(q[r]&&q[r].call(q)===false){p=false;h.preventDefault()}q=q.parentNode||q.ownerDocument||q===n.ownerDocument&&window}while(q&&!h.isPropagationStopped);if(!h.isDefaultPrevented)if(!(b==="click"&&n.nodeName.toLowerCase()=="a")){var w;try{if(r&&n[b]){if(w=n[r])n[r]=null;t=b;n[b]()}}catch(A){}if(w)n[r]=w;t=u}}}else if((n=d.data(n,e))&&o.isFunction(n.handler))p=n.handler(j,i)});return p}},_batchForType:m,
_simpleAdd:f,_simpleRemove:g};s.on=s.add;s.detach=s.remove;return s},{requires:["dom","event/object"]});
KISSY.add("event/delegate",function(o,d,l){function j(f){return this.fn==f.fn&&this.selector==f.selector&&this.scope==f.scope}function m(f,g){var v,t=d.closest(f.target,[g.selector],this);if(t)for(var u=0;u<t.length;u++){f.currentTarget=t[u];var e=g.fn.call(g.scope||this,f);if(e===false||f.isPropagationStopped||f.isImmediatePropagationStopped){if(e===false)v=e;if(f.isPropagationStopped||f.isImmediatePropagationStopped)break}}return v}var c=l._batchForType,k={focus:"focusin",blur:"focusout"};o.mix(l,
{delegate:function(f,g,v,t,u){if(c("delegate",f,g,v,t,u))return f;d.query(f).each(function(e){if(!e.isCustomEventTarget){g=k[g]||g;l.on(e,g,m,e,{fn:t,selector:v,scope:u,equals:j})}});return f},undelegate:function(f,g,v,t,u){if(c("undelegate",f,g,v,t,u))return f;d.query(f).each(function(e){if(!e.isCustomEventTarget){g=k[g]||g;l.remove(e,g,m,e,{fn:t,selector:v,scope:u,equals:j})}})}});return l},{requires:["dom","./base"]});
KISSY.add("event/focusin",function(o,d,l){d.ie||o.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(j){function m(k){return l.fire(k.target,j.name)}var c=0;l.special[j.name]={setup:function(){c++===0&&document.addEventListener(j.fix,m,true)},tearDown:function(){--c===0&&document.removeEventListener(j.fix,m,true)}}});return l},{requires:["ua","./base"]});
KISSY.add("event/hashchange",function(o,d,l,j){j=document.documentMode||j.ie;if(!("onhashchange"in window)||j<8){var m,c=[],k=u();d.special.hashchange={setup:function(){-1===o.indexOf(this,c)&&c.push(this);m||f()},tearDown:function(){var e=o.indexOf(this,c);e>=0&&c.splice(e,1);if(c.length===0){m&&clearTimeout(m);m=null}}};var f=function(){g()},g=function(){var e=u();if(e!==k){v(e);k=e}m=setTimeout(g,50)},v=function(e){t(e)},t=function(){for(var e=0;e<c.length;e++)d._handle(c[e],{type:"hashchange"})},
u=function(){return"#"+location.href.replace(/^[^#]*#?(.*)$/,"$1")};j<8&&function(){var e;f=function(){if(!e){e=l.create('<iframe style="display: none" height="0" width="0" tabindex="-1" title="empty"/>');l.prepend(e,document.documentElement);d.add(e,"load",function(){d.remove(e,"load");v(u());d.add(e,"load",s);g()});var s=function(){var a=o.trim(e.contentWindow.document.body.innerHTML),b=u();if(a!=b)k=location.hash=a;t(a)}}};v=function(s){s="<html><body>"+s+"</body></html>";var a=e.contentWindow.document;
try{a.open();a.write(s);a.close();return true}catch(b){return false}}}()}},{requires:["./base","dom","ua"]});
KISSY.add("event/mouseenter",function(o,d,l,j){j.ie||o.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(m){function c(k){var f=this,g=k.relatedTarget;k.type=m.name;try{if(!(g&&g!==document&&!g.parentNode)){g=l.closest(g,function(t){return t==f});g!==f&&d._handle(f,k)}}catch(v){}}d.special[m.name]={setup:function(){d.add(this,m.fix,c)},tearDown:function(){d.remove(this,m.fix,c)}}});return d},{requires:["./base","dom","ua"]});
KISSY.add("event/object",function(o,d){function l(c,k,f){this.currentTarget=c;this.originalEvent=k||{};if(k){this.type=k.type;this._fix()}else{this.type=f;this.target=c}this.currentTarget=c;this.fixed=true}var j=document,m="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
o.augment(l,{_fix:function(){var c=this.originalEvent,k=m.length,f,g=this.currentTarget;for(g=g.nodeType===9?g:g.ownerDocument||j;k;){f=m[--k];this[f]=c[f]}if(!this.target)this.target=this.srcElement||j;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===d&&this.clientX!==d){c=g.documentElement;k=g.body;this.pageX=this.clientX+(c&&c.scrollLeft||k&&k.scrollLeft||
0)-(c&&c.clientLeft||k&&k.clientLeft||0);this.pageY=this.clientY+(c&&c.scrollTop||k&&k.scrollTop||0)-(c&&c.clientTop||k&&k.clientTop||0)}if(this.which===d)this.which=this.charCode!==d?this.charCode:this.keyCode;if(this.metaKey===d)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==d)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var c=this.originalEvent;if(c.preventDefault)c.preventDefault();else c.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var c=
this.originalEvent;if(c.stopPropagation)c.stopPropagation();else c.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var c=this.originalEvent;c.stopImmediatePropagation?c.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(c){c?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});return l});
KISSY.add("event/target",function(o,d){return{isCustomEventTarget:true,fire:function(l,j){return d.fire(this,l,j)},on:function(l,j,m){d.add(this,l,j,m);return this},detach:function(l,j,m){d.remove(this,l,j,m);return this}}},{requires:["event/base","dom"]});
KISSY.add("event/valuechange",function(o,d,l){function j(a){var b=l.data(a,t);if(!b){b=+new Date;l.data(a,t,b)}return b}function m(a){a=j(a);delete u[a];if(e[a]){clearTimeout(e[a]);delete e[a]}}function c(a){m(a.target)}function k(a){var b=j(a);e[b]||(e[b]=setTimeout(function(){var i=a.value;if(i!==u[b]){d._handle(a,{type:v,prevVal:u[b],newVal:i});u[b]=i}e[b]=setTimeout(arguments.callee,s)},s))}function f(a){var b=a.target;if(a.type=="focus"){a=j(b);u[a]=b.value}k(b)}function g(a){m(a);d.remove(a,
"blur",c);d.remove(a,"mousedown keyup keydown focus",f);l.removeData(a,t)}var v="valueChange",t="event/valuechange",u={},e={},s=50;d.special[v]={fix:false,setup:function(){var a=this.nodeName.toLowerCase();if("input"==a||"textarea"==a){g(this);d.on(this,"blur",c);d.on(this,"mousedown keyup keydown focus",f)}},tearDown:function(){g(this)}};return d},{requires:["./base","dom"]});
KISSY.add("event",function(o,d,l){d.Target=l;return d},{requires:["event/base","event/target","event/object","event/focusin","event/hashchange","event/valuechange","event/delegate","event/mouseenter"]});
