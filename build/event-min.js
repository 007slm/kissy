/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("event/base",function(h,f,k,l){function i(a,b,e,m,j){if(h.isString(b))b=f.query(b);if(h.isArray(b)){h.each(b,function(n){c[a](n,e,m,j)});return true}if((e=h.trim(e))&&e.indexOf(u)>0){h.each(e.split(u),function(n){c[a](b,n,m,j)});return true}return l}function d(a){return p(a)?f.data(a,v):-1}function g(a,b){p(a)&&f.data(a,v,b)}function o(a){f.removeData(a,v)}function p(a){return a&&a.nodeType!==3&&a.nodeType!==8}var D=document,B=D.addEventListener?function(a,b,e,m){a.addEventListener&&a.addEventListener(b,
e,!!m)}:function(a,b,e){a.attachEvent&&a.attachEvent("on"+b,e)},C=D.removeEventListener?function(a,b,e,m){a.removeEventListener&&a.removeEventListener(b,e,!!m)}:function(a,b,e){a.detachEvent&&a.detachEvent("on"+b,e)},v="ksEventTargetId",u=" ",w=h.now(),x={},c={EVENT_GUID:v,special:{},add:function(a,b,e,m){if(!i("add",a,b,e,m)){var j=d(a),n,r,s,y,t;if(!(j===-1||!b||!h.isFunction(e))){if(!j){g(a,j=w++);x[j]={target:a,events:{}}}r=x[j].events;if(!r[b]){n=((j=!a.isCustomEventTarget)||a._supportSpecialEvent)&&
c.special[b]||{};s=function(q,z){if(!q||!q.fixed)q=new k(a,q,b);if(h.isPlainObject(z)){var A=q.type;h.mix(q,z);q.type=A}n.setup&&n.setup(q);return(n.handle||c._handle)(a,q)};r[b]={handle:s,listeners:[]};y=n.fix||b;t=n.capture;n.init&&n.init.apply(null,h.makeArray(arguments));j&&n.fix!==false&&B(a,y,s,t)}r[b].listeners.push({fn:e,scope:m||a})}}},__getListeners:function(a,b){var e=[];if(a=(c.__getEvents(a)||{})[b])e=a.listeners;return e},__getEvents:function(a){var b=d(a),e;if(b!==-1)if(b&&(e=x[b]))if(e.target===
a)return e.events||{}},remove:function(a,b,e,m){if(!i("remove",a,b,e,m)){var j=c.__getEvents(a),n=d(a),r,s,y,t,q,z,A=(!a.isCustomEventTarget||a._supportSpecialEvent)&&c.special[b]||{};if(j!==l){m=m||a;if(r=j[b]){s=r.listeners;y=s.length;if(h.isFunction(e)&&y){q=t=0;for(z=[];t<y;++t)if(e!==s[t].fn||m!==s[t].scope)z[q++]=s[t];r.listeners=z;y=z.length}if(e===l||y===0){if(!a.isCustomEventTarget){A=c.special[b]||{};if(A.fix!==false)C(a,A.fix||b,r.handle)}delete j[b]}}A.destroy&&A.destroy.apply(null,h.makeArray(arguments));
if(b===l||h.isEmptyObject(j)){for(b in j)c.remove(a,b);delete x[n];o(a)}}}},_handle:function(a,b){a=c.__getListeners(a,b.type);a=a.slice(0);for(var e,m,j=0,n=a.length;j<n;++j){e=a[j];e=e.fn.call(e.scope,b);if(m!==false)m=e;if(e!==l){b.result=e;e===false&&b.halt()}if(b.isImmediatePropagationStopped)break}return m},_getCache:function(a){return x[a]},__getID:d,_simpleAdd:B,_simpleRemove:C};c.on=c.add;return c},{requires:["dom","event/object"]});
KISSY.add("event/focusin",function(h,f){document.addEventListener&&h.each([{name:"focusin",fix:"focus"},{name:"focusout",fix:"blur"}],function(k){f.special[k.name]={fix:k.fix,capture:true,setup:function(l){l.type=k.name}}})},{requires:["event/base"]});
KISSY.add("event/mouseenter",function(h,f,k,l){l.ie||h.each([{name:"mouseenter",fix:"mouseover"},{name:"mouseleave",fix:"mouseout"}],function(i){f.special[i.name]={fix:i.fix,setup:function(d){d.type=i.name},handle:function(d,g){if(k._isKSNode(d))d=d[0];var o=g.relatedTarget;try{for(;o&&o!==d;)o=o.parentNode;o!==d&&f._handle(d,g)}catch(p){}}}})},{requires:["event/base","dom","ua"]});
KISSY.add("event/object",function(h,f){function k(d,g,o){this.currentTarget=d;this.originalEvent=g||{};if(g){this.type=g.type;this._fix()}else{this.type=o;this.target=d}this.currentTarget=d;this.fixed=true}var l=document,i="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
h.augment(k,{_fix:function(){var d=this.originalEvent,g=i.length,o,p=this.currentTarget;for(p=p.nodeType===9?p:p.ownerDocument||l;g;){o=i[--g];this[o]=d[o]}if(!this.target)this.target=this.srcElement||l;if(this.target.nodeType===3)this.target=this.target.parentNode;if(!this.relatedTarget&&this.fromElement)this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement;if(this.pageX===f&&this.clientX!==f){d=p.documentElement;g=p.body;this.pageX=this.clientX+(d&&d.scrollLeft||g&&g.scrollLeft||
0)-(d&&d.clientLeft||g&&g.clientLeft||0);this.pageY=this.clientY+(d&&d.scrollTop||g&&g.scrollTop||0)-(d&&d.clientTop||g&&g.clientTop||0)}if(this.which===f)this.which=this.charCode!==f?this.charCode:this.keyCode;if(this.metaKey===f)this.metaKey=this.ctrlKey;if(!this.which&&this.button!==f)this.which=this.button&1?1:this.button&2?3:this.button&4?2:0},preventDefault:function(){var d=this.originalEvent;if(d.preventDefault)d.preventDefault();else d.returnValue=false;this.isDefaultPrevented=true},stopPropagation:function(){var d=
this.originalEvent;if(d.stopPropagation)d.stopPropagation();else d.cancelBubble=true;this.isPropagationStopped=true},stopImmediatePropagation:function(){var d=this.originalEvent;d.stopImmediatePropagation?d.stopImmediatePropagation():this.stopPropagation();this.isImmediatePropagationStopped=true},halt:function(d){d?this.stopImmediatePropagation():this.stopPropagation();this.preventDefault()}});return k});
KISSY.add("event/target",function(h,f,k,l){return{isCustomEventTarget:true,fire:function(i,d){var g=k.data(this,f.EVENT_GUID)||-1;if((i=((f._getCache(g)||{}).events||{})[i])&&h.isFunction(i.handle))return i.handle(l,d)},on:function(i,d,g){f.add(this,i,d,g);return this},detach:function(i,d,g){f.remove(this,i,d,g);return this}}},{requires:["event/base","dom"]});
KISSY.add("event/valuechange",function(h,f,k){function l(c){var a=k.data(c,v);if(!a){a=+new Date;k.data(c,v,a)}return a}function i(c){k.removeData(c,v)}function d(c){c=l(c);delete u[c];if(w[c]){clearTimeout(w[c]);delete w[c]}}function g(c){d(c.target)}function o(c){var a=l(c);w[a]||(w[a]=setTimeout(function(){var b=c.value;if(b!==u[a]){f._handle(c,{type:C,preVal:u[a],newVal:b});u[a]=b}w[a]=setTimeout(arguments.callee,x)},x))}function p(c){var a=c.target;if(c.type=="focus"){c=l(a);u[c]=a.value}o(a)}
function D(c){B(c);f.on(c,"blur",g);f.on(c,"mousedown keyup keydown focus",p)}function B(c){d(c);f.remove(c,"blur",g);f.remove(c,"mousedown keyup keydown focus",p);i(c)}var C="valueChange",v="event/valuechange",u={},w={},x=50;f.special[C]={fix:false,init:function(c){var a=c.nodeName.toLowerCase();if("input"==a||"textarea"==a)D(c)},destroy:function(c,a){f.__getEvents(c)[a]||B(c)}}},{requires:["event/base","dom"]});
KISSY.add("event",function(h,f,k){f.Target=k;return f},{requires:["event/base","event/target","event/object","event/focusin","event/mouseenter"]});
