/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 7 00:30
*/
KISSY.add("menubutton/base",function(b,d,g,m,j,n,i){function f(c,e){var a=c.get("menu");if(b.isFunction(a))if(e)a=a.call(c),c.__set("menu",a);else return null;if(a.xclass)if(e)a=n.create(a,c),c.__set("menu",a);else return null;a&&a.get("parent")!==c&&(a.__set("parent",c),c.bindMenu());return a}function a(c){var a=new j.PopupMenu(b.mix({prefixCls:c.get("prefixCls")},c.get("menuCfg")));c.__set("menu",a);c.bindMenu();return a}function h(){var c=f(this);c&&c.get("visible")&&c.set("align",b.merge({node:this.get("el")},
o,this.get("menuAlign")))}var p=b.Env.host,q=d.all,k=d.KeyCodes,o={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},l=g.extend([n.DecorateChild],{getMenu:function(c){return f(this,c)},initializer:function(){this._reposition=b.buffer(h,50,this)},_uiSetCollapsed:function(c){if(c)(c=f(this))&&c.hide();else{var c=this.get("el"),a=f(this,1);a&&!a.get("visible")&&(a.set("align",b.merge({node:c},o,this.get("menuAlign"))),a.show(),c.attr("aria-haspopup",a.get("el").attr("id")))}},bindMenu:function(){var c=
this,a=f(c);a&&(a.on("afterActiveItemChange",function(a){c.set("activeItem",a.newVal)}),a.on("click",c.handleMenuClick,c),q(p).on("resize",c._reposition,c),c.bindMenu=b.noop)},handleMenuClick:function(a){this.fire("click",{target:a.target})},bindUI:function(){this.bindMenu()},handleKeyEventInternal:function(a){var e=f(this);if(a.keyCode==k.SPACE){if(a.preventDefault(),"keyup"!=a.type)return i}else if("keydown"!=a.type)return i;return e&&e.get("visible")?(e=e.handleKeydown(a),a.keyCode==k.ESC?(this.set("collapsed",
!0),!0):e):a.keyCode==k.SPACE||a.keyCode==k.DOWN||a.keyCode==k.UP?(this.set("collapsed",!1),!0):i},performActionInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlur:function(a){l.superclass.handleBlur.call(this,a);this.set("collapsed",!0)},addItem:function(c,e){(f(this,1)||a(this)).addChild(c,e)},removeItem:function(a,e){var h=f(this);h&&h.removeChild(a,e)},removeItems:function(a){var e=f(this);e&&e.removeChildren(a)},getItemAt:function(a){var e=f(this);return e&&e.getChildAt(a)},
_uiSetDisabled:function(a){!a&&this.set("collapsed",!0)},decorateChildrenInternal:function(a,e){e.css("visibility","hidden");b.one(e[0].ownerDocument.body).prepend(e);this.__set("menu",new a(b.mix({srcNode:e,prefixCls:this.get("prefixCls")},this.get("menuCfg"))))},destructor:function(){var a=this.get("menu");q(p).detach("resize",this._reposition,this);a&&a.destroy&&a.destroy()}},{ATTRS:{activeItem:{view:!0},menuAlign:{value:{}},menuCfg:{},decorateChildCls:{value:"popupmenu"},menu:{},collapsed:{value:!0,
view:!0},xrender:{value:m}}},{xclass:"menu-button",priority:20});return l},{requires:["node","button","./menubuttonRender","menu","component"]});KISSY.add("menubutton",function(b,d,g,m,j){d.Render=g;d.Select=m;d.Option=j;return d},{requires:["menubutton/base","menubutton/menubuttonRender","menubutton/select","menubutton/option"]});
KISSY.add("menubutton/menubuttonRender",function(b,d){return d.Render.extend({createDom:function(){var g=this.get("el"),d=b.substitute('<div class="ks-inline-block ks-menu-button-caption">{content}</div><div class="ks-inline-block ks-menu-button-dropdown"><div class="ks-menu-button-dropdown-inner"></div></div>',{content:this.get("html")});g.html(d).attr("aria-haspopup",!0)},_uiSetHtml:function(b){var d=this.get("el").one(".ks-menu-button-caption");d.html("");b&&d.append(b)},_uiSetCollapsed:function(b){var d=
this.get("el"),j=this.getCssClassWithPrefix("menu-button-open");d[b?"removeClass":"addClass"](j).attr("aria-expanded",!b)},_uiSetActiveItem:function(b){this.get("el").attr("aria-activedescendant",b&&b.get("el").attr("id")||"")}},{ATTRS:{activeItem:{},collapsed:{}}})},{requires:["button"]});
KISSY.add("menubutton/option",function(b,d){var g=d.Item.extend({handleBlur:function(){return g.superclass.handleBlur.apply(this,arguments)}},{ATTRS:{selectable:{value:!0}}},{xclass:"option",priority:10});return g},{requires:["menu"]});
KISSY.add("menubutton/select",function(b,d,g,m,j,n){function i(a){return(a=a.getMenu(1).render())&&a.get("children")||[]}var f=g.extend({bindMenu:function(){var a=this.getMenu();f.superclass.bindMenu.call(this);if(a)a.on("show",this._handleMenuShow,this)},_handleMenuShow:function(){var a=this.get("menu");a.set("highlightedItem",this.get("selectedItem")||a.getChildAt(0))},_updateCaption:function(){var a=this.get("selectedItem");this.set("html",a?a.get("html"):this.get("defaultCaption"))},handleMenuClick:function(a){var a=
a.target,b=this.get("selectedItem");this.set("selectedItem",a);this.set("collapsed",!0);this.fire("click",{target:a,prevTarget:b})},removeItems:function(){f.superclass.removeItems.apply(this,arguments);this.set("selectedItem",null)},removeItem:function(a){f.superclass.removeItem.apply(this,arguments);a==this.get("selectedItem")&&this.set("selectedItem",null)},_uiSetSelectedItem:function(a,b){b&&b.prevVal&&b.prevVal.set("selected",!1);this._updateCaption()},_uiSetDefaultCaption:function(){this._updateCaption()}},
{ATTRS:{value:{getter:function(){var a=this.get("selectedItem");return a&&a.get("value")},setter:function(a){if(null!=a)for(var b=i(this),d=0;d<b.length;d++){var f=b[d];if(f.get&&f.get("value")==a){this.set("selectedItem",f);return}}this.set("selectedItem",null);return null}},selectedItem:{},selectedIndex:{setter:function(a){var b=i(this);if(0>a||a>=b.length)return-1;this.set("selectedItem",b[a])},getter:function(){return b.indexOf(this.get("selectedItem"),i(this))}},defaultCaption:{value:""}},decorate:function(a,
h){a=b.one(a);h=h||{};h.elBefore=a;var g;g=h.width||a.outerWidth();var i=[],k=null,j=a.val();a.all("option").each(function(a){var b={content:a.text(),elCls:a.attr("class"),value:a.val(),xclass:"option"};j==a.val()&&(k={content:b.content,value:b.value});i.push(b)});b.mix(h,{width:g,menu:b.mix({width:g,xclass:"popupmenu",children:i},h.menuCfg)});delete h.menuCfg;var l=new f(b.mix(h,k));l.render();if(g=a.attr("name")){var c=(new d("<input type='hidden' name='"+g+"' value='"+j+"'>")).insertBefore(a,n);
l.on("afterSelectedItemChange",function(a){a.newVal?c.val(a.newVal.get("value")):c.val("")})}a.remove();return l}},{xclass:"select",priority:30});return f},{requires:["node","./base","menu","./option"]});
