/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Aug 3 19:05
*/
KISSY.add("menubutton/menubutton",function(d,i,j,f,h,l,k){var c=j.all,e=i.create(f,[k.DecorateChild],{hideMenu:function(){this.get("menu")&&this.get("menu").hide()},showMenu:function(){var a=this.get("view"),b=a.get("el"),g=this.get("menu");if(!g.get("visible")){g.set("align",d.mix({node:b},this.get("menuAlign")));g.show();b.attr("aria-haspopup",g.get("el").attr("id"));a.set("collapsed",false)}},_reposition:function(){var a=this.get("menu"),b=this.get("el");a&&a.get("visible")&&a.set("align",d.mix({node:b},
this.get("menuAlign")))},bindUI:function(){var a=this,b=this.get("menu");b.on("afterActiveItemChange",function(g){a.set("activeItem",g.newVal)});b.on("click",function(g){a.fire("click",{target:g.target})});b.on("hide",function(){a.get("view").set("collapsed",true)});c(window).on("resize",a._reposition,a)},_handleKeyEventInternal:function(a){var b=this.get("menu");if(a.keyCode==32){a.preventDefault();if(a.type!="keyup")return}else if(a.type!="keydown")return;if(b&&b.get("visible")){b=b._handleKeydown(a);
if(a.keyCode==27){this.hideMenu();return true}return b}if(a.keyCode==38||a.keyCode==40||a.keyCode==32){this.showMenu();return true}},_performInternal:function(){this.get("menu").get("visible")?this.hideMenu():this.showMenu()},_handleBlur:function(a){e.superclass._handleBlur.call(this,a);this.hideMenu()},getMenu:function(){var a=this.get("menu");if(!a){a=new l.PopupMenu(d.mix({prefixCls:this.get("prefixCls")},this.get("menuCfg")));this.set("menu",a)}return a},addItem:function(a,b){this.getMenu().addChild(a,
b)},removeItem:function(a,b){this.get("menu")&&this.get("menu").removeChild(a,b)},removeItems:function(a){this.get("menu")&&this.get("menu").removeChildren(a)},getItemAt:function(a){return this.get("menu")&&this.get("menu").getChildAt(a)},_uiSetDisabled:function(a){var b=e.superclass._uiSetDisabled;b&&b.apply(this,d.makeArray(arguments));!a&&this.hideMenu()},decorateInternalX:function(a){var b=this.get("prefixCls");this.set("el",a);var g=a.one("."+this.getCls("popupmenu"));if(g){g.hide();d.one(a[0].ownerDocument.body).prepend(g);
this.set("menu",new (k.UIStore.getUIByClass("popupmenu"))({srcNode:g,prefixCls:b}))}},decorateChildrenInternal:function(a){var b=a.get("el");b.hide();d.one(b[0].ownerDocument.body).prepend(b);this.set("menu",a)},destructor:function(){var a=this.get("menu");c(window).detach("resize",this._reposition,this);a&&a.destroy()}},{ATTRS:{activeItem:{view:true},menuAlign:{value:{points:["bl","tl"],overflow:{failX:1,failY:1,adjustX:1,adjustY:1}}},decorateChildCls:{value:"popupmenu"},menu:{setter:function(a){a.set("parent",
this)}}},DefaultRender:h});return e},{requires:["uibase","node","button","./menubuttonrender","menu","component"]});
KISSY.add("menubutton/menubuttonrender",function(d,i,j){return i.create(j.Render,{createDom:function(){var f=this.get("innerEl"),h=d.substitute('<div class="{prefixCls}inline-block {prefixCls}menu-button-caption">{content}</div><div class="{prefixCls}inline-block {prefixCls}menu-button-dropdown">&nbsp;</div>',{content:this.get("content")||"",prefixCls:this.get("prefixCls")});f.html(h).attr("aria-haspopup",true)},_uiSetContent:function(f){var h=this.get("el").one("."+this.getCls("menu-button-caption"));
h.html("");h.append(f)},_uiSetCollapsed:function(f){var h=this.get("el"),l=this.getCls("menu-button-open");if(f){h.removeClass(l);h.attr("aria-expanded",false)}else{h.addClass(l);h.attr("aria-expanded",true)}},_uiSetActiveItem:function(f){this.get("el").attr("aria-activedescendant",f&&f.get("el").attr("id")||"")}},{ATTRS:{activeItem:{},collapsed:{value:true}}})},{requires:["uibase","button"]});
KISSY.add("menubutton/option",function(d,i,j,f){d=i.create(f.Item,{renderUI:function(){this.get("el").addClass(this.getCls("option"))}},{ATTRS:{selectable:{value:true}}});j.UIStore.setUIByClass("option",{priority:10,ui:d});return d},{requires:["uibase","component","menu"]});
KISSY.add("menubutton/select",function(d,i,j,f,h,l){var k=j.create(f,{bindUI:function(){this.on("click",this.handleMenuClick,this);this.get("menu").on("show",this._handleMenuShow,this)},_handleMenuShow:function(){this.get("menu").set("highlightedItem",this.get("selectedItem")||this.get("menu").getChildAt(0))},updateCaption_:function(){var c=this.get("selectedItem");this.set("content",c?c.get("content"):this.get("defaultCaption"))},handleMenuClick:function(c){this.set("selectedItem",c.target);this.hideMenu()},
removeItems:function(){k.superclass.removeItems.apply(this,arguments);this.set("selectedItem",null)},removeItem:function(c){k.superclass.removeItem.apply(this,arguments);c==this.get("selectedItem")&&this.set("selectedItem",null)},_uiSetSelectedItem:function(c,e){e&&e.prevVal&&e.prevVal.set("selected",false);this.updateCaption_()},_uiSetDefaultCaption:function(){this.updateCaption_()}},{ATTRS:{value:{getter:function(){var c=this.get("selectedItem");return c&&c.get("value")},setter:function(c){for(var e=
this.get("menu").get("children"),a=0;a<e.length;a++){var b=e[a];if(b.get("value")==c){this.set("selectedItem",b);return}}this.set("selectedItem",null);return null}},selectedItem:{},selectedIndex:{setter:function(c){var e=this.get("menu").get("children");if(c<0||c>=e.length)return-1;this.set("selectedItem",e[c])},getter:function(){return d.indexOf(this.get("selectedItem"),this.get("menu").get("children"))}},defaultCaption:{value:""}}});k.decorate=function(c,e){c=d.one(c);var a=new h.PopupMenu(d.mix({prefixCls:e.prefixCls},
e.menuCfg)),b,g=c.val();c.all("option").each(function(m){var o=new l({content:m.text(),prefixCls:e.prefixCls,value:m.val()});if(g==m.val())b=o;a.addChild(o)});var n=new k(d.mix({selectedItem:b,menu:a},e));n.render();n.get("el").insertBefore(c);var p;if(p=c.attr("name")){var q=(new i("<input type='hidden' name='"+p+"' value='"+g+"'>")).insertBefore(c);n.on("afterSelectedItemChange",function(m){m.newVal?q.val(m.newVal.get("value")):q.val("")})}c.remove();return n};return k},{requires:["node","uibase",
"./menubutton","menu","./option"]});KISSY.add("menubutton",function(d,i,j,f,h){i.Render=j;i.Select=f;i.Option=h;return i},{requires:["menubutton/menubutton","menubutton/menubuttonrender","menubutton/select","menubutton/option"]});
