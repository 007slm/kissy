/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Apr 23 12:03
*/
KISSY.add("menubutton/base",function(d,f,g,c,i,k,l,m){function e(b,a){var c=b.get("menu");if(d.isFunction(c))if(a)c=c.call(b),b.__set("menu",c);else return null;c&&c.get("parent")!==b&&(c.__set("parent",b),b.__bindMenu());return c}function h(){var b=e(this);b&&b.get("visible")&&b.set("align",d.merge({node:this.get("el")},o,this.get("menuAlign")))}var a=d.Env.host,p=g.all,n=g.KeyCodes,o={points:["bl","tl"],overflow:{failX:1,failY:1,adjustX:1,adjustY:1}},j=f.create(c,[l.DecorateChild],{_getMenu:function(b){return e(this,
b)},initializer:function(){this._reposition=d.buffer(h,50,this)},_hideMenu:function(){var b=e(this);b&&b.hide()},_showMenu:function(){var b=this.get("el"),a=e(this,1);a&&!a.get("visible")&&(a.set("align",d.merge({node:b},o,this.get("menuAlign"))),a.show(),b.attr("aria-haspopup",a.get("el").attr("id")))},_uiSetCollapsed:function(b){b?this._hideMenu():this._showMenu()},__bindMenu:function(){var b=this,c=e(b);c&&(c.on("afterActiveItemChange",function(a){b.set("activeItem",a.newVal)}),c.on("click",b._handleMenuClick,
b),p(a).on("resize",b._reposition,b),b.__bindMenu=d.noop)},_handleMenuClick:function(b){this.fire("click",{target:b.target})},bindUI:function(){this.__bindMenu()},handleKeyEventInternal:function(b){var a=e(this);if(b.keyCode==n.SPACE){if(b.preventDefault(),"keyup"!=b.type)return m}else if("keydown"!=b.type)return m;return a&&a.get("visible")?(a=a.handleKeydown(b),b.keyCode==n.ESC?(this.set("collapsed",!0),!0):a):b.keyCode==n.SPACE||b.keyCode==n.DOWN||b.keyCode==n.UP?(this.set("collapsed",!1),!0):
m},performActionInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlur:function(b){j.superclass.handleBlur.call(this,b);this.set("collapsed",!0)},constructMenu:function(){var b=new k.PopupMenu(d.mix({prefixCls:this.get("prefixCls")},this.get("menuCfg")));this.__set("menu",b);this.__bindMenu();return b},getMenu:function(){var b=e(this);b||(b=this.constructMenu());return b},addItem:function(b,a){this.getMenu().addChild(b,a)},removeItem:function(b,a){var c=e(this);c&&c.removeChild(b,
a)},removeItems:function(b){var a=e(this);a&&a.removeChildren(b)},getItemAt:function(b){var a=e(this);return a&&a.getChildAt(b)},_uiSetDisabled:function(b){!b&&this.set("collapsed",!0)},decorateChildrenInternal:function(b,a,c){a.css("visibility","hidden");d.one(a[0].ownerDocument.body).prepend(a);this.__set("menu",new b(d.mix({srcNode:a,prefixCls:c},this.get("menuCfg"))))},destructor:function(){var b=e(this);p(a).detach("resize",this._reposition,this);b&&b.destroy()}},{ATTRS:{activeItem:{view:!0},
menuAlign:{value:{}},menuCfg:{},decorateChildCls:{value:"popupmenu"},menu:{},collapsed:{value:!0,view:!0}},DefaultRender:i});l.UIStore.setUIConstructorByCssClass("menu-button",{priority:l.UIStore.PRIORITY.LEVEL2,ui:j});return j},{requires:"uibase,node,button,./menubuttonrender,menu,component".split(",")});KISSY.add("menubutton",function(d,f,g,c,i){f.Render=g;f.Select=c;f.Option=i;return f},{requires:["menubutton/base","menubutton/menubuttonrender","menubutton/select","menubutton/option"]});
KISSY.add("menubutton/menubuttonrender",function(d,f,g){return f.create(g.Render,{createDom:function(){var c=this.get("innerEl"),f=d.substitute('<div class="ks-inline-block {prefixCls}menu-button-caption">{content}</div><div class="ks-inline-block {prefixCls}menu-button-dropdown">&nbsp;</div>',{content:this.get("content")||"",prefixCls:this.get("prefixCls")});c.html(f).attr("aria-haspopup",!0)},_uiSetContent:function(c){var d=this.get("el").one("."+this.getCssClassWithPrefix("menu-button-caption"));
d.html("");c&&d.append(c)},_uiSetCollapsed:function(c){var d=this.get("el"),f=this.getCssClassWithPrefix("menu-button-open");d[c?"removeClass":"addClass"](f).attr("aria-expanded",!c)},_uiSetActiveItem:function(c){this.get("el").attr("aria-activedescendant",c&&c.get("el").attr("id")||"")}},{ATTRS:{activeItem:{},collapsed:{}}})},{requires:["uibase","button"]});
KISSY.add("menubutton/option",function(d,f,g,c){d=f.create(c.Item,{},{ATTRS:{selectable:{value:!0}}});g.UIStore.setUIConstructorByCssClass("option",{priority:10,ui:d});return d},{requires:["uibase","component","menu"]});
KISSY.add("menubutton/select",function(d,f,g,c,i,k,l,m){function e(a){return(a=a._getMenu(1))&&a.get("children")||[]}var h=g.create(i,{__bindMenu:function(){var a=this._getMenu();h.superclass.__bindMenu.call(this);if(a)a.on("show",this._handleMenuShow,this)},_handleMenuShow:function(){var a=this.get("menu");a.set("highlightedItem",this.get("selectedItem")||a.getChildAt(0))},_updateCaption:function(){var a=this.get("selectedItem");this.set("content",a?a.get("content"):this.get("defaultCaption"))},
_handleMenuClick:function(a){this.set("selectedItem",a.target);this.set("collapsed",!0);h.superclass._handleMenuClick.call(this,a)},removeItems:function(){h.superclass.removeItems.apply(this,arguments);this.set("selectedItem",null)},removeItem:function(a){h.superclass.removeItem.apply(this,arguments);a==this.get("selectedItem")&&this.set("selectedItem",null)},_uiSetSelectedItem:function(a,c){c&&c.prevVal&&c.prevVal.set("selected",!1);this._updateCaption()},_uiSetDefaultCaption:function(){this._updateCaption()}},
{ATTRS:{value:{getter:function(){var a=this.get("selectedItem");return a&&a.get("value")},setter:function(a){for(var c=e(this),d=0;d<c.length;d++){var f=c[d];if(f.get("value")==a){this.set("selectedItem",f);return}}this.set("selectedItem",null);return null}},selectedItem:{},selectedIndex:{setter:function(a){var c=e(this);if(0>a||a>=c.length)return-1;this.set("selectedItem",c[a])},getter:function(){return d.indexOf(this.get("selectedItem"),e(this))}},defaultCaption:{value:""}}});h.decorate=function(a,
c){a=d.one(a);c=c||{};c.elBefore=a;var e,g=[],j=null,b=a.val();e=a.all("option");d.mix(c,{menu:function(){for(var a=this.constructMenu(),b=0;b<g.length;b++)a.addChild(new l(g[b]));return a}});e.each(function(a){var d={content:a.text(),prefixCls:c.prefixCls,elCls:a.attr("class"),value:a.val()};b==a.val()&&(j={content:d.content,value:d.value});g.push(d)});var i=new h(d.mix(c,j));i.render();if(e=a.attr("name")){var k=(new f("<input type='hidden' name='"+e+"' value='"+b+"'>")).insertBefore(a,m);i.on("afterSelectedItemChange",
function(a){a.newVal?k.val(a.newVal.get("value")):k.val("")})}a.remove();return i};c.UIStore.setUIConstructorByCssClass("select",{priority:c.UIStore.PRIORITY.LEVEL3,ui:h});return h},{requires:"node,uibase,component,./base,menu,./option".split(",")});
