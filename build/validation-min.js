/*
Copyright 2011, KISSY UI Library v1.30dev
MIT Licensed
build time: Dec 27 13:15
*/
KISSY.add("validation/base",function(d,i,l,b,h,j,m,o){function n(f,k){if(d.isString(f))f=d.get(f);f?this._init(f,k||{}):b.log("\u8bf7\u914d\u7f6e\u6b63\u786e\u7684form ID.")}d.augment(n,d.EventTarget,{_init:function(f,k){this.config=d.merge(h.Config,k);this.form=f;this.fields=new b.storage;this._initfields()},_initfields:function(){var f=this,k=f.config;d.each(f.form.elements,function(a){var e=i.attr(a,k.attrname);e&&f.add(a,b.toJSON(e.replace(/'/g,'"')))})},add:function(f,k){var a=this.fields,e=d.merge(this.config,k);if(d.isObject(f)&&
f instanceof j){a.add(i.attr(f.el,"id"),f);return this}var c=i.get(f)||i.get("#"+f),g=i.attr(c,"id");if(!c||c.form!=this.form)b.log("\u5b57\u6bb5"+f+"\u4e0d\u5b58\u5728\u6216\u4e0d\u5c5e\u4e8e\u8be5form");else{if(!g){g=e.prefix+d.guid();i.attr(c,"id",g)}a.add(g,new j(c,e))}},remove:function(f){this.fields.remove(f)},get:function(f){return this.fields.get(f)},isValid:function(f){var k=this.fields;if(f&&k.get(f))return k.get(f).isValid();var a=true;k.each(function(e,c){if(!c.isValid()){a=false;if(c.single)return false}});return a},submit:function(){this.fire("submit",
this.fields)&&this.isValid()&&this.form.submit()}});d.mix(n,{Util:b,Define:h,Field:j,Warn:m,Rule:o});return n},{requires:["dom","event","./utils","./define","./field","./warn","./rule"]});KISSY.add("validation/define",function(){var d={};d.Config={attrname:"data-valid",prefix:"auth-f",defaultwarn:"alert"};d.Const={enumvalidsign:{error:0,ok:1,hint:2,ignore:3}};return d});
KISSY.add("validation/field",function(d,i,l,b,h,j,m,o){function n(a,e){if(a=d.get(a)){this.el=a;this.rule=new b.storage;this._init(e)}else b.log("\u5b57\u6bb5\u4e0d\u5b58\u5728\u3002")}var f=h.Const.enumvalidsign,k=document;n.Config={required:[true,"\u6b64\u9879\u4e3a\u5fc5\u586b\u9879\u3002"],initerror:"data-showerror"};d.augment(n,{_init:function(a){a=d.merge(n.Config,a||{});d.mix(this,a,"label");this._initField();this._initVType(a);this._initWarn(a);i.attr(this.el,a.initerror)&&this.showMessage(false,i.attr(this.el,a.initerror))},_initField:function(){var a=
this.el;if("checkbox,radio".indexOf(i.attr(a,"type"))>-1){var e=a.form;a=i.attr(a,"name");var c=[];d.each(k.getElementsByName(a),function(g){g.form==e&&c.push(g)});this.el=c}},_initVType:function(a){var e=this,c=e.el,g;for(g in a)e.addRule(g,a[g]);if(a.remote){a=d.isArray(a.remote)?{url:a.remote[0]}:a.remote;var p=new m(c,a,function(q,r){e.showMessage(q,r)});e.addRule("ajax",function(q){return p.check(q)})}},_initWarn:function(a){var e=this,c,g={};if(a.warn){c=d.isFunction(a.warn)?a.warn:o.get(a.warn);
g=d.merge(a,{})}if(a.style&&o.getStyle(a.style)){g=o.getStyle(a.style);c=o.get(g.core);g=d.merge(a,g)}if(c){c=new c(e.el,g);c._bindEvent(e.el,a.event||c.event,function(){var p=e._validateValue();d.isArray(p)&&p.length==2&&e.showMessage(p[1],p[0])});d.mix(e,{warn:c,single:c.single})}else b.log("\u63d0\u793a\u4fe1\u606f\u7c7b\u914d\u7f6e\u9519\u8bef.")},_validateValue:function(){var a=this.rule,e=this._getValue();a=a.getAll();if(i.attr(this.el,"disabled")||i.hasClass(this.el,"disabled"))return[undefined,f.ignore];if(a.depend&&a.depend.call(this,
e)!==true)return[undefined,f.ignore];for(var c in a){if(c=="required"){var g=a.required.call(this,e);if(g)return this.label?[this.label,f.hint]:[g,f.error];else if(b.isEmpty(e))return["",f.ignore]}if(!("depend".indexOf(c)>-1)){if("ajax".indexOf(c)>-1)break;g=a[c].call(this,e);if(!b.isEmpty(g)){this._ajaxtimer&&this._ajaxtimer.cancel();return[g,f.error]}}}if(a.ajax)return a.ajax.call(this,e);return[this.okMsg||"OK",f.ok]},_getValue:function(){var a=this.el,e=[];switch(i.attr(a,"type")){case "select-multiple":d.each(a.options,
function(c){c.selected&&e.push(c.value)});break;case "radio":case "checkbox":d.each(a,function(c){c.checked&&e.push(c.value)});break;default:e=i.val(a)}return e},addRule:function(a,e){var c=this.rule;if(d.isFunction(a)){c.add(d.guid(),a);return this}var g=j.get(a,e);if(g){c.add(a,g);return this}},removeRule:function(a){this.rule.remove(a)},showMessage:function(a,e,c){this.warn.showMessage(a,e,c)},isValid:function(){var a=this._validateValue();this.showMessage(a[1],a[0]);return a[1]!=0}});return n},
{requires:["dom","event","./utils","./define","./rule","./rule/remote","./warn"]});KISSY.add("validation/rule",function(d,i,l){return l},{requires:["./utils","./rule/base","./rule/normal"]});
KISSY.add("validation/utils",function(d,i){var l={log:d.log,toJSON:function(b){try{eval("var result="+b)}catch(h){return{}}return result},isEmpty:function(b){return b===null||b===i||b===""},format:function(b){var h=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(j,m){return h[m]})},toNumber:function(b){b=new String(b);b=b.indexOf(".")>-1?parseFloat(b):parseInt(b);return isNaN(b)?0:b},getStrLen:function(b,h){return h?b.replace(/[^\x00-\xFF]/g,"**").length:b.length},storage:function(){this.cache=
{}}};d.augment(l.storage,{add:function(b,h,j){var m=this.cache;if(!m[b]||m[b]&&(j==null||j))m[b]=h},remove:function(b){var h=this.cache;h[b]&&delete h[b]},get:function(b){var h=this.cache;return h[b]?h[b]:null},getAll:function(){return this.cache},each:function(b){var h=this.cache,j;for(j in h)if(b.call(this,j,h[j])===false)break}});return l});KISSY.add("validation",function(d,i){return d.Validation=i},{requires:["validation/base","validation/assets/base.css"]});
KISSY.add("validation/warn",function(d,i,l,b,h,j,m){l.extend("Alert",h);l.extend("Static",j);l.extend("Float",m);l.BaseClass=b;return l},{requires:["./utils","./warn/base","./warn/baseclass","./warn/alert","./warn/static","./warn/float"]});
