/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 15 23:19
*/
KISSY.add("kison/grammar",function(f,m,h,a,b,d,e,q){function i(g){var p=0,c;for(c in g)p++;return p}function n(g,p){for(var c=0;c<p.length;c++)if(g.equals(p[c]))return c;return-1}function u(){u.superclass.constructor.apply(this,arguments)}function r(g){var p=this.lexer,c,a,j=this.table,d=j.gotos,j=j.action,e=this.productions,b=[null],k=[0];for(p.resetInput(g);;){g=k[k.length-1];c||(c=p.lex());if(!c)return!1;a=j[g]&&j[g][c];if(!a){var h=[];j[g]&&f.each(j[g],function(g,c){h.push(c)});return!1}switch(a[l.TYPE_INDEX]){case l.SHIFT_TYPE:k.push(c);
b.push(p.text);k.push(a[l.TO_INDEX]);c=null;break;case l.REDUCE_TYPE:var o=e[a[l.PRODUCTION_INDEX]],g=o.symbol||o[0];a=o.action||o[2];var i=(o.rhs||o[1]).length;this.$$=o=b[b.length-i];for(o=0;o<i;o++)this["$"+(i-o)]=b[b.length-1-o];var q;a&&(q=a.call(this));o=void 0!==q?q:this.$$;i&&(k=k.slice(0,-2*i),b=b.slice(0,-1*i));k.push(g);b.push(o);k.push(d[k[k.length-2]][k[k.length-1]]);break;case l.ACCEPT_TYPE:return o}}}var l={SHIFT_TYPE:1,REDUCE_TYPE:2,ACCEPT_TYPE:0,TYPE_INDEX:0,PRODUCTION_INDEX:1,TO_INDEX:2},
t=f.mix,s=e.STATIC.END_TAG;f.extend(u,m,{build:function(){var g=this,p=g.get("productions");p.unshift({symbol:"$START",rhs:[p[0].symbol]});f.each(p,function(c,a){c.symbol=g.mapSymbol(c.symbol);var j=c.rhs;f.each(j,function(c,a){j[a]=g.mapSymbol(c)});p[a]=new q(c)});g.buildTerminals();g.buildNonTerminals();g.buildNullAble();g.buildFirsts();g.buildItemSet();g.buildLalrItemSets();g.buildTable()},buildTerminals:function(){var g=this.get("lexer"),g=g&&g.rules,a=this.get("terminals");a[this.mapSymbol(s)]=
1;f.each(g,function(g){(g=g.token||g[0])&&(a[g]=1)})},buildNonTerminals:function(){var g=this.get("terminals"),a=this.get("nonTerminals"),c=this.get("productions");f.each(c,function(c){var j=c.get("symbol"),b=a[j];b||(b=a[j]=new d({symbol:j}));b.get("productions").push(c);f.each(c.get("handles"),function(c){!g[c]&&!a[c]&&(a[c]=new d({symbol:c}))})})},buildNullAble:function(){for(var g=this,a,c,b,j,d,e,i,k=g.get("nonTerminals"),h=!0;h;)for(j in h=!1,f.each(g.get("productions"),function(j){if(!j.get("nullAble")){c=
j.get("rhs");for(b=a=0;d=c[a];++a)g.isNullAble(d)&&b++;b===a&&j.set("nullAble",h=!0)}}),k)if(!k[j].get("nullAble")){i=k[j].get("productions");for(a=0;e=i[a];a++)if(e.get("nullAble")){k[j].set("nullAble",h=!0);break}}},isNullAble:function(g){var a=this.get("nonTerminals");if(g instanceof Array){for(var a=0,c;c=g[a];++a)if(!this.isNullAble(c))return!1;return!0}return a[g]?a[g].get("nullAble"):!1},findFirst:function(g){var a={},c,b,j=this.get("nonTerminals");if(g instanceof Array){for(b=0;(c=g[b])&&
!(j[c]?t(a,j[c].get("firsts")):a[c]=1,!this.isNullAble(c));++b);return a}return j[g]?j[g].get("firsts"):[g]},buildFirsts:function(){var g=this,a;g.get("productions");for(var c=g.get("nonTerminals"),b=!0,j,d;b;)for(j in b=!1,f.each(g.get("productions"),function(a){var c=g.findFirst(a.get("rhs"));i(c)!==i(a.get("firsts"))&&(a.set("firsts",c),b=!0)}),c)a=c[j],d={},f.each(a.get("productions"),function(a){t(d,a.get("firsts"))}),i(d)!==i(a.get("firsts"))&&(a.set("firsts",d),b=!0)},closure:function(g){for(var b=
this,c=g.get("items"),d=b.get("productions"),j=1;j;)j=!1,f.each(c,function(c){var e=c.get("dotPosition"),h=c.get("production").get("rhs"),k=h[e],c=c.get("lookAhead"),i={};f.each(c,function(a,g){var c=h.slice(e+1);c.push(g);f.mix(i,b.findFirst(c))});f.each(d,function(c){if(c.get("symbol")==k){var c=new a({production:c}),b=g.findItemIndex(c,!0);-1!=b?(c=g.getItemAt(b),j=j||!!c.addLookAhead(i)):(c.addLookAhead(i),g.addItem(c),j=!0)}})});return g},gotos:function(g,d){var c=new b,e=g.get("items");f.each(e,
function(g){var b=g.get("production"),e=g.get("dotPosition");b.get("rhs")[e]==d&&(b=new a({production:b,dotPosition:e+1}),e=c.findItemIndex(b,!0),-1!=e?(b=c.getItemAt(e),b.addLookAhead(g.get("lookAhead"))):(b.addLookAhead(g.get("lookAhead")),c.addItem(b)))});return this.closure(c)},findItemSetIndex:function(a){for(var b=this.get("itemSets"),c=0;c<b.length;c++)if(b[c].equals(a))return c;return-1},buildItemSet:function(){var g=this,d=g.get("itemSets"),c={},e=g.get("productions");c[g.mapSymbol(s)]=1;
c=g.closure(new b({items:[new a({production:e[0],lookAhead:c})]}));d.push(c);var j=!0,h=f.merge(g.get("terminals"),g.get("nonTerminals"));for(delete h[g.mapSymbol(s)];j;)j=!1,c=d.concat(),f.each(c,function(a){f.each(h,function(c,b){a.__cache||(a.__cache={});if(!a.__cache[b]){var e=g.gotos(a,b);a.__cache[b]=1;if(0!=e.size()){var f=g.findItemSetIndex(e);-1<f?e=d[f]:(d.push(e),j=!0);a.get("gotos")[b]=e;e.addReverseGoto(b,a)}}})})},buildLalrItemSets:function(){for(var a=this.get("itemSets"),b=0;b<a.length;b++)for(var c=
a[b],e=b+1;e<a.length;e++){var d=a[e];if(c.equals(d,!0)){for(var h=0;h<c.get("items").length;h++)c.get("items")[h].addLookAhead(d.get("items")[h].get("lookAhead"));var i=c.get("gotos");f.each(d.get("gotos"),function(a,b){i[b]=a;a.addReverseGoto(b,c)});f.each(d.get("reverseGotos"),function(a,b){f.each(a,function(a){a.get("gotos")[b]=c;c.addReverseGoto(b,a)})});a.splice(e--,1)}}},buildTable:function(){var a=this,b=a.get("table"),c=a.get("itemSets"),e=a.get("productions"),d={},h={},i;b.gotos=d;b.action=
h;for(var q=a.get("nonTerminals"),k=0;k<c.length;k++)b=c[k],f.each(b.get("gotos"),function(a,b){q[b]?(d[k]=d[k]||{},d[k][b]=n(a,c)):(h[k]=h[k]||{},i=h[k][b]=[],i[l.TYPE_INDEX]=l.SHIFT_TYPE,i[l.PRODUCTION_INDEX]=0,i[l.TO_INDEX]=n(a,c))}),f.each(b.get("items"),function(b){var c=b.get("production");b.get("dotPosition")==c.get("rhs").length&&(c.get("symbol")==a.mapSymbol("$START")?b.get("lookAhead")[a.mapSymbol(s)]&&(h[k]=h[k]||{},i=h[k][a.mapSymbol(s)]=[],i[l.TYPE_INDEX]=l.ACCEPT_TYPE,i[l.TO_INDEX]=
i[l.PRODUCTION_INDEX]=0):(h[k]=h[k]||{},f.each(b.get("lookAhead"),function(a,b){i=h[k][b]=[];i[l.TYPE_INDEX]=l.REDUCE_TYPE;i[l.TO_INDEX]=0;i[l.PRODUCTION_INDEX]=f.indexOf(c,e)})))})},visualizeTable:function(){var a=this.get("table"),b=a.gotos,a=a.action,c=this.get("productions"),e=[];f.each(this.get("itemSets"),function(a,b){e.push(Array(70).join("*")+" itemSet : "+b);e.push(a.toString());e.push("")});e.push("");e.push(Array(70).join("*")+" table : ");f.each(a,function(a,b){f.each(a,function(a,g){var d,
f=a[l.TYPE_INDEX];f==l.ACCEPT_TYPE?d="acc":f==l.REDUCE_TYPE?(d=c[a[l.PRODUCTION_INDEX]],d="r, "+d.get("symbol")+"="+d.get("rhs").join(" ")):f==l.SHIFT_TYPE&&(d="s, "+a[l.TO_INDEX]);e.push("action["+b+"]["+g+"] = "+d)})});e.push("");f.each(b,function(a,b){f.each(a,function(a,c){e.push("goto["+b+"]["+c+"] = "+a)})});return e},mapSymbol:function(a){var b=this.tokenMap,c=this.symbolMap;b&&b[a]?a=b[a]:c&&(a=c[a]||(c[a]=++this.symbolId));return a},genCode:function(a){arguments.length||(a=1);var b=this.get("table"),
c=this.get("lexer").genCode(a);a&&(this.symbolMap={},this.tokenMap=c.tokenMap,this.symbolId=c.tokenId+1);this.build();var e=[];f.each(this.get("productions"),function(a){var b=a.get("symbol"),c=a.get("rhs");e.push([b,c,a.get("action")||0])});var d=[];d.push("/* Generated by kison from KISSY */");d.push("var parser={},S=KISSY,GrammarConst="+h.serializeObject(l)+";");d.push(c.code);d.push("parser.lexer=lexer;");d.push("parser.productions="+h.serializeObject(e)+";");d.push("parser.table="+h.serializeObject(b)+
";");d.push("parser.parse="+r.toString()+";");d.push("return parser;");return d.join("\n")}},{ATTRS:{table:{value:{}},itemSets:{value:[]},productions:{value:[]},nonTerminals:{value:{}},lexer:{setter:function(a){if(!(a instanceof e))return new e(a)}},terminals:{value:{}}}});return u},{requires:"base,./utils,./item,./item-set,./non-terminal,./lexer,./production".split(",")});
KISSY.add("kison/item-set",function(f,m){function h(){h.superclass.constructor.apply(this,arguments)}f.extend(h,m,{addItem:function(a){for(var b=this.get("items"),d=0;d<b.length&&!(b[d].get("production").toString()>a.get("production").toString());d++);b.splice(d,0,a)},size:function(){return this.get("items").length},findItemIndex:function(a,b){for(var d=this.get("items"),e=0;e<d.length;e++)if(d[e].equals(a,b))return e;return-1},getItemAt:function(a){return this.get("items")[a]},equals:function(a,
b){var d=this.get("items"),e,f=a.get("items");if(d.length!=f.length)return!1;for(e=0;e<d.length;e++)if(!d[e].equals(f[e],b))return!1;return!0},toString:function(){var a=[];f.each(this.get("items"),function(b){a.push(b.toString())});return a.join("\n")},addReverseGoto:function(a,b){var d=this.get("reverseGotos");d[a]=d[a]||[];d[a].push(b)}},{ATTRS:{items:{value:[]},gotos:{value:{}},reverseGotos:{value:{}}}});return h},{requires:["base"]});
KISSY.add("kison/item",function(f,m){function h(){h.superclass.constructor.apply(this,arguments)}f.extend(h,m,{equals:function(a,b){return!a.get("production").equals(this.get("production"))||a.get("dotPosition")!=this.get("dotPosition")||!b&&!f.equals(this.get("lookAhead"),a.get("lookAhead"))?!1:!0},toString:function(a){return this.get("production").toString(this.get("dotPosition"))+(a?"":","+f.keys(this.get("lookAhead")).join("/"))},addLookAhead:function(a){var b=this.get("lookAhead"),d=0;f.each(a,
function(a,f){b[f]||(d=b[f]=1)});return d}},{ATTRS:{production:{},dotPosition:{value:0},lookAhead:{value:{}}}});return h},{requires:["base"]});KISSY.add("kison",function(f,m,h,a,b){var d={};d.Grammar=m;d.Production=h;d.Lexer=a;d.Utils=b;return!f.trim("")?(alert("kison can only use uncompressed version!"),null):d},{requires:["kison/grammar","kison/production","kison/lexer","kison/utils"]});
KISSY.add("kison/lexer",function(f,m){var h=function(a){this.rules=[];f.mix(this,a);for(var a=0,b=this.rules.length;a<b;a++){var d=this.rules[a];!f.isArray(d)&&!("state"in d)&&(d.state=h.STATIC.INIT)}this.resetInput(this.input)};h.STATIC={INIT:f.guid("ks"+f.now()),DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};h.prototype={resetInput:function(a){this.input=a;f.mix(this,{matched:"",stateStack:[h.STATIC.INIT],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},genCode:function(a){arguments.length||
(a=1);var b=[],d=0,e={},f={},i=0;a&&(e[h.STATIC.INIT]=++d,f[h.STATIC.END_TAG]=++i);b.push("var Lexer = "+h.toString()+";");b.push("Lexer.prototype= "+m.serializeObject(h.prototype,/genCode/)+";");b.push("Lexer.STATIC= "+m.serializeObject(h.STATIC)+";");var n=m.serializeObject({rules:this.rules},a?function(a){if(a&&a.regexp){var b=a.state,h=a.token||0;h&&(h=f[h]||(f[h]=++i));b=e[b]||(e[b]=++d);return[h,a.regexp||0,a.action||0,b]}}:0);b.push("var lexer = new Lexer("+n+");");a&&(this.rules=eval("("+
n+")").rules,b.push("lexer.tokenMap = "+m.serializeObject(f)+";"),b.push("lexer.stateMap = "+m.serializeObject(e)+";"));return{code:b.join("\n"),tokenMap:f,stateMap:e,tokenId:i}},getCurrentRules:function(){var a=this.stateStack[this.stateStack.length-1],b=[],a=(this.stateMap||{})[a]||a;f.each(this.rules,function(d){(d.state||d[3])==a&&b.push(d)});return b},pushState:function(a){this.stateStack.push(a)},popState:function(){this.stateStack.pop()},showDebugInfo:function(){var a=h.STATIC.DEBUG_CONTEXT_LIMIT,
b=this.matched,d=this.match,e=this.input,b=b.slice(0,b.length-d.length),b=(b.length>a?"...":"")+b.slice(-a).replace(/\n/," "),d=d+e,d=d.slice(0,a)+(d.length>a?"...":"");return b+d+"\n"+Array(b.length+1).join("-")+"^"},lex:function(){var a=this.tokenMap||{},b=this.input,d,e,q=h.STATIC.END_TAG,i,n;n=this.getCurrentRules();this.match=this.text="";if(!f.trim(b))return a[q]||q;for(d=0;d<n.length;d++)if(e=n[d],q=e.token||e[0],i=e.action||e[2]||void 0,e=b.match(e.regexp||e[1])){if(n=e[0].match(/\n.*/g))this.lineNumber+=
n.length;f.mix(this,{firstLine:this.lastLine,lastLine:this.lineNumber+1,firstColumn:this.lastColumn,lastColumn:n?n[n.length-1].length-1:this.lastColumn+e[0].length});n=this.match=e[0];this.matches=e;this.text=n;this.matched+=n;i=i&&i.call(this);i=void 0==i?q:a[i]||i;this.input=b=b.slice(n.length);return i?i:this.lex()}}};return h},{requires:["./utils"]});
KISSY.add("kison/non-terminal",function(f,m){function h(){h.superclass.constructor.apply(this,arguments)}f.extend(h,m,{},{ATTRS:{productions:{value:[]},firsts:{value:{}},symbol:{},nullAble:{value:!1}}});return h},{requires:["base"]});
KISSY.add("kison/production",function(f,m){function h(){h.superclass.constructor.apply(this,arguments)}f.extend(h,m,{equals:function(a){return!f.equals(a.get("rhs"),this.get("rhs"))?!1:a.get("symbol")==this.get("symbol")},toString:function(a){var b="",d=this.get("rhs");f.each(d,function(d,f){f==a&&(b+=".");b+=d});a==d.length&&(b+=".");return this.get("symbol")+"=>"+b}},{ATTRS:{firsts:{value:{}},follows:{value:[]},symbol:{},rhs:{value:[]},nullAble:{value:!1},action:{}}});return h},{requires:["base"]});
KISSY.add("kison/utils",function(f){var m=/"/g,h=/'/g,a;return{escapeString:a=function(a,d){var e=h;'"'==d?e=m:d="'";return a.replace(/\\/g,"\\\\").replace(e,"\\"+d)},serializeObject:function d(e,h){var i;if(h&&f.isFunction(h)&&!1===(i=h(e)))return!1;void 0!==i&&(e=i);i=[];if("string"==typeof e)return"'"+a(e)+"'";if(f.isNumber(e))return e+"";if(f.isRegExp(e))return"/"+e.source+"/"+(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"");if(f.isArray(e)){i.push("[");var n=[];f.each(e,function(a){a=
d(a,h);!1!==a&&n.push(a)});i.push(n.join(", "));i.push("]");return i.join("")}if(f.isObject(e)){i=["{"];var m=1,r;for(r in e){var l=e[r];if(!h||!f.isRegExp(h)||!r.match(h))if(l=d(l,h),!1!==l){var t="'"+a(r)+"'";i.push((m?"":",")+t+": "+l);m=0}}i.push("}");return i.join("\n")}return e+""}}});
