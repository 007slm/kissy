/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 13 10:24
*/
KISSY.add("kison/Grammar",function(c,j,g,h,e,f,l){function m(a,d){for(var b=0;b<d.length;b++)c.inArray(d[b],a)||a.push(d[b])}function o(a){var d=0,b;for(b in a)a.hasOwnProperty(b)&&d++;return d}function u(a){var d=[];c.each(a,function(a,c){d.push(c)});return d}function r(a,d){for(var b=0;b<d.length;b++)if(a.equals(d[b]))return b;return-1}function q(){q.superclass.constructor.apply(this,arguments);this.buildTerminals();this.buildNonTerminals();this.buildNullAble();this.buildFirsts();this.buildItemSet();
this.buildLalrItemSets();this.buildTable()}var s=c.mix;c.extend(q,j,{buildTerminals:function(){var a=this.get("lexer"),a=a&&a.get("rules"),d=this.get("terminals");d.$EOF=1;c.each(a,function(a){a.token&&(d[a.token]=1)})},buildNonTerminals:function(){var a=this.get("terminals"),d=this.get("nonTerminals"),b=this.get("productions");c.each(b,function(b){var i=b.get("symbol"),k=d[i];k||(k=d[i]=new e({symbol:i}));k.get("productions").push(b);c.each(b.get("handles"),function(b){!a[b]&&!d[b]&&(d[b]=new e({symbol:b}))})})},
buildNullAble:function(){for(var a=this,d,b,p,i,k,t,n,e=a.get("nonTerminals"),h=!0;h;)for(i in h=!1,c.each(a.get("productions"),function(c){if(!c.get("nullAble")){b=c.get("rhs");for(p=d=0;k=b[d];++d)a.isNullAble(k)&&p++;p===d&&c.set("nullAble",h=!0)}}),e)if(e.hasOwnProperty(i)&&!e[i].get("nullAble")){n=e[i].get("productions");for(d=0;t=n[d];d++)t.get("nullAble")&&e[i].set("nullAble",h=!0)}},isNullAble:function(a){var d=this.get("nonTerminals");if(a instanceof Array){for(var d=0,b;b=a[d];++d)if(!this.isNullAble(b))return!1;
return!0}return d[a]?d[a].get("nullAble"):!1},findFirst:function(a){var d={},b,c,i=this.get("nonTerminals");if(a instanceof Array){for(c=0;(b=a[c])&&!(i[b]?s(d,i[b].get("firsts")):d[b]=1,!this.isNullAble(b));++c);return d}return i[a]?i[a].get("firsts"):[a]},buildFirsts:function(){var a=this,d;a.get("productions");for(var b=a.get("nonTerminals"),e=!0,i,k;e;)for(i in e=!1,c.each(a.get("productions"),function(b){var d=a.findFirst(b.get("rhs"));o(d)!==o(b.get("firsts"))&&(b.set("firsts",d),e=!0)}),b)b.hasOwnProperty(i)&&
(d=b[i],k={},c.each(d.get("productions"),function(a){s(k,a.get("firsts"))}),o(k)!==o(d.get("firsts"))&&(d.set("firsts",k),e=!0))},closure:function(a){for(var d=this,b=a.get("items"),e=d.get("productions"),i=1;i;)i=!1,c.each(b,function(b){var h=b.get("dotPosition"),n=b.get("production").get("rhs"),f=n[h],b=b.get("lookAhead"),l={};c.each(b,function(a){var b=n.slice(h+1);b.push(a);c.mix(l,d.findFirst(b))});c.each(e,function(b){var d=new g({production:b,lookAhead:u(l)});b.get("symbol")==f&&-1==a.findItemIndex(d)&&
(a.addItem(d),i=!0)})});return a},gotos:function(a,d){var b=new h,e=a.get("items");c.each(e,function(a){var c=a.get("production"),e=a.get("dotPosition");c.get("rhs")[e]==d&&b.addItem(new g({production:c,dotPosition:e+1,lookAhead:a.get("lookAhead").concat()}))});return this.closure(b)},findItemSetIndex:function(a){for(var d=this.get("itemSets"),b=0;b<d.length;b++)if(d[b].equals(a))return b;return-1},buildItemSet:function(){var a=this,d=a.get("itemSets"),b=a.get("productions"),b=a.closure(new h({items:[new g({production:b[0],
lookAhead:["$EOF"]})]}));d.push(b);var e=!0,i=c.merge(a.get("terminals"),a.get("nonTerminals"));for(delete i.$EOF;e;)e=!1,b=d.concat(),c.each(b,function(b){c.each(i,function(c,h){b.__cache||(b.__cache={});if(!b.__cache[h]){var i=a.gotos(b,h);b.__cache[h]=1;if(0!=i.size()){var f=a.findItemSetIndex(i);-1<f?i=d[f]:(d.push(i),e=!0);b.get("gotos")[h]=i;i.addReverseGoto(h,b)}}})})},buildLalrItemSets:function(){for(var a=this.get("itemSets"),d=0;d<a.length;d++)for(var b=a[d],e=d+1;e<a.length;e++){var i=
a[e];if(b.equals(i,!0)){for(var h=0;h<b.get("items").length;h++)m(b.get("items")[h].get("lookAhead"),i.get("items")[h].get("lookAhead"));var f=b.get("gotos");c.each(i.get("gotos"),function(a,d){f[d]=a;a.addReverseGoto(d,b)});c.each(i.get("reverseGotos"),function(a,d){c.each(a,function(a){a.get("gotos")[d]=b;b.addReverseGoto(d,a)})});a.splice(e--,1)}}},buildTable:function(){var a=this.get("table"),d=this.get("itemSets"),b={},e={};a.gotos=b;a.action=e;for(var h=this.get("nonTerminals"),f=0;f<d.length;f++)a=
d[f],c.each(a.get("gotos"),function(a,c){h[c]?(b[f]=b[f]||{},b[f][c]=r(a,d)):(e[f]=e[f]||{},e[f][c]={type:1,to:r(a,d)})}),c.each(a.get("items"),function(a){var b=a.get("production");a.get("dotPosition")==b.get("rhs").length&&("$START"==b.get("symbol")?c.inArray("$EOF",a.get("lookAhead"))&&(e[f]=e[f]||{},e[f].$EOF={type:0}):(e[f]=e[f]||{},c.each(a.get("lookAhead"),function(a){e[f][a]={type:2,production:b}})))})},visualizeTable:function(){var a=this.get("table"),d=a.gotos,b=[];c.each(a.action,function(a,
d){c.each(a,function(a,e){var c,h=a.type;0==h?c="acc":2==h?c="r"+a.to:1==h&&(c="s"+a.to);b.push("action["+d+"]["+e+"] = "+c)})});c.each(d,function(a,d){c.each(a,function(a,c){b.push("goto["+d+"]["+c+"] = "+a)})});return b},parse:function(a){var d=this.get("lexer"),b,c;this.get("nonTerminals");var e=this.get("table"),h=e.gotos,e=e.action,f=[null],g=[0];for(d.set("input",a);;){a=g[g.length-1];b||(c=d.lex(),b=c.token);if(!b)return!1;a=e[a]&&e[a][b];if(!a)return!1;switch(a.type){case 1:g.push(b);f.push(c.text);
g.push(a.to);b=null;break;case 2:var a=a.production,l=a.get("rhs").length,j=f[f.length-l],m=f.slice(-l),m=a.get("action").apply(null,m);void 0!==m&&(j=m);l&&(g=g.slice(0,-2*l),f=f.slice(0,-1*l));g.push(a.get("symbol"));f.push(j);g.push(h[g[g.length-2]][g[g.length-1]]);break;case 0:return j}}}},{ATTRS:{table:{value:{}},itemSets:{value:[]},productions:{value:[],setter:function(a){a.unshift({symbol:"$START",rhs:[a[0].symbol]});c.each(a,function(d,b){a[b]=new l(d)})}},nonTerminals:{value:{}},lexer:{setter:function(a){return new f(a)}},
terminals:{value:{}}}});return q},{requires:"base,./Item,./ItemSet,./NonTerminal,./Lexer,./Production".split(",")});
KISSY.add("kison/Item",function(c,j){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,j,{equals:function(h,e){return!h.get("production").equals(this.get("production"))||h.get("dotPosition")!=this.get("dotPosition")||!e&&!c.equals(this.get("lookAhead"),h.get("lookAhead"))?!1:!0},toString:function(){return this.get("production").toString(this.get("dotPosition"))+","+this.get("lookAhead").join("/")}},{ATTRS:{production:{},dotPosition:{value:0},lookAhead:{value:[]}}});return g},
{requires:["base"]});
KISSY.add("kison/ItemSet",function(c,j){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,j,{addItem:function(c){for(var e=this.get("items"),f=0;f<e.length&&!(e[f].get("production").toString()>c.get("production").toString());f++);e.splice(f,0,c)},size:function(){return this.get("items").length},findItemIndex:function(c){for(var e=this.get("items"),f=0;f<e.length;f++)if(e[f].equals(c))return f;return-1},equals:function(c,e){var f=this.get("items"),g,j=c.get("items");if(f.length!=
j.length)return!1;for(g=0;g<f.length;g++)if(!f[g].equals(j[g],e))return!1;return!0},toString:function(){var h=[];c.each(this.get("items"),function(c){h.push(c.toString())});return h.join("\n")},addReverseGoto:function(c,e){var f=this.get("reverseGotos");f[c]=f[c]||[];f[c].push(e)}},{ATTRS:{items:{value:[]},gotos:{value:{}},reverseGotos:{value:{}}}});return g},{requires:["base"]});
KISSY.add("kison/Lexer",function(c,j){function g(){g.superclass.constructor.apply(this,arguments)}g.ATTRS={input:{value:""},rules:{value:[]}};c.extend(g,j,{lex:function(){var h=this.get("input"),e,f,g,j=this.get("rules");if(!c.trim(h))return{token:"$EOF"};for(e=0;e<j.length;e++)if(f=j[e],g=h.match(f.regexp))return e=f.action&&f.action(g),void 0==e&&(e={token:f.token,text:g[0]}),h=h.slice(g[0].length),this.set("input",h),e.token?e:this.lex()}});return g},{requires:["base"]});
KISSY.add("kison/NonTerminal",function(c,j){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,j,{},{ATTRS:{productions:{value:[]},firsts:{value:{}},symbol:{},nullAble:{value:!1}}});return g},{requires:["base"]});
KISSY.add("kison/Production",function(c,j){function g(){g.superclass.constructor.apply(this,arguments)}c.extend(g,j,{equals:function(g){return!c.equals(g.get("rhs"),this.get("rhs"))?!1:g.get("symbol")==this.get("symbol")},toString:function(g){var e="",f=this.get("rhs");c.each(f,function(c,f){f==g&&(e+=".");e+=c});g==f.length&&(e+=".");return this.get("symbol")+"=>"+e}},{ATTRS:{firsts:{value:{}},follows:{value:[]},symbol:{},rhs:{value:[]},nullAble:{value:!1},action:{value:c.noop}}});return g},{requires:["base"]});
KISSY.add("kison",function(c,j,g,h){c={};c.Grammar=j;c.Production=g;c.Lexer=h;return c},{requires:["kison/Grammar","kison/Production","kison/Lexer"]});
