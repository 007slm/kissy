/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 28 19:41
*/
KISSY.add("autocomplete/BasicComboBox",function(g,f,a,d){function j(b){var c=this.get("menu"),a=this.get("el")[0];c.get("visible")?c.hide():(a.focus(),this.sendRequest(""));b&&b.halt()}return f.define(a,{bindUI:function(){this.get("el");var b=this.get("container");this.get("button");b.on("click",j,this);var c=this.get("menuCfg");c.width||(c.width=b.width())}},{ATTRS:{container:{view:!0},button:{view:!0}},DefaultRender:d})},{requires:["component","./basic","./BasicComboBoxRender"]});
KISSY.add("autocomplete/BasicComboBoxRender",function(g,f,a,d){var j=d.all,b;return b=f.define(a,{createDom:function(){var b=j("<span class='"+this.get("prefixCls")+"combobox'></span>"),a=j("<a tabindex='-1' href='javascript:void(\"open\")'  onmousedown='return false;' class='"+this.get("prefixCls")+"combobox-button'>&#x25BC;</a>").unselectable();this.__set("container",b);this.__set("button",a)},renderUI:function(){var b=this.get("container"),a=this.get("button"),d=this.get("el").parent();b.appendTo(d).append(this.get("el")).append(a)},
_uiSetFocused:function(c){b.superclass._uiSetFocused.apply(this,arguments);this.get("container")[c?"addClass":"removeClass"](this.get("prefixCls")+"combobox-focused")},destructor:function(){this.get("container").remove()}},{ATTRS:{container:{},button:{}}})},{requires:["component","./inputRender","node"]});KISSY.add("autocomplete",function(g,f,a,d,j,b,c){a.Menu=f;a.LocalDataSource=d;a.RemoteDataSource=j;a.Basic=b;a.BasicComboBox=c;return a},{requires:"autocomplete/menu,autocomplete/input,autocomplete/localDataSource,autocomplete/remoteDataSource,autocomplete/basic,autocomplete/BasicComboBox".split(",")});
KISSY.add("autocomplete/basic",function(g,f,a,d,j,b){return f.define(a,[],{initializer:function(){var c,a;this.get("dataSource")||(c=(a=this.get("data"))?new j({data:a,dataSourceCfg:this.get("dataSourceCfg")}):new b({xhrCfg:this.get("xhrCfg"),dataSourceCfg:this.get("dataSourceCfg")}),this.__set("dataSource",c));this.get("menu")||(c=new d({prefixCls:this.get("prefixCls")}),this.__set("menu",c))}},{ATTRS:{destroyMenu:{value:!0},data:{},xhrCfg:{value:{}},dataSourceCfg:{value:{}}}},"AutoComplete_Basic")},
{requires:["component","./input","./menu","./localDataSource","./remoteDataSource"]});
KISSY.add("autocomplete/input",function(g,f,a,d,j,b,c){function i(e){if(e.get("multiple")&&e.get("alignWithCursor")){var b=e._getInputDesc(),a=b.tokens,c=e.get("menu"),d=b.cursorPosition,b=b.tokenIndex,e=e.get("el"),a=a.slice(0,b).join("").length;0<a&&++a;e.prop("selectionStart",a);e.prop("selectionEnd",a);a=e.prop("KsCursorOffset");e.prop("selectionStart",d);e.prop("selectionEnd",d);c.set("xy",[a.left,a.top])}else c=e.get("menu"),d=e.get("menuCfg")||{},c.set("align",g.merge({node:e.get("el")},n,
d.align))}var h,k=f.KeyCodes,n={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};h=a.define(a.Controller,[],{_savedInputValue:null,_stopNotify:0,bindUI:function(){this.get("el").on("valuechange",this._onValueChange,this)},sendRequest:function(e){this.get("dataSource").fetchData(e,this._renderData,this)},_onValueChange:function(){if(!this._stopNotify){var e=this._getValue();e===c?(e=this.get("menu"))&&e.hide():(this._savedInputValue=e,this.sendRequest(e))}},handleBlur:function(){h.superclass.handleBlur.apply(this,
arguments);var e=this.get("menu");e&&e._hideForAutoComplete()},_renderData:function(e){var b=this.get("menu");b.removeChildren(!0);if(e&&e.length){var e=e.slice(0,this.get("maxItemCount")),a=this.get("menuCfg")||{};b.set("width",a.width===c?this.get("el").css("width"):a.width);var m;m=this.get("format")?this.get("format").call(this,this._getValue(),e):[];for(var h=0;h<e.length;h++)a=e[h],b.addChild(new d.Item(g.mix({prefixCls:this.get("prefixCls")+"autocomplete-",content:a,textContent:a,value:a},
m[h])));this._showMenu()}else b.hide()},_showMenu:function(){var e=this.get("menu");e._input=this;e._clearDismissTimer();i(this);e.show();for(var b=e.get("children"),a=this._getValue(),c=0;c<b.length;c++)if(b[c].get("textContent")==a){e.set("highlightedItem",b[c]);return}if(this.get("autoHighlightFirst"))for(c=0;c<b.length;c++)if(!b[c].get("disabled")){e.set("highlightedItem",b[c]);break}},_onWindowResize:function(){i(this)},handleKeyEventInternal:function(e){this.get("el");var b=this.get("menu");
if(b){var a=this.get("updateInputOnDownUp");a&&(this._stopNotify=g.inArray(e.keyCode,[k.UP,k.DOWN,k.ESC])?1:0);var c;if(b.get("visible")){var d=b.handleKeydown(e);a&&g.inArray(e.keyCode,[k.DOWN,k.UP])&&this._setValue(b.get("activeItem").get("textContent"));if(e.keyCode==k.ESC)return b.hide(),a&&this._setValue(this._savedInputValue),!0;if(e.keyCode==k.TAB&&(c=b.get("activeItem")))if(c.performActionInternal(),this.get("multiple"))return!0;return d}if((e.keyCode==k.DOWN||e.keyCode==k.UP)&&this.get("reFetchOnDownUp"))return this.sendRequest(this._getValue()),
!0}},_uiSetSelectedItem:function(b){if(b){var a=b.get("textContent");this._setValue(a+this.get("strAppendedOnComplete"));this._savedInputValue=a;this.fire("select",{target:b})}},_getValue:function(){var b=this.get("el").val();if(this.get("multiple")){var a=this._getInputDesc(),b=a.tokens,a=a.tokenIndex,d=this.get("separator");return(b=b[a]||"")&&-1!=d.indexOf(b.charAt(0))?b.substring(1):this.get("autoCompleteOnInitial")&&(0==a||-1==a)?b:c}return b},_setValue:function(b){var a=this.get("el");if(this.get("multiple")){var c=
this._getInputDesc(),d=c.tokens,c=c.tokenIndex,h=this.get("separator"),i=this.get("appendSeparatorOnComplete"),f=d[c];d[c]=-1!=h.indexOf(f.charAt(0))?f.charAt(0):"";d[c]+=b;b=d[c+1];if(i&&(!b||-1==h.indexOf(b.charAt(0))))d[c]+=h.charAt(0);b=d.slice(0,c+1).join("").length;a.val(d.join(""));a.prop("selectionStart",b);a.prop("selectionEnd",b)}else a.val(b)},_getInputDesc:function(){for(var b=this.get("el"),a=b.val(),c=[],d=[],h=this.get("literal"),f=this.get("separator"),i=!1,j=this.get("whitespace"),
b=b.prop("selectionStart"),g=-1,k=0;k<a.length;k++){var l=a.charAt(k);k==b&&(g=c.length);if(!i&&(!j&&/\s|\xa0/.test(l)&&(c.push(d.join("")),d=[]),-1!=f.indexOf(l)))c.push(d.join("")),d=[];h&&l==h&&(i=!i);d.push(l)}d.length&&c.push(d.join(""));-1==g&&(g=c.length-1);return{tokens:c,cursorPosition:b,tokenIndex:g}},destructor:function(){this.get("menu").detachInput(this,this.get("destroyMenu"));this.__set("menu",null)}},{ATTRS:{handleMouseEvents:{value:!1},destroyMenu:{value:!1},menu:{setter:function(b){b&&
b.attachInput(this)}},ariaOwns:{view:!0},ariaExpanded:{view:!0},dataSource:{},maxItemCount:{value:99999},menuCfg:{value:{}},format:{},selectedItem:{},multiple:{},separator:{value:",;"},whitespace:{value:!0},appendSeparatorOnComplete:{value:!0},updateInputOnDownUp:{value:!0},reFetchOnDownUp:{value:!0},literal:{value:'"'},autoCompleteOnInitial:{value:!0},alignWithCursor:{},autoHighlightFirst:{},strAppendedOnComplete:{value:""}},DefaultRender:j},"AutoComplete");a.UIStore.setUIConstructorByCssClass("autocomplete-input",
{priority:a.UIStore.PRIORITY.LEVEL1,ui:h});return h},{requires:["event","component","menu","./inputRender","input-selection"]});
KISSY.add("autocomplete/inputRender",function(g,f){return f.define(f.Render,[],{renderUI:function(){this.get("el").attr({"aria-haspopup":!0,"aria-autocomplete":"list",autocomplete:"off",role:"combobox"})},_uiSetAriaOwns:function(a){this.get("el").attr("aria-owns",a)},_uiSetAriaExpanded:function(a){this.get("el").attr("aria-expanded",a)}},{ATTRS:{ariaOwns:{},ariaExpanded:{},elTagName:{value:"input"}}})},{requires:["component"]});
KISSY.add("autocomplete/localDataSource",function(g){function f(a){f.superclass.constructor.apply(this,arguments)}function a(a,f){var b=[],c=0;if(!a)return f;g.each(f,function(f){-1!=f.indexOf(a)&&b.push(f);c++});return b}f.ATTRS={data:{value:[]},dataSourceCfg:{value:{}}};g.extend(f,g.Base,{fetchData:function(d,f,b){var c=this.get("dataSourceCfg").parse||a,g=this.get("data"),g=c(d,g);f.call(b,g)}});return f});
KISSY.add("autocomplete/menu",function(g,f,a,d,j){d=a.define(d.PopupMenu,{_input:null,_inputs:null,attachInput:function(b){this._inputs=this._inputs||[];g.inArray(b,this._inputs)||this._inputs.push(b)},detachInput:function(b,a){var d=this._inputs,h=g.indexOf(b,d||[]);-1!=h&&d.splice(h,1);a&&(!d||0==d.length)&&this.destroy()},bindUI:function(){var b=this;b.on("show",function(){var a=b._input;a.set("ariaOwns",b.get("el").attr("id"));a.set("ariaExpanded",!0)});b.on("hide",function(){var a=b._input;a.set("ariaOwns",
b.get("el").attr("id"));a.set("ariaExpanded",!1)});b.on("click",function(a){var a=a.target,c=b._input;c._stopNotify=1;c.set("selectedItem",a);b.hide();setTimeout(function(){c._stopNotify=0},50)});var a=g.buffer(function(){var b=this._input;b&&this.get("visible")&&b._onWindowResize()},50);b.__reAlign=a;f.on(window,"resize",a,b);var a=b.get("el"),d=b.get("contentEl");a.on("focusin",function(){b._clearDismissTimer()});a.on("focusout",function(){b._hideForAutoComplete()});d.on("mouseover",function(){b._input.get("el")[0].focus();
b._clearDismissTimer()})},_clearDismissTimer:function(){this._dismissTimer&&(clearTimeout(this._dismissTimer),this._dismissTimer=null)},_hideForAutoComplete:function(){var b=this;b._dismissTimer=setTimeout(function(){b._immediateHideForAutoComplete()},30)},_immediateHideForAutoComplete:function(){this.removeChildren(!0);this.hide()},destructor:function(){f.remove(window,"resize",this.__reAlign,this);g.each(this._inputs,function(b){b.__set("menu",null)});this._inputs=null}},{DefaultRender:j,ATTRS:{head:{view:!0},
foot:{view:!0}}},"AutoComplete_Menu");a.UIStore.setUIConstructorByCssClass("autocomplete-menu",{priority:a.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["event","component","menu","./menuRender"]});
KISSY.add("autocomplete/menuRender",function(g,f,a){var d=g.all;return f.define(a.PopupMenu.Render,[],{createDom:function(){var a=this.get("el"),b=d("<div class='"+this.get("prefixCls")+"autocomplete-menu-header'></div>"),c=d("<div class='"+this.get("prefixCls")+"autocomplete-menu-footer'></div>");a.prepend(b);a.append(c);this.__set("head",b);this.__set("foot",c)}},{ATTRS:{head:{view:!0},foot:{view:!0}}})},{requires:["component","menu"]});
KISSY.add("autocomplete/remoteDataSource",function(g,f){function a(d){a.superclass.constructor.apply(this,arguments);this.io=null;this.caches={}}a.ATTRS={dataSourceCfg:{value:{}},xhrCfg:{value:{}}};g.extend(a,g.Base,{fetchData:function(a,g,b){var c=this,i,h=c.get("dataSourceCfg");c.io&&(c.io.abort(),c.io=null);if(!a&&!0!==h.allowEmpty)return g.call(b,[]);if(h.cache&&(i=c.caches[a]))return g.call(b,i);i=c.get("xhrCfg");i.data=i.data||{};i.data[h.paramName]=a;i.success=function(f){h.parse&&(f=h.parse(a,
f));c.__set("data",f);h.cache&&(c.caches[a]=f);g.call(b,f)};c.io=f(i)}});return a},{requires:["ajax"]});
