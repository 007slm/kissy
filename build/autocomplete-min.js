/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 10 20:39
*/
KISSY.add("autocomplete/BasicComboBox",function(h,f,b){function c(b){var a=this.get("menu"),g=this.get("el")[0];a&&a.get&&a.get("visible")?a.hide():(g.focus(),this.sendRequest(""));b&&b.halt()}return f.extend({bindUI:function(){this.get("el");var b=this.get("container");this.get("button");b.on("click",c,this);var a=this.get("menuCfg");null==a.width&&(a.width=b.width())}},{ATTRS:{container:{view:!0},button:{view:!0},xrender:{value:b}}},{xclass:"autocomplete-combobox",priority:30})},{requires:["./basic",
"./BasicComboBoxRender"]});
KISSY.add("autocomplete/BasicComboBoxRender",function(h,f,b){var c=b.all,j;return j=f.extend({createDom:function(){var a=c("<span class='"+this.get("prefixCls")+"combobox'></span>"),b=c("<span class='ks-combobox-button'><span class='ks-combo-button-inner'>&#x25BC;</span></span>").unselectable();b.on("mousedown",function(a){a.preventDefault()});this.__set("container",a);this.__set("button",b)},renderUI:function(){var a=this.get("container"),b=this.get("button"),c=this.get("el").parent();a.appendTo(c).append(this.get("el")).append(b)},
_uiSetFocused:function(a){j.superclass._uiSetFocused.apply(this,arguments);this.get("container")[a?"addClass":"removeClass"]("ks-combobox-focused")},destructor:function(){this.get("container").remove()}},{ATTRS:{container:{},button:{}}})},{requires:["./inputRender","node"]});KISSY.add("autocomplete",function(h,f,b,c,j,a,g){b.Menu=f;b.LocalDataSource=c;b.RemoteDataSource=j;b.Basic=a;b.BasicComboBox=g;return b},{requires:"autocomplete/menu,autocomplete/input,autocomplete/localDataSource,autocomplete/remoteDataSource,autocomplete/basic,autocomplete/BasicComboBox".split(",")});
KISSY.add("autocomplete/basic",function(h,f,b,c,j){return f.extend({initializer:function(){var a,b;this.get("dataSource")||(a=(b=this.get("data"))?new c({data:b,dataSourceCfg:this.get("dataSourceCfg")}):new j({xhrCfg:this.get("xhrCfg"),dataSourceCfg:this.get("dataSourceCfg")}),this.__set("dataSource",a))}},{ATTRS:{data:{},xhrCfg:{value:{}},dataSourceCfg:{value:{}}}},{xclass:"autocomplete-basic",priority:30})},{requires:["./input","./menu","./localDataSource","./remoteDataSource"]});
KISSY.add("autocomplete/input",function(h,f,b,c,j,a,g){function i(d,a){var e=d.get("menu");if(e&&e.xclass)if(a)e=b.create(e,d),d.__set("menu",e);else return null;return e}function k(d){if(d.get("multiple")&&d.get("alignWithCursor")){var a=d._getInputDesc(),e=a.tokens,b=d.get("menu"),c=a.cursorPosition,a=a.tokenIndex,d=d.get("el"),e=e.slice(0,a).join("").length;0<e&&++e;d.prop("selectionStart",e);d.prop("selectionEnd",e);e=d.prop("KsCursorOffset");d.prop("selectionStart",c);d.prop("selectionEnd",c);
b.set("xy",[e.left,e.top])}else b=d.get("menu"),c=d.get("menuCfg")||{},b.set("align",h.merge({node:d.get("el")},n,c.align))}var m,l=f.KeyCodes,n={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};return m=b.Controller.extend({_savedInputValue:null,_stopNotify:0,bindUI:function(){this.get("el").on("valuechange",this._onValueChange,this)},sendRequest:function(d){this.get("dataSource").fetchData(d,this._renderData,this)},_onValueChange:function(){if(!this._stopNotify){var d=this._getValue();d===g?(d=
i(this))&&d.hide():(this._savedInputValue=d,this.sendRequest(d))}},handleBlur:function(){m.superclass.handleBlur.apply(this,arguments);var d=i(this);d&&d._hideForAutoComplete()},_renderData:function(d){var a,e,b;if(!(a=i(this,1)))a=this.get("menuCfg"),null==a.width&&(a.width=this.get("el").width()),a=new c(h.mix({prefixCls:this.get("prefixCls")},this.get("menuCfg"))),this.__set("menu",a);var g=a;g.removeChildren(!0);if(d&&d.length){d=d.slice(0,this.get("maxItemCount"));e=this.get("format")?this.get("format").call(this,
this._getValue(),d):[];for(b=0;b<d.length;b++)a=d[b],g.addChild(h.mix({xclass:"menuitem",content:a,textContent:a,value:a},e[b]));a:{b=this.get("menu");b._clearDismissTimer();k(this);b.show();d=b.get("children");a=this._getValue();for(e=0;e<d.length;e++)if(d[e].get("textContent")==a){b.set("highlightedItem",d[e]);break a}if(this.get("autoHighlightFirst"))for(e=0;e<d.length;e++)if(!d[e].get("disabled")){b.set("highlightedItem",d[e]);break}}}else g.hide()},_onWindowResize:function(){k(this)},handleKeyEventInternal:function(d){this.get("el");
var a=i(this);if(a){var b=this.get("updateInputOnDownUp");b&&(this._stopNotify=h.inArray(d.keyCode,[l.UP,l.DOWN,l.ESC])?1:0);var c;if(a.get("visible")){var g=a.handleKeydown(d);b&&h.inArray(d.keyCode,[l.DOWN,l.UP])&&this._setValue(a.get("activeItem").get("textContent"));if(d.keyCode==l.ESC)return a.hide(),b&&this._setValue(this._savedInputValue),!0;if(d.keyCode==l.TAB&&(c=a.get("activeItem")))if(c.performActionInternal(),this.get("multiple"))return!0;return g}if(d.keyCode==l.DOWN||d.keyCode==l.UP)return this.sendRequest(this._getValue()),
!0}},_uiSetSelectedItem:function(a){if(a){var b=a.get("textContent");this._setValue(b+this.get("strAppendedOnComplete"));this._savedInputValue=b;this.fire("click",{target:a})}},_getValue:function(){var a=this.get("el").val();if(this.get("multiple")){var b=this._getInputDesc(),a=b.tokens,b=b.tokenIndex,e=this.get("separator");return(a=a[b]||"")&&-1!=e.indexOf(a.charAt(0))?a.substring(1):this.get("autoCompleteOnInitial")&&(0==b||-1==b)?a:g}return a},_setValue:function(a){var b=this.get("el");if(this.get("multiple")){var e=
this._getInputDesc(),c=e.tokens,e=e.tokenIndex,g=this.get("separator"),f=this.get("appendSeparatorOnComplete"),j=c[e];c[e]=-1!=g.indexOf(j.charAt(0))?j.charAt(0):"";c[e]+=a;a=c[e+1];if(f&&(!a||-1==g.indexOf(a.charAt(0))))c[e]+=g.charAt(0);a=c.slice(0,e+1).join("").length;b.val(c.join(""));b.prop("selectionStart",a);b.prop("selectionEnd",a)}else b.val(a)},_getInputDesc:function(){for(var a=this.get("el"),b=a.val(),e=[],c=[],g=this.get("literal"),j=this.get("separator"),f=!1,h=this.get("whitespace"),
a=a.prop("selectionStart"),i=-1,k=0;k<b.length;k++){var m=b.charAt(k);k==a&&(i=e.length);if(!f&&(!h&&/\s|\xa0/.test(m)&&(e.push(c.join("")),c=[]),-1!=j.indexOf(m)))e.push(c.join("")),c=[];g&&m==g&&(f=!f);c.push(m)}c.length&&e.push(c.join(""));-1==i&&(i=e.length-1);return{tokens:e,cursorPosition:a,tokenIndex:i}}},{ATTRS:{handleMouseEvents:{value:!1},menu:{setter:function(a){a instanceof c&&a.__set("parent",this)}},ariaOwns:{view:!0},collapsed:{view:!0},dataSource:{},maxItemCount:{value:99999},menuCfg:{value:{}},
format:{},selectedItem:{},multiple:{},separator:{value:",;"},whitespace:{value:!0},appendSeparatorOnComplete:{value:!0},updateInputOnDownUp:{value:!0},literal:{value:'"'},autoCompleteOnInitial:{value:!0},alignWithCursor:{},autoHighlightFirst:{},strAppendedOnComplete:{value:""},xrender:{value:j}}},{xclass:"autocomplete-input",priority:10})},{requires:["event","component","./menu","./inputRender","input-selection"]});
KISSY.add("autocomplete/inputRender",function(h,f){return f.Render.extend({renderUI:function(){this.get("el").attr({"aria-haspopup":!0,"aria-autocomplete":"list",autocomplete:"off",role:"combobox"})},_uiSetAriaOwns:function(b){this.get("el").attr("aria-owns",b)},_uiSetCollapsed:function(b){this.get("el").attr("aria-expanded",b)}},{ATTRS:{ariaOwns:{},collapsed:{},elTagName:{value:"input"}}})},{requires:["component"]});
KISSY.add("autocomplete/localDataSource",function(h){function f(b){f.superclass.constructor.apply(this,arguments)}function b(b,f){var a=[],g=0;if(!b)return f;h.each(f,function(f){-1!=f.indexOf(b)&&a.push(f);g++});return a}f.ATTRS={data:{value:[]},dataSourceCfg:{value:{}}};h.extend(f,h.Base,{fetchData:function(c,f,a){var g=this.get("dataSourceCfg").parse||b,h=this.get("data"),h=g(c,h);f.call(a,h)}});return f});
KISSY.add("autocomplete/menu",function(h,f,b,c){var j=h.Env.host;return b.PopupMenu.extend({bindUI:function(){var a=this;a.on("show",function(){var b=a.get("parent");b.set("ariaOwns",a.get("el").attr("id"));b.set("collapsed",!1)});a.on("hide",function(){a.get("parent").set("collapsed",!0)});a.on("click",function(b){var b=b.target,c=a.get("parent");c._stopNotify=1;c.set("selectedItem",b);a.hide();setTimeout(function(){c._stopNotify=0},50)});var b=h.buffer(function(){this.get("visible")&&this.get("parent")._onWindowResize()},
50);a.__reAlign=b;f.on(j,"resize",b,a);var b=a.get("el"),c=a.get("contentEl");b.on("focusin",function(){a._clearDismissTimer()});b.on("focusout",function(){a._hideForAutoComplete()});c.on("mouseover",function(){a.get("parent").get("el")[0].focus();a._clearDismissTimer()})},_clearDismissTimer:function(){this._dismissTimer&&(clearTimeout(this._dismissTimer),this._dismissTimer=null)},_hideForAutoComplete:function(){var a=this;a._dismissTimer=setTimeout(function(){a._immediateHideForAutoComplete()},30)},
_immediateHideForAutoComplete:function(){this.hide()},destructor:function(){f.remove(j,"resize",this.__reAlign,this)}},{ATTRS:{head:{view:!0},foot:{view:!0},xrender:{value:c}}},{xclass:"autocomplete-menu",priority:40})},{requires:["event","menu","./menuRender"]});
KISSY.add("autocomplete/menuRender",function(h,f){var b=h.all;return f.PopupMenu.Render.extend({createDom:function(){var c=this.get("el"),f=b("<div class='ks-autocomplete-menu-header'></div>"),a=b("<div class='ks-autocomplete-menu-footer'></div>");c.prepend(f);c.append(a);this.__set("head",f);this.__set("foot",a)}},{ATTRS:{head:{view:!0},foot:{view:!0}}})},{requires:["menu"]});
KISSY.add("autocomplete/remoteDataSource",function(h,f){function b(c){b.superclass.constructor.apply(this,arguments);this.io=null;this.caches={}}b.ATTRS={dataSourceCfg:{value:{}},xhrCfg:{value:{}}};h.extend(b,h.Base,{fetchData:function(b,h,a){var g=this,i,k=g.get("dataSourceCfg");g.io&&(g.io.abort(),g.io=null);if(!b&&!0!==k.allowEmpty)return h.call(a,[]);if(k.cache&&(i=g.caches[b]))return h.call(a,i);i=g.get("xhrCfg");i.data=i.data||{};i.data[k.paramName]=b;i.success=function(f){k.parse&&(f=k.parse(b,
f));g.__set("data",f);k.cache&&(g.caches[b]=f);h.call(a,f)};g.io=f(i)}});return b},{requires:["ajax"]});
