/*
Copyright 2010, KISSY UI Library v1.1.0pre
MIT Licensed
build time: ${build.time}
*/
KISSY.add("ajax",function(d){d.Ajax=d.Ajax||{};var l=document,o=l.createElement("script").readyState?function(b,a){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a.call(this)}}}:function(b,a){b.onload=a},p=0,f=function(){return p++},q=function(b){try{return!b.status&&location.protocol==="file:"||b.status>=200&&b.status<300||b.status===304||b.status===1223||b.status===0}catch(a){}return false};d.Ajax.io=function(b){var a={url:location.href,
global:true,type:"GET",contentType:"application/x-www-form-urlencoded",async:true,data:null,xhr:window.XMLHttpRequest&&(window.location.protocol!=="file:"||!window.ActiveXObject)?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(g){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},complete:new Function,
success:new Function,failure:new Function,args:null};d.mix(a,b);var e,i;b=/=\?(&|$)/;var h=/\?/,j=a.type.toUpperCase();if(a.data&&typeof a.data!=="string"){var m="";for(var n in a.data)m+="&"+n+"="+a.data[n];a.data=m.replace(/^&/i,"")}if(a.dataType==="jsonp"){if(j==="GET")b.test(a.url)||(a.url+=(h.test(a.url)?"&":"?")+(a.jsonp||"callback")+"=?");else if(!a.data||!b.test(a.data))a.data=(a.data?a.data+"&":"")+(a.jsonp||"callback")+"=?";a.dataType="json";e="jsonp"+d.now();if(a.data)a.data=(a.data+"").replace(b,
"="+e+"$1");a.url=a.url.replace(b,"="+e+"$1");a.dataType="script";window[e]=window[e]||function(g){a.success(f(),g,a.args);a.complete(f(),g,a.args)}}if(a.data&&j==="GET")a.url+=(h.test(a.url)?"&":"?")+a.data;if(a.dataType==="script")e?d.Ajax.getScript(a.url,new Function):d.Ajax.getScript(a.url,function(){a.complete(f(),a.args);a.success(f(),a.args)});else{var k=false,c=a.xhr();c.open(j,a.url,a.async);try{if(a.data||a&&a.contentType)c.setRequestHeader("Content-Type",a.contentType);c.setRequestHeader("Accept",
a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+", */*":a.accepts._default)}catch(r){}c.onreadystatechange=function(g){if(!c||c.readyState===0||g==="abort"){k||a.complete(f(),c,a.args);k=true;if(c)c.onreadystatechange=new Function}else if(!k&&c&&(c.readyState===4||g==="timeout")){k=true;c.onreadystatechange=new Function;i=g==="timeout"?"timeout":!q(c)?"error":"success";if(i==="success")e||a.success(f(),c,a.args);else a.failure(f(),c,a.args);a.complete(f(),c,a.args);g==="timeout"&&c.abort();
if(a.async)c=null}};c.send(j==="POST"?a.data:null);return c}};d.mix(d.Ajax,{get:function(b,a){a.type="get";a.url=b;d.Ajax(a)},post:function(b,a){a.type="post";a.url=b;d.Ajax(a)},getScript:function(b,a,e){var i=d.get("head")||l.documentElement,h=l.createElement("script");h.src=b;if(e)h.charset=e;h.async=true;d.isFunction(a)&&o(h,a);i.appendChild(h)}});d.io=d.Ajax.io});
