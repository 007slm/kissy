/*
Copyright 2010, KISSY UI Library v1.1.6dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("ajax",function(d,B){function i(a){a=d.merge(J,a);if(a.url){if(a.data&&!d.isString(a.data))a.data=d.param(a.data);a.context=a.context||a;var c,e=m,g,f=a.type.toUpperCase();if(a.dataType===w){c=a.jsonpCallback||w+d.now();a.url=a.url+(a.url.indexOf("?")===-1?"?":"&")+(a.jsonp+"="+c);a.dataType=C;var n=r[c];r[c]=function(j){if(d.isFunction(n))n(j);else{r[c]=B;try{delete r[c]}catch(h){}}o([m,p],j,e,b,a)}}if(a.data&&f===x)a.url=a.url+(a.url.indexOf("?")===-1?"?":"&")+a.data;if(a.dataType===C){k(D,
a);f=d.getScript(a.url,c?null:function(){o([m,p],t,e,b,a)});k(E,a);return f}var q=false,b=a.xhr();k(D,a);b.open(f,a.url,a.async);try{if(a.data||a.contentType)b.setRequestHeader(F,a.contentType);b.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+", */*; q=0.01":a.accepts._default)}catch(L){}b.onreadystatechange=function(j){if(!b||b.readyState===0||j==="abort"){q||o(p,null,s,b,a);q=true;if(b)b.onreadystatechange=G}else if(!q&&b&&(b.readyState===4||j===u)){q=true;b.onreadystatechange=
G;var h;if(j===u)h=u;else{a:{try{h=b.status>=200&&b.status<300||b.status===304||b.status===1223;break a}catch(M){}h=false}h=h?m:s}e=h;try{h=b;var v=a.dataType,y=t,H,l=h;if(!d.isString(l)){y=h.getResponseHeader(F)||t;l=(H=v==="xml"||!v&&y.indexOf("xml")>=0)?h.responseXML:h.responseText;if(H&&l.documentElement.nodeName===z)throw z;}if(d.isString(l))if(v===A||!v&&y.indexOf(A)>=0)l=d.JSON.parse(l);g=l}catch(N){e=z}o([e===m?m:s,p],g,e,b,a);if(j===u){b.abort();k(K,a)}if(a.async)b=null}};k(E,a);try{b.send(f===
I?a.data:null)}catch(O){o([s,p],g,s,b,a)}a.async||k(p,a);return b}}function o(a,c,e,g,f){if(d.isArray(a))d.each(a,function(n){o(n,c,e,g,f)});else{e===a&&f[a]&&f[a].call(f.context,c,e,g);k(a,f)}}function k(a,c){i.fire(a,{ajaxConfig:c})}var r=window,G=function(){},x="GET",I="POST",F="Content-Type",A="json",w=A+"p",C="script",t="",D="start",E="send",K="stop",m="success",p="complete",s="error",u="timeout",z="parsererror",J={type:x,url:t,contentType:"application/x-www-form-urlencoded",async:true,data:null,
xhr:r.XMLHttpRequest?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},jsonp:"callback"};d.mix(i,d.EventTarget);d.mix(i,{get:function(a,c,e,g,f){if(d.isFunction(c)){g=e;e=c}return i({type:f||x,url:a,data:c,success:function(n,q,b){e&&e.call(this,
n,q,b)},dataType:g})},post:function(a,c,e,g){if(d.isFunction(c)){g=e;e=c;c=B}return i.get(a,c,e,g,I)},jsonp:function(a,c,e){if(d.isFunction(c))e=c;return i.get(a,c,e,w)}});i.getScript=d.getScript;d.io=d.ajax=i.ajax=i;d.jsonp=i.jsonp;d.IO=i});
