/*
Copyright 2010, KISSY UI Library v1.1.5
MIT Licensed
build time: Nov 19 15:43
*/
KISSY.add("ajax",function(e,H){function f(a){a=e.merge(I,a);var c,d=m,g,h=a.type.toUpperCase();if(a.data&&!e.isString(a.data))a.data=e.param(a.data);if(a.dataType===x){if(h===v){if(!n.test(a.url))a.url=(a.url.indexOf("?")===-1?"?":"&")+(a.jsonp+"=?")}else if(!a.data||!n.test(a.data))a.data=(a.data?a.data+"&":r)+a.jsonp+"=?";a.dataType=s}if(a.dataType===s&&(a.data&&n.test(a.data)||n.test(a.url))){c=a.jsonpCallback||x+e.now();if(a.data)a.data=(a.data+r).replace(n,"="+c+"$1");a.url=a.url.replace(n,"="+
c+"$1");a.dataType=y;var j=t[c];t[c]=function(k){if(e.isFunction(j))j(k);else{t[c]=H;try{delete t[c]}catch(i){}}l([m,u],k,b,d,a)}}if(a.data&&h===v)a.url=(a.url.indexOf("?")===-1?"?":"&")+a.data;if(a.dataType===y){f.fire(C);e.getScript(a.url,c?null:function(){l([m,u],r,b,d,a)});f.fire(D)}else{var o=false,b=a.xhr();f.fire(C,{xhr:b});b.open(h,a.url,a.async);try{if(a.data||a.contentType)b.setRequestHeader("Content-Type",a.contentType);b.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+
", */*":a.accepts._default)}catch(K){}b.onreadystatechange=function(k){if(!b||b.readyState===0||k==="abort"){o||l(u,null,b,z,a);o=true;if(b)b.onreadystatechange=E}else if(!o&&b&&(b.readyState===4||k===w)){o=true;b.onreadystatechange=E;var i;if(k===w)i=w;else{a:{try{i=b.status>=200&&b.status<300||b.status===304||b.status===0||b.status===1223;break a}catch(L){}i=false}i=!i?z:m}d=i;try{i=b;var p=a.dataType,A=i.getResponseHeader("content-type")||r,F=p==="xml"||!p&&A.indexOf("xml")>=0,q=F?i.responseXML:
i.responseText;F&&q.documentElement.nodeName===B&&e.error(B);if(e.isString(q))if(p===s||!p&&A.indexOf(x)>=0)q=e.JSON.parse(q);else if(p===y||!p&&A.indexOf("javascript")>=0)e.globalEval(q);g=q}catch(M){d=B}if(d===m)c||l(m,g,b,d,a);else l(z,g,b,d,a);l(u,g,b,d,a);if(k===w){b.abort();f.fire(J,{xhr:b})}if(a.async)b=null}};f.fire(D,{xhr:b});b.send(h===G?a.data:null);a.async||f.fire(u,{xhr:b});return b}}function l(a,c,d,g,h){if(e.isArray(a))e.each(a,function(j){l(j,c,d,g,h)});else{h[a](c,d,g);f.fire(a,{xhr:d})}}
var t=window,E=function(){},v="GET",G="POST",s="json",x=s+"p",y="script",r="",m="success",u="complete",z="error",w="timeout",B="parsererror",C="start",D="send",J="stop",n=/=\?(&|$)/,I={type:v,url:r,global:true,contentType:"application/x-www-form-urlencoded",async:true,data:null,xhr:t.XMLHttpRequest?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",
json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},complete:function(){},success:function(){},error:function(){},jsonp:"callback"};e.mix(f,e.EventTarget);e.mix(f,{get:function(a,c,d,g,h){if(e.isFunction(c)){g=d;d=c}f({type:h||v,url:a,data:c,complete:function(j,o,b){e.isFunction(d)&&d(j,o,b)},dataType:g});return this},post:function(a,c,d,g){if(e.isFunction(c)){g=d;d=c;c=null}return f.get(a,c,d,g,G)},getJSON:function(a,c,d){if(e.isFunction(c))d=c;f({dataType:s,url:a,complete:function(g,
h,j){e.isFunction(d)&&d(g,h,j)},data:c});return this}});f.getScript=e.getScript;e.ajax=e.io=f;e.getJSON=f.getJSON});
