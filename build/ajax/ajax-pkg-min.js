/*
Copyright 2010, KISSY UI Library v1.1.5
MIT Licensed
build time: Nov 18 11:23
*/
KISSY.add("ajax",function(f){f.namespace("S.Ajax");_transactionid=0;var o=function(){};f.augment(o,f.EventTarget);var e=new o;f.Ajax=function(d){var a={url:window.location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",async:true,data:null,xhr:window.XMLHttpRequest&&(window.location.protocol!=="file:"||!window.ActiveXObject)?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(i){}},accepts:{xml:"application/xml, text/xml",
html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},complete:function(){},success:function(){},failure:function(){},args:null};f.mix(a,d);var c,g;d=/=\?(&|$)/;var j=/\?/,h=a.type.toUpperCase();if(a.data&&typeof a.data!=="string"){var k="",n;for(n in a.data)k+="&"+n+"="+a.data[n];a.data=k.replace(/^&/i,"")}if(a.dataType==="jsonp"){if(h==="GET")d.test(a.url)||(a.url+=(j.test(a.url)?"&":"?")+(a.jsonp||"callback")+
"=?");else if(!a.data||!d.test(a.data))a.data=(a.data?a.data+"&":"")+(a.jsonp||"callback")+"=?";a.dataType="json";c="jsonp"+f.now();if(a.data)a.data=(a.data+"").replace(d,"="+c+"$1");a.url=a.url.replace(d,"="+c+"$1");a.dataType="script";window[c]=window[c]||function(i){a.success(_transactionid++,i,a.args);e.fire("success",{xhr:b});a.complete(_transactionid++,i,a.args);e.fire("complete",{xhr:b})}}if(a.data&&h==="GET")a.url+=(j.test(a.url)?"&":"?")+a.data;if(a.dataType==="script")if(c){e.fire("start",
{xhr:b});f.getScript(a.url,function(){});e.fire("send",{xhr:b})}else f.getScript(a.url,function(){a.complete(_transactionid++,a.args);e.fire("complete",{xhr:b});a.success(_transactionid++,a.args);e.fire("success",{xhr:b})});else{var m=false,b=a.xhr();e.fire("start",{xhr:b});b.open(h,a.url,a.async);try{if(a.data||a&&a.contentType)b.setRequestHeader("Content-Type",a.contentType);b.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+", */*":a.accepts._default)}catch(p){}b.onreadystatechange=
function(i){if(!b||b.readyState===0||i==="abort"){if(!m){a.complete(_transactionid++,b,a.args);e.fire("complete",{xhr:b})}m=true;if(b)b.onreadystatechange=function(){}}else if(!m&&b&&(b.readyState===4||i==="timeout")){m=true;b.onreadystatechange=function(){};var l;if(i==="timeout")l="timeout";else{a:{try{l=!b.status&&location.protocol==="file:"||b.status>=200&&b.status<300||b.status===304||b.status===1223||b.status===0;break a}catch(q){}l=false}l=!l?"error":"success"}g=l;if(g==="success"){if(!c){a.success(_transactionid++,
b,a.args);e.fire("success",{xhr:b})}}else{a.failure(_transactionid++,b,a.args);e.fire("error",{xhr:b})}a.complete(_transactionid++,b,a.args);e.fire("complete",{xhr:b});if(i==="timeout"){b.abort();e.fire("stop",{xhr:b})}if(a.async)b=null}};e.fire("send",{xhr:b});b.send(h==="POST"?a.data:null);a.async==false&&e.fire("complete",{xhr:b});return b}};f.mix(f.Ajax,{get:function(d,a,c,g){if(typeof a=="undefined"){a=null;c=function(){}}if(typeof a=="function"){g=c||"_default";c=a;a=null}if(typeof c=="undefined"){c=
function(){};g="_default"}f.Ajax({type:"get",url:d,data:a,complete:function(j,h,k){c(h,k)},dataType:g})},post:function(d,a,c,g){if(typeof a=="undefined"){a=null;c=function(){}}if(typeof a=="function"){g=c||"_default";c=a;a=null}if(typeof c=="undefined"){c=function(){};g="_default"}f.Ajax({type:"post",url:d,complete:function(j,h,k){c(h,k)},data:a,dataType:g})},jsonp:function(d,a,c){if(typeof a=="undefined"){a=null;c=function(){}}if(typeof a=="function"){c=a;a=null}if(typeof c=="undefined")c=function(){};
f.Ajax({dataType:"jsonp",url:d,complete:function(g,j,h){c(j,h)},data:a})},getJSON:function(d,a,c){if(typeof a=="undefined"){a=null;c=function(){}}if(typeof a=="function"){c=a;a=null}if(typeof c=="undefined")c=function(){};f.Ajax({dataType:"json",url:d,complete:function(g,j,h){c(f.JSON.parse(j.responseText),h)},data:a})},onComplete:function(d){e.on("complete",d)},onError:function(d){e.on("error",d)},onSend:function(d){e.on("send",d)},onStart:function(d){e.on("start",d)},onStop:function(d){e.on("stop",
d)},onSuccess:function(d){e.on("success",d)}});f.io=f.Ajax});
