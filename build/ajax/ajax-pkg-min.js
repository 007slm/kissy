KISSY.add("ajax/base",function(g,b,t,i){var c=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,p=/\s+/,f=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,l=function(e){return e},h=/^(?:GET|HEAD)$/,o,m;try{o=location.href}catch(q){o=document.createElement("a");o.href="";o=o.href}m=f.exec(o);var n=c.test(m[1]),s={},k={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:b.parse,html:l,text:l,xml:g.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};k.converters.html=k.converters.text;function d(u){u=g.mix(g.clone(k),u||{},undefined,undefined,true);if(u.crossDomain==null){var e=f.exec(u.url.toLowerCase());u.crossDomain=!!(e&&(e[1]!=m[1]||e[2]!=m[2]||(e[3]||(e[1]==="http:"?80:443))!=(m[3]||(m[1]==="http:"?80:443))))}if(u.processData&&u.data&&!g.isString(u.data)){u.data=g.param(u.data,undefined,undefined,u.serializeArray)}u.type=u.type.toUpperCase();u.hasContent=!h.test(u.type);if(!u.hasContent){if(u.data){u.url+=(/\?/.test(u.url)?"&":"?")+u.data}if(u.cache===false){u.url+=(/\?/.test(u.url)?"&":"?")+"_ksTS="+(g.now()+"_"+g.guid())}}u.dataType=g.trim(u.dataType||"*").split(p);u.context=u.context||u;return u}function r(e,u){j.fire(e,{ajaxConfig:u.config,xhr:u})}function a(v){var w=this,x=w.config,u=v.type;if(this.timeoutTimer){clearTimeout(this.timeoutTimer)}if(x[u]){x[u].call(x.context,w.responseData,w.statusText,w)}r(u,w)}function j(B){if(!B.url){return undefined}B=d(B);var z=new i(B);r("start",z);var y=s[B.dataType[0]]||s["*"],A=new y(z);z.transport=A;if(B.contentType){z.setRequestHeader("Content-Type",B.contentType)}var u=B.dataType[0],w=B.accepts;z.setRequestHeader("Accept",u&&w[u]?w[u]+(u!=="*"?", */*; q=0.01":""):w["*"]);for(var v in B.headers){z.setRequestHeader(v,B.headers[v])}z.on("complete success error",a);z.readyState=1;r("send",z);if(B.async&&B.timeout>0){z.timeoutTimer=setTimeout(function(){z.abort("timeout")},B.timeout)}try{z.state=1;A.send()}catch(x){if(z.status<2){z.callback(-1,x)}else{g.error(x)}}return z}g.mix(j,t.Target);g.mix(j,{isLocal:n,setupConfig:function(e){g.mix(k,e,undefined,undefined,true)},setupTransport:function(e,u){s[e]=u},getTransport:function(e){return s[e]},getConfig:function(){return k}});return j},{requires:["json","event","./xhrobject"]});KISSY.add("ajax/form-serializer",function(b,c){var a=encodeURIComponent;return{serialize:function(d){d=c.get(d);var e={};b.each(d.elements,function(f){var g=f.disabled;if(!g){e[f.name]=c.val(f)}});return b.param(e,undefined,undefined,false)}}},{requires:["dom"]});KISSY.add("ajax/form",function(a,d,b,c){d.on("start",function(i){var k=i.xhr,l=k.config;if(l.form){var f=b.get(l.form),g=f.encoding||f.enctype;if(g.toLowerCase()!="multipart/form-data"){var h=c.serialize(f);if(h){if(l.hasContent){l.data=l.data||"";if(l.data){l.data+="&"}l.data+=h}else{l.url+=(/\?/.test(l.url)?"&":"?")+h}}}else{var j=l.dataType[0];if(j=="*"){j="text"}l.dataType.length=2;l.dataType[0]="iframe";l.dataType[1]=j}}});return d},{requires:["./base","dom","./form-serializer"]});KISSY.add("ajax/iframe-upload",function(c,i,h,e){var g=document;e.setupConfig({converters:{iframe:e.getConfig().converters.text,text:{iframe:function(j){return j}}}});function f(j){var k=c.guid("ajax-iframe");j.iframe=i.create("<iframe  id='"+k+"' name='"+k+"' style='position:absolute;left:-9999px;top:-9999px;'/>");j.iframeId=k;i.prepend(j.iframe,g.body||g.documentElement)}function d(n,m,j){n=c.unparam(n);var k=[];for(var p in n){var q=c.makeArray(n[p]);for(var l=0;l<q.length;l++){var o=g.createElement("input");o.type="hidden";o.name=p+(j?"[]":"");o.value=q[l];i.append(o,m);k.push(o)}}return k}function a(j){i.remove(j)}function b(j){this.xhr=j}c.augment(b,{send:function(){var m=this.xhr,n=m.config,j,l=i.get(n.form);this.attrs={target:i.attr(l,"target")||"",action:i.attr(l,"action")||""};this.form=l;f(m);i.attr(l,{target:m.iframeId,action:n.url});if(n.data){j=d(n.data,l,n.serializeArray)}this.fields=j;var k=m.iframe;h.on(k,"load error",this._callback,this);l.submit()},_callback:function(m,p){var l=this.form,o=this.xhr,j=m.type,k=o.iframe;i.attr(l,this.attrs);if(j=="load"){var n=k.contentWindow.document;o.responseXML=n;o.responseText=i.text(n.body);o.callback(200,"success")}else{if(j=="error"){o.callback(500,"error")}}a(this.fields);h.detach(k);setTimeout(function(){i.remove(k)},30);o.iframe=null},abort:function(){this._callback(0,1)}});e.setupTransport("iframe",b);return e},{requires:["dom","event","./base"]});KISSY.add("ajax/jsonp",function(a,b){b.setupConfig({jsonp:"callback",jsonpCallback:function(){return a.guid("jsonp")}});b.on("start",function(h){var j=h.xhr,k=j.config;if(k.dataType[0]=="jsonp"){var f,d=k.jsonpCallback,i=a.isFunction(d)?d():d,g=window[i];k.url+=(/\?/.test(k.url)?"&":"?")+k.jsonp+"="+i;window[i]=function(c){f=[c]};j.on("complete",function(){window[i]=g;if(g===undefined){try{delete window[i]}catch(c){}}else{if(f){g(f[0])}}});j.converters=j.converters||{};j.converters.script=j.converters.script||{};j.converters.script.json=function(){if(!f){a.error(" not call jsonpCallback : "+i)}return f[0]};k.dataType.length=2;k.dataType[0]="script";k.dataType[1]="json"}});return b},{requires:["./base"]});KISSY.add("ajax/script",function(b,c){c.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){b.globalEval(d);return d}}}});function a(d){if(!d.config.crossDomain&&!d.config.forceScript){return new (c.getTransport("*"))(d)}this.xhrObj=d;return 0}b.augment(a,{send:function(){var e=this,d,f=this.xhrObj,h=f.config,g=document.head||document.getElementsByTagName("head")[0]||document.documentElement;e.head=g;d=document.createElement("script");e.script=d;d.async="async";if(h.scriptCharset){d.charset=h.scriptCharset}d.src=h.url;d.onerror=d.onload=d.onreadystatechange=function(i){i=i||window.event;e._callback((i.type||"error").toLowerCase())};g.insertBefore(d,g.firstChild)},_callback:function(g,h){var d=this.script,e=this.xhrObj,f=this.head;if(h||!d.readyState||/loaded|complete/.test(d.readyState)||g=="error"){d.onerror=d.onload=d.onreadystatechange=null;if(f&&d.parentNode){f.removeChild(d)}this.script=undefined;this.head=undefined;if(!h&&g!="error"){e.callback(200,"success")}else{if(g=="error"){e.callback(500,"scripterror")}}}},abort:function(){this._callback(0,1)}});c.setupTransport("script",a);return c},{requires:["./base","./xhr"]});KISSY.add("ajax/xhr",function(c,g){function b(){try{return new window.XMLHttpRequest()}catch(h){}return undefined}function f(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}return undefined}g.xhr=window.ActiveXObject?function(h){var i;if(g.isLocal&&!h){i=f()}return i||b()}:b;var a=g.xhr(),d=false;if(a){if("withCredentials" in a){d=true}function e(h){this.xhrObj=h}c.augment(e,{send:function(){var j=this,k=j.xhrObj,o=k.config;if(o.crossDomain&&!d){c.error("do not allow crossdomain xhr !");return}var n=g.xhr(),h,l;j.xhr=n;if(o.username){n.open(o.type,o.url,o.async,o.username,o.password)}else{n.open(o.type,o.url,o.async)}if(h=o.xhrFields){for(l in h){n[l]=h[l]}}if(k.mimeType&&n.overrideMimeType){n.overrideMimeType(k.mimeType)}if(!o.crossDomain&&!k.requestHeaders["X-Requested-With"]){k.requestHeaders["X-Requested-With"]="XMLHttpRequest"}try{for(l in k.requestHeaders){n.setRequestHeader(l,k.requestHeaders[l])}}catch(m){}n.send(o.hasContent&&o.data||null);if(!o.async||n.readyState==4){j._callback()}else{n.onreadystatechange=function(){j._callback()}}},abort:function(){this._callback(0,1)},_callback:function(h,l){try{var r=this,q=r.xhr,m=r.xhrObj,p=m.config;if(l||q.readyState==4){q.onreadystatechange=c.noop;if(l){if(q.readyState!==4){q.abort()}}else{var j=q.status;m.responseHeadersString=q.getAllResponseHeaders();var n=q.responseXML;if(n&&n.documentElement){m.responseXML=n}m.responseText=q.responseText;try{var i=q.statusText}catch(o){i=""}if(!j&&g.isLocal&&!p.crossDomain){j=m.responseText?200:404}else{if(j===1223){j=204}}m.callback(j,i)}}}catch(k){q.onreadystatechange=c.noop;if(!l){m.callback(-1,k)}}}});g.setupTransport("*",e);return g}},{requires:["./base"]});KISSY.add("ajax/xhrobject",function(d,b){var e=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;function a(t){var s=t.responseText,k=t.responseXML,o=t.config,n=o.converters,m=t.converters||{},p,f,g=o.contents,q=o.dataType;if(s||k){var r=t.mimeType||t.getResponseHeader("Content-Type");while(q[0]=="*"){q.shift()}if(!q.length){for(p in g){if(g[p].test(r)){if(q[0]!=p){q.unshift(p)}break}}}q[0]=q[0]||"text";if(q[0]=="text"&&s!=undefined){f=s}else{if(q[0]=="xml"&&k!=undefined){f=k}else{d.each(["text","xml"],function(i){var v=q[0],u=m[i]&&m[i][v]||n[i]&&n[i][v];if(u){q.unshift(i);f=i=="text"?s:k;return false}})}}}var l=q[0];for(var j=1;j<q.length;j++){p=q[j];var h=m[l]&&m[l][p]||n[l]&&n[l][p];if(!h){throw"no covert for "+l+" => "+p}f=h(f);l=p}t.responseData=f}function c(f){d.mix(this,{responseData:null,config:f||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}d.augment(c,b.Target,{setRequestHeader:function(f,g){this.requestHeaders[f]=g;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(g){var f;if(this.state===2){if(!this.responseHeaders){this.responseHeaders={};while((f=e.exec(this.responseHeadersString))){this.responseHeaders[f[1]]=f[2]}}f=this.responseHeaders[g]}return f===undefined?null:f},overrideMimeType:function(f){if(!this.state){this.mimeType=f}return this},abort:function(f){f=f||"abort";if(this.transport){this.transport.abort(f)}this.callback(0,f);return this},callback:function(g,i){var j=this;if(j.state==2){return}j.state=2;j.readyState=4;var f;if(g>=200&&g<300||g==304){if(g==304){i="notmodified";f=true}else{try{a(j);i="success";f=true}catch(h){i="parsererror : "+h}}}else{if(g<0){g=0}}j.status=g;j.statusText=i;if(f){j.fire("success")}else{j.fire("error")}j.fire("complete");j.transport=undefined}});return c},{requires:["event"]});KISSY.add("ajax",function(a,c){var b=undefined;a.mix(c,{get:function(e,g,h,d,f){if(a.isFunction(g)){d=h;h=g;g=b}return c({type:f||"get",url:e,data:g,success:h,dataType:d})},post:function(e,f,g,d){if(a.isFunction(f)){d=g;g=f;f=b}return c.get(e,f,g,d,"post")},jsonp:function(d,e,f){if(a.isFunction(e)){f=e;e=b}return c.get(d,e,f,"jsonp")},getScript:a.getScript,getJSON:function(d,e,f){if(a.isFunction(e)){f=e;e=b}return c.get(d,e,f,"json")},upload:function(e,f,g,h,d){if(a.isFunction(g)){d=h;h=g;g=b}return c({url:e,type:"post",dataType:d,form:f,data:g,success:h})}});return c},{requires:["ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
