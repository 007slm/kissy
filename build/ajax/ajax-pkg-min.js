/*
Copyright 2011, KISSY UI Library v1.1.8dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("ajax",function(e,x){function h(a){a=e.merge(F,a);if(a.url){if(a.data&&!e.isString(a.data))a.data=e.param(a.data);a.context=a.context||a;var b,c=l,g,f=a.type.toUpperCase();if(a.dataType===t){b=a.jsonpCallback||t+e.now();a.url=y(a.url,a.jsonp+"="+b);a.dataType=z;var m=i[b];i[b]=function(j){if(e.isFunction(m))m(j);else{i[b]=x;try{delete i[b]}catch(G){}}n([l,o],j,c,d,a)}}if(a.data&&f===u)a.url=y(a.url,a.data);if(a.dataType===z){k(A,a);f=e.getScript(a.url,b?null:function(){n([l,o],r,c,d,a)});
k(B,a);return f}var p=false,d=a.xhr();k(A,a);d.open(f,a.url,a.async);try{if(a.data||a.contentType)d.setRequestHeader(C,a.contentType);d.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+", */*; q=0.01":a.accepts._default)}catch(K){}d.onreadystatechange=function(j){if(!d||d.readyState===0||j==="abort"){p||n(o,null,q,d,a);p=true;if(d)d.onreadystatechange=D}else if(!p&&d&&(d.readyState===4||j===s)){p=true;d.onreadystatechange=D;c=j===s?s:H(d)?l:q;try{g=I(d,a.dataType)}catch(G){c=
v}n([c===l?l:q,o],g,c,d,a);if(j===s){d.abort();k(J,a)}if(a.async)d=null}};k(B,a);try{d.send(f===E?a.data:null)}catch(L){n([q,o],g,q,d,a)}a.async||k(o,a);return d}}function H(a){try{return a.status>=200&&a.status<300||a.status===304||a.status===1223}catch(b){}return false}function y(a,b){return a+(a.indexOf("?")===-1?"?":"&")+b}function n(a,b,c,g,f){if(e.isArray(a))e.each(a,function(m){n(m,b,c,g,f)});else{c===a&&f[a]&&f[a].call(f.context,b,c,g);k(a,f)}}function k(a,b){h.fire(a,{ajaxConfig:b})}function I(a,
b){var c=r,g,f=a;if(!e.isString(f)){c=a.getResponseHeader(C)||r;f=(g=b==="xml"||!b&&c.indexOf("xml")>=0)?a.responseXML:a.responseText;if(g&&f.documentElement.nodeName===v)throw v;}if(e.isString(f))if(b===w||!b&&c.indexOf(w)>=0)f=e.JSON.parse(f);return f}var i=window,D=function(){},u="GET",E="POST",C="Content-Type",w="json",t=w+"p",z="script",r="",A="start",B="send",J="stop",l="success",o="complete",q="error",s="timeout",v="parsererror",F={type:u,url:r,contentType:"application/x-www-form-urlencoded",
async:true,data:null,xhr:i.ActiveXObject?function(){if(i.XmlHttpRequest)try{return new i.XMLHttpRequest}catch(a){}try{return new i.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}:function(){return new i.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},jsonp:"callback"};e.mix(h,e.EventTarget);e.mix(h,{get:function(a,b,c,g,f){if(e.isFunction(b)){g=c;c=b}return h({type:f||
u,url:a,data:b,success:function(m,p,d){c&&c.call(this,m,p,d)},dataType:g})},post:function(a,b,c,g){if(e.isFunction(b)){g=c;c=b;b=x}return h.get(a,b,c,g,E)},jsonp:function(a,b,c){if(e.isFunction(b)){c=b;b=null}return h.get(a,b,c,t)}});h.getScript=e.getScript;e.io=e.ajax=h.ajax=h;e.jsonp=h.jsonp;e.IO=h});
