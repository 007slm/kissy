/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 1 21:35
*/
KISSY.add("tree/base",function(e,c,d,f,b){return d.extend([b],{expandAll:function(){return d.prototype.expandAll.apply(this,arguments)}},{ATTRS:{xrender:{value:f}}},{xclass:"tree",priority:30})},{requires:["component","./node","./tree-render","./tree-manager"]});
KISSY.add("tree/check-node-render",function(e,c,d){var f=c.all;return d.extend({createDom:function(){var b=this.get("expandIconEl");this.setInternal("checkIconEl",f("<div>").insertAfter(b))},_uiSetCheckState:function(b){this.get("checkIconEl").removeClass(this.getCssClassWithPrefix("tree-node-checked0 tree-node-checked1 tree-node-checked2")).addClass(this.getCssClassWithPrefix("tree-node-checked")+b)}},{ATTRS:{checkIconEl:{},checkState:{value:0}}})},{requires:["node","./node-render"]});
KISSY.add("tree/check-node",function(e,c,d,f){var b=c.all,a=d.extend({expandAll:function(){return a.superclass.expandAll.apply(this,arguments)},performActionInternal:function(a){var e;e=this.get("expanded");var c=this.get("expandIconEl"),d=this.get("tree"),a=b(a.target);d.get("el")[0].focus();a.equals(c)?this.set("expanded",!e):(e=this.get("checkState"),this.set("checkState",1==e?0:1),this.fire("click"))},_uiSetCheckState:function(b){var a=this.get("parent"),c,d,f,h;(1==b||0==b)&&e.each(this.get("children"),
function(a){a.set("checkState",b)});if(a){c=0;h=a.get("children");for(d=0;d<h.length;d++){f=h[d];f=f.get("checkState");if(2==f){a.set("checkState",2);return}1==f&&c++}0===c?a.set("checkState",0):c==h.length?a.set("checkState",1):a.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkState:{view:1},xrender:{value:f}}},{xclass:"check-tree-node",priority:20});e.mix(a,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return a},{requires:["node","./node","./check-node-render"]});
KISSY.add("tree/check-tree-render",function(e,c,d){return c.extend([d])},{requires:["./check-node-render","./tree-manager-render"]});KISSY.add("tree/check-tree",function(e,c,d,f,b){var a=d.extend([b],{expandAll:function(){return a.superclass.expandAll.apply(this,arguments)},_uiSetFocused:function(){}},{ATTRS:{xrender:{value:f}}},{xclass:"check-tree",priority:40});return a},{requires:["component","./check-node","./check-tree-render","./tree-manager"]});
KISSY.add("tree/node-render",function(e,c,d){var f=c.all;return d.Render.extend({refreshCss:function(b,a){var c=this.get("expanded"),d=this.get("iconEl"),f,i=this.get("expandIconEl"),l=this.get("childrenEl");a?(c="tree-file-icon",f="tree-expand-icon-{t}"):c?(c="tree-expanded-folder-icon",f="tree-expand-icon-{t}minus"):(c="tree-collapsed-folder-icon",f="tree-expand-icon-{t}plus");d.attr("class",this.getCssClassWithPrefix(c));i.attr("class",this.getCssClassWithPrefix(e.substitute(f,{t:b?"l":"t"})));
l&&l.attr("class",this.getCssClassWithPrefix(b?"tree-lchildren":"tree-children"))},createDom:function(){var b=this.get("el"),a,c,d,j,i=this.get("contentEl");c=f("<div class='"+this.getCssClassWithPrefix("tree-node-row")+"'/>");(a=i.attr("id"))||i.attr("id",a=e.guid("ks-tree-node"));d=f("<div>").appendTo(c);j=f("<div>").appendTo(c);i.appendTo(c);b.attr({role:"tree-node","aria-labelledby":a}).prepend(c);this.setInternal("rowEl",c);this.setInternal("expandIconEl",d);this.setInternal("iconEl",j)},_uiSetExpanded:function(b){var a=
this.get("childrenEl");if(a)a[b?"show":"hide"]();this.get("el").attr("aria-expanded",b)},_uiSetSelected:function(b){this.get("rowEl")[b?"addClass":"removeClass"](this.getCssClassWithPrefix("tree-node-selected"));this.get("el").attr("aria-selected",b)},_uiSetDepth:function(b){this.get("el").attr("aria-level",b)},_uiSetTooltip:function(b){this.get("el").attr("title",b)},getContentElement:function(){var b;if(b=this.get("childrenEl"))return b;b=f("<div "+(this.get("expanded")?"":"style='display:none'")+
" role='group'></div>").appendTo(this.get("el"));this.setInternal("childrenEl",b);return b}},{ATTRS:{childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{value:0},contentEl:{valueFn:function(){return f("<span id='"+e.guid("ks-tree-node")+"' class='"+this.getCssClassWithPrefix("tree-node-content")+"'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(b){return b.children("."+this.getCssClassWithPrefix("tree-children"))},contentEl:function(b){return b.children("."+
this.getCssClassWithPrefix("tree-node-content"))},isLeaf:function(b){if(b.hasClass(this.getCssClassWithPrefix("tree-node-leaf")))return!0;if(b.hasClass(this.getCssClassWithPrefix("tree-node-folder")))return!1},expanded:function(b){b=b.one("."+this.get("prefixCls")+"tree-children");return!b?!1:"none"!=b.css("display")}}})},{requires:["node","component"]});
KISSY.add("tree/node",function(e,c,d,f){function b(g,a,c,d){g[c](a);void 0!==d&&a.set("depth",d);e.each(a.get("children"),function(a){a.isController&&(d?b(g,a,c,d+1):b(g,a,c))})}function a(g){var a=g.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==g}function k(a){var b=a.get("isLeaf");return!(!1===b||void 0===b&&a.get("children").length)}function m(a){var b=a.get("children");return!a.get("expanded")||!b.length?a:m(b[b.length-1])}function j(g){g.get&&g.get("view")&&g.get("view").refreshCss(a(g),
k(g))}function i(a){var b=a.get("children"),c=a.get("children").length;j(a);e.each(b,function(a,b){if(a.get){j(a);var g=a.get("el");g.attr("aria-posinset",b+1);g.attr("aria-setsize",c)}})}var l=c.all,h=c.KeyCodes,n=d.Container.extend([d.DecorateChild],{syncUI:function(){j(this)},_keyNav:function(a){var b=!0,c=this.get("tree"),d=this.get("expanded"),e,f=this.get("isLeaf"),k=this.get("children");switch(a.keyCode){case h.HOME:e=c;break;case h.END:e=m(c);break;case h.UP:e=a=(a=this.prev())?m(a):this.get("parent");
break;case h.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)e=a[0];else{a=this.next();for(c=this;!a&&(c=c.get("parent"));)a=c.next();e=a}break;case h.LEFT:d&&(k.length||!1===f)?this.set("expanded",!1):e=this.get("parent");break;case h.RIGHT:if(k.length||!1===f)d?e=k[0]:this.set("expanded",!0);break;default:b=!1}e&&e.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=e.indexOf(this,a);return b==a.length-1?null:a[b+1]},prev:function(){var a=
this.get("parent"),b;if(!a)return null;a=a.get("children");b=e.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.get("tree").set("selectedItem",this)},performActionInternal:function(a){var a=l(a.target),b=this.get("expanded");this.get("tree").get("el")[0].focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!b):(this.select(),this.fire("click"))},decorateChildrenInternal:function(a,b){this.addChild(new a({srcNode:b,prefixCls:this.get("prefixCls")}))},addChild:function(){var a;
a=n.superclass.addChild.apply(this,e.makeArray(arguments));var c=this.get("tree");c&&(b(c,a,"_register",this.get("depth")+1),i(this));return a},removeChild:function(a){var c=this.get("tree");c&&(b(c,a,"_unRegister"),n.superclass.removeChild.apply(this,e.makeArray(arguments)),i(this));return a},_uiSetExpanded:function(a){this.get("tree");this.get("rendered")&&(j(this),this.fire(a?"expand":"collapse"))},expandAll:function(){this.set("expanded",!0);e.each(this.get("children"),function(a){a.expandAll()})},
collapseAll:function(){this.set("expanded",!1);e.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{delegateChildren:{value:!1},xrender:{value:f},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},expanded:{view:1},collapsed:{getter:function(){return!this.get("expanded")},setter:function(a){this.set("expanded",!a)}},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},
decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"tree-children"}}}},{xclass:"tree-node",priority:10});return n},{requires:["node","component","./node-render"]});KISSY.add("tree/tree-manager-render",function(e){function c(){}c.ATTRS={showRootNode:{}};e.augment(c,{__renderUI:function(){this.get("el").attr("role","tree");this.get("rowEl").addClass(this.get("prefixCls")+"tree-row")},_uiSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()}});return c});
KISSY.add("tree/tree-manager",function(e,c){function d(){}function f(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=e.guid("tree-node"));return b}function b(a){a._allNodes||(a._allNodes={});return a._allNodes}d.ATTRS={delegateChildren:{value:!0},showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};e.augment(d,{isTree:1,_register:function(a){a.__isRegisted||(b(this)[f(a)]=a,a.__isRegisted=1)},_unRegister:function(a){a.__isRegisted&&(delete b(this)[f(a)],a.__isRegisted=0)},handleKeyEventInternal:function(a){var b=
this.get("selectedItem");return a.keyCode==c.KeyCodes.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(a){for(var c,d=b(this),e=this.get("el")[0];a&&a!==e;){if(c=d[a.id])return c;a=a.parentNode}return this},_uiSetSelectedItem:function(a,b){b.prevVal&&b.prevVal.set("selected",!1);a.set("selected",!0)},_uiSetFocused:function(a){a&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event"]});
KISSY.add("tree/tree-render",function(e,c,d){return c.extend([d])},{requires:["./node-render","./tree-manager-render"]});KISSY.add("tree",function(e,c,d,f,b){c.Node=d;c.CheckNode=f;c.CheckTree=b;return c},{requires:["tree/base","tree/node","tree/check-node","tree/check-tree"]});
