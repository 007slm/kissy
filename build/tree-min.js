/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Aug 4 18:16
*/
KISSY.add("tree/basenode",function(f,e,c,g,i){var b=e.all,j=e.KeyCodes,k=c.create(g.ModelControl,[g.DecorateChild],{_keyNav:function(a){var d=true,h,l=this.get("children");switch(a.keyCode){case j.HOME:h=this.get("tree");break;case j.END:h=this.get("tree").getLastVisibleDescendant();break;case j.UP:h=this.getPreviousVisibleNode();break;case j.DOWN:h=this.getNextVisibleNode();break;case j.LEFT:if(this.get("expanded")&&l.length)this.set("expanded",false);else h=this.get("parent");break;case j.RIGHT:if(l.length)this.get("expanded")?
l[0].select():this.set("expanded",true);break;default:d=false}h&&h.select();return d},getLastVisibleDescendant:function(){var a=this.get("children");if(!this.get("expanded")||!a.length)return this;return a[a.length-1].getLastVisibleDescendant()},getNextVisibleNode:function(){var a=this.get("children"),d=this.get("parent");if(this.get("expanded")&&a.length)return a[0];for(a=this.next();d&&!a;){a=d.next();d=d.get("parent")}return a},getPreviousVisibleNode:function(){var a=this.prev();return a=a?a.getLastVisibleDescendant():
this.get("parent")},next:function(){var a=this.get("parent");if(!a)return null;a=a.get("children");var d=f.indexOf(this,a);if(d==a.length-1)return null;return a[d+1]},prev:function(){var a=this.get("parent");if(!a)return null;a=a.get("children");var d=f.indexOf(this,a);if(d===0)return null;return a[d-1]},select:function(){this.get("tree").set("selectedItem",this)},_performInternal:function(a){var d=b(a.target),h=this.get("tree");h.get("el")[0].focus();if(d.hasClass(this.getCls("tree-expand-icon"))||
a.type=="dblclick")this.set("expanded",!this.get("expanded"));else{this.select();h.fire("click",{target:this})}},addChild:function(a){var d=this.get("tree");a.set("tree",d);a.set("depth",this.get("depth")+1);k.superclass.addChild.call(this,a);this._updateRecursive();d._register(a);f.each(a.get("children"),function(h){d._register(h)})},_computeClass:function(a){this.get("view")._computeClass(this.get("children"),this.get("parent"),a)},_updateRecursive:function(){var a=this.get("children").length;this._computeClass("_updateRecursive");
f.each(this.get("children"),function(d,h){d._computeClass("_updateRecursive_children");d.get("view").set("ariaPosInSet",h+1);d.get("view").set("ariaSize",a)})},removeChild:function(a){var d=this.get("tree");d._unregister(a);f.each(a.get("children"),function(h){d._unregister(h)});k.superclass.removeChild.apply(this,f.makeArray(arguments));this._updateRecursive()},_uiSetExpanded:function(a){this._computeClass("expanded-"+a)},expandAll:function(){this.set("expanded",true);f.each(this.get("children"),
function(a){a.set("expanded",true)})},collapseAll:function(){this.set("expanded",false);f.each(this.get("children"),function(a){a.set("expanded",false)})}},{DefaultRender:i,ATTRS:{handleMouseEvents:{value:false},id:{getter:function(){var a=this.get("el").attr("id");a||this.get("el").attr("id",a=f.guid("tree-node"));return a}},content:{view:true},selected:{view:true},expanded:{value:false,view:true},tooltip:{view:true},tree:{},depth:{value:0,view:true},focusable:{value:false},decorateChildCls:{value:"tree-children"}},
HTML_PARSER:{expanded:function(a){a=a.one("."+this.getCls("tree-children"));if(!a)return false;return a.css("display")!="none"}}});return k},{requires:["node","uibase","component","./basenoderender"]});
KISSY.add("tree/basenoderender",function(f,e,c,g){var i=e.all;return c.create(g.Render,{renderUI:function(){this.get("el").addClass(this.getCls("tree-item"))},_computeClass:function(b,j){var k=this.get("expanded"),a="inline-block tree-icon tree-expand-icon ",d=this.getCls("inline-block tree-icon tree-file-icon "),h=this.getCls(["inline-block tree-icon",k?"tree-expanded-folder-icon":"tree-collapsed-folder-icon",""].join(" ")),l=!j||j.get("children")[j.get("children").length-1].get("view")==this;if(b.length){this.set("iconElCls",
h);a+=k?"tree-expand-icon-{t}minus":"tree-expand-icon-{t}plus";this.set("expandIconElCls",this.getCls(f.substitute(a,{t:l?"l":"t"})))}else{this.set("iconElCls",d);this.set("expandIconElCls",this.getCls(f.substitute(a+"tree-expand-icon-{t}",{t:l?"l":"t"})))}this.set("childrenElCls",this.getCls(l?"tree-lchildren":"tree-children"))},_uiSetChildrenElCls:function(b){this.get("childrenEl")&&this.get("childrenEl").attr("class",b)},_uiSetExpandIconElCls:function(b){this.get("expandIconEl").attr("class",b)},
_uiSetIconElCls:function(b){this.get("iconEl").attr("class",b)},createDom:function(){var b=this.get("el"),j=b.children(),k=i("<div class='"+this.getCls("tree-row")+"'/>"),a=f.guid("tree-item"),d=i("<div/>").appendTo(k),h=i("<div />").appendTo(k),l=i("<span id='"+a+"' class='"+this.getCls("tree-item-label")+"'/>").appendTo(k);j.length&&l.append(j);b.attr({role:"treeitem","aria-labelledby":a}).append(k);this.set("labelEl",l);this.set("expandIconEl",d);this.set("iconEl",h);this.set("rowEl",k)},_uiSetExpanded:function(b){var j=
this.get("childrenEl");if(j)if(b)b&&j.show();else j.hide();this.get("el").attr("aria-expanded",b)},_uiSetContent:function(b){this.get("labelEl").html(b)},_uiSetDepth:function(b){this.get("el").attr("aria-level",b)},_uiSetAriaSize:function(b){this.get("el").attr("aria-setsize",b)},_uiSetAriaPosInSet:function(b){this.get("el").attr("aria-posinset",b)},_uiSetSelected:function(b){this.get("rowEl")[b?"addClass":"removeClass"](this.getCls("tree-item-selected"))},_uiSetTooltip:function(b){this.get("el").attr("title",
b)},getContentElement:function(){if(this.get("childrenEl"))return this.get("childrenEl");var b=i("<div "+(!this.get("expanded")?"style='display:none'":"")+" role='group'></div>").appendTo(this.get("el"));this.set("childrenEl",b);return b}},{ATTRS:{childrenElCls:{},expandIconElCls:{},iconElCls:{},ariaSize:{},ariaPosInSet:{},childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},rowEl:{},selected:{},expanded:{},depth:{},labelEl:{},content:{}}})},{requires:["node","uibase","component"]});
KISSY.add("tree/checknode",function(f,e,c,g,i,b){var j=e.all;return c.create(i,{_performInternal:function(k){this.get("tree").get("el")[0].focus();var a=j(k.target),d=this.get("tree");if(a.hasClass(this.getCls("tree-expand-icon"))||k.type=="dblclick")this.set("expanded",!this.get("expanded"));else{k=this.get("checkState");k=k==1?0:1;this.set("checkState",k);d.fire("click",{target:this})}},_uiSetCheckState:function(k){if(k==1||k==0)f.each(this.get("children"),function(n){n.set("checkState",k)});var a=
this.get("parent");if(a){for(var d=0,h=a.get("children"),l=0;l<h.length;l++){var m=h[l].get("checkState");if(m==2){a.set("checkState",2);return}else m==1&&d++}if(d==h.length)a.set("checkState",1);else d==0?a.set("checkState",0):a.set("checkState",2)}}},{ATTRS:{checkState:{view:true,value:0}},DefaultRender:b,PARTIAL_CHECK:2,CHECK:1,EMPTY:0})},{requires:["node","uibase","component","./basenode","./checknoderender"]});
KISSY.add("tree/checknoderender",function(f,e,c,g,i){var b=e.all;return c.create(i,{createDom:function(){var j=this.get("expandIconEl");this.set("checkEl",b("<div class='"+this.getCls("inline-block  tree-icon")+"'/>").insertAfter(j))},_uiSetCheckState:function(j){this.get("checkEl").removeClass(this.getCls("tree-item-checked0 tree-item-checked1 tree-item-checked2")).addClass(this.getCls("tree-item-checked"+j))}},{ATTRS:{checkEl:{},checkState:{}}})},{requires:["node","uibase","component","./basenoderender"]});
KISSY.add("tree/checktree",function(f,e,c,g,i,b){return e.create(g,[b,c.DelegateChildren],{},{DefaultRender:i})},{requires:["uibase","component","./checknode","./checktreerender","./treemgr"]});KISSY.add("tree/checktreerender",function(f,e,c,g,i){return e.create(g,[i])},{requires:["uibase","component","./checknoderender","./treemgrrender"]});
KISSY.add("tree/tree",function(f,e,c,g,i,b){return e.create(g,[b,c.DelegateChildren],{},{DefaultRender:i})},{requires:["uibase","component","./basenode","./treerender","./treemgr"]});
KISSY.add("tree/treemgr",function(f){function e(){this._allNodes={}}e.ATTRS={showRootNode:{view:true},selectedItem:{},tree:{valueFn:function(){return this}},focusable:{value:true}};f.augment(e,{__renderUI:function(){this.get("children").length||this._computeClass("root_renderUI")},_register:function(c){this._allNodes[c.get("id")]=c},_unregister:function(c){delete this._allNodes[c.get("id")]},_handleKeyEventInternal:function(c){var g=this.get("selectedItem");if(c.keyCode==13)return g._performInternal(c);
return g._keyNav(c)},getOwnerControl:function(c){for(var g,i=this.get("el")[0];c&&c!==i;){if(g=this._allNodes[c.id])return g;c=c.parentNode}return this},_uiSetSelectedItem:function(c,g){g.prevVal&&g.prevVal.set("selected",false);c.set("selected",true)},_uiSetFocused:function(c){if(c)this.get("selectedItem")||this.select()}});return e});
KISSY.add("tree/treemgrrender",function(f){function e(){}e.ATTRS={showRootNode:{}};f.augment(e,{__renderUI:function(){this.get("el").addClass(this.getCls("tree-root")).attr("role","tree")[0].hideFocus=true;this.get("rowEl").addClass(this.getCls("tree-root-row"))},_uiSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()},_uiSetFocused:function(c){this.get("el")[c?"addClass":"removeClass"](this.getCls("tree-item-focused"))}});return e});
KISSY.add("tree/treerender",function(f,e,c,g,i){return e.create(g,[i])},{requires:["uibase","component","./basenoderender","./treemgrrender"]});KISSY.add("tree",function(f,e,c,g,i){e.Node=c;e.CheckNode=g;e.CheckTree=i;return e},{requires:["tree/tree","tree/basenode","tree/checknode","tree/checktree"]});
