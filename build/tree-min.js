/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 11 23:40
*/
KISSY.add("tree/base",function(g,d,f,h,a){return f.extend([a],{},{ATTRS:{xrender:{value:h},defaultChildXClass:{value:"tree-node"}}},{xclass:"tree",priority:30})},{requires:["component/base","./node","./tree-render","./tree-manager"]});
KISSY.add("tree/check-node-render",function(g,d,f){var h=d.all;return f.extend({createDom:function(){var a=this.get("expandIconEl");this.setInternal("checkIconEl",h("<div>").insertAfter(a))},_onSetCheckState:function(a){this.get("checkIconEl").removeClass(this.getCssClassWithPrefix("tree-node-checked0 tree-node-checked1 tree-node-checked2")).addClass(this.getCssClassWithPrefix("tree-node-checked")+a)}},{ATTRS:{checkIconEl:{},checkState:{value:0}}})},{requires:["node","./node-render"]});
KISSY.add("tree/check-node",function(g,d,f,h){var a=d.all,d=f.extend({performActionInternal:function(b){var c;c=this.get("expanded");var d=this.get("expandIconEl"),g=this.get("tree"),b=a(b.target);g.get("el")[0].focus();b.equals(d)?this.set("expanded",!c):(c=this.get("checkState"),this.set("checkState",1==c?0:1),this.fire("click"))},_onSetCheckState:function(a){var c=this.get("parent"),d,f,h,i;(1==a||0==a)&&g.each(this.get("children"),function(c){c.set("checkState",a)});if(c){d=0;i=c.get("children");
for(f=0;f<i.length;f++){h=i[f];h=h.get("checkState");if(2==h){c.set("checkState",2);return}1==h&&d++}0===d?c.set("checkState",0):d==i.length?c.set("checkState",1):c.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkState:{view:1},xrender:{value:h},defaultChildXClass:{value:"check-tree-node"}}},{xclass:"check-tree-node",priority:20});g.mix(d,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return d},{requires:["node","./node","./check-node-render"]});
KISSY.add("tree/check-tree-render",function(g,d,f){return d.extend([f])},{requires:["./check-node-render","./tree-manager-render"]});KISSY.add("tree/check-tree",function(g,d,f,h,a){return f.extend([a],{},{ATTRS:{xrender:{value:h},defaultChildXClass:{value:"check-tree-node"}}},{xclass:"check-tree",priority:40})},{requires:["component/base","./check-node","./check-tree-render","./tree-manager"]});
KISSY.add("tree/node-render",function(g,d,f){var h=d.all;return f.Render.extend({refreshCss:function(a,b){var c=this.get("expanded"),d=this.get("iconEl"),f,h=this.get("expandIconEl"),i=this.get("childrenEl");b?(c="tree-file-icon",f="tree-expand-icon-{t}"):c?(c="tree-expanded-folder-icon",f="tree-expand-icon-{t}minus"):(c="tree-collapsed-folder-icon",f="tree-expand-icon-{t}plus");d.attr("class",this.getCssClassWithPrefix(c));h.attr("class",this.getCssClassWithPrefix(g.substitute(f,{t:a?"l":"t"})));
i&&i.attr("class",this.getCssClassWithPrefix(a?"tree-lchildren":"tree-children"))},createDom:function(){var a=this.get("el"),b,c,d,f,j=this.get("contentEl");c=h("<div class='"+this.getCssClassWithPrefix("tree-node-row")+"'/>");(b=j.attr("id"))||j.attr("id",b=g.guid("ks-tree-node"));d=h("<div>").appendTo(c);f=h("<div>").appendTo(c);j.appendTo(c);a.attr({role:"tree-node","aria-labelledby":b}).prepend(c);this.setInternal("rowEl",c);this.setInternal("expandIconEl",d);this.setInternal("iconEl",f)},_onSetExpanded:function(a){var b=
this.get("childrenEl");if(b)b[a?"show":"hide"]();this.get("el").attr("aria-expanded",a)},_onSetSelected:function(a){this.get("rowEl")[a?"addClass":"removeClass"](this.getCssClassWithPrefix("tree-node-selected"));this.get("el").attr("aria-selected",a)},_onSetDepth:function(a){this.get("el").attr("aria-level",a)},_onSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){var a;if(a=this.get("childrenEl"))return a;a=h("<div "+(this.get("expanded")?"":"style='display:none'")+
" role='group'></div>").appendTo(this.get("el"));this.setInternal("childrenEl",a);return a}},{ATTRS:{childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{value:0},contentEl:{valueFn:function(){return h("<span id='"+g.guid("ks-tree-node")+"' class='"+this.getCssClassWithPrefix("tree-node-content")+"'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(a){return a.children("."+this.getCssClassWithPrefix("tree-children"))},contentEl:function(a){return a.children("."+
this.getCssClassWithPrefix("tree-node-content"))},isLeaf:function(a){if(a.hasClass(this.getCssClassWithPrefix("tree-node-leaf")))return!0;if(a.hasClass(this.getCssClassWithPrefix("tree-node-folder")))return!1},expanded:function(a){a=a.one("."+this.get("prefixCls")+"tree-children");return!a?!1:"none"!=a.css("display")}}})},{requires:["node","component/base"]});
KISSY.add("tree/node",function(g,d,f,h){function a(e,b,c,d){e[c](b);void 0!==d&&b.set("depth",d);g.each(b.get("children"),function(b){b.isController&&(d?a(e,b,c,d+1):a(e,b,c))})}function b(e){var a=e.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==e}function c(e){var a=e.get("isLeaf");return!(!1===a||void 0===a&&e.get("children").length)}function m(e){var a=e.get("children");return!e.get("expanded")||!a.length?e:m(a[a.length-1])}function l(e){e.get&&e.get("view")&&e.get("view").refreshCss(b(e),
c(e))}function j(e){var a=e.get("children"),b=e.get("children").length;l(e);g.each(a,function(e,a){if(e.get){l(e);var d=e.get("el");d.attr("aria-posinset",a+1);d.attr("aria-setsize",b)}})}var i=d.all,k=d.KeyCodes,n=f.Container.extend([f.DecorateChild],{_onSetSelected:function(e,a){var b=this.get("tree");if(!a||!a.byPassSetTreeSelectedItem)b.set("selectedItem",e?this:null)},syncUI:function(){l(this)},_keyNav:function(e){var a=!0,b=this.get("tree"),d=this.get("expanded"),c,f=this.get("isLeaf"),g=this.get("children");
switch(e.keyCode){case k.HOME:c=b;break;case k.END:c=m(b);break;case k.UP:c=e=(e=this.prev())?m(e):this.get("parent");break;case k.DOWN:e=this.get("children");if(this.get("expanded")&&e.length)c=e[0];else{e=this.next();for(b=this;!e&&(b=b.get("parent"));)e=b.next();c=e}break;case k.LEFT:d&&(g.length||!1===f)?this.set("expanded",!1):c=this.get("parent");break;case k.RIGHT:if(g.length||!1===f)d?c=g[0]:this.set("expanded",!0);break;default:a=!1}c&&c.select();return a},next:function(){var a=this.get("parent"),
b;if(!a)return null;a=a.get("children");b=g.indexOf(this,a);return b==a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=g.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},performActionInternal:function(a){var a=i(a.target),b=this.get("expanded");this.get("tree").get("el")[0].focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!b):(this.select(),this.fire("click"))},decorateChildrenInternal:function(a,
b){this.addChild(new a({srcNode:b,prefixCls:this.get("prefixCls")}))},addChild:function(){var b;b=n.superclass.addChild.apply(this,g.makeArray(arguments));var c=this.get("tree");c&&(a(c,b,"_register",this.get("depth")+1),j(this));return b},removeChild:function(b){var c=this.get("tree");c&&(a(c,b,"_unRegister"),n.superclass.removeChild.apply(this,g.makeArray(arguments)),j(this));return b},_onSetExpanded:function(a){this.get("tree");this.get("rendered")&&(l(this),this.fire(a?"expand":"collapse"))},
expandAll:function(){this.set("expanded",!0);g.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);g.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{delegateChildren:{value:!1},xrender:{value:h},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},expanded:{view:1},collapsed:{getter:function(){return!this.get("expanded")},setter:function(a){this.set("expanded",!a)}},tooltip:{view:1},
tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"tree-children"}},defaultChildXClass:{value:"tree-node"}}},{xclass:"tree-node",priority:10});return n},{requires:["node","component/base","./node-render"]});
KISSY.add("tree/tree-manager-render",function(g){function d(){}d.ATTRS={showRootNode:{}};g.augment(d,{__renderUI:function(){this.get("el").attr("role","tree");this.get("rowEl").addClass(this.get("prefixCls")+"tree-row")},_onSetShowRootNode:function(d){this.get("rowEl")[d?"show":"hide"]()}});return d});
KISSY.add("tree/tree-manager",function(g,d){function f(){}function h(a){var a=a.get("el"),c=a.attr("id");c||a.attr("id",c=g.guid("tree-node"));return c}function a(a){a._allNodes||(a._allNodes={});return a._allNodes}f.ATTRS={delegateChildren:{value:!0},showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};g.augment(f,{isTree:1,_register:function(b){b.__isRegisted||(a(this)[h(b)]=b,b.__isRegisted=1)},_unRegister:function(b){b.__isRegisted&&(delete a(this)[h(b)],b.__isRegisted=0)},handleKeyEventInternal:function(a){var c=
this.get("selectedItem");return a.keyCode==d.KeyCodes.ENTER?c.performActionInternal(a):c._keyNav(a)},getOwnerControl:function(b){for(var c,d=a(this),f=this.get("el")[0];b&&b!==f;){if(c=d[b.id])return c;b=b.parentNode}return this},_onSetSelectedItem:function(a,c){a&&c.prevVal&&c.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetFocused:function(a){a&&!this.get("selectedItem")&&this.select()}});return f},{requires:["event"]});
KISSY.add("tree/tree-render",function(g,d,f){return d.extend([f])},{requires:["./node-render","./tree-manager-render"]});KISSY.add("tree",function(g,d,f,h,a){d.Node=f;d.CheckNode=h;d.CheckTree=a;return d},{requires:["tree/base","tree/node","tree/check-node","tree/check-tree"]});
