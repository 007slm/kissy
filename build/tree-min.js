/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 9 19:59
*/
KISSY.add("tree/base",function(f,e,d,g,a){return d.extend([a],{},{ATTRS:{xrender:{value:g},defaultChildCfg:{value:{xclass:"tree-node"}}}},{xclass:"tree",priority:30})},{requires:["component/base","./node","./tree-render","./tree-manager"]});
KISSY.add("tree/check-node-render",function(f,e,d){var g=e.all;return d.extend({createDom:function(){var a=this.get("expandIconEl");this.setInternal("checkIconEl",g("<div>").insertAfter(a))},_onSetCheckState:function(a){this.get("checkIconEl").removeClass(this.getCssClassWithPrefix("tree-node-checked0 tree-node-checked1 tree-node-checked2")).addClass(this.getCssClassWithPrefix("tree-node-checked")+a)}},{ATTRS:{checkIconEl:{},checkState:{value:0}}})},{requires:["node","./node-render"]});
KISSY.add("tree/check-node",function(f,e,d,g){var a=e.all,e=d.extend({performActionInternal:function(c){var b;b=this.get("expanded");var e=this.get("expandIconEl"),f=this.get("tree"),c=a(c.target);f.get("el")[0].focus();c.equals(e)?this.set("expanded",!b):(b=this.get("checkState"),this.set("checkState",1==b?0:1),this.fire("click"))},_onSetCheckState:function(a){var b=this.get("parent"),e,d,g,i;(1==a||0==a)&&f.each(this.get("children"),function(b){b.set("checkState",a)});if(b){e=0;i=b.get("children");
for(d=0;d<i.length;d++){g=i[d];g=g.get("checkState");if(2==g){b.set("checkState",2);return}1==g&&e++}0===e?b.set("checkState",0):e==i.length?b.set("checkState",1):b.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkState:{view:1},xrender:{value:g},defaultChildCfg:{value:{xclass:"check-tree-node"}}}},{xclass:"check-tree-node",priority:20});f.mix(e,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return e},{requires:["node","./node","./check-node-render"]});
KISSY.add("tree/check-tree-render",function(f,e,d){return e.extend([d])},{requires:["./check-node-render","./tree-manager-render"]});KISSY.add("tree/check-tree",function(f,e,d,g,a){return d.extend([a],{},{ATTRS:{xrender:{value:g},defaultChildCfg:{value:{xclass:"check-tree-node"}}}},{xclass:"check-tree",priority:40})},{requires:["component/base","./check-node","./check-tree-render","./tree-manager"]});
KISSY.add("tree/node-render",function(f,e,d){var g=e.all;return d.Render.extend({refreshCss:function(a,c){var b=this.get("expanded"),e=this.get("iconEl"),d,g=this.get("expandIconEl"),i=this.get("childrenEl");c?(b="tree-file-icon",d="tree-expand-icon-{t}"):b?(b="tree-expanded-folder-icon",d="tree-expand-icon-{t}minus"):(b="tree-collapsed-folder-icon",d="tree-expand-icon-{t}plus");e.attr("class",this.getCssClassWithPrefix(b));g.attr("class",this.getCssClassWithPrefix(f.substitute(d,{t:a?"l":"t"})));
i&&i.attr("class",this.getCssClassWithPrefix(a?"tree-lchildren":"tree-children"))},createDom:function(){var a=this.get("el"),c,b,e,d,j=this.get("contentEl");b=g("<div class='"+this.getCssClassWithPrefix("tree-node-row")+"'/>");(c=j.attr("id"))||j.attr("id",c=f.guid("ks-tree-node"));e=g("<div>").appendTo(b);d=g("<div>").appendTo(b);j.appendTo(b);a.attr({role:"tree-node","aria-labelledby":c}).prepend(b);this.setInternal("rowEl",b);this.setInternal("expandIconEl",e);this.setInternal("iconEl",d)},_onSetExpanded:function(a){var c=
this.get("childrenEl");if(c)c[a?"show":"hide"]();this.get("el").attr("aria-expanded",a)},_onSetSelected:function(a){this.get("rowEl")[a?"addClass":"removeClass"](this.getCssClassWithPrefix("tree-node-selected"));this.get("el").attr("aria-selected",a)},_onSetDepth:function(a){this.get("el").attr("aria-level",a)},_onSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){var a;if(a=this.get("childrenEl"))return a;a=g("<div "+(this.get("expanded")?"":"style='display:none'")+
" role='group'></div>").appendTo(this.get("el"));this.setInternal("childrenEl",a);return a}},{ATTRS:{childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{},contentEl:{valueFn:function(){return g("<span id='"+f.guid("ks-tree-node")+"' class='"+this.getCssClassWithPrefix("tree-node-content")+"'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(a){return a.children("."+this.getCssClassWithPrefix("tree-children"))},contentEl:function(a){return a.children("."+
this.getCssClassWithPrefix("tree-node-content"))},content:function(a){return a.children("."+this.getCssClassWithPrefix("tree-node-content")).html()},isLeaf:function(a){if(a.hasClass(this.getCssClassWithPrefix("tree-node-leaf")))return!0;if(a.hasClass(this.getCssClassWithPrefix("tree-node-folder")))return!1},expanded:function(a){a=a.one("."+this.get("prefixCls")+"tree-children");return!a?!1:"none"!=a.css("display")}}})},{requires:["node","component/base"]});
KISSY.add("tree/node",function(f,e,d,g){function a(h){i(this,h.component,this.get("depth"))}function c(){this.get("el")[0].setAttribute("aria-setsize",this.get("children").length)}function b(h){var a=h.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==h}function p(h){var a=h.get("isLeaf");return!(!1===a||void 0===a&&h.get("children").length)}function m(h){var a=h.get("children");return!h.get("expanded")||!a.length?h:m(a[a.length-1])}function j(h){h.get&&h.get("view")&&h.get("view").refreshCss(b(h),
p(h))}function i(h,a,c){var b=h.get("tree");b&&(l(b,a,"_register",c+1),o(h))}function l(h,a,c,b){h[c](a);void 0!==b&&a.set("depth",b);f.each(a.get("children"),function(a){"number"==typeof b?l(h,a,c,b+1):l(h,a,c)})}function o(a){j(a);f.each(a.get("children"),function(a,h){j(a);a.get("el")[0].setAttribute("aria-posinset",h+1)})}var q=e.all,k=e.KeyCodes,n=d.Container.extend([d.DecorateChild],{_onSetSelected:function(a,c){var b=this.get("tree");if(!c||!c.byPassSetTreeSelectedItem)b.set("selectedItem",
a?this:null)},bindUI:function(){this.on("afterAddChild",a);this.on("afterAddChild afterRemoveChild",c)},syncUI:function(){j(this);c.call(this)},_keyNav:function(a){var c=!0,b=this.get("tree"),e=this.get("expanded"),d,g=this.get("isLeaf"),f=this.get("children");switch(a.keyCode){case k.HOME:d=b;break;case k.END:d=m(b);break;case k.UP:d=a=(a=this.prev())?m(a):this.get("parent");break;case k.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)d=a[0];else{a=this.next();for(b=this;!a&&(b=b.get("parent"));)a=
b.next();d=a}break;case k.LEFT:e&&(f.length||!1===g)?this.set("expanded",!1):d=this.get("parent");break;case k.RIGHT:if(f.length||!1===g)e?d=f[0]:this.set("expanded",!0);break;default:c=!1}d&&d.select();return c},next:function(){var a=this.get("parent"),c;if(!a)return null;a=a.get("children");c=f.indexOf(this,a);return c==a.length-1?null:a[c+1]},prev:function(){var a=this.get("parent"),c;if(!a)return null;a=a.get("children");c=f.indexOf(this,a);return 0===c?null:a[c-1]},select:function(){this.set("selected",
!0)},performActionInternal:function(a){var a=q(a.target),c=this.get("expanded");this.get("tree").get("el")[0].focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!c):(this.select(),this.fire("click"))},renderChildren:function(){n.superclass.renderChildren.apply(this,arguments);this===this.get("tree")&&i(this,this,-1)},removeChild:function(a){var c=this.get("tree");c&&(l(c,a,"_unRegister"),n.superclass.removeChild.apply(this,f.makeArray(arguments)),o(this));return a},_onSetExpanded:function(a){this.get("tree");
this.get("rendered")&&(j(this),this.fire(a?"expand":"collapse"))},expandAll:function(){this.set("expanded",!0);f.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);f.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{delegateChildren:{value:!1},xrender:{value:g},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},expanded:{view:1},collapsed:{getter:function(){return!this.get("expanded")},
setter:function(a){this.set("expanded",!a)}},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},decorateChildCls:{value:"tree-children"},defaultChildCfg:{value:{xclass:"tree-node"}}}},{xclass:"tree-node",priority:10});return n},{requires:["node","component/base","./node-render"]});
KISSY.add("tree/tree-manager-render",function(f){function e(){}e.ATTRS={showRootNode:{}};f.augment(e,{__renderUI:function(){this.get("el").attr("role","tree");this.get("rowEl").addClass(this.get("prefixCls")+"tree-row")},_onSetShowRootNode:function(d){this.get("rowEl")[d?"show":"hide"]()}});return e});
KISSY.add("tree/tree-manager",function(f,e){function d(){}function g(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=f.guid("tree-node"));return b}function a(a){a._allNodes||(a._allNodes={});return a._allNodes}d.ATTRS={delegateChildren:{value:!0},showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};f.augment(d,{isTree:1,_register:function(c){c.__isRegisted||(a(this)[g(c)]=c,c.__isRegisted=1)},_unRegister:function(c){c.__isRegisted&&(delete a(this)[g(c)],c.__isRegisted=0)},handleKeyEventInternal:function(a){var b=
this.get("selectedItem");return a.keyCode==e.KeyCodes.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(c){for(var b,d=a(this),e=this.get("el")[0];c&&c!==e;){if(b=d[c.id])return b;c=c.parentNode}return this},_onSetSelectedItem:function(a,b){a&&b.prevVal&&b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetFocused:function(a){a&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event"]});
KISSY.add("tree/tree-render",function(f,e,d){return e.extend([d])},{requires:["./node-render","./tree-manager-render"]});KISSY.add("tree",function(f,e,d,g,a){e.Node=d;e.CheckNode=g;e.CheckTree=a;return e},{requires:["tree/base","tree/node","tree/check-node","tree/check-tree"]});
