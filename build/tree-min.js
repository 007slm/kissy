/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Jul 5 23:53
*/
KISSY.add("tree/base",function(e,c,d,f,a){return d.extend([c.DelegateChildren,a],{expandAll:function(){return d.prototype.expandAll.apply(this,arguments)}},{ATTRS:{xrender:{value:f}}},{xclass:"tree",priority:30})},{requires:["component","./basenode","./treeRender","./treemgr"]});
KISSY.add("tree/basenode",function(e,c,d,f){function a(i){var a=i.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==i}function b(i){var a=i.get("isLeaf");return!(!1===a||void 0===a&&i.get("children").length)}function g(a){var h=a.get("children");return!a.get("expanded")||!h.length?a:g(h[h.length-1])}function k(i){i.get&&i.get("view")&&i.get("view").refreshCss(a(i),b(i))}function n(a){var h=a.get("children"),b=a.get("children").length;k(a);e.each(h,function(a,i){if(a.get){k(a);var h=
a.get("el");h.attr("aria-posinset",i+1);h.attr("aria-setsize",b)}})}var m=c.all,j=c.KeyCodes,l=d.Controller.extend([d.DecorateChild],{initializer:function(){function a(i,h,b){i[b](h);var c=h.get("children"),g,e;for(g=0;g<c.length;g++)e=c[g],"_register"==b&&e.set("depth",h.get("depth")+1),i[b](e)}var h=this;h.on("addChild",function(b){var b=b.child,g=h.get("tree");b.set("depth",h.get("depth")+1);g&&a(g,b,"_register");n(h)});h.on("removeChild",function(b){var g=h.get("tree");g&&a(g,b.child,"_unRegister");
n(h)})},bindUI:function(){var a=this.get("parent");a&&(this.addTarget(a),this.publish("click expand collapse",{bubbles:1}))},syncUI:function(){k(this)},_keyNav:function(a){var h=!0,b=this.get("tree"),c=this.get("expanded"),e,d=this.get("isLeaf"),k=this.get("children");switch(a.keyCode){case j.HOME:e=b;break;case j.END:e=g(b);break;case j.UP:e=a=(a=this.prev())?g(a):this.get("parent");break;case j.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)e=a[0];else{a=this.next();for(b=this;!a&&
(b=b.get("parent"));)a=b.next();e=a}break;case j.LEFT:c&&(k.length||!1===d)?this.set("expanded",!1):e=this.get("parent");break;case j.RIGHT:if(k.length||!1===d)c?e=k[0]:this.set("expanded",!0);break;default:h=!1}e&&e.select();return h},next:function(){var a=this.get("parent"),h;if(!a)return null;a=a.get("children");h=e.indexOf(this,a);return h==a.length-1?null:a[h+1]},prev:function(){var a=this.get("parent"),h;if(!a)return null;a=a.get("children");h=e.indexOf(this,a);return 0===h?null:a[h-1]},select:function(){this.get("tree").set("selectedItem",
this)},performActionInternal:function(a){var h=m(a.target),a=a.type,b=this.get("expanded");this.get("tree").get("el")[0].focus();h.equals(this.get("expandIconEl"))?"dblclick"!=a&&this.set("expanded",!b):"dblclick"==a?this.set("expanded",!b):(this.select(),this.fire("click"))},decorateChildrenInternal:function(a,b){this.addChild(new a({srcNode:b,prefixCls:this.get("prefixCls")}))},removeChild:function(a){var b=this.get("tree");b._unRegister(a);e.each(a.get("children"),function(a){b._unRegister(a)});
l.superclass.removeChild.apply(this,e.makeArray(arguments));n(this)},_uiSetExpanded:function(a){this.get("tree");this.get("rendered")&&(k(this),this.fire(a?"expand":"collapse"))},expandAll:function(){this.set("expanded",!0);e.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);e.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:f},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},
expanded:{view:1},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.__isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},decorateChildCls:{value:"ks-tree-children"}}},{xclass:"treeitem",priority:10});return l},{requires:["node","component","./basenodeRender"]});
KISSY.add("tree/basenodeRender",function(e,c,d){var f=c.all;return d.Render.extend({refreshCss:function(a,b){var g=this.get("expanded"),c=this.get("iconEl"),d,f=this.get("expandIconEl"),j=this.get("childrenEl");b?(g="ks-tree-icon ks-tree-file-icon ks-inline-block",d="ks-tree-icon ks-tree-expand-icon ks-inline-block ks-tree-expand-icon-{t}"):g?(g="ks-tree-icon ks-tree-expanded-folder-icon ks-inline-block",d="ks-tree-icon ks-tree-expand-icon ks-inline-block ks-tree-expand-icon-{t}minus"):(g="ks-tree-icon ks-tree-collapsed-folder-icon ks-inline-block",
d="ks-tree-icon ks-tree-expand-icon ks-inline-block ks-tree-expand-icon-{t}plus");c.attr("class",g);f.attr("class",e.substitute(d,{t:a?"l":"t"}));j&&j.attr("class",a?"ks-tree-lchildren":"ks-tree-children")},createDom:function(){var a=this.get("el"),b,g,c,d,m=this.get("contentEl");g=f("<div class='ks-treeitem-row'/>");(b=m.attr("id"))||m.attr("id",b=e.guid("ks-treeitem"));c=f("<div>").appendTo(g);d=f("<div>").appendTo(g);m.appendTo(g);a.attr({role:"treeitem","aria-labelledby":b}).prepend(g);this.__set("rowEl",
g);this.__set("expandIconEl",c);this.__set("iconEl",d)},_uiSetExpanded:function(a){var b=this.get("childrenEl");if(b)b[a?"show":"hide"]();this.get("el").attr("aria-expanded",a)},_uiSetSelected:function(a){this.get("rowEl")[a?"addClass":"removeClass"]("ks-treeitem-selected");this.get("el").attr("aria-selected",a)},_uiSetDepth:function(a){this.get("el").attr("aria-level",a)},_uiSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){var a;if(a=this.get("childrenEl"))return a;
a=f("<div "+(this.get("expanded")?"":"style='display:none'")+" role='group'></div>").appendTo(this.get("el"));this.__set("childrenEl",a);return a}},{ATTRS:{childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{value:0},contentEl:{valueFn:function(){return f("<span id='"+e.guid("ks-treeitem")+"' class='ks-treeitem-content'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(a){return a.children(".ks-tree-children")},contentEl:function(a){return a.children(".ks-treeitem-content")},
isLeaf:function(a){if(a.hasClass(this.getCssClassWithPrefix("treeitem-leaf")))return!0;if(a.hasClass(this.getCssClassWithPrefix("treeitem-folder")))return!1},expanded:function(a){a=a.one(".ks-tree-children");return!a?!1:"none"!=a.css("display")}}})},{requires:["node","component"]});
KISSY.add("tree/checknode",function(e,c,d,f){var a=c.all,b=d.extend({expandAll:function(){return b.superclass.expandAll.apply(this,arguments)},performActionInternal:function(b){var c=this.get("expanded"),e=this.get("expandIconEl"),d=this.get("tree"),f=a(b.target);d.get("el")[0].focus();if("dblclick"==b.type){if(f.equals(e)||f.equals(this.get("checkIconEl")))return;this.set("expanded",!c)}f.equals(e)?this.set("expanded",!c):(b=this.get("checkState"),this.set("checkState",1==b?0:1),this.fire("click"))},
_uiSetCheckState:function(a){var b=this.get("parent"),c,d,f,l;(1==a||0==a)&&e.each(this.get("children"),function(b){b.set("checkState",a)});if(b){c=0;l=b.get("children");for(d=0;d<l.length;d++){f=l[d];f=f.get("checkState");if(2==f){b.set("checkState",2);return}1==f&&c++}c==l.length?b.set("checkState",1):0===c?b.set("checkState",0):b.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkState:{view:1},xrender:{value:f}}},{xclass:"check-treeitem",priority:20});e.mix(b,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});
return b},{requires:["node","./basenode","./checknodeRender"]});
KISSY.add("tree/checknodeRender",function(e,c,d){var f=c.all;return d.extend({createDom:function(){var a=this.get("expandIconEl");this.__set("checkIconEl",f("<div class='ks-tree-icon ks-inline-block'/>").insertAfter(a))},_uiSetCheckState:function(a){this.get("checkIconEl").removeClass("ks-treeitem-checked0 ks-treeitem-checked1 ks-treeitem-checked2").addClass("ks-treeitem-checked"+a)}},{ATTRS:{checkIconEl:{},checkState:{value:0}}})},{requires:["node","./basenodeRender"]});
KISSY.add("tree/checktree",function(e,c,d,f,a){var b=d.extend([c.DelegateChildren,a],{expandAll:function(){return b.superclass.expandAll.apply(this,arguments)},_uiSetFocused:function(){}},{ATTRS:{xrender:{value:f}}},{xclass:"check-tree",priority:40});return b},{requires:["component","./checknode","./checktreeRender","./treemgr"]});KISSY.add("tree/checktreeRender",function(e,c,d){return c.extend([d])},{requires:["./checknodeRender","./treemgrRender"]});
KISSY.add("tree/base",function(e,c,d,f,a){return d.extend([c.DelegateChildren,a],{expandAll:function(){return d.prototype.expandAll.apply(this,arguments)}},{ATTRS:{xrender:{value:f}}},{xclass:"tree",priority:30})},{requires:["component","./basenode","./treeRender","./treemgr"]});
KISSY.add("tree/basenode",function(e,c,d,f){function a(a){var b=a.get("parent"),b=(b=b&&b.get("children"))&&b[b.length-1];return!b||b==a}function b(a){var b=a.get("isLeaf");return!(!1===b||void 0===b&&a.get("children").length)}function g(a){var b=a.get("children");return!a.get("expanded")||!b.length?a:g(b[b.length-1])}function k(i){i.get&&i.get("view")&&i.get("view").refreshCss(a(i),b(i))}function n(a){var b=a.get("children"),c=a.get("children").length;k(a);e.each(b,function(a,b){if(a.get){k(a);var i=
a.get("el");i.attr("aria-posinset",b+1);i.attr("aria-setsize",c)}})}var m=c.all,j=c.KeyCodes,l=d.Controller.extend([d.DecorateChild],{initializer:function(){function a(b,i,c){b[c](i);var d=i.get("children"),e,g;for(e=0;e<d.length;e++)g=d[e],"_register"==c&&g.set("depth",i.get("depth")+1),b[c](g)}var b=this;b.on("addChild",function(c){var c=c.child,e=b.get("tree");c.set("depth",b.get("depth")+1);e&&a(e,c,"_register");n(b)});b.on("removeChild",function(c){var e=b.get("tree");e&&a(e,c.child,"_unRegister");
n(b)})},bindUI:function(){var a=this.get("parent");a&&(this.addTarget(a),this.publish("click expand collapse",{bubbles:1}))},syncUI:function(){k(this)},_keyNav:function(a){var b=!0,c=this.get("tree"),e=this.get("expanded"),d,f=this.get("isLeaf"),k=this.get("children");switch(a.keyCode){case j.HOME:d=c;break;case j.END:d=g(c);break;case j.UP:d=a=(a=this.prev())?g(a):this.get("parent");break;case j.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)d=a[0];else{a=this.next();for(c=this;!a&&
(c=c.get("parent"));)a=c.next();d=a}break;case j.LEFT:e&&(k.length||!1===f)?this.set("expanded",!1):d=this.get("parent");break;case j.RIGHT:if(k.length||!1===f)e?d=k[0]:this.set("expanded",!0);break;default:b=!1}d&&d.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=e.indexOf(this,a);return b==a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=e.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.get("tree").set("selectedItem",
this)},performActionInternal:function(a){var b=m(a.target),a=a.type,c=this.get("expanded");this.get("tree").get("el")[0].focus();b.equals(this.get("expandIconEl"))?"dblclick"!=a&&this.set("expanded",!c):"dblclick"==a?this.set("expanded",!c):(this.select(),this.fire("click"))},decorateChildrenInternal:function(a,b){this.addChild(new a({srcNode:b,prefixCls:this.get("prefixCls")}))},removeChild:function(a){var b=this.get("tree");b._unRegister(a);e.each(a.get("children"),function(a){b._unRegister(a)});
l.superclass.removeChild.apply(this,e.makeArray(arguments));n(this)},_uiSetExpanded:function(a){this.get("tree");this.get("rendered")&&(k(this),this.fire(a?"expand":"collapse"))},expandAll:function(){this.set("expanded",!0);e.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);e.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:f},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},selected:{view:1},
expanded:{view:1},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.__isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},decorateChildCls:{value:"ks-tree-children"}}},{xclass:"treeitem",priority:10});return l},{requires:["node","component","./basenodeRender"]});
KISSY.add("tree/basenodeRender",function(e,c,d){var f=c.all;return d.Render.extend({refreshCss:function(a,b){var c=this.get("expanded"),d=this.get("iconEl"),f,m=this.get("expandIconEl"),j=this.get("childrenEl");b?(c="ks-tree-icon ks-tree-file-icon ks-inline-block",f="ks-tree-icon ks-tree-expand-icon ks-inline-block ks-tree-expand-icon-{t}"):c?(c="ks-tree-icon ks-tree-expanded-folder-icon ks-inline-block",f="ks-tree-icon ks-tree-expand-icon ks-inline-block ks-tree-expand-icon-{t}minus"):(c="ks-tree-icon ks-tree-collapsed-folder-icon ks-inline-block",
f="ks-tree-icon ks-tree-expand-icon ks-inline-block ks-tree-expand-icon-{t}plus");d.attr("class",c);m.attr("class",e.substitute(f,{t:a?"l":"t"}));j&&j.attr("class",a?"ks-tree-lchildren":"ks-tree-children")},createDom:function(){var a=this.get("el"),b,c,d,n,m=this.get("contentEl");c=f("<div class='ks-treeitem-row'/>");(b=m.attr("id"))||m.attr("id",b=e.guid("ks-treeitem"));d=f("<div>").appendTo(c);n=f("<div>").appendTo(c);m.appendTo(c);a.attr({role:"treeitem","aria-labelledby":b}).prepend(c);this.__set("rowEl",
c);this.__set("expandIconEl",d);this.__set("iconEl",n)},_uiSetExpanded:function(a){var b=this.get("childrenEl");if(b)b[a?"show":"hide"]();this.get("el").attr("aria-expanded",a)},_uiSetSelected:function(a){this.get("rowEl")[a?"addClass":"removeClass"]("ks-treeitem-selected");this.get("el").attr("aria-selected",a)},_uiSetDepth:function(a){this.get("el").attr("aria-level",a)},_uiSetTooltip:function(a){this.get("el").attr("title",a)},getContentElement:function(){var a;if(a=this.get("childrenEl"))return a;
a=f("<div "+(this.get("expanded")?"":"style='display:none'")+" role='group'></div>").appendTo(this.get("el"));this.__set("childrenEl",a);return a}},{ATTRS:{childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{value:0},contentEl:{valueFn:function(){return f("<span id='"+e.guid("ks-treeitem")+"' class='ks-treeitem-content'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(a){return a.children(".ks-tree-children")},contentEl:function(a){return a.children(".ks-treeitem-content")},
isLeaf:function(a){if(a.hasClass(this.getCssClassWithPrefix("treeitem-leaf")))return!0;if(a.hasClass(this.getCssClassWithPrefix("treeitem-folder")))return!1},expanded:function(a){a=a.one(".ks-tree-children");return!a?!1:"none"!=a.css("display")}}})},{requires:["node","component"]});
KISSY.add("tree/checknode",function(e,c,d,f){var a=c.all,b=d.extend({expandAll:function(){return b.superclass.expandAll.apply(this,arguments)},performActionInternal:function(b){var c=this.get("expanded"),d=this.get("expandIconEl"),e=this.get("tree"),f=a(b.target);e.get("el")[0].focus();if("dblclick"==b.type){if(f.equals(d)||f.equals(this.get("checkIconEl")))return;this.set("expanded",!c)}f.equals(d)?this.set("expanded",!c):(b=this.get("checkState"),this.set("checkState",1==b?0:1),this.fire("click"))},
_uiSetCheckState:function(a){var b=this.get("parent"),c,d,f,l;(1==a||0==a)&&e.each(this.get("children"),function(b){b.set("checkState",a)});if(b){c=0;l=b.get("children");for(d=0;d<l.length;d++){f=l[d];f=f.get("checkState");if(2==f){b.set("checkState",2);return}1==f&&c++}0===c?b.set("checkState",0):c==l.length?b.set("checkState",1):b.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkState:{view:1},xrender:{value:f}}},{xclass:"check-treeitem",priority:20});e.mix(b,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});
return b},{requires:["node","./basenode","./checknodeRender"]});
KISSY.add("tree/checknodeRender",function(e,c,d){var f=c.all;return d.extend({createDom:function(){var a=this.get("expandIconEl");this.__set("checkIconEl",f("<div class='ks-tree-icon ks-inline-block'/>").insertAfter(a))},_uiSetCheckState:function(a){this.get("checkIconEl").removeClass("ks-treeitem-checked0 ks-treeitem-checked1 ks-treeitem-checked2").addClass("ks-treeitem-checked"+a)}},{ATTRS:{checkIconEl:{},checkState:{value:0}}})},{requires:["node","./basenodeRender"]});
KISSY.add("tree/checktree",function(e,c,d,f,a){var b=d.extend([c.DelegateChildren,a],{expandAll:function(){return b.superclass.expandAll.apply(this,arguments)},_uiSetFocused:function(){}},{ATTRS:{xrender:{value:f}}},{xclass:"check-tree",priority:40});return b},{requires:["component","./checknode","./checktreeRender","./treemgr"]});KISSY.add("tree/checktreeRender",function(e,c,d){return c.extend([d])},{requires:["./checknodeRender","./treemgrRender"]});
KISSY.add("tree",function(e,c,d,f,a){c.Node=d;c.CheckNode=f;c.CheckTree=a;return c},{requires:["tree/base","tree/basenode","tree/checknode","tree/checktree"]});KISSY.add("tree/treeRender",function(e,c,d){return c.extend([d])},{requires:["./basenodeRender","./treemgrRender"]});
KISSY.add("tree/treemgr",function(e,c){function d(){}function f(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=e.guid("tree-node"));return b}d.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};e.augment(d,{__isTree:1,__getAllNodes:function(){this._allNodes||(this._allNodes={});return this._allNodes},_register:function(a){this.__getAllNodes()[f(a)]=a},_unRegister:function(a){delete this.__getAllNodes()[f(a)]},handleKeyEventInternal:function(a){var b=this.get("selectedItem");
return a.keyCode==c.KeyCodes.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(a){for(var b,c=this.__getAllNodes(),d=this.get("el")[0];a&&a!==d;){if(b=c[a.id])return b;a=a.parentNode}return this},_uiSetSelectedItem:function(a,b){b.prevVal&&b.prevVal.set("selected",!1);a.set("selected",!0)},_uiSetFocused:function(a){a&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event"]});
KISSY.add("tree/treemgrRender",function(e){function c(){}c.ATTRS={showRootNode:{}};e.augment(c,{__renderUI:function(){this.get("el").attr("role","tree")[0].hideFocus=!0;this.get("rowEl").addClass("ks-tree-row")},_uiSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()}});return c});KISSY.add("tree",function(e,c,d,f,a){c.Node=d;c.CheckNode=f;c.CheckTree=a;return c},{requires:["tree/base","tree/basenode","tree/checknode","tree/checktree"]});
KISSY.add("tree/treeRender",function(e,c,d){return c.extend([d])},{requires:["./basenodeRender","./treemgrRender"]});
KISSY.add("tree/treemgr",function(e,c){function d(){}function f(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=e.guid("tree-node"));return b}d.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};e.augment(d,{__isTree:1,__getAllNodes:function(){this._allNodes||(this._allNodes={});return this._allNodes},_register:function(a){this.__getAllNodes()[f(a)]=a},_unRegister:function(a){delete this.__getAllNodes()[f(a)]},handleKeyEventInternal:function(a){var b=this.get("selectedItem");
return a.keyCode==c.KeyCodes.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(a){for(var b,c=this.__getAllNodes(),d=this.get("el")[0];a&&a!==d;){if(b=c[a.id])return b;a=a.parentNode}return this},_uiSetSelectedItem:function(a,b){b.prevVal&&b.prevVal.set("selected",!1);a.set("selected",!0)},_uiSetFocused:function(a){a&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event"]});
KISSY.add("tree/treemgrRender",function(e){function c(){}c.ATTRS={showRootNode:{}};e.augment(c,{__renderUI:function(){this.get("el").attr("role","tree")[0].hideFocus=!0;this.get("rowEl").addClass("ks-tree-row")},_uiSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()}});return c});
