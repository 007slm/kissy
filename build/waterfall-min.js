/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Aug 31 21:17
*/
KISSY.add("waterfall/async",function(e,l,o,m,q){function j(){j.superclass.constructor.apply(this,arguments)}function r(){if(!this.__loading){var a=this.get("container").offset().top,b=this.get("diff"),c=this.get("curColHeights");if(c.length)a+=Math.min.apply(Math,c);b+f(window).scrollTop()+f(window).height()>a&&p.call(this)}}function n(){this.__scrollTimer&&this.__scrollTimer.cancel();this.__scrollTimer=e.later(r,s,false,this)}function p(){var a=this;this.get("container");a.__loading=true;var b=a.get("remote");
if(e.isFunction(b))b=b();o(e.mix({success:function(c){c.end&&f(window).detach("scroll",n,a);a.__loading=false;c=c.data;var g=m(a.get("itemTpl")),d=[];e.each(c,function(h){h=g.render(h);d.push(f(h))});a.addItems(d)}},b))}var f=l.all,s=50;j.ATTRS={remote:{},diff:{getter:function(a){return a||0}},itemTpl:{}};e.extend(j,q,{_init:function(){j.superclass._init.apply(this,arguments);f(window).on("scroll",n,this);p.call(this)},destroy:function(){j.superclass.destroy.apply(this,arguments);f(window).detach("scroll",
n,this)}});return j},{requires:["node","ajax","template","./base"]});
KISSY.add("waterfall/base",function(e,l,o){function m(){m.superclass.constructor.apply(this,arguments);this._init()}function q(a,b,c,g){var d=e.makeArray(a),h={},i;if(d.length>0)i=setTimeout(function(){var k=+new Date;do{var t=d.shift();b.call(c,t)}while(d.length>0&&+new Date-k<50);if(d.length>0)i=setTimeout(arguments.callee,25);else g&&g.call(c,a)},25);else g&&g.call(c,a);h.stop=function(){if(i){clearTimeout(i);d=[]}};return h}function j(){var a=this;a.get("container");if(a._resizer){a._resizer.stop();
a._resizer=0}n.call(a);a._resizer=a.adjust(function(){a._resizer=0})}function r(){var a=this._containerRegion;if(this.get("container").width()!==a.width){this.__resizeTimer&&this.__resizeTimer.cancel();this.__resizeTimer=e.later(j,s,false,this)}}function n(){var a=this.get("container"),b=a.width(),c=this.get("curColHeights");c.length=Math.max(parseInt(b/this.get("colWidth")),this.get("minColCount"));this._containerRegion=e.mix({width:b},a.offset());e.each(c,function(g,d){c[d]=0})}function p(a){a=
f(a);for(var b=this.get("curColHeights"),c=this.get("container"),g=b.length,d=0,h=this._containerRegion,i=Number.MAX_VALUE,k=0;k<g;k++)if(b[k]<i){i=b[k];d=k}g||(i=0);a.css({position:"absolute",left:d*Math.max(h.width/g,this.get("colWidth"))+h.left,top:i+h.top});c.contains(a)||c.append(a);b[d]+=a.height();return a}var f=l.all,s=50;m.ATTRS={container:{setter:function(a){return f(a)}},curColHeights:{value:[]},minColCount:{value:1},effect:{value:{effect:"fadeIn",duration:1}},colWidth:{}};e.extend(m,o,
{_init:function(){n.call(this);f(window).on("resize",r,this)},adjust:function(a){var b=this.get("container").all(".ks-waterfall");return q(b,p,this,a)},addItems:function(a,b){if(!this._resizer)return q(a,this.addItem,this,b)},addItem:function(a){this.get("curColHeights");this.get("container");a=p.call(this,a);var b=this.get("effect");b.effect&&a[b.effect](b.duration,undefined,b.easing)},destroy:function(){f(window).detach("resize",r,this)}});return m},{requires:["node","base"]});
KISSY.add("waterfall",function(e,l,o){l.Async=o;return l},{requires:["waterfall/base","waterfall/async"]});
