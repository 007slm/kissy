/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Feb 9 18:01
*/
KISSY.add("ajax/FormSerializer",function(g,k){var l=/^(?:select|textarea)/i,m=/\r?\n/g,d=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(f){var a=[],c={};g.each(k.query(f),function(b){b=b.elements?g.makeArray(b.elements):[b];a.push.apply(a,b)});a=g.filter(a,function(b){return b.name&&!b.disabled&&(b.checked||l.test(b.nodeName)||d.test(b.type))});g.each(a,function(b){var e=k.val(b);e=g.map(g.makeArray(e),function(j){return j.replace(m,
"\r\n")});b=c[b.name]=c[b.name]||[];b.push.apply(b,e)});return g.param(c,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/IframeTransport",function(g,k,l,m){function d(a){this.xhrObject=a}var f=document;m.setupConfig({converters:{iframe:m.getConfig().converters.text,text:{iframe:function(a){return a}}}});g.augment(d,{send:function(){var a=this.xhrObject,c=a.config,b,e=k.get(c.form);this.attrs={target:k.attr(e,"target")||"",action:k.attr(e,"action")||""};this.form=e;var j=g.guid("ajax-iframe");a.iframe=k.create("<iframe  id='"+j+"' name='"+j+"' style='position:absolute;left:-9999px;top:-9999px;'/>");a.iframeId=
j;k.prepend(a.iframe,f.body||f.documentElement);k.attr(e,{target:a.iframeId,action:c.url});if(c.data){b=c.data;c=c.serializeArray;b=g.unparam(b);j=[];for(var h in b)for(var n=g.isArray(b[h]),p=g.makeArray(b[h]),q=0;q<p.length;q++){var o=f.createElement("input");o.type="hidden";o.name=h+(n&&c?"[]":"");o.value=p[q];k.append(o,e);j.push(o)}b=j}this.fields=b;l.on(a.iframe,"load error",this._callback,this);e.submit()},_callback:function(a){var c=this.xhrObject;a=a.type;var b=c.iframe;if(b){k.attr(this.form,
this.attrs);if(a=="load"){a=b.contentWindow.document;c.responseXML=a;c.responseText=k.text(a.body);c._xhrReady(200,"success")}else a=="error"&&c._xhrReady(500,"error");k.remove(this.fields);l.detach(b);setTimeout(function(){k.remove(b)},30);c.iframe=null}},abort:function(){this._callback({},1)}});m.setupTransport("iframe",d);return m},{requires:["dom","event","./base"]});
KISSY.add("ajax/ScriptTransport",function(g,k){function l(d){if(!d.config.crossDomain&&!d.config.forceScript)return new (k.getTransport("*"))(d);this.xhrObj=d;return 0}var m=document;k.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){g.globalEval(d);return d}}}});g.augment(l,{send:function(){var d=this,f,a=this.xhrObj.config,c=m.head||m.getElementsByTagName("head")[0]||
m.documentElement;d.head=c;f=m.createElement("script");d.script=f;f.async="async";if(a.scriptCharset)f.charset=a.scriptCharset;f.src=a.url;f.onerror=f.onload=f.onreadystatechange=function(b){b=b||window.event;d._callback((b.type||"error").toLowerCase())};c.insertBefore(f,c.firstChild)},_callback:function(d,f){var a=this.script,c=this.xhrObj,b=this.head;if(a)if(f||!a.readyState||/loaded|complete/.test(a.readyState)||d=="error"){a.onerror=a.onload=a.onreadystatechange=null;b&&a.parentNode&&b.removeChild(a);
this.head=this.script=undefined;if(!f&&d!="error")c._xhrReady(200,"success");else d=="error"&&c._xhrReady(500,"scripterror")}},abort:function(){this._callback(0,1)}});k.setupTransport("script",l);return k},{requires:["./base","./XhrTransport"]});
KISSY.add("ajax/SubDomainTransport",function(g,k,l,m){function d(e){var j=e.config;this.xhrObj=e;e=j.url.match(a);this.hostname=e[2];this.protocol=e[1];j.crossDomain=false}function f(){var e=b[this.hostname];e.ready=1;l.detach(e.iframe,"load",f,this);this.send()}var a=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,c=document,b={};g.augment(d,k.proto,{send:function(){var e=this.xhrObj.config,j=this.hostname,h=b[j],n="/sub_domain_proxy.html";if(e.xdr&&e.xdr.subDomain&&e.xdr.subDomain.proxy)n=e.xdr.subDomain.proxy;
if(h&&h.ready)(this.nativeXhr=k.nativeXhr(0,h.iframe.contentWindow))&&this.sendInternal();else{if(h)e=h.iframe;else{h=b[j]={};e=h.iframe=document.createElement("iframe");m.css(e,{position:"absolute",left:"-9999px",top:"-9999px"});m.prepend(e,c.body||c.documentElement);e.src=this.protocol+"//"+j+n}l.on(e,"load",f,this)}}});return d},{requires:["./XhrTransportBase","event","dom"]});
KISSY.add("ajax/XdrFlashTransport",function(g,k,l){function m(j,h,n){if(!e){e=true;j='<object id="'+a+'" type="application/x-shockwave-flash" data="'+j+'" width="0" height="0"><param name="movie" value="'+j+'" /><param name="FlashVars" value="yid='+h+"&uid="+n+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>';h=b.createElement("div");l.prepend(h,b.body||b.documentElement);h.innerHTML=j}}function d(j){this.xhrObj=j}var f={},a="io_swf",c,b=document,e=false;
g.augment(d,{send:function(){var j=this,h=j.xhrObj.config;m((h.xdr||{}).src||g.Config.base+"ajax/io.swf",1,1);if(c){j._uid=g.guid();f[j._uid]=j;c.send(h.url,{id:j._uid,uid:j._uid,method:h.type,data:h.hasContent&&h.data||{}})}else setTimeout(function(){j.send()},200)},abort:function(){c.abort(this._uid)},_xdrResponse:function(j,h){var n,p=this.xhrObj;p.responseText=decodeURI(h.c.responseText);switch(j){case "success":n={status:200,statusText:"success"};delete f[h.id];break;case "abort":delete f[h.id];
break;case "timeout":case "transport error":case "failure":delete f[h.id];n={status:500,statusText:j}}n&&p._xhrReady(n.status,n.statusText)}});k.applyTo=function(j,h,n){j=h.split(".").slice(1);var p=k;g.each(j,function(q){p=p[q]});p.apply(null,n)};k.xdrReady=function(){c=b.getElementById(a)};k.xdrResponse=function(j,h,n){var p=f[h.uid];p&&p._xdrResponse(j,h,n)};return d},{requires:["./base","dom"]});
KISSY.add("ajax/XhrObject",function(g,k){function l(a){var c=a.responseText,b=a.responseXML,e=a.config,j=e.converters,h=a.converters||{},n,p,q=e.contents,o=e.dataType;if(c||b){for(e=a.mimeType||a.getResponseHeader("Content-Type");o[0]=="*";)o.shift();if(!o.length)for(n in q)if(q[n].test(e)){o[0]!=n&&o.unshift(n);break}o[0]=o[0]||"text";if(o[0]=="text"&&c!==k)p=c;else if(o[0]=="xml"&&b!==k)p=b;else g.each(["text","xml"],function(t){var u=o[0];if(h[t]&&h[t][u]||j[t]&&j[t][u]){o.unshift(t);p=t=="text"?
c:b;return false}})}q=o[0];for(e=1;e<o.length;e++){n=o[e];var w=h[q]&&h[q][n]||j[q]&&j[q][n];if(!w)throw"no covert for "+q+" => "+n;p=w(p);q=n}a.responseData=p}function m(a){d.call(this);g.mix(this,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new g.Defer(this)})}var d=g.Promise,f=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;g.extend(m,d,{setRequestHeader:function(a,
c){this.requestHeaders[a]=c;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(a){var c;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};c=f.exec(this.responseHeadersString);)this.responseHeaders[c[1]]=c[2];c=this.responseHeaders[a]}return c===k?null:c},overrideMimeType:function(a){if(!this.state)this.mimeType=a;return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._xhrReady(0,
a);return this},_xhrReady:function(a,c){if(this.state!=2){this.state=2;this.readyState=4;var b;if(a>=200&&a<300||a==304)if(a==304){c="notmodified";b=true}else try{l(this);c="success";b=true}catch(e){c="parsererror : "+e}else if(a<0)a=0;this.status=a;this.statusText=c;this._defer[b?"resolve":"reject"]([this.responseData,this.statusText,this]);this.transport=k}}});return m});
KISSY.add("ajax/XhrTransport",function(g,k,l,m,d,f){var a=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,c=window.XDomainRequest,b=l.nativeXhr();if(b){var e=function(h){h=h.split(".");return h.length<2?h.join("."):h.reverse().slice(0,2).reverse().join(".")},j=function(h){var n=h.config,p=n.xdr||{};if(n.crossDomain){n=n.url.match(a);if(e(location.hostname)==e(n[2]))return new m(h);if(!("withCredentials"in b)&&(String(p.use)==="flash"||!c))return new d(h)}this.xhrObj=h;return f};g.augment(j,l.proto,
{send:function(){this.nativeXhr=l.nativeXhr(this.xhrObj.config.crossDomain);this.sendInternal()}});k.setupTransport("*",j)}return k},{requires:["./base","./XhrTransportBase","./SubDomainTransport","./XdrFlashTransport"]});
KISSY.add("ajax/XhrTransportBase",function(g,k){function l(a,c){try{return new (c||m).XMLHttpRequest}catch(b){}}var m=window,d=m.XDomainRequest,f={proto:{}};f.nativeXhr=m.ActiveXObject?function(a,c){if(a&&d)return new d;var b;if(!(b=!k.isLocal&&l(a,c)))a:{try{b=new (c||m).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}b=void 0}return b}:l;g.mix(f.proto,{sendInternal:function(){var a=this,c=a.xhrObj,b=c.config,e=a.nativeXhr,j,h;b.username?e.open(b.type,b.url,b.async,b.username,b.password):e.open(b.type,
b.url,b.async);if(j=b.xhrFields)for(h in j)if(j.hasOwnProperty(h))e[h]=j[h];c.mimeType&&e.overrideMimeType&&e.overrideMimeType(c.mimeType);if(!b.crossDomain&&!c.requestHeaders["X-Requested-With"])c.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!b.crossDomain)for(h in c.requestHeaders)e.setRequestHeader(h,c.requestHeaders[h])}catch(n){}e.send(b.hasContent&&b.data||null);if(!b.async||e.readyState==4)a._callback();else if(d&&e instanceof d){e.onload=function(){e.readyState=4;e.status=200;
a._callback()};e.onerror=function(){e.readyState=4;e.status=500;a._callback()}}else e.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,c){try{var b=this.nativeXhr,e=this.xhrObj,j=e.config;if(c||b.readyState==4){if(d&&b instanceof d){b.onerror=g.noop;b.onload=g.noop}else b.onreadystatechange=g.noop;if(c)b.readyState!==4&&b.abort();else{var h=b.status;if(!(d&&b instanceof d))e.responseHeadersString=b.getAllResponseHeaders();var n=b.responseXML;
if(n&&n.documentElement)e.responseXML=n;e.responseText=b.responseText;try{var p=b.statusText}catch(q){p=""}if(!h&&k.isLocal&&!j.crossDomain)h=e.responseText?200:404;else if(h===1223)h=204;e._xhrReady(h,p)}}}catch(o){b.onreadystatechange=g.noop;c||e._xhrReady(-1,o)}}});return f},{requires:["./base"]});
KISSY.add("ajax",function(g,k,l,m){g.mix(l,{XhrObject:m,serialize:k.serialize,get:function(d,f,a,c,b){if(g.isFunction(f)){c=a;a=f;f=undefined}return l({type:b||"get",url:d,data:f,success:a,dataType:c})},post:function(d,f,a,c){if(g.isFunction(f)){c=a;a=f;f=undefined}return l.get(d,f,a,c,"post")},jsonp:function(d,f,a){if(g.isFunction(f)){a=f;f=undefined}return l.get(d,f,a,"jsonp")},getScript:g.getScript,getJSON:function(d,f,a){if(g.isFunction(f)){a=f;f=undefined}return l.get(d,f,a,"json")},upload:function(d,
f,a,c,b){if(g.isFunction(a)){b=c;c=a;a=undefined}return l({url:d,type:"post",dataType:b,form:f,data:a,success:c})}});g.mix(g,{Ajax:l,IO:l,ajax:l,io:l,jsonp:l.jsonp});return l},{requires:["ajax/FormSerializer","ajax/base","ajax/XhrObject","ajax/XhrTransport","ajax/ScriptTransport","ajax/jsonp","ajax/form","ajax/IframeTransport"]});
KISSY.add("ajax/base",function(g,k,l,m,d){function f(i){var s=i.context;delete i.context;i=g.mix(g.clone(u),i||{},d,d,true);i.context=s;if(!g.isBoolean(i.crossDomain)){s=e.exec(i.url.toLowerCase());i.crossDomain=!!(s&&(s[1]!=o[1]||s[2]!=o[2]||(s[3]||(s[1]==="http:"?h:n))!=(o[3]||(o[1]==="http:"?h:n))))}if(i.processData&&i.data&&!g.isString(i.data))i.data=g.param(i.data,d,d,i.serializeArray);i.url=i.url.replace(/^\/\//,o[1]+"//");i.type=i.type.toUpperCase();i.hasContent=!p.test(i.type);if(!i.hasContent){if(i.data){i.url+=
(/\?/.test(i.url)?"&":"?")+i.data;delete i.data}if(i.cache===false)i.url+=(/\?/.test(i.url)?"&":"?")+"_ksTS="+(g.now()+"_"+g.guid())}i.dataType=g.trim(i.dataType||"*").split(b);i.context=i.context||i;return i}function a(i,s){c.fire(i,{ajaxConfig:s.config,xhr:s})}function c(i){function s(y){return function(C){if(r.timeoutTimer){clearTimeout(r.timeoutTimer);r.timeoutTimer=0}var z=i[y];z&&z.apply(i.context,C);a(y,r)}}if(!i.url)return d;i=f(i);var r=new m(i);a("start",r);var A=new (t[i.dataType[0]]||
t["*"])(r);r.transport=A;i.contentType&&r.setRequestHeader("Content-Type",i.contentType);var v=i.dataType[0],x=i.accepts;r.setRequestHeader("Accept",v&&x[v]?x[v]+(v==="*"?"":", */*; q=0.01"):x["*"]);for(var B in i.headers)r.setRequestHeader(B,i.headers[B]);r.then(s("success"),s("error"));r.fin(s("complete"));r.readyState=1;a("send",r);if(i.async&&i.timeout>0)r.timeoutTimer=setTimeout(function(){r.abort("timeout")},i.timeout*1E3);try{r.state=1;A.send()}catch(D){r.status<2&&r._xhrReady(-1,D)}return r}
var b=/\s+/,e=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,j=function(i){return i},h=80,n=443,p=/^(?:GET|HEAD)$/,q,o;try{q=location.href}catch(w){q=document.createElement("a");q.href="";q=q.href}o=e.exec(q);q=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(o[1]);var t={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",
"*":"*/*"},converters:{text:{json:k.parse,html:j,text:j,xml:g.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;g.mix(c,l.Target);g.mix(c,{isLocal:q,setupConfig:function(i){g.mix(u,i,d,d,true)},setupTransport:function(i,s){t[i]=s},getTransport:function(i){return t[i]},getConfig:function(){return u}});return c},{requires:["json","event","./XhrObject"]});
KISSY.add("ajax/form",function(g,k,l,m){k.on("start",function(d){d=d.xhr.config;if(d.form){var f=l.get(d.form);if((f.encoding||f.enctype).toLowerCase()!="multipart/form-data"){if(f=m.serialize(f))if(d.hasContent){d.data=d.data||"";if(d.data)d.data+="&";d.data+=f}else d.url+=(/\?/.test(d.url)?"&":"?")+f}else{f=d.dataType[0];if(f=="*")f="text";d.dataType.length=2;d.dataType[0]="iframe";d.dataType[1]=f}}});return k},{requires:["./base","dom","./FormSerializer"]});
KISSY.add("ajax/jsonp",function(g,k){k.setupConfig({jsonp:"callback",jsonpCallback:function(){return g.guid("jsonp")}});k.on("start",function(l){l=l.xhr;var m=l.config;if(m.dataType[0]=="jsonp"){var d,f=m.jsonpCallback,a=g.isFunction(f)?f():f,c=window[a];m.url+=(/\?/.test(m.url)?"&":"?")+m.jsonp+"="+a;window[a]=function(b){if(arguments.length>1)b=g.makeArray(arguments);d=[b]};l.fin(function(){window[a]=c;if(c===undefined)try{delete window[a]}catch(b){}else d&&c(d[0])});l.converters=l.converters||
{};l.converters.script=l.converters.script||{};l.converters.script.json=function(){return d[0]};m.dataType.length=2;m.dataType[0]="script";m.dataType[1]="json"}});return k},{requires:["./base"]});
