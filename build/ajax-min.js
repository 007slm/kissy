/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 17 17:25
*/
KISSY.add("ajax",function(b,g,j){function k(c,f,h,a,e){b.isFunction(f)&&(a=h,h=f,f=i);return j({type:e||"get",url:c,data:f,success:h,dataType:a})}var i=void 0;b.mix(j,{serialize:g.serialize,get:k,post:function(c,f,h,a){b.isFunction(f)&&(a=h,h=f,f=i);return k(c,f,h,a,"post")},jsonp:function(c,f,h){b.isFunction(f)&&(h=f,f=i);return k(c,f,h,"jsonp")},getScript:b.getScript,getJSON:function(c,f,h){b.isFunction(f)&&(h=f,f=i);return k(c,f,h,"json")},upload:function(c,f,h,a,e){b.isFunction(h)&&(e=a,a=h,h=
i);return j({url:c,type:"post",dataType:e,form:f,data:h,success:a})}});b.mix(b,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(b,g,j,k){function i(d){var c=d.context,h=d.ifModified;delete d.context;d=b.mix(b.clone(p),d,{deep:!0});d.context=c||d;var e,f=d.type,o=d.dataType,i;i=d.query=new b.Uri.Query;c=d.uri=n.resolve(d.url);"crossDomain"in d||(d.crossDomain=!d.uri.hasSameDomainAs(n));if(d.processData&&(e=d.data))b.isObject(e)?i.add(e):i.reset(e);f=d.type=f.toUpperCase();d.hasContent=!l.test(f);o=d.dataType=b.trim(o||"*").split(a);!("cache"in d)&&b.inArray(o[0],["script","jsonp"])&&(d.cache=
!1);var g;d.hasContent||(i.count()&&c.query.add(i),h&&(g=c.clone()),!1===d.cache&&c.query.set("_ksTS",b.now()+"_"+b.guid()));h&&(d.ifModifiedKeyUri=g||c.clone());return d}function c(d,a){f.fire(d,{ajaxConfig:a.config,xhr:a,io:a})}function f(a){function l(d){return function(l){if(g=e.timeoutTimer)clearTimeout(g),e.timeoutTimer=0;var h=a[d];h&&h.apply(v,l);c(d,e)}}var e=this;if(!a.url)return k;if(!(e instanceof f))return new f(a);d.call(e);a=i(a);b.mix(e,{responseData:null,config:a||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new b.Defer(this)});var h;c("start",e);h=new (q[a.dataType[0]]||q["*"])(e);e.transport=h;a.contentType&&e.setRequestHeader("Content-Type",a.contentType);var o=a.dataType[0],g,m,j=a.timeout,v=a.context,r=a.headers,n=a.accepts;e.setRequestHeader("Accept",o&&n[o]?n[o]+("*"===o?"":", */*; q=0.01"):n["*"]);for(m in r)e.setRequestHeader(m,
r[m]);if(a.beforeSend&&!1===a.beforeSend.call(v,e,a))return k;e.then(l("success"),l("error"));e.fin(l("complete"));e.readyState=1;c("send",e);a.async&&0<j&&(e.timeoutTimer=setTimeout(function(){e.abort("timeout")},1E3*j));try{e.state=1,h.send()}catch(s){2>e.state&&e._ioReady(-1,s)}return k}var h=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,e=function(d){return d},d=b.Promise,l=/^(?:GET|HEAD)$/,o,v=b.Uri,m=b.Env.host,s=m.document,m=m.location,n;if(m){try{o=m.href}catch(r){o=s.createElement("a"),
o.href="",o=o.href}n=new v(o)}var h=n&&h.test(n.getScheme()),q={},p={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:g.parse,html:e,text:e,xml:b.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};p.converters.html=p.converters.text;b.mix(f,j.Target);b.mix(f,{isLocal:h,setupConfig:function(d){b.mix(p,
d,{deep:!0})},setupTransport:function(d,a){q[d]=a},getTransport:function(d){return q[d]},getConfig:function(){return p}});return f},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(b,g){function j(c){return c.replace(i,"\r\n")}var k=/^(?:select|textarea)/i,i=/\r?\n/g,c,f=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(h,a){return b.param(c.getFormData(h),void 0,void 0,a||!1)},getFormData:function(c){var a=[],e={};b.each(g.query(c),function(d){d=d.elements?b.makeArray(d.elements):[d];a.push.apply(a,d)});a=b.filter(a,function(d){return d.name&&!d.disabled&&
(d.checked||k.test(d.nodeName)||f.test(d.type))});b.each(a,function(d){var a=g.val(d),c,a=b.isArray(a)?b.map(a,j):j(a);(c=e[d.name])?(c&&!b.isArray(c)&&(c=e[d.name]=[c]),c.push.apply(c,b.makeArray(a))):e[d.name]=a});return e}}},{requires:["dom"]});
KISSY.add("ajax/form",function(b,g,j,k){g.on("start",function(b){var c,f,b=b.io.config;if(c=b.form)c=j.get(c),f=c.encoding||c.enctype,"multipart/form-data"!=f.toLowerCase()?(c=k.getFormData(c),b.hasContent?b.query.add(c):(b.uri.query.add(c),b.ifModifiedKeyUri&&b.ifModifiedKeyUri.query.add(c))):(c=b.dataType,b=c[0],"*"==b&&(b="text"),c.length=2,c[0]="iframe",c[1]=b)});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(b,g,j,k){function i(a){var e=b.guid("ajax-iframe"),d=g.getEmptyIframeSrc(),a=a.iframe=g.create("<iframe "+(d?' src="'+d+'" ':"")+' id="'+e+'" name="'+e+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(a,h.body||h.documentElement);return a}function c(a,e,d){var c=[],f,i,m,j,k=a.keys();b.each(k,function(k){var n=a.get(k);f=b.isArray(n);i=b.makeArray(n);for(m=0;m<i.length;m++)j=h.createElement("input"),j.type="hidden",j.name=k+(f&&d?"[]":
""),j.value=i[m],g.append(j,e),c.push(j)});return c}function f(a){this.io=a}var h=b.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});b.augment(f,{send:function(){var a=this,e=a.io,d=e.config,l,b,h=d.query,f=g.get(d.form);a.attrs={target:g.attr(f,"target")||"",action:g.attr(f,"action")||"",method:g.attr(f,"method")};a.form=f;b=i(e);g.attr(f,{target:b.id,action:d.uri.toString(d.serializeArray),
method:"post"});h.count()&&(l=c(h,f,d.serializeArray));a.fields=l;setTimeout(function(){j.on(b,"load error",a._callback,a);f.submit()},10)},_callback:function(a){var e=this.io,a=a.type,d=e.iframe;if(d)if(g.attr(this.form,this.attrs),g.remove(this.fields),j.detach(d),setTimeout(function(){g.remove(d)},30),e.iframe=null,"load"==a){if((a=d.contentWindow.document)&&a.body)e.responseText=b.trim(g.text(a.body)),b.startsWith(e.responseText,"<?xml")&&(e.responseText=void 0);e.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;e._ioReady(200,"success")}else"error"==a&&e._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",f);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(b,g){var j=b.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return b.guid("jsonp")}});g.on("start",function(g){var i=g.io,c=i.config,g=c.dataType;if("jsonp"==g[0]){var f,h=c.jsonpCallback,a=b.isFunction(h)?h():h,e=j[a];c.uri.query.set(c.jsonp,a);j[a]=function(d){1<arguments.length&&(d=b.makeArray(arguments));f=[d]};i.fin(function(){j[a]=e;if(void 0===e)try{delete j[a]}catch(d){}else f&&e(f[0])});i=i.converters=i.converters||{};i.script=i.script||
{};i.script.json=function(){return f[0]};g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("ajax/methods",function(b,g,j){function k(c){var f=c.responseText,h=c.responseXML,a=c.config,e=a.converters,d=c.converters||{},l,g,i=a.contents,m=a.dataType;if(f||h){for(a=c.mimeType||c.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(l in i)if(i[l].test(a)){m[0]!=l&&m.unshift(l);break}m[0]=m[0]||"text";if("text"==m[0]&&f!==j)g=f;else if("xml"==m[0]&&h!==j)g=h;else{var k={text:f,xml:h};b.each(["text","xml"],function(a){var c=m[0];if((d[a]&&d[a][c]||e[a]&&e[a][c])&&
k[a])return m.unshift(a),g="text"==a?f:h,!1})}}i=m[0];for(a=1;a<m.length;a++){l=m[a];var n=d[i]&&d[i][l]||e[i]&&e[i][l];if(!n)throw"no covert for "+i+" => "+l;g=n(g);i=l}c.responseData=g}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;b.extend(g,b.Promise,{setRequestHeader:function(c,b){this.requestHeaders[c]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var b,h;if(2===this.state){if(!(h=this.responseHeaders))for(h=this.responseHeaders=
{};b=i.exec(this.responseHeadersString);)h[b[1]]=b[2];b=h[c]}return b===j?null:b},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;if(c=this.transport)return c.nativeXhr},_ioReady:function(c,b){if(2!=this.state){this.state=2;this.readyState=4;var h;if(200<=c&&300>c||304==c)if(304==c)b="not modified",h=!0;else try{k(this),b="success",h=!0}catch(a){b=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=b;this._defer[h?"resolve":"reject"]([this.responseData,b,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(b,g,j,k){function i(b){if(!b.config.crossDomain)return new (g.getTransport("*"))(b);this.io=b;return 0}var c=b.Env.host,f=c.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(c){b.globalEval(c);return c}}}});b.augment(i,{send:function(){var b=this,a,e=b.io.config,d=f.head||f.getElementsByTagName("head")[0]||
f.documentElement;b.head=d;a=f.createElement("script");b.script=a;a.async="async";e.scriptCharset&&(a.charset=e.scriptCharset);a.src=e.uri.toString(e.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(d){d=d||c.event;b._callback((d.type||"error").toLowerCase())};d.insertBefore(a,d.firstChild)},_callback:function(b,a){var c=this.script,d=this.io,l=this.head;if(c&&(a||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==b))c.onerror=c.onload=c.onreadystatechange=null,l&&c.parentNode&&
l.removeChild(c),this.head=this.script=k,!a&&"error"!=b?d._ioReady(200,"success"):"error"==b&&d._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",i);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(b,g,j,k){function i(a){var b=a.config;this.io=a;b.crossDomain=!1}function c(){var a=this.io.config.uri.getHostname(),a=h[a];a.ready=1;j.detach(a.iframe,"load",c,this);this.send()}var f=b.Env.host.document,h={};b.augment(i,g.proto,{send:function(){var a=this.io.config,e=a.uri,d=e.getHostname(),l;l=h[d];var i="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(i=a.xdr.subDomain.proxy);l&&l.ready?(this.nativeXhr=g.nativeXhr(0,l.iframe.contentWindow))&&
this.sendInternal():(l?a=l.iframe:(l=h[d]={},a=l.iframe=f.createElement("iframe"),k.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(a,f.body||f.documentElement),l=new b.Uri,l.setScheme(e.getScheme()),l.setHostname(d),l.setPath(i),a.src=l.toString()),j.on(a,"load",c,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(b,g,j){function k(d,b,c){e||(e=!0,d='<object id="'+f+'" type="application/x-shockwave-flash" data="'+d+'" width="0" height="0"><param name="movie" value="'+d+'" /><param name="FlashVars" value="yid='+b+"&uid="+c+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',b=a.createElement("div"),j.prepend(b,a.body||a.documentElement),b.innerHTML=d)}function i(d){this.io=d}var c={},f="io_swf",h,a=b.Env.host.document,e=
!1;b.augment(i,{send:function(){var d=this,a=d.io.config;k((a.xdr||{}).src||b.Config.base+"ajax/io.swf",1,1);h?(d._uid=b.guid(),c[d._uid]=d,h.send(a.uri.toString(a.serializeArray),{id:d._uid,uid:d._uid,method:a.type,data:a.hasContent&&a.query.toString(a.serializeArray)||{}})):setTimeout(function(){d.send()},200)},abort:function(){h.abort(this._uid)},_xdrResponse:function(a,b){var e,f=b.id,h=this.io;h.responseText=decodeURI(b.c.responseText);switch(a){case "success":e={status:200,statusText:"success"};
delete c[f];break;case "abort":delete c[f];break;case "timeout":case "transport error":case "failure":delete c[f],e={status:500,statusText:a}}e&&h._ioReady(e.status,e.statusText)}});g.applyTo=function(a,c,e){var a=c.split(".").slice(1),f=g;b.each(a,function(a){f=f[a]});f.apply(null,e)};g.xdrReady=function(){h=a.getElementById(f)};g.xdrResponse=function(a,b){var e=c[b.uid];e&&e._xdrResponse(a,b)};return i},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(b,g){function j(a,b){try{return new (b||k).XMLHttpRequest}catch(d){}}var k=b.Env.host,i=k.XDomainRequest,c={proto:{}},f={},h={};g.__lastModifiedCached=f;g.__eTagCached=h;c.nativeXhr=k.ActiveXObject?function(a,b){var d;if(a&&i)d=new i;else if(!(d=!g.isLocal&&j(a,b)))a:{try{d=new (b||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}d=void 0}return d}:j;b.mix(c.proto,{sendInternal:function(){var a=this,b=a.io,d=b.config,c=a.nativeXhr,g=d.type,j=d.async,
k,s=d.crossDomain,n=b.mimeType,b=b.requestHeaders||{},r=d.serializeArray,q=d.uri.toString(r),p,t,u;if(p=d.ifModifiedKeyUri&&d.ifModifiedKeyUri.toString()){if(t=f[p])b["If-Modified-Since"]=t;if(t=h[p])b["If-None-Match"]=t}(k=d.username)?c.open(g,q,j,k,d.password):c.open(g,q,j);if(g=d.xhrFields)for(u in g)c[u]=g[u];n&&c.overrideMimeType&&c.overrideMimeType(n);!s&&!b["X-Requested-With"]&&(b["X-Requested-With"]="XMLHttpRequest");try{if(!s)for(u in b)c.setRequestHeader(u,b[u])}catch(w){}c.send(d.hasContent&&
d.query.toString(r)||null);!j||4==c.readyState?a._callback():i&&c instanceof i?(c.onload=function(){c.readyState=4;c.status=200;a._callback()},c.onerror=function(){c.readyState=4;c.status=500;a._callback()}):c.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,c){try{var d=this.nativeXhr,g=this.io,j=g.config;if(c||4==d.readyState)if(i&&d instanceof i?(d.onerror=b.noop,d.onload=b.noop):d.onreadystatechange=b.noop,c)4!==d.readyState&&d.abort();else{var k=
j.ifModifiedKeyUri&&j.ifModifiedKeyUri.toString(),m=d.status;i&&d instanceof i||(g.responseHeadersString=d.getAllResponseHeaders());if(k){var s=d.getResponseHeader("Last-Modified"),n=d.getResponseHeader("ETag");s&&(f[k]=s);n&&(h[n]=n)}var r=d.responseXML;r&&r.documentElement&&(g.responseXML=r);g.responseText=d.responseText;try{var q=d.statusText}catch(p){q=""}!m&&g.isLocal&&!j.crossDomain?m=g.responseText?200:404:1223===m&&(m=204);g._ioReady(m,q)}}catch(t){d.onreadystatechange=b.noop,c||g._ioReady(-1,
t)}}});return c},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(b,g,j,k,i,c){var f=b.Env.host.XDomainRequest,h=j.nativeXhr();if(h){var a=function(a){var a=a.split("."),b=a.length,c=3<b?3:2;return b<c?a.join("."):a.reverse().slice(0,c).reverse().join(".")},e=function(b){var e=b.config,g=e.crossDomain,v=e.xdr||{};if(g){if(a(location.hostname)==a(e.uri.getHostname()))return new k(b);if(!("withCredentials"in h)&&("flash"===""+v.use||!f))return new i(b)}this.io=b;this.nativeXhr=j.nativeXhr(g);return c};b.augment(e,j.proto,{send:function(){this.sendInternal()}});
g.setupTransport("*",e)}return g},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
