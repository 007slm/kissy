/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Sep 26 22:16
*/
KISSY.add("ajax",function(b,f,i){function k(e,g,d,a,m){b.isFunction(g)&&(a=d,d=g,g=h);return i({type:m||"get",url:e,data:g,success:d,dataType:a})}var h=void 0;b.mix(i,{serialize:f.serialize,get:k,post:function(e,g,d,a){b.isFunction(g)&&(a=d,d=g,g=h);return k(e,g,d,a,"post")},jsonp:function(e,g,d){b.isFunction(g)&&(d=g,g=h);return k(e,g,d,"jsonp")},getScript:b.getScript,getJSON:function(e,g,d){b.isFunction(g)&&(d=g,g=h);return k(e,g,d,"json")},upload:function(e,g,d,a,m){b.isFunction(d)&&(m=a,a=d,d=
h);return i({url:e,type:"post",dataType:m,form:g,data:d,success:a})}});b.mix(b,{Ajax:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(b,f,i,k){function h(c){var e=c.context,m=c.ifModified;delete c.context;c=b.mix(b.clone(q),c,{deep:!0});c.context=e||c;var d,g=c.type,o=c.dataType,h;h=c.query=new b.Uri.Query;e=c.uri=n.resolve(c.url);"crossDomain"in c||(c.crossDomain=!c.uri.hasSameDomainAs(n));if(c.processData&&(d=c.data))b.isObject(d)?h.add(d):h.reset(d);g=c.type=g.toUpperCase();c.hasContent=!l.test(g);o=c.dataType=b.trim(o||"*").split(a);!("cache"in c)&&b.inArray(o[0],["script","jsonp"])&&(c.cache=
!1);var f;c.hasContent||(h.count()&&e.query.add(h),m&&(f=e.clone()),!1===c.cache&&e.query.set("_ksTS",b.now()+"_"+b.guid()));m&&(c.ifModifiedKeyUri=f||e.clone());return c}function e(c,a){g.fire(c,{ajaxConfig:a.config,xhr:a,io:a})}function g(a){function l(c){return function(l){if(f=d.timeoutTimer)clearTimeout(f),d.timeoutTimer=0;var m=a[c];m&&m.apply(u,l);e(c,d)}}var d=this;if(!a.url)return k;if(!(d instanceof g))return new g(a);c.call(d);a=h(a);b.mix(d,{responseData:null,config:a||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new b.Defer(this)});var m;e("start",d);m=new (r[a.dataType[0]]||r["*"])(d);d.transport=m;a.contentType&&d.setRequestHeader("Content-Type",a.contentType);var o=a.dataType[0],f,j,i=a.timeout,u=a.context,p=a.headers,n=a.accepts;d.setRequestHeader("Accept",o&&n[o]?n[o]+("*"===o?"":", */*; q=0.01"):n["*"]);for(j in p)p.hasOwnProperty(j)&&
d.setRequestHeader(j,p[j]);if(a.beforeSend&&!1===a.beforeSend.call(u,d,a))return k;d.then(l("success"),l("error"));d.fin(l("complete"));d.readyState=1;e("send",d);a.async&&0<i&&(d.timeoutTimer=setTimeout(function(){d.abort("timeout")},1E3*i));try{d.state=1,m.send()}catch(v){2>d.state&&d._ioReady(-1,v)}return k}var d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,m=function(c){return c},c=b.Promise,l=/^(?:GET|HEAD)$/,o,u=b.Uri,j=b.Env.host,v=j.document,j=j.location,n;if(j){try{o=
j.href}catch(p){o=v.createElement("a"),o.href="",o=o.href}n=new u(o)}var d=n&&d.test(n.getScheme()),r={},q={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parse,html:m,text:m,xml:b.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};q.converters.html=q.converters.text;b.mix(g,
i.Target);b.mix(g,{isLocal:d,setupConfig:function(c){b.mix(q,c,{deep:!0})},setupTransport:function(c,a){r[c]=a},getTransport:function(c){return r[c]},getConfig:function(){return q}});return g},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(b,f){function i(d){return d.replace(h,"\r\n")}var k=/^(?:select|textarea)/i,h=/\r?\n/g,e,g=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return e={serialize:function(d,a){return b.param(e.getFormData(d),void 0,void 0,a||!1)},getFormData:function(d){var a=[],e={};b.each(f.query(d),function(c){c=c.elements?b.makeArray(c.elements):[c];a.push.apply(a,c)});a=b.filter(a,function(c){return c.name&&!c.disabled&&
(c.checked||k.test(c.nodeName)||g.test(c.type))});b.each(a,function(c){var a=f.val(c),d,a=b.isArray(a)?b.map(a,i):i(a);(d=e[c.name])?(d&&!b.isArray(d)&&(d=e[c.name]=[d]),d.push.apply(d,b.makeArray(a))):e[c.name]=a});return e}}},{requires:["dom"]});
KISSY.add("ajax/form",function(b,f,i,k){f.on("start",function(b){var e,g,b=b.io.config;if(e=b.form)e=i.get(e),g=e.encoding||e.enctype,"multipart/form-data"!=g.toLowerCase()?(e=k.getFormData(e),b.hasContent?b.query.add(e):(b.uri.query.add(e),b.ifModifiedKeyUri&&b.ifModifiedKeyUri.query.add(e))):(e=b.dataType,b=e[0],"*"==b&&(b="text"),e.length=2,e[0]="iframe",e[1]=b)});return f},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(b,f,i,k){function h(a){var e=b.guid("ajax-iframe"),c=f.getEmptyIframeSrc(),a=a.iframe=f.create("<iframe "+(c?' src="'+c+'" ':"")+' id="'+e+'" name="'+e+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(a,d.body||d.documentElement);return a}function e(a,e,c){var l=[],g,h,j,i,k=a.keys();b.each(k,function(k){var n=a.get(k);g=b.isArray(n);h=b.makeArray(n);for(j=0;j<h.length;j++)i=d.createElement("input"),i.type="hidden",i.name=k+(g&&c?"[]":
""),i.value=h[j],f.append(i,e),l.push(i)});return l}function g(a){this.io=a}var d=b.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});b.augment(g,{send:function(){var a=this,d=a.io,c=d.config,l,b,g=c.query,j=f.get(c.form);a.attrs={target:f.attr(j,"target")||"",action:f.attr(j,"action")||"",method:f.attr(j,"method")};a.form=j;b=h(d);f.attr(j,{target:b.id,action:c.uri.toString(c.serializeArray),
method:"post"});g.count()&&(l=e(g,j,c.serializeArray));a.fields=l;setTimeout(function(){i.on(b,"load error",a._callback,a);j.submit()},10)},_callback:function(a){var d=this.io,a=a.type,c=d.iframe;if(c)if(f.attr(this.form,this.attrs),f.remove(this.fields),i.detach(c),setTimeout(function(){f.remove(c)},30),d.iframe=null,"load"==a){if((a=c.contentWindow.document)&&a.body)d.responseText=b.trim(f.text(a.body)),b.startsWith(d.responseText,"<?xml")&&(d.responseText=void 0);d.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;d._ioReady(200,"success")}else"error"==a&&d._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",g);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(b,f){var i=b.Env.host;f.setupConfig({jsonp:"callback",jsonpCallback:function(){return b.guid("jsonp")}});f.on("start",function(f){var h=f.io,e=h.config,f=e.dataType;if("jsonp"==f[0]){var g,d=e.jsonpCallback,a=b.isFunction(d)?d():d,m=i[a];e.uri.query.set(e.jsonp,a);i[a]=function(c){1<arguments.length&&(c=b.makeArray(arguments));g=[c]};h.fin(function(){i[a]=m;if(void 0===m)try{delete i[a]}catch(c){}else g&&m(g[0])});h=h.converters=h.converters||{};h.script=h.script||
{};h.script.json=function(){return g[0]};f.length=2;f[0]="script";f[1]="json"}});return f},{requires:["./base"]});
KISSY.add("ajax/methods",function(b,f,i){function k(e){var g=e.responseText,d=e.responseXML,a=e.config,m=a.converters,c=e.converters||{},l,f,h=a.contents,j=a.dataType;if(g||d){for(a=e.mimeType||e.getResponseHeader("Content-Type");"*"==j[0];)j.shift();if(!j.length)for(l in h)if(h.hasOwnProperty(l)&&h[l].test(a)){j[0]!=l&&j.unshift(l);break}j[0]=j[0]||"text";if("text"==j[0]&&g!==i)f=g;else if("xml"==j[0]&&d!==i)f=d;else{var k={text:g,xml:d};b.each(["text","xml"],function(a){var e=j[0];if((c[a]&&c[a][e]||
m[a]&&m[a][e])&&k[a])return j.unshift(a),f="text"==a?g:d,!1})}}h=j[0];for(a=1;a<j.length;a++){l=j[a];var n=c[h]&&c[h][l]||m[h]&&m[h][l];if(!n)throw"no covert for "+h+" => "+l;f=n(f);h=l}e.responseData=f}var h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;b.extend(f,b.Promise,{setRequestHeader:function(e,b){this.requestHeaders[e]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(e){var b,d;if(2===this.state){if(!(d=this.responseHeaders))for(d=
this.responseHeaders={};b=h.exec(this.responseHeadersString);)d[b[1]]=b[2];b=d[e]}return b===i?null:b},overrideMimeType:function(b){this.state||(this.mimeType=b);return this},abort:function(b){b=b||"abort";this.transport&&this.transport.abort(b);this._ioReady(0,b);return this},getNativeXhr:function(){var b;if(b=this.transport)return b.nativeXhr},_ioReady:function(b,g){if(2!=this.state){this.state=2;this.readyState=4;var d;if(200<=b&&300>b||304==b)if(304==b)g="not modified",d=!0;else try{k(this),g=
"success",d=!0}catch(a){g="parser error"}else 0>b&&(b=0);this.status=b;this.statusText=g;this._defer[d?"resolve":"reject"]([this.responseData,g,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(b,f,i,k){function h(d){if(!d.config.crossDomain)return new (f.getTransport("*"))(d);this.io=d;return 0}var e=b.Env.host,g=e.document;f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){b.globalEval(d);return d}}}});b.augment(h,{send:function(){var d=this,a,b=d.io.config,c=g.head||g.getElementsByTagName("head")[0]||
g.documentElement;d.head=c;a=g.createElement("script");d.script=a;a.async="async";b.scriptCharset&&(a.charset=b.scriptCharset);a.src=b.uri.toString(b.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(c){c=c||e.event;d._callback((c.type||"error").toLowerCase())};c.insertBefore(a,c.firstChild)},_callback:function(d,a){var b=this.script,c=this.io,l=this.head;if(b&&(a||!b.readyState||/loaded|complete/.test(b.readyState)||"error"==d))b.onerror=b.onload=b.onreadystatechange=null,l&&b.parentNode&&
l.removeChild(b),this.head=this.script=k,!a&&"error"!=d?c._ioReady(200,"success"):"error"==d&&c._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});f.setupTransport("script",h);return f},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(b,f,i,k){function h(a){var b=a.config;this.io=a;b.crossDomain=!1}function e(){var a=this.io.config.uri.getHostname(),a=d[a];a.ready=1;i.detach(a.iframe,"load",e,this);this.send()}var g=b.Env.host.document,d={};b.augment(h,f.proto,{send:function(){var a=this.io.config,h=a.uri,c=h.getHostname(),l;l=d[c];var o="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(o=a.xdr.subDomain.proxy);l&&l.ready?(this.nativeXhr=f.nativeXhr(0,l.iframe.contentWindow))&&
this.sendInternal():(l?a=l.iframe:(l=d[c]={},a=l.iframe=g.createElement("iframe"),k.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(a,g.body||g.documentElement),l=new b.Uri,l.setScheme(h.getScheme()),l.setHostname(c),l.setPath(o),a.src=l.toString()),i.on(a,"load",e,this))}});return h},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(b,f,i){function k(c,b,d){m||(m=!0,c='<object id="'+g+'" type="application/x-shockwave-flash" data="'+c+'" width="0" height="0"><param name="movie" value="'+c+'" /><param name="FlashVars" value="yid='+b+"&uid="+d+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',b=a.createElement("div"),i.prepend(b,a.body||a.documentElement),b.innerHTML=c)}function h(c){this.io=c}var e={},g="io_swf",d,a=b.Env.host.document,m=
!1;b.augment(h,{send:function(){var c=this,a=c.io.config;k((a.xdr||{}).src||b.Config.base+"ajax/io.swf",1,1);d?(c._uid=b.guid(),e[c._uid]=c,d.send(a.uri.toString(a.serializeArray),{id:c._uid,uid:c._uid,method:a.type,data:a.hasContent&&a.query.toString(a.serializeArray)||{}})):setTimeout(function(){c.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(a,b){var d,g=b.id,f=this.io;f.responseText=decodeURI(b.c.responseText);switch(a){case "success":d={status:200,statusText:"success"};
delete e[g];break;case "abort":delete e[g];break;case "timeout":case "transport error":case "failure":delete e[g],d={status:500,statusText:a}}d&&f._ioReady(d.status,d.statusText)}});f.applyTo=function(a,d,e){var a=d.split(".").slice(1),g=f;b.each(a,function(a){g=g[a]});g.apply(null,e)};f.xdrReady=function(){d=a.getElementById(g)};f.xdrResponse=function(a,b){var d=e[b.uid];d&&d._xdrResponse(a,b)};return h},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(b,f){function i(a,b){try{return new (b||k).XMLHttpRequest}catch(c){}}var k=b.Env.host,h=k.XDomainRequest,e={proto:{}},g={},d={};f.__lastModifiedCached=g;f.__eTagCached=d;e.nativeXhr=k.ActiveXObject?function(a,b){var c;if(a&&h)c=new h;else if(!(c=!f.isLocal&&i(a,b)))a:{try{c=new (b||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}c=void 0}return c}:i;b.mix(e.proto,{sendInternal:function(){var a=this,b=a.io,c=b.config,e=a.nativeXhr,f=c.type,i=c.async,
j,k=c.crossDomain,n=b.mimeType,b=b.requestHeaders||{},p=c.serializeArray,r=c.uri.toString(p),q,t,s;if(q=c.ifModifiedKeyUri&&c.ifModifiedKeyUri.toString()){if(t=g[q])b["If-Modified-Since"]=t;if(t=d[q])b["If-None-Match"]=t}(j=c.username)?e.open(f,r,i,j,c.password):e.open(f,r,i);if(f=c.xhrFields)for(s in f)f.hasOwnProperty(s)&&(e[s]=f[s]);n&&e.overrideMimeType&&e.overrideMimeType(n);!k&&!b["X-Requested-With"]&&(b["X-Requested-With"]="XMLHttpRequest");try{if(!k)for(s in b)b.hasOwnProperty(s)&&e.setRequestHeader(s,
b[s])}catch(w){}e.send(c.hasContent&&c.query.toString(p)||null);!i||4==e.readyState?a._callback():h&&e instanceof h?(e.onload=function(){e.readyState=4;e.status=200;a._callback()},e.onerror=function(){e.readyState=4;e.status=500;a._callback()}):e.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,e){try{var c=this.nativeXhr,f=this.io,i=f.config;if(e||4==c.readyState)if(h&&c instanceof h?(c.onerror=b.noop,c.onload=b.noop):c.onreadystatechange=b.noop,
e)4!==c.readyState&&c.abort();else{var k=i.ifModifiedKeyUri&&i.ifModifiedKeyUri.toString(),j=c.status;h&&c instanceof h||(f.responseHeadersString=c.getAllResponseHeaders());if(k){var v=c.getResponseHeader("Last-Modified"),n=c.getResponseHeader("ETag");v&&(g[k]=v);n&&(d[n]=n)}var p=c.responseXML;p&&p.documentElement&&(f.responseXML=p);f.responseText=c.responseText;try{var r=c.statusText}catch(q){r=""}!j&&f.isLocal&&!i.crossDomain?j=f.responseText?200:404:1223===j&&(j=204);f._ioReady(j,r)}}catch(t){c.onreadystatechange=
b.noop,e||f._ioReady(-1,t)}}});return e},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(b,f,i,k,h,e){var g=b.Env.host.XDomainRequest,d=i.nativeXhr();if(d){var a=function(a){var a=a.split("."),b=a.length,d=3<b?3:2;return b<d?a.join("."):a.reverse().slice(0,d).reverse().join(".")},m=function(b){var f=b.config,m=f.crossDomain,u=f.xdr||{};if(m){if(a(location.hostname)==a(f.uri.getHostname()))return new k(b);if(!("withCredentials"in d)&&("flash"===""+u.use||!g))return new h(b)}this.io=b;this.nativeXhr=i.nativeXhr(m);return e};b.augment(m,i.proto,{send:function(){this.sendInternal()}});
f.setupTransport("*",m)}return f},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
