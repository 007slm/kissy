/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("ajax/base",function(i,k,m,g){function h(b){b=b||{};i.mix(b,r,false);if(b.crossDomain==null){var j=f.exec(b.url.toLowerCase());b.crossDomain=!!(j&&(j[1]!=o[1]||j[2]!=o[2]||(j[3]||(j[1]==="http:"?80:443))!=(o[3]||(o[1]==="http:"?80:443))))}if(b.data&&!i.isString(b.data))b.data=i.param(b.data);b.type=b.type.toUpperCase();b.hasContent=!l.test(b.type);if(!b.hasContent){if(b.data)b.url+=(/\?/.test(b.url)?"&":"?")+b.data;if(b.cache===false)b.url+=(/\?/.test(b.url)?"&":"?")+"_ksTS="+(i.now()+"_"+
i.guid())}b.dataType=i.trim(b.dataType||"*").split(c);b.context=b.context||b;return b}function a(b,j){e.fire(b,{ajaxConfig:j.config,xhr:j})}function d(b){var j=this.config;b=b.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);j[b]&&j[b].call(j.context,this.responseData,this.statusText,this);a(b,this)}function e(b){if(b.url){b=h(b);var j=new g(b);a("start",j);var v=new (s[b.dataType[0]]||s["*"])(j);j.transport=v;b.contentType&&j.setRequestHeader("Content-Type",b.contentType);var t=b.dataType[0],
u=b.accepts;j.setRequestHeader("Accept",t&&u[t]?u[t]+(t!=="*"?", */*; q=0.01":""):u["*"]);for(var w in b.headers)j.setRequestHeader(w,b.headers[w]);j.on("complete success error",d);j.readyState=1;a("send",j);if(b.async&&b.timeout>0)j.timeoutTimer=setTimeout(function(){j.abort("timeout")},b.timeout);try{j.state=1;v.send()}catch(x){j.status<2?j.callback(-1,x):i.error(x)}return j}}var c=/\s+/,f=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,q=function(b){return b},l=/^(?:GET|HEAD)$/,n,o;try{n=location.href}catch(p){n=
document.createElement("a");n.href="";n=n.href}o=f.exec(n);n=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(o[1]);var s={},r={type:"GET",contentType:"application/x-www-form-urlencoded",async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:k.parse,html:q,text:q,xml:i.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};r.converters.html=r.converters.text;e.__transports=s;
e.__defaultConfig=r;i.mix(e,m.Target);e.isLocal=n;return e},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/xhrobject",function(i,k){function m(a){var d=a.responseText,e=a.responseXML,c=a.config,f=c.converters,q=a.converters||{},l,n,o=c.contents,p=c.dataType;if(d||e){for(c=a.mimeType||a.getResponseHeader("Content-Type");p[0]=="*";)p.shift();if(!p.length)for(l in o)if(o[l].test(c)){p[0]!=l&&p.unshift(l);break}p[0]=p[0]||"text";if(p[0]=="text"&&d!=undefined)n=d;else if(p[0]=="xml"&&e!=undefined)n=e;else i.each(["text","xml"],function(r){var b=p[0];if(q[r]&&q[r][b]||f[r]&&f[r][b]){p.unshift(r);
n=r=="text"?d:e;return false}})}o=p[0];for(c=1;c<p.length;c++){l=p[c];var s=q[o]&&q[o][l]||f[o]&&f[o][l];if(!s)throw"no covert for "+o+" => "+l;n=s(n);o=l}a.responseData=n}function g(a){i.mix(this,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;i.augment(g,k.Target,{setRequestHeader:function(a,d){this.requestHeaders[a]=
d;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(a){var d;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};d=h.exec(this.responseHeadersString);)this.responseHeaders[d[1]]=d[2];d=this.responseHeaders[a]}return d===undefined?null:d},overrideMimeType:function(a){if(!this.state)this.mimeType=a;return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this.callback(0,a);return this},
callback:function(a,d){if(this.state!=2){this.state=2;this.readyState=4;var e;if(a>=200&&a<300||a==304)if(a==304){d="notmodified";e=true}else try{m(this);d="success";e=true}catch(c){d="parsererror : "+c}else if(a<0)a=0;this.status=a;this.statusText=d;e?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return g},{requires:["event"]});
KISSY.add("ajax/xhr",function(i,k){function m(){try{return new window.XMLHttpRequest}catch(d){}}var g=k.__transports;k.xhr=window.ActiveXObject?function(d){var e;if(k.isLocal&&!d)a:{try{e=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}e=void 0}return e||m()}:m;var h=k.xhr(),a=false;if(h){if("withCredentials"in h)a=true;h=function(d){this.xhrObj=d};i.augment(h,{send:function(){var d=this,e=d.xhrObj,c=e.config;if(c.crossDomain&&!a)i.error("do not allow crossdomain xhr !");else{var f=
k.xhr(),q,l;d.xhr=f;c.username?f.open(c.type,c.url,c.async,c.username,c.password):f.open(c.type,c.url,c.async);if(q=c.xhrFields)for(l in q)f[l]=q[l];e.mimeType&&f.overrideMimeType&&f.overrideMimeType(e.mimeType);try{for(l in e.requestHeaders)f.setRequestHeader(l,e.requestHeaders[l])}catch(n){}f.send(c.hasContent&&c.data||null);if(!c.async||f.readyState==4)d._callback();else f.onreadystatechange=function(){d._callback()}}},abort:function(){this._callback(0,1)},_callback:function(d,e){try{var c=this.xhr,
f=this.xhrObj,q=f.config;if(e||c.readyState==4){c.onreadystatechange=i.noop;if(e)c.readyState!==4&&c.abort();else{var l=c.status;f.responseHeadersString=c.getAllResponseHeaders();var n=c.responseXML;if(n&&n.documentElement)f.responseXML=n;f.responseText=c.responseText;try{var o=c.statusText}catch(p){o=""}if(!l&&k.isLocal&&!q.crossDomain)l=f.responseText?200:404;else if(l===1223)l=204;f.callback(l,o)}}}catch(s){c.onreadystatechange=i.noop;e||f.callback(-1,s)}}});g["*"]=h;return k}},{requires:["./base"]});
KISSY.add("ajax/script",function(i,k){function m(a){if(!a.config.crossDomain&&!a.config.forceScript)return new g["*"](a);this.xhrObj=a;return 0}var g=k.__transports,h=k.__defaultConfig;h.accepts.script="text/javascript, application/javascript, application/ecmascript, application/x-ecmascript";h.contents.script=/javascript|ecmascript/;h.converters.text.script=function(a){i.globalEval(a);return a};i.augment(m,{send:function(){var a=this,d,e=this.xhrObj.config,c=document.head||document.getElementsByTagName("head")[0]||
document.documentElement;a.head=c;d=document.createElement("script");a.script=d;d.async="async";if(e.scriptCharset)d.charset=e.scriptCharset;d.src=e.url;d.onerror=d.onload=d.onreadystatechange=function(f){f=f||window.event;a._callback((f.type||"error").toLowerCase())};c.insertBefore(d,c.firstChild)},_callback:function(a,d){var e=this.script,c=this.xhrObj,f=this.head;if(d||!e.readyState||/loaded|complete/.test(e.readyState)||a=="error"){e.onerror=e.onload=e.onreadystatechange=null;f&&e.parentNode&&
f.removeChild(e);this.head=this.script=undefined;if(!d&&a!="error")c.callback(200,"success");else a=="error"&&c.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});g.script=m;return k},{requires:["./base","./xhr"]});
KISSY.add("ajax/jsonp",function(i,k){var m=k.__defaultConfig;m.jsonp="callback";m.jsonpCallback=function(){return i.guid("jsonp")};k.on("start",function(g){g=g.xhr;var h=g.config;if(h.dataType[0]=="jsonp"){var a,d=h.jsonpCallback,e=i.isFunction(d)?d():d,c=window[e];h.url+=(/\?/.test(h.url)?"&":"?")+h.jsonp+"="+e;window[e]=function(f){a=[f]};g.on("complete",function(){window[e]=c;if(c===undefined)try{delete window[e]}catch(f){}else a&&c(a[0])});g.converters=g.converters||{};g.converters.script=g.converters.script||
{};g.converters.script.json=function(){a||i.error(" not call jsonpCallback : "+e);return a[0]};h.dataType.length=2;h.dataType[0]="script";h.dataType[1]="json"}});return k},{requires:["./base"]});
KISSY.add("ajax",function(i,k){i.mix(k,{get:function(m,g,h,a,d){if(i.isFunction(g)){a=h;h=g}return k({type:d||"get",url:m,data:g,success:h,dataType:a})},post:function(m,g,h,a){if(i.isFunction(g)){a=h;h=g;g=undefined}return k.get(m,g,h,a,"post")},jsonp:function(m,g,h){if(i.isFunction(g)){h=g;g=null}return k.get(m,g,h,"jsonp")},getScript:i.getScript,getJSON:function(m,g,h){return k.get(m,g,h,"json")}});return k},{requires:["ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp"]});
