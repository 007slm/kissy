/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 6 20:11
*/
KISSY.add("ajax/base",function(h,j,k,i){function d(g){g=h.mix(h.clone(u),g||{},undefined,undefined,true);if(!h.isBoolean(g.crossDomain)){var n=e.exec(g.url.toLowerCase());g.crossDomain=!!(n&&(n[1]!=r[1]||n[2]!=r[2]||(n[3]||(n[1]==="http:"?l:p))!=(r[3]||(r[1]==="http:"?l:p))))}if(g.processData&&g.data&&!h.isString(g.data))g.data=h.param(g.data,undefined,undefined,g.serializeArray);g.type=g.type.toUpperCase();g.hasContent=!q.test(g.type);if(!g.hasContent){if(g.data)g.url+=(/\?/.test(g.url)?"&":"?")+
g.data;if(g.cache===false)g.url+=(/\?/.test(g.url)?"&":"?")+"_ksTS="+(h.now()+"_"+h.guid())}g.dataType=h.trim(g.dataType||"*").split(a);g.context=g.context||g;return g}function c(g,n){f.fire(g,{ajaxConfig:n.config,xhr:n})}function b(g){var n=this.config;g=g.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);n[g]&&n[g].call(n.context,this.responseData,this.statusText,this);c(g,this)}function f(g){if(g.url){g=d(g);var n=new i(g);c("start",n);var x=new (s[g.dataType[0]]||s["*"])(n);n.transport=
x;g.contentType&&n.setRequestHeader("Content-Type",g.contentType);var v=g.dataType[0],w=g.accepts;n.setRequestHeader("Accept",v&&w[v]?w[v]+(v==="*"?"":", */*; q=0.01"):w["*"]);for(var y in g.headers)n.setRequestHeader(y,g.headers[y]);n.on("complete success error",b);n.readyState=1;c("send",n);if(g.async&&g.timeout>0)n.timeoutTimer=setTimeout(function(){n.abort("timeout")},g.timeout);try{n.state=1;x.send()}catch(z){n.status<2&&n.callback(-1,z)}return n}}var a=/\s+/,e=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
m=function(g){return g},l=80,p=443,q=/^(?:GET|HEAD)$/,o,r;try{o=location.href}catch(t){o=document.createElement("a");o.href="";o=o.href}r=e.exec(o);o=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(r[1]);var s={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:j.parse,
html:m,text:m,xml:h.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;h.mix(f,k.Target);h.mix(f,{isLocal:o,setupConfig:function(g){h.mix(u,g,undefined,undefined,true)},setupTransport:function(g,n){s[g]=n},getTransport:function(g){return s[g]},getConfig:function(){return u}});return f},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(h,j){var k=/^(?:select|textarea)/i,i=/\r?\n/g,d=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(c){var b=[],f={};j.query(c).each(function(a){a=a.elements?h.makeArray(a.elements):[a];b.push.apply(b,a)});b=h.filter(b,function(a){return a.name&&!a.disabled&&(a.checked||k.test(a.nodeName)||d.test(a.type))});h.each(b,function(a){var e=j.val(a);e=h.map(h.makeArray(e),function(m){return m.replace(i,
"\r\n")});a=f[a.name]=f[a.name]||[];a.push.apply(a,e)});return h.param(f,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(h,j,k,i){j.on("start",function(d){d=d.xhr.config;if(d.form){var c=k.get(d.form);if((c.encoding||c.enctype).toLowerCase()!="multipart/form-data"){if(c=i.serialize(c))if(d.hasContent){d.data=d.data||"";if(d.data)d.data+="&";d.data+=c}else d.url+=(/\?/.test(d.url)?"&":"?")+c}else{c=d.dataType[0];if(c=="*")c="text";d.dataType.length=2;d.dataType[0]="iframe";d.dataType[1]=c}}});return j},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(h,j,k,i){function d(b){this.xhr=b}var c=document;i.setupConfig({converters:{iframe:i.getConfig().converters.text,text:{iframe:function(b){return b}}}});h.augment(d,{send:function(){var b=this.xhr,f=b.config,a,e=j.get(f.form);this.attrs={target:j.attr(e,"target")||"",action:j.attr(e,"action")||""};this.form=e;var m=h.guid("ajax-iframe");b.iframe=j.create("<iframe  id='"+m+"' name='"+m+"' style='position:absolute;left:-9999px;top:-9999px;'/>");b.iframeId=m;j.prepend(b.iframe,
c.body||c.documentElement);j.attr(e,{target:b.iframeId,action:f.url});if(f.data){a=f.data;f=f.serializeArray;a=h.unparam(a);m=[];for(var l in a)for(var p=h.makeArray(a[l]),q=0;q<p.length;q++){var o=c.createElement("input");o.type="hidden";o.name=l+(f?"[]":"");o.value=p[q];j.append(o,e);m.push(o)}a=m}this.fields=a;k.on(b.iframe,"load error",this._callback,this);e.submit()},_callback:function(b){var f=this.xhr;b=b.type;var a=f.iframe;if(a){j.attr(this.form,this.attrs);if(b=="load"){b=a.contentWindow.document;
f.responseXML=b;f.responseText=j.text(b.body);f.callback(200,"success")}else b=="error"&&f.callback(500,"error");j.remove(this.fields);k.detach(a);setTimeout(function(){j.remove(a)},30);f.iframe=null}},abort:function(){this._callback(0,1)}});i.setupTransport("iframe",d);return i},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(h,j){j.setupConfig({jsonp:"callback",jsonpCallback:function(){return h.guid("jsonp")}});j.on("start",function(k){k=k.xhr;var i=k.config;if(i.dataType[0]=="jsonp"){var d,c=i.jsonpCallback,b=h.isFunction(c)?c():c,f=window[b];i.url+=(/\?/.test(i.url)?"&":"?")+i.jsonp+"="+b;window[b]=function(a){if(arguments.length>1)a=h.makeArray(arguments);d=[a]};k.on("complete",function(){window[b]=f;if(f===undefined)try{delete window[b]}catch(a){}else d&&f(d[0])});k.converters=k.converters||
{};k.converters.script=k.converters.script||{};k.converters.script.json=function(){return d[0]};i.dataType.length=2;i.dataType[0]="script";i.dataType[1]="json"}});return j},{requires:["./base"]});
KISSY.add("ajax/script",function(h,j){function k(d){if(!d.config.crossDomain&&!d.config.forceScript)return new (j.getTransport("*"))(d);this.xhrObj=d;return 0}var i=document;j.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){h.globalEval(d);return d}}}});h.augment(k,{send:function(){var d=this,c,b=this.xhrObj.config,f=i.head||i.getElementsByTagName("head")[0]||
i.documentElement;d.head=f;c=i.createElement("script");d.script=c;c.async="async";if(b.scriptCharset)c.charset=b.scriptCharset;c.src=b.url;c.onerror=c.onload=c.onreadystatechange=function(a){a=a||window.event;d._callback((a.type||"error").toLowerCase())};f.insertBefore(c,f.firstChild)},_callback:function(d,c){var b=this.script,f=this.xhrObj,a=this.head;if(b)if(c||!b.readyState||/loaded|complete/.test(b.readyState)||d=="error"){b.onerror=b.onload=b.onreadystatechange=null;a&&b.parentNode&&a.removeChild(b);
this.head=this.script=undefined;if(!c&&d!="error")f.callback(200,"success");else d=="error"&&f.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});j.setupTransport("script",k);return j},{requires:["./base","./xhr"]});
KISSY.add("ajax/xdr",function(h,j){var k=j.getTransport("*");if(!k.allowCrossDomain){var i={},d,c=false,b=function(a,e,m){if(!c){c=true;a='<object id="io_swf" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+e+"&uid="+m+'&host=KISSY.io" /><param name="allowScriptAccess" value="always" /></object>';e=document.createElement("div");document.body.appendChild(e);e.innerHTML=a}},f=k.prototype.send;h.augment(k,
{send:function(){var a=this,e=a.xhrObj.config;if(!e.crossDomain)return f.call(a);b((e.xdr||{}).src||h.Config.base+"ajax/io.swf",1,1);if(d){a._uid=h.guid();i[a._uid]=a;d.send(e.url,{id:a._uid,uid:a._uid,method:e.type,data:e.hasContent&&e.data||{}})}else setTimeout(function(){a.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(a,e){var m,l=this.xhrObj;l.responseText=decodeURI(e.c.responseText);switch(a){case "success":m={status:200,statusText:"success"};delete i[e.id];break;case "abort":delete i[e.id];
break;case "timeout":case "transport error":case "failure":delete i[e.id];m={status:500,statusText:a}}m&&l.callback(m.status,m.statusText)}});j.applyTo=function(a,e,m){a=e.split(".");var l=h;h.each(a,function(p){l=l[p]});l.apply(null,m)};j.xdrReady=function(){d=document.getElementById("io_swf")};j.xdrResponse=function(a,e,m){var l=i[e.uid];l&&l._xdrResponse(a,e,m)};h.io=j}return j},{requires:["./xhr"]});
KISSY.add("ajax/xhr",function(h,j){function k(){try{return new window.XMLHttpRequest}catch(b){}}var i=window.XDomainRequest;j.xhr=window.ActiveXObject?function(b){if(b&&i)return new i;if(!(b=!j.isLocal&&k()))a:{try{b=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(f){}b=void 0}return b}:k;var d=j.xhr(),c=false;if(d){if("withCredentials"in d||i)c=true;d=function(b){this.xhrObj=b};d.allowCrossDomain=c;h.augment(d,{send:function(){var b=this,f=b.xhrObj,a=f.config;if(!(a.crossDomain&&!c)){var e=
j.xhr(a.crossDomain),m,l;b.xhr=e;a.username?e.open(a.type,a.url,a.async,a.username,a.password):e.open(a.type,a.url,a.async);if(m=a.xhrFields)for(l in m)e[l]=m[l];f.mimeType&&e.overrideMimeType&&e.overrideMimeType(f.mimeType);if(!a.crossDomain&&!f.requestHeaders["X-Requested-With"])f.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!a.crossDomain)for(l in f.requestHeaders)e.setRequestHeader(l,f.requestHeaders[l])}catch(p){}e.send(a.hasContent&&a.data||null);if(!a.async||e.readyState==4)b._callback();
else if(i&&e instanceof i){e.onload=function(){e.readyState=4;e.status=200;b._callback()};e.onerror=function(){e.readyState=4;e.status=500;b._callback()}}else e.onreadystatechange=function(){b._callback()}}},abort:function(){this._callback(0,1)},_callback:function(b,f){try{var a=this.xhr,e=this.xhrObj,m=e.config;if(f||a.readyState==4){a.onreadystatechange=h.noop;a.onload=h.noop;a.onerror=h.noop;if(f)a.readyState!==4&&a.abort();else{var l=a.status;if(a.getAllResponseHeaders)e.responseHeadersString=
a.getAllResponseHeaders();var p=a.responseXML;if(p&&p.documentElement)e.responseXML=p;e.responseText=a.responseText;try{var q=a.statusText}catch(o){q=""}if(!l&&j.isLocal&&!m.crossDomain)l=e.responseText?200:404;else if(l===1223)l=204;e.callback(l,q)}}}catch(r){a.onreadystatechange=h.noop;f||e.callback(-1,r)}}});j.setupTransport("*",d);return j}},{requires:["./base"]});
KISSY.add("ajax/xhrobject",function(h,j){function k(c){var b=c.responseText,f=c.responseXML,a=c.config,e=a.converters,m=c.converters||{},l,p,q=a.contents,o=a.dataType;if(b||f){for(a=c.mimeType||c.getResponseHeader("Content-Type");o[0]=="*";)o.shift();if(!o.length)for(l in q)if(q[l].test(a)){o[0]!=l&&o.unshift(l);break}o[0]=o[0]||"text";if(o[0]=="text"&&b!==undefined)p=b;else if(o[0]=="xml"&&f!==undefined)p=f;else h.each(["text","xml"],function(t){var s=o[0];if(m[t]&&m[t][s]||e[t]&&e[t][s]){o.unshift(t);
p=t=="text"?b:f;return false}})}q=o[0];for(a=1;a<o.length;a++){l=o[a];var r=m[q]&&m[q][l]||e[q]&&e[q][l];if(!r)throw"no covert for "+q+" => "+l;p=r(p);q=l}c.responseData=p}function i(c){h.mix(this,{responseData:null,config:c||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var d=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;h.augment(i,j.Target,{setRequestHeader:function(c,b){this.requestHeaders[c]=
b;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(c){var b;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};b=d.exec(this.responseHeadersString);)this.responseHeaders[b[1]]=b[2];b=this.responseHeaders[c]}return b===undefined?null:b},overrideMimeType:function(c){if(!this.state)this.mimeType=c;return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this.callback(0,c);return this},
callback:function(c,b){if(this.state!=2){this.state=2;this.readyState=4;var f;if(c>=200&&c<300||c==304)if(c==304){b="notmodified";f=true}else try{k(this);b="success";f=true}catch(a){b="parsererror : "+a}else if(c<0)c=0;this.status=c;this.statusText=b;f?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return i},{requires:["event"]});
KISSY.add("ajax",function(h,j,k){h.mix(k,{serialize:j.serialize,get:function(i,d,c,b,f){if(h.isFunction(d)){b=c;c=d;d=undefined}return k({type:f||"get",url:i,data:d,success:c,dataType:b})},post:function(i,d,c,b){if(h.isFunction(d)){b=c;c=d;d=undefined}return k.get(i,d,c,b,"post")},jsonp:function(i,d,c){if(h.isFunction(d)){c=d;d=undefined}return k.get(i,d,c,"jsonp")},getScript:h.getScript,getJSON:function(i,d,c){if(h.isFunction(d)){c=d;d=undefined}return k.get(i,d,c,"json")},upload:function(i,d,c,
b,f){if(h.isFunction(c)){f=b;b=c;c=undefined}return k({url:i,type:"post",dataType:f,form:d,data:c,success:b})}});return k},{requires:["ajax/form-serializer","ajax/base","ajax/xhrobject","ajax/xhr","ajax/xdr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
