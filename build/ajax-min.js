/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 16 19:08
*/
KISSY.add("ajax/FormSerializer",function(c,i){function h(b){return b.replace(j,"\r\n")}var f=/^(?:select|textarea)/i,j=/\r?\n/g,g,k=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return g={serialize:function(b,a){return c.param(g.getFormData(b),void 0,void 0,a||!1)},getFormData:function(b){var a=[],l={};c.each(i.query(b),function(e){e=e.elements?c.makeArray(e.elements):[e];a.push.apply(a,e)});a=c.filter(a,function(a){return a.name&&!a.disabled&&
(a.checked||f.test(a.nodeName)||k.test(a.type))});c.each(a,function(a){var d=i.val(a),b,d=c.isArray(d)?c.map(d,h):h(d);(b=l[a.name])?(b&&!c.isArray(b)&&(b=l[a.name]=[b]),b.push.apply(b,c.makeArray(d))):l[a.name]=d});return l}}},{requires:["dom"]});
KISSY.add("ajax/IframeTransport",function(c,i,h,f){function j(a){var l=c.guid("ajax-iframe"),e=i.getEmptyIframeSrc(),a=a.iframe=i.create("<iframe "+(e?' src="'+e+'" ':"")+" id='"+l+"' name='"+l+"' style='position:absolute;left:-9999px;top:-9999px;'/>");i.prepend(a,b.body||b.documentElement);return a}function g(a,l,e){var d=[],k,j,g,h,f=a.keys();c.each(f,function(f){var m=a.get(f);k=c.isArray(m);j=c.makeArray(m);for(g=0;g<j.length;g++)h=b.createElement("input"),h.type="hidden",h.name=f+(k&&e?"[]":
""),h.value=j[g],i.append(h,l),d.push(h)});return d}function k(a){this.xhrObject=a}var b=c.Env.host.document;f.setupConfig({converters:{iframe:f.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});c.augment(k,{send:function(){var a=this,b=a.xhrObject,e=b.config,d,c,k=e.query,f=i.get(e.form);a.attrs={target:i.attr(f,"target")||"",action:i.attr(f,"action")||"",method:i.attr(f,"method")};a.form=f;c=j(b);i.attr(f,{target:c.id,action:e.uri.toString(e.serializeArray),
method:"post"});k.count()&&(d=g(k,f,e.serializeArray));a.fields=d;setTimeout(function(){h.on(c,"load error",a._callback,a);f.submit()},10)},_callback:function(a){var b=this.xhrObject,a=a.type,e=b.iframe;if(e)if(i.attr(this.form,this.attrs),i.remove(this.fields),h.detach(e),setTimeout(function(){i.remove(e)},30),b.iframe=null,"load"==a){if((a=e.contentWindow.document)&&a.body)b.responseText=c.trim(i.text(a.body)),c.startsWith(b.responseText,"<?xml")&&(b.responseText=void 0);b.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;b._xhrReady(200,"success")}else"error"==a&&b._xhrReady(500,"error")},abort:function(){this._callback({})}});f.setupTransport("iframe",k);return f},{requires:["dom","event","./base"]});
KISSY.add("ajax/ScriptTransport",function(c,i,h,f){function j(b){if(!b.config.crossDomain)return new (i.getTransport("*"))(b);this.xhrObj=b;return 0}var g=c.Env.host,k=g.document;i.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(b){c.globalEval(b);return b}}}});c.augment(j,{send:function(){var b=this,a,c=b.xhrObj.config,e=k.head||k.getElementsByTagName("head")[0]||
k.documentElement;b.head=e;a=k.createElement("script");b.script=a;a.async="async";c.scriptCharset&&(a.charset=c.scriptCharset);a.src=c.uri.toString(c.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(a){a=a||g.event;b._callback((a.type||"error").toLowerCase())};e.insertBefore(a,e.firstChild)},_callback:function(b,a){var c=this.script,e=this.xhrObj,d=this.head;if(c&&(a||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==b))c.onerror=c.onload=c.onreadystatechange=null,d&&c.parentNode&&
d.removeChild(c),this.head=this.script=f,!a&&"error"!=b?e._xhrReady(200,"success"):"error"==b&&e._xhrReady(500,"script error")},abort:function(){this._callback(0,1)}});i.setupTransport("script",j);return i},{requires:["./base","./XhrTransport"]});
KISSY.add("ajax/SubDomainTransport",function(c,i,h,f){function j(a){var b=a.config;this.xhrObj=a;b.crossDomain=!1}function g(){var a=this.xhrObj.config.uri.getHostname(),a=b[a];a.ready=1;h.detach(a.iframe,"load",g,this);this.send()}var k=c.Env.host.document,b={};c.augment(j,i.proto,{send:function(){var a=this.xhrObj.config,l=a.uri,e=l.getHostname(),d;d=b[e];var j="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(j=a.xdr.subDomain.proxy);d&&d.ready?(this.nativeXhr=i.nativeXhr(0,
d.iframe.contentWindow))&&this.sendInternal():(d?a=d.iframe:(d=b[e]={},a=d.iframe=k.createElement("iframe"),f.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),f.prepend(a,k.body||k.documentElement),d=new c.Uri,d.setScheme(l.getScheme()),d.setHostname(e),d.setPath(j),a.src=d.toString()),h.on(a,"load",g,this))}});return j},{requires:["./XhrTransportBase","event","dom"]});
KISSY.add("ajax/XdrFlashTransport",function(c,i,h){function f(e,b,c){l||(l=!0,e='<object id="'+k+'" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0"><param name="movie" value="'+e+'" /><param name="FlashVars" value="yid='+b+"&uid="+c+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',b=a.createElement("div"),h.prepend(b,a.body||a.documentElement),b.innerHTML=e)}function j(a){this.xhrObj=a}var g={},k="io_swf",b,a=c.Env.host.document,
l=!1;c.augment(j,{send:function(){var a=this,d=a.xhrObj.config;f((d.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);b?(a._uid=c.guid(),g[a._uid]=a,b.send(d.uri.toString(d.serializeArray),{id:a._uid,uid:a._uid,method:d.type,data:d.hasContent&&d.query.toString(d.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(a,b){var c,k=b.id,l=this.xhrObj;l.responseText=decodeURI(b.c.responseText);switch(a){case "success":c={status:200,statusText:"success"};
delete g[k];break;case "abort":delete g[k];break;case "timeout":case "transport error":case "failure":delete g[k],c={status:500,statusText:a}}c&&l._xhrReady(c.status,c.statusText)}});i.applyTo=function(a,b,k){var a=b.split(".").slice(1),l=i;c.each(a,function(a){l=l[a]});l.apply(null,k)};i.xdrReady=function(){b=a.getElementById(k)};i.xdrResponse=function(a,b){var c=g[b.uid];c&&c._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("ajax/XhrObject",function(c,i){function h(k){var b=k.responseText,a=k.responseXML,l=k.config,e=l.converters,d=k.converters||{},j,g,f=l.contents,h=l.dataType;if(b||a){for(l=k.mimeType||k.getResponseHeader("Content-Type");"*"==h[0];)h.shift();if(!h.length)for(j in f)if(f.hasOwnProperty(j)&&f[j].test(l)){h[0]!=j&&h.unshift(j);break}h[0]=h[0]||"text";if("text"==h[0]&&b!==i)g=b;else if("xml"==h[0]&&a!==i)g=a;else{var o={text:b,xml:a};c.each(["text","xml"],function(c){var k=h[0];if((d[c]&&d[c][k]||
e[c]&&e[c][k])&&o[c])return h.unshift(c),g="text"==c?b:a,!1})}}f=h[0];for(l=1;l<h.length;l++){j=h[l];var n=d[f]&&d[f][j]||e[f]&&e[f][j];if(!n)throw"no covert for "+f+" => "+j;g=n(g);f=j}k.responseData=g}function f(k){j.call(this);c.mix(this,{responseData:null,config:k||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)})}var j=c.Promise,g=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;
c.extend(f,j,{setRequestHeader:function(c,b){this.requestHeaders[c]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var b,a;if(2===this.state){if(!(a=this.responseHeaders))for(a=this.responseHeaders={};b=g.exec(this.responseHeadersString);)a[b[1]]=b[2];b=a[c]}return b===i?null:b},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);
this._xhrReady(0,c);return this},getNativeXhr:function(){var c;if(c=this.transport)return c.nativeXhr},_xhrReady:function(c,b){if(2!=this.state){this.state=2;this.readyState=4;var a;if(200<=c&&300>c||304==c)if(304==c)b="not modified",a=!0;else try{h(this),b="success",a=!0}catch(j){b="parser error"}else 0>c&&(c=0);this.status=c;this.statusText=b;this._defer[a?"resolve":"reject"]([this.responseData,b,this])}}});return f});
KISSY.add("ajax/XhrTransport",function(c,i,h,f,j,g){var k=c.Env.host.XDomainRequest,b=h.nativeXhr();if(b){var a=function(a){var a=a.split("."),c=a.length,b=3<c?3:2;return c<b?a.join("."):a.reverse().slice(0,b).reverse().join(".")},l=function(c){var d=c.config,l=d.crossDomain,i=d.xdr||{};if(l){if(a(location.hostname)==a(d.uri.getHostname()))return new f(c);if(!("withCredentials"in b)&&("flash"===""+i.use||!k))return new j(c)}this.xhrObj=c;this.nativeXhr=h.nativeXhr(l);return g};c.augment(l,h.proto,
{send:function(){this.sendInternal()}});i.setupTransport("*",l)}return i},{requires:["./base","./XhrTransportBase","./SubDomainTransport","./XdrFlashTransport"]});
KISSY.add("ajax/XhrTransportBase",function(c,i){function h(a,c){try{return new (c||f).XMLHttpRequest}catch(b){}}var f=c.Env.host,j=f.XDomainRequest,g={proto:{}},k={},b={};i.__lastModifiedCached=k;i.__eTagCached=b;g.nativeXhr=f.ActiveXObject?function(a,c){var b;if(a&&j)b=new j;else if(!(b=!i.isLocal&&h(a,c)))a:{try{b=new (c||f).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}b=void 0}return b}:h;c.mix(g.proto,{sendInternal:function(){var a=this,c=a.xhrObj,e=c.config,d=a.nativeXhr,g=e.type,h=e.async,
f,i=e.crossDomain,o=c.mimeType,c=c.requestHeaders||{},n=e.serializeArray,m=e.uri.toString(n),u,s,r;if(u=e.ifModifiedKeyUri&&e.ifModifiedKeyUri.toString()){if(s=k[u])c["If-Modified-Since"]=s;if(s=b[u])c["If-None-Match"]=s}(f=e.username)?d.open(g,m,h,f,e.password):d.open(g,m,h);if(g=e.xhrFields)for(r in g)g.hasOwnProperty(r)&&(d[r]=g[r]);o&&d.overrideMimeType&&d.overrideMimeType(o);!i&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{if(!i)for(r in c)c.hasOwnProperty(r)&&d.setRequestHeader(r,
c[r])}catch(w){}d.send(e.hasContent&&e.query.toString(n)||null);!h||4==d.readyState?a._callback():j&&d instanceof j?(d.onload=function(){d.readyState=4;d.status=200;a._callback()},d.onerror=function(){d.readyState=4;d.status=500;a._callback()}):d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,g){try{var e=this.nativeXhr,d=this.xhrObj,h=d.config;if(g||4==e.readyState)if(j&&e instanceof j?(e.onerror=c.noop,e.onload=c.noop):e.onreadystatechange=
c.noop,g)4!==e.readyState&&e.abort();else{var f=h.ifModifiedKeyUri&&h.ifModifiedKeyUri.toString(),p=e.status;j&&e instanceof j||(d.responseHeadersString=e.getAllResponseHeaders());if(f){var q=e.getResponseHeader("Last-Modified"),o=e.getResponseHeader("ETag");q&&(k[f]=q);o&&(b[o]=o)}var n=e.responseXML;n&&n.documentElement&&(d.responseXML=n);d.responseText=e.responseText;try{var m=e.statusText}catch(u){m=""}!p&&i.isLocal&&!h.crossDomain?p=d.responseText?200:404:1223===p&&(p=204);d._xhrReady(p,m)}}catch(s){e.onreadystatechange=
c.noop,g||d._xhrReady(-1,s)}}});return g},{requires:["./base"]});
KISSY.add("ajax",function(c,i,h,f){function j(j,b,a,f,e){c.isFunction(b)&&(f=a,a=b,b=g);return h({type:e||"get",url:j,data:b,success:a,dataType:f})}var g=void 0;c.mix(h,{XhrObject:f,serialize:i.serialize,get:j,post:function(h,b,a,f){c.isFunction(b)&&(f=a,a=b,b=g);return j(h,b,a,f,"post")},jsonp:function(f,b,a){c.isFunction(b)&&(a=b,b=g);return j(f,b,a,"jsonp")},getScript:c.getScript,getJSON:function(f,b,a){c.isFunction(b)&&(a=b,b=g);return j(f,b,a,"json")},upload:function(j,b,a,f,e){c.isFunction(a)&&
(e=f,f=a,a=g);return h({url:j,type:"post",dataType:e,form:b,data:a,success:f})}});c.mix(c,{Ajax:h,IO:h,ajax:h,io:h,jsonp:h.jsonp});return h},{requires:"ajax/FormSerializer,ajax/base,ajax/XhrObject,ajax/XhrTransport,ajax/ScriptTransport,ajax/jsonp,ajax/form,ajax/IframeTransport".split(",")});
KISSY.add("ajax/base",function(c,i,h,f,j){function g(b){var d=b.context,j=b.ifModified;delete b.context;b=c.mix(c.clone(m),b,{deep:!0});b.context=d||b;var f,g=b.type,h=b.dataType,k;k=b.query=new c.Uri.Query;d=b.uri=q.resolve(b.url);"crossDomain"in b||(b.crossDomain=!b.uri.hasSameDomainAs(q));if(b.processData&&(f=b.data))c.isObject(f)?k.add(f):k.reset(f);g=b.type=g.toUpperCase();b.hasContent=!e.test(g);h=b.dataType=c.trim(h||"*").split(a);!("cache"in b)&&c.inArray(h[0],["script","jsonp"])&&(b.cache=
!1);var i;b.hasContent||(k.count()&&d.query.add(k),j&&(i=d.clone()),!1===b.cache&&d.query.set("_ksTS",c.now()+"_"+c.guid()));j&&(b.ifModifiedKeyUri=i||d.clone());return b}function k(a,c){b.fire(a,{ajaxConfig:c.config,xhr:c})}function b(a){function c(d){return function(c){if(h=b.timeoutTimer)clearTimeout(h),b.timeoutTimer=0;var e=a[d];e&&e.apply(m,c);k(d,b)}}if(!a.url)return j;var a=g(a),b=new f(a),d;k("start",b);d=new (n[a.dataType[0]]||n["*"])(b);b.transport=d;a.contentType&&b.setRequestHeader("Content-Type",
a.contentType);var e=a.dataType[0],h,i,l=a.timeout,m=a.context,o=a.headers,p=a.accepts;b.setRequestHeader("Accept",e&&p[e]?p[e]+("*"===e?"":", */*; q=0.01"):p["*"]);for(i in o)o.hasOwnProperty(i)&&b.setRequestHeader(i,o[i]);if(a.beforeSend&&!1===a.beforeSend.call(m,b,a))return j;b.then(c("success"),c("error"));b.fin(c("complete"));b.readyState=1;k("send",b);a.async&&0<l&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*l));try{b.state=1,d.send()}catch(q){2>b.state&&b._xhrReady(-1,q)}return b}
var a=/\s+/,l=function(a){return a},e=/^(?:GET|HEAD)$/,d,v=c.Uri,t=c.Env.host,p=t.document,t=t.location,q;try{d=t.href}catch(o){d=p.createElement("a"),d.href="",d=d.href}q=new v(d);d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/.test(q.getScheme());var n={},m={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",
"*":"*/*"},converters:{text:{json:i.parse,html:l,text:l,xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};m.converters.html=m.converters.text;c.mix(b,h.Target);c.mix(b,{isLocal:d,setupConfig:function(a){c.mix(m,a,{deep:!0})},setupTransport:function(a,b){n[a]=b},getTransport:function(a){return n[a]},getConfig:function(){return m}});return b},{requires:["json","event","./XhrObject"]});
KISSY.add("ajax/form",function(c,i,h,f){i.on("start",function(c){var g,i,c=c.xhr.config;if(g=c.form)g=h.get(g),i=g.encoding||g.enctype,"multipart/form-data"!=i.toLowerCase()?(g=f.getFormData(g),c.hasContent?c.query.add(g):(c.uri.query.add(g),c.ifModifiedKeyUri&&c.ifModifiedKeyUri.query.add(g))):(g=c.dataType,c=g[0],"*"==c&&(c="text"),g.length=2,g[0]="iframe",g[1]=c)});return i},{requires:["./base","dom","./FormSerializer"]});
KISSY.add("ajax/jsonp",function(c,i){var h=c.Env.host;i.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});i.on("start",function(f){var j=f.xhr,g=j.config,f=g.dataType;if("jsonp"==f[0]){var i,b=g.jsonpCallback,a=c.isFunction(b)?b():b,l=h[a];g.uri.query.set(g.jsonp,a);h[a]=function(a){1<arguments.length&&(a=c.makeArray(arguments));i=[a]};j.fin(function(){h[a]=l;if(void 0===l)try{delete h[a]}catch(b){}else i&&l(i[0])});j=j.converters=j.converters||{};j.script=j.script||
{};j.script.json=function(){return i[0]};f.length=2;f[0]="script";f[1]="json"}});return i},{requires:["./base"]});
