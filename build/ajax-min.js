/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 11 16:05
*/
KISSY.add("ajax",function(e,g,i){function k(d,c,a,h,n){e.isFunction(c)&&(h=a,a=c,c=j);return i({type:n||"get",url:d,data:c,success:a,dataType:h})}var j=void 0;e.mix(i,{serialize:g.serialize,get:k,post:function(d,c,a,h){e.isFunction(c)&&(h=a,a=c,c=j);return k(d,c,a,h,"post")},jsonp:function(d,c,a){e.isFunction(c)&&(a=c,c=j);return k(d,c,a,"jsonp")},getScript:e.getScript,getJSON:function(d,c,a){e.isFunction(c)&&(a=c,c=j);return k(d,c,a,"json")},upload:function(d,c,a,h,n){e.isFunction(a)&&(n=h,h=a,a=
j);return i({url:d,type:"post",dataType:n,form:c,data:a,success:h})}});e.mix(e,{Ajax:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(e,g,i,k){function j(f){var a=f.context;delete f.context;f=e.mix(e.clone(q),f,{deep:!0});f.context=a||f;var d,m=f.type,c=f.dataType,a=f.uri=p.resolve(f.url);"crossDomain"in f||(f.crossDomain=!f.uri.isSameOriginAs(p));m=f.type=m.toUpperCase();f.hasContent=!b.test(m);if(f.processData&&(d=f.data)&&"string"!=typeof d)f.data=e.param(d,k,k,f.serializeArray);c=f.dataType=e.trim(c||"*").split(h);!("cache"in f)&&e.inArray(c[0],["script","jsonp"])&&(f.cache=!1);f.hasContent||(f.data&&
a.query.add(e.unparam(f.data)),!1===f.cache&&a.query.set("_ksTS",e.now()+"_"+e.guid()));return f}function d(f,b){c.fire(f,{ajaxConfig:b.config,io:b})}function c(b){function h(f){return function(h){if(g=a.timeoutTimer)clearTimeout(g),a.timeoutTimer=0;var m=b[f];m&&m.apply(i,h);d(f,a)}}var a=this;if(!b.url)return k;if(!(a instanceof c))return new c(b);f.call(a);b=j(b);e.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new e.Defer(this)});var m;d("start",a);m=new (r[b.dataType[0]]||r["*"])(a);a.transport=m;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var n=b.dataType[0],g,o,l=b.timeout,i=b.context,p=b.headers,s=b.accepts;a.setRequestHeader("Accept",n&&s[n]?s[n]+("*"===n?"":", */*; q=0.01"):s["*"]);for(o in p)a.setRequestHeader(o,p[o]);if(b.beforeSend&&!1===b.beforeSend.call(i,a,b))return k;a.then(h("success"),
h("error"));a.fin(h("complete"));a.readyState=1;d("send",a);b.async&&0<l&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},1E3*l));try{a.state=1,m.send()}catch(t){2>a.state&&a._ioReady(-1,t)}return k}var a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,h=/\s+/,n=function(b){return b},f=e.Promise,b=/^(?:GET|HEAD)$/,m,o=e.Uri,l=e.Env.host,s=l.document,l=l.location,p;if(l){try{m=l.href}catch(t){m=s.createElement("a"),m.href="",m=m.href}p=new o(m)}var a=p&&a.test(p.getScheme()),r={},
q={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:g.parse,html:n,text:n,xml:e.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};q.converters.html=q.converters.text;e.mix(c,i.Target);e.mix(c,{isLocal:a,setupConfig:function(b){e.mix(q,b,{deep:!0})},setupTransport:function(b,f){r[b]=
f},getTransport:function(b){return r[b]},getConfig:function(){return q}});return c},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(e,g){function i(a){return a.replace(j,"\r\n")}var k=/^(?:select|textarea)/i,j=/\r?\n/g,d,c=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return d={serialize:function(a,h){return e.param(d.getFormData(a),void 0,void 0,h||!1)},getFormData:function(a){var h=[],d={};e.each(g.query(a),function(f){f=f.elements?e.makeArray(f.elements):[f];h.push.apply(h,f)});h=e.filter(h,function(f){return f.name&&!f.disabled&&
(f.checked||k.test(f.nodeName)||c.test(f.type))});e.each(h,function(f){var b=g.val(f),a,b=e.isArray(b)?e.map(b,i):i(b);(a=d[f.name])?(a&&!e.isArray(a)&&(a=d[f.name]=[a]),a.push.apply(a,e.makeArray(b))):d[f.name]=b});return d}}},{requires:["dom"]});
KISSY.add("ajax/form",function(e,g,i,k){g.on("start",function(g){var d,c,a,g=g.io.config;if(a=g.form)d=i.get(a),c=d.encoding||d.enctype,a=g.data,"multipart/form-data"!=c.toLowerCase()?(d=k.getFormData(d),g.hasContent?(d=e.param(d,void 0,void 0,g.serializeArray),g.data=a?g.data+("&"+d):d):g.uri.query.add(d)):(a=g.dataType,g=a[0],"*"==g&&(g="text"),a.length=2,a[0]="iframe",a[1]=g)});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(e,g,i,k){function j(h){var d=e.guid("ajax-iframe"),f=g.getEmptyIframeSrc(),h=h.iframe=g.create("<iframe "+(f?' src="'+f+'" ':"")+' id="'+d+'" name="'+d+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(h,a.body||a.documentElement);return h}function d(h,d,f){var b=[],m,c,l,i;e.each(h,function(h,k){m=e.isArray(h);c=e.makeArray(h);for(l=0;l<c.length;l++)i=a.createElement("input"),i.type="hidden",i.name=k+(m&&f?"[]":""),i.value=c[l],g.append(i,
d),b.push(i)});return b}function c(a){this.io=a}var a=e.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});e.augment(c,{send:function(){function a(){i.on(o,"load error",c._callback,c);p.submit()}var c=this,f=c.io,b=f.config,m,o,l,k=b.data,p=g.get(b.form);c.attrs={target:g.attr(p,"target")||"",action:g.attr(p,"action")||"",method:g.attr(p,"method")};c.form=p;o=j(f);g.attr(p,{target:o.id,action:b.uri.toString(b.serializeArray),
method:"post"});k&&(l=e.unparam(k));l&&(m=d(l,p,b.serializeArray));c.fields=m;6==e.UA.ie?setTimeout(a,0):a()},_callback:function(a){var d=this,f=d.form,b=d.io,a=a.type,c,o=b.iframe;if(o)if("abort"==a&&6==e.UA.ie?setTimeout(function(){g.attr(f,d.attrs)},0):g.attr(f,d.attrs),g.remove(this.fields),i.detach(o),setTimeout(function(){g.remove(o)},30),b.iframe=null,"load"==a)try{if((c=o.contentWindow.document)&&c.body)b.responseText=e.trim(g.text(c.body)),e.startsWith(b.responseText,"<?xml")&&(b.responseText=
void 0);b.responseXML=c&&c.XMLDocument?c.XMLDocument:c;c?b._ioReady(200,"success"):b._ioReady(500,"parser error")}catch(l){b._ioReady(500,"parser error")}else"error"==a&&b._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});k.setupTransport("iframe",c);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(e,g){var i=e.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return e.guid("jsonp")}});g.on("start",function(g){var j=g.io,d=j.config,g=d.dataType;if("jsonp"==g[0]){var c,a=d.jsonpCallback,h=e.isFunction(a)?a():a,n=i[h];d.uri.query.set(d.jsonp,h);i[h]=function(f){1<arguments.length&&(f=e.makeArray(arguments));c=[f]};j.fin(function(){i[h]=n;if(void 0===n)try{delete i[h]}catch(f){}else c&&n(c[0])});j=j.converters=j.converters||{};j.script=j.script||
{};j.script.json=function(){return c[0]};g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("ajax/methods",function(e,g,i){function k(d){var c=d.responseText,a=d.responseXML,h=d.config,g=h.converters,f=d.converters||{},b,m,o=h.contents,l=h.dataType;if(c||a){for(h=d.mimeType||d.getResponseHeader("Content-Type");"*"==l[0];)l.shift();if(!l.length)for(b in o)if(o[b].test(h)){l[0]!=b&&l.unshift(b);break}l[0]=l[0]||"text";if("text"==l[0]&&c!==i)m=c;else if("xml"==l[0]&&a!==i)m=a;else{var k={text:c,xml:a};e.each(["text","xml"],function(b){var d=l[0];if((f[b]&&f[b][d]||g[b]&&g[b][d])&&
k[b])return l.unshift(b),m="text"==b?c:a,!1})}}o=l[0];for(h=1;h<l.length;h++){b=l[h];var j=f[o]&&f[o][b]||g[o]&&g[o][b];if(!j)throw"no covert for "+o+" => "+b;m=j(m);o=b}d.responseData=m}var j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;e.extend(g,e.Promise,{setRequestHeader:function(d,c){this.requestHeaders[d]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var c,a;if(2===this.state){if(!(a=this.responseHeaders))for(a=this.responseHeaders=
{};c=j.exec(this.responseHeadersString);)a[c[1]]=c[2];c=a[d]}return c===i?null:c},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d;if(d=this.transport)return d.nativeXhr},_ioReady:function(d,c){if(2!=this.state){this.state=2;this.readyState=4;var a;if(200<=d&&300>d||304==d)if(304==d)c="not modified",a=!0;else try{k(this),c="success",a=!0}catch(h){c=
"parser error"}else 0>d&&(d=0);this.status=d;this.statusText=c;this._defer[a?"resolve":"reject"]([this.responseData,c,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(e,g,i,k){function j(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return 0}var d=e.Env.host,c=d.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){e.globalEval(a);return a}}}});e.augment(j,{send:function(){var a=this,h,e=a.io.config,f=c.head||c.getElementsByTagName("head")[0]||
c.documentElement;a.head=f;h=c.createElement("script");a.script=h;h.async=!0;e.scriptCharset&&(h.charset=e.scriptCharset);h.src=e.uri.toString(e.serializeArray);h.onerror=h.onload=h.onreadystatechange=function(b){b=b||d.event;a._callback((b.type||"error").toLowerCase())};f.insertBefore(h,f.firstChild)},_callback:function(a,d){var c=this.script,f=this.io,b=this.head;if(c&&(d||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=c.onreadystatechange=null,b&&c.parentNode&&
b.removeChild(c),this.head=this.script=k,!d&&"error"!=a?f._ioReady(200,"success"):"error"==a&&f._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",j);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(e,g,i,k){function j(a){var c=a.config;this.io=a;c.crossDomain=!1}function d(){var c=this.io.config.uri.getHostname(),c=a[c];c.ready=1;i.detach(c.iframe,"load",d,this);this.send()}var c=e.Env.host.document,a={};e.augment(j,g.proto,{send:function(){var h=this.io.config,n=h.uri,f=n.getHostname(),b;b=a[f];var m="/sub_domain_proxy.html";h.xdr&&h.xdr.subDomain&&h.xdr.subDomain.proxy&&(m=h.xdr.subDomain.proxy);b&&b.ready?(this.nativeXhr=g.nativeXhr(0,b.iframe.contentWindow))&&
this.sendInternal():(b?h=b.iframe:(b=a[f]={},h=b.iframe=c.createElement("iframe"),k.css(h,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(h,c.body||c.documentElement),b=new e.Uri,b.setScheme(n.getScheme()),b.setPort(n.getPort()),b.setHostname(f),b.setPath(m),h.src=b.toString()),i.on(h,"load",d,this))}});return j},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(e,g,i){function k(a,b,d){n||(n=!0,a='<object id="'+c+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+b+"&uid="+d+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',b=h.createElement("div"),i.prepend(b,h.body||h.documentElement),b.innerHTML=a)}function j(a){this.io=a}var d={},c="io_swf",a,h=e.Env.host.document,n=
!1;e.augment(j,{send:function(){var f=this,b=f.io.config;k((b.xdr||{}).src||e.Config.base+"ajax/io.swf",1,1);a?(f._uid=e.guid(),d[f._uid]=f,a.send(b.uri.toString(b.serializeArray),{id:f._uid,uid:f._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){f.send()},200)},abort:function(){a.abort(this._uid)},_xdrResponse:function(a,b){var c,e=b.id,h,g=b.c,i=this.io;if(g&&(h=g.responseText))i.responseText=decodeURI(h);switch(a){case "success":c={status:200,statusText:"success"};delete d[e];
break;case "abort":delete d[e];break;case "timeout":case "transport error":case "failure":delete d[e],c={status:"status"in g?g.status:500,statusText:g.statusText||a}}c&&i._ioReady(c.status,c.statusText)}});g.applyTo=function(a,b,c){var a=b.split(".").slice(1),d=g;e.each(a,function(b){d=d[b]});d.apply(null,c)};g.xdrReady=function(){a=h.getElementById(c)};g.xdrResponse=function(a,b){var c=d[b.uid];c&&c._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(e,g){function i(a,c){try{return new (c||j).XMLHttpRequest}catch(b){}}function k(a){var c;a.ifModified&&(c=a.uri,!1===a.cache&&(c=c.clone(),c.query.remove("_ksTS")),c=c.toString());return c}var j=e.Env.host,d=7<e.UA.ie&&j.XDomainRequest,c={proto:{}},a={},h={};g.__lastModifiedCached=a;g.__eTagCached=h;c.nativeXhr=j.ActiveXObject?function(a,c){var b;if(a&&d)b=new d;else if(!(b=!g.isLocal&&i(a,c)))a:{try{b=new (c||j).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}b=
void 0}return b}:i;c._XDomainRequest=d;e.mix(c.proto,{sendInternal:function(){var c=this,f=c.io,b=f.config,e=c.nativeXhr,g=b.type,i=b.async,j,p=b.crossDomain,t=f.mimeType,f=f.requestHeaders||{},r=b.uri.toString(b.serializeArray),q=k(b),v,u;if(q){if(v=a[q])f["If-Modified-Since"]=v;if(v=h[q])f["If-None-Match"]=v}(j=b.username)?e.open(g,r,i,j,b.password):e.open(g,r,i);if(g=b.xhrFields)for(u in g)e[u]=g[u];t&&e.overrideMimeType&&e.overrideMimeType(t);!p&&!f["X-Requested-With"]&&(f["X-Requested-With"]=
"XMLHttpRequest");try{if(!p)for(u in f)e.setRequestHeader(u,f[u])}catch(w){}e.send(b.hasContent&&b.data||null);!i||4==e.readyState?c._callback():d&&e instanceof d?(e.onload=function(){e.readyState=4;e.status=200;c._callback()},e.onerror=function(){e.readyState=4;e.status=500;c._callback()}):e.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,f){var b=this.nativeXhr,g=this.io,i,j,s,p,t,r=g.config;try{if(f||4==b.readyState)if(d&&b instanceof d?
(b.onerror=e.noop,b.onload=e.noop):b.onreadystatechange=e.noop,f)4!==b.readyState&&b.abort();else{i=k(r);var q=b.status;d&&b instanceof d||(g.responseHeadersString=b.getAllResponseHeaders());i&&(j=b.getResponseHeader("Last-Modified"),s=b.getResponseHeader("ETag"),j&&(a[i]=j),s&&(h[s]=s));if((t=b.responseXML)&&t.documentElement)g.responseXML=t;g.responseText=b.responseText;try{p=b.statusText}catch(v){p=""}!q&&g.isLocal&&!r.crossDomain?q=g.responseText?200:404:1223===q&&(q=204);g._ioReady(q,p)}}catch(u){b.onreadystatechange=
e.noop,f||g._ioReady(-1,u)}}});return c},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(e,g,i,k,j,d){var c=i._XDomainRequest,a=i.nativeXhr();if(a){var h=function(a){var a=a.split("."),b=a.length,c=3<b?3:2;return b<c?a.join("."):a.reverse().slice(0,c).reverse().join(".")},n=function(f){var b=f.config,e=b.crossDomain,g=b.xdr||{},l=g.subDomain=g.subDomain||{};this.io=f;if(e){if(h(location.hostname)==h(b.uri.getHostname())&&!1!==l.proxy)return new k(f);if(!("withCredentials"in a)&&("flash"===""+g.use||!c))return new j(f)}this.nativeXhr=i.nativeXhr(e);
return d};e.augment(n,i.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",n)}return g},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
