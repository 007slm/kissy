/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 8 20:57
*/
KISSY.add("ajax/FormSerializer",function(e,k){var l=/^(?:select|textarea)/i,m=/\r?\n/g,f=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(i){var c=[],b={};e.each(k.query(i),function(a){a=a.elements?e.makeArray(a.elements):[a];c.push.apply(c,a)});c=e.filter(c,function(a){return a.name&&!a.disabled&&(a.checked||l.test(a.nodeName)||f.test(a.type))});e.each(c,function(a){var d=k.val(a);d=e.map(e.makeArray(d),function(j){return j.replace(m,
"\r\n")});a=b[a.name]=b[a.name]||[];a.push.apply(a,d)});return e.param(b,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/IframeTransport",function(e,k,l,m){function f(c){this.xhrObject=c}var i=e.Env.host.document;m.setupConfig({converters:{iframe:m.getConfig().converters.text,text:{iframe:function(c){return c}}}});e.augment(f,{send:function(){var c=this.xhrObject,b=c.config,a,d=k.get(b.form);this.attrs={target:k.attr(d,"target")||"",action:k.attr(d,"action")||""};this.form=d;var j=e.guid("ajax-iframe");c.iframe=k.create("<iframe  id='"+j+"' name='"+j+"' style='position:absolute;left:-9999px;top:-9999px;'/>");
c.iframeId=j;k.prepend(c.iframe,i.body||i.documentElement);k.attr(d,{target:c.iframeId,action:b.url});if(b.data){a=b.data;b=b.serializeArray;a=e.unparam(a);j=[];for(var g in a)for(var n=e.isArray(a[g]),o=e.makeArray(a[g]),p=0;p<o.length;p++){var q=i.createElement("input");q.type="hidden";q.name=g+(n&&b?"[]":"");q.value=o[p];k.append(q,d);j.push(q)}a=j}this.fields=a;l.on(c.iframe,"load error",this._callback,this);d.submit()},_callback:function(c){var b=this.xhrObject;c=c.type;var a=b.iframe;if(a){k.attr(this.form,
this.attrs);if(c=="load"){c=a.contentWindow.document;b.responseXML=c;b.responseText=k.text(c.body);b._xhrReady(200,"success")}else c=="error"&&b._xhrReady(500,"error");k.remove(this.fields);l.detach(a);setTimeout(function(){k.remove(a)},30);b.iframe=null}},abort:function(){this._callback({},1)}});m.setupTransport("iframe",f);return m},{requires:["dom","event","./base"]});
KISSY.add("ajax/ScriptTransport",function(e,k){function l(i){if(!i.config.crossDomain)return new (k.getTransport("*"))(i);this.xhrObj=i;return 0}var m=e.Env.host,f=m.document;k.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(i){e.globalEval(i);return i}}}});e.augment(l,{send:function(){var i=this,c,b=this.xhrObj.config,a=f.head||f.getElementsByTagName("head")[0]||
f.documentElement;i.head=a;c=f.createElement("script");i.script=c;c.async="async";if(b.scriptCharset)c.charset=b.scriptCharset;c.src=b.url;c.onerror=c.onload=c.onreadystatechange=function(d){d=d||m.event;i._callback((d.type||"error").toLowerCase())};a.insertBefore(c,a.firstChild)},_callback:function(i,c){var b=this.script,a=this.xhrObj,d=this.head;if(b)if(c||!b.readyState||/loaded|complete/.test(b.readyState)||i=="error"){b.onerror=b.onload=b.onreadystatechange=null;d&&b.parentNode&&d.removeChild(b);
this.head=this.script=undefined;if(!c&&i!="error")a._xhrReady(200,"success");else i=="error"&&a._xhrReady(500,"scripterror")}},abort:function(){this._callback(0,1)}});k.setupTransport("script",l);return k},{requires:["./base","./XhrTransport"]});
KISSY.add("ajax/SubDomainTransport",function(e,k,l,m){function f(d){var j=d.config;this.xhrObj=d;d=j.url.match(c);this.hostname=d[2];this.protocol=d[1];j.crossDomain=false}function i(){var d=a[this.hostname];d.ready=1;l.detach(d.iframe,"load",i,this);this.send()}var c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,b=e.Env.host.document,a={};e.augment(f,k.proto,{send:function(){var d=this.xhrObj.config,j=this.hostname,g=a[j],n="/sub_domain_proxy.html";if(d.xdr&&d.xdr.subDomain&&d.xdr.subDomain.proxy)n=
d.xdr.subDomain.proxy;if(g&&g.ready)(this.nativeXhr=k.nativeXhr(0,g.iframe.contentWindow))&&this.sendInternal();else{if(g)d=g.iframe;else{g=a[j]={};d=g.iframe=b.createElement("iframe");m.css(d,{position:"absolute",left:"-9999px",top:"-9999px"});m.prepend(d,b.body||b.documentElement);d.src=this.protocol+"//"+j+n}l.on(d,"load",i,this)}}});return f},{requires:["./XhrTransportBase","event","dom"]});
KISSY.add("ajax/XdrFlashTransport",function(e,k,l){function m(j,g,n){if(!d){d=true;j='<object id="'+c+'" type="application/x-shockwave-flash" data="'+j+'" width="0" height="0"><param name="movie" value="'+j+'" /><param name="FlashVars" value="yid='+g+"&uid="+n+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>';g=a.createElement("div");l.prepend(g,a.body||a.documentElement);g.innerHTML=j}}function f(j){this.xhrObj=j}var i={},c="io_swf",b,a=e.Env.host.document,
d=false;e.augment(f,{send:function(){var j=this,g=j.xhrObj.config;m((g.xdr||{}).src||e.Config.base+"ajax/io.swf",1,1);if(b){j._uid=e.guid();i[j._uid]=j;b.send(g.url,{id:j._uid,uid:j._uid,method:g.type,data:g.hasContent&&g.data||{}})}else setTimeout(function(){j.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(j,g){var n,o=this.xhrObj;o.responseText=decodeURI(g.c.responseText);switch(j){case "success":n={status:200,statusText:"success"};delete i[g.id];break;case "abort":delete i[g.id];
break;case "timeout":case "transport error":case "failure":delete i[g.id];n={status:500,statusText:j}}n&&o._xhrReady(n.status,n.statusText)}});k.applyTo=function(j,g,n){j=g.split(".").slice(1);var o=k;e.each(j,function(p){o=o[p]});o.apply(null,n)};k.xdrReady=function(){b=a.getElementById(c)};k.xdrResponse=function(j,g,n){var o=i[g.uid];o&&o._xdrResponse(j,g,n)};return f},{requires:["./base","dom"]});
KISSY.add("ajax/XhrObject",function(e,k){function l(c){var b=c.responseText,a=c.responseXML,d=c.config,j=d.converters,g=c.converters||{},n,o,p=d.contents,q=d.dataType;if(b||a){for(d=c.mimeType||c.getResponseHeader("Content-Type");q[0]=="*";)q.shift();if(!q.length)for(n in p)if(p[n].test(d)){q[0]!=n&&q.unshift(n);break}q[0]=q[0]||"text";if(q[0]=="text"&&b!==k)o=b;else if(q[0]=="xml"&&a!==k)o=a;else e.each(["text","xml"],function(u){var v=q[0];if(g[u]&&g[u][v]||j[u]&&j[u][v]){q.unshift(u);o=u=="text"?
b:a;return false}})}p=q[0];for(d=1;d<q.length;d++){n=q[d];var t=g[p]&&g[p][n]||j[p]&&j[p][n];if(!t)throw"no covert for "+p+" => "+n;o=t(o);p=n}c.responseData=o}function m(c){f.call(this);e.mix(this,{responseData:null,config:c||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new e.Defer(this)})}var f=e.Promise,i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;e.extend(m,f,{setRequestHeader:function(c,
b){this.requestHeaders[c]=b;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(c){var b;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};b=i.exec(this.responseHeadersString);)this.responseHeaders[b[1]]=b[2];b=this.responseHeaders[c]}return b===k?null:b},overrideMimeType:function(c){if(!this.state)this.mimeType=c;return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._xhrReady(0,
c);return this},_xhrReady:function(c,b){if(this.state!=2){this.state=2;this.readyState=4;var a;if(c>=200&&c<300||c==304)if(c==304){b="notmodified";a=true}else try{l(this);b="success";a=true}catch(d){b="parsererror : "+d}else if(c<0)c=0;this.status=c;this.statusText=b;this._defer[a?"resolve":"reject"]([this.responseData,this.statusText,this]);this.transport=k}}});return m});
KISSY.add("ajax/XhrTransport",function(e,k,l,m,f,i){var c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,b=e.Env.host.XDomainRequest,a=l.nativeXhr();if(a){var d=function(g){g=g.split(".");return g.length<2?g.join("."):g.reverse().slice(0,2).reverse().join(".")},j=function(g){var n=g.config,o=n.xdr||{};if(n.crossDomain){n=n.url.match(c);if(d(location.hostname)==d(n[2]))return new m(g);if(!("withCredentials"in a)&&(String(o.use)==="flash"||!b))return new f(g)}this.xhrObj=g;return i};e.augment(j,l.proto,
{send:function(){this.nativeXhr=l.nativeXhr(this.xhrObj.config.crossDomain);this.sendInternal()}});k.setupTransport("*",j)}return k},{requires:["./base","./XhrTransportBase","./SubDomainTransport","./XdrFlashTransport"]});
KISSY.add("ajax/XhrTransportBase",function(e,k){function l(c,b){try{return new (b||m).XMLHttpRequest}catch(a){}}var m=e.Env.host,f=m.XDomainRequest,i={proto:{}};i.nativeXhr=m.ActiveXObject?function(c,b){if(c&&f)return new f;var a;if(!(a=!k.isLocal&&l(c,b)))a:{try{a=new (b||m).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}a=void 0}return a}:l;e.mix(i.proto,{sendInternal:function(){var c=this,b=c.xhrObj,a=b.config,d=c.nativeXhr,j,g;a.username?d.open(a.type,a.url,a.async,a.username,a.password):
d.open(a.type,a.url,a.async);if(j=a.xhrFields)for(g in j)if(j.hasOwnProperty(g))d[g]=j[g];b.mimeType&&d.overrideMimeType&&d.overrideMimeType(b.mimeType);if(!a.crossDomain&&!b.requestHeaders["X-Requested-With"])b.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!a.crossDomain)for(g in b.requestHeaders)d.setRequestHeader(g,b.requestHeaders[g])}catch(n){}d.send(a.hasContent&&a.data||null);if(!a.async||d.readyState==4)c._callback();else if(f&&d instanceof f){d.onload=function(){d.readyState=
4;d.status=200;c._callback()};d.onerror=function(){d.readyState=4;d.status=500;c._callback()}}else d.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,b){try{var a=this.nativeXhr,d=this.xhrObj,j=d.config;if(b||a.readyState==4){if(f&&a instanceof f){a.onerror=e.noop;a.onload=e.noop}else a.onreadystatechange=e.noop;if(b)a.readyState!==4&&a.abort();else{var g=a.status;if(!(f&&a instanceof f))d.responseHeadersString=a.getAllResponseHeaders();var n=
a.responseXML;if(n&&n.documentElement)d.responseXML=n;d.responseText=a.responseText;try{var o=a.statusText}catch(p){o=""}if(!g&&k.isLocal&&!j.crossDomain)g=d.responseText?200:404;else if(g===1223)g=204;d._xhrReady(g,o)}}}catch(q){a.onreadystatechange=e.noop;b||d._xhrReady(-1,q)}}});return i},{requires:["./base"]});
KISSY.add("ajax",function(e,k,l,m){function f(c,b,a,d,j){if(e.isFunction(b)){d=a;a=b;b=i}return l({type:j||"get",url:c,data:b,success:a,dataType:d})}var i=undefined;e.mix(l,{XhrObject:m,serialize:k.serialize,get:f,post:function(c,b,a,d){if(e.isFunction(b)){d=a;a=b;b=i}return f(c,b,a,d,"post")},jsonp:function(c,b,a){if(e.isFunction(b)){a=b;b=i}return f(c,b,a,"jsonp")},getScript:e.getScript,getJSON:function(c,b,a){if(e.isFunction(b)){a=b;b=i}return f(c,b,a,"json")},upload:function(c,b,a,d,j){if(e.isFunction(a)){j=
d;d=a;a=i}return l({url:c,type:"post",dataType:j,form:b,data:a,success:d})}});e.mix(e,{Ajax:l,IO:l,ajax:l,io:l,jsonp:l.jsonp});return l},{requires:["ajax/FormSerializer","ajax/base","ajax/XhrObject","ajax/XhrTransport","ajax/ScriptTransport","ajax/jsonp","ajax/form","ajax/IframeTransport"]});
KISSY.add("ajax/base",function(e,k,l,m,f){function i(h){var s=h.context;delete h.context;h=e.mix(e.clone(w),h||{},f,f,true);h.context=s;if(!("crossDomain"in h)){s=d.exec(h.url.toLowerCase());h.crossDomain=!!(s&&(s[1]!=t[1]||s[2]!=t[2]||(s[3]||(s[1]==="http:"?g:n))!=(t[3]||(t[1]==="http:"?g:n))))}if(h.processData&&h.data&&!e.isString(h.data))h.data=e.param(h.data,f,f,h.serializeArray);h.url=h.url.replace(/^\/\//,t[1]+"//");h.type=h.type.toUpperCase();h.hasContent=!o.test(h.type);h.dataType=e.trim(h.dataType||
"*").split(a);if(!("cache"in h)&&e.inArray(h.dataType[0],["script","jsonp"]))h.cache=false;if(!h.hasContent){if(h.data){h.url+=(/\?/.test(h.url)?"&":"?")+h.data;delete h.data}if(h.cache===false)h.url+=(/\?/.test(h.url)?"&":"?")+"_ksTS="+(e.now()+"_"+e.guid())}h.context=h.context||h;return h}function c(h,s){b.fire(h,{ajaxConfig:s.config,xhr:s})}function b(h){function s(z){return function(D){if(r.timeoutTimer){clearTimeout(r.timeoutTimer);r.timeoutTimer=0}var A=h[z];A&&A.apply(h.context,D);c(z,r)}}
if(!h.url)return f;h=i(h);var r=new m(h);c("start",r);var B=new (v[h.dataType[0]]||v["*"])(r);r.transport=B;h.contentType&&r.setRequestHeader("Content-Type",h.contentType);var x=h.dataType[0],y=h.accepts;r.setRequestHeader("Accept",x&&y[x]?y[x]+(x==="*"?"":", */*; q=0.01"):y["*"]);for(var C in h.headers)r.setRequestHeader(C,h.headers[C]);r.then(s("success"),s("error"));r.fin(s("complete"));r.readyState=1;c("send",r);if(h.async&&h.timeout>0)r.timeoutTimer=setTimeout(function(){r.abort("timeout")},
h.timeout*1E3);try{r.state=1;B.send()}catch(E){r.state<2&&r._xhrReady(-1,E)}return r}var a=/\s+/,d=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,j=function(h){return h},g=80,n=443,o=/^(?:GET|HEAD)$/,p,q=e.Env.host.document,t;try{p=location.href}catch(u){p=q.createElement("a");p.href="";p=p.href}t=d.exec(p);p=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(t[1]);var v={},w={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,
accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:k.parse,html:j,text:j,xml:e.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};w.converters.html=w.converters.text;e.mix(b,l.Target);e.mix(b,{isLocal:p,setupConfig:function(h){e.mix(w,h,f,f,true)},setupTransport:function(h,s){v[h]=s},getTransport:function(h){return v[h]},getConfig:function(){return w}});return b},{requires:["json","event","./XhrObject"]});
KISSY.add("ajax/form",function(e,k,l,m){k.on("start",function(f){f=f.xhr.config;if(f.form){var i=l.get(f.form);if((i.encoding||i.enctype).toLowerCase()!="multipart/form-data"){if(i=m.serialize(i))if(f.hasContent){f.data=f.data||"";if(f.data)f.data+="&";f.data+=i}else f.url+=(/\?/.test(f.url)?"&":"?")+i}else{i=f.dataType[0];if(i=="*")i="text";f.dataType.length=2;f.dataType[0]="iframe";f.dataType[1]=i}}});return k},{requires:["./base","dom","./FormSerializer"]});
KISSY.add("ajax/jsonp",function(e,k){var l=e.Env.host;k.setupConfig({jsonp:"callback",jsonpCallback:function(){return e.guid("jsonp")}});k.on("start",function(m){m=m.xhr;var f=m.config;if(f.dataType[0]=="jsonp"){var i,c=f.jsonpCallback,b=e.isFunction(c)?c():c,a=l[b];f.url+=(/\?/.test(f.url)?"&":"?")+f.jsonp+"="+b;l[b]=function(d){if(arguments.length>1)d=e.makeArray(arguments);i=[d]};m.fin(function(){l[b]=a;if(a===undefined)try{delete l[b]}catch(d){}else i&&a(i[0])});m.converters=m.converters||{};
m.converters.script=m.converters.script||{};m.converters.script.json=function(){return i[0]};f.dataType.length=2;f.dataType[0]="script";f.dataType[1]="json"}});return k},{requires:["./base"]});
