/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("ajax/impl",function(f,t,G,u){function i(a){a=f.merge(H,a);if(!a.url)return u;if(a.data&&!f.isString(a.data))a.data=f.param(a.data);a.context=a.context||a;var b,c=l,g,e=a.type.toUpperCase();if(a.dataType===v){b=a.jsonpCallback||v+f.now();a.url=z(a.url,a.jsonp+"="+b);a.dataType=A;var m=h[b];h[b]=function(j){if(f.isFunction(m))m(j);else{h[b]=u;try{delete h[b]}catch(I){}}n([l,o],j,c,d,a)}}if(a.data&&e===w)a.url=z(a.url,a.data);if(a.dataType===A){k(B,a);e=f.getScript(a.url,b?null:function(){n([l,
o],r,c,d,a)});k(C,a);return e}var p=false,d=a.xhr();k(B,a);d.open(e,a.url,a.async);try{if(a.data||a.contentType)d.setRequestHeader(D,a.contentType);d.setRequestHeader("Accept",a.dataType&&a.accepts[a.dataType]?a.accepts[a.dataType]+", */*; q=0.01":a.accepts._default)}catch(M){}d.onreadystatechange=function(j){if(!d||d.readyState===0||j==="abort"){p||n(o,null,q,d,a);p=true;if(d)d.onreadystatechange=E}else if(!p&&d&&(d.readyState===4||j===s)){p=true;d.onreadystatechange=E;c=j===s?s:J(d)?l:q;try{g=K(d,
a.dataType)}catch(I){c=x}n([c===l?l:q,o],g,c,d,a);if(j===s){d.abort();k(L,a)}if(a.async)d=null}};k(C,a);try{d.send(e===F?a.data:null)}catch(N){n([q,o],g,q,d,a)}a.async||k(o,a);return d}function J(a){try{return a.status>=200&&a.status<300||a.status===304||a.status===1223}catch(b){}return false}function z(a,b){return a+(a.indexOf("?")===-1?"?":"&")+b}function n(a,b,c,g,e){if(f.isArray(a))f.each(a,function(m){n(m,b,c,g,e)});else{c===a&&e[a]&&e[a].call(e.context,b,c,g);k(a,e)}}function k(a,b){i.fire(a,
{ajaxConfig:b})}function K(a,b){var c=r,g,e=a;if(!f.isString(e)){c=a.getResponseHeader(D)||r;e=(g=b==="xml"||!b&&c.indexOf("xml")>=0)?a.responseXML:a.responseText;if(g&&e.documentElement.nodeName===x)throw x;}if(f.isString(e))if(b===y||!b&&c.indexOf(y)>=0)e=G.parse(e);return e}var h=window,E=function(){},w="GET",F="POST",D="Content-Type",y="json",v=y+"p",A="script",r="",B="start",C="send",L="stop",l="success",o="complete",q="error",s="timeout",x="parsererror",H={type:w,url:r,contentType:"application/x-www-form-urlencoded",
async:true,data:null,xhr:h.ActiveXObject?function(){if(h.XmlHttpRequest)try{return new h.XMLHttpRequest}catch(a){}try{return new h.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}:function(){return new h.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},jsonp:"callback"};f.mix(i,t.Target);f.mix(i,{get:function(a,b,c,g,e){if(f.isFunction(b)){g=c;c=b}return i({type:e||
w,url:a,data:b,success:function(m,p,d){c&&c.call(this,m,p,d)},dataType:g})},post:function(a,b,c,g){if(f.isFunction(b)){g=c;c=b;b=u}return i.get(a,b,c,g,F)},jsonp:function(a,b,c){if(f.isFunction(b)){c=b;b=null}return i.get(a,b,c,v)}});return i},{requires:["event","json"]});KISSY.add("ajax",function(f,t){return t},{requires:["ajax/impl"]});
