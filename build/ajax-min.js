/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 8 11:44
*/
KISSY.add("ajax/base",function(h,j,l,k){function d(g){g=h.mix(h.clone(u),g||{},undefined,undefined,true);if(!h.isBoolean(g.crossDomain)){var n=e.exec(g.url.toLowerCase());g.crossDomain=!!(n&&(n[1]!=r[1]||n[2]!=r[2]||(n[3]||(n[1]==="http:"?m:p))!=(r[3]||(r[1]==="http:"?m:p))))}if(g.processData&&g.data&&!h.isString(g.data))g.data=h.param(g.data,undefined,undefined,g.serializeArray);g.type=g.type.toUpperCase();g.hasContent=!q.test(g.type);if(!g.hasContent){if(g.data)g.url+=(/\?/.test(g.url)?"&":"?")+
g.data;if(g.cache===false)g.url+=(/\?/.test(g.url)?"&":"?")+"_ksTS="+(h.now()+"_"+h.guid())}g.dataType=h.trim(g.dataType||"*").split(a);g.context=g.context||g;return g}function b(g,n){f.fire(g,{ajaxConfig:n.config,xhr:n})}function c(g){var n=this.config;g=g.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);n[g]&&n[g].call(n.context,this.responseData,this.statusText,this);b(g,this)}function f(g){if(g.url){g=d(g);var n=new k(g);b("start",n);var x=new (t[g.dataType[0]]||t["*"])(n);n.transport=
x;g.contentType&&n.setRequestHeader("Content-Type",g.contentType);var v=g.dataType[0],w=g.accepts;n.setRequestHeader("Accept",v&&w[v]?w[v]+(v==="*"?"":", */*; q=0.01"):w["*"]);for(var y in g.headers)n.setRequestHeader(y,g.headers[y]);n.on("complete success error",c);n.readyState=1;b("send",n);if(g.async&&g.timeout>0)n.timeoutTimer=setTimeout(function(){n.abort("timeout")},g.timeout);try{n.state=1;x.send()}catch(z){n.status<2&&n.callback(-1,z)}return n}}var a=/\s+/,e=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
i=function(g){return g},m=80,p=443,q=/^(?:GET|HEAD)$/,o,r;try{o=location.href}catch(s){o=document.createElement("a");o.href="";o=o.href}r=e.exec(o);o=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(r[1]);var t={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:j.parse,
html:i,text:i,xml:h.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;h.mix(f,l.Target);h.mix(f,{isLocal:o,setupConfig:function(g){h.mix(u,g,undefined,undefined,true)},setupTransport:function(g,n){t[g]=n},getTransport:function(g){return t[g]},getConfig:function(){return u}});return f},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(h,j){var l=/^(?:select|textarea)/i,k=/\r?\n/g,d=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(b){var c=[],f={};j.query(b).each(function(a){a=a.elements?h.makeArray(a.elements):[a];c.push.apply(c,a)});c=h.filter(c,function(a){return a.name&&!a.disabled&&(a.checked||l.test(a.nodeName)||d.test(a.type))});h.each(c,function(a){var e=j.val(a);e=h.map(h.makeArray(e),function(i){return i.replace(k,
"\r\n")});a=f[a.name]=f[a.name]||[];a.push.apply(a,e)});return h.param(f,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(h,j,l,k){j.on("start",function(d){d=d.xhr.config;if(d.form){var b=l.get(d.form);if((b.encoding||b.enctype).toLowerCase()!="multipart/form-data"){if(b=k.serialize(b))if(d.hasContent){d.data=d.data||"";if(d.data)d.data+="&";d.data+=b}else d.url+=(/\?/.test(d.url)?"&":"?")+b}else{b=d.dataType[0];if(b=="*")b="text";d.dataType.length=2;d.dataType[0]="iframe";d.dataType[1]=b}}});return j},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(h,j,l,k){function d(c){this.xhr=c}var b=document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(c){return c}}}});h.augment(d,{send:function(){var c=this.xhr,f=c.config,a,e=j.get(f.form);this.attrs={target:j.attr(e,"target")||"",action:j.attr(e,"action")||""};this.form=e;var i=h.guid("ajax-iframe");c.iframe=j.create("<iframe  id='"+i+"' name='"+i+"' style='position:absolute;left:-9999px;top:-9999px;'/>");c.iframeId=i;j.prepend(c.iframe,
b.body||b.documentElement);j.attr(e,{target:c.iframeId,action:f.url});if(f.data){a=f.data;f=f.serializeArray;a=h.unparam(a);i=[];for(var m in a)for(var p=h.isArray(a[m]),q=h.makeArray(a[m]),o=0;o<q.length;o++){var r=b.createElement("input");r.type="hidden";r.name=m+(p&&f?"[]":"");r.value=q[o];j.append(r,e);i.push(r)}a=i}this.fields=a;l.on(c.iframe,"load error",this._callback,this);e.submit()},_callback:function(c){var f=this.xhr;c=c.type;var a=f.iframe;if(a){j.attr(this.form,this.attrs);if(c=="load"){c=
a.contentWindow.document;f.responseXML=c;f.responseText=j.text(c.body);f.callback(200,"success")}else c=="error"&&f.callback(500,"error");j.remove(this.fields);l.detach(a);setTimeout(function(){j.remove(a)},30);f.iframe=null}},abort:function(){this._callback(0,1)}});k.setupTransport("iframe",d);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(h,j){j.setupConfig({jsonp:"callback",jsonpCallback:function(){return h.guid("jsonp")}});j.on("start",function(l){l=l.xhr;var k=l.config;if(k.dataType[0]=="jsonp"){var d,b=k.jsonpCallback,c=h.isFunction(b)?b():b,f=window[c];k.url+=(/\?/.test(k.url)?"&":"?")+k.jsonp+"="+c;window[c]=function(a){if(arguments.length>1)a=h.makeArray(arguments);d=[a]};l.on("complete",function(){window[c]=f;if(f===undefined)try{delete window[c]}catch(a){}else d&&f(d[0])});l.converters=l.converters||
{};l.converters.script=l.converters.script||{};l.converters.script.json=function(){return d[0]};k.dataType.length=2;k.dataType[0]="script";k.dataType[1]="json"}});return j},{requires:["./base"]});
KISSY.add("ajax/script",function(h,j){function l(d){if(!d.config.crossDomain&&!d.config.forceScript)return new (j.getTransport("*"))(d);this.xhrObj=d;return 0}var k=document;j.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){h.globalEval(d);return d}}}});h.augment(l,{send:function(){var d=this,b,c=this.xhrObj.config,f=k.head||k.getElementsByTagName("head")[0]||
k.documentElement;d.head=f;b=k.createElement("script");d.script=b;b.async="async";if(c.scriptCharset)b.charset=c.scriptCharset;b.src=c.url;b.onerror=b.onload=b.onreadystatechange=function(a){a=a||window.event;d._callback((a.type||"error").toLowerCase())};f.insertBefore(b,f.firstChild)},_callback:function(d,b){var c=this.script,f=this.xhrObj,a=this.head;if(c)if(b||!c.readyState||/loaded|complete/.test(c.readyState)||d=="error"){c.onerror=c.onload=c.onreadystatechange=null;a&&c.parentNode&&a.removeChild(c);
this.head=this.script=undefined;if(!b&&d!="error")f.callback(200,"success");else d=="error"&&f.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});j.setupTransport("script",l);return j},{requires:["./base","./xhr"]});
KISSY.add("ajax/xdr",function(h,j){function l(a,e,i){if(!f){f=true;a='<object id="'+b+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+e+"&uid="+i+'&host=KISSY.io" /><param name="allowScriptAccess" value="always" /></object>';e=document.createElement("div");document.body.appendChild(e);e.innerHTML=a}}function k(a){this.xhrObj=a}var d={},b="io_swf",c,f=false;h.augment(k,{send:function(){var a=this,e=a.xhrObj.config;
l((e.xdr||{}).src||h.Config.base+"ajax/io.swf",1,1);if(c){a._uid=h.guid();d[a._uid]=a;c.send(e.url,{id:a._uid,uid:a._uid,method:e.type,data:e.hasContent&&e.data||{}})}else setTimeout(function(){a.send()},200)},abort:function(){c.abort(this._uid)},_xdrResponse:function(a,e){var i,m=this.xhrObj;m.responseText=decodeURI(e.c.responseText);switch(a){case "success":i={status:200,statusText:"success"};delete d[e.id];break;case "abort":delete d[e.id];break;case "timeout":case "transport error":case "failure":delete d[e.id];
i={status:500,statusText:a}}i&&m.callback(i.status,i.statusText)}});j.applyTo=function(a,e,i){a=e.split(".");var m=h;h.each(a,function(p){m=m[p]});m.apply(null,i)};j.xdrReady=function(){c=document.getElementById(b)};j.xdrResponse=function(a,e,i){var m=d[e.uid];m&&m._xdrResponse(a,e,i)};h.io=j;return k},{requires:["./base"]});
KISSY.add("ajax/xhr",function(h,j,l){function k(){try{return new window.XMLHttpRequest}catch(f){}}var d=window.XDomainRequest;j.xhr=window.ActiveXObject?function(f){if(f&&d)return new d;if(!(f=!j.isLocal&&k()))a:{try{f=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(a){}f=void 0}return f}:k;var b=j.xhr();if(b){var c=function(f){var a=f.config.xdr||{};if(!("withCredentials"in b)&&(String(a.use)==="flash"||!d))return new l(f);this.xhrObj=f};h.augment(c,{send:function(){var f=this,a=f.xhrObj,
e=a.config,i=j.xhr(e.crossDomain),m,p;f.xhr=i;e.username?i.open(e.type,e.url,e.async,e.username,e.password):i.open(e.type,e.url,e.async);if(m=e.xhrFields)for(p in m)i[p]=m[p];a.mimeType&&i.overrideMimeType&&i.overrideMimeType(a.mimeType);if(!e.crossDomain&&!a.requestHeaders["X-Requested-With"])a.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!e.crossDomain)for(p in a.requestHeaders)i.setRequestHeader(p,a.requestHeaders[p])}catch(q){}i.send(e.hasContent&&e.data||null);if(!e.async||i.readyState==
4)f._callback();else if(d&&i instanceof d){i.onload=function(){i.readyState=4;i.status=200;f._callback()};i.onerror=function(){i.readyState=4;i.status=500;f._callback()}}else i.onreadystatechange=function(){f._callback()}},abort:function(){this._callback(0,1)},_callback:function(f,a){try{var e=this.xhr,i=this.xhrObj,m=i.config;if(a||e.readyState==4){e.onreadystatechange=h.noop;e.onload=h.noop;e.onerror=h.noop;if(a)e.readyState!==4&&e.abort();else{var p=e.status;if(e.getAllResponseHeaders)i.responseHeadersString=
e.getAllResponseHeaders();var q=e.responseXML;if(q&&q.documentElement)i.responseXML=q;i.responseText=e.responseText;try{var o=e.statusText}catch(r){o=""}if(!p&&j.isLocal&&!m.crossDomain)p=i.responseText?200:404;else if(p===1223)p=204;i.callback(p,o)}}}catch(s){e.onreadystatechange=h.noop;a||i.callback(-1,s)}}});j.setupTransport("*",c);return j}},{requires:["./base","./xdr"]});
KISSY.add("ajax/xhrobject",function(h,j){function l(b){var c=b.responseText,f=b.responseXML,a=b.config,e=a.converters,i=b.converters||{},m,p,q=a.contents,o=a.dataType;if(c||f){for(a=b.mimeType||b.getResponseHeader("Content-Type");o[0]=="*";)o.shift();if(!o.length)for(m in q)if(q[m].test(a)){o[0]!=m&&o.unshift(m);break}o[0]=o[0]||"text";if(o[0]=="text"&&c!==undefined)p=c;else if(o[0]=="xml"&&f!==undefined)p=f;else h.each(["text","xml"],function(s){var t=o[0];if(i[s]&&i[s][t]||e[s]&&e[s][t]){o.unshift(s);
p=s=="text"?c:f;return false}})}q=o[0];for(a=1;a<o.length;a++){m=o[a];var r=i[q]&&i[q][m]||e[q]&&e[q][m];if(!r)throw"no covert for "+q+" => "+m;p=r(p);q=m}b.responseData=p}function k(b){h.mix(this,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var d=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;h.augment(k,j.Target,{setRequestHeader:function(b,c){this.requestHeaders[b]=
c;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(b){var c;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};c=d.exec(this.responseHeadersString);)this.responseHeaders[c[1]]=c[2];c=this.responseHeaders[b]}return c===undefined?null:c},overrideMimeType:function(b){if(!this.state)this.mimeType=b;return this},abort:function(b){b=b||"abort";this.transport&&this.transport.abort(b);this.callback(0,b);return this},
callback:function(b,c){if(this.state!=2){this.state=2;this.readyState=4;var f;if(b>=200&&b<300||b==304)if(b==304){c="notmodified";f=true}else try{l(this);c="success";f=true}catch(a){c="parsererror : "+a}else if(b<0)b=0;this.status=b;this.statusText=c;f?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return k},{requires:["event"]});
KISSY.add("ajax",function(h,j,l){h.mix(l,{serialize:j.serialize,get:function(k,d,b,c,f){if(h.isFunction(d)){c=b;b=d;d=undefined}return l({type:f||"get",url:k,data:d,success:b,dataType:c})},post:function(k,d,b,c){if(h.isFunction(d)){c=b;b=d;d=undefined}return l.get(k,d,b,c,"post")},jsonp:function(k,d,b){if(h.isFunction(d)){b=d;d=undefined}return l.get(k,d,b,"jsonp")},getScript:h.getScript,getJSON:function(k,d,b){if(h.isFunction(d)){b=d;d=undefined}return l.get(k,d,b,"json")},upload:function(k,d,b,
c,f){if(h.isFunction(b)){f=c;c=b;b=undefined}return l({url:k,type:"post",dataType:f,form:d,data:b,success:c})}});return l},{requires:["ajax/form-serializer","ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
