/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 28 16:50
*/
KISSY.add("ajax",function(c,h,l){function k(g,f,e,b,d){c.isFunction(f)&&(b=e,e=f,f=j);return l({type:d||"get",url:g,data:f,success:e,dataType:b})}var j=void 0;c.mix(l,{serialize:h.serialize,get:k,post:function(g,f,e,b){c.isFunction(f)&&(b=e,e=f,f=j);return k(g,f,e,b,"post")},jsonp:function(g,f,e){c.isFunction(f)&&(e=f,f=j);return k(g,f,e,"jsonp")},getScript:c.getScript,getJSON:function(g,f,e){c.isFunction(f)&&(e=f,f=j);return k(g,f,e,"json")},upload:function(g,f,e,b,d){c.isFunction(e)&&(d=b,b=e,e=
j);return l({url:g,type:"post",dataType:d,form:f,data:e,success:b})}});c.mix(c,{Ajax:l,IO:l,ajax:l,io:l,jsonp:l.jsonp});return l},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(c,h,l,k){function j(a){var d=a.context,g=a.ifModified;delete a.context;a=c.mix(c.clone(s),a,{deep:!0});a.context=d||a;var e,f=a.type,o=a.dataType,j;j=a.query=new c.Uri.Query;d=a.uri=m.resolve(a.url);"crossDomain"in a||(a.crossDomain=!a.uri.hasSameDomainAs(m));if(a.processData&&(e=a.data))c.isObject(e)?j.add(e):j.reset(e);f=a.type=f.toUpperCase();a.hasContent=!i.test(f);o=a.dataType=c.trim(o||"*").split(b);!("cache"in a)&&c.inArray(o[0],["script","jsonp"])&&(a.cache=
!1);var h;a.hasContent||(j.count()&&d.query.add(j),g&&(h=d.clone()),!1===a.cache&&d.query.set("_ksTS",c.now()+"_"+c.guid()));g&&(a.ifModifiedKeyUri=h||d.clone());return a}function g(a,b){f.fire(a,{ajaxConfig:b.config,xhr:b,io:b})}function f(b){function i(a){return function(i){if(h=d.timeoutTimer)clearTimeout(h),d.timeoutTimer=0;var e=b[a];e&&e.apply(v,i);g(a,d)}}var d=this;if(!b.url)return k;if(!(d instanceof f))return new f(b);a.call(d);b=j(b);c.mix(d,{responseData:null,config:b||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)});var e;g("start",d);e=new (n[b.dataType[0]]||n["*"])(d);d.transport=e;b.contentType&&d.setRequestHeader("Content-Type",b.contentType);var o=b.dataType[0],h,q,l=b.timeout,v=b.context,p=b.headers,r=b.accepts;d.setRequestHeader("Accept",o&&r[o]?r[o]+("*"===o?"":", */*; q=0.01"):r["*"]);for(q in p)d.setRequestHeader(q,
p[q]);if(b.beforeSend&&!1===b.beforeSend.call(v,d,b))return k;d.then(i("success"),i("error"));d.fin(i("complete"));d.readyState=1;g("send",d);b.async&&0<l&&(d.timeoutTimer=setTimeout(function(){d.abort("timeout")},1E3*l));try{d.state=1,e.send()}catch(m){2>d.state&&d._ioReady(-1,m)}return k}var e=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,b=/\s+/,d=function(a){return a},a=c.Promise,i=/^(?:GET|HEAD)$/,o,v=c.Uri,q=c.Env.host,p=q.document,q=q.location,m;if(q){try{o=q.href}catch(r){o=p.createElement("a"),
o.href="",o=o.href}m=new v(o)}var e=m&&e.test(m.getScheme()),n={},s={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:h.parse,html:d,text:d,xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};s.converters.html=s.converters.text;c.mix(f,l.Target);c.mix(f,{isLocal:e,setupConfig:function(a){c.mix(s,
a,{deep:!0})},setupTransport:function(a,b){n[a]=b},getTransport:function(a){return n[a]},getConfig:function(){return s}});return f},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(c,h){function l(e){return e.replace(j,"\r\n")}var k=/^(?:select|textarea)/i,j=/\r?\n/g,g,f=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return g={serialize:function(e,b){return c.param(g.getFormData(e),void 0,void 0,b||!1)},getFormData:function(e){var b=[],d={};c.each(h.query(e),function(a){a=a.elements?c.makeArray(a.elements):[a];b.push.apply(b,a)});b=c.filter(b,function(a){return a.name&&!a.disabled&&
(a.checked||k.test(a.nodeName)||f.test(a.type))});c.each(b,function(a){var b=h.val(a),e,b=c.isArray(b)?c.map(b,l):l(b);(e=d[a.name])?(e&&!c.isArray(e)&&(e=d[a.name]=[e]),e.push.apply(e,c.makeArray(b))):d[a.name]=b});return d}}},{requires:["dom"]});
KISSY.add("ajax/form",function(c,h,l,k){h.on("start",function(c){var g,f,c=c.io.config;if(g=c.form)g=l.get(g),f=g.encoding||g.enctype,"multipart/form-data"!=f.toLowerCase()?(g=k.getFormData(g),c.hasContent?c.query.add(g):(c.uri.query.add(g),c.ifModifiedKeyUri&&c.ifModifiedKeyUri.query.add(g))):(g=c.dataType,c=g[0],"*"==c&&(c="text"),g.length=2,g[0]="iframe",g[1]=c)});return h},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(c,h,l,k){function j(b){var d=c.guid("ajax-iframe"),a=h.getEmptyIframeSrc(),b=b.iframe=h.create("<iframe "+(a?' src="'+a+'" ':"")+' id="'+d+'" name="'+d+'" style="position:absolute;left:-9999px;top:-9999px;"/>');h.prepend(b,e.body||e.documentElement);return b}function g(b,d,a){var i=[],g,f,j,l,k=b.keys();c.each(k,function(k){var n=b.get(k);g=c.isArray(n);f=c.makeArray(n);for(j=0;j<f.length;j++)l=e.createElement("input"),l.type="hidden",l.name=k+(g&&a?"[]":
""),l.value=f[j],h.append(l,d),i.push(l)});return i}function f(b){this.io=b}var e=c.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(b){return b}},xml:{iframe:function(b){return b}}}});c.augment(f,{send:function(){function b(){l.on(f,"load error",d._callback,d);p.submit()}var d=this,a=d.io,i=a.config,e,f,k=i.query,p=h.get(i.form);d.attrs={target:h.attr(p,"target")||"",action:h.attr(p,"action")||"",method:h.attr(p,"method")};d.form=p;f=j(a);h.attr(p,
{target:f.id,action:i.uri.toString(i.serializeArray),method:"post"});k.count()&&(e=g(k,p,i.serializeArray));d.fields=e;6==c.UA.ie?setTimeout(b,0):b()},_callback:function(b){var d=this.io,b=b.type,a,i=d.iframe;if(i)if(h.attr(this.form,this.attrs),h.remove(this.fields),l.detach(i),setTimeout(function(){h.remove(i)},30),d.iframe=null,"load"==b)try{if((a=i.contentWindow.document)&&a.body)d.responseText=c.trim(h.text(a.body)),c.startsWith(d.responseText,"<?xml")&&(d.responseText=void 0);d.responseXML=
a&&a.XMLDocument?a.XMLDocument:a;a?d._ioReady(200,"success"):d._ioReady(500,"parser error")}catch(e){d._ioReady(500,"parser error")}else"error"==b&&d._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",f);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(c,h){var l=c.Env.host;h.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});h.on("start",function(h){var j=h.io,g=j.config,h=g.dataType;if("jsonp"==h[0]){var f,e=g.jsonpCallback,b=c.isFunction(e)?e():e,d=l[b];g.uri.query.set(g.jsonp,b);l[b]=function(a){1<arguments.length&&(a=c.makeArray(arguments));f=[a]};j.fin(function(){l[b]=d;if(void 0===d)try{delete l[b]}catch(a){}else f&&d(f[0])});j=j.converters=j.converters||{};j.script=j.script||
{};j.script.json=function(){return f[0]};h.length=2;h[0]="script";h[1]="json"}});return h},{requires:["./base"]});
KISSY.add("ajax/methods",function(c,h,l){function k(g){var f=g.responseText,e=g.responseXML,b=g.config,d=b.converters,a=g.converters||{},i,h,j=b.contents,k=b.dataType;if(f||e){for(b=g.mimeType||g.getResponseHeader("Content-Type");"*"==k[0];)k.shift();if(!k.length)for(i in j)if(j[i].test(b)){k[0]!=i&&k.unshift(i);break}k[0]=k[0]||"text";if("text"==k[0]&&f!==l)h=f;else if("xml"==k[0]&&e!==l)h=e;else{var p={text:f,xml:e};c.each(["text","xml"],function(b){var i=k[0];if((a[b]&&a[b][i]||d[b]&&d[b][i])&&
p[b])return k.unshift(b),h="text"==b?f:e,!1})}}j=k[0];for(b=1;b<k.length;b++){i=k[b];var m=a[j]&&a[j][i]||d[j]&&d[j][i];if(!m)throw"no covert for "+j+" => "+i;h=m(h);j=i}g.responseData=h}var j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;c.extend(h,c.Promise,{setRequestHeader:function(c,f){this.requestHeaders[c]=f;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var f,e;if(2===this.state){if(!(e=this.responseHeaders))for(e=this.responseHeaders=
{};f=j.exec(this.responseHeadersString);)e[f[1]]=f[2];f=e[c]}return f===l?null:f},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;if(c=this.transport)return c.nativeXhr},_ioReady:function(c,f){if(2!=this.state){this.state=2;this.readyState=4;var e;if(200<=c&&300>c||304==c)if(304==c)f="not modified",e=!0;else try{k(this),f="success",e=!0}catch(b){f=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=f;this._defer[e?"resolve":"reject"]([this.responseData,f,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(c,h,l,k){function j(c){if(!c.config.crossDomain)return new (h.getTransport("*"))(c);this.io=c;return 0}var g=c.Env.host,f=g.document;h.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){c.globalEval(e);return e}}}});c.augment(j,{send:function(){var c=this,b,d=c.io.config,a=f.head||f.getElementsByTagName("head")[0]||
f.documentElement;c.head=a;b=f.createElement("script");c.script=b;b.async=!0;d.scriptCharset&&(b.charset=d.scriptCharset);b.src=d.uri.toString(d.serializeArray);b.onerror=b.onload=b.onreadystatechange=function(a){a=a||g.event;c._callback((a.type||"error").toLowerCase())};a.insertBefore(b,a.firstChild)},_callback:function(c,b){var d=this.script,a=this.io,i=this.head;if(d&&(b||!d.readyState||/loaded|complete/.test(d.readyState)||"error"==c))d.onerror=d.onload=d.onreadystatechange=null,i&&d.parentNode&&
i.removeChild(d),this.head=this.script=k,!b&&"error"!=c?a._ioReady(200,"success"):"error"==c&&a._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});h.setupTransport("script",j);return h},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(c,h,l,k){function j(b){var c=b.config;this.io=b;c.crossDomain=!1}function g(){var b=this.io.config.uri.getHostname(),b=e[b];b.ready=1;l.detach(b.iframe,"load",g,this);this.send()}var f=c.Env.host.document,e={};c.augment(j,h.proto,{send:function(){var b=this.io.config,d=b.uri,a=d.getHostname(),i;i=e[a];var j="/sub_domain_proxy.html";b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(j=b.xdr.subDomain.proxy);i&&i.ready?(this.nativeXhr=h.nativeXhr(0,i.iframe.contentWindow))&&
this.sendInternal():(i?b=i.iframe:(i=e[a]={},b=i.iframe=f.createElement("iframe"),k.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(b,f.body||f.documentElement),i=new c.Uri,i.setScheme(d.getScheme()),i.setPort(d.getPort()),i.setHostname(a),i.setPath(j),b.src=i.toString()),l.on(b,"load",g,this))}});return j},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(c,h,l){function k(a,c,e){d||(d=!0,a='<object id="'+f+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+c+"&uid="+e+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',c=b.createElement("div"),l.prepend(c,b.body||b.documentElement),c.innerHTML=a)}function j(a){this.io=a}var g={},f="io_swf",e,b=c.Env.host.document,d=
!1;c.augment(j,{send:function(){var a=this,b=a.io.config;k((b.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);e?(a._uid=c.guid(),g[a._uid]=a,e.send(b.uri.toString(b.serializeArray),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.query.toString(b.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){e.abort(this._uid)},_xdrResponse:function(a,b){var c,d=b.id,e=this.io;e.responseText=decodeURI(b.c.responseText);switch(a){case "success":c={status:200,statusText:"success"};
delete g[d];break;case "abort":delete g[d];break;case "timeout":case "transport error":case "failure":delete g[d],c={status:500,statusText:a}}c&&e._ioReady(c.status,c.statusText)}});h.applyTo=function(a,b,d){var a=b.split(".").slice(1),e=h;c.each(a,function(a){e=e[a]});e.apply(null,d)};h.xdrReady=function(){e=b.getElementById(f)};h.xdrResponse=function(a,b){var c=g[b.uid];c&&c._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(c,h){function l(b,c){try{return new (c||k).XMLHttpRequest}catch(a){}}var k=c.Env.host,j=7<c.UA.ie&&k.XDomainRequest,g={proto:{}},f={},e={};h.__lastModifiedCached=f;h.__eTagCached=e;g.nativeXhr=k.ActiveXObject?function(b,c){var a;if(b&&j)a=new j;else if(!(a=!h.isLocal&&l(b,c)))a:{try{a=new (c||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}a=void 0}return a}:l;g._XDomainRequest=j;c.mix(g.proto,{sendInternal:function(){var b=this,c=b.io,a=c.config,
i=b.nativeXhr,g=a.type,h=a.async,k,l=a.crossDomain,m=c.mimeType,c=c.requestHeaders||{},r=a.serializeArray,n=a.uri.toString(r),s,t,u;if(s=a.ifModifiedKeyUri&&a.ifModifiedKeyUri.toString()){if(t=f[s])c["If-Modified-Since"]=t;if(t=e[s])c["If-None-Match"]=t}(k=a.username)?i.open(g,n,h,k,a.password):i.open(g,n,h);if(g=a.xhrFields)for(u in g)i[u]=g[u];m&&i.overrideMimeType&&i.overrideMimeType(m);!l&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{if(!l)for(u in c)i.setRequestHeader(u,
c[u])}catch(w){}i.send(a.hasContent&&a.query.toString(r)||null);!h||4==i.readyState?b._callback():j&&i instanceof j?(i.onload=function(){i.readyState=4;i.status=200;b._callback()},i.onerror=function(){i.readyState=4;i.status=500;b._callback()}):i.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,d){var a=this.nativeXhr,i=this.io,g,h,k,l,m,r=i.config;try{if(d||4==a.readyState)if(j&&a instanceof j?(a.onerror=c.noop,a.onload=c.noop):a.onreadystatechange=
c.noop,d)4!==a.readyState&&a.abort();else{g=r.ifModifiedKeyUri&&r.ifModifiedKeyUri.toString();var n=a.status;j&&a instanceof j||(i.responseHeadersString=a.getAllResponseHeaders());g&&(h=a.getResponseHeader("Last-Modified"),k=a.getResponseHeader("ETag"),h&&(f[g]=h),k&&(e[k]=k));if((m=a.responseXML)&&m.documentElement)i.responseXML=m;i.responseText=a.responseText;try{l=a.statusText}catch(s){l=""}!n&&i.isLocal&&!r.crossDomain?n=i.responseText?200:404:1223===n&&(n=204);i._ioReady(n,l)}}catch(t){a.onreadystatechange=
c.noop,d||i._ioReady(-1,t)}}});return g},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(c,h,l,k,j,g){var f=l._XDomainRequest,e=l.nativeXhr();if(e){var b=function(a){var a=a.split("."),b=a.length,c=3<b?3:2;return b<c?a.join("."):a.reverse().slice(0,c).reverse().join(".")},d=function(a){var c=a.config,d=c.crossDomain,h=c.xdr||{},q=h.subDomain=h.subDomain||{};this.io=a;if(d){if(b(location.hostname)==b(c.uri.getHostname())&&!1!==q.proxy)return new k(a);if(!("withCredentials"in e)&&("flash"===""+h.use||!f))return new j(a)}this.nativeXhr=l.nativeXhr(d);
return g};c.augment(d,l.proto,{send:function(){this.sendInternal()}});h.setupTransport("*",d)}return h},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
