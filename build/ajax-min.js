/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 22 17:42
*/
KISSY.add("ajax",function(c,f,k){function j(d,h,e,a,l){c.isFunction(h)&&(a=e,e=h,h=i);return k({type:l||"get",url:d,data:h,success:e,dataType:a})}var i=void 0;c.mix(k,{serialize:f.serialize,get:j,post:function(d,h,e,a){c.isFunction(h)&&(a=e,e=h,h=i);return j(d,h,e,a,"post")},jsonp:function(d,h,e){c.isFunction(h)&&(e=h,h=i);return j(d,h,e,"jsonp")},getScript:c.getScript,getJSON:function(d,h,e){c.isFunction(h)&&(e=h,h=i);return j(d,h,e,"json")},upload:function(d,h,e,a,l){c.isFunction(e)&&(l=a,a=e,e=
i);return k({url:d,type:"post",dataType:l,form:h,data:e,success:a})}});c.mix(c,{Ajax:k,IO:k,ajax:k,io:k,jsonp:k.jsonp});return k},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(c,f,k,j){function i(b){var e=b.context,d=b.ifModified;delete b.context;b=c.mix(c.clone(q),b,{deep:!0});b.context=e||b;var h,l=b.type,n=b.dataType,i;i=b.query=new c.Uri.Query;e=b.uri=m.resolve(b.url);"crossDomain"in b||(b.crossDomain=!b.uri.hasSameDomainAs(m));if(b.processData&&(h=b.data))c.isObject(h)?i.add(h):i.reset(h);l=b.type=l.toUpperCase();b.hasContent=!g.test(l);n=b.dataType=c.trim(n||"*").split(a);!("cache"in b)&&c.inArray(n[0],["script","jsonp"])&&(b.cache=
!1);var f;b.hasContent||(i.count()&&e.query.add(i),d&&(f=e.clone()),!1===b.cache&&e.query.set("_ksTS",c.now()+"_"+c.guid()));d&&(b.ifModifiedKeyUri=f||e.clone());return b}function d(b,a){h.fire(b,{ajaxConfig:a.config,xhr:a,io:a})}function h(a){function e(b){return function(e){if(f=g.timeoutTimer)clearTimeout(f),g.timeoutTimer=0;var l=a[b];l&&l.apply(v,e);d(b,g)}}var g=this;if(!a.url)return j;if(!(g instanceof h))return new h(a);b.call(g);a=i(a);c.mix(g,{responseData:null,config:a||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)});var l;d("start",g);l=new (r[a.dataType[0]]||r["*"])(g);g.transport=l;a.contentType&&g.setRequestHeader("Content-Type",a.contentType);var n=a.dataType[0],f,k,s=a.timeout,v=a.context,m=a.headers,o=a.accepts;g.setRequestHeader("Accept",n&&o[n]?o[n]+("*"===n?"":", */*; q=0.01"):o["*"]);for(k in m)g.setRequestHeader(k,
m[k]);if(a.beforeSend&&!1===a.beforeSend.call(v,g,a))return j;g.then(e("success"),e("error"));g.fin(e("complete"));g.readyState=1;d("send",g);a.async&&0<s&&(g.timeoutTimer=setTimeout(function(){g.abort("timeout")},1E3*s));try{g.state=1,l.send()}catch(p){2>g.state&&g._ioReady(-1,p)}return j}var e=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,a=/\s+/,l=function(b){return b},b=c.Promise,g=/^(?:GET|HEAD)$/,n,v=c.Uri,s=c.Env.host,p=s.document,s=s.location,m;if(s){try{n=s.href}catch(o){n=p.createElement("a"),
n.href="",n=n.href}m=new v(n)}var e=m&&e.test(m.getScheme()),r={},q={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parse,html:l,text:l,xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};q.converters.html=q.converters.text;c.mix(h,k.Target);c.mix(h,{isLocal:e,setupConfig:function(b){c.mix(q,
b,{deep:!0})},setupTransport:function(b,a){r[b]=a},getTransport:function(b){return r[b]},getConfig:function(){return q}});return h},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(c,f){function k(e){return e.replace(i,"\r\n")}var j=/^(?:select|textarea)/i,i=/\r?\n/g,d,h=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return d={serialize:function(e,a){return c.param(d.getFormData(e),void 0,void 0,a||!1)},getFormData:function(e){var a=[],l={};c.each(f.query(e),function(b){b=b.elements?c.makeArray(b.elements):[b];a.push.apply(a,b)});a=c.filter(a,function(b){return b.name&&!b.disabled&&
(b.checked||j.test(b.nodeName)||h.test(b.type))});c.each(a,function(b){var a=f.val(b),e,a=c.isArray(a)?c.map(a,k):k(a);(e=l[b.name])?(e&&!c.isArray(e)&&(e=l[b.name]=[e]),e.push.apply(e,c.makeArray(a))):l[b.name]=a});return l}}},{requires:["dom"]});
KISSY.add("ajax/form",function(c,f,k,j){f.on("start",function(c){var d,h,c=c.io.config;if(d=c.form)d=k.get(d),h=d.encoding||d.enctype,"multipart/form-data"!=h.toLowerCase()?(d=j.getFormData(d),c.hasContent?c.query.add(d):(c.uri.query.add(d),c.ifModifiedKeyUri&&c.ifModifiedKeyUri.query.add(d))):(d=c.dataType,c=d[0],"*"==c&&(c="text"),d.length=2,d[0]="iframe",d[1]=c)});return f},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(c,f,k,j){function i(e,a,l){var b=[],g,d,i,k,j=e.keys();c.each(j,function(j){var o=e.get(j);g=c.isArray(o);d=c.makeArray(o);for(i=0;i<d.length;i++)k=h.createElement("input"),k.type="hidden",k.name=j+(g&&l?"[]":""),k.value=d[i],f.append(k,a),b.push(k)});return b}function d(e){this.io=e}var h=c.Env.host.document;j.setupConfig({converters:{iframe:j.getConfig().converters.text,text:{iframe:function(e){return e}},xml:{iframe:function(e){return e}}}});c.augment(d,
{send:function(){var e=this.io,a=e.config,d,b=a.query,g=f.get(a.form);this.attrs={target:f.attr(g,"target")||"",action:f.attr(g,"action")||"",method:f.attr(g,"method")};this.form=g;var n=c.guid("ajax-iframe"),j=f.getEmptyIframeSrc(),e=e.iframe=f.create("<iframe "+(j?' src="'+j+'" ':"")+' id="'+n+'" name="'+n+'" style="position:absolute;left:-9999px;top:-9999px;"/>');f.prepend(e,h.body||h.documentElement);f.attr(g,{target:e.id,action:a.uri.toString(a.serializeArray),method:"post"});b.count()&&(d=i(b,
g,a.serializeArray));this.fields=d;k.on(e,"load error",this._callback,this);g.submit()},_callback:function(e){var a=this.io,e=e.type,d,b=a.iframe;if(b)if(f.attr(this.form,this.attrs),f.remove(this.fields),k.detach(b),setTimeout(function(){f.remove(b)},30),a.iframe=null,"load"==e)try{if((d=b.contentWindow.document)&&d.body)a.responseText=c.trim(f.text(d.body)),c.startsWith(a.responseText,"<?xml")&&(a.responseText=void 0);a.responseXML=d&&d.XMLDocument?d.XMLDocument:d;d?a._ioReady(200,"success"):a._ioReady(500,
"parser error")}catch(g){a._ioReady(500,"parser error")}else"error"==e&&a._ioReady(500,"error")},abort:function(){this._callback({})}});j.setupTransport("iframe",d);return j},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(c,f){var k=c.Env.host;f.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});f.on("start",function(f){var i=f.io,d=i.config,f=d.dataType;if("jsonp"==f[0]){var h,e=d.jsonpCallback,a=c.isFunction(e)?e():e,l=k[a];d.uri.query.set(d.jsonp,a);k[a]=function(b){1<arguments.length&&(b=c.makeArray(arguments));h=[b]};i.fin(function(){k[a]=l;if(void 0===l)try{delete k[a]}catch(b){}else h&&l(h[0])});i=i.converters=i.converters||{};i.script=i.script||
{};i.script.json=function(){return h[0]};f.length=2;f[0]="script";f[1]="json"}});return f},{requires:["./base"]});
KISSY.add("ajax/methods",function(c,f,k){function j(d){var h=d.responseText,e=d.responseXML,a=d.config,l=a.converters,b=d.converters||{},g,f,i=a.contents,j=a.dataType;if(h||e){for(a=d.mimeType||d.getResponseHeader("Content-Type");"*"==j[0];)j.shift();if(!j.length)for(g in i)if(i[g].test(a)){j[0]!=g&&j.unshift(g);break}j[0]=j[0]||"text";if("text"==j[0]&&h!==k)f=h;else if("xml"==j[0]&&e!==k)f=e;else{var p={text:h,xml:e};c.each(["text","xml"],function(a){var g=j[0];if((b[a]&&b[a][g]||l[a]&&l[a][g])&&
p[a])return j.unshift(a),f="text"==a?h:e,!1})}}i=j[0];for(a=1;a<j.length;a++){g=j[a];var m=b[i]&&b[i][g]||l[i]&&l[i][g];if(!m)throw"no covert for "+i+" => "+g;f=m(f);i=g}d.responseData=f}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;c.extend(f,c.Promise,{setRequestHeader:function(d,c){this.requestHeaders[d]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var c,e;if(2===this.state){if(!(e=this.responseHeaders))for(e=this.responseHeaders=
{};c=i.exec(this.responseHeadersString);)e[c[1]]=c[2];c=e[d]}return c===k?null:c},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d;if(d=this.transport)return d.nativeXhr},_ioReady:function(d,c){if(2!=this.state){this.state=2;this.readyState=4;var e;if(200<=d&&300>d||304==d)if(304==d)c="not modified",e=!0;else try{j(this),c="success",e=!0}catch(a){c=
"parser error"}else 0>d&&(d=0);this.status=d;this.statusText=c;this._defer[e?"resolve":"reject"]([this.responseData,c,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(c,f,k,j){function i(e){if(!e.config.crossDomain)return new (f.getTransport("*"))(e);this.io=e;return 0}var d=c.Env.host,h=d.document;f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){c.globalEval(e);return e}}}});c.augment(i,{send:function(){var e=this,a,c=e.io.config,b=h.head||h.getElementsByTagName("head")[0]||
h.documentElement;e.head=b;a=h.createElement("script");e.script=a;a.async="async";c.scriptCharset&&(a.charset=c.scriptCharset);a.src=c.uri.toString(c.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(b){b=b||d.event;e._callback((b.type||"error").toLowerCase())};b.insertBefore(a,b.firstChild)},_callback:function(e,a){var c=this.script,b=this.io,g=this.head;if(c&&(a||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==e))c.onerror=c.onload=c.onreadystatechange=null,g&&c.parentNode&&
g.removeChild(c),this.head=this.script=j,!a&&"error"!=e?b._ioReady(200,"success"):"error"==e&&b._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});f.setupTransport("script",i);return f},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(c,f,k,j){function i(a){var c=a.config;this.io=a;c.crossDomain=!1}function d(){var a=this.io.config.uri.getHostname(),a=e[a];a.ready=1;k.detach(a.iframe,"load",d,this);this.send()}var h=c.Env.host.document,e={};c.augment(i,f.proto,{send:function(){var a=this.io.config,l=a.uri,b=l.getHostname(),g;g=e[b];var i="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(i=a.xdr.subDomain.proxy);g&&g.ready?(this.nativeXhr=f.nativeXhr(0,g.iframe.contentWindow))&&
this.sendInternal():(g?a=g.iframe:(g=e[b]={},a=g.iframe=h.createElement("iframe"),j.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),j.prepend(a,h.body||h.documentElement),g=new c.Uri,g.setScheme(l.getScheme()),g.setPort(l.getPort()),g.setHostname(b),g.setPath(i),a.src=g.toString()),k.on(a,"load",d,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(c,f,k){function j(b,c,e){l||(l=!0,b='<object id="'+h+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+c+"&uid="+e+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',c=a.createElement("div"),k.prepend(c,a.body||a.documentElement),c.innerHTML=b)}function i(b){this.io=b}var d={},h="io_swf",e,a=c.Env.host.document,l=
!1;c.augment(i,{send:function(){var b=this,a=b.io.config;j((a.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);e?(b._uid=c.guid(),d[b._uid]=b,e.send(a.uri.toString(a.serializeArray),{id:b._uid,uid:b._uid,method:a.type,data:a.hasContent&&a.query.toString(a.serializeArray)||{}})):setTimeout(function(){b.send()},200)},abort:function(){e.abort(this._uid)},_xdrResponse:function(b,a){var c,e=a.id,h=this.io;h.responseText=decodeURI(a.c.responseText);switch(b){case "success":c={status:200,statusText:"success"};
delete d[e];break;case "abort":delete d[e];break;case "timeout":case "transport error":case "failure":delete d[e],c={status:500,statusText:b}}c&&h._ioReady(c.status,c.statusText)}});f.applyTo=function(b,a,e){var b=a.split(".").slice(1),d=f;c.each(b,function(b){d=d[b]});d.apply(null,e)};f.xdrReady=function(){e=a.getElementById(h)};f.xdrResponse=function(b,a){var c=d[a.uid];c&&c._xdrResponse(b,a)};return i},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(c,f){function k(a,c){try{return new (c||j).XMLHttpRequest}catch(b){}}var j=c.Env.host,i=j.XDomainRequest,d={proto:{}},h={},e={};f.__lastModifiedCached=h;f.__eTagCached=e;d.nativeXhr=j.ActiveXObject?function(a,c){var b;if(a&&i)b=new i;else if(!(b=!f.isLocal&&k(a,c)))a:{try{b=new (c||j).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}b=void 0}return b}:k;c.mix(d.proto,{sendInternal:function(){var a=this,c=a.io,b=c.config,d=a.nativeXhr,f=b.type,j=b.async,
k,p=b.crossDomain,m=c.mimeType,c=c.requestHeaders||{},o=b.serializeArray,r=b.uri.toString(o),q,t,u;if(q=b.ifModifiedKeyUri&&b.ifModifiedKeyUri.toString()){if(t=h[q])c["If-Modified-Since"]=t;if(t=e[q])c["If-None-Match"]=t}(k=b.username)?d.open(f,r,j,k,b.password):d.open(f,r,j);if(f=b.xhrFields)for(u in f)d[u]=f[u];m&&d.overrideMimeType&&d.overrideMimeType(m);!p&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{if(!p)for(u in c)d.setRequestHeader(u,c[u])}catch(w){}d.send(b.hasContent&&
b.query.toString(o)||null);!j||4==d.readyState?a._callback():i&&d instanceof i?(d.onload=function(){d.readyState=4;d.status=200;a._callback()},d.onerror=function(){d.readyState=4;d.status=500;a._callback()}):d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,d){try{var b=this.nativeXhr,g=this.io,f=g.config;if(d||4==b.readyState)if(i&&b instanceof i?(b.onerror=c.noop,b.onload=c.noop):b.onreadystatechange=c.noop,d)4!==b.readyState&&b.abort();else{var j=
f.ifModifiedKeyUri&&f.ifModifiedKeyUri.toString(),k=b.status;i&&b instanceof i||(g.responseHeadersString=b.getAllResponseHeaders());if(j){var p=b.getResponseHeader("Last-Modified"),m=b.getResponseHeader("ETag");p&&(h[j]=p);m&&(e[m]=m)}var o=b.responseXML;o&&o.documentElement&&(g.responseXML=o);g.responseText=b.responseText;try{var r=b.statusText}catch(q){r=""}!k&&g.isLocal&&!f.crossDomain?k=g.responseText?200:404:1223===k&&(k=204);g._ioReady(k,r)}}catch(t){b.onreadystatechange=c.noop,d||g._ioReady(-1,
t)}}});return d},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(c,f,k,j,i,d){var h=c.Env.host.XDomainRequest,e=k.nativeXhr();if(e){var a=function(b){var b=b.split("."),a=b.length,c=3<a?3:2;return a<c?b.join("."):b.reverse().slice(0,c).reverse().join(".")},l=function(b){var c=b.config,f=c.crossDomain,l=c.xdr||{};if(f){if(a(location.hostname)==a(c.uri.getHostname()))return new j(b);if(!("withCredentials"in e)&&("flash"===""+l.use||!h))return new i(b)}this.io=b;this.nativeXhr=k.nativeXhr(f);return d};c.augment(l,k.proto,{send:function(){this.sendInternal()}});
f.setupTransport("*",l)}return f},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
