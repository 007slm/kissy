/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 19 15:51
*/
KISSY.add("ajax",function(f,g,i){function k(d,c,a,h,j){f.isFunction(c)&&(h=a,a=c,c=l);return i({type:j||"get",url:d,data:c,success:a,dataType:h})}var l=void 0;f.mix(i,{serialize:g.serialize,get:k,post:function(d,c,a,h){f.isFunction(c)&&(h=a,a=c,c=l);return k(d,c,a,h,"post")},jsonp:function(d,c,a){f.isFunction(c)&&(a=c,c=l);return k(d,c,a,"jsonp")},getScript:f.getScript,getJSON:function(d,c,a){f.isFunction(c)&&(a=c,c=l);return k(d,c,a,"json")},upload:function(d,c,a,h,j){f.isFunction(a)&&(j=h,h=a,a=
l);return i({url:d,type:"post",dataType:j,form:c,data:a,success:h})}});f.mix(f,{Ajax:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(f,g,i,k){function l(e){var a=e.context;delete e.context;e=f.mix(f.clone(p),e,{deep:!0});e.context=a||e;var d,o=e.type,j=e.dataType,a=e.uri=n.resolve(e.url);"crossDomain"in e||(e.crossDomain=!e.uri.isSameOriginAs(n));o=e.type=o.toUpperCase();e.hasContent=!b.test(o);if(e.processData&&(d=e.data)&&"string"!=typeof d)e.data=f.param(d,k,k,e.serializeArray);j=e.dataType=f.trim(j||"*").split(h);!("cache"in e)&&f.inArray(j[0],["script","jsonp"])&&(e.cache=!1);e.hasContent||(e.data&&
a.query.add(f.unparam(e.data)),!1===e.cache&&a.query.set("_ksTS",f.now()+"_"+f.guid()));return e}function d(e,b){c.fire(e,{ajaxConfig:b.config,io:b})}function c(b){function h(e){return function(h){if(g=a.timeoutTimer)clearTimeout(g),a.timeoutTimer=0;var j=b[e];j&&j.apply(i,h);d(e,a)}}var a=this;if(!b.url)return k;if(!(a instanceof c))return new c(b);e.call(a);b=l(b);f.mix(a,{responseData:null,config:b||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new f.Defer(this)});var o;d("start",a);o=new (r[b.dataType[0]]||r["*"])(a);a.transport=o;b.contentType&&a.setRequestHeader("Content-Type",b.contentType);var j=b.dataType[0],g,q,m=b.timeout,i=b.context,n=b.headers,s=b.accepts;a.setRequestHeader("Accept",j&&s[j]?s[j]+("*"===j?"":", */*; q=0.01"):s["*"]);for(q in n)a.setRequestHeader(q,n[q]);if(b.beforeSend&&!1===b.beforeSend.call(i,a,b))return k;a.then(h("success"),
h("error"));a.fin(h("complete"));a.readyState=1;d("send",a);b.async&&0<m&&(a.timeoutTimer=setTimeout(function(){a.abort("timeout")},1E3*m));try{a.state=1,o.send()}catch(t){2>a.state&&a._ioReady(-1,t)}return k}var a=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,h=/\s+/,j=function(b){return b},e=f.Promise,b=/^(?:GET|HEAD)$/,o,q=f.Uri,m=f.Env.host,s=m.document,m=m.location,n;if(m){try{o=m.href}catch(t){o=s.createElement("a"),o.href="",o=o.href}n=new q(o)}var a=n&&a.test(n.getScheme()),r={},
p={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:g.parse,html:j,text:j,xml:f.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};p.converters.html=p.converters.text;f.mix(c,i.Target);f.mix(c,{isLocal:a,setupConfig:function(b){f.mix(p,b,{deep:!0})},setupTransport:function(b,e){r[b]=
e},getTransport:function(b){return r[b]},getConfig:function(){return p}});return c},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(f,g){function i(a){return a.replace(l,"\r\n")}var k=/^(?:select|textarea)/i,l=/\r?\n/g,d,c=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return d={serialize:function(a,h){return f.param(d.getFormData(a),void 0,void 0,h||!1)},getFormData:function(a){var h=[],j={};f.each(g.query(a),function(e){e=e.elements?f.makeArray(e.elements):[e];h.push.apply(h,e)});h=f.filter(h,function(e){return e.name&&!e.disabled&&
(e.checked||k.test(e.nodeName)||c.test(e.type))});f.each(h,function(e){var b=g.val(e),a,b=f.isArray(b)?f.map(b,i):i(b);(a=j[e.name])?(a&&!f.isArray(a)&&(a=j[e.name]=[a]),a.push.apply(a,f.makeArray(b))):j[e.name]=b});return j}}},{requires:["dom"]});
KISSY.add("ajax/form",function(f,g,i,k){g.on("start",function(g){var d,c,a,g=g.io.config;if(a=g.form)d=i.get(a),c=d.encoding||d.enctype,a=g.data,"multipart/form-data"!=c.toLowerCase()?(d=k.getFormData(d),g.hasContent?(d=f.param(d,void 0,void 0,g.serializeArray),g.data=a?g.data+("&"+d):d):g.uri.query.add(d)):(a=g.dataType,g=a[0],"*"==g&&(g="text"),a.length=2,a[0]="iframe",a[1]=g)});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(f,g,i,k){function l(h){var j=f.guid("ajax-iframe"),e=g.getEmptyIframeSrc(),h=h.iframe=g.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+j+'" name="'+j+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(h,a.body||a.documentElement);return h}function d(h,j,e){var b=[],d,c,m,i;f.each(h,function(h,k){d=f.isArray(h);c=f.makeArray(h);for(m=0;m<c.length;m++)i=a.createElement("input"),i.type="hidden",i.name=k+(d&&e?"[]":""),i.value=c[m],g.append(i,
j),b.push(i)});return b}function c(a){this.io=a}var a=f.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});f.augment(c,{send:function(){function a(){i.on(q,"load error",j._callback,j);n.submit()}var j=this,e=j.io,b=e.config,c,q,m,k=b.data,n=g.get(b.form);j.attrs={target:g.attr(n,"target")||"",action:g.attr(n,"action")||"",method:g.attr(n,"method")};j.form=n;q=l(e);g.attr(n,{target:q.id,action:b.uri.toString(b.serializeArray),
method:"post"});k&&(m=f.unparam(k));m&&(c=d(m,n,b.serializeArray));j.fields=c;6==f.UA.ie?setTimeout(a,0):a()},_callback:function(a){var d=this,e=d.form,b=d.io,a=a.type,c,k=b.iframe;if(k)if("abort"==a&&6==f.UA.ie?setTimeout(function(){g.attr(e,d.attrs)},0):g.attr(e,d.attrs),g.remove(this.fields),i.detach(k),setTimeout(function(){g.remove(k)},30),b.iframe=null,"load"==a)try{if((c=k.contentWindow.document)&&c.body)b.responseText=f.trim(g.text(c.body)),f.startsWith(b.responseText,"<?xml")&&(b.responseText=
void 0);b.responseXML=c&&c.XMLDocument?c.XMLDocument:c;c?b._ioReady(200,"success"):b._ioReady(500,"parser error")}catch(m){b._ioReady(500,"parser error")}else"error"==a&&b._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});k.setupTransport("iframe",c);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(f,g){var i=f.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return f.guid("jsonp")}});g.on("start",function(g){var l=g.io,d=l.config,g=d.dataType;if("jsonp"==g[0]){var c,a=d.jsonpCallback,h=f.isFunction(a)?a():a,j=i[h];d.uri.query.set(d.jsonp,h);i[h]=function(a){1<arguments.length&&(a=f.makeArray(arguments));c=[a]};l.fin(function(){i[h]=j;if(void 0===j)try{delete i[h]}catch(a){}else c&&j(c[0])});l=l.converters=l.converters||{};l.script=l.script||
{};l.script.json=function(){return c[0]};g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("ajax/methods",function(f,g,i){function k(d){var c=d.responseText,a=d.responseXML,h=d.config,j=h.converters,e=d.converters||{},b,g,k=h.contents,m=h.dataType;if(c||a){for(h=d.mimeType||d.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(b in k)if(k[b].test(h)){m[0]!=b&&m.unshift(b);break}m[0]=m[0]||"text";if("text"==m[0]&&c!==i)g=c;else if("xml"==m[0]&&a!==i)g=a;else{var l={text:c,xml:a};f.each(["text","xml"],function(b){var d=m[0];if((e[b]&&e[b][d]||j[b]&&j[b][d])&&
l[b])return m.unshift(b),g="text"==b?c:a,!1})}}k=m[0];for(h=1;h<m.length;h++){b=m[h];var n=e[k]&&e[k][b]||j[k]&&j[k][b];if(!n)throw"no covert for "+k+" => "+b;g=n(g);k=b}d.responseData=g}var l=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;f.extend(g,f.Promise,{setRequestHeader:function(d,c){this.requestHeaders[d]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var c,a;if(2===this.state){if(!(a=this.responseHeaders))for(a=this.responseHeaders=
{};c=l.exec(this.responseHeadersString);)a[c[1]]=c[2];c=a[d]}return c===i?null:c},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);this._ioReady(0,d);return this},getNativeXhr:function(){var d;if(d=this.transport)return d.nativeXhr},_ioReady:function(d,c){if(2!=this.state){this.state=2;this.readyState=4;var a;if(200<=d&&300>d||304==d)if(304==d)c="not modified",a=!0;else try{k(this),c="success",a=!0}catch(h){c=
"parser error"}else 0>d&&(d=0);this.status=d;this.statusText=c;this._defer[a?"resolve":"reject"]([this.responseData,c,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(f,g,i,k){function l(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return 0}var d=f.Env.host,c=d.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){f.globalEval(a);return a}}}});f.augment(l,{send:function(){var a=this,h,j=a.io.config,e=c.head||c.getElementsByTagName("head")[0]||
c.documentElement;a.head=e;h=c.createElement("script");a.script=h;h.async=!0;j.scriptCharset&&(h.charset=j.scriptCharset);h.src=j.uri.toString(j.serializeArray);h.onerror=h.onload=h.onreadystatechange=function(b){b=b||d.event;a._callback((b.type||"error").toLowerCase())};e.insertBefore(h,e.firstChild)},_callback:function(a,d){var c=this.script,e=this.io,b=this.head;if(c&&(d||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=c.onreadystatechange=null,b&&c.parentNode&&
b.removeChild(c),this.head=this.script=k,!d&&"error"!=a?e._ioReady(200,"success"):"error"==a&&e._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",l);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(f,g,i,k){function l(a){var d=a.config;this.io=a;d.crossDomain=!1}function d(){var c=this.io.config.uri.getHostname(),c=a[c];c.ready=1;i.detach(c.iframe,"load",d,this);this.send()}var c=f.Env.host.document,a={};f.augment(l,g.proto,{send:function(){var h=this.io.config,j=h.uri,e=j.getHostname(),b;b=a[e];var o="/sub_domain_proxy.html";h.xdr&&h.xdr.subDomain&&h.xdr.subDomain.proxy&&(o=h.xdr.subDomain.proxy);b&&b.ready?(this.nativeXhr=g.nativeXhr(0,b.iframe.contentWindow))&&
this.sendInternal():(b?h=b.iframe:(b=a[e]={},h=b.iframe=c.createElement("iframe"),k.css(h,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(h,c.body||c.documentElement),b=new f.Uri,b.setScheme(j.getScheme()),b.setPort(j.getPort()),b.setHostname(e),b.setPath(o),h.src=b.toString()),i.on(h,"load",d,this))}});return l},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(f,g,i){function k(a,b,d){j||(j=!0,a='<object id="'+c+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+b+"&uid="+d+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',b=h.createElement("div"),i.prepend(b,h.body||h.documentElement),b.innerHTML=a)}function l(a){this.io=a}var d={},c="io_swf",a,h=f.Env.host.document,j=
!1;f.augment(l,{send:function(){var e=this,b=e.io.config;k((b.xdr||{}).src||f.Config.base+"ajax/io.swf",1,1);a?(e._uid=f.guid(),d[e._uid]=e,a.send(b.uri.toString(b.serializeArray),{id:e._uid,uid:e._uid,method:b.type,data:b.hasContent&&b.data||{}})):setTimeout(function(){e.send()},200)},abort:function(){a.abort(this._uid)},_xdrResponse:function(a,b){var c,f=b.id,h,g=b.c,j=this.io;if(g&&(h=g.responseText))j.responseText=decodeURI(h);switch(a){case "success":c={status:200,statusText:"success"};delete d[f];
break;case "abort":delete d[f];break;case "timeout":case "transport error":case "failure":delete d[f],c={status:"status"in g?g.status:500,statusText:g.statusText||a}}c&&j._ioReady(c.status,c.statusText)}});g.applyTo=function(a,b,c){var a=b.split(".").slice(1),d=g;f.each(a,function(a){d=d[a]});d.apply(null,c)};g.xdrReady=function(){a=h.getElementById(c)};g.xdrResponse=function(a,b){var c=d[b.uid];c&&c._xdrResponse(a,b)};return l},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(f,g){function i(a,c){try{return new (c||l).XMLHttpRequest}catch(b){}}function k(a){var c;a.ifModified&&(c=a.uri,!1===a.cache&&(c=c.clone(),c.query.remove("_ksTS")),c=c.toString());return c}var l=f.Env.host,d=7<f.UA.ie&&l.XDomainRequest,c={proto:{}},a={},h={};g.__lastModifiedCached=a;g.__eTagCached=h;c.nativeXhr=l.ActiveXObject?function(a,c){var b;if(a&&d)b=new d;else if(!(b=!g.isLocal&&i(a,c)))a:{try{b=new (c||l).ActiveXObject("Microsoft.XMLHTTP");break a}catch(f){}b=
void 0}return b}:i;c._XDomainRequest=d;f.mix(c.proto,{sendInternal:function(){var c=this,e=c.io,b=e.config,f=c.nativeXhr,g=b.type,i=b.async,l,n=b.crossDomain,t=e.mimeType,e=e.requestHeaders||{},r=b.uri.toString(b.serializeArray),p=k(b),v,u;if(p){if(v=a[p])e["If-Modified-Since"]=v;if(v=h[p])e["If-None-Match"]=v}(l=b.username)?f.open(g,r,i,l,b.password):f.open(g,r,i);if(g=b.xhrFields)for(u in g)f[u]=g[u];t&&f.overrideMimeType&&f.overrideMimeType(t);!n&&!e["X-Requested-With"]&&(e["X-Requested-With"]=
"XMLHttpRequest");try{if(!n)for(u in e)f.setRequestHeader(u,e[u])}catch(w){}f.send(b.hasContent&&b.data||null);!i||4==f.readyState?c._callback():d&&f instanceof d?(f.onload=function(){f.readyState=4;f.status=200;c._callback()},f.onerror=function(){f.readyState=4;f.status=500;c._callback()}):f.onreadystatechange=function(){c._callback()}},abort:function(){this._callback(0,1)},_callback:function(c,e){var b=this.nativeXhr,g=this.io,i,l,s,n,t,r=g.config;try{if(e||4==b.readyState)if(d&&b instanceof d?
(b.onerror=f.noop,b.onload=f.noop):b.onreadystatechange=f.noop,e)4!==b.readyState&&b.abort();else{i=k(r);var p=b.status;d&&b instanceof d||(g.responseHeadersString=b.getAllResponseHeaders());i&&(l=b.getResponseHeader("Last-Modified"),s=b.getResponseHeader("ETag"),l&&(a[i]=l),s&&(h[s]=s));if((t=b.responseXML)&&t.documentElement)g.responseXML=t;g.responseText=b.responseText;try{n=b.statusText}catch(v){n=""}!p&&g.isLocal&&!r.crossDomain?p=g.responseText?200:404:1223===p&&(p=204);g._ioReady(p,n)}}catch(u){b.onreadystatechange=
f.noop,e||g._ioReady(-1,u)}}});return c},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(f,g,i,k,l){var d=f.Env.host,c=i._XDomainRequest,a=i.nativeXhr();if(a){var h=function(g){var e=g.config,b=e.crossDomain,h=e.xdr||{},q=h.subDomain=h.subDomain||{};this.io=g;if(b){e=e.uri.getHostname();if(f.endsWith(e,d.document.domain)&&!1!==q.proxy)return new k(g);if(!("withCredentials"in a)&&("flash"===""+h.use||!c))return new l(g)}this.nativeXhr=i.nativeXhr(b);return this};f.augment(h,i.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",h)}return g},
{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
