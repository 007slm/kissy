/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Apr 10 19:31
*/
KISSY.add("input-selection",function(k,f){var i=f._propHooks;if(typeof k.Env.host.document.createElement("input").selectionEnd!="number"){i.selectionStart={set:function(a,b){var c=a.ownerDocument.selection.createRange();if(j(a).inRange(c)){var d=h(a,1)[1],e=l(a,b,d);c.collapse(false);c.moveStart("character",-e);b>d&&c.collapse(true);c.select()}},get:function(a){return h(a)[0]}};i.selectionEnd={set:function(a,b){var c=a.ownerDocument.selection.createRange();if(j(a).inRange(c)){var d=h(a)[0],e=l(a,
d,b);c.collapse(true);c.moveEnd("character",e);d>b&&c.collapse(false);c.select()}},get:function(a){return h(a,1)[1]}};var h=function(a,b){var c=0,d=0,e=a.ownerDocument.selection.createRange(),g=j(a);if(g.inRange(e)){g.setEndPoint("EndToStart",e);c=m(a,g).length;if(b)d=c+m(a,e).length}return[c,d]},j=function(a){if(a.type=="textarea"){var b=a.document.body.createTextRange();b.moveToElementText(a);return b}else return a.createTextRange()},l=function(a,b,c){var d=Math.min(b,c),e=Math.max(b,c);if(d==e)return 0;
if(a.type=="textarea"){a=a.value.substring(d,e).replace(/\r\n/g,"\n").length;if(b>c)a=-a;return a}else return c-b},m=function(a,b){if(a.type=="textarea"){var c=b.text,d=b.duplicate();if(d.compareEndPoints("StartToEnd",d)==0)return c;d.moveEnd("character",-1);if(d.text==c)c+="\r\n";return c}else return b.text}}var o=["paddingLeft","paddingTop","paddingBottom","paddingRight","marginLeft","marginTop","marginBottom","marginRight","borderLeftStyle","borderTopStyle","borderBottomStyle","borderRightStyle",
"borderLeftWidth","borderTopWidth","borderBottomWidth","borderRightWidth","line-height","outline","width","height","fontFamily","fontSize","fontWeight","fontVariant","fontStyle"];i.KsCursorOffset={get:function(a){var b=a.ownerDocument,c=a.scrollTop,d=a.scrollLeft;if(b.selection){b=b.selection.createRange();return{left:b.boundingLeft+d,top:b.boundingTop+c}}var e=f.create("<div style='z-index:-9999;overflow:hidden;word-wrap: break-word;position: absolute;left:-9999px;top:-9999px;'></div>");k.each(o,
function(n){f.css(e,n,f.css(a,n))});e.innerHTML=a.value.substring(0,a.selectionStart).replace(/\n/g,"<br/>").replace(/\s/g,'<span style="white-space:pre-wrap;"> </span>')+"<span>x</span>";f.prepend(e,b.body);f.offset(e,f.offset(a));var g=e.lastChild;b=f.offset(g);b.top+=f.height(g);b.top-=c;b.left-=d;f.remove(e);return b}}},{requires:["dom"]});
