/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Mar 22 12:25
*/
KISSY.add("dd/ddm",function(k,r,s,j,l,e){function n(){n.superclass.constructor.apply(this,arguments)}function c(b,f){var o=b.get("activeDrag"),A=o.get("mode"),x=b.get("drops"),t,y=0,D=0,F=d(o.get("node")),G=a(F);k.each(x,function(E){var u;if(u=E.getNodeFromTarget(f,o.get("dragNode")[0],o.get("node")[0]))if(A=="point"){if(m(d(u),o.mousePos)){u=a(d(u));if(t){if(u<D){t=E;D=u}}else{t=E;D=u}}}else if(A=="intersect"){u=a(i(F,d(u)));if(u>D){D=u;t=E}}else if(A=="strict"){u=a(i(F,d(u)));if(u==G){t=E;return false}}});
if((y=b.get("activeDrop"))&&y!=t){y._handleOut(f);o._handleOut(f)}b.set("activeDrop",t);if(t)y!=t?t._handleEnter(f):t._handleOver(f)}function h(b){var f=document;b._shim=(new l("<div style='background-color:red;position:"+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+v.get("dragCursor")+";z-index:"+C+";'></div>")).prependTo(f.body||f.documentElement).css("opacity",0);h=p;w&&j.on(q,"resize scroll",z,b);p(b)}function p(b){var f=b.get("activeDrag").get("activeHandler"),o="auto";
if(f)o=f.css("cursor");if(o=="auto")o=b.get("dragCursor");b._shim.css({cursor:o,display:"block"});w&&z.call(b)}function d(b){var f=b.offset();return{left:f.left,right:f.left+b.outerWidth(),top:f.top,bottom:f.top+b.outerHeight()}}function m(b,f){return b.left<=f.left&&b.right>=f.left&&b.top<=f.top&&b.bottom>=f.top}function a(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function i(b,f){return{left:Math.max(b.left,f.left),right:Math.min(b.right,f.right),top:Math.max(b.top,
f.top),bottom:Math.min(b.bottom,f.bottom)}}var g=document,q=window,w=r.ie===6,B=k.throttle(function(b){var f=this.__activeToDrag,o=this.get("activeDrag");if(o||f)b.preventDefault();if(o){o._move(b);c(this,b)}else f&&f._move(b)},30),C=999999;n.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var z=k.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:s.docWidth(),
height:s.docHeight()})},30);k.extend(n,e,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=k.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){j.on(g,"mouseup",this._end,this);j.on(g,"mousemove",B,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&h(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),f=
this.get("activeDrop"),o={drag:b,drop:f};j.remove(g,"mousemove",B,this);j.remove(g,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();if(f){f._end();this.fire("drophit",o);this.fire("dragdrophit",o)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});this.set("activeDrag",null);this.set("activeDrop",null)}}});var v=new n;v.inRegion=m;v.region=d;v.area=a;return v},{requires:["ua","dom","event",
"node","base"]});
KISSY.add("dd/draggable",function(k,r,s,j,l){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function n(){return false}function c(a){var i=a.target;this._checkMouseDown(a)&&this._check(i)&&this._prepare(a)}var h=k.each,p=r.ie,d=document;e.POINT="point";e.INTERSECT="intersect";e.STRICT="strict";e.ATTRS={node:{setter:function(a){return s.one(a)}},clickPixelThresh:{valueFn:function(){return l.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return l.get("bufferTime")}},dragNode:{},
shim:{value:true},handlers:{value:[],getter:function(a){var i=this;a.length||(a[0]=i.get("node"));h(a,function(g,q){if(k.isFunction(g))g=g.call(i);if(k.isString(g)||g.nodeType)g=s.one(g);a[q]=g});i.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](l.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](l.get("prefixCls")+"-disabled");
return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true}};var m;k.extend(e,j,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",c,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},destroy:function(){this.get("dragNode").detach("mousedown",c,this).detach("dragstart",this._fixDragStart);this.detach()},_check:function(a){var i=this,g=i.get("handlers"),
q=0;h(g,function(w){if(w.contains(a)||w[0]==a){q=1;i.set("activeHandler",w);return false}});return q},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var i=this;if(p){m=d.body.onselectstart;d.body.onselectstart=n}i.get("halt")?a.halt():a.preventDefault();var g=i.get("node"),q=a.pageX;a=a.pageY;g=g.offset();i.startMousePos=i.mousePos={left:q,top:a};i.startNodePos=g;i._diff={left:q-g.left,top:a-g.top};l._regToDrag(i);
if(q=i.get("bufferTime"))i._bufferTimer=setTimeout(function(){i._start()},q)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var i,g=this._diff;i=this.startMousePos;var q=a.pageX;a=a.pageY;var w=q-g.left;g=a-g.top;if(this.get("dragging")){this.mousePos={left:q,top:a};i={left:w,top:g,pageX:q,pageY:a,drag:this};q=1;if(this.fire("drag",i)===false)q=0;if(l.fire("drag",i)===false)q=0;q&&this.get("move")&&this.get("node").offset(i)}else{g=
this.get("clickPixelThresh");if(Math.abs(q-i.left)>=g||Math.abs(a-i.top)>=g)this._start()}},_end:function(){var a;this._clearBufferTimer();if(p)d.body.onselectstart=m;if(this.get("dragging")){this.get("node").removeClass(l.get("prefixCls")+"drag-over");(a=l.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.set("dragging",0);this.fire("dragend",{drag:this})}},_handleOut:function(){this.get("node").removeClass(l.get("prefixCls")+"drag-over");this.fire("dragexit",
{drag:this,drop:l.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(l.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.set("dragging",1);l._start();this.fire("dragstart",{drag:this})}});return e},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(k,r,s,j){function l(){l.superclass.constructor.apply(this,arguments);this._init()}l.ATTRS={node:{setter:function(e){if(e)return r.one(e)}}};k.extend(l,s,{getNodeFromTarget:function(e,n,c){e=this.get("node");var h=e[0];return h==n||h==c?null:e},_init:function(){j._regDrop(this)},__getCustomEvt:function(e){return k.mix({drag:j.get("activeDrag"),drop:this},e)},_handleOut:function(){var e=this.__getCustomEvt();this.get("node").removeClass(j.get("prefixCls")+"drop-over");
this.fire("dropexit",e);j.fire("dropexit",e);j.fire("dragexit",e)},_handleEnter:function(e){e=this.__getCustomEvt(e);e.drag._handleEnter(e);this.get("node").addClass(j.get("prefixCls")+"drop-over");this.fire("dropenter",e);j.fire("dragenter",e);j.fire("dropenter",e)},_handleOver:function(e){e=this.__getCustomEvt(e);e.drag._handleOver(e);this.fire("dropover",e);j.fire("dragover",e);j.fire("dropover",e)},_end:function(){var e=this.__getCustomEvt();this.get("node").removeClass(j.get("prefixCls")+"drop-over");
this.fire("drophit",e)},destroy:function(){j._unregDrop(this)}});return l},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(k,r){function s(){s.superclass.constructor.apply(this,arguments);this[j]={}}var j="__proxy_destructors",l=k.stamp,e=k.guid("__dd_proxy"),n="__proxy";s.ATTRS={node:{value:function(c){return new r(c.get("node").clone(true))}},destroyOnEnd:{value:false}};k.extend(s,k.Base,{attach:function(c){function h(){var a=d.get("node"),i=c.get("node");if(d[n])a=d[n];else if(k.isFunction(a)){a=a(c);a.addClass("ks-dd-proxy");a.css("position","absolute");d[n]=a}i.parent().append(a);a.show();
a.offset(i.offset());c.set("dragNode",i);c.set("node",a)}function p(){var a=d[n];c.get("dragNode").offset(a.offset());a.hide();if(d.get("destroyOnEnd")){a.remove();d[n]=0}c.set("node",c.get("dragNode"))}var d=this,m;if(!(m=l(c,1,e)&&d[j][m])){c.on("dragstart",h);c.on("dragend",p);m=l(c,0,e);d[j][m]={drag:c,fn:function(){c.detach("dragstart",h);c.detach("dragend",p)}}}},unAttach:function(c){c=l(c,1,e);var h=this[j];if(c&&h[c]){h[c].fn();delete h[c]}},destroy:function(){var c=this.get("node"),h=this[j];
c&&!k.isFunction(c)&&c.remove();for(var p in h)this.unAttach(h[p].drag)}});return s},{requires:["node"]});
KISSY.add("dd/draggable-delegate",function(k,r,s,j,l){function e(){e.superclass.constructor.apply(this,arguments)}function n(c){var h;if(this._checkMouseDown(c)){h=this.get("handlers");var p=new l(c.target);if(h=h.length?this._getHandler(p):p){this.set("activeHandler",h);h=this._getNode(h);this.set("node",h);this.set("dragNode",h);this._prepare(c)}}}k.extend(e,s,{_init:function(){this.get("container").on("mousedown",n,this).on("dragstart",this._fixDragStart)},_getHandler:function(c){for(var h,p=this.get("container"),
d=this.get("handlers");c&&c[0]!==p[0];){k.each(d,function(m){if(j.test(c[0],m)){h=c;return false}});if(h)break;c=c.parent()}return h},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",n,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(c){return l.one(c)}},selector:{},handlers:{value:[],getter:0}}});return e},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(k,r,s,j,l){function e(){var c=this.get("container"),h=this.get("selector");this.__allNodes=c.all(h)}function n(){n.superclass.constructor.apply(this,arguments);r.on("dragstart",e,this)}k.extend(n,s,{getNodeFromTarget:function(c,h,p){var d={left:c.pageX,top:c.pageY};c=this.__allNodes;var m=0,a=Number.MAX_VALUE;c&&c.each(function(i){var g=i[0];if(!(g===p||g===h))if(r.inRegion(r.region(i),d)){g=r.area(r.region(i));if(g<a){a=g;m=i}}});if(m){this.set("lastNode",
this.get("node"));this.set("node",m)}return m},_handleOut:function(){n.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(c){var h=this.get("node"),p=n.superclass._handleOut,d=n.superclass._handleOver,m=n.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==h[0]){this.set("node",a);p.apply(this,arguments);this.set("node",h);m.call(this,c)}else d.call(this,c)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(c){return l.one(c)}}}});
return n},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(k,r,s,j){function l(){l.superclass.constructor.apply(this,arguments);this[h]={}}var e=k.Env.host,n=k.stamp,c=100,h="__dd_scrolls";l.ATTRS={node:{valueFn:function(){return s.one(e)},setter:function(d){return s.one(d)}},rate:{value:[10,10]},diff:{value:[20,20]}};var p=k.isWindow;k.extend(l,r,{getRegion:function(d){return p(d[0])?{width:j.viewportWidth(),height:j.viewportHeight()}:{width:d.outerWidth(),height:d.outerHeight()}},getOffset:function(d){return p(d[0])?{left:j.scrollLeft(),
top:j.scrollTop()}:d.offset()},getScroll:function(d){return{left:d.scrollLeft(),top:d.scrollTop()}},setScroll:function(d,m){d.scrollLeft(m.left);d.scrollTop(m.top)},unAttach:function(d){var m,a=this[h];if((m=n(d,1,"__dd-scroll-id-"))&&a[m]){a[m].fn();delete a[m]}},destroy:function(){var d=this[h],m;for(m in d)this.unAttach(d[m].drag)},attach:function(d){function m(f){if(!f.fake){var o=g.get("node"),A=d.get("dragNode");if(o.contains(A)){z=f;v=k.clone(d.mousePos);f=g.getOffset(o);v.left-=f.left;v.top-=
f.top;b||i()}}}function a(){clearTimeout(b);b=null}function i(){var f=g.get("node"),o=g.getRegion(f),A=o.width;o=o.height;var x=g.getScroll(f),t=k.clone(x),y=false;if(v.top-o>=-C[1]){x.top+=B[1];y=true}if(v.top<=C[1]){x.top-=B[1];y=true}if(v.left-A>=-C[0]){x.left+=B[0];y=true}if(v.left<=C[0]){x.left-=B[0];y=true}if(y){g.setScroll(f,x);b=setTimeout(i,c);z.fake=true;if(p(f[0])){x=g.getScroll(f);z.left+=x.left-t.left;z.top+=x.top-t.top}d.get("move")&&d.get("node").offset(z);d.fire("drag",z)}else b=null}
var g=this,q=n(d,0,"__dd-scroll-id-"),w=g[h];if(!w[q]){var B=g.get("rate"),C=g.get("diff"),z,v,b=null;d.on("drag",m);d.on("dragend",a);w[q]={drag:d,fn:function(){d.detach("drag",m);d.detach("dragend",a)}}}}});return l},{requires:["base","node","dom"]});
KISSY.add("dd",function(k,r,s,j,l,e,n,c){r={Draggable:s,Droppable:j,DDM:r,Proxy:l,DraggableDelegate:e,DroppableDelegate:n,Scroll:c};k.mix(k,r);return r},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
