/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 19 23:49
*/
KISSY.add("dd/constrain",function(i,l,k){function j(){j.superclass.constructor.apply(this,arguments);this[b]={}}function h(b){var d,o,b=b.drag.get("dragNode"),a=this.get("constrain");if(a){if(!0===a||a.setTimeout){var f;f=!0===a?c(e):c(a);this.__constrainRegion={left:d=f.scrollLeft(),top:o=f.scrollTop(),right:d+f.width(),bottom:o+f.height()}}if(a.nodeType||i.isString(a))a=c(a);a.getDOMNode?(d=a.offset(),this.__constrainRegion={left:d.left,top:d.top,right:d.left+a.outerWidth(),bottom:d.top+a.outerHeight()}):
i.isPlainObject(a)&&(this.__constrainRegion=a);this.__constrainRegion&&(this.__constrainRegion.right-=b.outerWidth(),this.__constrainRegion.bottom-=b.outerHeight())}}function g(a){var a=a.info,d=a.left,b=a.top,e=this.__constrainRegion;e&&(a.left=Math.min(Math.max(e.left,d),e.right),a.top=Math.min(Math.max(e.top,b),e.bottom))}function a(){this.__constrainRegion=null}var c=k.all,b="__constrain_destructors",f=i.stamp,n=i.guid("__dd_constrain"),e=i.Env.host;i.extend(j,l,{__constrainRegion:null,attachDrag:function(e){var d=
this[b],o=f(e,0,n);if(d[o])return this;d[o]=e;e.on("dragstart",h,this).on("dragend",a,this).on("dragalign",g,this);return this},detachDrag:function(e){var d=f(e,1,n),o=this[b];d&&o[d]&&(e.detach("dragstart",h,this).detach("dragend",a,this).detach("dragalign",g,this),delete o[d]);return this},destroy:function(){var a=this,d=i.merge(a[b]);i.each(d,function(d){a.detachDrag(d)})}},{ATTRS:{constrain:{value:!0}}});return j},{requires:["base","node"]});
KISSY.add("dd",function(i,l,k,j,h,g,a,c,b){return{Draggable:k,Droppable:j,DDM:l,Constrain:g,Proxy:h,DraggableDelegate:a,DroppableDelegate:c,Scroll:b}},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(i,l,k,j,h,g){function a(){a.superclass.constructor.apply(this,arguments)}function c(a,b,e){var f=e.get("mode"),g=a.get("validDrops"),c=0,h=0,n=u(e.get("node")),k=o(n);i.each(g,function(a){var p;if(p=a.getNodeFromTarget(b,e.get("dragNode")[0],e.get("node")[0]))if("point"==f)d(u(p),e.mousePos)&&(p=o(u(p)),c?p<h&&(c=a,h=p):(c=a,h=p));else if("intersect"==f)p=o(y(n,u(p))),p>h&&(h=p,c=a);else if("strict"==f&&(p=o(y(n,u(p))),p==k))return c=a,!1});if((g=a.get("activeDrop"))&&
g!=c)g._handleOut(b),e._handleOut(b);a.__set("activeDrop",c);c&&(g!=c?c._handleEnter(b):c._handleOver(b))}function b(a){a._shim=(new h("<div style='background-color:red;position:"+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+m.get("dragCursor")+";z-index:"+x+";'></div>")).prependTo(q.body||q.documentElement).css("opacity",0);b=f;if(w)j.on(r,"resize scroll",s,a);f(a)}function f(a){var d=a.get("activeDrag").get("activeHandler"),b="auto";d&&(b=d.css("cursor"));"auto"==b&&(b=
a.get("dragCursor"));a._shim.css({cursor:b,display:"block"});w&&s.call(a)}function n(a){var d=a.get("drops");a.__set("validDrops",[]);i.each(d,function(a){a._active()})}function e(a){var d=a.get("drops");a.__set("validDrops",[]);i.each(d,function(a){a._deActive()})}function u(a){var d=a.offset();return{left:d.left,right:d.left+(a.__dd_cached_width||a.outerWidth()),top:d.top,bottom:d.top+(a.__dd_cached_height||a.outerHeight())}}function d(a,d){return a.left<=d.left&&a.right>=d.left&&a.top<=d.top&&
a.bottom>=d.top}function o(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function y(a,d){var b=Math.max(a.top,d.top),e=Math.min(a.right,d.right),o=Math.min(a.bottom,d.bottom);return{left:Math.max(a.left,d.left),right:e,top:b,bottom:o}}function z(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var r=i.Env.host,q=r.document,w=6===l.ie,v=i.throttle(function(a){var d;if(d=this.__activeToDrag)a.preventDefault(),d._move(a);else if(d=this.get("activeDrag"))a.preventDefault(),
d._move(a),c(this,a,d)},30),x=999999;a.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var s=i.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:k.docWidth(),height:k.docHeight()})},30);i.extend(a,g,{__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){a=i.indexOf(a,this.get("drops"));-1!=a&&this.get("drops").splice(a,1)},
_regToDrag:function(a){this.__activeToDrag=a;j.on(q,A,this._end,this);j.on(q,t,v,this);6===l.ie&&q.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;this.__set("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&b(this);z(a.get("node"));n(this)},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(){var a=this.get("activeDrag"),d=this.get("activeDrop");j.remove(q,t,v,this);j.remove(q,A,this._end,this);6===l.ie&&q.body.releaseCapture();this.__activeToDrag&&
(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();a&&(a._end(),e(this),d&&d._end(),this.__set("activeDrag",null),this.__set("activeDrop",null))}});var m=new a;m.inRegion=d;m.region=u;m.area=o;m.cacheWH=z;m.PREFIX_CLS="ks-dd-";g="ontouchstart"in q;m.DRAG_START_EVENT=g?"touchstart":"mousedown";var t=m.DRAG_MOVE_EVENT=g?"touchmove":"mousemove",A=m.DRAG_END_EVENT=g?"touchend":"mouseup";m._normalHandlePreDragStart=function(a){return function(d){var b;if(b=d.originalEvent.touches){if(1!=
b.length)return;b=b[0];d.target=d.target||b.target;d.currentTarget=d.currentTarget||b.currentTarget;d.button=d.button||0}a.call(this,d)}};return m},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(i,l,k,j,h){function g(){g.superclass.constructor.apply(this,arguments)}var a=l.PREFIX_CLS,c=l._normalHandlePreDragStart(function(a){var f,c;if(this._checkDragStartValid(a)){f=this.get("handlers");var e=new h(a.target);(f=f.length?this._getHandler(e):e)&&(c=this._getNode(f));c&&(this.__set("activeHandler",f),this.__set("node",c),this.__set("dragNode",c),this._prepare(a))}});i.extend(g,k,{_uiSetDisabledChange:function(b){this.get("container")[b?"addClass":
"removeClass"](a+"-disabled")},_init:function(){this.get("container").on(l.DRAG_START_EVENT,c,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var c=void 0,g=this.get("container"),e=this.get("handlers");a&&a[0]!==g[0];){i.each(e,function(e){if(j.test(a[0],e))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(l.DRAG_START_EVENT,c,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return h.one(a)}},selector:{},handlers:{value:[],getter:0}}});return g},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(i,l,k,j,h){function g(){var a=this;g.superclass.constructor.apply(a,arguments);a.addTarget(h);i.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(b){a.publish(b,{bubbles:1})});a.__set("dragNode",a.get("node"));a.on("afterDisabledChange",a._uiSetDisabledChange,a);var b;(b=a.get("disabled"))&&a._uiSetDisabledChange(b);a._init()}function a(){return!1}var c=i.each,b=l.ie,f=h.PREFIX_CLS,n=i.Env.host.document;
g.POINT="point";g.INTERSECT="intersect";g.STRICT="strict";g.ATTRS={node:{setter:function(a){if(!(a instanceof k))return k.one(a)}},clickPixelThresh:{valueFn:function(){return h.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return h.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));c(a,function(e,c){i.isFunction(e)&&(e=e.call(b));if(i.isString(e)||e.nodeType)e=k.one(e);a[c]=e});b.__set("handlers",a);return a}},
activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](f+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};var e,u=h._normalHandlePreDragStart(function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)});i.extend(g,j,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](f+"-disabled")},_init:function(){this.get("node").on(h.DRAG_START_EVENT,u,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var b=this,e=b.get("handlers"),f=0;c(e,function(e){if(e.contains(a)||e[0]==a)return f=1,b.__set("activeHandler",e),!1});return f},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1<a.button||this.get("disabled")?0:1},_prepare:function(d){var c=this;b&&(e=n.body.onselectstart,
n.body.onselectstart=a);c.get("halt")?d.halt():d.preventDefault();var f=c.get("node"),g=d.pageX,d=d.pageY,f=f.offset();c.startMousePos=c.mousePos={left:g,top:d};c.startNodePos=f;c._diff={left:g-f.left,top:d-f.top};h._regToDrag(c);if(g=c.get("bufferTime"))c._bufferTimer=setTimeout(function(){c._start()},g)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var e,b=this._diff;e=this.startMousePos;var c=a.pageX,a=a.pageY,f=c-b.left,
b=a-b.top;this.get("dragging")?(this.mousePos={left:c,top:a},e={left:f,top:b,pageX:c,pageY:a,drag:this},this.fire("dragalign",{info:e}),c=1,!1===this.fire("drag",e)&&(c=0),c&&this.get("move")&&this.get("node").offset(e)):(b=this.get("clickPixelThresh"),(Math.abs(c-e.left)>=b||Math.abs(a-e.top)>=b)&&this._start())},stopDrag:function(){this.get("dragging")&&h._end()},_end:function(){var a;this._clearBufferTimer();b&&(n.body.onselectstart=e);this.get("dragging")&&(this.get("node").removeClass(f+"drag-over"),
(a=h.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this}),this.__set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(f+"drag-over");this.fire("dragexit",{drag:this,drop:h.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(f+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);
h._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(h.DRAG_START_EVENT,u,this).detach("dragstart",this._fixDragStart);this.detach()}});return g},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,l,k,j,h){function g(){var a=this.get("container"),b=[],f=this.get("selector");a.all(f).each(function(a){l.cacheWH(a);b.push(a)});this.__allNodes=b}function a(){a.superclass.constructor.apply(this,arguments);l.on("dragstart",g,this)}i.extend(a,k,{destroy:function(){a.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(a,b,f){var g={left:a.pageX,top:a.pageY},a=this.__allNodes,e=0,h=Number.MAX_VALUE;a&&i.each(a,function(a){var c=a[0];c===
f||c===b||(c=l.region(a),l.inRegion(c,g)&&(c=l.area(c),c<h&&(h=c,e=a)))});e&&(this.__set("lastNode",this.get("node")),this.__set("node",e));return e},_handleOut:function(){a.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(c){var b=this.get("node"),f=a.superclass._handleOut,g=a.superclass._handleOver,e=a.superclass._handleEnter,i=this.get("lastNode");i[0]!==b[0]?(this.__set("node",i),f.apply(this,arguments),this.__set("node",b),e.call(this,
c)):g.call(this,c)},_end:function(){a.superclass._end.apply(this,arguments);this.__set("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return h.one(a)}}}});return a},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(i,l,k,j){function h(){var a=this;h.superclass.constructor.apply(a,arguments);a.addTarget(j);i.each(["dropexit","dropenter","dropover","drophit"],function(c){a.publish(c,{bubbles:1})});a._init()}var g=j.PREFIX_CLS;h.ATTRS={node:{setter:function(a){if(a)return l.one(a)}},groups:{value:!0}};i.extend(h,k,{getNodeFromTarget:function(a,c,b){var a=this.get("node"),f=a[0];return f==c||f==b?null:a},_init:function(){j._regDrop(this)},_active:function(){var a=j.get("activeDrag"),
c=this.get("node"),b=this.get("groups"),a=a.get("groups");a:if(!0===b)b=1;else{for(var f in b)if(a[f]){b=1;break a}b=0}b?(j._addValidDrop(this),c&&(c.addClass(g+"drop-active-valid"),j.cacheWH(c))):c&&c.addClass(g+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(g+"drop-active-valid").removeClass(g+"drop-active-invalid")},__getCustomEvt:function(a){return i.mix({drag:j.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g+
"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(g+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g+"drop-over");this.fire("drophit",a)},destroy:function(){j._unRegDrop(this)}});return h},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(i,l,k,j){function h(){h.superclass.constructor.apply(this,arguments);this[g]={}}var g="__proxy_destructors",a=i.stamp,c=i.guid("__dd_proxy");h.ATTRS={node:{value:function(a){return new l(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};i.extend(h,k,{attachDrag:function(b){function f(){var a=e.get("node"),c=b.get("node");e.get("proxyNode")?a=e.get("proxyNode"):i.isFunction(a)&&(a=a(b),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
e.set("proxyNode",a));a.show();c.parent().append(a);j.cacheWH(a);a.offset(c.offset());b.__set("dragNode",c);b.__set("node",a)}function h(){var a=e.get("proxyNode");e.get("moveOnEnd")&&b.get("dragNode").offset(a.offset());e.get("destroyOnEnd")?(a.remove(),e.set("proxyNode",0)):a.hide();b.__set("node",b.get("dragNode"))}var e=this,k=e[g],d=a(b,0,c);if(k[d])return e;b.on("dragstart",f);b.on("dragend",h);k[d]={drag:b,fn:function(){b.detach("dragstart",f);b.detach("dragend",h)}};return e},detachDrag:function(b){var b=
a(b,1,c),f=this[g];b&&f[b]&&(f[b].fn(),delete f[b]);return this},destroy:function(){var a=this.get("node"),c=this[g];a&&!i.isFunction(a)&&a.remove();for(var h in c)this.detachDrag(c[h].drag)}});k=h.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return h},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(i,l,k,j,h){function g(){g.superclass.constructor.apply(this,arguments);this[f]={}}var a=i.Env.host,c=i.stamp,b=100,f="__dd_scrolls";g.ATTRS={node:{valueFn:function(){return j.one(a)},setter:function(a){return j.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var n=i.isWindow;i.extend(g,k,{getRegion:function(a){return n(a[0])?{width:h.viewportWidth(),height:h.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return n(a[0])?{left:h.scrollLeft(),
top:h.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},detachDrag:function(a){var b,d=this[f];if((b=c(a,1,"__dd-scroll-id-"))&&d[b])return d[b].fn(),delete d[b],this},destroy:function(){var a=this;i.each(a[f],function(b){a.detachDrag(b.drag)})},attachDrag:function(a){function g(){if(n(r[0]))return 0;var b=a.mousePos,c=l.region(r);return!l.inRegion(c,b)?(clearTimeout(t),t=0,1):0}function d(b){!b.fake&&
!g()&&(s=b,m=i.clone(a.mousePos),b=j.getOffset(r),m.left-=b.left,m.top-=b.top,t||k())}function h(){clearTimeout(t);t=null}function k(){if(!g()){var c=j.getRegion(r),d=c.width,c=c.height,f=j.getScroll(r),h=i.clone(f),l=!1;m.top-c>=-x[1]&&(f.top+=v[1],l=!0);m.top<=x[1]&&(f.top-=v[1],l=!0);m.left-d>=-x[0]&&(f.left+=v[0],l=!0);m.left<=x[0]&&(f.left-=v[0],l=!0);l?(j.setScroll(r,f),t=setTimeout(k,b),s.fake=!0,n(r[0])&&(f=j.getScroll(r),s.left+=f.left-h.left,s.top+=f.top-h.top),a.get("move")&&a.get("node").offset(s),
a.fire("drag",s)):t=null}}var j=this,r=j.get("node"),q=c(a,0,"__dd-scroll-id-"),w=j[f];if(!w[q]){var v=j.get("rate"),x=j.get("diff"),s,m,t=null;a.on("drag",d);a.on("dragstart",function(){l.cacheWH(r)});a.on("dragend",h);w[q]={drag:a,fn:function(){a.detach("drag",d);a.detach("dragend",h)}};return this}}});k=g.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return g},{requires:["./ddm","base","node","dom"]});
