/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 26 01:52
*/
KISSY.add("dd/constrain",function(e,k,j){function i(){i.superclass.constructor.apply(this,arguments);this[c]={}}function f(c){var b,p,c=c.drag.get("dragNode"),a=this.get("constrain");if(a){if(!0===a||a.setTimeout){var d;d=!0===a?l(h):l(a);this.__constrainRegion={left:b=d.scrollLeft(),top:p=d.scrollTop(),right:b+d.width(),bottom:p+d.height()}}if(a.nodeType||"string"==typeof a)a=l(a);a.getDOMNode?(b=a.offset(),this.__constrainRegion={left:b.left,top:b.top,right:b.left+a.outerWidth(),bottom:b.top+a.outerHeight()}):
e.isPlainObject(a)&&(this.__constrainRegion=a);this.__constrainRegion&&(this.__constrainRegion.right-=c.outerWidth(),this.__constrainRegion.bottom-=c.outerHeight())}}function g(c){var b={},a=c.left,h=c.top,d=this.__constrainRegion;d&&(b.left=Math.min(Math.max(d.left,a),d.right),b.top=Math.min(Math.max(d.top,h),d.bottom),c.drag.setInternal("actualPos",b))}function a(){this.__constrainRegion=null}var l=j.all,c="__constrain_destructors",d=e.stamp,o=e.guid("__dd_constrain"),h=e.Env.host;e.extend(i,k,
{__constrainRegion:null,attachDrag:function(h){var b=this[c],p=d(h,0,o);if(b[p])return this;b[p]=h;h.on("dragstart",f,this).on("dragend",a,this).on("dragalign",g,this);return this},detachDrag:function(h){var b=d(h,1,o),p=this[c];b&&p[b]&&(h.detach("dragstart",f,this).detach("dragend",a,this).detach("dragalign",g,this),delete p[b]);return this},destroy:function(){var a=this,b=e.merge(a[c]);e.each(b,function(b){a.detachDrag(b)})}},{ATTRS:{constrain:{value:!0}}});return i},{requires:["base","node"]});
KISSY.add("dd",function(e,k,j,i,f,g,a,l,c){e={Draggable:j,Droppable:i,DDM:k,Constrain:g,Proxy:f,DraggableDelegate:a,DroppableDelegate:l,Scroll:c};return KISSY.DD=e},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(e,k,j,i,f,g){function a(){a.superclass.constructor.apply(this,arguments)}function l(m,c,a){var h=a.get("mode"),d=m.get("validDrops"),f=0,l=0,g=v(a.get("node")),o=p(g);e.each(d,function(m){var d;if(d=m.getNodeFromTarget(c,a.get("dragNode")[0],a.get("node")[0]))if("point"==h)b(v(d),a.mousePos)&&(d=p(v(d)),f?d<l&&(f=m,l=d):(f=m,l=d));else if("intersect"==h)d=p(z(g,v(d))),d>l&&(l=d,f=m);else if("strict"==h&&(d=p(z(g,v(d))),d==o))return f=m,!1});if((d=m.get("activeDrop"))&&
d!=f)d._handleOut(c),a._handleOut(c);m.setInternal("activeDrop",f);f&&(d!=f?f._handleEnter(c):f._handleOver(c))}function c(m){m._shim=(new f('<div style="background-color:red;position:'+(x?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+u.get("dragCursor")+";z-index:"+y+';"></div>')).prependTo(t.body||t.documentElement).css("opacity",0);c=d;if(x)i.on(s,"resize scroll",B,m);d(m)}function d(m){var b=m.get("activeDrag").get("activeHandler"),c="auto";b&&(c=b.css("cursor"));"auto"==
c&&(c=m.get("dragCursor"));m._shim.css({cursor:c,display:"block"});x&&B.call(m)}function o(m){var b=m.get("drops");m.setInternal("validDrops",[]);e.each(b,function(b){b._active()})}function h(b){var c=b.get("drops");b.setInternal("validDrops",[]);e.each(c,function(b){b._deActive()})}function v(b){var c=b.offset();return{left:c.left,right:c.left+(b.__dd_cached_width||b.outerWidth()),top:c.top,bottom:c.top+(b.__dd_cached_height||b.outerHeight())}}function b(b,c){return b.left<=c.left&&b.right>=c.left&&
b.top<=c.top&&b.bottom>=c.top}function p(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function z(b,c){var a=Math.max(b.top,c.top),d=Math.min(b.right,c.right),h=Math.min(b.bottom,c.bottom);return{left:Math.max(b.left,c.left),right:d,top:a,bottom:h}}function A(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var s=e.Env.host,t=s.document,x=6===k.ie,w=e.throttle(function(b){var c;if(c=this.__activeToDrag)b.preventDefault(),c._move(b);else if(c=
this.get("activeDrag"))b.preventDefault(),c._move(b),l(this,b,c)},30),y=999999,q="msPointerEnabled"in s.navigator,n,r;"ontouchstart"in t?(q="touchstart",n="touchmove",r="touchend"):q?(q="MSPointerDown",n="MSPointerMove",r="MSPointerUp"):(q="mousedown",n="mousemove",r="mouseup");a.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var B=e.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&
this._shim.css({width:j.docWidth(),height:j.docHeight()})},30);e.extend(a,g,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=e.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;i.on(t,r,this._end,this);i.on(t,n,w,this);k.ie===6&&t.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);A(b.get("node"));
o(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),c=this.get("activeDrop");i.remove(t,n,w,this);i.remove(t,r,this._end,this);k.ie===6&&t.body.releaseCapture();if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();h(this);c&&c._end();this.setInternal("activeDrag",null);this.setInternal("activeDrop",null)}}});var u=new a;u.inRegion=b;u.region=v;u.area=p;u.cacheWH=A;u.PREFIX_CLS=
"ks-dd-";u._normalHandlePreDragStart=function(b){return function(c){var a;if(a=c.originalEvent.touches){if(a.length!=1)return;a=a[0];c.target=c.target||a.target;c.currentTarget=c.currentTarget||a.currentTarget;c.button=c.button||0}b.call(this,c)}};u.DRAG_START_EVENT=q;u.DRAG_MOVE_EVENT=n;u.DRAG_END_EVENT=r;return u},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(e,k,j,i,f){function g(){g.superclass.constructor.apply(this,arguments)}var a=k.PREFIX_CLS,l=k._normalHandlePreDragStart(function(c){var a,e;if(this._checkDragStartValid(c)){a=this.get("handlers");var h=new f(c.target);(a=a.length?this._getHandler(h):h)&&(e=this._getNode(a));e&&(this.setInternal("activeHandler",a),this.setInternal("node",e),this.setInternal("dragNode",e),this._prepare(c))}});e.extend(g,j,{_uiSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](a+"-disabled")},_init:function(){this.get("container").on(k.DRAG_START_EVENT,l,this).on("dragstart",this._fixDragStart)},_getHandler:function(c){for(var a=void 0,f=this.get("container"),h=this.get("handlers");c&&c[0]!==f[0];){e.each(h,function(h){if(i.test(c[0],h))return a=c,!1});if(a)break;c=c.parent()}return a},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(k.DRAG_START_EVENT,l,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(c){return f.one(c)}},selector:{},handlers:{value:[],getter:0}}});return g},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(e,k,j,i,f){function g(){g.superclass.constructor.apply(this,arguments);this.addTarget(f);this.setInternal("dragNode",this.get("node"));this.on("afterDisabledChange",this._uiSetDisabledChange,this);var b;(b=this.get("disabled"))&&this._uiSetDisabledChange(b);this._init()}function a(){return!1}var l=e.each,c=k.ie,d=f.PREFIX_CLS,o=e.Env.host.document;g.ATTRS={node:{setter:function(b){if(!(b instanceof j))return j.one(b)}},clickPixelThresh:{valueFn:function(){return f.get("clickPixelThresh")}},
bufferTime:{valueFn:function(){return f.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var c=this;b.length||(b[0]=c.get("node"));l(b,function(a,h){e.isFunction(a)&&(a=a.call(c));if("string"==typeof a||a.nodeType)a=j.one(a);b[h]=a});c.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},
halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}};g.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};e.mix(g,g.DropMode);var h,v=f._normalHandlePreDragStart(function(b){var c=b.target;this._checkDragStartValid(b)&&this._checkHandler(c)&&this._prepare(b)});e.extend(g,i,{_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d+"-disabled")},_init:function(){this.get("node").on(f.DRAG_START_EVENT,v,
this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var c=this,a=c.get("handlers"),h=0;l(a,function(a){if(a.contains(b)||a[0]==b)return h=1,c.setInternal("activeHandler",a),!1});return h},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var d=this;c&&(h=o.body.onselectstart,o.body.onselectstart=a);d.get("halt")?b.halt():b.preventDefault();var e=d.get("node"),
l=b.pageX,b=b.pageY,e=e.offset();d.setInternal("startMousePos",d.mousePos={left:l,top:b});d.setInternal("startNodePos",e);d.setInternal("deltaPos",{left:l-e.left,top:b-e.top});f._regToDrag(d);if(l=d.get("bufferTime"))d._bufferTimer=setTimeout(function(){d._start()},1E3*l)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var c;c=b.pageX;b=b.pageY;if(this.get("dragging")){var a=this.get("deltaPos"),h=c-a.left,a=b-a.top;this.mousePos=
{left:c,top:b};c={left:h,top:a,pageX:c,pageY:b,drag:this};this.setInternal("actualPos",{left:h,top:a});this.fire("dragalign",c);b=1;!1===this.fire("drag",c)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))}else h=this.get("startMousePos"),a=this.get("clickPixelThresh"),(Math.abs(c-h.left)>=a||Math.abs(b-h.top)>=a)&&this._start()},stopDrag:function(){this.get("dragging")&&f._end()},_end:function(){var b;this._clearBufferTimer();c&&(o.body.onselectstart=h);this.get("dragging")&&
(this.get("node").removeClass(d+"drag-over"),(b=f.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(d+"drag-over");this.fire("dragexit",{drag:this,drop:f.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(d+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();
this.setInternal("dragging",1);f._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(f.DRAG_START_EVENT,v,this).detach("dragstart",this._fixDragStart);this.detach()}});return g},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(e,k,j,i,f){function g(){var a=this.get("container"),c=[],d=this.get("selector");a.all(d).each(function(a){k.cacheWH(a);c.push(a)});this.__allNodes=c}function a(){a.superclass.constructor.apply(this,arguments);k.on("dragstart",g,this)}e.extend(a,j,{destroy:function(){a.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(a,c,d){var f={left:a.pageX,top:a.pageY},a=this.__allNodes,h=0,g=Number.MAX_VALUE;a&&e.each(a,function(b){var a=b[0];a===
d||a===c||(a=k.region(b),k.inRegion(a,f)&&(a=k.area(a),a<g&&(g=a,h=b)))});h&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",h));return h},_handleOut:function(){a.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(e){var c=this.get("node"),d=a.superclass._handleOut,f=a.superclass._handleOver,h=a.superclass._handleEnter,g=this.get("lastNode");g[0]!==c[0]?(this.setInternal("node",g),d.apply(this,arguments),
this.setInternal("node",c),h.call(this,e)):f.call(this,e)},_end:function(){a.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return f.one(a)}}}});return a},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(e,k,j,i){function f(){f.superclass.constructor.apply(this,arguments);this.addTarget(i);this._init()}var g=i.PREFIX_CLS;f.ATTRS={node:{setter:function(a){if(a)return k.one(a)}},groups:{value:!0}};e.extend(f,j,{getNodeFromTarget:function(a,e,c){var a=this.get("node"),d=a[0];return d==e||d==c?null:a},_init:function(){i._regDrop(this)},_active:function(){var a=i.get("activeDrag"),e=this.get("node"),c=this.get("groups"),a=a.get("groups");a:if(!0===c)c=1;else{for(var d in c)if(a[d]){c=
1;break a}c=0}c?(i._addValidDrop(this),e&&(e.addClass(g+"drop-active-valid"),i.cacheWH(e))):e&&e.addClass(g+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(g+"drop-active-valid").removeClass(g+"drop-active-invalid")},__getCustomEvt:function(a){return e.mix({drag:i.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);
a.drag._handleEnter(a);this.get("node").addClass(g+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g+"drop-over");this.fire("drophit",a)},destroy:function(){i._unRegDrop(this)}});return f},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(e,k,j,i){function f(){f.superclass.constructor.apply(this,arguments);this[g]={}}var g="__proxy_destructors",a=e.stamp,l=e.guid("__dd_proxy");f.ATTRS={node:{value:function(a){return new k(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};e.extend(f,j,{attachDrag:function(c){function d(){var b=h.get("node"),a=c.get("node");h.get("proxyNode")?b=h.get("proxyNode"):e.isFunction(b)&&(b=b(c),b.addClass("ks-dd-proxy"),b.css("position","absolute"),
h.set("proxyNode",b));b.show();a.parent().append(b);i.cacheWH(b);b.offset(a.offset());c.setInternal("dragNode",a);c.setInternal("node",b)}function f(){var b=h.get("proxyNode");h.get("moveOnEnd")&&c.get("dragNode").offset(b.offset());h.get("destroyOnEnd")?(b.remove(),h.set("proxyNode",0)):b.hide();c.setInternal("node",c.get("dragNode"))}var h=this,j=h[g],b=a(c,0,l);if(j[b])return h;c.on("dragstart",d);c.on("dragend",f);j[b]={drag:c,fn:function(){c.detach("dragstart",d);c.detach("dragend",f)}};return h},
detachDrag:function(c){var c=a(c,1,l),d=this[g];c&&d[c]&&(d[c].fn(),delete d[c]);return this},destroy:function(){var a=this.get("node"),d=this[g];a&&!e.isFunction(a)&&a.remove();for(var f in d)this.detachDrag(d[f].drag)}});j=f.prototype;j.attach=j.attachDrag;j.unAttach=j.detachDrag;return f},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(e,k,j,i,f){function g(){g.superclass.constructor.apply(this,arguments);this[d]={}}var a=e.Env.host,l=e.stamp,c=100,d="__dd_scrolls";g.ATTRS={node:{valueFn:function(){return i.one(a)},setter:function(a){return i.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var o=e.isWindow;e.extend(g,j,{getRegion:function(a){return o(a[0])?{width:f.viewportWidth(),height:f.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return o(a[0])?{left:f.scrollLeft(),
top:f.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,c){a.scrollLeft(c.left);a.scrollTop(c.top)},detachDrag:function(a){var c,b=this[d];if(!(c=l(a,1,"__dd-scroll-id-"))||!b[c])return this;b[c].fn();delete b[c];return this},destroy:function(){var a=this;e.each(a[d],function(c){a.detachDrag(c.drag)})},attachDrag:function(a){function f(){if(o(s[0]))return 0;var b=a.mousePos,c=k.region(s);return!k.inRegion(c,b)?(clearTimeout(r),r=0,1):
0}function b(b){!b.fake&&!f()&&(q=b,n=e.clone(a.mousePos),b=i.getOffset(s),n.left-=b.left,n.top-=b.top,r||j())}function g(){clearTimeout(r);r=null}function j(){if(!f()){var b=i.getRegion(s),d=b.width,b=b.height,g=i.getScroll(s),l=e.clone(g),k=!1;n.top-b>=-y[1]&&(g.top+=w[1],k=!0);n.top<=y[1]&&(g.top-=w[1],k=!0);n.left-d>=-y[0]&&(g.left+=w[0],k=!0);n.left<=y[0]&&(g.left-=w[0],k=!0);k?(i.setScroll(s,g),r=setTimeout(j,c),q.fake=!0,o(s[0])&&(g=i.getScroll(s),q.left+=g.left-l.left,q.top+=g.top-l.top),
a.get("move")&&a.get("node").offset(q),a.fire("drag",q)):r=null}}var i=this,s=i.get("node"),t=l(a,0,"__dd-scroll-id-"),x=i[d];if(x[t])return this;var w=i.get("rate"),y=i.get("diff"),q,n,r=null;a.on("drag",b);a.on("dragstart",function(){k.cacheWH(s)});a.on("dragend",g);x[t]={drag:a,fn:function(){a.detach("drag",b);a.detach("dragend",g)}};return this}});j=g.prototype;j.attach=j.attachDrag;j.unAttach=j.detachDrag;return g},{requires:["./ddm","base","node","dom"]});
