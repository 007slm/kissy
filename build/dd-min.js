/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 22 14:09
*/
KISSY.add("dd/constrain",function(j,r,s){function o(){o.superclass.constructor.apply(this,arguments)}function n(h){var e,k;h=h.drag.get("dragNode");var a=this.get("constrain");if(a){if(a===true){var f=g(c);this.__constrainRegion={left:e=f.scrollLeft(),top:k=f.scrollTop(),right:e+f.width(),bottom:k+f.height()}}if(a.nodeType||j.isString(a))a=g(a);if(a.getDOMNode){e=a.offset();this.__constrainRegion={left:e.left,top:e.top,right:e.left+a.outerWidth(),bottom:e.top+a.outerHeight()}}else if(j.isPlainObject(a))this.__constrainRegion=
a;if(this.__constrainRegion){this.__constrainRegion.right-=h.outerWidth();this.__constrainRegion.bottom-=h.outerHeight()}}}function d(h){h=h.info;var e=h.left,k=h.top,a=this.__constrainRegion;if(a){h.left=Math.min(Math.max(a.left,e),a.right);h.top=Math.min(Math.max(a.top,k),a.bottom)}}function m(){this.__constrainRegion=null}var g=s.all,c=j.Env.host;j.extend(o,r,{__constrainRegion:null,attach:function(h){h.on("dragstart",n,this).on("dragend",m,this).on("dragalign",d,this)},unAttach:function(h){h.detach("dragstart",
n,this).detach("dragend",m,this).detach("dragalign",d,this)}},{ATTRS:{constrain:{value:true}}});return o},{requires:["base","node"]});KISSY.add("dd",function(j,r,s,o,n,d,m,g,c){return{Draggable:s,Droppable:o,DDM:r,Constrain:d,Proxy:n,DraggableDelegate:m,DroppableDelegate:g,Scroll:c}},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/constrain","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
KISSY.add("dd/ddm",function(j,r,s,o,n,d){function m(){m.superclass.constructor.apply(this,arguments)}function g(b,i){var q=b.get("activeDrag"),w=q.get("mode"),A=b.get("validDrops"),t=0,E=0,G=a(q.get("node")),H=l(G);j.each(A,function(F){var v;if(v=F.getNodeFromTarget(i,q.get("dragNode")[0],q.get("node")[0]))if(w=="point"){if(f(a(v),q.mousePos)){v=l(a(v));if(t){if(v<E){t=F;E=v}}else{t=F;E=v}}}else if(w=="intersect"){v=l(p(G,a(v)));if(v>E){E=v;t=F}}else if(w=="strict"){v=l(p(G,a(v)));if(v==H){t=F;return false}}});
if((A=b.get("activeDrop"))&&A!=t){A._handleOut(i);q._handleOut(i)}b.__set("activeDrop",t);if(t)A!=t?t._handleEnter(i):t._handleOver(i)}function c(b){b._shim=(new n("<div style='background-color:red;position:"+(C?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+x.get("dragCursor")+";z-index:"+D+";'></div>")).prependTo(y.body||y.documentElement).css("opacity",0);c=h;C&&o.on(u,"resize scroll",z,b);h(b)}function h(b){var i=b.get("activeDrag").get("activeHandler"),q="auto";if(i)q=i.css("cursor");
if(q=="auto")q=b.get("dragCursor");b._shim.css({cursor:q,display:"block"});C&&z.call(b)}function e(b){var i=b.get("drops");b.__set("validDrops",[]);j.each(i,function(q){q._active()})}function k(b){var i=b.get("drops");b.__set("validDrops",[]);j.each(i,function(q){q._deActive()})}function a(b){var i=b.offset();return{left:i.left,right:i.left+b.outerWidth(),top:i.top,bottom:i.top+b.outerHeight()}}function f(b,i){return b.left<=i.left&&b.right>=i.left&&b.top<=i.top&&b.bottom>=i.top}function l(b){if(b.top>=
b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function p(b,i){return{left:Math.max(b.left,i.left),right:Math.min(b.right,i.right),top:Math.max(b.top,i.top),bottom:Math.min(b.bottom,i.bottom)}}var u=j.Env.host,y=u.document,C=r.ie===6,B=j.throttle(function(b){var i=this.__activeToDrag,q=this.get("activeDrag");if(q||i)b.preventDefault();if(q){q._move(b);g(this,b)}else i&&i._move(b)},30),D=999999;m.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},
bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var z=j.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:s.docWidth(),height:s.docHeight()})},30);j.extend(m,d,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=j.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){o.on(y,"mouseup",this._end,this);o.on(y,"mousemove",B,this);this.__activeToDrag=
b},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);e(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),i=this.get("activeDrop");o.remove(y,"mousemove",B,this);o.remove(y,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();k(this);i&&i._end();this.__set("activeDrag",
null);this.__set("activeDrop",null)}}});var x=new m;x.inRegion=f;x.region=a;x.area=l;return x},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(j,r,s,o,n){function d(){d.superclass.constructor.apply(this,arguments)}function m(g){var c,h;if(this._checkMouseDown(g)){c=this.get("handlers");var e=new n(g.target);if(c=c.length?this._getHandler(e):e)h=this._getNode(c);if(h){this.__set("activeHandler",c);this.__set("node",h);this.__set("dragNode",h);this._prepare(g)}}}j.extend(d,s,{_init:function(){this.get("container").on("mousedown",m,this).on("dragstart",this._fixDragStart)},_getHandler:function(g){for(var c=
undefined,h=this.get("container"),e=this.get("handlers");g&&g[0]!==h[0];){j.each(e,function(k){if(o.test(g[0],k)){c=g;return false}});if(c)break;g=g.parent()}return c},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",m,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(g){return n.one(g)}},selector:{},handlers:{value:[],getter:0}}});return d},{requires:["./ddm",
"./draggable","dom","node"]});
KISSY.add("dd/draggable",function(j,r,s,o,n){function d(){var a=this;d.superclass.constructor.apply(a,arguments);a.addTarget(n);j.each(["dragalign","drag","dragdrophit","dragend","dragdropmiss","dragexit","dragenter","dragover","dragstart"],function(f){a.publish(f,{bubbles:1})});a._init()}function m(){return false}function g(a){var f=a.target;this._checkMouseDown(a)&&this._check(f)&&this._prepare(a)}var c=j.each,h=r.ie,e=j.Env.host.document;d.POINT="point";d.INTERSECT="intersect";d.STRICT="strict";
d.ATTRS={node:{setter:function(a){return s.one(a)}},clickPixelThresh:{valueFn:function(){return n.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return n.get("bufferTime")}},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var f=this;a.length||(a[0]=f.get("node"));c(a,function(l,p){if(j.isFunction(l))l=l.call(f);if(j.isString(l)||l.nodeType)l=s.one(l);a[p]=l});f.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](n.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](n.get("prefixCls")+"-disabled");return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true},groups:{value:{}}};var k;j.extend(d,o,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.__set("dragNode",a);a.on("mousedown",g,this).on("dragstart",this._fixDragStart)},
_fixDragStart:function(a){a.preventDefault()},_check:function(a){var f=this,l=f.get("handlers"),p=0;c(l,function(u){if(u.contains(a)||u[0]==a){p=1;f.__set("activeHandler",u);return false}});return p},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var f=this;if(h){k=e.body.onselectstart;e.body.onselectstart=m}f.get("halt")?a.halt():a.preventDefault();var l=f.get("node"),p=a.pageX;a=a.pageY;l=l.offset();f.startMousePos=
f.mousePos={left:p,top:a};f.startNodePos=l;f._diff={left:p-l.left,top:a-l.top};n._regToDrag(f);if(p=f.get("bufferTime"))f._bufferTimer=setTimeout(function(){f._start()},p)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var f,l=this._diff;f=this.startMousePos;var p=a.pageX;a=a.pageY;var u=p-l.left;l=a-l.top;if(this.get("dragging")){this.mousePos={left:p,top:a};f={left:u,top:l,pageX:p,pageY:a,drag:this};this.fire("dragalign",
{info:f});p=1;if(this.fire("drag",f)===false)p=0;p&&this.get("move")&&this.get("node").offset(f)}else{l=this.get("clickPixelThresh");if(Math.abs(p-f.left)>=l||Math.abs(a-f.top)>=l)this._start()}},_end:function(){var a;this._clearBufferTimer();if(h)e.body.onselectstart=k;if(this.get("dragging")){this.get("node").removeClass(n.get("prefixCls")+"drag-over");(a=n.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.__set("dragging",0);this.fire("dragend",
{drag:this})}},_handleOut:function(){this.get("node").removeClass(n.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:n.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(n.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);n._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",g,this).detach("dragstart",
this._fixDragStart);this.detach()}});return d},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(j,r,s,o,n){function d(){var g=this.get("container"),c=this.get("selector");this.__allNodes=g.all(c)}function m(){m.superclass.constructor.apply(this,arguments);r.on("dragstart",d,this)}j.extend(m,s,{getNodeFromTarget:function(g,c,h){var e={left:g.pageX,top:g.pageY};g=this.__allNodes;var k=0,a=Number.MAX_VALUE;g&&g.each(function(f){var l=f[0];if(!(l===h||l===c))if(r.inRegion(r.region(f),e)){l=r.area(r.region(f));if(l<a){a=l;k=f}}});if(k){this.__set("lastNode",
this.get("node"));this.__set("node",k)}return k},_handleOut:function(){m.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(g){var c=this.get("node"),h=m.superclass._handleOut,e=m.superclass._handleOver,k=m.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==c[0]){this.__set("node",a);h.apply(this,arguments);this.__set("node",c);k.call(this,g)}else e.call(this,g)},_end:function(){m.superclass._end.apply(this,arguments);this.__set("node",
0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(g){return n.one(g)}}}});return m},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(j,r,s,o){function n(){var d=this;n.superclass.constructor.apply(d,arguments);d.addTarget(o);j.each(["dropexit","dropenter","dropover","drophit"],function(m){d.publish(m,{bubbles:1})});d._init()}n.ATTRS={node:{setter:function(d){if(d)return r.one(d)}},groups:{value:true}};j.extend(n,s,{getNodeFromTarget:function(d,m,g){d=this.get("node");var c=d[0];return c==m||c==g?null:d},_init:function(){o._regDrop(this)},_active:function(){var d=o.get("activeDrag"),m=this.get("node"),
g=this.get("groups"),c=d.get("groups");d=o.get("prefixCls");a:if(g===true)g=1;else{for(var h in g)if(c[h]){g=1;break a}g=0}if(g){o._addValidDrop(this);m&&m.addClass(d+"drop-active-valid")}else m&&m.addClass(d+"drop-active-invalid")},_deActive:function(){var d=this.get("node"),m=o.get("prefixCls");d&&d.removeClass(m+"drop-active-valid").removeClass(m+"drop-active-invalid")},__getCustomEvt:function(d){return j.mix({drag:o.get("activeDrag"),drop:this},d)},_handleOut:function(){var d=this.__getCustomEvt();
this.get("node").removeClass(o.get("prefixCls")+"drop-over");this.fire("dropexit",d)},_handleEnter:function(d){d=this.__getCustomEvt(d);d.drag._handleEnter(d);this.get("node").addClass(o.get("prefixCls")+"drop-over");this.fire("dropenter",d)},_handleOver:function(d){d=this.__getCustomEvt(d);d.drag._handleOver(d);this.fire("dropover",d)},_end:function(){var d=this.__getCustomEvt();this.get("node").removeClass(o.get("prefixCls")+"drop-over");this.fire("drophit",d)},destroy:function(){o._unRegDrop(this)}});
return n},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(j,r,s){function o(){o.superclass.constructor.apply(this,arguments);this[n]={}}var n="__proxy_destructors",d=j.stamp,m=j.guid("__dd_proxy"),g="__proxy";o.ATTRS={node:{value:function(c){return new r(c.get("node").clone(true))}},destroyOnEnd:{value:false},moveOnEnd:{value:true}};j.extend(o,s,{attach:function(c){function h(){var f=k.get("node"),l=c.get("node");if(k[g])f=k[g];else if(j.isFunction(f)){f=f(c);f.addClass("ks-dd-proxy");f.css("position","absolute");k[g]=f}l.parent().append(f);
f.show();f.offset(l.offset());c.__set("dragNode",l);c.__set("node",f)}function e(){var f=k[g];k.get("moveOnEnd")&&c.get("dragNode").offset(f.offset());if(k.get("destroyOnEnd")){f.remove();k[g]=0}else f.hide();c.__set("node",c.get("dragNode"))}var k=this,a=d(c,1,m);if(!(a&&k[n][a])){c.on("dragstart",h);c.on("dragend",e);a=d(c,0,m);k[n][a]={drag:c,fn:function(){c.detach("dragstart",h);c.detach("dragend",e)}}}},unAttach:function(c){c=d(c,1,m);var h=this[n];if(c&&h[c]){h[c].fn();delete h[c]}},destroy:function(){var c=
this.get("node"),h=this[n];c&&!j.isFunction(c)&&c.remove();for(var e in h)this.unAttach(h[e].drag)}});return o},{requires:["node","base"]});
KISSY.add("dd/scroll",function(j,r,s,o){function n(){n.superclass.constructor.apply(this,arguments);this[c]={}}var d=j.Env.host,m=j.stamp,g=100,c="__dd_scrolls";n.ATTRS={node:{valueFn:function(){return s.one(d)},setter:function(e){return s.one(e)}},rate:{value:[10,10]},diff:{value:[20,20]}};var h=j.isWindow;j.extend(n,r,{getRegion:function(e){return h(e[0])?{width:o.viewportWidth(),height:o.viewportHeight()}:{width:e.outerWidth(),height:e.outerHeight()}},getOffset:function(e){return h(e[0])?{left:o.scrollLeft(),
top:o.scrollTop()}:e.offset()},getScroll:function(e){return{left:e.scrollLeft(),top:e.scrollTop()}},setScroll:function(e,k){e.scrollLeft(k.left);e.scrollTop(k.top)},unAttach:function(e){var k,a=this[c];if((k=m(e,1,"__dd-scroll-id-"))&&a[k]){a[k].fn();delete a[k]}},destroy:function(){var e=this[c],k;for(k in e)this.unAttach(e[k].drag)},attach:function(e){function k(){var i=e.get("dragNode");if(!u.contains(i)){clearTimeout(b);b=0;return 1}return 0}function a(i){if(!i.fake)if(!k()){z=i;x=j.clone(e.mousePos);
i=p.getOffset(u);x.left-=i.left;x.top-=i.top;b||l()}}function f(){clearTimeout(b);b=null}function l(){if(!k()){var i=p.getRegion(u),q=i.width;i=i.height;var w=p.getScroll(u),A=j.clone(w),t=false;if(x.top-i>=-D[1]){w.top+=B[1];t=true}if(x.top<=D[1]){w.top-=B[1];t=true}if(x.left-q>=-D[0]){w.left+=B[0];t=true}if(x.left<=D[0]){w.left-=B[0];t=true}if(t){p.setScroll(u,w);b=setTimeout(l,g);z.fake=true;if(h(u[0])){w=p.getScroll(u);z.left+=w.left-A.left;z.top+=w.top-A.top}e.get("move")&&e.get("node").offset(z);
e.fire("drag",z)}else b=null}}var p=this,u=p.get("node"),y=m(e,0,"__dd-scroll-id-"),C=p[c];if(!C[y]){var B=p.get("rate"),D=p.get("diff"),z,x,b=null;e.on("drag",a);e.on("dragend",f);C[y]={drag:e,fn:function(){e.detach("drag",a);e.detach("dragend",f)}}}}});return n},{requires:["base","node","dom"]});
