/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 17 11:29
*/
KISSY.add("dd/constrain",function(e,j,i){function h(){h.superclass.constructor.apply(this,arguments)}function d(c){var d,g,c=c.drag.get("dragNode"),b=this.get("constrain");if(b){if(!0===b){var q=a(m);this.__constrainRegion={left:d=q.scrollLeft(),top:g=q.scrollTop(),right:d+q.width(),bottom:g+q.height()}}if(b.nodeType||e.isString(b))b=a(b);b.getDOMNode?(d=b.offset(),this.__constrainRegion={left:d.left,top:d.top,right:d.left+b.outerWidth(),bottom:d.top+b.outerHeight()}):e.isPlainObject(b)&&(this.__constrainRegion=
b);this.__constrainRegion&&(this.__constrainRegion.right-=c.outerWidth(),this.__constrainRegion.bottom-=c.outerHeight())}}function c(a){var a=a.info,c=a.left,g=a.top,b=this.__constrainRegion;b&&(a.left=Math.min(Math.max(b.left,c),b.right),a.top=Math.min(Math.max(b.top,g),b.bottom))}function f(){this.__constrainRegion=null}var a=i.all,m=e.Env.host;e.extend(h,j,{__constrainRegion:null,attachDrag:function(a){a.on("dragstart",d,this).on("dragend",f,this).on("dragalign",c,this)},detachDrag:function(a){a.detach("dragstart",
d,this).detach("dragend",f,this).detach("dragalign",c,this)}},{ATTRS:{constrain:{value:!0}}});return h},{requires:["base","node"]});KISSY.add("dd",function(e,j,i,h,d,c,f,a,m){return{Draggable:i,Droppable:h,DDM:j,Constrain:c,Proxy:d,DraggableDelegate:f,DroppableDelegate:a,Scroll:m}},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(e,j,i,h,d,c){function f(){f.superclass.constructor.apply(this,arguments)}function a(a,c,g){var d=g.get("mode"),m=a.get("validDrops"),f=0,h=0,k=b(g.get("node")),i=v(k);e.each(m,function(a){var l;if(l=a.getNodeFromTarget(c,g.get("dragNode")[0],g.get("node")[0]))if("point"==d)q(b(l),g.mousePos)&&(l=v(b(l)),f?l<h&&(f=a,h=l):(f=a,h=l));else if("intersect"==d)l=v(x(k,b(l))),l>h&&(h=l,f=a);else if("strict"==d&&(l=v(x(k,b(l))),l==i))return f=a,!1});if((m=a.get("activeDrop"))&&
m!=f)m._handleOut(c),g._handleOut(c);a.__set("activeDrop",f);f&&(m!=f?f._handleEnter(c):f._handleOver(c))}function m(b){b._shim=(new d("<div style='background-color:red;position:"+(t?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+p.get("dragCursor")+";z-index:"+u+";'></div>")).prependTo(n.body||n.documentElement).css("opacity",0);m=o;if(t)h.on(y,"resize scroll",s,b);o(b)}function o(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==c&&(c=
b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});t&&s.call(b)}function k(b){var a=b.get("drops");b.__set("validDrops",[]);e.each(a,function(b){b._active()})}function g(b){var a=b.get("drops");b.__set("validDrops",[]);e.each(a,function(b){b._deActive()})}function b(b){var a=b.offset();return{left:a.left,right:a.left+b.outerWidth(),top:a.top,bottom:a.top+b.outerHeight()}}function q(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&b.bottom>=a.top}function v(b){return b.top>=b.bottom||
b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function x(b,a){var c=Math.max(b.top,a.top),g=Math.min(b.right,a.right),q=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:g,top:c,bottom:q}}var y=e.Env.host,n=y.document,t=6===j.ie,w=e.throttle(function(b){var c=this.__activeToDrag,g=this.get("activeDrag");(g||c)&&b.preventDefault();g?(g._move(b),a(this,b,g)):c&&c._move(b)},30),u=999999;f.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},
bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var s=e.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:i.docWidth(),height:i.docHeight()})},30);e.extend(f,c,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=e.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;h.on(n,"mouseup",this._end,this);h.on(n,"mousemove",
w,this);6===j.ie&&n.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&m(this);k(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");h.remove(n,"mousemove",w,this);h.remove(n,"mouseup",this._end,this);6===j.ie&&n.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();
b&&(b._end(),g(this),a&&a._end(),this.__set("activeDrag",null),this.__set("activeDrop",null))}});var p=new f;p.inRegion=q;p.region=b;p.area=v;return p},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(e,j,i,h,d){function c(){c.superclass.constructor.apply(this,arguments)}function f(a){var c,f;if(this._checkMouseDown(a)){c=this.get("handlers");var e=new d(a.target);(c=c.length?this._getHandler(e):e)&&(f=this._getNode(c));f&&(this.__set("activeHandler",c),this.__set("node",f),this.__set("dragNode",f),this._prepare(a))}}e.extend(c,i,{_uiSetDisabledChange:function(a){this.get("container")[a?"addClass":"removeClass"](j.get("prefixCls")+"-disabled")},_init:function(){this.get("container").on("mousedown",
f,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var c=void 0,f=this.get("container"),d=this.get("handlers");a&&a[0]!==f[0];){e.each(d,function(g){if(h.test(a[0],g))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",f,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return d.one(a)}},selector:{},
handlers:{value:[],getter:0}}});return c},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(e,j,i,h,d){function c(){var b=this;c.superclass.constructor.apply(b,arguments);b.addTarget(d);e.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.__set("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var a;(a=b.get("disabled"))&&b._uiSetDisabledChange(a);b._init()}function f(){return!1}function a(b){var a=b.target;this._checkMouseDown(b)&&
this._check(a)&&this._prepare(b)}var m=e.each,o=j.ie,k=e.Env.host.document;c.POINT="point";c.INTERSECT="intersect";c.STRICT="strict";c.ATTRS={node:{setter:function(b){return i.one(b)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));m(b,function(c,g){e.isFunction(c)&&(c=c.call(a));if(e.isString(c)||c.nodeType)c=
i.one(c);b[g]=c});a.__set("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};var g;e.extend(c,h,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"-disabled")},
_init:function(){this.get("node").on("mousedown",a,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_check:function(b){var a=this,c=a.get("handlers"),g=0;m(c,function(c){if(c.contains(b)||c[0]==b)return g=1,a.__set("activeHandler",c),!1});return g},_checkMouseDown:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;o&&(g=k.body.onselectstart,k.body.onselectstart=f);a.get("halt")?b.halt():b.preventDefault();
var c=a.get("node"),e=b.pageX,b=b.pageY,c=c.offset();a.startMousePos=a.mousePos={left:e,top:b};a.startNodePos=c;a._diff={left:e-c.left,top:b-c.top};d._regToDrag(a);if(e=a.get("bufferTime"))a._bufferTimer=setTimeout(function(){a._start()},e)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a,c=this._diff;a=this.startMousePos;var g=b.pageX,b=b.pageY,f=g-c.left,c=b-c.top;this.get("dragging")?(this.mousePos={left:g,top:b},a=
{left:f,top:c,pageX:g,pageY:b,drag:this},this.fire("dragalign",{info:a}),g=1,!1===this.fire("drag",a)&&(g=0),g&&this.get("move")&&this.get("node").offset(a)):(c=this.get("clickPixelThresh"),(Math.abs(g-a.left)>=c||Math.abs(b-a.top)>=c)&&this._start())},stopDrag:function(){this.get("dragging")&&d._end()},_end:function(){var b;this._clearBufferTimer();o&&(k.body.onselectstart=g);this.get("dragging")&&(this.get("node").removeClass(d.get("prefixCls")+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",
{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.__set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(d.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(d.get("prefixCls")+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);d._start();this.fire("dragstart",
{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",a,this).detach("dragstart",this._fixDragStart);this.detach()}});return c},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(e,j,i,h,d){function c(){var a=this.get("container"),c=this.get("selector");this.__allNodes=a.all(c)}function f(){f.superclass.constructor.apply(this,arguments);j.on("dragstart",c,this)}e.extend(f,i,{getNodeFromTarget:function(a,c,f){var d={left:a.pageX,top:a.pageY},a=this.__allNodes,g=0,b=Number.MAX_VALUE;a&&a.each(function(a){var e=a[0];if(!(e===f||e===c)&&j.inRegion(j.region(a),d))e=j.area(j.region(a)),e<b&&(b=e,g=a)});g&&(this.__set("lastNode",this.get("node")),
this.__set("node",g));return g},_handleOut:function(){f.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(a){var c=this.get("node"),e=f.superclass._handleOut,d=f.superclass._handleOver,g=f.superclass._handleEnter,b=this.get("lastNode");b[0]!==c[0]?(this.__set("node",b),e.apply(this,arguments),this.__set("node",c),g.call(this,a)):d.call(this,a)},_end:function(){f.superclass._end.apply(this,arguments);this.__set("node",0)}},{ATTRS:{lastNode:{},
selector:{},container:{setter:function(a){return d.one(a)}}}});return f},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(e,j,i,h){function d(){var c=this;d.superclass.constructor.apply(c,arguments);c.addTarget(h);e.each(["dropexit","dropenter","dropover","drophit"],function(f){c.publish(f,{bubbles:1})});c._init()}d.ATTRS={node:{setter:function(c){if(c)return j.one(c)}},groups:{value:!0}};e.extend(d,i,{getNodeFromTarget:function(c,f,a){var c=this.get("node"),e=c[0];return e==f||e==a?null:c},_init:function(){h._regDrop(this)},_active:function(){var c=h.get("activeDrag"),f=this.get("node"),
a=this.get("groups"),e=c.get("groups"),c=h.get("prefixCls");a:if(!0===a)a=1;else{for(var d in a)if(e[d]){a=1;break a}a=0}a?(h._addValidDrop(this),f&&f.addClass(c+"drop-active-valid")):f&&f.addClass(c+"drop-active-invalid")},_deActive:function(){var c=this.get("node"),e=h.get("prefixCls");c&&c.removeClass(e+"drop-active-valid").removeClass(e+"drop-active-invalid")},__getCustomEvt:function(c){return e.mix({drag:h.get("activeDrag"),drop:this},c)},_handleOut:function(){var c=this.__getCustomEvt();this.get("node").removeClass(h.get("prefixCls")+
"drop-over");this.fire("dropexit",c)},_handleEnter:function(c){c=this.__getCustomEvt(c);c.drag._handleEnter(c);this.get("node").addClass(h.get("prefixCls")+"drop-over");this.fire("dropenter",c)},_handleOver:function(c){c=this.__getCustomEvt(c);c.drag._handleOver(c);this.fire("dropover",c)},_end:function(){var c=this.__getCustomEvt();this.get("node").removeClass(h.get("prefixCls")+"drop-over");this.fire("drophit",c)},destroy:function(){h._unRegDrop(this)}});return d},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(e,j,i){function h(){h.superclass.constructor.apply(this,arguments);this[d]={}}var d="__proxy_destructors",c=e.stamp,f=e.guid("__dd_proxy");h.ATTRS={node:{value:function(a){return new j(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};e.extend(h,i,{attachDrag:function(a){function h(){var b=k.get("node"),c=a.get("node");k.get("proxyNode")?b=k.get("proxyNode"):e.isFunction(b)&&(b=b(a),b.addClass("ks-dd-proxy"),b.css("position","absolute"),
k.set("proxyNode",b));b.show();c.parent().append(b);b.offset(c.offset());a.__set("dragNode",c);a.__set("node",b)}function i(){var b=k.get("proxyNode");k.get("moveOnEnd")&&a.get("dragNode").offset(b.offset());k.get("destroyOnEnd")?(b.remove(),k.set("proxyNode",0)):b.hide();a.__set("node",a.get("dragNode"))}var k=this,g=c(a,1,f);if(!g||!k[d][g])a.on("dragstart",h),a.on("dragend",i),g=c(a,0,f),k[d][g]={drag:a,fn:function(){a.detach("dragstart",h);a.detach("dragend",i)}}},detachDrag:function(a){var a=
c(a,1,f),e=this[d];a&&e[a]&&(e[a].fn(),delete e[a])},destroy:function(){var a=this.get("node"),c=this[d];a&&!e.isFunction(a)&&a.remove();for(var f in c)this.detachDrag(c[f].drag)}});i=h.prototype;i.attach=i.attachDrag;i.unAttach=i.detachDrag;return h},{requires:["node","base"]});
KISSY.add("dd/scroll",function(e,j,i,h,d){function c(){c.superclass.constructor.apply(this,arguments);this[o]={}}var f=e.Env.host,a=e.stamp,m=100,o="__dd_scrolls";c.ATTRS={node:{valueFn:function(){return h.one(f)},setter:function(a){return h.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var k=e.isWindow;e.extend(c,i,{getRegion:function(a){return k(a[0])?{width:d.viewportWidth(),height:d.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return k(a[0])?{left:d.scrollLeft(),
top:d.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},detachDrag:function(c){var b,e=this[o];if((b=a(c,1,"__dd-scroll-id-"))&&e[b])e[b].fn(),delete e[b]},destroy:function(){var a=this[o],b;for(b in a)this.detachDrag(a[b].drag)},attachDrag:function(c){function b(){if(k(n[0]))return 0;var b=c.mousePos,a=j.region(n);return!j.inRegion(a,b)?(clearTimeout(r),r=0,1):0}function f(a){!a.fake&&!b()&&
(p=a,l=e.clone(c.mousePos),a=i.getOffset(n),l.left-=a.left,l.top-=a.top,r||h())}function d(){clearTimeout(r);r=null}function h(){if(!b()){var a=i.getRegion(n),f=a.width,a=a.height,d=i.getScroll(n),j=e.clone(d),o=!1;l.top-a>=-s[1]&&(d.top+=u[1],o=!0);l.top<=s[1]&&(d.top-=u[1],o=!0);l.left-f>=-s[0]&&(d.left+=u[0],o=!0);l.left<=s[0]&&(d.left-=u[0],o=!0);o?(i.setScroll(n,d),r=setTimeout(h,m),p.fake=!0,k(n[0])&&(d=i.getScroll(n),p.left+=d.left-j.left,p.top+=d.top-j.top),c.get("move")&&c.get("node").offset(p),
c.fire("drag",p)):r=null}}var i=this,n=i.get("node"),t=a(c,0,"__dd-scroll-id-"),w=i[o];if(!w[t]){var u=i.get("rate"),s=i.get("diff"),p,l,r=null;c.on("drag",f);c.on("dragend",d);w[t]={drag:c,fn:function(){c.detach("drag",f);c.detach("dragend",d)}}}}});i=c.prototype;i.attach=i.attachDrag;i.unAttach=i.detachDrag;return c},{requires:["./ddm","base","node","dom"]});
