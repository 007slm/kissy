/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 19 16:15
*/
KISSY.add("dd/constrain",function(i,l,k){function j(){j.superclass.constructor.apply(this,arguments);this[c]={}}function g(c){var b,m,c=c.drag.get("dragNode"),a=this.get("constrain");if(a){if(!0===a||a.setTimeout){var e;e=!0===a?d(f):d(a);this.__constrainRegion={left:b=e.scrollLeft(),top:m=e.scrollTop(),right:b+e.width(),bottom:m+e.height()}}if(a.nodeType||"string"==typeof a)a=d(a);a.getDOMNode?(b=a.offset(),this.__constrainRegion={left:b.left,top:b.top,right:b.left+a.outerWidth(),bottom:b.top+a.outerHeight()}):
i.isPlainObject(a)&&(this.__constrainRegion=a);this.__constrainRegion&&(this.__constrainRegion.right-=c.outerWidth(),this.__constrainRegion.bottom-=c.outerHeight())}}function h(a){var b={},c=a.left,f=a.top,e=this.__constrainRegion;e&&(b.left=Math.min(Math.max(e.left,c),e.right),b.top=Math.min(Math.max(e.top,f),e.bottom),a.drag.setInternal("actualPos",b))}function a(){this.__constrainRegion=null}var d=k.all,c="__constrain_destructors",e=i.stamp,o=i.guid("__dd_constrain"),f=i.Env.host;i.extend(j,l,
{__constrainRegion:null,attachDrag:function(f){var b=this[c],m=e(f,0,o);if(b[m])return this;b[m]=f;f.on("dragstart",g,this).on("dragend",a,this).on("dragalign",h,this);return this},detachDrag:function(f){var b=e(f,1,o),m=this[c];b&&m[b]&&(f.detach("dragstart",g,this).detach("dragend",a,this).detach("dragalign",h,this),delete m[b]);return this},destroy:function(){var a=this,b=i.merge(a[c]);i.each(b,function(b){a.detachDrag(b)})}},{ATTRS:{constrain:{value:!0}}});return j},{requires:["base","node"]});
KISSY.add("dd",function(i,l,k,j,g,h,a,d,c){i={Draggable:k,Droppable:j,DDM:l,Constrain:h,Proxy:g,DraggableDelegate:a,DroppableDelegate:d,Scroll:c};return KISSY.DD=i},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(i,l,k,j,g,h){function a(){a.superclass.constructor.apply(this,arguments)}function d(a,c,f){var e=f.get("mode"),h=a.get("validDrops"),d=0,g=0,o=u(f.get("node")),k=m(o);i.each(h,function(a){var p;if(p=a.getNodeFromTarget(c,f.get("dragNode")[0],f.get("node")[0]))if("point"==e)b(u(p),f.mousePos)&&(p=m(u(p)),d?p<g&&(d=a,g=p):(d=a,g=p));else if("intersect"==e)p=m(y(o,u(p))),p>g&&(g=p,d=a);else if("strict"==e&&(p=m(y(o,u(p))),p==k))return d=a,!1});if((h=a.get("activeDrop"))&&
h!=d)h._handleOut(c),f._handleOut(c);a.setInternal("activeDrop",d);d&&(h!=d?d._handleEnter(c):d._handleOver(c))}function c(b){b._shim=(new g('<div style="background-color:red;position:'+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+n.get("dragCursor")+";z-index:"+x+';"></div>')).prependTo(q.body||q.documentElement).css("opacity",0);c=e;if(w)j.on(r,"resize scroll",s,b);e(b)}function e(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==
c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});w&&s.call(b)}function o(b){var a=b.get("drops");b.setInternal("validDrops",[]);i.each(a,function(b){b._active()})}function f(b){var a=b.get("drops");b.setInternal("validDrops",[]);i.each(a,function(b){b._deActive()})}function u(b){var a=b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function b(b,a){return b.left<=a.left&&b.right>=a.left&&
b.top<=a.top&&b.bottom>=a.top}function m(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function y(b,a){var c=Math.max(b.top,a.top),f=Math.min(b.right,a.right),m=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:f,top:c,bottom:m}}function z(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var r=i.Env.host,q=r.document,w=6===l.ie,v=i.throttle(function(b){var a;if(a=this.__activeToDrag)b.preventDefault(),a._move(b);else if(a=
this.get("activeDrag"))b.preventDefault(),a._move(b),d(this,b,a)},30),x=999999;a.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var s=i.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:k.docWidth(),height:k.docHeight()})},30);i.extend(a,h,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=i.indexOf(b,this.get("drops"));
-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;j.on(q,A,this._end,this);j.on(q,t,v,this);6===l.ie&&q.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);z(b.get("node"));o(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");j.remove(q,t,v,this);j.remove(q,A,this._end,this);6===
l.ie&&q.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(),f(this),a&&a._end(),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var n=new a;n.inRegion=b;n.region=u;n.area=m;n.cacheWH=z;n.PREFIX_CLS="ks-dd-";h="ontouchstart"in q;n.DRAG_START_EVENT=h?"touchstart":"mousedown";var t=n.DRAG_MOVE_EVENT=h?"touchmove":"mousemove",A=n.DRAG_END_EVENT=h?"touchend":"mouseup";n._normalHandlePreDragStart=
function(b){return function(a){var c;if(c=a.originalEvent.touches){if(1!=c.length)return;c=c[0];a.target=a.target||c.target;a.currentTarget=a.currentTarget||c.currentTarget;a.button=a.button||0}b.call(this,a)}};return n},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(i,l,k,j,g){function h(){h.superclass.constructor.apply(this,arguments)}var a=l.PREFIX_CLS,d=l._normalHandlePreDragStart(function(a){var e,d;if(this._checkDragStartValid(a)){e=this.get("handlers");var f=new g(a.target);(e=e.length?this._getHandler(f):f)&&(d=this._getNode(e));d&&(this.setInternal("activeHandler",e),this.setInternal("node",d),this.setInternal("dragNode",d),this._prepare(a))}});i.extend(h,k,{_uiSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](a+"-disabled")},_init:function(){this.get("container").on(l.DRAG_START_EVENT,d,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var e=void 0,d=this.get("container"),f=this.get("handlers");a&&a[0]!==d[0];){i.each(f,function(f){if(j.test(a[0],f))return e=a,!1});if(e)break;a=a.parent()}return e},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(l.DRAG_START_EVENT,d,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return g.one(a)}},selector:{},handlers:{value:[],getter:0}}});return h},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(i,l,k,j,g){function h(){var b=this;h.superclass.constructor.apply(b,arguments);b.addTarget(g);i.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.setInternal("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var a;(a=b.get("disabled"))&&b._uiSetDisabledChange(a);b._init()}function a(){return!1}var d=i.each,c=l.ie,e=g.PREFIX_CLS,o=i.Env.host.document;
h.ATTRS={node:{setter:function(b){if(!(b instanceof k))return k.one(b)}},clickPixelThresh:{valueFn:function(){return g.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return g.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));d(b,function(c,f){i.isFunction(c)&&(c=c.call(a));if("string"==typeof c||c.nodeType)c=k.one(c);b[f]=c});a.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](e+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}};h.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};i.mix(h,h.DropMode);var f,u=g._normalHandlePreDragStart(function(b){var a=b.target;this._checkDragStartValid(b)&&this._checkHandler(a)&&this._prepare(b)});i.extend(h,j,{_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](e+"-disabled")},_init:function(){this.get("node").on(g.DRAG_START_EVENT,u,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var a=this,c=a.get("handlers"),f=0;d(c,function(c){if(c.contains(b)||c[0]==b)return f=1,a.setInternal("activeHandler",c),!1});return f},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var m=this;c&&(f=o.body.onselectstart,
o.body.onselectstart=a);m.get("halt")?b.halt():b.preventDefault();var e=m.get("node"),d=b.pageX,b=b.pageY,e=e.offset();m.setInternal("startMousePos",m.mousePos={left:d,top:b});m.setInternal("startNodePos",e);m.setInternal("deltaPos",{left:d-e.left,top:b-e.top});g._regToDrag(m);if(d=m.get("bufferTime"))m._bufferTimer=setTimeout(function(){m._start()},1E3*d)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a;a=b.pageX;b=b.pageY;
if(this.get("dragging")){var c=this.get("deltaPos"),f=a-c.left,c=b-c.top;this.mousePos={left:a,top:b};a={left:f,top:c,pageX:a,pageY:b,drag:this};this.setInternal("actualPos",{left:f,top:c});this.fire("dragalign",a);b=1;!1===this.fire("drag",a)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))}else f=this.get("startMousePos"),c=this.get("clickPixelThresh"),(Math.abs(a-f.left)>=c||Math.abs(b-f.top)>=c)&&this._start()},stopDrag:function(){this.get("dragging")&&g._end()},_end:function(){var b;
this._clearBufferTimer();c&&(o.body.onselectstart=f);this.get("dragging")&&(this.get("node").removeClass(e+"drag-over"),(b=g.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(e+"drag-over");this.fire("dragexit",{drag:this,drop:g.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(e+"drag-over");this.fire("dragenter",
b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.setInternal("dragging",1);g._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(g.DRAG_START_EVENT,u,this).detach("dragstart",this._fixDragStart);this.detach()}});return h},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,l,k,j,g){function h(){var a=this.get("container"),c=[],e=this.get("selector");a.all(e).each(function(a){l.cacheWH(a);c.push(a)});this.__allNodes=c}function a(){a.superclass.constructor.apply(this,arguments);l.on("dragstart",h,this)}i.extend(a,k,{destroy:function(){a.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(a,c,e){var h={left:a.pageX,top:a.pageY},a=this.__allNodes,f=0,g=Number.MAX_VALUE;a&&i.each(a,function(a){var d=a[0];d===
e||d===c||(d=l.region(a),l.inRegion(d,h)&&(d=l.area(d),d<g&&(g=d,f=a)))});f&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",f));return f},_handleOut:function(){a.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(d){var c=this.get("node"),e=a.superclass._handleOut,h=a.superclass._handleOver,f=a.superclass._handleEnter,i=this.get("lastNode");i[0]!==c[0]?(this.setInternal("node",i),e.apply(this,arguments),
this.setInternal("node",c),f.call(this,d)):h.call(this,d)},_end:function(){a.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return g.one(a)}}}});return a},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(i,l,k,j){function g(){var a=this;g.superclass.constructor.apply(a,arguments);a.addTarget(j);i.each(["dropexit","dropenter","dropover","drophit"],function(d){a.publish(d,{bubbles:1})});a._init()}var h=j.PREFIX_CLS;g.ATTRS={node:{setter:function(a){if(a)return l.one(a)}},groups:{value:!0}};i.extend(g,k,{getNodeFromTarget:function(a,d,c){var a=this.get("node"),e=a[0];return e==d||e==c?null:a},_init:function(){j._regDrop(this)},_active:function(){var a=j.get("activeDrag"),
d=this.get("node"),c=this.get("groups"),a=a.get("groups");a:if(!0===c)c=1;else{for(var e in c)if(a[e]){c=1;break a}c=0}c?(j._addValidDrop(this),d&&(d.addClass(h+"drop-active-valid"),j.cacheWH(d))):d&&d.addClass(h+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(h+"drop-active-valid").removeClass(h+"drop-active-invalid")},__getCustomEvt:function(a){return i.mix({drag:j.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(h+
"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(h+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("drophit",a)},destroy:function(){j._unRegDrop(this)}});return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(i,l,k,j){function g(){g.superclass.constructor.apply(this,arguments);this[h]={}}var h="__proxy_destructors",a=i.stamp,d=i.guid("__dd_proxy");g.ATTRS={node:{value:function(a){return new l(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};i.extend(g,k,{attachDrag:function(c){function e(){var a=f.get("node"),b=c.get("node");f.get("proxyNode")?a=f.get("proxyNode"):i.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
f.set("proxyNode",a));a.show();b.parent().append(a);j.cacheWH(a);a.offset(b.offset());c.setInternal("dragNode",b);c.setInternal("node",a)}function g(){var a=f.get("proxyNode");f.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());f.get("destroyOnEnd")?(a.remove(),f.set("proxyNode",0)):a.hide();c.setInternal("node",c.get("dragNode"))}var f=this,k=f[h],b=a(c,0,d);if(k[b])return f;c.on("dragstart",e);c.on("dragend",g);k[b]={drag:c,fn:function(){c.detach("dragstart",e);c.detach("dragend",g)}};return f},
detachDrag:function(c){var c=a(c,1,d),e=this[h];c&&e[c]&&(e[c].fn(),delete e[c]);return this},destroy:function(){var a=this.get("node"),e=this[h];a&&!i.isFunction(a)&&a.remove();for(var d in e)this.detachDrag(e[d].drag)}});k=g.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(i,l,k,j,g){function h(){h.superclass.constructor.apply(this,arguments);this[e]={}}var a=i.Env.host,d=i.stamp,c=100,e="__dd_scrolls";h.ATTRS={node:{valueFn:function(){return j.one(a)},setter:function(a){return j.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var o=i.isWindow;i.extend(h,k,{getRegion:function(a){return o(a[0])?{width:g.viewportWidth(),height:g.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return o(a[0])?{left:g.scrollLeft(),
top:g.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,c){a.scrollLeft(c.left);a.scrollTop(c.top)},detachDrag:function(a){var c,b=this[e];if(!(c=d(a,1,"__dd-scroll-id-"))||!b[c])return this;b[c].fn();delete b[c];return this},destroy:function(){var a=this;i.each(a[e],function(c){a.detachDrag(c.drag)})},attachDrag:function(a){function h(){if(o(r[0]))return 0;var b=a.mousePos,c=l.region(r);return!l.inRegion(c,b)?(clearTimeout(t),t=0,1):
0}function b(b){!b.fake&&!h()&&(s=b,n=i.clone(a.mousePos),b=j.getOffset(r),n.left-=b.left,n.top-=b.top,t||k())}function g(){clearTimeout(t);t=null}function k(){if(!h()){var b=j.getRegion(r),e=b.width,b=b.height,d=j.getScroll(r),g=i.clone(d),l=!1;n.top-b>=-x[1]&&(d.top+=v[1],l=!0);n.top<=x[1]&&(d.top-=v[1],l=!0);n.left-e>=-x[0]&&(d.left+=v[0],l=!0);n.left<=x[0]&&(d.left-=v[0],l=!0);l?(j.setScroll(r,d),t=setTimeout(k,c),s.fake=!0,o(r[0])&&(d=j.getScroll(r),s.left+=d.left-g.left,s.top+=d.top-g.top),
a.get("move")&&a.get("node").offset(s),a.fire("drag",s)):t=null}}var j=this,r=j.get("node"),q=d(a,0,"__dd-scroll-id-"),w=j[e];if(w[q])return this;var v=j.get("rate"),x=j.get("diff"),s,n,t=null;a.on("drag",b);a.on("dragstart",function(){l.cacheWH(r)});a.on("dragend",g);w[q]={drag:a,fn:function(){a.detach("drag",b);a.detach("dragend",g)}};return this}});k=h.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return h},{requires:["./ddm","base","node","dom"]});
