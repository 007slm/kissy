/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Aug 15 22:00
*/
KISSY.add("dd/constrain",function(d,k,j){function i(){i.superclass.constructor.apply(this,arguments)}function g(e){var b,a,e=e.drag.get("dragNode"),l=this.get("constrain");if(l){if(!0===l){var c=h(p);this.__constrainRegion={left:b=c.scrollLeft(),top:a=c.scrollTop(),right:b+c.width(),bottom:a+c.height()}}if(l.nodeType||d.isString(l))l=h(l);l.getDOMNode?(b=l.offset(),this.__constrainRegion={left:b.left,top:b.top,right:b.left+l.outerWidth(),bottom:b.top+l.outerHeight()}):d.isPlainObject(l)&&(this.__constrainRegion=
l);this.__constrainRegion&&(this.__constrainRegion.right-=e.outerWidth(),this.__constrainRegion.bottom-=e.outerHeight())}}function f(e){var e=e.info,b=e.left,a=e.top,c=this.__constrainRegion;c&&(e.left=Math.min(Math.max(c.left,b),c.right),e.top=Math.min(Math.max(c.top,a),c.bottom))}function c(){this.__constrainRegion=null}var h=j.all,b=d.stamp,o=d.guid("__dd_constrain"),p=d.Env.host;d.extend(i,k,{__constrainRegion:null,attachDrag:function(e){var d=b(e,1,o);if(d&&this.__constrain_destructors[d])return this;
e.on("dragstart",g,this).on("dragend",c,this).on("dragalign",f,this);return this},detachDrag:function(e){var d=b(e,1,o),a=this.__constrain_destructors;d&&a[d]&&(e.detach("dragstart",g,this).detach("dragend",c,this).detach("dragalign",f,this),delete a[d]);return this},destroy:function(){var b=this,c=d.merge(b.__constrain_destructors);d.each(c,function(a){b.detachDrag(a)})}},{ATTRS:{constrain:{value:!0}}});return i},{requires:["base","node"]});
KISSY.add("dd",function(d,k,j,i,g,f,c,h,b){return{Draggable:j,Droppable:i,DDM:k,Constrain:f,Proxy:g,DraggableDelegate:c,DroppableDelegate:h,Scroll:b}},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(d,k,j,i,g,f){function c(){c.superclass.constructor.apply(this,arguments)}function h(b,e,c){var o=c.get("mode"),f=b.get("validDrops"),h=0,g=0,p=n(c.get("node")),j=l(p);d.each(f,function(b){var q;if(q=b.getNodeFromTarget(e,c.get("dragNode")[0],c.get("node")[0]))if("point"==o)a(n(q),c.mousePos)&&(q=l(n(q)),h?q<g&&(h=b,g=q):(h=b,g=q));else if("intersect"==o)q=l(y(p,n(q))),q>g&&(g=q,h=b);else if("strict"==o&&(q=l(y(p,n(q))),q==j))return h=b,!1});if((f=b.get("activeDrop"))&&
f!=h)f._handleOut(e),c._handleOut(e);b.__set("activeDrop",h);h&&(f!=h?h._handleEnter(e):h._handleOver(e))}function b(a){a._shim=(new g("<div style='background-color:red;position:"+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+m.get("dragCursor")+";z-index:"+x+";'></div>")).prependTo(r.body||r.documentElement).css("opacity",0);b=o;if(w)i.on(s,"resize scroll",t,a);o(a)}function o(a){var b=a.get("activeDrag").get("activeHandler"),e="auto";b&&(e=b.css("cursor"));"auto"==e&&(e=
a.get("dragCursor"));a._shim.css({cursor:e,display:"block"});w&&t.call(a)}function p(a){var b=a.get("drops");a.__set("validDrops",[]);d.each(b,function(a){a._active()})}function e(a){var b=a.get("drops");a.__set("validDrops",[]);d.each(b,function(a){a._deActive()})}function n(a){var b=a.offset();return{left:b.left,right:b.left+(a.__dd_cached_width||a.outerWidth()),top:b.top,bottom:b.top+(a.__dd_cached_height||a.outerHeight())}}function a(a,b){return a.left<=b.left&&a.right>=b.left&&a.top<=b.top&&
a.bottom>=b.top}function l(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function y(a,b){var e=Math.max(a.top,b.top),c=Math.min(a.right,b.right),l=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:c,top:e,bottom:l}}function z(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var s=d.Env.host,r=s.document,w=6===k.ie,v=d.throttle(function(a){var b;if(b=this.__activeToDrag)a.preventDefault(),b._move(a);else if(b=this.get("activeDrag"))a.preventDefault(),
b._move(a),h(this,a,b)},30),x=999999;c.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var t=d.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:j.docWidth(),height:j.docHeight()})},30);d.extend(c,f,{__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){a=d.indexOf(a,this.get("drops"));-1!=a&&this.get("drops").splice(a,1)},
_regToDrag:function(a){this.__activeToDrag=a;i.on(r,A,this._end,this);i.on(r,u,v,this);6===k.ie&&r.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;this.__set("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&b(this);z(a.get("node"));p(this)},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(){var a=this.get("activeDrag"),b=this.get("activeDrop");i.remove(r,u,v,this);i.remove(r,A,this._end,this);6===k.ie&&r.body.releaseCapture();this.__activeToDrag&&
(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();a&&(a._end(),e(this),b&&b._end(),this.__set("activeDrag",null),this.__set("activeDrop",null))}});var m=new c;m.inRegion=a;m.region=n;m.area=l;m.cacheWH=z;m.PREFIX_CLS="ks-dd-";f="ontouchstart"in r;m.DRAG_START_EVENT=f?"touchstart":"mousedown";var u=m.DRAG_MOVE_EVENT=f?"touchmove":"mousemove",A=m.DRAG_END_EVENT=f?"touchend":"mouseup";m._normalHandlePreDragStart=function(a){return function(b){var e;if(e=b.originalEvent.touches){if(1!=
e.length)return;e=e[0];b.target=b.target||e.target;b.currentTarget=b.currentTarget||e.currentTarget;b.button=b.button||0}a.call(this,b)}};return m},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(d,k,j,i,g){function f(){f.superclass.constructor.apply(this,arguments)}var c=k.PREFIX_CLS,h=k._normalHandlePreDragStart(function(b){var c,d;if(this._checkDragStartValid(b)){c=this.get("handlers");var e=new g(b.target);(c=c.length?this._getHandler(e):e)&&(d=this._getNode(c));d&&(this.__set("activeHandler",c),this.__set("node",d),this.__set("dragNode",d),this._prepare(b))}});d.extend(f,j,{_uiSetDisabledChange:function(b){this.get("container")[b?"addClass":
"removeClass"](c+"-disabled")},_init:function(){this.get("container").on(k.DRAG_START_EVENT,h,this).on("dragstart",this._fixDragStart)},_getHandler:function(b){for(var c=void 0,h=this.get("container"),e=this.get("handlers");b&&b[0]!==h[0];){d.each(e,function(e){if(i.test(b[0],e))return c=b,!1});if(c)break;b=b.parent()}return c},_getNode:function(b){return b.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(k.DRAG_START_EVENT,h,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(b){return g.one(b)}},selector:{},handlers:{value:[],getter:0}}});return f},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(d,k,j,i,g){function f(){var a=this;f.superclass.constructor.apply(a,arguments);a.addTarget(g);d.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(b){a.publish(b,{bubbles:1})});a.__set("dragNode",a.get("node"));a.on("afterDisabledChange",a._uiSetDisabledChange,a);var b;(b=a.get("disabled"))&&a._uiSetDisabledChange(b);a._init()}function c(){return!1}var h=d.each,b=k.ie,o=g.PREFIX_CLS,p=d.Env.host.document;
f.POINT="point";f.INTERSECT="intersect";f.STRICT="strict";f.ATTRS={node:{setter:function(a){if(!(a instanceof j))return j.one(a)}},clickPixelThresh:{valueFn:function(){return g.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return g.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));h(a,function(e,c){d.isFunction(e)&&(e=e.call(b));if(d.isString(e)||e.nodeType)e=j.one(e);a[c]=e});b.__set("handlers",a);return a}},
activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](o+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};var e,n=g._normalHandlePreDragStart(function(a){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)});d.extend(f,i,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](o+"-disabled")},_init:function(){this.get("node").on(g.DRAG_START_EVENT,n,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var b=this,e=b.get("handlers"),c=0;h(e,function(e){if(e.contains(a)||e[0]==a)return c=1,b.__set("activeHandler",e),!1});return c},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1<a.button||this.get("disabled")?0:1},_prepare:function(a){var d=this;b&&(e=p.body.onselectstart,
p.body.onselectstart=c);d.get("halt")?a.halt():a.preventDefault();var h=d.get("node"),f=a.pageX,a=a.pageY,h=h.offset();d.startMousePos=d.mousePos={left:f,top:a};d.startNodePos=h;d._diff={left:f-h.left,top:a-h.top};g._regToDrag(d);if(f=d.get("bufferTime"))d._bufferTimer=setTimeout(function(){d._start()},f)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var b,e=this._diff;b=this.startMousePos;var c=a.pageX,a=a.pageY,d=c-e.left,
e=a-e.top;this.get("dragging")?(this.mousePos={left:c,top:a},b={left:d,top:e,pageX:c,pageY:a,drag:this},this.fire("dragalign",{info:b}),c=1,!1===this.fire("drag",b)&&(c=0),c&&this.get("move")&&this.get("node").offset(b)):(e=this.get("clickPixelThresh"),(Math.abs(c-b.left)>=e||Math.abs(a-b.top)>=e)&&this._start())},stopDrag:function(){this.get("dragging")&&g._end()},_end:function(){var a;this._clearBufferTimer();b&&(p.body.onselectstart=e);this.get("dragging")&&(this.get("node").removeClass(o+"drag-over"),
(a=g.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this}),this.__set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(o+"drag-over");this.fire("dragexit",{drag:this,drop:g.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(o+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);
g._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(g.DRAG_START_EVENT,n,this).detach("dragstart",this._fixDragStart);this.detach()}});return f},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(d,k,j,i,g){function f(){var c=this.get("container"),b=[],d=this.get("selector");c.all(d).each(function(c){k.cacheWH(c);b.push(c)});this.__allNodes=b}function c(){c.superclass.constructor.apply(this,arguments);k.on("dragstart",f,this)}d.extend(c,j,{destroy:function(){c.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(c,b,f){var g={left:c.pageX,top:c.pageY},c=this.__allNodes,e=0,n=Number.MAX_VALUE;c&&d.each(c,function(a){var c=a[0];c===
f||c===b||(c=k.region(a),k.inRegion(c,g)&&(c=k.area(c),c<n&&(n=c,e=a)))});e&&(this.__set("lastNode",this.get("node")),this.__set("node",e));return e},_handleOut:function(){c.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(d){var b=this.get("node"),f=c.superclass._handleOut,g=c.superclass._handleOver,e=c.superclass._handleEnter,n=this.get("lastNode");n[0]!==b[0]?(this.__set("node",n),f.apply(this,arguments),this.__set("node",b),e.call(this,
d)):g.call(this,d)},_end:function(){c.superclass._end.apply(this,arguments);this.__set("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(c){return g.one(c)}}}});return c},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(d,k,j,i){function g(){var c=this;g.superclass.constructor.apply(c,arguments);c.addTarget(i);d.each(["dropexit","dropenter","dropover","drophit"],function(d){c.publish(d,{bubbles:1})});c._init()}var f=i.PREFIX_CLS;g.ATTRS={node:{setter:function(c){if(c)return k.one(c)}},groups:{value:!0}};d.extend(g,j,{getNodeFromTarget:function(c,d,b){var c=this.get("node"),f=c[0];return f==d||f==b?null:c},_init:function(){i._regDrop(this)},_active:function(){var c=i.get("activeDrag"),
d=this.get("node"),b=this.get("groups"),c=c.get("groups");a:if(!0===b)b=1;else{for(var g in b)if(c[g]){b=1;break a}b=0}b?(i._addValidDrop(this),d&&(d.addClass(f+"drop-active-valid"),i.cacheWH(d))):d&&d.addClass(f+"drop-active-invalid")},_deActive:function(){var c=this.get("node");c&&c.removeClass(f+"drop-active-valid").removeClass(f+"drop-active-invalid")},__getCustomEvt:function(c){return d.mix({drag:i.get("activeDrag"),drop:this},c)},_handleOut:function(){var c=this.__getCustomEvt();this.get("node").removeClass(f+
"drop-over");this.fire("dropexit",c)},_handleEnter:function(c){c=this.__getCustomEvt(c);c.drag._handleEnter(c);this.get("node").addClass(f+"drop-over");this.fire("dropenter",c)},_handleOver:function(c){c=this.__getCustomEvt(c);c.drag._handleOver(c);this.fire("dropover",c)},_end:function(){var c=this.__getCustomEvt();this.get("node").removeClass(f+"drop-over");this.fire("drophit",c)},destroy:function(){i._unRegDrop(this)}});return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(d,k,j,i){function g(){g.superclass.constructor.apply(this,arguments);this[f]={}}var f="__proxy_destructors",c=d.stamp,h=d.guid("__dd_proxy");g.ATTRS={node:{value:function(b){return new k(b.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};d.extend(g,j,{attachDrag:function(b){function g(){var a=e.get("node"),c=b.get("node");e.get("proxyNode")?a=e.get("proxyNode"):d.isFunction(a)&&(a=a(b),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
e.set("proxyNode",a));a.show();c.parent().append(a);i.cacheWH(a);a.offset(c.offset());b.__set("dragNode",c);b.__set("node",a)}function j(){var a=e.get("proxyNode");e.get("moveOnEnd")&&b.get("dragNode").offset(a.offset());e.get("destroyOnEnd")?(a.remove(),e.set("proxyNode",0)):a.hide();b.__set("node",b.get("dragNode"))}var e=this,n=c(b,1,h);if(n&&e[f][n])return e;b.on("dragstart",g);b.on("dragend",j);n=c(b,0,h);e[f][n]={drag:b,fn:function(){b.detach("dragstart",g);b.detach("dragend",j)}};return e},
detachDrag:function(b){var b=c(b,1,h),d=this[f];b&&d[b]&&(d[b].fn(),delete d[b]);return this},destroy:function(){var b=this.get("node"),c=this[f];b&&!d.isFunction(b)&&b.remove();for(var g in c)this.detachDrag(c[g].drag)}});j=g.prototype;j.attach=j.attachDrag;j.unAttach=j.detachDrag;return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(d,k,j,i,g){function f(){f.superclass.constructor.apply(this,arguments);this[o]={}}var c=d.Env.host,h=d.stamp,b=100,o="__dd_scrolls";f.ATTRS={node:{valueFn:function(){return i.one(c)},setter:function(b){return i.one(b)}},rate:{value:[10,10]},diff:{value:[20,20]}};var p=d.isWindow;d.extend(f,j,{getRegion:function(b){return p(b[0])?{width:g.viewportWidth(),height:g.viewportHeight()}:{width:b.outerWidth(),height:b.outerHeight()}},getOffset:function(b){return p(b[0])?{left:g.scrollLeft(),
top:g.scrollTop()}:b.offset()},getScroll:function(b){return{left:b.scrollLeft(),top:b.scrollTop()}},setScroll:function(b,c){b.scrollLeft(c.left);b.scrollTop(c.top)},detachDrag:function(b){var c,a=this[o];if((c=h(b,1,"__dd-scroll-id-"))&&a[c])return a[c].fn(),delete a[c],this},destroy:function(){var b=this;d.each(b[o],function(c){b.detachDrag(c.drag)})},attachDrag:function(c){function f(){if(p(s[0]))return 0;var a=c.mousePos,b=k.region(s);return!k.inRegion(b,a)?(clearTimeout(u),u=0,1):0}function a(a){!a.fake&&
!f()&&(t=a,m=d.clone(c.mousePos),a=i.getOffset(s),m.left-=a.left,m.top-=a.top,u||j())}function g(){clearTimeout(u);u=null}function j(){if(!f()){var a=i.getRegion(s),g=a.width,a=a.height,h=i.getScroll(s),k=d.clone(h),l=!1;m.top-a>=-x[1]&&(h.top+=v[1],l=!0);m.top<=x[1]&&(h.top-=v[1],l=!0);m.left-g>=-x[0]&&(h.left+=v[0],l=!0);m.left<=x[0]&&(h.left-=v[0],l=!0);l?(i.setScroll(s,h),u=setTimeout(j,b),t.fake=!0,p(s[0])&&(h=i.getScroll(s),t.left+=h.left-k.left,t.top+=h.top-k.top),c.get("move")&&c.get("node").offset(t),
c.fire("drag",t)):u=null}}var i=this,s=i.get("node"),r=h(c,0,"__dd-scroll-id-"),w=i[o];if(!w[r]){var v=i.get("rate"),x=i.get("diff"),t,m,u=null;c.on("drag",a);c.on("dragstart",function(){k.cacheWH(s)});c.on("dragend",g);w[r]={drag:c,fn:function(){c.detach("drag",a);c.detach("dragend",g)}};return this}}});j=f.prototype;j.attach=j.attachDrag;j.unAttach=j.detachDrag;return f},{requires:["./ddm","base","node","dom"]});
