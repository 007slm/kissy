/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 22 19:41
*/
KISSY.add("dd/constrain",function(f,l,k){function j(){j.superclass.constructor.apply(this,arguments);this[c]={}}function g(c){var b,o,c=c.drag.get("dragNode"),a=this.get("constrain");if(a){if(!0===a||a.setTimeout){var d;d=!0===a?e(i):e(a);this.__constrainRegion={left:b=d.scrollLeft(),top:o=d.scrollTop(),right:b+d.width(),bottom:o+d.height()}}if(a.nodeType||"string"==typeof a)a=e(a);a.getDOMNode?(b=a.offset(),this.__constrainRegion={left:b.left,top:b.top,right:b.left+a.outerWidth(),bottom:b.top+a.outerHeight()}):
f.isPlainObject(a)&&(this.__constrainRegion=a);this.__constrainRegion&&(this.__constrainRegion.right-=c.outerWidth(),this.__constrainRegion.bottom-=c.outerHeight())}}function h(a){var b={},c=a.left,i=a.top,d=this.__constrainRegion;d&&(b.left=Math.min(Math.max(d.left,c),d.right),b.top=Math.min(Math.max(d.top,i),d.bottom),a.drag.setInternal("actualPos",b))}function a(){this.__constrainRegion=null}var e=k.all,c="__constrain_destructors",d=f.stamp,n=f.guid("__dd_constrain"),i=f.Env.host;f.extend(j,l,
{__constrainRegion:null,attachDrag:function(i){var b=this[c],o=d(i,0,n);if(b[o])return this;b[o]=i;i.on("dragstart",g,this).on("dragend",a,this).on("dragalign",h,this);return this},detachDrag:function(i){var b=d(i,1,n),o=this[c];b&&o[b]&&(i.detach("dragstart",g,this).detach("dragend",a,this).detach("dragalign",h,this),delete o[b]);return this},destroy:function(){var a=this,b=f.merge(a[c]);f.each(b,function(b){a.detachDrag(b)})}},{ATTRS:{constrain:{value:!0}}});return j},{requires:["base","node"]});
KISSY.add("dd",function(f,l,k,j,g,h,a,e,c){f={Draggable:k,Droppable:j,DDM:l,Constrain:h,Proxy:g,DraggableDelegate:a,DroppableDelegate:e,Scroll:c};return KISSY.DD=f},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(f,l,k,j,g,h){function a(){a.superclass.constructor.apply(this,arguments)}function e(v,a,c){var i=c.get("mode"),d=v.get("validDrops"),e=0,g=0,h=u(c.get("node")),n=o(h);f.each(d,function(v){var d;if(d=v.getNodeFromTarget(a,c.get("dragNode")[0],c.get("node")[0]))if("point"==i)b(u(d),c.mousePos)&&(d=o(u(d)),e?d<g&&(e=v,g=d):(e=v,g=d));else if("intersect"==i)d=o(z(h,u(d))),d>g&&(g=d,e=v);else if("strict"==i&&(d=o(z(h,u(d))),d==n))return e=v,!1});if((d=v.get("activeDrop"))&&
d!=e)d._handleOut(a),c._handleOut(a);v.setInternal("activeDrop",e);e&&(d!=e?e._handleEnter(a):e._handleOver(a))}function c(b){b._shim=(new g('<div style="background-color:red;position:'+(x?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+t.get("dragCursor")+";z-index:"+y+';"></div>')).prependTo(s.body||s.documentElement).css("opacity",0);c=d;if(x)j.on(r,"resize scroll",B,b);d(b)}function d(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==
c&&(c=b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});x&&B.call(b)}function n(b){var a=b.get("drops");b.setInternal("validDrops",[]);f.each(a,function(b){b._active()})}function i(b){var a=b.get("drops");b.setInternal("validDrops",[]);f.each(a,function(b){b._deActive()})}function u(b){var a=b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function b(b,a){return b.left<=a.left&&b.right>=a.left&&
b.top<=a.top&&b.bottom>=a.top}function o(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function z(b,a){var c=Math.max(b.top,a.top),d=Math.min(b.right,a.right),i=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:d,top:c,bottom:i}}function A(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var r=f.Env.host,s=r.document,x=6===l.ie,w=f.throttle(function(b){var a;if(a=this.__activeToDrag)b.preventDefault(),a._move(b);else if(a=
this.get("activeDrag"))b.preventDefault(),a._move(b),e(this,b,a)},30),y=999999,p="msPointerEnabled"in r.navigator,m,q;"ontouchstart"in s?(p="touchstart",m="touchmove",q="touchend"):p?(p="MSPointerDown",m="MSPointerMove",q="MSPointerUp"):(p="mousedown",m="mousemove",q="mouseup");a.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var B=f.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&
this._shim.css({width:k.docWidth(),height:k.docHeight()})},30);f.extend(a,h,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=f.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;j.on(s,q,this._end,this);j.on(s,m,w,this);l.ie===6&&s.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);A(b.get("node"));
n(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");j.remove(s,m,w,this);j.remove(s,q,this._end,this);l.ie===6&&s.body.releaseCapture();if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();i(this);a&&a._end();this.setInternal("activeDrag",null);this.setInternal("activeDrop",null)}}});var t=new a;t.inRegion=b;t.region=u;t.area=o;t.cacheWH=A;t.PREFIX_CLS=
"ks-dd-";t._normalHandlePreDragStart=function(b){return function(a){var c;if(c=a.originalEvent.touches){if(c.length!=1)return;c=c[0];a.target=a.target||c.target;a.currentTarget=a.currentTarget||c.currentTarget;a.button=a.button||0}b.call(this,a)}};t.DRAG_START_EVENT=p;t.DRAG_MOVE_EVENT=m;t.DRAG_END_EVENT=q;return t},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(f,l,k,j,g){function h(){h.superclass.constructor.apply(this,arguments)}var a=l.PREFIX_CLS,e=l._normalHandlePreDragStart(function(a){var d,e;if(this._checkDragStartValid(a)){d=this.get("handlers");var i=new g(a.target);(d=d.length?this._getHandler(i):i)&&(e=this._getNode(d));e&&(this.setInternal("activeHandler",d),this.setInternal("node",e),this.setInternal("dragNode",e),this._prepare(a))}});f.extend(h,k,{_uiSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](a+"-disabled")},_init:function(){this.get("container").on(l.DRAG_START_EVENT,e,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var d=void 0,e=this.get("container"),i=this.get("handlers");a&&a[0]!==e[0];){f.each(i,function(i){if(j.test(a[0],i))return d=a,!1});if(d)break;a=a.parent()}return d},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(l.DRAG_START_EVENT,e,this).detach("dragstart",
this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return g.one(a)}},selector:{},handlers:{value:[],getter:0}}});return h},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(f,l,k,j,g){function h(){var b=this;h.superclass.constructor.apply(b,arguments);b.addTarget(g);f.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.setInternal("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var a;(a=b.get("disabled"))&&b._uiSetDisabledChange(a);b._init()}function a(){return!1}var e=f.each,c=l.ie,d=g.PREFIX_CLS,n=f.Env.host.document;
h.ATTRS={node:{setter:function(b){if(!(b instanceof k))return k.one(b)}},clickPixelThresh:{valueFn:function(){return g.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return g.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));e(b,function(c,d){f.isFunction(c)&&(c=c.call(a));if("string"==typeof c||c.nodeType)c=k.one(c);b[d]=c});a.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](d+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}};h.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};f.mix(h,h.DropMode);var i,u=g._normalHandlePreDragStart(function(b){var a=b.target;this._checkDragStartValid(b)&&this._checkHandler(a)&&this._prepare(b)});f.extend(h,j,{_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](d+"-disabled")},_init:function(){this.get("node").on(g.DRAG_START_EVENT,u,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var a=this,c=a.get("handlers"),d=0;e(c,function(c){if(c.contains(b)||c[0]==b)return d=1,a.setInternal("activeHandler",c),!1});return d},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var d=this;c&&(i=n.body.onselectstart,
n.body.onselectstart=a);d.get("halt")?b.halt():b.preventDefault();var e=d.get("node"),f=b.pageX,b=b.pageY,e=e.offset();d.setInternal("startMousePos",d.mousePos={left:f,top:b});d.setInternal("startNodePos",e);d.setInternal("deltaPos",{left:f-e.left,top:b-e.top});g._regToDrag(d);if(f=d.get("bufferTime"))d._bufferTimer=setTimeout(function(){d._start()},1E3*f)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a;a=b.pageX;b=b.pageY;
if(this.get("dragging")){var c=this.get("deltaPos"),d=a-c.left,c=b-c.top;this.mousePos={left:a,top:b};a={left:d,top:c,pageX:a,pageY:b,drag:this};this.setInternal("actualPos",{left:d,top:c});this.fire("dragalign",a);b=1;!1===this.fire("drag",a)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))}else d=this.get("startMousePos"),c=this.get("clickPixelThresh"),(Math.abs(a-d.left)>=c||Math.abs(b-d.top)>=c)&&this._start()},stopDrag:function(){this.get("dragging")&&g._end()},_end:function(){var b;
this._clearBufferTimer();c&&(n.body.onselectstart=i);this.get("dragging")&&(this.get("node").removeClass(d+"drag-over"),(b=g.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(d+"drag-over");this.fire("dragexit",{drag:this,drop:g.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(d+"drag-over");this.fire("dragenter",
b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.setInternal("dragging",1);g._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(g.DRAG_START_EVENT,u,this).detach("dragstart",this._fixDragStart);this.detach()}});return h},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(f,l,k,j,g){function h(){var a=this.get("container"),c=[],d=this.get("selector");a.all(d).each(function(a){l.cacheWH(a);c.push(a)});this.__allNodes=c}function a(){a.superclass.constructor.apply(this,arguments);l.on("dragstart",h,this)}f.extend(a,k,{destroy:function(){a.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(a,c,d){var g={left:a.pageX,top:a.pageY},a=this.__allNodes,i=0,h=Number.MAX_VALUE;a&&f.each(a,function(a){var e=a[0];e===
d||e===c||(e=l.region(a),l.inRegion(e,g)&&(e=l.area(e),e<h&&(h=e,i=a)))});i&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",i));return i},_handleOut:function(){a.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(e){var c=this.get("node"),d=a.superclass._handleOut,f=a.superclass._handleOver,i=a.superclass._handleEnter,g=this.get("lastNode");g[0]!==c[0]?(this.setInternal("node",g),d.apply(this,arguments),
this.setInternal("node",c),i.call(this,e)):f.call(this,e)},_end:function(){a.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return g.one(a)}}}});return a},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(f,l,k,j){function g(){var a=this;g.superclass.constructor.apply(a,arguments);a.addTarget(j);f.each(["dropexit","dropenter","dropover","drophit"],function(e){a.publish(e,{bubbles:1})});a._init()}var h=j.PREFIX_CLS;g.ATTRS={node:{setter:function(a){if(a)return l.one(a)}},groups:{value:!0}};f.extend(g,k,{getNodeFromTarget:function(a,e,c){var a=this.get("node"),d=a[0];return d==e||d==c?null:a},_init:function(){j._regDrop(this)},_active:function(){var a=j.get("activeDrag"),
e=this.get("node"),c=this.get("groups"),a=a.get("groups");a:if(!0===c)c=1;else{for(var d in c)if(a[d]){c=1;break a}c=0}c?(j._addValidDrop(this),e&&(e.addClass(h+"drop-active-valid"),j.cacheWH(e))):e&&e.addClass(h+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(h+"drop-active-valid").removeClass(h+"drop-active-invalid")},__getCustomEvt:function(a){return f.mix({drag:j.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(h+
"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(h+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(h+"drop-over");this.fire("drophit",a)},destroy:function(){j._unRegDrop(this)}});return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(f,l,k,j){function g(){g.superclass.constructor.apply(this,arguments);this[h]={}}var h="__proxy_destructors",a=f.stamp,e=f.guid("__dd_proxy");g.ATTRS={node:{value:function(a){return new l(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};f.extend(g,k,{attachDrag:function(c){function d(){var a=i.get("node"),b=c.get("node");i.get("proxyNode")?a=i.get("proxyNode"):f.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
i.set("proxyNode",a));a.show();b.parent().append(a);j.cacheWH(a);a.offset(b.offset());c.setInternal("dragNode",b);c.setInternal("node",a)}function g(){var a=i.get("proxyNode");i.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());i.get("destroyOnEnd")?(a.remove(),i.set("proxyNode",0)):a.hide();c.setInternal("node",c.get("dragNode"))}var i=this,k=i[h],b=a(c,0,e);if(k[b])return i;c.on("dragstart",d);c.on("dragend",g);k[b]={drag:c,fn:function(){c.detach("dragstart",d);c.detach("dragend",g)}};return i},
detachDrag:function(c){var c=a(c,1,e),d=this[h];c&&d[c]&&(d[c].fn(),delete d[c]);return this},destroy:function(){var a=this.get("node"),d=this[h];a&&!f.isFunction(a)&&a.remove();for(var e in d)this.detachDrag(d[e].drag)}});k=g.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(f,l,k,j,g){function h(){h.superclass.constructor.apply(this,arguments);this[d]={}}var a=f.Env.host,e=f.stamp,c=100,d="__dd_scrolls";h.ATTRS={node:{valueFn:function(){return j.one(a)},setter:function(a){return j.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var n=f.isWindow;f.extend(h,k,{getRegion:function(a){return n(a[0])?{width:g.viewportWidth(),height:g.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return n(a[0])?{left:g.scrollLeft(),
top:g.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,c){a.scrollLeft(c.left);a.scrollTop(c.top)},detachDrag:function(a){var c,b=this[d];if(!(c=e(a,1,"__dd-scroll-id-"))||!b[c])return this;b[c].fn();delete b[c];return this},destroy:function(){var a=this;f.each(a[d],function(c){a.detachDrag(c.drag)})},attachDrag:function(a){function g(){if(n(r[0]))return 0;var b=a.mousePos,c=l.region(r);return!l.inRegion(c,b)?(clearTimeout(q),q=0,1):
0}function b(b){!b.fake&&!g()&&(p=b,m=f.clone(a.mousePos),b=j.getOffset(r),m.left-=b.left,m.top-=b.top,q||k())}function h(){clearTimeout(q);q=null}function k(){if(!g()){var b=j.getRegion(r),d=b.width,b=b.height,e=j.getScroll(r),h=f.clone(e),l=!1;m.top-b>=-y[1]&&(e.top+=w[1],l=!0);m.top<=y[1]&&(e.top-=w[1],l=!0);m.left-d>=-y[0]&&(e.left+=w[0],l=!0);m.left<=y[0]&&(e.left-=w[0],l=!0);l?(j.setScroll(r,e),q=setTimeout(k,c),p.fake=!0,n(r[0])&&(e=j.getScroll(r),p.left+=e.left-h.left,p.top+=e.top-h.top),
a.get("move")&&a.get("node").offset(p),a.fire("drag",p)):q=null}}var j=this,r=j.get("node"),s=e(a,0,"__dd-scroll-id-"),x=j[d];if(x[s])return this;var w=j.get("rate"),y=j.get("diff"),p,m,q=null;a.on("drag",b);a.on("dragstart",function(){l.cacheWH(r)});a.on("dragend",h);x[s]={drag:a,fn:function(){a.detach("drag",b);a.detach("dragend",h)}};return this}});k=h.prototype;k.attach=k.attachDrag;k.unAttach=k.detachDrag;return h},{requires:["./ddm","base","node","dom"]});
