/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Mar 15 18:08
*/
KISSY.add("dd/constrain",function(j,r,s){function n(){n.superclass.constructor.apply(this,arguments)}function m(i){var f,k;i=i.drag.get("dragNode");var a=this.get("constrain");if(a){if(a===true){var e=g(c);this.__constrainRegion={left:f=e.scrollLeft(),top:k=e.scrollTop(),right:f+e.width(),bottom:k+e.height()}}if(a.nodeType||j.isString(a))a=g(a);if(a.getDOMNode){f=a.offset();this.__constrainRegion={left:f.left,top:f.top,right:f.left+a.outerWidth(),bottom:f.top+a.outerHeight()}}else if(j.isPlainObject(a))this.__constrainRegion=
a;if(this.__constrainRegion){this.__constrainRegion.right-=i.outerWidth();this.__constrainRegion.bottom-=i.outerHeight()}}}function d(i){i=i.info;var f=i.left,k=i.top,a=this.__constrainRegion;if(a){i.left=Math.min(Math.max(a.left,f),a.right);i.top=Math.min(Math.max(a.top,k),a.bottom)}}function l(){this.__constrainRegion=null}var g=s.all,c=j.Env.host;j.extend(n,r,{__constrainRegion:null,attach:function(i){i.on("dragstart",m,this).on("dragend",l,this).on("dragalign",d,this)},unAttach:function(i){i.detach("dragstart",
m,this).detach("dragend",l,this).detach("dragalign",d,this)}},{ATTRS:{constrain:{value:true}}});return n},{requires:["base","node"]});KISSY.add("dd",function(j,r,s,n,m,d,l,g,c){return{Draggable:s,Droppable:n,DDM:r,Constrain:d,Proxy:m,DraggableDelegate:l,DroppableDelegate:g,Scroll:c}},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/constrain","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
KISSY.add("dd/ddm",function(j,r,s,n,m,d){function l(){l.superclass.constructor.apply(this,arguments)}function g(b,o){var p=b.get("activeDrag"),D=p.get("mode"),v=b.get("validDrops"),w=0,E=0,G=a(p.get("node")),H=h(G);j.each(v,function(F){var u;if(u=F.getNodeFromTarget(o,p.get("dragNode")[0],p.get("node")[0]))if(D=="point"){if(e(a(u),p.mousePos)){u=h(a(u));if(w){if(u<E){w=F;E=u}}else{w=F;E=u}}}else if(D=="intersect"){u=h(q(G,a(u)));if(u>E){E=u;w=F}}else if(D=="strict"){u=h(q(G,a(u)));if(u==H){w=F;return false}}});
if((v=b.get("activeDrop"))&&v!=w){v._handleOut(o);p._handleOut(o)}b.__set("activeDrop",w);if(w)v!=w?w._handleEnter(o):w._handleOver(o)}function c(b){b._shim=(new m("<div style='background-color:red;position:"+(B?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+t.get("dragCursor")+";z-index:"+z+";'></div>")).prependTo(x.body||x.documentElement).css("opacity",0);c=i;B&&n.on(y,"resize scroll",C,b);i(b)}function i(b){var o=b.get("activeDrag").get("activeHandler"),p="auto";if(o)p=o.css("cursor");
if(p=="auto")p=b.get("dragCursor");b._shim.css({cursor:p,display:"block"});B&&C.call(b)}function f(b){var o=b.get("drops");b.__set("validDrops",[]);j.each(o,function(p){p._active()})}function k(b){var o=b.get("drops");b.__set("validDrops",[]);j.each(o,function(p){p._deActive()})}function a(b){var o=b.offset();return{left:o.left,right:o.left+b.outerWidth(),top:o.top,bottom:o.top+b.outerHeight()}}function e(b,o){return b.left<=o.left&&b.right>=o.left&&b.top<=o.top&&b.bottom>=o.top}function h(b){if(b.top>=
b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function q(b,o){return{left:Math.max(b.left,o.left),right:Math.min(b.right,o.right),top:Math.max(b.top,o.top),bottom:Math.min(b.bottom,o.bottom)}}var y=j.Env.host,x=y.document,B=r.ie===6,A=j.throttle(function(b){var o=this.__activeToDrag,p=this.get("activeDrag");if(p||o)b.preventDefault();if(p){p._move(b);g(this,b)}else o&&o._move(b)},30),z=999999;l.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},
bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var C=j.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:s.docWidth(),height:s.docHeight()})},30);j.extend(l,d,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=j.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){n.on(x,"mouseup",this._end,this);n.on(x,"mousemove",A,this);this.__activeToDrag=
b},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);f(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),o=this.get("activeDrop");n.remove(x,"mousemove",A,this);n.remove(x,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();k(this);o&&o._end();this.__set("activeDrag",
null);this.__set("activeDrop",null)}}});var t=new l;t.inRegion=e;t.region=a;t.area=h;return t},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(j,r,s,n,m){function d(){d.superclass.constructor.apply(this,arguments)}function l(g){var c,i;if(this._checkMouseDown(g)){c=this.get("handlers");var f=new m(g.target);if(c=c.length?this._getHandler(f):f)i=this._getNode(c);if(i){this.__set("activeHandler",c);this.__set("node",i);this.__set("dragNode",i);this._prepare(g)}}}j.extend(d,s,{_init:function(){this.get("container").on("mousedown",l,this).on("dragstart",this._fixDragStart)},_getHandler:function(g){for(var c=
undefined,i=this.get("container"),f=this.get("handlers");g&&g[0]!==i[0];){j.each(f,function(k){if(n.test(g[0],k)){c=g;return false}});if(c)break;g=g.parent()}return c},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",l,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(g){return m.one(g)}},selector:{},handlers:{value:[],getter:0}}});return d},{requires:["./ddm",
"./draggable","dom","node"]});
KISSY.add("dd/draggable",function(j,r,s,n,m){function d(){var a=this;d.superclass.constructor.apply(a,arguments);a.addTarget(m);j.each(["dragalign","drag","dragdrophit","dragend","dragdropmiss","dragexit","dragenter","dragover","dragstart"],function(e){a.publish(e,{bubbles:1})});a._init()}function l(){return false}function g(a){var e=a.target;this._checkMouseDown(a)&&this._check(e)&&this._prepare(a)}var c=j.each,i=r.ie,f=j.Env.host.document;d.POINT="point";d.INTERSECT="intersect";d.STRICT="strict";
d.ATTRS={node:{setter:function(a){return s.one(a)}},clickPixelThresh:{valueFn:function(){return m.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return m.get("bufferTime")}},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var e=this;a.length||(a[0]=e.get("node"));c(a,function(h,q){if(j.isFunction(h))h=h.call(e);if(j.isString(h)||h.nodeType)h=s.one(h);a[q]=h});e.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?
"addClass":"removeClass"](m.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](m.get("prefixCls")+"-disabled");return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true},groups:{value:{}}};var k;j.extend(d,n,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.__set("dragNode",a);a.on("mousedown",g,this).on("dragstart",this._fixDragStart)},
_fixDragStart:function(a){a.preventDefault()},_check:function(a){var e=this,h=e.get("handlers"),q=0;c(h,function(y){if(y.contains(a)||y[0]==a){q=1;e.__set("activeHandler",y);return false}});return q},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var e=this;if(i){k=f.body.onselectstart;f.body.onselectstart=l}e.get("halt")?a.halt():a.preventDefault();var h=e.get("node"),q=a.pageX;a=a.pageY;h=h.offset();e.startMousePos=
e.mousePos={left:q,top:a};e.startNodePos=h;e._diff={left:q-h.left,top:a-h.top};m._regToDrag(e);if(q=e.get("bufferTime"))e._bufferTimer=setTimeout(function(){e._start()},q)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var e,h=this._diff;e=this.startMousePos;var q=a.pageX;a=a.pageY;var y=q-h.left;h=a-h.top;if(this.get("dragging")){this.mousePos={left:q,top:a};e={left:y,top:h,pageX:q,pageY:a,drag:this};this.fire("dragalign",
{info:e});q=1;if(this.fire("drag",e)===false)q=0;q&&this.get("move")&&this.get("node").offset(e)}else{h=this.get("clickPixelThresh");if(Math.abs(q-e.left)>=h||Math.abs(a-e.top)>=h)this._start()}},_end:function(){var a;this._clearBufferTimer();if(i)f.body.onselectstart=k;if(this.get("dragging")){this.get("node").removeClass(m.get("prefixCls")+"drag-over");(a=m.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.__set("dragging",0);this.fire("dragend",
{drag:this})}},_handleOut:function(){this.get("node").removeClass(m.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:m.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(m.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);m._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",g,this).detach("dragstart",
this._fixDragStart);this.detach()}});return d},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(j,r,s,n,m){function d(){var g=this.get("container"),c=this.get("selector");this.__allNodes=g.all(c)}function l(){l.superclass.constructor.apply(this,arguments);r.on("dragstart",d,this)}j.extend(l,s,{getNodeFromTarget:function(g,c,i){var f={left:g.pageX,top:g.pageY};g=this.__allNodes;var k=0,a=Number.MAX_VALUE;g&&g.each(function(e){var h=e[0];if(!(h===i||h===c))if(r.inRegion(r.region(e),f)){h=r.area(r.region(e));if(h<a){a=h;k=e}}});if(k){this.__set("lastNode",
this.get("node"));this.__set("node",k)}return k},_handleOut:function(){l.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(g){var c=this.get("node"),i=l.superclass._handleOut,f=l.superclass._handleOver,k=l.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==c[0]){this.__set("node",a);i.apply(this,arguments);this.__set("node",c);k.call(this,g)}else f.call(this,g)},_end:function(){l.superclass._end.apply(this,arguments);this.__set("node",
0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(g){return m.one(g)}}}});return l},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(j,r,s,n){function m(){var d=this;m.superclass.constructor.apply(d,arguments);d.addTarget(n);j.each(["dropexit","dropenter","dropover","drophit"],function(l){d.publish(l,{bubbles:1})});d._init()}m.ATTRS={node:{setter:function(d){if(d)return r.one(d)}},groups:{value:true}};j.extend(m,s,{getNodeFromTarget:function(d,l,g){d=this.get("node");var c=d[0];return c==l||c==g?null:d},_init:function(){n._regDrop(this)},_active:function(){var d=n.get("activeDrag"),l=this.get("node"),
g=this.get("groups"),c=d.get("groups");d=n.get("prefixCls");a:if(g===true)g=1;else{for(var i in g)if(c[i]){g=1;break a}g=0}if(g){n._addValidDrop(this);l&&l.addClass(d+"drop-active-valid")}else l&&l.addClass(d+"drop-active-invalid")},_deActive:function(){var d=this.get("node"),l=n.get("prefixCls");d&&d.removeClass(l+"drop-active-valid").removeClass(l+"drop-active-invalid")},__getCustomEvt:function(d){return j.mix({drag:n.get("activeDrag"),drop:this},d)},_handleOut:function(){var d=this.__getCustomEvt();
this.get("node").removeClass(n.get("prefixCls")+"drop-over");this.fire("dropexit",d)},_handleEnter:function(d){d=this.__getCustomEvt(d);d.drag._handleEnter(d);this.get("node").addClass(n.get("prefixCls")+"drop-over");this.fire("dropenter",d)},_handleOver:function(d){d=this.__getCustomEvt(d);d.drag._handleOver(d);this.fire("dropover",d)},_end:function(){var d=this.__getCustomEvt();this.get("node").removeClass(n.get("prefixCls")+"drop-over");this.fire("drophit",d)},destroy:function(){n._unRegDrop(this)}});
return m},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(j,r,s){function n(){n.superclass.constructor.apply(this,arguments);this[m]={}}var m="__proxy_destructors",d=j.stamp,l=j.guid("__dd_proxy"),g="__proxy";n.ATTRS={node:{value:function(c){return new r(c.get("node").clone(true))}},destroyOnEnd:{value:false},moveOnEnd:{value:true}};j.extend(n,s,{attach:function(c){function i(){var e=k.get("node"),h=c.get("node");if(k[g])e=k[g];else if(j.isFunction(e)){e=e(c);e.addClass("ks-dd-proxy");e.css("position","absolute");k[g]=e}h.parent().append(e);
e.show();e.offset(h.offset());c.__set("dragNode",h);c.__set("node",e)}function f(){var e=k[g];k.get("moveOnEnd")&&c.get("dragNode").offset(e.offset());if(k.get("destroyOnEnd")){e.remove();k[g]=0}else e.hide();c.__set("node",c.get("dragNode"))}var k=this,a=d(c,1,l);if(!(a&&k[m][a])){c.on("dragstart",i);c.on("dragend",f);a=d(c,0,l);k[m][a]={drag:c,fn:function(){c.detach("dragstart",i);c.detach("dragend",f)}}}},unAttach:function(c){c=d(c,1,l);var i=this[m];if(c&&i[c]){i[c].fn();delete i[c]}},destroy:function(){var c=
this.get("node"),i=this[m];c&&!j.isFunction(c)&&c.remove();for(var f in i)this.unAttach(i[f].drag)}});return n},{requires:["node","base"]});
KISSY.add("dd/scroll",function(j,r,s,n){function m(){m.superclass.constructor.apply(this,arguments);this[c]={}}var d=j.Env.host,l=j.stamp,g=100,c="__dd_scrolls";m.ATTRS={node:{valueFn:function(){return s.one(d)},setter:function(f){return s.one(f)}},rate:{value:[10,10]},diff:{value:[20,20]}};var i=j.isWindow;j.extend(m,r,{getRegion:function(f){return i(f[0])?{width:n.viewportWidth(),height:n.viewportHeight()}:{width:f.outerWidth(),height:f.outerHeight()}},getOffset:function(f){return i(f[0])?{left:n.scrollLeft(),
top:n.scrollTop()}:f.offset()},getScroll:function(f){return{left:f.scrollLeft(),top:f.scrollTop()}},setScroll:function(f,k){f.scrollLeft(k.left);f.scrollTop(k.top)},unAttach:function(f){var k,a=this[c];if((k=l(f,1,"__dd-scroll-id-"))&&a[k]){a[k].fn();delete a[k]}},destroy:function(){var f=this[c],k;for(k in f)this.unAttach(f[k].drag)},attach:function(f){function k(t){if(!t.fake){var b=h.get("node");A=t;z=j.clone(f.mousePos);t=h.getOffset(b);z.left-=t.left;z.top-=t.top;C||e()}}function a(){clearTimeout(C);
C=null}function e(){var t=h.get("node"),b=h.getRegion(t),o=b.width;b=b.height;var p=h.getScroll(t),D=j.clone(p),v=false;if(z.top-b>=-B[1]){p.top+=x[1];v=true}if(z.top<=B[1]){p.top-=x[1];v=true}if(z.left-o>=-B[0]){p.left+=x[0];v=true}if(z.left<=B[0]){p.left-=x[0];v=true}if(v){h.setScroll(t,p);C=setTimeout(e,g);A.fake=true;if(i(t[0])){p=h.getScroll(t);A.left+=p.left-D.left;A.top+=p.top-D.top}f.get("move")&&f.get("node").offset(A);f.fire("drag",A)}else C=null}var h=this,q=l(f,0,"__dd-scroll-id-"),y=
h[c];if(!y[q]){var x=h.get("rate"),B=h.get("diff"),A,z,C=null;f.on("drag",k);f.on("dragend",a);y[q]={drag:f,fn:function(){f.detach("drag",k);f.detach("dragend",a)}}}}});return m},{requires:["base","node","dom"]});
