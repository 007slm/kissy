/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Mar 22 14:50
*/
KISSY.add("dd/ddm",function(j,r,s,l,k,d){function n(){n.superclass.constructor.apply(this,arguments)}function c(b,g){var o=b.get("activeDrag"),y=o.get("mode"),v=b.get("drops"),u,w=0,C=0,B=m(o.get("node")),G=a(B);j.each(v,function(D){var x;if(x=D.getNodeFromTarget(g,o.get("dragNode")[0],o.get("node")[0]))if(y=="point"){if(e(m(x),o.mousePos)){x=a(m(x));if(u){if(x<C){u=D;C=x}}else{u=D;C=x}}}else if(y=="intersect"){x=a(f(B,m(x)));if(x>C){C=x;u=D}}else if(y=="strict"){x=a(f(B,m(x)));if(x==G){u=D;return false}}});
if((w=b.get("activeDrop"))&&w!=u){w._handleOut(g);o._handleOut(g)}b.set("activeDrop",u);if(u)w!=u?u._handleEnter(g):u._handleOver(g)}function h(b){var g=document;b._shim=(new k("<div style='background-color:red;position:"+(t?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+A.get("dragCursor")+";z-index:"+F+";'></div>")).prependTo(g.body||g.documentElement).css("opacity",0);h=p;t&&l.on(q,"resize scroll",E,b);p(b)}function p(b){var g=b.get("activeDrag").get("activeHandler"),o="auto";
if(g)o=g.css("cursor");if(o=="auto")o=b.get("dragCursor");b._shim.css({cursor:o,display:"block"});t&&E.call(b)}function m(b){var g=b.offset();return{left:g.left,right:g.left+b.outerWidth(),top:g.top,bottom:g.top+b.outerHeight()}}function e(b,g){return b.left<=g.left&&b.right>=g.left&&b.top<=g.top&&b.bottom>=g.top}function a(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function f(b,g){return{left:Math.max(b.left,g.left),right:Math.min(b.right,g.right),top:Math.max(b.top,
g.top),bottom:Math.min(b.bottom,g.bottom)}}var i=document,q=window,t=r.ie===6,z=j.throttle(function(b){var g=this.__activeToDrag,o=this.get("activeDrag");if(o||g)b.preventDefault();if(o){o._move(b);c(this,b)}else g&&g._move(b)},30),F=999999;n.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var E=j.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:s.docWidth(),
height:s.docHeight()})},30);j.extend(n,d,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=j.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){l.on(i,"mouseup",this._end,this);l.on(i,"mousemove",z,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&h(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),g=
this.get("activeDrop"),o={drag:b,drop:g};l.remove(i,"mousemove",z,this);l.remove(i,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();if(g){g._end();this.fire("drophit",o);this.fire("dragdrophit",o)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});this.set("activeDrag",null);this.set("activeDrop",null)}}});var A=new n;A.inRegion=e;A.region=m;A.area=a;return A},{requires:["ua","dom","event",
"node","base"]});
KISSY.add("dd/draggable",function(j,r,s,l,k){function d(){d.superclass.constructor.apply(this,arguments);this._init()}function n(){return false}function c(a){var f=a.target;this._checkMouseDown(a)&&this._check(f)&&this._prepare(a)}var h=j.each,p=r.ie,m=document;d.POINT="point";d.INTERSECT="intersect";d.STRICT="strict";d.ATTRS={node:{setter:function(a){return s.one(a)}},clickPixelThresh:{valueFn:function(){return k.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return k.get("bufferTime")}},dragNode:{},
shim:{value:true},handlers:{value:[],getter:function(a){var f=this;a.length||(a[0]=f.get("node"));h(a,function(i,q){if(j.isFunction(i))i=i.call(f);if(j.isString(i)||i.nodeType)i=s.one(i);a[q]=i});f.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](k.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](k.get("prefixCls")+"-disabled");
return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true}};var e;j.extend(d,l,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",c,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},destroy:function(){this.get("dragNode").detach("mousedown",c,this).detach("dragstart",this._fixDragStart);this.detach()},_check:function(a){var f=this,i=f.get("handlers"),
q=0;h(i,function(t){if(t.contains(a)||t[0]==a){q=1;f.set("activeHandler",t);return false}});return q},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var f=this;if(p){e=m.body.onselectstart;m.body.onselectstart=n}f.get("halt")?a.halt():a.preventDefault();var i=f.get("node"),q=a.pageX;a=a.pageY;i=i.offset();f.startMousePos=f.mousePos={left:q,top:a};f.startNodePos=i;f._diff={left:q-i.left,top:a-i.top};k._regToDrag(f);
if(q=f.get("bufferTime"))f._bufferTimer=setTimeout(function(){f._start()},q)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var f,i=this._diff;f=this.startMousePos;var q=a.pageX;a=a.pageY;var t=q-i.left;i=a-i.top;if(this.get("dragging")){this.mousePos={left:q,top:a};f={left:t,top:i,pageX:q,pageY:a,drag:this};q=1;if(this.fire("drag",f)===false)q=0;if(k.fire("drag",f)===false)q=0;q&&this.get("move")&&this.get("node").offset(f)}else{i=
this.get("clickPixelThresh");if(Math.abs(q-f.left)>=i||Math.abs(a-f.top)>=i)this._start()}},_end:function(){var a;this._clearBufferTimer();if(p)m.body.onselectstart=e;if(this.get("dragging")){this.get("node").removeClass(k.get("prefixCls")+"drag-over");(a=k.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.set("dragging",0);this.fire("dragend",{drag:this})}},_handleOut:function(){this.get("node").removeClass(k.get("prefixCls")+"drag-over");this.fire("dragexit",
{drag:this,drop:k.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(k.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.set("dragging",1);k._start();this.fire("dragstart",{drag:this})}});return d},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(j,r,s,l){function k(){k.superclass.constructor.apply(this,arguments);this._init()}k.ATTRS={node:{setter:function(d){if(d)return r.one(d)}}};j.extend(k,s,{getNodeFromTarget:function(d,n,c){d=this.get("node");var h=d[0];return h==n||h==c?null:d},_init:function(){l._regDrop(this)},__getCustomEvt:function(d){return j.mix({drag:l.get("activeDrag"),drop:this},d)},_handleOut:function(){var d=this.__getCustomEvt();this.get("node").removeClass(l.get("prefixCls")+"drop-over");
this.fire("dropexit",d);l.fire("dropexit",d);l.fire("dragexit",d)},_handleEnter:function(d){d=this.__getCustomEvt(d);d.drag._handleEnter(d);this.get("node").addClass(l.get("prefixCls")+"drop-over");this.fire("dropenter",d);l.fire("dragenter",d);l.fire("dropenter",d)},_handleOver:function(d){d=this.__getCustomEvt(d);d.drag._handleOver(d);this.fire("dropover",d);l.fire("dragover",d);l.fire("dropover",d)},_end:function(){var d=this.__getCustomEvt();this.get("node").removeClass(l.get("prefixCls")+"drop-over");
this.fire("drophit",d)},destroy:function(){l._unregDrop(this)}});return k},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(j,r){function s(){s.superclass.constructor.apply(this,arguments);this[l]={}}var l="__proxy_destructors",k=j.stamp,d=j.guid("__dd_proxy"),n="__proxy";s.ATTRS={node:{value:function(c){return new r(c.get("node").clone(true))}},destroyOnEnd:{value:false}};j.extend(s,j.Base,{attach:function(c){function h(){var a=m.get("node"),f=c.get("node");if(m[n])a=m[n];else if(j.isFunction(a)){a=a(c);a.addClass("ks-dd-proxy");a.css("position","absolute");m[n]=a}f.parent().append(a);a.show();
a.offset(f.offset());c.set("dragNode",f);c.set("node",a)}function p(){var a=m[n];c.get("dragNode").offset(a.offset());a.hide();if(m.get("destroyOnEnd")){a.remove();m[n]=0}c.set("node",c.get("dragNode"))}var m=this,e;if(!(e=k(c,1,d)&&m[l][e])){c.on("dragstart",h);c.on("dragend",p);e=k(c,0,d);m[l][e]={drag:c,fn:function(){c.detach("dragstart",h);c.detach("dragend",p)}}}},unAttach:function(c){c=k(c,1,d);var h=this[l];if(c&&h[c]){h[c].fn();delete h[c]}},destroy:function(){var c=this.get("node"),h=this[l];
c&&!j.isFunction(c)&&c.remove();for(var p in h)this.unAttach(h[p].drag)}});return s},{requires:["node"]});
KISSY.add("dd/draggable-delegate",function(j,r,s,l,k){function d(){d.superclass.constructor.apply(this,arguments)}function n(c){var h;if(this._checkMouseDown(c)){h=this.get("handlers");var p=new k(c.target);if(h=h.length?this._getHandler(p):p){this.set("activeHandler",h);h=this._getNode(h);this.set("node",h);this.set("dragNode",h);this._prepare(c)}}}j.extend(d,s,{_init:function(){this.get("container").on("mousedown",n,this).on("dragstart",this._fixDragStart)},_getHandler:function(c){for(var h,p=this.get("container"),
m=this.get("handlers");c&&c[0]!==p[0];){j.each(m,function(e){if(l.test(c[0],e)){h=c;return false}});if(h)break;c=c.parent()}return h},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",n,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(c){return k.one(c)}},selector:{},handlers:{value:[],getter:0}}});return d},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(j,r,s,l,k){function d(){var c=this.get("container"),h=this.get("selector");this.__allNodes=c.all(h)}function n(){n.superclass.constructor.apply(this,arguments);r.on("dragstart",d,this)}j.extend(n,s,{getNodeFromTarget:function(c,h,p){var m={left:c.pageX,top:c.pageY};c=this.__allNodes;var e=0,a=Number.MAX_VALUE;c&&c.each(function(f){var i=f[0];if(!(i===p||i===h))if(r.inRegion(r.region(f),m)){i=r.area(r.region(f));if(i<a){a=i;e=f}}});if(e){this.set("lastNode",
this.get("node"));this.set("node",e)}return e},_handleOut:function(){n.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(c){var h=this.get("node"),p=n.superclass._handleOut,m=n.superclass._handleOver,e=n.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==h[0]){this.set("node",a);p.apply(this,arguments);this.set("node",h);e.call(this,c)}else m.call(this,c)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(c){return k.one(c)}}}});
return n},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(j,r,s,l,k){function d(){d.superclass.constructor.apply(this,arguments);this[p]={}}var n=j.Env.host,c=j.stamp,h=100,p="__dd_scrolls";d.ATTRS={node:{valueFn:function(){return l.one(n)},setter:function(e){return l.one(e)}},rate:{value:[10,10]},diff:{value:[20,20]}};var m=j.isWindow;j.extend(d,s,{getRegion:function(e){return m(e[0])?{width:k.viewportWidth(),height:k.viewportHeight()}:{width:e.outerWidth(),height:e.outerHeight()}},getOffset:function(e){return m(e[0])?{left:k.scrollLeft(),
top:k.scrollTop()}:e.offset()},getScroll:function(e){return{left:e.scrollLeft(),top:e.scrollTop()}},setScroll:function(e,a){e.scrollLeft(a.left);e.scrollTop(a.top)},unAttach:function(e){var a,f=this[p];if((a=c(e,1,"__dd-scroll-id-"))&&f[a]){f[a].fn();delete f[a]}},destroy:function(){var e=this[p],a;for(a in e)this.unAttach(e[a].drag)},attach:function(e){function a(){if(m(z[0]))return 0;var v=e.mousePos,u=r.region(z);if(!r.inRegion(u,v)){clearTimeout(y);y=0;return 1}return 0}function f(v){if(!v.fake)if(!a()){g=
v;o=j.clone(e.mousePos);v=t.getOffset(z);o.left-=v.left;o.top-=v.top;y||q()}}function i(){clearTimeout(y);y=null}function q(){if(!a()){var v=t.getRegion(z),u=v.width;v=v.height;var w=t.getScroll(z),C=j.clone(w),B=false;if(o.top-v>=-b[1]){w.top+=A[1];B=true}if(o.top<=b[1]){w.top-=A[1];B=true}if(o.left-u>=-b[0]){w.left+=A[0];B=true}if(o.left<=b[0]){w.left-=A[0];B=true}if(B){t.setScroll(z,w);y=setTimeout(q,h);g.fake=true;if(m(z[0])){w=t.getScroll(z);g.left+=w.left-C.left;g.top+=w.top-C.top}e.get("move")&&
e.get("node").offset(g);e.fire("drag",g)}else y=null}}var t=this,z=t.get("node"),F=c(e,0,"__dd-scroll-id-"),E=t[p];if(!E[F]){var A=t.get("rate"),b=t.get("diff"),g,o,y=null;e.on("drag",f);e.on("dragend",i);E[F]={drag:e,fn:function(){e.detach("drag",f);e.detach("dragend",i)}}}}});return d},{requires:["./ddm","base","node","dom"]});
KISSY.add("dd",function(j,r,s,l,k,d,n,c){r={Draggable:s,Droppable:l,DDM:r,Proxy:k,DraggableDelegate:d,DroppableDelegate:n,Scroll:c};j.mix(j,r);return r},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
