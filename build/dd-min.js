/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Nov 22 22:35
*/
KISSY.add("dd/ddm",function(j,q,o,k,i){function d(){d.superclass.constructor.apply(this,arguments)}function h(b,g){var l=b.get("activeDrag"),w=l.get("mode"),C=b.get("drops"),r,y=0,t=0,D=c(l.get("node")),E=m(D);j.each(C,function(A){var s;if(s=A.getNodeFromTarget(g,l.get("dragNode")[0],l.get("node")[0]))if(w=="point"){if(f(c(s),l.mousePos)){s=m(c(s));if(r){if(s<t){r=A;t=s}}else{r=A;t=s}}}else if(w=="intersect"){s=m(n(D,c(s)));if(s>t){t=s;r=A}}else if(w=="strict"){s=m(n(D,c(s)));if(s==E){r=A;return false}}});
if((y=b.get("activeDrop"))&&y!=r){y._handleOut(g);l._handleOut(g)}b.set("activeDrop",r);if(r)y!=r?r._handleEnter(g):r._handleOver(g)}function a(b){var g=document;b._shim=(new k("<div style='background-color:red;position:absolute;left:0;top:0;cursor:"+u.get("dragCursor")+";z-index:"+z+";'></div>")).prependTo(g.body||g.documentElement).css("opacity",0);a=e;o.on(v,"resize",x,b);o.on(v,"scroll",x,b);e(b)}function e(b){var g=b.get("activeDrag").get("activeHandler"),l="auto";if(g)l=g.css("cursor");if(l==
"auto")l=b.get("dragCursor");b._shim.css({cursor:l,display:"block"});x.call(b)}function c(b){var g=b.offset();return{left:g.left,right:g.left+b.outerWidth(),top:g.top,bottom:g.top+b.outerHeight()}}function f(b,g){return b.left<=g.left&&b.right>=g.left&&b.top<=g.top&&b.bottom>=g.top}function m(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function n(b,g){return{left:Math.max(b.left,g.left),right:Math.min(b.right,g.right),top:Math.max(b.top,g.top),bottom:Math.min(b.bottom,
g.bottom)}}var p=document,v=window,B=j.throttle(function(b){var g=this.__activeToDrag,l=this.get("activeDrag");if(l||g)b.preventDefault();if(l){l._move(b);h(this,b)}else g&&g._move(b)},30),z=999999;d.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var x=j.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:q.docWidth(),height:q.docHeight()})},30);j.extend(d,
i,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=j.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){o.on(p,"mouseup",this._end,this);o.on(p,"mousemove",B,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&a(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),g=this.get("activeDrop"),l={drag:b,drop:g};
o.remove(p,"mousemove",B,this);o.remove(p,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._clearBufferTimer();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();if(g){g._end();this.fire("drophit",l);this.fire("dragdrophit",l)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});this.set("activeDrag",null);this.set("activeDrop",null)}}});var u=new d;u.inRegion=f;u.region=c;u.area=m;return u},{requires:["dom","event","node","base"]});
KISSY.add("dd/draggable",function(j,q,o,k,i){function d(){d.superclass.constructor.apply(this,arguments);this._init()}var h=j.each;d.POINT="point";d.INTERSECT="intersect";d.STRICT="strict";d.ATTRS={node:{setter:function(a){return o.one(a)}},clickPixelThresh:{value:i.get("clickPixelThresh")},bufferTime:{value:i.get("bufferTime")},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var e=this;a.length||(a[0]=e.get("node"));h(a,function(c,f){if(j.isFunction(c))c=c.call(e);if(j.isString(c)||
c.nodeType)c=o.one(c);c.unselectable();a[f]=c});e.__set("handlers",a);return a}},activeHandler:{},mode:{value:"point"}};j.extend(d,k,{__started:0,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",this._handleMouseDown,this)},destroy:function(){this.get("dragNode").detach("mousedown",this._handleMouseDown,this);this.detach()},_check:function(a){var e=this,c=e.get("handlers"),f=0;h(c,function(m){if(m.contains(a)||m[0]==a[0]){f=1;e.set("activeHandler",m);return false}});
return f},_handleMouseDown:function(a){if(this._check(new o(a.target))){a.preventDefault();this._prepare(a)}},_prepare:function(a){var e=this,c=e.get("node"),f=a.pageX;a=a.pageY;c=c.offset();e.startMousePos=e.mousePos={left:f,top:a};e.startNodePos=c;e._diff={left:f-c.left,top:a-c.top};i._regToDrag(e);if(f=e.get("bufferTime"))e._bufferTimer=setTimeout(function(){e._start()},f)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var e,
c=this._diff;e=this.startMousePos;var f=a.pageX;a=a.pageY;var m=f-c.left;c=a-c.top;if(this.__started){this.mousePos={left:f,top:a};e={left:m,top:c,pageX:f,pageY:a,drag:this};this.fire("drag",e);i.fire("drag",e)}else{c=this.get("clickPixelThresh");if(Math.abs(f-e.left)>=c||Math.abs(a-e.top)>=c)this._start()}},_end:function(){var a;this.get("dragNode").removeClass(i.get("prefixCls")+"dragging");this.get("node").removeClass(i.get("prefixCls")+"drag-over");this._clearBufferTimer();(a=i.get("activeDrop"))?
this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.fire("dragend",{drag:this});this.__started=0},_handleOut:function(){this.get("node").removeClass(i.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:i.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(i.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.__started=1;this.get("dragNode").addClass(i.get("prefixCls")+
"dragging");i._start();this.fire("dragstart",{drag:this})}});return d},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(j,q,o,k){function i(){i.superclass.constructor.apply(this,arguments);this._init()}i.ATTRS={node:{setter:function(d){if(d)return q.one(d)}}};j.extend(i,o,{getNodeFromTarget:function(d,h,a){d=this.get("node");var e=d[0];return e==h||e==a?null:d},_init:function(){k._regDrop(this)},__getCustomEvt:function(d){return j.mix({drag:k.get("activeDrag"),drop:this},d)},_handleOut:function(){var d=this.__getCustomEvt();this.get("node").removeClass(k.get("prefixCls")+"drop-over");
this.fire("dropexit",d);k.fire("dropexit",d);k.fire("dragexit",d)},_handleEnter:function(d){d=this.__getCustomEvt(d);d.drag._handleEnter(d);this.get("node").addClass(k.get("prefixCls")+"drop-over");this.fire("dropenter",d);k.fire("dragenter",d);k.fire("dropenter",d)},_handleOver:function(d){d=this.__getCustomEvt(d);d.drag._handleOver(d);this.fire("dropover",d);k.fire("dragover",d);k.fire("dropover",d)},_end:function(){var d=this.__getCustomEvt();this.get("node").removeClass(k.get("prefixCls")+"drop-over");
this.fire("drophit",d)},destroy:function(){k._unregDrop(this)}});return i},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(j,q){function o(){o.superclass.constructor.apply(this,arguments);this[k]={}}var k="__proxy_destructors",i=j.stamp,d=j.guid("__dd_proxy"),h="__proxy";o.ATTRS={node:{value:function(a){return new q(a.get("node").clone(true))}},destroyOnEnd:{value:false}};j.extend(o,j.Base,{attach:function(a){function e(){var n=f.get("node"),p=a.get("node");if(f[h])n=f[h];else if(j.isFunction(n)){n=n(a);n.addClass("ks-dd-proxy");n.css("position","absolute");f[h]=n}p.parent().append(n);n.show();
n.offset(p.offset());a.set("dragNode",p);a.set("node",n)}function c(){var n=f[h];a.get("dragNode").offset(n.offset());n.hide();if(f.get("destroyOnEnd")){n.remove();f[h]=0}a.set("node",a.get("dragNode"))}var f=this,m;if(!(m=i(a,1,d)&&f[k][m])){a.on("dragstart",e);a.on("dragend",c);m=i(a,0,d);f[k][m]={drag:a,fn:function(){a.detach("dragstart",e);a.detach("dragend",c)}}}},unAttach:function(a){a=i(a,1,d);var e=this[k];if(a&&e[a]){e[a].fn();delete e[a]}},destroy:function(){var a=this.get("node"),e=this[k];
a&&!j.isFunction(a)&&a.remove();for(var c in e)this.unAttach(e[c].drag)}});return o},{requires:["node"]});
KISSY.add("dd/draggable-delegate",function(j,q,o,k,i){function d(){d.superclass.constructor.apply(this,arguments)}j.extend(d,o,{_init:function(){this.get("container").on("mousedown",this._handleMouseDown,this)},_getHandler:function(h){for(var a,e=this.get("container"),c=this.get("handlers");h&&h[0]!==e[0];){j.each(c,function(f){if(k.test(h[0],f)){a=h;return false}});if(a)break;h=h.parent()}return a},_getNode:function(h){return h.closest(this.get("selector"),this.get("container"))},_handleMouseDown:function(h){var a;
a=this.get("handlers");var e=new i(h.target);if(a=a.length?this._getHandler(e):e){this.set("activeHandler",a);a=this._getNode(a);h.preventDefault();this.set("node",a);this.set("dragNode",a);this._prepare(h)}},destroy:function(){this.get("container").detach("mousedown",this._handleMouseDown,this);this.detach()}},{ATTRS:{container:{setter:function(h){return i.one(h)}},selector:{},handlers:{value:[],getter:0}}});return d},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(j,q,o,k,i){function d(){var a=this.get("container"),e=this.get("selector");this.__allNodes=a.all(e)}function h(){h.superclass.constructor.apply(this,arguments);q.on("dragstart",d,this)}j.extend(h,o,{getNodeFromTarget:function(a,e,c){var f={left:a.pageX,top:a.pageY};a=this.__allNodes;var m=0,n=Number.MAX_VALUE;a&&a.each(function(p){var v=p[0];if(!(v===c||v===e))if(q.inRegion(q.region(p),f)){v=q.area(q.region(p));if(v<n){n=v;m=p}}});if(m){this.set("lastNode",
this.get("node"));this.set("node",m)}return m},_handleOut:function(){h.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(a){var e=this.get("node"),c=h.superclass._handleOut,f=h.superclass._handleOver,m=h.superclass._handleEnter,n=this.get("lastNode");if(n[0]!==e[0]){this.set("node",n);c.apply(this,arguments);this.set("node",e);m.call(this,a)}else f.call(this,a)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return i.one(a)}}}});
return h},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(j,q,o,k){function i(){i.superclass.constructor.apply(this,arguments);this[a]={}}var d=j.stamp,h=100,a="__dd_scrolls";i.ATTRS={node:{valueFn:function(){return o.one(window)},setter:function(c){return o.one(c)}},rate:{value:[10,10]},diff:{value:[20,20]}};var e=j.isWindow;j.extend(i,q,{getRegion:function(c){return e(c[0])?{width:k.viewportWidth(),height:k.viewportHeight()}:{width:c.outerWidth(),height:c.outerHeight()}},getOffset:function(c){return e(c[0])?{left:k.scrollLeft(),
top:k.scrollTop()}:c.offset()},getScroll:function(c){return{left:c.scrollLeft(),top:c.scrollTop()}},setScroll:function(c,f){c.scrollLeft(f.left);c.scrollTop(f.top)},unAttach:function(c){var f,m=this[a];if((f=d(c,1,"__dd-scroll-id-"))&&m[f]){m[f].fn();delete m[f]}},destroy:function(){var c=this[a],f;for(f in c)this.unAttach(c[f].drag)},attach:function(c){function f(l){if(!l.fake){var w=p.get("node");u=l;b=j.clone(c.mousePos);l=p.getOffset(w);b.left-=l.left;b.top-=l.top;g||n()}}function m(){clearTimeout(g);
g=null}function n(){var l=p.get("node"),w=p.getRegion(l),C=w.width;w=w.height;var r=p.getScroll(l),y=j.clone(r),t=false;if(b.top-w>=-x[1]){r.top+=z[1];t=true}if(b.top<=x[1]){r.top-=z[1];t=true}if(b.left-C>=-x[0]){r.left+=z[0];t=true}if(b.left<=x[0]){r.left-=z[0];t=true}if(t){p.setScroll(l,r);g=setTimeout(n,h);u.fake=true;if(e(l[0])){r=p.getScroll(l);u.left+=r.left-y.left;u.top+=r.top-y.top}c.fire("drag",u)}else g=null}var p=this,v=d(c,0,"__dd-scroll-id-"),B=p[a];if(!B[v]){var z=p.get("rate"),x=p.get("diff"),
u,b,g=null;c.on("drag",f);c.on("dragend",m);B[v]={drag:c,fn:function(){c.detach("drag",f);c.detach("dragend",m)}}}}});return i},{requires:["base","node","dom"]});KISSY.add("dd",function(j,q,o,k,i,d,h,a){q={Draggable:o,Droppable:k,DDM:q,Proxy:i,DraggableDelegate:d,DroppableDelegate:h,Scroll:a};j.mix(j,q);return q},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
