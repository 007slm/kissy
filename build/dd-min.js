/*
Copyright 2011, KISSY UI Library v1.30dev
MIT Licensed
build time: Dec 27 12:01
*/
KISSY.add("dd/constrain",function(n,r,p){function k(){k.superclass.constructor.apply(this,arguments)}function l(d){var e,h;d=d.drag.get("dragNode");var i=this.get("constrain");if(i){if(i===true){var a=c(window);this.__constrainRegion={left:e=a.scrollLeft(),top:h=a.scrollTop(),right:e+a.width(),bottom:h+a.height()}}if(i.nodeType||n.isString(i))i=c(i);if(i.getDOMNode){e=i.offset();this.__constrainRegion={left:e.left,top:e.top,right:e.left+i.outerWidth(),bottom:e.top+i.outerHeight()}}else if(n.isPlainObject(i))this.__constrainRegion=
i;if(this.__constrainRegion){this.__constrainRegion.right-=d.outerWidth();this.__constrainRegion.bottom-=d.outerHeight()}}}function f(d){d=d.info;var e=d.left,h=d.top,i=this.__constrainRegion;if(i){d.left=Math.min(Math.max(i.left,e),i.right);d.top=Math.min(Math.max(i.top,h),i.bottom)}}function o(){this.__constrainRegion=null}var c=p.all;n.extend(k,r,{__constrainRegion:null,attach:function(d){d.on("dragstart",l,this).on("dragend",o,this).on("dragalign",f,this)},unattach:function(d){d.detach("dragstart",
l,this).detach("dragend",o,this).detach("dragalign",f,this)}},{ATTRS:{constrain:{value:true}}});return k},{requires:["base","node"]});KISSY.add("dd",function(n,r,p,k,l,f,o,c,d){return{Draggable:p,Droppable:k,DDM:r,Constrain:f,Proxy:l,DraggableDelegate:o,DroppableDelegate:c,Scroll:d}},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/constrain","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
KISSY.add("dd/ddm",function(n,r,p,k,l,f){function o(){o.superclass.constructor.apply(this,arguments)}function c(b,j){var s=b.get("activeDrag"),w=s.get("mode"),z=b.get("drops"),t=0,C=0,E=h(s.get("node")),F=a(E);n.each(z,function(D){var u;if(u=D.getNodeFromTarget(j,s.get("dragNode")[0],s.get("node")[0]))if(w=="point"){if(i(h(u),s.mousePos)){u=a(h(u));if(t){if(u<C){t=D;C=u}}else{t=D;C=u}}}else if(w=="intersect"){u=a(g(E,h(u)));if(u>C){C=u;t=D}}else if(w=="strict"){u=a(g(E,h(u)));if(u==F){t=D;return false}}});
if((z=b.get("activeDrop"))&&z!=t){z._handleOut(j);s._handleOut(j)}b.set("activeDrop",t);if(t)z!=t?t._handleEnter(j):t._handleOver(j)}function d(b){var j=document;b._shim=(new l("<div style='background-color:red;position:"+(v?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+x.get("dragCursor")+";z-index:"+A+";'></div>")).prependTo(j.body||j.documentElement).css("opacity",0);d=e;v&&k.on(q,"resize scroll",y,b);e(b)}function e(b){var j=b.get("activeDrag").get("activeHandler"),s="auto";
if(j)s=j.css("cursor");if(s=="auto")s=b.get("dragCursor");b._shim.css({cursor:s,display:"block"});v&&y.call(b)}function h(b){var j=b.offset();return{left:j.left,right:j.left+b.outerWidth(),top:j.top,bottom:j.top+b.outerHeight()}}function i(b,j){return b.left<=j.left&&b.right>=j.left&&b.top<=j.top&&b.bottom>=j.top}function a(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function g(b,j){return{left:Math.max(b.left,j.left),right:Math.min(b.right,j.right),top:Math.max(b.top,
j.top),bottom:Math.min(b.bottom,j.bottom)}}var m=document,q=window,v=r.ie===6,B=n.throttle(function(b){var j=this.__activeToDrag,s=this.get("activeDrag");if(s||j)b.preventDefault();if(s){s._move(b);c(this,b)}else j&&j._move(b)},30),A=999999;o.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var y=n.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:p.docWidth(),
height:p.docHeight()})},30);n.extend(o,f,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=n.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){k.on(m,"mouseup",this._end,this);k.on(m,"mousemove",B,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&d(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),j=
this.get("activeDrop"),s={drag:b,drop:j};k.remove(m,"mousemove",B,this);k.remove(m,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();if(j){j._end();this.fire("drophit",s);this.fire("dragdrophit",s)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});this.set("activeDrag",null);this.set("activeDrop",null)}}});var x=new o;x.inRegion=i;x.region=h;x.area=a;return x},{requires:["ua","dom","event",
"node","base"]});
KISSY.add("dd/draggable-delegate",function(n,r,p,k,l){function f(){f.superclass.constructor.apply(this,arguments)}function o(c){var d;if(this._checkMouseDown(c)){d=this.get("handlers");var e=new l(c.target);if(d=d.length?this._getHandler(e):e){this.set("activeHandler",d);d=this._getNode(d);this.set("node",d);this.set("dragNode",d);this._prepare(c)}}}n.extend(f,p,{_init:function(){this.get("container").on("mousedown",o,this).on("dragstart",this._fixDragStart)},_getHandler:function(c){for(var d=undefined,
e=this.get("container"),h=this.get("handlers");c&&c[0]!==e[0];){n.each(h,function(i){if(k.test(c[0],i)){d=c;return false}});if(d)break;c=c.parent()}return d},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",o,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(c){return l.one(c)}},selector:{},handlers:{value:[],getter:0}}});return f},{requires:["./ddm","./draggable",
"dom","node"]});
KISSY.add("dd/draggable",function(n,r,p,k,l){function f(){f.superclass.constructor.apply(this,arguments);this._init()}function o(){return false}function c(a){var g=a.target;this._checkMouseDown(a)&&this._check(g)&&this._prepare(a)}var d=n.each,e=r.ie,h=document;f.POINT="point";f.INTERSECT="intersect";f.STRICT="strict";f.ATTRS={node:{setter:function(a){return p.one(a)}},clickPixelThresh:{valueFn:function(){return l.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return l.get("bufferTime")}},dragNode:{},
shim:{value:true},handlers:{value:[],getter:function(a){var g=this;a.length||(a[0]=g.get("node"));d(a,function(m,q){if(n.isFunction(m))m=m.call(g);if(n.isString(m)||m.nodeType)m=p.one(m);a[q]=m});g.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](l.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](l.get("prefixCls")+"-disabled");
return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true}};var i;n.extend(f,k,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",c,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},_check:function(a){var g=this,m=g.get("handlers"),q=0;d(m,function(v){if(v.contains(a)||v[0]==a){q=1;g.set("activeHandler",v);return false}});return q},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&
a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var g=this;if(e){i=h.body.onselectstart;h.body.onselectstart=o}g.get("halt")?a.halt():a.preventDefault();var m=g.get("node"),q=a.pageX;a=a.pageY;m=m.offset();g.startMousePos=g.mousePos={left:q,top:a};g.startNodePos=m;g._diff={left:q-m.left,top:a-m.top};l._regToDrag(g);if(q=g.get("bufferTime"))g._bufferTimer=setTimeout(function(){g._start()},q)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);
this._bufferTimer=0}},_move:function(a){var g,m=this._diff;g=this.startMousePos;var q=a.pageX;a=a.pageY;var v=q-m.left;m=a-m.top;if(this.get("dragging")){this.mousePos={left:q,top:a};g={left:v,top:m,pageX:q,pageY:a,drag:this};this.fire("dragalign",{info:g});l.fire("dragalign",{info:g});q=1;if(this.fire("drag",g)===false)q=0;if(l.fire("drag",g)===false)q=0;q&&this.get("move")&&this.get("node").offset(g)}else{m=this.get("clickPixelThresh");if(Math.abs(q-g.left)>=m||Math.abs(a-g.top)>=m)this._start()}},
_end:function(){var a;this._clearBufferTimer();if(e)h.body.onselectstart=i;if(this.get("dragging")){this.get("node").removeClass(l.get("prefixCls")+"drag-over");(a=l.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.set("dragging",0);this.fire("dragend",{drag:this})}},_handleOut:function(){this.get("node").removeClass(l.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:l.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(l.get("prefixCls")+
"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.set("dragging",1);l._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",c,this).detach("dragstart",this._fixDragStart);this.detach()}});return f},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(n,r,p,k,l){function f(){var c=this.get("container"),d=this.get("selector");this.__allNodes=c.all(d)}function o(){o.superclass.constructor.apply(this,arguments);r.on("dragstart",f,this)}n.extend(o,p,{getNodeFromTarget:function(c,d,e){var h={left:c.pageX,top:c.pageY};c=this.__allNodes;var i=0,a=Number.MAX_VALUE;c&&c.each(function(g){var m=g[0];if(!(m===e||m===d))if(r.inRegion(r.region(g),h)){m=r.area(r.region(g));if(m<a){a=m;i=g}}});if(i){this.set("lastNode",
this.get("node"));this.set("node",i)}return i},_handleOut:function(){o.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(c){var d=this.get("node"),e=o.superclass._handleOut,h=o.superclass._handleOver,i=o.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==d[0]){this.set("node",a);e.apply(this,arguments);this.set("node",d);i.call(this,c)}else h.call(this,c)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(c){return l.one(c)}}}});
return o},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(n,r,p,k){function l(){l.superclass.constructor.apply(this,arguments);this._init()}l.ATTRS={node:{setter:function(f){if(f)return r.one(f)}}};n.extend(l,p,{getNodeFromTarget:function(f,o,c){f=this.get("node");var d=f[0];return d==o||d==c?null:f},_init:function(){k._regDrop(this)},__getCustomEvt:function(f){return n.mix({drag:k.get("activeDrag"),drop:this},f)},_handleOut:function(){var f=this.__getCustomEvt();this.get("node").removeClass(k.get("prefixCls")+"drop-over");
this.fire("dropexit",f);k.fire("dropexit",f);k.fire("dragexit",f)},_handleEnter:function(f){f=this.__getCustomEvt(f);f.drag._handleEnter(f);this.get("node").addClass(k.get("prefixCls")+"drop-over");this.fire("dropenter",f);k.fire("dragenter",f);k.fire("dropenter",f)},_handleOver:function(f){f=this.__getCustomEvt(f);f.drag._handleOver(f);this.fire("dropover",f);k.fire("dragover",f);k.fire("dropover",f)},_end:function(){var f=this.__getCustomEvt();this.get("node").removeClass(k.get("prefixCls")+"drop-over");
this.fire("drophit",f)},destroy:function(){k._unregDrop(this)}});return l},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(n,r){function p(){p.superclass.constructor.apply(this,arguments);this[k]={}}var k="__proxy_destructors",l=n.stamp,f=n.guid("__dd_proxy"),o="__proxy";p.ATTRS={node:{value:function(c){return new r(c.get("node").clone(true))}},destroyOnEnd:{value:false}};n.extend(p,n.Base,{attach:function(c){function d(){var a=h.get("node"),g=c.get("node");if(h[o])a=h[o];else if(n.isFunction(a)){a=a(c);a.addClass("ks-dd-proxy");a.css("position","absolute");h[o]=a}g.parent().append(a);a.show();
a.offset(g.offset());c.set("dragNode",g);c.set("node",a)}function e(){var a=h[o];c.get("dragNode").offset(a.offset());a.hide();if(h.get("destroyOnEnd")){a.remove();h[o]=0}c.set("node",c.get("dragNode"))}var h=this,i=l(c,1,f);if(!(i&&h[k][i])){c.on("dragstart",d);c.on("dragend",e);i=l(c,0,f);h[k][i]={drag:c,fn:function(){c.detach("dragstart",d);c.detach("dragend",e)}}}},unAttach:function(c){c=l(c,1,f);var d=this[k];if(c&&d[c]){d[c].fn();delete d[c]}},destroy:function(){var c=this.get("node"),d=this[k];
c&&!n.isFunction(c)&&c.remove();for(var e in d)this.unAttach(d[e].drag)}});return p},{requires:["node"]});
KISSY.add("dd/scroll",function(n,r,p,k){function l(){l.superclass.constructor.apply(this,arguments);this[c]={}}var f=n.stamp,o=100,c="__dd_scrolls";l.ATTRS={node:{valueFn:function(){return p.one(window)},setter:function(e){return p.one(e)}},rate:{value:[10,10]},diff:{value:[20,20]}};var d=n.isWindow;n.extend(l,r,{getRegion:function(e){return d(e[0])?{width:k.viewportWidth(),height:k.viewportHeight()}:{width:e.outerWidth(),height:e.outerHeight()}},getOffset:function(e){return d(e[0])?{left:k.scrollLeft(),
top:k.scrollTop()}:e.offset()},getScroll:function(e){return{left:e.scrollLeft(),top:e.scrollTop()}},setScroll:function(e,h){e.scrollLeft(h.left);e.scrollTop(h.top)},unAttach:function(e){var h,i=this[c];if((h=f(e,1,"__dd-scroll-id-"))&&i[h]){i[h].fn();delete i[h]}},destroy:function(){var e=this[c],h;for(h in e)this.unAttach(e[h].drag)},attach:function(e){function h(b){if(!b.fake){var j=g.get("node");A=b;y=n.clone(e.mousePos);b=g.getOffset(j);y.left-=b.left;y.top-=b.top;x||a()}}function i(){clearTimeout(x);
x=null}function a(){var b=g.get("node"),j=g.getRegion(b),s=j.width;j=j.height;var w=g.getScroll(b),z=n.clone(w),t=false;if(y.top-j>=-B[1]){w.top+=v[1];t=true}if(y.top<=B[1]){w.top-=v[1];t=true}if(y.left-s>=-B[0]){w.left+=v[0];t=true}if(y.left<=B[0]){w.left-=v[0];t=true}if(t){g.setScroll(b,w);x=setTimeout(a,o);A.fake=true;if(d(b[0])){w=g.getScroll(b);A.left+=w.left-z.left;A.top+=w.top-z.top}e.fire("drag",A)}else x=null}var g=this,m=f(e,0,"__dd-scroll-id-"),q=g[c];if(!q[m]){var v=g.get("rate"),B=g.get("diff"),
A,y,x=null;e.on("drag",h);e.on("dragend",i);q[m]={drag:e,fn:function(){e.detach("drag",h);e.detach("dragend",i)}}}}});return l},{requires:["base","node","dom"]});
