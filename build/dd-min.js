/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("dd/ddm",function(h,l,d,i,g){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function o(a,b,m){m=m||150;if(m===-1)return function(){a.apply(b,arguments)};var q=h.now();return function(){var p=h.now();if(p-q>m){q=p;a.apply(b,arguments)}}}function c(a){var b=a.offset();return{left:b.left,right:b.left+a[0].offsetWidth,top:b.top,bottom:b.top+a[0].offsetHeight}}function f(a){if(a.top>=a.bottom||a.left>=a.right)return 0;return(a.right-a.left)*(a.bottom-a.top)}function j(a,
b){return{left:Math.max(a.left,b.left),right:Math.min(a.right,b.right),top:Math.max(a.top,b.top),bottom:Math.min(a.bottom,b.bottom)}}var k=document,v=h.require("node/node");e.ATTRS={prefixCls:{value:"ks-dd-"},bufferTime:{value:200},activeDrag:{},activeDrop:{},drops:{value:[]}};h.extend(e,g,{_regDrop:function(a){this.get("drops").push(a)},_unregDrop:function(a){a=h.indexOf(a,this.get("drops"));a!=-1&&this.get("drops").splice(a,1)},_init:function(){this._showShimMove=o(this._move,this,30)},_move:function(a){var b=
this.get("activeDrag");if(b){a.preventDefault();b._move(a);this._notifyDropsMove(a)}},_notifyDropsMove:function(a){var b=this.get("activeDrag"),m=b.get("mode"),q=this.get("drops"),p,u=0,t=c(b.get("node")),w=f(t);h.each(q,function(r){if(r.get("node")[0]!=b.get("dragNode")[0]){var n;if(m=="point"){var s=r.get("node");n=b.mousePos;s=c(s);if(s.left<=n.left&&s.right>=n.left&&s.top<=n.top&&s.bottom>=n.top){p=r;return false}}else if(m=="intersect"){n=f(j(t,c(r.get("node"))));if(n>u){u=n;p=r}}else if(m==
"strict"){n=f(j(t,c(r.get("node"))));if(n==w){p=r;return false}}}});(q=this.get("activeDrop"))&&q!=p&&q._handleOut(a);if(p)p._handleOver(a);else{b.get("node").removeClass(this.get("prefixCls")+"drag-over");this.set("activeDrop",null)}},_deactivateDrops:function(){var a=this.get("activeDrag"),b=this.get("activeDrop");a.get("node").removeClass(this.get("prefixCls")+"drag-over");if(b){b.get("node").removeClass(this.get("prefixCls")+"drop-over");b.fire("drophit",{drag:a,drop:b});a.fire("dragdrophit",
{drag:a,drop:b})}else a.fire("dragdropmiss",{drag:a})},_start:function(a){var b=this,m=b.get("bufferTime")||0;b._registerEvent();if(m)b._bufferTimer=setTimeout(function(){b._bufferStart(a)},m);else b._bufferStart(a)},_bufferStart:function(a){this.set("activeDrag",a);a.get("shim")&&this._activeShim();a._start()},_end:function(a){var b=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});
if(b){b._end(a);this._deactivateDrops(a);this.set("activeDrag",null);this.set("activeDrop",null)}},_activeShim:function(){var a=document;this._shim=(new v("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;cursor:move;z-index:999999;'></div>")).appendTo(a.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:l.docHeight()})},_registerEvent:function(){d.on(k,"mouseup",this._end,this);d.on(k,
"mousemove",this._showShimMove,this)},_unregisterEvent:function(){d.remove(k,"mousemove",this._showShimMove,this);d.remove(k,"mouseup",this._end,this)}});return new e},{requires:["dom","event","node","base"]});
KISSY.add("dd/draggable",function(h,l,d,i,g){function e(){e.superclass.constructor.apply(this,arguments);this._init()}var o=h.require("node/node");e.POINT="pointer";e.INTERSECT="intersect";e.STRICT="strict";e.ATTRS={node:{setter:function(c){return o.one(c)}},dragNode:{},shim:{value:true},handlers:{value:[]},cursor:{value:"move"},mode:{value:"point"}};h.extend(e,i,{_init:function(){var c=this.get("node"),f=this.get("handlers");this.set("dragNode",c);if(f.length==0)f[0]=c;for(var j=0;j<f.length;j++){var k=
f[j];k=h.one(k);k.unselectable();this.get("cursor")&&k.css("cursor","move")}c.on("mousedown",this._handleMouseDown,this)},destroy:function(){for(var c=this.get("node"),f=this.get("handlers"),j=0;j<f.length;j++){var k=f[j];k.css("cursor")=="move"&&k.css("cursor","auto")}c.detach("mousedown",this._handleMouseDown,this);this.detach()},_check:function(c){for(var f=this.get("handlers"),j=0;j<f.length;j++){var k=f[j];if(k.contains(c)||k[0]==c[0])return true}return false},_handleMouseDown:function(c){if(this._check(new o(c.target))){c.preventDefault();
g._start(this);var f=this.get("node"),j=c.pageX;c=c.pageY;f=f.offset();this.startMousePos=this.mousePos={left:j,top:c};this.startNodePos=f;this._diff={left:j-f.left,top:c-f.top};this.set("diff",this._diff)}},_move:function(c){var f=this.get("diff"),j=c.pageX-f.left;f=c.pageY-f.top;this.mousePos={left:c.pageX,top:c.pageY};this.fire("drag",{left:j,top:f})},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});return e},{requires:["ua","node","base","dd/ddm"]});
KISSY.add("dd/droppable",function(h,l,d,i){function g(){g.superclass.constructor.apply(this,arguments);this._init()}g.ATTRS={node:{setter:function(e){e=l.one(e);e.addClass(i.get("prefixCls")+"drop");return e}}};h.extend(g,d,{_init:function(){i._regDrop(this)},_handleOut:function(){var e=i.get("activeDrag");this.get("node").removeClass(i.get("prefixCls")+"drop-over");this.fire("dropexit",{drop:this,drag:e});e.get("node").removeClass(i.get("prefixCls")+"drag-over");e.fire("dragexit",{drop:this,drag:e})},
_handleOver:function(){var e=i.get("activeDrop");i.set("activeDrop",this);var o=i.get("activeDrag");this.get("node").addClass(i.get("prefixCls")+"drop-over");var c={drag:o,drop:this};if(this!=e){o.get("node").addClass(i.get("prefixCls")+"drag-over");o.fire("dragenter",c);this.fire("dropenter",c)}else{o.fire("dragover",c);this.fire("dropover",c)}},destroy:function(){i._unregDrop(this)}});return g},{requires:["node","base","dd/ddm"]});
KISSY.add("dd/proxy",function(h){function l(){l.superclass.constructor.apply(this,arguments)}l.ATTRS={node:{value:function(d){d=h.one(d.get("node")[0].cloneNode(true));d.attr("id",h.guid("ks-dd-proxy"));return d}}};h.extend(l,h.Base,{attach:function(d){var i=this;d.on("dragstart",function(){var g=i.get("node"),e=d.get("node");if(h.isFunction(g)){g=g(d);g.css("position","absolute");i.set("node",g)}e.parent().append(g);g.show();g.offset(e.offset());d.set("dragNode",e);d.set("node",g)});d.on("dragend",
function(){var g=i.get("node");d.get("dragNode").offset(g.offset());g.hide();d.set("node",d.get("dragNode"))})},destroy:function(){var d=this.get("node");d&&!h.isFunction(d)&&d.remove()}});return l});KISSY.add("dd",function(h,l,d,i,g){l={Draggable:d,Droppable:i,DDM:l,Proxy:g};h.mix(h,l);return l},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy"]});
