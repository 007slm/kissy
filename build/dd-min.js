/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Mar 23 13:57
*/
KISSY.add("dd/ddm",function(k,r,t,l,j,e){function n(){n.superclass.constructor.apply(this,arguments)}function g(b,i){var o=b.get("activeDrag"),y=o.get("mode"),v=b.get("drops"),u,w=0,C=0,B=p(o.get("node")),G=a(B);k.each(v,function(D){var x;if(x=D.getNodeFromTarget(i,o.get("dragNode")[0],o.get("node")[0]))if(y=="point"){if(f(p(x),o.mousePos)){x=a(p(x));if(u){if(x<C){u=D;C=x}}else{u=D;C=x}}}else if(y=="intersect"){x=a(c(B,p(x)));if(x>C){C=x;u=D}}else if(y=="strict"){x=a(c(B,p(x)));if(x==G){u=D;return false}}});
if((w=b.get("activeDrop"))&&w!=u){w._handleOut(i);o._handleOut(i)}b.set("activeDrop",u);if(u)w!=u?u._handleEnter(i):u._handleOver(i)}function d(b){var i=document;b._shim=(new j("<div style='background-color:red;position:"+(s?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+A.get("dragCursor")+";z-index:"+F+";'></div>")).prependTo(i.body||i.documentElement).css("opacity",0);d=m;s&&l.on(q,"resize scroll",E,b);m(b)}function m(b){var i=b.get("activeDrag").get("activeHandler"),o="auto";
if(i)o=i.css("cursor");if(o=="auto")o=b.get("dragCursor");b._shim.css({cursor:o,display:"block"});s&&E.call(b)}function p(b){var i=b.offset();return{left:i.left,right:i.left+b.outerWidth(),top:i.top,bottom:i.top+b.outerHeight()}}function f(b,i){return b.left<=i.left&&b.right>=i.left&&b.top<=i.top&&b.bottom>=i.top}function a(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function c(b,i){return{left:Math.max(b.left,i.left),right:Math.min(b.right,i.right),top:Math.max(b.top,
i.top),bottom:Math.min(b.bottom,i.bottom)}}var h=document,q=window,s=r.ie===6,z=k.throttle(function(b){var i=this.__activeToDrag,o=this.get("activeDrag");if(o||i)b.preventDefault();if(o){o._move(b);g(this,b)}else i&&i._move(b)},30),F=999999;n.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var E=k.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:t.docWidth(),
height:t.docHeight()})},30);k.extend(n,e,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=k.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){l.on(h,"mouseup",this._end,this);l.on(h,"mousemove",z,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&d(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),i=
this.get("activeDrop"),o={drag:b,drop:i};l.remove(h,"mousemove",z,this);l.remove(h,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();if(i){i._end();this.fire("drophit",o);this.fire("dragdrophit",o)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});this.set("activeDrag",null);this.set("activeDrop",null)}}});var A=new n;A.inRegion=f;A.region=p;A.area=a;return A},{requires:["ua","dom","event",
"node","base"]});
KISSY.add("dd/draggable",function(k,r,t,l,j){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function n(){return false}function g(a){var c=a.target;this._checkMouseDown(a)&&this._check(c)&&this._prepare(a)}var d=k.each,m=r.ie,p=document;e.POINT="point";e.INTERSECT="intersect";e.STRICT="strict";e.ATTRS={node:{setter:function(a){return t.one(a)}},clickPixelThresh:{valueFn:function(){return j.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return j.get("bufferTime")}},dragNode:{},
shim:{value:true},handlers:{value:[],getter:function(a){var c=this;a.length||(a[0]=c.get("node"));d(a,function(h,q){if(k.isFunction(h))h=h.call(c);if(k.isString(h)||h.nodeType)h=t.one(h);a[q]=h});c.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](j.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](j.get("prefixCls")+"-disabled");
return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true}};var f;k.extend(e,l,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",g,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},destroy:function(){this.get("dragNode").detach("mousedown",g,this).detach("dragstart",this._fixDragStart);this.detach()},_check:function(a){var c=this,h=c.get("handlers"),
q=0;d(h,function(s){if(s.contains(a)||s[0]==a){q=1;c.set("activeHandler",s);return false}});return q},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var c=this;if(m){f=p.body.onselectstart;p.body.onselectstart=n}c.get("halt")?a.halt():a.preventDefault();var h=c.get("node"),q=a.pageX;a=a.pageY;h=h.offset();c.startMousePos=c.mousePos={left:q,top:a};c.startNodePos=h;c._diff={left:q-h.left,top:a-h.top};j._regToDrag(c);
if(q=c.get("bufferTime"))c._bufferTimer=setTimeout(function(){c._start()},q)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var c,h=this._diff;c=this.startMousePos;var q=a.pageX;a=a.pageY;var s=q-h.left;h=a-h.top;if(this.get("dragging")){this.mousePos={left:q,top:a};c={left:s,top:h,pageX:q,pageY:a,drag:this};q=1;if(this.fire("drag",c)===false)q=0;if(j.fire("drag",c)===false)q=0;q&&this.get("move")&&this.get("node").offset(c)}else{h=
this.get("clickPixelThresh");if(Math.abs(q-c.left)>=h||Math.abs(a-c.top)>=h)this._start()}},_end:function(){var a;this._clearBufferTimer();if(m)p.body.onselectstart=f;if(this.get("dragging")){this.get("node").removeClass(j.get("prefixCls")+"drag-over");(a=j.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.set("dragging",0);this.fire("dragend",{drag:this})}},_handleOut:function(){this.get("node").removeClass(j.get("prefixCls")+"drag-over");this.fire("dragexit",
{drag:this,drop:j.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(j.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.set("dragging",1);j._start();this.fire("dragstart",{drag:this})}});return e},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(k,r,t,l){function j(){j.superclass.constructor.apply(this,arguments);this._init()}j.ATTRS={node:{setter:function(e){if(e)return r.one(e)}}};k.extend(j,t,{getNodeFromTarget:function(e,n,g){e=this.get("node");var d=e[0];return d==n||d==g?null:e},_init:function(){l._regDrop(this)},__getCustomEvt:function(e){return k.mix({drag:l.get("activeDrag"),drop:this},e)},_handleOut:function(){var e=this.__getCustomEvt();this.get("node").removeClass(l.get("prefixCls")+"drop-over");
this.fire("dropexit",e);l.fire("dropexit",e);l.fire("dragexit",e)},_handleEnter:function(e){e=this.__getCustomEvt(e);e.drag._handleEnter(e);this.get("node").addClass(l.get("prefixCls")+"drop-over");this.fire("dropenter",e);l.fire("dragenter",e);l.fire("dropenter",e)},_handleOver:function(e){e=this.__getCustomEvt(e);e.drag._handleOver(e);this.fire("dropover",e);l.fire("dragover",e);l.fire("dropover",e)},_end:function(){var e=this.__getCustomEvt();this.get("node").removeClass(l.get("prefixCls")+"drop-over");
this.fire("drophit",e)},destroy:function(){l._unregDrop(this)}});return j},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(k,r,t){function l(){l.superclass.constructor.apply(this,arguments);this[j]={}}var j="__proxy_destructors",e=k.stamp,n=k.guid("__dd_proxy"),g="__proxy";l.ATTRS={node:{value:function(d){return new r(d.get("node").clone(true))}},destroyOnEnd:{value:false},moveOnEnd:{value:true}};k.extend(l,t,{attach:function(d){function m(){var c=f.get("node"),h=d.get("node");if(f[g])c=f[g];else if(k.isFunction(c)){c=c(d);c.addClass("ks-dd-proxy");c.css("position","absolute");f[g]=c}h.parent().append(c);
c.show();c.offset(h.offset());d.__set("dragNode",h);d.__set("node",c)}function p(){var c=f[g];f.get("moveOnEnd")&&d.get("dragNode").offset(c.offset());if(f.get("destroyOnEnd")){c.remove();f[g]=0}else c.hide();d.__set("node",d.get("dragNode"))}var f=this,a=e(d,1,n);if(!(a&&f[j][a])){d.on("dragstart",m);d.on("dragend",p);a=e(d,0,n);f[j][a]={drag:d,fn:function(){d.detach("dragstart",m);d.detach("dragend",p)}}}},unAttach:function(d){d=e(d,1,n);var m=this[j];if(d&&m[d]){m[d].fn();delete m[d]}},destroy:function(){var d=
this.get("node"),m=this[j];d&&!k.isFunction(d)&&d.remove();for(var p in m)this.unAttach(m[p].drag)}});return l},{requires:["node","base"]});
KISSY.add("dd/draggable-delegate",function(k,r,t,l,j){function e(){e.superclass.constructor.apply(this,arguments)}function n(g){var d;if(this._checkMouseDown(g)){d=this.get("handlers");var m=new j(g.target);if(d=d.length?this._getHandler(m):m){this.set("activeHandler",d);d=this._getNode(d);this.set("node",d);this.set("dragNode",d);this._prepare(g)}}}k.extend(e,t,{_init:function(){this.get("container").on("mousedown",n,this).on("dragstart",this._fixDragStart)},_getHandler:function(g){for(var d,m=this.get("container"),
p=this.get("handlers");g&&g[0]!==m[0];){k.each(p,function(f){if(l.test(g[0],f)){d=g;return false}});if(d)break;g=g.parent()}return d},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",n,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(g){return j.one(g)}},selector:{},handlers:{value:[],getter:0}}});return e},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(k,r,t,l,j){function e(){var g=this.get("container"),d=this.get("selector");this.__allNodes=g.all(d)}function n(){n.superclass.constructor.apply(this,arguments);r.on("dragstart",e,this)}k.extend(n,t,{getNodeFromTarget:function(g,d,m){var p={left:g.pageX,top:g.pageY};g=this.__allNodes;var f=0,a=Number.MAX_VALUE;g&&g.each(function(c){var h=c[0];if(!(h===m||h===d))if(r.inRegion(r.region(c),p)){h=r.area(r.region(c));if(h<a){a=h;f=c}}});if(f){this.set("lastNode",
this.get("node"));this.set("node",f)}return f},_handleOut:function(){n.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(g){var d=this.get("node"),m=n.superclass._handleOut,p=n.superclass._handleOver,f=n.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==d[0]){this.set("node",a);m.apply(this,arguments);this.set("node",d);f.call(this,g)}else p.call(this,g)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(g){return j.one(g)}}}});
return n},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(k,r,t,l,j){function e(){e.superclass.constructor.apply(this,arguments);this[m]={}}var n=k.Env.host,g=k.stamp,d=100,m="__dd_scrolls";e.ATTRS={node:{valueFn:function(){return l.one(n)},setter:function(f){return l.one(f)}},rate:{value:[10,10]},diff:{value:[20,20]}};var p=k.isWindow;k.extend(e,t,{getRegion:function(f){return p(f[0])?{width:j.viewportWidth(),height:j.viewportHeight()}:{width:f.outerWidth(),height:f.outerHeight()}},getOffset:function(f){return p(f[0])?{left:j.scrollLeft(),
top:j.scrollTop()}:f.offset()},getScroll:function(f){return{left:f.scrollLeft(),top:f.scrollTop()}},setScroll:function(f,a){f.scrollLeft(a.left);f.scrollTop(a.top)},unAttach:function(f){var a,c=this[m];if((a=g(f,1,"__dd-scroll-id-"))&&c[a]){c[a].fn();delete c[a]}},destroy:function(){var f=this[m],a;for(a in f)this.unAttach(f[a].drag)},attach:function(f){function a(){if(p(z[0]))return 0;var v=f.mousePos,u=r.region(z);if(!r.inRegion(u,v)){clearTimeout(y);y=0;return 1}return 0}function c(v){if(!v.fake)if(!a()){i=
v;o=k.clone(f.mousePos);v=s.getOffset(z);o.left-=v.left;o.top-=v.top;y||q()}}function h(){clearTimeout(y);y=null}function q(){if(!a()){var v=s.getRegion(z),u=v.width;v=v.height;var w=s.getScroll(z),C=k.clone(w),B=false;if(o.top-v>=-b[1]){w.top+=A[1];B=true}if(o.top<=b[1]){w.top-=A[1];B=true}if(o.left-u>=-b[0]){w.left+=A[0];B=true}if(o.left<=b[0]){w.left-=A[0];B=true}if(B){s.setScroll(z,w);y=setTimeout(q,d);i.fake=true;if(p(z[0])){w=s.getScroll(z);i.left+=w.left-C.left;i.top+=w.top-C.top}f.get("move")&&
f.get("node").offset(i);f.fire("drag",i)}else y=null}}var s=this,z=s.get("node"),F=g(f,0,"__dd-scroll-id-"),E=s[m];if(!E[F]){var A=s.get("rate"),b=s.get("diff"),i,o,y=null;f.on("drag",c);f.on("dragend",h);E[F]={drag:f,fn:function(){f.detach("drag",c);f.detach("dragend",h)}}}}});return e},{requires:["./ddm","base","node","dom"]});
KISSY.add("dd",function(k,r,t,l,j,e,n,g){r={Draggable:t,Droppable:l,DDM:r,Proxy:j,DraggableDelegate:e,DroppableDelegate:n,Scroll:g};k.mix(k,r);return r},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
