/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Oct 30 23:46
*/
KISSY.add("dd/constrain",function(d,m,h){function k(){k.superclass.constructor.apply(this,arguments);this[c]={}}function e(a){var c,p,a=a.drag.get("dragNode"),j=this.get("constrain");if(j){if(!0===j||j.setTimeout){var g;g=!0===j?n(b):n(j);this.__constrainRegion={left:c=g.scrollLeft(),top:p=g.scrollTop(),right:c+g.width(),bottom:p+g.height()}}if(j.nodeType||"string"==typeof j)j=n(j);j.getDOMNode?(c=j.offset(),this.__constrainRegion={left:c.left,top:c.top,right:c.left+j.outerWidth(),bottom:c.top+j.outerHeight()}):
d.isPlainObject(j)&&(this.__constrainRegion=j);this.__constrainRegion&&(this.__constrainRegion.right-=a.outerWidth(),this.__constrainRegion.bottom-=a.outerHeight())}}function i(a){var b={},c=a.left,j=a.top,g=this.__constrainRegion;g&&(b.left=Math.min(Math.max(g.left,c),g.right),b.top=Math.min(Math.max(g.top,j),g.bottom),a.drag.setInternal("actualPos",b))}function a(){this.__constrainRegion=null}var n=h.all,c="__constrain_destructors",q=d.stamp,l=d.guid("__dd_constrain"),b=d.Env.host;d.extend(k,m,
{__constrainRegion:null,attachDrag:function(b){var d=this[c],p=q(b,0,l);if(d[p])return this;d[p]=b;b.on("dragstart",e,this).on("dragend",a,this).on("dragalign",i,this);return this},detachDrag:function(b){var d=q(b,1,l),p=this[c];d&&p[d]&&(b.detach("dragstart",e,this).detach("dragend",a,this).detach("dragalign",i,this),delete p[d]);return this},destroy:function(){var b=this,a=d.merge(b[c]);d.each(a,function(a){b.detachDrag(a)})}},{ATTRS:{constrain:{value:!0}}});return k},{requires:["base","node"]});
KISSY.add("dd",function(d,m,h,k,e,i,a,n,c){d={Draggable:h,Droppable:k,DDM:m,Constrain:i,Proxy:e,DraggableDelegate:a,DroppableDelegate:n,Scroll:c};return KISSY.DD=d},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(d,m,h,k,e,i){function a(){a.superclass.constructor.apply(this,arguments)}function n(f,b,a){var c=a.get("mode"),g=f.get("validDrops"),l=0,e=0,n=o(a.get("node")),A=p(n);d.each(g,function(f){var g;if(g=f.getNodeFromTarget(b,a.get("dragNode")[0],a.get("node")[0]))if("point"==c)z(o(g),a.mousePos)&&(g=p(o(g)),l?g<e&&(l=f,e=g):(l=f,e=g));else if("intersect"==c)g=p(j(n,o(g))),g>e&&(e=g,l=f);else if("strict"==c&&(g=p(j(n,o(g))),g==A))return l=f,!1});if((g=f.get("activeDrop"))&&
g!=l)g._handleOut(b),a._handleOut(b);f.setInternal("activeDrop",l);l&&(g!=l?l._handleEnter(b):l._handleOver(b))}function c(f){f._shim=(new e('<div style="background-color:red;position:'+(x?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+v.get("dragCursor")+";z-index:"+y+';"></div>')).prependTo(s.body||s.documentElement).css("opacity",0);c=q;if(x)k.on(A,"resize scroll",B,f);q(f)}function q(f){var b=f.get("activeDrag").get("activeHandler"),a="auto";b&&(a=b.css("cursor"));"auto"==
a&&(a=f.get("dragCursor"));f._shim.css({cursor:a,display:"block"});x&&B.call(f)}function l(f){var b=f.get("drops");f.setInternal("validDrops",[]);d.each(b,function(f){f._active()})}function b(f){var b=f.get("drops");f.setInternal("validDrops",[]);d.each(b,function(f){f._deActive()})}function o(f){var b=f.offset();return{left:b.left,right:b.left+(f.__dd_cached_width||f.outerWidth()),top:b.top,bottom:b.top+(f.__dd_cached_height||f.outerHeight())}}function z(b,a){return b.left<=a.left&&b.right>=a.left&&
b.top<=a.top&&b.bottom>=a.top}function p(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function j(b,a){var j=Math.max(b.top,a.top),c=Math.min(b.right,a.right),g=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:c,top:j,bottom:g}}function g(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var A=d.Env.host,s=A.document,x=6===m.ie,w=d.throttle(function(b){var a;if(a=this.__activeToDrag)b.preventDefault(),a._move(b);else if(a=
this.get("activeDrag"))b.preventDefault(),a._move(b),n(this,b,a)},30),y=999999,t=k.Gesture,r=t.moveEvent,u=t.endEvent;a.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var B=d.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:h.docWidth(),height:h.docHeight()})},30);d.extend(a,i,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=
d.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;k.on(s,u,this._end,this);k.on(s,r,w,this);6===m.ie&&s.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.setInternal("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);g(b.get("node"));l(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var a=this.get("activeDrag"),j=this.get("activeDrop");k.remove(s,r,w,this);
k.remove(s,u,this._end,this);6===m.ie&&s.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();a&&(a._end(),b(this),j&&j._end(),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var v=new a;v.inRegion=z;v.region=o;v.area=p;v.cacheWH=g;v.PREFIX_CLS="ks-dd-";v._normalHandlePreDragStart=function(b){return function(a){var j;if(j=a.originalEvent.touches){if(1!=j.length)return;j=j[0];a.target=a.target||j.target;
a.currentTarget=a.currentTarget||j.currentTarget;a.button=a.button||0}b.call(this,a)}};return v},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(d,m,h,k,e,i){function a(){a.superclass.constructor.apply(this,arguments)}var n=m.PREFIX_CLS,c=i.Gesture.startEvent,q=m._normalHandlePreDragStart(function(a){var b,c;if(this._checkDragStartValid(a)){b=this.get("handlers");var d=new e(a.target);(b=b.length?this._getHandler(d):d)&&(c=this._getNode(b));c&&(this.setInternal("activeHandler",b),this.setInternal("node",c),this.setInternal("dragNode",c),this._prepare(a))}});d.extend(a,h,{_uiSetDisabledChange:function(a){this.get("container")[a?
"addClass":"removeClass"](n+"-disabled")},_init:function(){this.get("container").on(c,q,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var b=void 0,c=this.get("container"),e=this.get("handlers");a&&a[0]!==c[0];){d.each(e,function(c){if(k.test(a[0],c))return b=a,!1});if(b)break;a=a.parent()}return b},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach(c,q,this).detach("dragstart",this._fixDragStart);
this.detach()}},{ATTRS:{container:{setter:function(a){return e.one(a)}},selector:{},handlers:{value:[],getter:0}}});return a},{requires:["./ddm","./draggable","dom","node","event"]});
KISSY.add("dd/draggable",function(d,m,h,k,e,i){function a(){a.superclass.constructor.apply(this,arguments);this.addTarget(e);this.setInternal("dragNode",this.get("node"));this.on("afterDisabledChange",this._uiSetDisabledChange,this);var b;(b=this.get("disabled"))&&this._uiSetDisabledChange(b);this._init()}function n(){return!1}var c=d.each,q=i.Gesture.startEvent,l=m.ie,b=e.PREFIX_CLS,o=d.Env.host.document;a.ATTRS={node:{setter:function(b){if(!(b instanceof h))return h.one(b)}},clickPixelThresh:{valueFn:function(){return e.get("clickPixelThresh")}},
bufferTime:{valueFn:function(){return e.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));c(b,function(c,e){d.isFunction(c)&&(c=c.call(a));if("string"==typeof c||c.nodeType)c=h.one(c);b[e]=c});a.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](b+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},
halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}};a.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};d.mix(a,a.DropMode);var z,p=e._normalHandlePreDragStart(function(b){var a=b.target;this._checkDragStartValid(b)&&this._checkHandler(a)&&this._prepare(b)});d.extend(a,k,{_bufferTimer:null,_uiSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](b+"-disabled")},_init:function(){this.get("node").on(q,p,this).on("dragstart",
this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var a=this,d=a.get("handlers"),e=0;c(d,function(c){if(c.contains(b)||c[0]==b)return e=1,a.setInternal("activeHandler",c),!1});return e},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;l&&(z=o.body.onselectstart,o.body.onselectstart=n);a.get("halt")?b.halt():b.preventDefault();var c=a.get("node"),d=b.pageX,b=b.pageY,
c=c.offset();a.setInternal("startMousePos",a.mousePos={left:d,top:b});a.setInternal("startNodePos",c);a.setInternal("deltaPos",{left:d-c.left,top:b-c.top});e._regToDrag(a);if(d=a.get("bufferTime"))a._bufferTimer=setTimeout(function(){a._start()},1E3*d)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a;a=b.pageX;b=b.pageY;if(this.get("dragging")){var c=this.get("deltaPos"),d=a-c.left,c=b-c.top;this.mousePos={left:a,top:b};
a={left:d,top:c,pageX:a,pageY:b,drag:this};this.setInternal("actualPos",{left:d,top:c});this.fire("dragalign",a);b=1;!1===this.fire("drag",a)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))}else d=this.get("startMousePos"),c=this.get("clickPixelThresh"),(Math.abs(a-d.left)>=c||Math.abs(b-d.top)>=c)&&this._start()},stopDrag:function(){this.get("dragging")&&e._end()},_end:function(){var a;this._clearBufferTimer();l&&(o.body.onselectstart=z);this.get("dragging")&&(this.get("node").removeClass(b+
"drag-over"),(a=e.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(b+"drag-over");this.fire("dragexit",{drag:this,drop:e.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(b+"drag-over");this.fire("dragenter",a)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.setInternal("dragging",
1);e._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach(q,p,this).detach("dragstart",this._fixDragStart);this.detach()}});return a},{requires:["ua","node","base","./ddm","event"]});
KISSY.add("dd/droppable-delegate",function(d,m,h,k,e){function i(){var a=this.get("container"),c=[],d=this.get("selector");a.all(d).each(function(a){m.cacheWH(a);c.push(a)});this.__allNodes=c}function a(){a.superclass.constructor.apply(this,arguments);m.on("dragstart",i,this)}d.extend(a,h,{destroy:function(){a.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(a,c,e){var l={left:a.pageX,top:a.pageY},a=this.__allNodes,b=0,o=Number.MAX_VALUE;a&&d.each(a,function(a){var d=a[0];d===
e||d===c||(d=m.region(a),m.inRegion(d,l)&&(d=m.area(d),d<o&&(o=d,b=a)))});b&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",b));return b},_handleOut:function(){a.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(d){var c=this.get("node"),e=a.superclass._handleOut,l=a.superclass._handleOver,b=a.superclass._handleEnter,o=this.get("lastNode");o[0]!==c[0]?(this.setInternal("node",o),e.apply(this,arguments),
this.setInternal("node",c),b.call(this,d)):l.call(this,d)},_end:function(){a.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return e.one(a)}}}});return a},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(d,m,h,k){function e(){e.superclass.constructor.apply(this,arguments);this.addTarget(k);this._init()}var i=k.PREFIX_CLS;e.ATTRS={node:{setter:function(a){if(a)return m.one(a)}},groups:{value:!0}};d.extend(e,h,{getNodeFromTarget:function(a,d,c){var a=this.get("node"),e=a[0];return e==d||e==c?null:a},_init:function(){k._regDrop(this)},_active:function(){var a=k.get("activeDrag"),d=this.get("node"),c=this.get("groups"),a=a.get("groups");a:if(!0===c)c=1;else{for(var e in c)if(a[e]){c=
1;break a}c=0}c?(k._addValidDrop(this),d&&(d.addClass(i+"drop-active-valid"),k.cacheWH(d))):d&&d.addClass(i+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(i+"drop-active-valid").removeClass(i+"drop-active-invalid")},__getCustomEvt:function(a){return d.mix({drag:k.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(i+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);
a.drag._handleEnter(a);this.get("node").addClass(i+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(i+"drop-over");this.fire("drophit",a)},destroy:function(){k._unRegDrop(this)}});return e},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(d,m,h,k){function e(){e.superclass.constructor.apply(this,arguments);this[i]={}}var i="__proxy_destructors",a=d.stamp,n=d.guid("__dd_proxy");e.ATTRS={node:{value:function(a){return new m(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};d.extend(e,h,{attachDrag:function(c){function e(){var a=b.get("node"),j=c.get("node");b.get("proxyNode")?a=b.get("proxyNode"):d.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),
b.set("proxyNode",a));a.show();j.parent().append(a);k.cacheWH(a);a.offset(j.offset());c.setInternal("dragNode",j);c.setInternal("node",a)}function l(){var a=b.get("proxyNode");b.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());b.get("destroyOnEnd")?(a.remove(),b.set("proxyNode",0)):a.hide();c.setInternal("node",c.get("dragNode"))}var b=this,o=b[i],h=a(c,0,n);if(o[h])return b;c.on("dragstart",e);c.on("dragend",l);o[h]={drag:c,fn:function(){c.detach("dragstart",e);c.detach("dragend",l)}};return b},
detachDrag:function(c){var c=a(c,1,n),d=this[i];c&&d[c]&&(d[c].fn(),delete d[c]);return this},destroy:function(){var a=this.get("node"),e=this[i];a&&!d.isFunction(a)&&a.remove();for(var h in e)this.detachDrag(e[h].drag)}});h=e.prototype;h.attach=h.attachDrag;h.unAttach=h.detachDrag;return e},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(d,m,h,k,e){function i(){i.superclass.constructor.apply(this,arguments);this[q]={}}var a=d.Env.host,n=d.stamp,c=100,q="__dd_scrolls";i.ATTRS={node:{valueFn:function(){return k.one(a)},setter:function(a){return k.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var l=d.isWindow;d.extend(i,h,{getRegion:function(a){return l(a[0])?{width:e.viewportWidth(),height:e.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return l(a[0])?{left:e.scrollLeft(),
top:e.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,c){a.scrollLeft(c.left);a.scrollTop(c.top)},detachDrag:function(a){var c,d=this[q];if(!(c=n(a,1,"__dd-scroll-id-"))||!d[c])return this;d[c].fn();delete d[c];return this},destroy:function(){var a=this;d.each(a[q],function(c){a.detachDrag(c.drag)})},attachDrag:function(a){function e(){if(l(i[0]))return 0;var c=a.mousePos,d=m.region(i);return!m.inRegion(d,c)?(clearTimeout(u),u=0,1):
0}function h(c){!c.fake&&!e()&&(t=c,r=d.clone(a.mousePos),c=g.getOffset(i),r.left-=c.left,r.top-=c.top,u||j())}function k(){clearTimeout(u);u=null}function j(){if(!e()){var h=g.getRegion(i),k=h.width,h=h.height,f=g.getScroll(i),m=d.clone(f),n=!1;r.top-h>=-y[1]&&(f.top+=w[1],n=!0);r.top<=y[1]&&(f.top-=w[1],n=!0);r.left-k>=-y[0]&&(f.left+=w[0],n=!0);r.left<=y[0]&&(f.left-=w[0],n=!0);n?(g.setScroll(i,f),u=setTimeout(j,c),t.fake=!0,l(i[0])&&(f=g.getScroll(i),t.left+=f.left-m.left,t.top+=f.top-m.top),
a.get("move")&&a.get("node").offset(t),a.fire("drag",t)):u=null}}var g=this,i=g.get("node"),s=n(a,0,"__dd-scroll-id-"),x=g[q];if(x[s])return this;var w=g.get("rate"),y=g.get("diff"),t,r,u=null;a.on("drag",h);a.on("dragstart",function(){m.cacheWH(i)});a.on("dragend",k);x[s]={drag:a,fn:function(){a.detach("drag",h);a.detach("dragend",k)}};return this}});h=i.prototype;h.attach=h.attachDrag;h.unAttach=h.detachDrag;return i},{requires:["./ddm","base","node","dom"]});
