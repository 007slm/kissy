/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Feb 21 18:37
*/
KISSY.add("dd/base",function(e,i,g,d){e={Draggable:g,DDM:i,DraggableDelegate:d};return KISSY.DD=e},{requires:["./base/ddm","./base/draggable","./base/draggable-delegate"]});
KISSY.add("dd/base/ddm",function(e,i,g,d,t){function m(){m.superclass.constructor.apply(this,arguments)}function r(a){var b;if(a=k._normalEvent(a))if(a.preventDefault(),b=this.__activeToDrag)b._move(a);else if(b=this.get("activeDrag"))b._move(a),s(this,a,b)}function n(a){a.preventDefault();D.call(this,a)}function s(a,u,f){var c=a.get("validDrops");if(!e.isEmptyObject(c)){var q=f.get("mode"),d=0,g=0,p=l(f.get("node")),j=b(p);e.each(c,function(a){var c;if(c=a.getNodeFromTarget(u,f.get("dragNode")[0],
f.get("node")[0]))if("point"==q)v(l(c),f.mousePos)&&(c=b(l(c)),d?c<g&&(d=a,g=c):(d=a,g=c));else if("intersect"==q)c=b(h(p,l(c))),c>g&&(g=c,d=a);else if("strict"==q&&(c=b(h(p,l(c))),c==j))return d=a,!1});if((c=a.get("activeDrop"))&&c!=d)c._handleOut(u),f._handleOut(u);a.setInternal("activeDrop",d);d&&(c!=d?d._handleEnter(u):d._handleOver(u))}}function c(a){a._shim=(new d('<div style="background-color:red;position:'+(x?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+k.get("dragCursor")+
";z-index:"+E+';"></div>')).prependTo(o.body||o.documentElement).css("opacity",0);c=p;if(x)g.on(y,"resize scroll",z,a);p(a)}function p(a){var b=a.get("activeDrag").get("activeHandler"),c="auto";b&&(c=b.css("cursor"));"auto"==c&&(c=a.get("dragCursor"));a._shim.css({cursor:c,display:"block"});x&&z.call(a)}function j(a){var b=a.get("drops");a.setInternal("validDrops",[]);e.each(b,function(a){a._active()})}function w(a){var b=a.get("drops");a.setInternal("validDrops",[]);e.each(b,function(a){a._deActive()})}
function l(a){var b=a.offset();return{left:b.left,right:b.left+(a.__dd_cached_width||a.outerWidth()),top:b.top,bottom:b.top+(a.__dd_cached_height||a.outerHeight())}}function v(a,b){return a.left<=b.left&&a.right>=b.left&&a.top<=b.top&&a.bottom>=b.top}function b(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function h(a,b){var c=Math.max(a.top,b.top),f=Math.min(a.right,b.right),h=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:f,top:c,bottom:h}}
function f(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var q=e.UA,y=e.Env.host,o=y.document,x=6===q.ie,E=999999,A=g.Gesture,B=A.move,C=A.end;m.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var D=8>q.ie?e.throttle(r,30):r,z=e.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:i.docWidth(),height:i.docHeight()})},30);e.extend(m,
t,{__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){a=e.indexOf(a,this.get("drops"));-1!=a&&this.get("drops").splice(a,1)},_regToDrag:function(a){this.__activeToDrag=a;g.on(o,C,this._end,this);g.on(o,B,n,this);6===q.ie&&o.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;this.setInternal("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&c(this);f(a.get("node"));j(this)},_addValidDrop:function(a){this.get("validDrops").push(a)},
_end:function(a){var b=this.__activeToDrag,c=this.get("activeDrag"),f=this.get("activeDrop"),a=k._normalEvent(a);b&&b._move(a);c&&c._move(a);g.remove(o,B,n,this);g.remove(o,C,this._end,this);6===q.ie&&o.body.releaseCapture();b&&(b._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();c&&(c._end(),w(this),f&&f._end(),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var k=new m;k.inRegion=v;k.region=l;k.area=b;k.cacheWH=f;k.PREFIX_CLS="ks-dd-";k._normalEvent=function(a){var b=
"touchend"==""+a.type?a.changedTouches:a.touches;if(b){if(1!=b.length)return;b=b[0];a.target=a.target||b.target;a.currentTarget=a.currentTarget||b.currentTarget;a.which=1;a.pageX=b.pageX;a.pageY=b.pageY}return a};return k},{requires:["dom","event","node","base"]});
KISSY.add("dd/base/draggable-delegate",function(e,i,g,d,t,m){var r=i.PREFIX_CLS,n=m.Gesture.start,s=function(c){if(c=i._normalEvent(c)){var d,e;if(this._checkDragStartValid(c)){d=this.get("handlers");var g=new t(c.target);(d=d.length?this._getHandler(g):g)&&(e=this._getNode(d));e&&(this.setInternal("activeHandler",d),this.setInternal("node",e),this.setInternal("dragNode",e),this._prepare(c))}}};return g.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(c){this.get("container")[c?
"addClass":"removeClass"](r+"-disabled")},bindDragEvent:function(){this.get("container").on(n,s,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(n,s,this).detach("dragstart",this._fixDragStart)},_getHandler:function(c){for(var g=void 0,j=this.get("container"),i=this.get("handlers");c&&c[0]!==j[0];){e.each(i,function(e){if(d.test(c[0],e))return g=c,!1});if(g)break;c=c.parent()}return g},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))}},
{ATTRS:{container:{setter:function(c){return t.one(c)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","dom","node","event"]});
KISSY.add("dd/base/draggable",function(e,i,g,d,t){function m(){return!1}var r=i.all,n=e.each,s=t.Gesture.start,c=e.UA.ie,p=e.Features.isTouchSupported(),j=d.PREFIX_CLS,w=e.Env.host.document,g=g.extend({initializer:function(){this.addTarget(d)},_onSetNode:function(b){this.setInternal("dragNode",b);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(s,v,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("node").detach(s,v,this).detach("dragstart",this._fixDragStart)},
_bufferTimer:null,_onSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](j+"-disabled")},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var c=this,f=c.get("handlers"),d=0;n(f,function(f){if(f[0]==b||f.contains(b))return d=1,c.setInternal("activeHandler",f),!1});return d},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1!=b.which||this.get("disabled")?0:1},_prepare:function(b){if(b){var h=this;c&&(l=w.body.onselectstart,w.body.onselectstart=
m);h.get("halt")&&b.stopPropagation();p||b.preventDefault();var f=h.get("node"),e=b.pageX,b=b.pageY,f=f.offset();h.setInternal("startMousePos",h.mousePos={left:e,top:b});h.setInternal("startNodePos",f);h.setInternal("deltaPos",{left:e-f.left,top:b-f.top});d._regToDrag(h);if(e=h.get("bufferTime"))h._bufferTimer=setTimeout(function(){h._start()},1E3*e)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var c;c=b.pageX;b=b.pageY;
if(!this.get("dragging")){var f=this.get("startMousePos"),d=0,e=this.get("clickPixelThresh");if(Math.abs(c-f.left)>=e||Math.abs(b-f.top)>=e)this._start(),d=1;if(!d)return}d=this.get("deltaPos");f=c-d.left;d=b-d.top;this.mousePos={left:c,top:b};c={left:f,top:d,pageX:c,pageY:b,drag:this};this.setInternal("actualPos",{left:f,top:d});this.fire("dragalign",c);b=1;!1===this.fire("drag",c)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){d._end()},_end:function(){var b;
this._clearBufferTimer();c&&(w.body.onselectstart=l);this.get("dragging")&&(this.get("node").removeClass(j+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(j+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(j+"drag-over");this.fire("dragenter",
b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.setInternal("dragging",1);d._start();this.fire("dragstart",{drag:this})},destructor:function(){this.detachDragEvent();this.detach()}},{ATTRS:{node:{setter:function(b){if(!(b instanceof i))return r(b)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var c=
this;b.length||(b[0]=c.get("node"));n(b,function(d,g){e.isFunction(d)&&(d=d.call(c));"string"==typeof d&&(d=c.get("node").one(d));d.nodeType&&(d=r(d));b[g]=d});c.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](j+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});g.DropMode=
{POINT:"point",INTERSECT:"intersect",STRICT:"strict"};var l,v=function(b){if(b=d._normalEvent(b)){var c=b.target;this._checkDragStartValid(b)&&this._checkHandler(c)&&this._prepare(b)}};return g},{requires:["node","rich-base","./ddm","event"]});
