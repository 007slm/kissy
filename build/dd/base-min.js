/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Dec 5 02:23
*/
KISSY.add("dd/base",function(e,j,d,f){e={Draggable:d,DDM:j,DraggableDelegate:f};return KISSY.DD=e},{requires:["./base/ddm","./base/draggable","./base/draggable-delegate"]});
KISSY.add("dd/base/ddm",function(e,j,d,f,s){function n(){n.superclass.constructor.apply(this,arguments)}function t(a,u,g){var h=g.get("mode"),c=a.get("validDrops"),i=0,d=0,l=k(g.get("node")),f=o(l);e.each(c,function(a){var c;if(c=a.getNodeFromTarget(u,g.get("dragNode")[0],g.get("node")[0]))if("point"==h)v(k(c),g.mousePos)&&(c=o(k(c)),i?c<d&&(i=a,d=c):(i=a,d=c));else if("intersect"==h)c=o(b(l,k(c))),c>d&&(d=c,i=a);else if("strict"==h&&(c=o(b(l,k(c))),c==f))return i=a,!1});if((c=a.get("activeDrop"))&&
c!=i)c._handleOut(u),g._handleOut(u);a.setInternal("activeDrop",i);i&&(c!=i?i._handleEnter(u):i._handleOver(u))}function p(a){a._shim=(new f('<div style="background-color:red;position:'+(w?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+m.get("dragCursor")+";z-index:"+C+';"></div>')).prependTo(q.body||q.documentElement).css("opacity",0);p=r;if(w)d.on(i,"resize scroll",x,a);r(a)}function r(a){var b=a.get("activeDrag").get("activeHandler"),c="auto";b&&(c=b.css("cursor"));"auto"==
c&&(c=a.get("dragCursor"));a._shim.css({cursor:c,display:"block"});w&&x.call(a)}function c(a){var b=a.get("drops");a.setInternal("validDrops",[]);e.each(b,function(a){a._active()})}function l(a){var b=a.get("drops");a.setInternal("validDrops",[]);e.each(b,function(a){a._deActive()})}function k(a){var b=a.offset();return{left:b.left,right:b.left+(a.__dd_cached_width||a.outerWidth()),top:b.top,bottom:b.top+(a.__dd_cached_height||a.outerHeight())}}function v(a,b){return a.left<=b.left&&a.right>=b.left&&
a.top<=b.top&&a.bottom>=b.top}function o(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function b(a,b){var c=Math.max(a.top,b.top),g=Math.min(a.right,b.right),h=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:g,top:c,bottom:h}}function g(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var h=e.UA,i=e.Env.host,q=i.document,w=6===h.ie,y=e.throttle(function(a){var b;if(a=m._normalEvent(a))if(a.preventDefault(),b=this.__activeToDrag)b._move(a);
else if(b=this.get("activeDrag"))b._move(a),t(this,a,b)},30),C=999999,z=d.Gesture,A=z.move,B=z.end;n.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var x=e.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:j.docWidth(),height:j.docHeight()})},30);e.extend(n,s,{__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){a=e.indexOf(a,
this.get("drops"));-1!=a&&this.get("drops").splice(a,1)},_regToDrag:function(a){this.__activeToDrag=a;d.on(q,B,this._end,this);d.on(q,A,y,this);6===h.ie&&q.body.setCapture()},_start:function(){this.get("drops");var a=this.__activeToDrag;this.setInternal("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&p(this);g(a.get("node"));c(this)},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(){var a=this.get("activeDrag"),b=this.get("activeDrop");d.remove(q,A,y,this);d.remove(q,
B,this._end,this);6===h.ie&&q.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();a&&(a._end(),l(this),b&&b._end(),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var m=new n;m.inRegion=v;m.region=k;m.area=o;m.cacheWH=g;m.PREFIX_CLS="ks-dd-";m._normalEvent=function(a){var b=a.touches;if(b){if(1!=b.length)return;b=b[0];a.target=a.target||b.target;a.currentTarget=a.currentTarget||b.currentTarget;a.which=
1;a.pageX=b.pageX;a.pageY=b.pageY}return a};return m},{requires:["dom","event","node","base"]});
KISSY.add("dd/base/draggable-delegate",function(e,j,d,f,s,n){var t=j.PREFIX_CLS,p=n.Gesture.start,r=function(c){if(c=j._normalEvent(c)){var d,e;if(this._checkDragStartValid(c)){d=this.get("handlers");var f=new s(c.target);(d=d.length?this._getHandler(f):f)&&(e=this._getNode(d));e&&(this.setInternal("activeHandler",d),this.setInternal("node",e),this.setInternal("dragNode",e),this._prepare(c))}}};return d.extend({_onSetDisabledChange:function(c){this.get("container")[c?"addClass":"removeClass"](t+"-disabled")},
bindDragEvent:function(){this.get("container").on(p,r,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(p,r,this).detach("dragstart",this._fixDragStart)},_getHandler:function(c){for(var d=void 0,k=this.get("container"),j=this.get("handlers");c&&c[0]!==k[0];){e.each(j,function(e){if(f.test(c[0],e))return d=c,!1});if(d)break;c=c.parent()}return d},_getNode:function(c){return c.closest(this.get("selector"),this.get("container"))}},{ATTRS:{container:{setter:function(c){return s.one(c)}},
selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","dom","node","event"]});
KISSY.add("dd/base/draggable",function(e,j,d,f,s){function n(){return!1}var t=e.each,p=s.Gesture.start,r=e.UA.ie,c=e.Features,l=f.PREFIX_CLS,k=e.Env.host.document,d=d.extend({initializer:function(){this.addTarget(f);this.setInternal("dragNode",this.get("node"));this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(p,o,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("node").detach(p,o,this).detach("dragstart",this._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(b){this.get("dragNode")[b?
"addClass":"removeClass"](l+"-disabled")},_fixDragStart:function(b){b.preventDefault()},_checkHandler:function(b){var c=this,h=c.get("handlers"),d=0;t(h,function(h){if(h.contains(b)||h[0]==b)return d=1,c.setInternal("activeHandler",h),!1});return d},_checkDragStartValid:function(b){return this.get("primaryButtonOnly")&&1!=b.which||this.get("disabled")?0:1},_prepare:function(b){if(b){var g=this;r&&(v=k.body.onselectstart,k.body.onselectstart=n);g.get("halt")&&b.stopPropagation();c.isTouchSupported()||
b.preventDefault();var h=g.get("node"),d=b.pageX,b=b.pageY,h=h.offset();g.setInternal("startMousePos",g.mousePos={left:d,top:b});g.setInternal("startNodePos",h);g.setInternal("deltaPos",{left:d-h.left,top:b-h.top});f._regToDrag(g);if(d=g.get("bufferTime"))g._bufferTimer=setTimeout(function(){g._start()},1E3*d)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var c;c=b.pageX;b=b.pageY;if(this.get("dragging")){var d=this.get("deltaPos"),
e=c-d.left,d=b-d.top;this.mousePos={left:c,top:b};c={left:e,top:d,pageX:c,pageY:b,drag:this};this.setInternal("actualPos",{left:e,top:d});this.fire("dragalign",c);b=1;!1===this.fire("drag",c)&&(b=0);b&&this.get("move")&&this.get("node").offset(this.get("actualPos"))}else e=this.get("startMousePos"),d=this.get("clickPixelThresh"),(Math.abs(c-e.left)>=d||Math.abs(b-e.top)>=d)&&this._start()},stopDrag:function(){f._end()},_end:function(){var b;this._clearBufferTimer();r&&(k.body.onselectstart=v);this.get("dragging")&&
(this.get("node").removeClass(l+"drag-over"),(b=f.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(l+"drag-over");this.fire("dragexit",{drag:this,drop:f.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(l+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();
this.setInternal("dragging",1);f._start();this.fire("dragstart",{drag:this})},destructor:function(){this.detachDragEvent();this.detach()}},{ATTRS:{node:{setter:function(b){if(!(b instanceof j))return j.one(b)}},clickPixelThresh:{valueFn:function(){return f.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return f.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var c=this;b.length||(b[0]=c.get("node"));t(b,function(d,f){e.isFunction(d)&&(d=d.call(c));if("string"==
typeof d||d.nodeType)d=j.one(d);b[f]=d});c.setInternal("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](l+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}},startMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});d.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};e.mix(d,d.DropMode);var v,o=function(b){if(b=f._normalEvent(b)){var c=
b.target;this._checkDragStartValid(b)&&this._checkHandler(c)&&this._prepare(b)}};return d},{requires:["node","rich-base","./ddm","event"]});
