/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 2 15:44
*/
KISSY.add("dd/scroll",function(c,e,f,o,m){function g(){g.superclass.constructor.apply(this,arguments);this[p]={}}var t=e.DDM,v=c.Env.host,u=c.stamp,w=100,p="__dd_scrolls";g.ATTRS={node:{valueFn:function(){return o.one(v)},setter:function(a){return o.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var q=c.isWindow;c.extend(g,f,{getRegion:function(a){return q(a[0])?{width:m.viewportWidth(),height:m.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return q(a[0])?
{left:m.scrollLeft(),top:m.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},detachDrag:function(a){var b,c=this[p];if(!(b=u(a,1,"__dd-scroll-id-"))||!c[b])return this;c[b].fn();delete c[b];return this},destroy:function(){var a=this;c.each(a[p],function(b){a.detachDrag(b.drag)})},attachDrag:function(a){function b(){if(q(i[0]))return 0;var b=a.mousePos,c=t.region(i);return!t.inRegion(c,b)?(clearTimeout(n),
n=0,1):0}function f(h){!h.fake&&!b()&&(l=h,j=c.clone(a.mousePos),h=k.getOffset(i),j.left-=h.left,j.top-=h.top,n||m())}function g(){clearTimeout(n);n=null}function m(){if(!b()){var h=k.getRegion(i),f=h.width,h=h.height,d=k.getScroll(i),g=c.clone(d),e=!1;j.top-h>=-r[1]&&(d.top+=s[1],e=!0);j.top<=r[1]&&(d.top-=s[1],e=!0);j.left-f>=-r[0]&&(d.left+=s[0],e=!0);j.left<=r[0]&&(d.left-=s[0],e=!0);e?(k.setScroll(i,d),n=setTimeout(m,w),l.fake=!0,q(i[0])&&(d=k.getScroll(i),l.left+=d.left-g.left,l.top+=d.top-
g.top),a.get("move")&&a.get("node").offset(l),a.fire("drag",l)):n=null}}var k=this,i=k.get("node"),e=u(a,0,"__dd-scroll-id-"),o=k[p];if(o[e])return this;var s=k.get("rate"),r=k.get("diff"),l,j,n=null;a.on("drag",f);a.on("dragstart",function(){t.cacheWH(i)});a.on("dragend",g);o[e]={drag:a,fn:function(){a.detach("drag",f);a.detach("dragend",g)}};return this}});f=g.prototype;f.attach=f.attachDrag;f.unAttach=f.detachDrag;return e.Scroll=g},{requires:["dd/base","base","node","dom"]});
