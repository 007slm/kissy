/*
Copyright 2010, KISSY UI Library v1.1.5
MIT Licensed
build time: Nov 16 12:40
*/
KISSY.add("dd",function(e){function g(){g.superclass.constructor.apply(this,arguments);this._init()}function i(a,d,f){f=f||150;if(f===-1)return function(){a.apply(d,arguments)};var j=e.now();return function(){var k=e.now();if(k-j>f){j=k;a.apply(d,arguments)}}}var h=e.Event,c=e.DOM,b=e.Node;e.DD={};g.ATTRS={bufferTime:{value:200},activeDrag:{}};e.extend(g,e.Base,{_init:function(){this._showShimMove=i(this._move,this,30)},_move:function(a){var d=this.get("activeDrag");if(d){a.preventDefault();this._clearSelection();
d._move(a)}},_start:function(a){var d=this,f=d.get("bufferTime")||0;d._registerEvent();if(f)d._bufferTimer=setTimeout(function(){d._bufferStart(a)},f);else d._bufferStart(a)},_bufferStart:function(a){this.set("activeDrag",a);this._activeShim();a._start()},_end:function(a){var d=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(d){d._end(a);this.set("activeDrag",null)}},_activeShim:function(){var a=
document;this._shim=(new b("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(a.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:c.docHeight()});this._clearSelection()},_clearSelection:function(){if(window.getSelection)window.getSelection().removeAllRanges();else document.selection&&document.selection.empty()},_registerEvent:function(){var a=document;
h.on(a,"mouseup",this._end,this);h.on(a,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var a=document;h.remove(a,"mousemove",this._showShimMove,this);h.remove(a,"mouseup",this._end,this)}});e.DD.DDM=new g});
KISSY.add("dd-draggable",function(e){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var i=e.UA,h=e.Node;g.ATTRS={node:{setter:function(c){return new h(c)}},handlers:{setter:function(c){if(c)for(var b=0;b<c.length;b++)c[b]=new h(c[b])}}};e.extend(g,e.Base,{_init:function(){var c=this.get("node"),b=this.get("handlers");if(e.isEmptyObject(b))b[c[0].id]=c;for(var a in b)if(b.hasOwnProperty(a)){var d=b[a],f=d.css("cursor");if(d[0]!=c[0])if(!f||f==="auto")d.css("cursor","move")}c.on("mousedown",
this._handleMouseDown,this)},destroy:function(){var c=this.get("node"),b=this.get("handlers"),a;for(a in b)if(b.hasOwnProperty(a)){var d=b[a];d.css("cursor")=="move"&&d.css("cursor","auto")}c.detach("mousedown",this._handleMouseDown,this)},_check:function(c){var b=this.get("handlers"),a;for(a in b)if(b.hasOwnProperty(a))if(b[a].contains(c)||b[a][0]==c[0])return true;return false},_handleMouseDown:function(c){if(this._check(new e.Node(c.target))){i.webkit||c.preventDefault();e.DD.DDM._start(this);
var b=this.get("node"),a=c.pageX;c=c.pageY;b=b.offset();this.startMousePos={left:a,top:c};this.startNodePos=b;this._diff={left:a-b.left,top:c-b.top};this.set("diff",this._diff)}},_move:function(c){var b=this.get("diff");this.fire("drag",{left:c.pageX-b.left,top:c.pageY-b.top})},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});e.Draggable=g},{host:"dd"});
