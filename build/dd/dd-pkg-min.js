/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("dd/ddm",function(h,k,d,i,f){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function o(a,b,l){l=l||150;if(l===-1)return function(){a.apply(b,arguments)};var p=h.now();return function(){var n=h.now();if(n-p>l){p=n;a.apply(b,arguments)}}}function c(a){var b=a.offset();return{left:b.left,right:b.left+a[0].offsetWidth,top:b.top,bottom:b.top+a[0].offsetHeight}}function g(a,b){return a.left<=b.left&&a.right>=b.left&&a.top<=b.top&&a.bottom>=b.top}function j(a){if(a.top>=
a.bottom||a.left>=a.right)return 0;return(a.right-a.left)*(a.bottom-a.top)}function m(a,b){var l=Math.max(a.top,b.top),p=Math.min(a.right,b.right),n=Math.min(a.bottom,b.bottom);return{left:Math.max(a.left,b.left),right:p,top:l,bottom:n}}function v(a,b){return g(c(a),b)}var s=document,w=h.require("node/node");e.ATTRS={prefixCls:{value:"ks-dd-"},bufferTime:{value:200},activeDrag:{},activeDrop:{},drops:{value:[]}};h.extend(e,f,{_regDrop:function(a){this.get("drops").push(a)},_unregDrop:function(a){a=
h.indexOf(a,this.get("drops"));a!=-1&&this.get("drops").splice(a,1)},_init:function(){this._showShimMove=o(this._move,this,30)},_move:function(a){var b=this.get("activeDrag");if(b){a.preventDefault();b._move(a);this._notifyDropsMove(a)}},_notifyDropsMove:function(a){var b=this.get("activeDrag"),l=b.get("mode"),p=this.get("drops"),n,u=0,t=c(b.get("node")),x=j(t);h.each(p,function(q){if(q.get("node")[0]!=b.get("dragNode")[0]){var r;if(l=="point"){if(v(q.get("node"),b.mousePos)){n=q;return false}}else if(l==
"intersect"){r=j(m(t,c(q.get("node"))));if(r>u){u=r;n=q}}else if(l=="strict"){r=j(m(t,c(q.get("node"))));if(r==x){n=q;return false}}}});(p=this.get("activeDrop"))&&p!=n&&p._handleOut(a);if(n)n._handleOver(a);else{b.get("node").removeClass(this.get("prefixCls")+"drag-over");this.set("activeDrop",null)}},_deactivateDrops:function(){var a=this.get("activeDrag"),b=this.get("activeDrop");a.get("node").removeClass(this.get("prefixCls")+"drag-over");if(b){b.get("node").removeClass(this.get("prefixCls")+
"drop-over");b.fire("drophit",{drag:a,drop:b});a.fire("dragdrophit",{drag:a,drop:b})}else a.fire("dragdropmiss",{drag:a})},_start:function(a){var b=this,l=b.get("bufferTime")||0;b._registerEvent();if(l)b._bufferTimer=setTimeout(function(){b._bufferStart(a)},l);else b._bufferStart(a)},_bufferStart:function(a){this.set("activeDrag",a);a.get("shim")&&this._activeShim();a._start()},_end:function(a){var b=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);
this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(b){b._end(a);this._deactivateDrops(a);this.set("activeDrag",null);this.set("activeDrop",null)}},_activeShim:function(){var a=document;this._shim=(new w("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;cursor:move;z-index:999999;'></div>")).appendTo(a.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:k.docHeight()})},
_registerEvent:function(){d.on(s,"mouseup",this._end,this);d.on(s,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){d.remove(s,"mousemove",this._showShimMove,this);d.remove(s,"mouseup",this._end,this)}});return new e},{requires:["dom","event","node","base"]});
KISSY.add("dd/draggable",function(h,k,d,i,f){function e(){e.superclass.constructor.apply(this,arguments);this._init()}var o=h.require("node/node");e.POINT="pointer";e.INTERSECT="intersect";e.STRICT="strict";e.ATTRS={node:{setter:function(c){return o.one(c)}},dragNode:{},shim:{value:true},handlers:{value:[]},cursor:{value:"move"},mode:{value:"point"}};h.extend(e,i,{_init:function(){var c=this.get("node"),g=this.get("handlers");this.set("dragNode",c);if(g.length==0)g[0]=c;for(var j=0;j<g.length;j++){var m=
g[j];m=h.one(m);m.unselectable();this.get("cursor")&&m.css("cursor","move")}c.on("mousedown",this._handleMouseDown,this)},destroy:function(){for(var c=this.get("node"),g=this.get("handlers"),j=0;j<g.length;j++){var m=g[j];m.css("cursor")=="move"&&m.css("cursor","auto")}c.detach("mousedown",this._handleMouseDown,this);this.detach()},_check:function(c){for(var g=this.get("handlers"),j=0;j<g.length;j++){var m=g[j];if(m.contains(c)||m[0]==c[0])return true}return false},_handleMouseDown:function(c){if(this._check(new o(c.target))){c.preventDefault();
f._start(this);var g=this.get("node"),j=c.pageX;c=c.pageY;g=g.offset();this.startMousePos=this.mousePos={left:j,top:c};this.startNodePos=g;this._diff={left:j-g.left,top:c-g.top};this.set("diff",this._diff)}},_move:function(c){var g=this.get("diff"),j=c.pageX-g.left;g=c.pageY-g.top;this.mousePos={left:c.pageX,top:c.pageY};this.fire("drag",{left:j,top:g})},_end:function(){this.fire("dragend")},_start:function(){this.fire("dragstart")}});return e},{requires:["ua","node","base","dd/ddm"]});
KISSY.add("dd/droppable",function(h,k,d,i){function f(){f.superclass.constructor.apply(this,arguments);this._init()}f.ATTRS={node:{setter:function(e){e=k.one(e);e.addClass(i.get("prefixCls")+"drop");return e}}};h.extend(f,d,{_init:function(){i._regDrop(this)},_handleOut:function(){var e=i.get("activeDrag");this.get("node").removeClass(i.get("prefixCls")+"drop-over");this.fire("dropexit",{drop:this,drag:e});e.get("node").removeClass(i.get("prefixCls")+"drag-over");e.fire("dragexit",{drop:this,drag:e})},
_handleOver:function(){var e=i.get("activeDrop");i.set("activeDrop",this);var o=i.get("activeDrag");this.get("node").addClass(i.get("prefixCls")+"drop-over");var c={drag:o,drop:this};if(this!=e){o.get("node").addClass(i.get("prefixCls")+"drag-over");o.fire("dragenter",c);this.fire("dropenter",c)}else{o.fire("dragover",c);this.fire("dropover",c)}},destroy:function(){i._unregDrop(this)}});return f},{requires:["node","base","dd/ddm"]});
KISSY.add("dd/proxy",function(h){function k(){k.superclass.constructor.apply(this,arguments)}k.ATTRS={node:{value:function(d){d=h.one(d.get("node")[0].cloneNode(true));d.attr("id",h.guid("ks-dd-proxy"));return d}}};h.extend(k,h.Base,{attach:function(d){var i=this;d.on("dragstart",function(){var f=i.get("node"),e=d.get("node");if(h.isFunction(f)){f=f(d);f.css("position","absolute");i.set("node",f)}e.parent().append(f);f.show();f.offset(e.offset());d.set("dragNode",e);d.set("node",f)});d.on("dragend",
function(){var f=i.get("node");d.get("dragNode").offset(f.offset());f.hide();d.set("node",d.get("dragNode"))})},destroy:function(){var d=this.get("node");d&&!h.isFunction(d)&&d.remove()}});return k});KISSY.add("dd",function(h,k,d,i,f){k={Draggable:d,Droppable:i,DDM:k,Proxy:f};h.mix(h,k);return k},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy"]});
