/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 7 15:50
*/
KISSY.add("menu/base",function(e,d,c,g){function b(a){this===a.target&&(this.set("highlightedItem",null),a.stopPropagation())}function a(a){var b=a.target;a.target.isMenuItem&&a.newVal&&(this.set("activeItem",b),e.inArray(b,this.get("children"))&&this.set("highlightedItem",b))}var f=d.KeyCodes,k=c.Container.extend({isMenu:1,_onSetHighlightedItem:function(a,b){var f=b&&b.prevVal;f&&f.set("highlighted",!1,{data:{hideImmediate:1}});a&&this.get("focusable")&&this.set("focused",!0)},getRootMenu:function(){return this},
handleMouseEnter:function(){k.superclass.handleMouseEnter.apply(this,arguments);var a=this.getRootMenu();a._popupAutoHideTimer&&(clearTimeout(a._popupAutoHideTimer),a._popupAutoHideTimer=null)},handleBlur:function(a){k.superclass.handleBlur.call(this,a);this.set("highlightedItem",null)},_getNextEnabledHighlighted:function(a,b){var f=this.get("children"),h=f.length,j=a;do{var c=f[a];if(!c.get("disabled")&&!1!==c.get("visible"))return f[a];a=(a+b+h)%h}while(a!=j)},handleKeyEventInternal:function(a){var b=
this.get("highlightedItem");if(b&&b.handleKeydown(a))return!0;var c=this.get("children"),h=c.length;if(0!==h){var j;switch(a.keyCode){case f.ESC:return;case f.HOME:j=this._getNextEnabledHighlighted(0,1);break;case f.END:j=this._getNextEnabledHighlighted(h-1,-1);break;case f.UP:b?(a=e.indexOf(b,c),h=(a-1+h)%h):h-=1;j=this._getNextEnabledHighlighted(h,-1);break;case f.DOWN:b?(a=e.indexOf(b,c),h=(a+1+h)%h):h=0,j=this._getNextEnabledHighlighted(h,1)}if(j)return j.set("highlighted",!0,{data:{byKeyboard:1}}),
!0}},bindUI:function(){this.on("hide",b,this);this.on("afterHighlightedChange",a,this)},containsElement:function(a){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(a))return!0;for(var b=this.get("children"),f=0,h=b.length;f<h;f++){var j=b[f];if("function"==typeof j.containsElement&&j.containsElement(a))return!0}return!1}},{ATTRS:{highlightedItem:{},activeItem:{view:1},xrender:{value:g},defaultChildXClass:{value:"menuitem"}}},{xclass:"menu",priority:10});
return k},{requires:["event","component/base","./menu-render","./submenu"]});
KISSY.add("menu/filtermenu-render",function(e,d,c){var g=d.all;return c.extend({getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var b=this.get("prefixCls"),a=c.prototype.getContentElement.call(this),f=this.get("filterWrap");f||this.set("filterWrap",f=g("<div class='"+b+"menu-filter'/>").appendTo(a,void 0));this.get("labelEl")||this.set("labelEl",g("<div class='"+b+"menu-filter-label'/>").appendTo(f,void 0));
this.get("filterInput")||this.set("filterInput",g("<input autocomplete='off'/>").appendTo(f,void 0));this.get("menuContent")||this.set("menuContent",g("<div class='"+b+"menu-content'/>").appendTo(a,void 0))},_onSetLabel:function(b){this.get("labelEl").html(b)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(b){return b.one("."+this.get("prefixCls")+"menu-filter").one("."+this.get("prefixCls")+"menu-filter-label")},filterWrap:function(b){return b.one("."+this.get("prefixCls")+"menu-filter")},menuContent:function(b){return b.one("."+
this.get("prefixCls")+"menu-content")},filterInput:function(b){return b.one("."+this.get("prefixCls")+"menu-filter").one("input")}}})},{requires:["node","./menu-render"]});
KISSY.add("menu/filtermenu",function(e,d,c,g){var b=c.extend([d.DecorateChild],{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleMouseEnter:function(){b.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a=this.get("view").get("filterInput"),b=this.get("highlightedItem");this.set("filterStr",a.val());(!b||!b.get("visible"))&&this.set("highlightedItem",this._getNextEnabledHighlighted(0,
1))},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var b=this.get("prefixCls"),c=this.get("view"),d=c.get("labelEl"),c=c.get("filterInput");d[a?"hide":"show"]();if(this.get("allowMultiple")){var d=[],g;g=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var i=[];g&&(i=g[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(d=[],g&&(d=i,g=i[i.length-1],(i=(i=this.get("highlightedItem"))&&i.get("content"))&&-1<i.indexOf(g)&&g&&(d[d.length-1]=i),c.val(d.join(",")+",")),a=""):(g&&(a=g[2]||""),
d=i);this.get("enteredItems").length!=d.length&&this.set("enteredItems",d)}var c=this.get("children"),h=a&&RegExp(a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig");e.each(c,function(c){var d=c.get("content");a?-1<d.indexOf(a)?(c.set("visible",!0),c.get("el").html(d.replace(h,function(a){return"<span class='"+b+"menuitem-hit'>"+a+"</span>"}))):c.set("visible",!1):(c.get("el").html(d),c.set("visible",!0))})},reset:function(){var a=this.get("view");this.set("filterStr",
"");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{allowTextSelection:{value:!0},label:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"menu-content"}},xrender:{value:g}}},{xclass:"filter-menu",priority:20});return b},{requires:["component/base","./base","./filtermenu-render"]});
KISSY.add("menu/menu-render",function(e,d){return d.Render.extend({renderUI:function(){var c=this.get("el");c.attr("role","menu").attr("aria-haspopup",!0);c.attr("id")||c.attr("id",e.guid("ks-menu"))},_onSetActiveItem:function(c){var d=this.get("el");c?(c=c.get("el").attr("id"),d.attr("aria-activedescendant",c)):d.attr("aria-activedescendant","")},containsElement:function(c){var d=this.get("el");return d[0]===c||d.contains(c)}},{ATTRS:{activeItem:{}}})},{requires:["component/base"]});
KISSY.add("menu",function(e,d,c,g,b,a,f,k,l,m){d.Render=c;d.Item=g;g.Render=b;d.SubMenu=a;a.Render=f;d.PopupMenu=k;k.Render=l;d.FilterMenu=m;return d},{requires:"menu/base,menu/menu-render,menu/menuitem,menu/menuitem-render,menu/submenu,menu/submenu-render,menu/popupmenu,menu/popupmenu-render,menu/filtermenu".split(",")});
KISSY.add("menu/menuitem-render",function(e,d,c,g){return c.Render.extend({_createDom:function(){this.get("el").attr({role:"menuitem",id:e.guid("ks-menuitem")})},_onSetChecked:function(b){var a=this.get("el"),c=this.getCssClassWithState("checked");a[b?"addClass":"removeClass"](c)},_onSetSelected:function(b){var a=this.get("el"),c=this.getCssClassWithState("selected");a[b?"addClass":"removeClass"](c)},_onSetSelectable:function(b){this.get("el").attr("role",b?"menuitemradio":"menuitem")},_onSetCheckable:function(b){if(b){var a=
this.get("el"),c=this.get("prefixCls"),e=a.one("."+c+"menuitem-checkbox");e||(e=(new d("<div class='"+c+"menuitem-checkbox'/>")).prependTo(a),e.unselectable(g))}this.get("el").attr("role",b?"menuitemcheckbox":"menuitem")},containsElement:function(b){var a=this.get("el");return a&&(a[0]==b||a.contains(b))}},{ATTRS:{checkable:{},selected:{},checked:{}},HTML_PARSER:{selectable:function(b){var a=this.getCssClassWithPrefix("menuitem-selectable");return b.hasClass(a)},checkable:function(b){var a=this.getCssClassWithPrefix("menuitem-checkable");
return b.hasClass(a)}}})},{requires:["node","component/base"]});
KISSY.add("menu/menuitem",function(e,d,c){var g=e.all,b=d.Controller.extend({isMenuItem:1,handleMouseDown:function(a){if(b.superclass.handleMouseDown.call(this,a))return!0;this.set("highlighted",!0)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.get("checkable")&&this.set("checked",!this.get("checked"));this.fire("click");return!0},_onSetHighlighted:function(a){if(a){var a=this.get("el"),b=a.parent(function(a){return"visible"!=g(a).css("overflow")},this.get("parent").get("el").parent());
b&&a.scrollIntoView(b,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.get("view")&&this.get("view").containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},checkable:{view:1},value:{},checked:{view:1},selected:{view:1},xrender:{value:c}}},{xclass:"menuitem",priority:10});return b},{requires:["component/base","./menuitem-render"]});
KISSY.add("menu/popupmenu-render",function(e,d,c){return c.extend([d.ContentBox.Render,d.Position.Render,6===e.UA.ie?d.Shim.Render:null])},{requires:["component/extension","./menu-render"]});
KISSY.add("menu/popupmenu",function(e,d,c,g){var b=c.extend([d.ContentBox,d.Position,d.Align],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeave:function(){b.superclass.handleMouseEnter.apply(this,arguments);if(this.get("autoHideOnMouseLeave")){var a=this.getRootMenu();a&&(clearTimeout(a._popupAutoHideTimer),a._popupAutoHideTimer=setTimeout(function(){a.set("highlightedItem",null)},1E3*this.get("parent").get("menuDelay")))}},
isPopupMenu:1,handleBlur:function(){b.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},xrender:{value:g}}},{xclass:"popupmenu",priority:20});return b},{requires:["component/extension","./base","./popupmenu-render"]});
KISSY.add("menu/submenu-render",function(e,d){return d.extend({createDom:function(){this.get("el").attr("aria-haspopup","true").append(e.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},{ATTRS:{arrowEl:{},contentEl:{valueFn:function(){return e.all(e.substitute('<span class="{prefixCls}menuitem-content"></span>',{prefixCls:this.get("prefixCls")}))}}},HTML_PARSER:{contentEl:function(c){return c.children("."+this.get("prefixCls")+"menuitem-content")}}})},
{requires:["./menuitem-render"]});
KISSY.add("menu/submenu",function(e,d,c,g,b){function a(a){a.target!==this&&a.target.isMenuItem&&a.newVal&&this.set("highlighted",!0)}function f(a,b){var d=a.get("menu");if(d&&!d.isController)if(b)d=c.create(d,a),a.setInternal("menu",d);else return null;return d}function k(){var a,b,c=f(this,1);c&&(a=this.get("el"),b=c.get("align"),delete b.node,b=e.clone(b),b.node=a,b.points=b.points||["tr","tl"],c.set("align",b),c.show(),a.attr("aria-haspopup",c.get("el").attr("id")))}function l(){var a=f(this);
a&&a.hide()}var m=d.KeyCodes,i=g.extend([c.DecorateChild],{isSubMenu:1,bindUI:function(){this.on("afterHighlightedChange",a,this)},_onSetHighlighted:function(a,b){b&&(i.superclass._onSetHighlighted.apply(this,arguments),a?b.byKeyboard||(this.clearSubMenuTimers(),this.showTimer_=e.later(k,1E3*this.get("menuDelay"),!1,this)):b.hideImmediate?l.call(this):this.dismissTimer_=e.later(l,1E3*this.get("menuDelay"),!1,this))},clearSubMenuTimers:function(){var a;if(a=this.dismissTimer_)a.cancel(),this.dismissTimer_=
null;if(a=this.showTimer_)a.cancel(),this.showTimer_=null},performActionInternal:function(){this.clearSubMenuTimers();k.call(this);i.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(a){var b=f(this),c=b&&b.get("visible"),e=a.keyCode;if(c){if(!b.handleKeydown(a))if(e==m.LEFT)l.call(this),this.fire("afterHighlightedChange",{newVal:!0,byKeyboard:1});else return}else if(e==m.RIGHT){if(k.call(this),b=f(this))a=b.get("children"),a[0]&&a[0].set("highlighted",!0)}else{if(a.keyCode==
d.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},containsElement:function(a){var b=f(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("visibility","hidden");e.one(b[0].ownerDocument.body).prepend(b);this.setInternal("menu",new a({srcNode:b,prefixCls:this.get("prefixCls")}))},destructor:function(){var a=f(this);this.clearSubMenuTimers();a&&a.destroy&&a.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{setter:function(a){a instanceof c.Controller&&
a.setInternal("parent",this)}},defaultChildXClass:{value:"popupmenu"},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"popupmenu"}},xrender:{value:b}}},{xclass:"submenu",priority:20});return i},{requires:["event","component/base","./menuitem","./submenu-render"]});
