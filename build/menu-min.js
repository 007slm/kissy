/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Jul 18 18:23
*/
KISSY.add("menu/filtermenu",function(g,f,h,i){return f.create(h,{bindUI:function(){this.get("view")._filterInput.on("keyup",this.handleFilterEvent,this)},handleFilterEvent:function(){this.set("filterStr",this.get("view")._filterInput.val());var c=this.get("highlightedItem");if(!c||!c.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},_uiSetFilterStr:function(c){this.filterItems(c)},filterItems:function(c){var a=this.get("view"),b=a._filterInput;a._labelEl[c?"hide":"show"]();
if(this.get("allowMultiple")){a=[];var d;d=c.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var e=[];if(d)e=d[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(c)){a=[];if(d){a=e;d=e[e.length-1];if((e=(e=this.get("highlightedItem"))&&e.get("content"))&&e.indexOf(d)>-1&&d)a[a.length-1]=e;b.val(a.join(",")+",")}c=""}else{if(d)c=d[2]||"";a=e}this.get("enteredItems").length!=a.length&&this.set("enteredItems",a)}b=this.get("children");var j=c&&RegExp(c.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),k=g.substitute("{prefixCls}menu-item-hit",
{prefixCls:this.get("prefixCls")});g.each(b,function(l){var m=l.get("content"),n=l.get("view");if(c)if(m.indexOf(c)>-1){l.set("visible",true);l.get("view").set("content",m.replace(j,function(o){return"<span class='"+k+"'>"+o+"</span>"}))}else l.set("visible",false);else{n.set("content",m);l.set("visible",true)}})},destructor:function(){var c=this.get("view");(c=c&&c._filterInput)&&c.detach()}},{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:i})},
{requires:["uibase","./menu","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(g,f,h,i){var c=f.all;return h.create(i,{getContentElement:function(){return this._menuContent},getKeyEventTarget:function(){return this._filterInput},createDom:function(){var a=i.prototype.getContentElement.call(this),b=c("<div class='"+g.substitute("{prefixCls}menu-filter",{prefixCls:this.get("prefixCls")})+"'/>").appendTo(a);this._labelEl=c("<div/>").appendTo(b);this._filterInput=c("<input autocomplete='off'/>").appendTo(b);this._menuContent=c("<div class='"+
g.substitute("{prefixCls}menu-content",{prefixCls:this.get("prefixCls")})+"'/>").appendTo(a)},_uiSetLabel:function(a){this._labelEl.html(a)}},{ATTRS:{label:{}}})},{requires:["node","uibase","./menurender"]});
KISSY.add("menu/menu",function(g,f,h,i){var c;c=f.create(h.Container,{_uiSetHighlightedItem:function(a,b){var d=b&&b.prevVal;d&&d.set("highlighted",false);a&&a.set("highlighted",true);this.set("activeItem",a)},_handleBlur:function(a){if(c.superclass._handleBlur.call(this,a))return true;this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(a,b){var d=this.get("children"),e=d.length,j=a;do{var k=d[a];if(!k.get("disabled")&&k.get("visible")!==false)return d[a];a=(a+b+e)%e}while(a!=
j)},_handleClick:function(a){if(c.superclass._handleClick.call(this,a))return true;var b=this.get("highlightedItem");if(b&&b._handleClick(a))return true},_handleKeydown:function(a){if(this._handleKeydownInternal(a)){a.halt();return true}},_handleKeydownInternal:function(a){if(c.superclass._handleKeydown.call(this,a))return true;var b=this.get("highlightedItem");if(b&&b._handleKeydown(a))return true;var d=this.get("children"),e=d.length;if(e!=0){switch(a.keyCode){case 27:return;case 36:this.set("highlightedItem",
this._getNextEnabledHighlighted(0,1));break;case 35:this.set("highlightedItem",this._getNextEnabledHighlighted(e-1,-1));break;case 38:if(b){a=g.indexOf(b,d);e=(a-1+e)%e}else e=e-1;this.set("highlightedItem",this._getNextEnabledHighlighted(e,-1));break;case 40:if(b){a=g.indexOf(b,d);e=(a+1+e)%e}else e=0;this.set("highlightedItem",this._getNextEnabledHighlighted(e,1));break;default:return}return true}},bindUI:function(){var a=this;a.on("hide",function(){a.set("highlightedItem",undefined)})},containsElement:function(a){if(this.get("view").containsElement(a))return true;
for(var b=this.get("children"),d=0,e=b.length;d<e;d++){var j=b[d];if(typeof j.containsElement=="function"&&j.containsElement(a))return true}return false}},{ATTRS:{focusable:{value:true},highlightedItem:{},activeItem:{view:true},visibleMode:{value:"display"}}});c.DefaultRender=i;return c},{requires:["uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(g,f,h,i){var c=f.create(h.ModelControl,{_handleMouseEnter:function(a){if(c.superclass._handleMouseEnter.call(this,a))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(a){if(c.superclass._handleMouseLeave.call(this,a))return true;this.get("parent").set("highlightedItem",undefined)},_handleClick:function(a){if(c.superclass._handleClick.call(this,a))return true;this.get("selectable")&&this.set("selected",true);this.get("checkable")&&
this.set("checked",!this.get("checked"));this.get("parent").fire("click",{target:this})},_uiSetHighlighted:function(a){this.get("view").set("highlighted",a);if(a){var b=this.get("el");a=this.get("parent").get("el");var d=b.offset().top;b=b[0].offsetHeight;var e=a.offset().top,j=a[0].offsetHeight;if(d-e>=j)a[0].scrollTop+=d-e+b-j;else if(d-e<0)a[0].scrollTop+=d-e}},containsElement:function(a){return this.get("view").containsElement(a)}},{ATTRS:{handleMouseEvents:{value:false},focusable:{value:false},
selectable:{view:true},checkable:{view:true},content:{view:true,valueFn:function(){return this.get("view")&&this.get("view").get("content")}},value:{},highlighted:{view:true},checked:{view:true},selected:{view:true},visibleMode:{value:"display"}}});c.DefaultRender=i;return c},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(g,f,h,i){function c(a,b){return g.substitute(b,{prefixCls:a.get("prefixCls")})}return h.create(i.Render,{renderUI:function(){},createDom:function(){var a=this.get("el");a.addClass(c(this,"{prefixCls}menuitem")).html("<div class='"+c(this,"{prefixCls}menuitem-content")+"'>").attr("role","menuitem");a.attr("id")||a.attr("id",g.guid("ks-menuitem"))},_uiSetContent:function(a){var b=this.get("el").children("div");b.item(b.length-1).html(a)},_uiSetDisabled:function(a){var b=
this.get("el").attr("aria-disabled",!!a);a?b.addClass(c(this,"{prefixCls}menuitem-disabled")):b.removeClass(c(this,"{prefixCls}menuitem-disabled"))},_uiSetHighlighted:function(a){a?this.get("el").addClass(c(this,"{prefixCls}menuitem-highlight")):this.get("el").removeClass(c(this,"{prefixCls}menuitem-highlight"))},_uiSetSelected:function(a){this.get("el")[a?"addClass":"removeClass"](c(this,"{prefixCls}menuitem-selected"))},_uiSetChecked:function(a){this.get("el")[a?"addClass":"removeClass"](c(this,
"{prefixCls}menuitem-checked"));if(a){a=this.get("el");var b=g.substitute("{prefixCls}menuitem-checkbox",{prefixCls:this.get("prefixCls")}),d=a.one("."+b);if(!d){d=(new f("<div class='"+b+"'/>")).prependTo(a);d.unselectable()}}},_uiSetSelectable:function(a){this.get("el").attr("role",a?"menuitemradio":"menuitem")},_uiSetCheckable:function(a){this.get("el").attr("role",a?"menuitemcheckbox":"menuitem")},_handleMouseDown:function(){this.get("el").addClass(c(this,"{prefixCls}menuitem-active"));this.get("el").attr("aria-pressed",
true)},_handleMouseUp:function(){this.get("el").removeClass(c(this,"{prefixCls}menuitem-active"));this.get("el").attr("aria-pressed",false)},containsElement:function(a){var b=this.get("el");return b[0]==a||b.contains(a)}},{ATTRS:{highlighted:{},selected:{},content:{},checked:{}},HTML_PARSER:{content:function(a){return a.html()}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(g,f,h,i){return h.create(i.Render,[h.Contentbox.Render],{renderUI:function(){var c=this.get("el");c.addClass(g.substitute("{prefixCls}menu  {prefixCls}menu-vertical",{prefixCls:this.get("prefixCls")})).attr("role","menu").attr("aria-haspopup",true);c.attr("id")||c.attr("id",g.guid("ks-menu"))},_uiSetActiveItem:function(c){var a=this.get("el");if(c){c=c.get("view").get("el").attr("id");a.attr("aria-activedescendant",c)}else a.attr("aria-activedescendant","")},containsElement:function(c){var a=
this.get("el");return a[0]===c||a.contains(c)}},{ATTRS:{highlightedItem:{},activeItem:{}}})},{requires:["ua","uibase","component"]});KISSY.add("menu/popupmenu",function(g,f,h,i,c){return f.create(i,[f.Position,f.Align],{},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"}},DefaultRender:c})},{requires:["uibase","component","./menu","./popupmenurender"]});
KISSY.add("menu/popupmenurender",function(g,f,h,i){return h.create(i,[h.Position.Render,f.ie===6?h.Shim.Render:null])},{requires:["ua","uibase","./menurender"]});KISSY.add("menu/separator",function(g,f,h,i){return f.create(h.ModelControl,{},{ATTRS:{focusable:{value:false},handleMouseEvents:{value:false},disabled:{value:true}},DefaultRender:i})},{requires:["uibase","component","./separatorrender"]});
KISSY.add("menu/separatorrender",function(g,f,h){return f.create(h.Render,{createDom:function(){this.get("el").attr("role","separator").addClass(g.substitute("{prefixCls}menuseparator",{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(g,f,h,i,c){var a;a=f.create(i,{_onParentHide:function(){this.get("menu")&&this.get("menu").hide()},bindUI:function(){var b=this.get("parent"),d=this.get("menu");if(b){b.on("hide",this._onParentHide,this);d.on("click",function(e){b.fire("click",{target:e.target})});d.on("afterActiveItemChange",function(e){b.set("activeItem",e.newVal)})}d.on("beforeHighlightedItemChange",this.onChildHighlight_,this)},_handleMouseEnter:function(b){if(a.superclass._handleMouseEnter.call(this,
b))return true;this.clearTimers();this.showTimer_=g.later(this.showMenu,this.get("menuDelay"),false,this)},showMenu:function(){var b=this.get("menu");b.set("align",{node:this.get("view").get("el"),points:["tr","tl"]});b.render();this.get("view").get("el").attr("aria-haspopup",b.get("view").get("el").attr("id"));b.show()},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}},onChildHighlight_:function(b){if(b.newVal)if(this.get("menu").get("parent")==
this){this.clearTimers();this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var b=this.get("menu");b&&b.hide()},_handleClick:function(b){this.showMenu();return this.get("menu")._handleClick(b)},_handleKeydown:function(b){if(a.superclass._handleKeydown.call(this,b))return true;var d=this.get("menu"),e=d&&d.get("visible"),j=b.keyCode;if(e){if(!d._handleKeydown(b))if(j==37){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(j==39){this.showMenu();b=d.get("children");
b[0]&&d.set("highlightedItem",b[0])}else return;return true},_uiSetHighlighted:function(b,d){a.superclass._uiSetHighlighted.call(this,b,d);if(!b){this.dismissTimer_&&this.dismissTimer_.cancel();this.dismissTimer_=g.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(b){var d=this.get("menu");return d&&d.containsElement(b)},destructor:function(){var b=this.get("parent"),d=this.get("menu");this.clearTimers();b&&b.detach("hide",this._onParentHide,this);d&&d.destroy()}},{ATTRS:{menuDelay:{value:300},
menu:{setter:function(b){b.set("parent",this)}}}});a.DefaultRender=c;return a},{requires:["uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(g,f,h){return f.create(h,{renderUI:function(){this.get("el").addClass(this.get("prefixCls")+"submenu");this.get("el").attr("aria-haspopup","true")},_uiSetContent:function(i){this.get("el").one("."+this.get("prefixCls")+"menuitem-content").html(i+g.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(g,f,h,i,c,a,b,d,e,j,k){f.Render=h;f.Item=i;f.Item.Render=c;f.SubMenu=a;a.Render=b;f.Separator=d;f.PopupMenu=j;f.FilterMenu=k;return f},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/filtermenu"]});
