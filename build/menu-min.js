/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Nov 2 15:13
*/
KISSY.add("menu/delmenuitem",function(l,i,h,k,e,d){function b(f){var a=f.get("parent");if(a.fire("beforeDelete",{target:f})!==false){a.removeChild(f,true);a.set("highlightedItem",null);a.fire("delete",{target:f})}}var c=i.all;l=d.CLS;var g=d.DEL_CLS;h=h.create(e,{_performInternal:function(f){if(c(f.target).hasClass(this.getCls(g))){b(this);return true}return e.prototype._performInternal.call(this,f)},_handleKeydown:function(f){if(f.keyCode===i.KeyCodes.D){b(this);return true}}},{ATTRS:{delTooltip:{view:true}},
DefaultRender:d});k.UIStore.setUIByClass(l,{priority:k.UIStore.PRIORITY.LEVEL4,ui:h});return h},{requires:["node","uibase","component","./menuitem","./delmenuitemrender"]});
KISSY.add("menu/delmenuitemrender",function(l,i,h,k,e){function d(c){c.get("contentEl").append(l.substitute(b,{prefixCls:c.get("prefixCls"),tooltip:c.get("delTooltip")}))}var b='<span class="{prefixCls}menuitem-delete" title="{tooltip}">X</span>';return h.create(e,{createDom:function(){d(this)},_uiSetContent:function(c){e.prototype._uiSetContent.call(this,c);d(this)},_uiSetDelTooltip:function(){this._uiSetContent(this.get("content"))}},{ATTRS:{delTooltip:{}},HTML_PARSER:{delEl:function(c){return c.one(this.getCls("menuitem-delete"))}},
CLS:"menuitem-deletable",DEL_CLS:"menuitem-delete"})},{requires:["node","uibase","component","./menuitemrender"]});
KISSY.add("menu/filtermenu",function(l,i,h,k,e){var d=i.create(k,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},_handleMouseEnter:function(){d.superclass._handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b=this.get("view").get("filterInput"),c=this.get("highlightedItem");this.set("filterStr",b.val());if(!c||!c.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},
_uiSetFilterStr:function(b){this.filterItems(b)},filterItems:function(b){var c=this.get("view"),g=c.get("labelEl");c=c.get("filterInput");g[b?"hide":"show"]();if(this.get("allowMultiple")){g=[];var f;f=b.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var a=[];if(f)a=f[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(b)){g=[];if(f){g=a;f=a[a.length-1];if((a=(a=this.get("highlightedItem"))&&a.get("content"))&&a.indexOf(f)>-1&&f)g[g.length-1]=a;c.val(g.join(",")+",")}b=""}else{if(f)b=f[2]||"";g=a}this.get("enteredItems").length!=g.length&&
this.set("enteredItems",g)}c=this.get("children");var j=b&&RegExp(b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),m=this.getCls("menuitem-hit");l.each(c,function(n){var o=n.get("content");if(b)if(o.indexOf(b)>-1){n.set("visible",true);n.get("contentEl").html(o.replace(j,function(p){return"<span class='"+m+"'>"+p+"</span>"}))}else n.set("visible",false);else{n.get("contentEl").html(o);n.set("visible",true)}})},decorateInternal:function(b){this.set("el",b);this.decorateChildren(b.one("."+
this.getCls("menu-content")))},reset:function(){var b=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(b=b&&b.get("filterInput"))&&b.val("")},destructor:function(){var b=this.get("view");(b=b&&b.get("filterInput"))&&b.detach()}},{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:e});h.UIStore.setUIByClass("filtermenu",{priority:h.UIStore.PRIORITY.LEVEL2,ui:d});return d},{requires:["uibase","component","./menu","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(l,i,h,k){var e=i.all;return h.create(k,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var d=k.prototype.getContentElement.call(this),b=this.get("filterWrap");b||this.set("filterWrap",b=e("<div class='"+this.getCls("menu-filter")+"'/>").appendTo(d));this.get("labelEl")||this.set("labelEl",e("<div class='"+this.getCls("menu-filter-label")+"'/>").appendTo(b));this.get("filterInput")||
this.set("filterInput",e("<input autocomplete='off'/>").appendTo(b));this.get("menuContent")||this.set("menuContent",e("<div class='"+this.getCls("menu-content")+"'/>").appendTo(d))},_uiSetLabel:function(d){this.get("labelEl").html(d)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(d){return d.one("."+this.getCls("menu-filter")).one("."+this.getCls("menu-filter-label"))},filterWrap:function(d){return d.one("."+this.getCls("menu-filter"))},menuContent:function(d){return d.one("."+this.getCls("menu-content"))},
filterInput:function(d){return d.one("."+this.getCls("menu-filter")).one("input")}}})},{requires:["node","uibase","./menurender"]});
KISSY.add("menu/menu",function(l,i,h,k,e){var d=i.KeyCodes,b=h.create(k.Container,{_uiSetHighlightedItem:function(c,g){var f=g&&g.prevVal;f&&f.set("highlighted",false);c&&c.set("highlighted",true);this.set("activeItem",c)},_handleBlur:function(c){b.superclass._handleBlur.call(this,c);this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(c,g){var f=this.get("children"),a=f.length,j=c;do{var m=f[c];if(!m.get("disabled")&&m.get("visible")!==false)return f[c];c=(c+g+a)%a}while(c!=
j)},_handleKeydown:function(c){if(this._handleKeyEventInternal(c)){c.halt();return true}},_handleKeyEventInternal:function(c){var g=this.get("highlightedItem");if(g&&g._handleKeydown(c))return true;var f=this.get("children"),a=f.length;if(a!==0){switch(c.keyCode){case d.ESC:return;case d.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case d.END:this.set("highlightedItem",this._getNextEnabledHighlighted(a-1,-1));break;case d.UP:if(g){c=l.indexOf(g,f);a=(c-1+a)%a}else a=
a-1;this.set("highlightedItem",this._getNextEnabledHighlighted(a,-1));break;case d.DOWN:if(g){c=l.indexOf(g,f);a=(c+1+a)%a}else a=0;this.set("highlightedItem",this._getNextEnabledHighlighted(a,1));break;default:return}return true}},bindUI:function(){var c=this;c.on("hide",function(){c.set("highlightedItem",undefined)})},containsElement:function(c){if(this.get("view").containsElement(c))return true;for(var g=this.get("children"),f=0,a=g.length;f<a;f++){var j=g[f];if(typeof j.containsElement=="function"&&
j.containsElement(c))return true}return false}},{ATTRS:{focusable:{value:true},visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:true}},DefaultRender:e});k.UIStore.setUIByClass("menu",{priority:k.UIStore.PRIORITY.LEVEL1,ui:b});return b},{requires:["event","uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(l,i,h,k){var e=l.all,d=i.create(h.ModelControl,[i.Contentbox],{_handleMouseEnter:function(b){if(d.superclass._handleMouseEnter.call(this,b))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(b){if(d.superclass._handleMouseLeave.call(this,b))return true;this.get("parent").set("highlightedItem",undefined)},_performInternal:function(){this.get("selectable")&&this.set("selected",true);this.get("checkable")&&this.set("checked",!this.get("checked"));
this.get("parent").fire("click",{target:this});return true},_uiSetChecked:function(b){this._forwardSetAttrToView("checked",b)},_uiSetSelected:function(b){this._forwardSetAttrToView("selected",b)},_uiSetHighlighted:function(b){d.superclass._uiSetHighlighted.apply(this,arguments);if(b){var c=this.get("el"),g=c.parent(function(f){return e(f).css("overflow")!="visible"},this.get("parent").get("el").parent());g&&c.scrollIntoView(g,undefined,undefined,true)}},containsElement:function(b){return this.get("view")&&
this.get("view").containsElement(b)}},{ATTRS:{focusable:{value:false},visibleMode:{value:"display"},handleMouseEvents:{value:false},selectable:{view:true},checkable:{view:true},value:{},checked:{},selected:{}},HTML_PARSER:{selectable:function(b){var c=this.getCls("menuitem-selectable");return b.hasClass(c)}}});d.DefaultRender=k;h.UIStore.setUIByClass("menuitem",{priority:h.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(l,i,h,k){return h.create(k.Render,[h.Contentbox.Render],{renderUI:function(){var e=this.get("el");e.attr("role","menuitem");this.get("contentEl").addClass(this.getCls("menuitem-content"));e.attr("id")||e.attr("id",l.guid("ks-menuitem"))},_setSelected:function(e,d){var b=this.get("el"),c=this._completeClasses(d,"-selected");b[e?"addClass":"removeClass"](c)},_setChecked:function(e,d){var b=this.get("el"),c=this._completeClasses(d,"-checked");b[e?"addClass":"removeClass"](c)},
_uiSetSelectable:function(e){this.get("el").attr("role",e?"menuitemradio":"menuitem")},_uiSetCheckable:function(e){if(e){var d=this.get("el"),b=this.getCls("menuitem-checkbox"),c=d.one("."+b);if(!c){c=(new i("<div class='"+b+"'/>")).prependTo(d);c.unselectable()}}this.get("el").attr("role",e?"menuitemcheckbox":"menuitem")},containsElement:function(e){var d=this.get("el");return d[0]==e||d.contains(e)}},{ATTRS:{selected:{},checked:{}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(l,i,h,k){return h.create(k.Render,[h.Contentbox.Render],{renderUI:function(){var e=this.get("el");e.attr("role","menu").attr("aria-haspopup",true);e.attr("id")||e.attr("id",l.guid("ks-menu"))},_uiSetActiveItem:function(e){var d=this.get("el");if(e){e=e.get("el").attr("id");d.attr("aria-activedescendant",e)}else d.attr("aria-activedescendant","")},containsElement:function(e){var d=this.get("el");return d[0]===e||d.contains(e)}},{ATTRS:{activeItem:{}}})},{requires:["ua",
"uibase","component"]});
KISSY.add("menu/popupmenu",function(l,i,h,k,e){function d(g){var f=g.get("parent"),a;if(f)if(f.get("menu")===g)a=f.get("parent");if(a&&a.get(b))return a;return 0}var b="autoHideOnMouseLeave",c=i.create(k,[i.Position,i.Align],{_clearLeaveHideTimers:function(){var g,f,a;if(this.get(b)){if(g=this._leaveHideTimer){clearTimeout(g);this._leaveHideTimer=0}var j=this.get("children");for(g=0;g<j.length;g++){f=j[g];if((a=f.get("menu"))&&a.get(b))a._clearLeaveHideTimers()}}},_handleMouseLeave:function(){var g=this;
if(g.get(b))g._leaveHideTimer=setTimeout(function(){for(var f=g,a=g;a;){f=a;a=d(f);if(!a)break}f.hide()},g.get("autoHideDelay"))},_handleMouseEnter:function(){var g=d(this);g?g._clearLeaveHideTimers():this._clearLeaveHideTimers()},_handleBlur:function(){c.superclass._handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"},autoHideOnMouseLeave:{},autoHideDelay:{value:100}},DefaultRender:e});h.UIStore.setUIByClass("popupmenu",{priority:h.UIStore.PRIORITY.LEVEL2,
ui:c});return c},{requires:["uibase","component","./menu","./popupmenurender"]});KISSY.add("menu/popupmenurender",function(l,i,h,k){return h.create(k,[h.Position.Render,i.ie===6?h.Shim.Render:null])},{requires:["ua","uibase","./menurender"]});
KISSY.add("menu/separator",function(l,i,h,k){l=i.create(h.ModelControl,{},{ATTRS:{focusable:{value:false},disabled:{value:true},handleMouseEvents:{value:false}},DefaultRender:k});h.UIStore.setUIByClass("menuseparator",{priority:h.UIStore.PRIORITY.LEVEL2,ui:l});return l},{requires:["uibase","component","./separatorrender"]});KISSY.add("menu/separatorrender",function(l,i,h){return i.create(h.Render,{createDom:function(){this.get("el").attr("role","separator")}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(l,i,h,k,e,d){function b(a){var j=this.get("menu");a=a.target;var m=this.get("el");!m.contains(a)&&m[0]!==a&&!j.containsElement(a)&&j.hide()}var c=i.KeyCodes,g=document,f=h.create(e,[k.DecorateChild],{_onParentHide:function(){this.get("menu")&&this.get("menu").hide()},bindUI:function(){var a=this.get("parent"),j=this.get("menu");if(a){a.on("hide",this._onParentHide,this);j.on("click",function(m){a.fire("click",{target:m.target})});if(!a.__bindDocClickToHide){i.on(g,
"click",b,this);j.__bindDocClickToHide=1}j.on("afterActiveItemChange",function(m){a.set("activeItem",m.newVal)})}j.on("beforeHighlightedItemChange",this.onChildHighlight_,this)},_handleMouseEnter:function(a){if(f.superclass._handleMouseEnter.call(this,a))return true;this.clearTimers();this.showTimer_=l.later(this.showMenu,this.get("menuDelay"),false,this)},showMenu:function(){var a=this.get("menu");a.set("align",l.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign")));a.render();this.get("el").attr("aria-haspopup",
a.get("el").attr("id"));a.show()},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}},onChildHighlight_:function(a){if(a.newVal)if(this.get("menu").get("parent")==this){this.clearTimers();this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var a=this.get("menu");a&&a.hide()},_performInternal:function(){this.clearTimers();this.showMenu()},_handleKeydown:function(a){var j=
this.get("menu"),m=j&&j.get("visible"),n=a.keyCode;if(m){if(!j._handleKeydown(a))if(n==c.LEFT){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(n==c.RIGHT){this.showMenu();a=j.get("children");a[0]&&j.set("highlightedItem",a[0])}else return;return true},_uiSetHighlighted:function(a,j){f.superclass._uiSetHighlighted.call(this,a,j);if(!a){this.dismissTimer_&&this.dismissTimer_.cancel();this.dismissTimer_=l.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(a){var j=
this.get("menu");return j&&j.containsElement(a)},decorateChildrenInternal:function(a,j,m){j.css("visibility","hidden");l.one(j[0].ownerDocument.body).prepend(j);this.set("menu",new a({srcNode:j,prefixCls:m}))},destructor:function(){var a=this.get("parent"),j=this.get("menu");this.clearTimers();i.remove(g,"click",b,this);a&&a.detach("hide",this._onParentHide,this);!this.get("externalSubMenu")&&j&&j.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:false},menuAlign:{},menu:{setter:function(a){a.set("parent",
this)}},decorateChildCls:{value:"popupmenu"}},DefaultRender:d});k.UIStore.setUIByClass("submenu",{priority:k.UIStore.PRIORITY.LEVEL2,ui:f});return f},{requires:["event","uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(l,i,h){var k;return k=i.create(h,{renderUI:function(){var e=this.get("el"),d=this.get("contentEl");e.attr("aria-haspopup","true");d.append(l.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetContent:function(e){k.superclass._uiSetContent.call(this,e);this.get("contentEl").append(l.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(l,i,h,k,e,d,b,c,g,f,a,j){i.Render=h;i.Item=k;i.Item.Render=e;i.SubMenu=d;d.Render=b;i.Separator=c;i.PopupMenu=f;i.FilterMenu=a;i.DelMenuItem=j;return i},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/filtermenu","menu/delmenuitem","menu/delmenuitemrender"]});
