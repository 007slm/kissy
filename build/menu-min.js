/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 28 19:45
*/
KISSY.add("menu/base",function(g,a,e,c){function d(){this.set("highlightedItem",void 0)}var b=a.KeyCodes,f=e.define(e.Container,{_uiSetHighlightedItem:function(b,a){var h=a&&a.prevVal;h&&h.set("highlighted",!1);b&&b.set("highlighted",!0);this.set("activeItem",b)},handleBlur:function(b){f.superclass.handleBlur.call(this,b);this.set("highlightedItem",void 0)},_getNextEnabledHighlighted:function(b,a){var h=this.get("children"),f=h.length,i=b;do{var m=h[b];if(!m.get("disabled")&&!1!==m.get("visible"))return h[b];
b=(b+a+f)%f}while(b!=i)},handleKeydown:function(b){if(this.handleKeyEventInternal(b))return b.halt(),!0},handleKeyEventInternal:function(a){var f=this.get("highlightedItem");if(f&&f.handleKeydown(a))return!0;var h=this.get("children"),c=h.length;if(0!==c){switch(a.keyCode){case b.ESC:return;case b.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case b.END:this.set("highlightedItem",this._getNextEnabledHighlighted(c-1,-1));break;case b.UP:f?(a=g.indexOf(f,h),c=(a-1+c)%c):
c-=1;this.set("highlightedItem",this._getNextEnabledHighlighted(c,-1));break;case b.DOWN:f?(a=g.indexOf(f,h),c=(a+1+c)%c):c=0;this.set("highlightedItem",this._getNextEnabledHighlighted(c,1));break;default:return}return!0}},bindUI:function(){this.on("hide",d,this)},containsElement:function(b){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(b))return!0;for(var c=this.get("children"),a=0,f=c.length;a<f;a++){var i=c[a];if("function"==typeof i.containsElement&&
i.containsElement(b))return!0}return!1}},{ATTRS:{visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:!0}},DefaultRender:c},"Menu");e.UIStore.setUIConstructorByCssClass("menu",{priority:e.UIStore.PRIORITY.LEVEL1,ui:f});return f},{requires:["event","component","./menuRender","./submenu"]});
KISSY.add("menu/filtermenu",function(g,a,e,c){var d=a.define(e,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleMouseEnter:function(){d.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b=this.get("view").get("filterInput"),a=this.get("highlightedItem");this.set("filterStr",b.val());(!a||!a.get("visible"))&&this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},_uiSetFilterStr:function(b){this.filterItems(b)},
filterItems:function(b){var a=this.get("view"),c=a.get("labelEl"),a=a.get("filterInput");c[b?"hide":"show"]();if(this.get("allowMultiple")){var c=[],d;d=b.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var h=[];d&&(h=d[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(b)?(c=[],d&&(c=h,d=h[h.length-1],(h=(h=this.get("highlightedItem"))&&h.get("html"))&&-1<h.indexOf(d)&&d&&(c[c.length-1]=h),a.val(c.join(",")+",")),b=""):(d&&(b=d[2]||""),c=h);this.get("enteredItems").length!=c.length&&this.set("enteredItems",c)}var a=
this.get("children"),e=b&&RegExp(b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),i=this.getCssClassWithPrefix("menuitem-hit");g.each(a,function(c){var a=c.get("html");b?-1<a.indexOf(b)?(c.set("visible",!0),c.get("el").html(a.replace(e,function(b){return"<span class='"+i+"'>"+b+"</span>"}))):c.set("visible",!1):(c.get("el").html(a),c.set("visible",!0))})},decorateInternal:function(b){this.set("el",b);this.decorateChildren(b.one("."+this.getCssClassWithPrefix("menu-content")))},
reset:function(){var b=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(b=b&&b.get("filterInput"))&&b.val("")},destructor:function(){var b=this.get("view");(b=b&&b.get("filterInput"))&&b.detach()}},{ATTRS:{label:{view:!0},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1}},DefaultRender:c},"Menu_FilterMenu");a.UIStore.setUIConstructorByCssClass("filtermenu",{priority:a.UIStore.PRIORITY.LEVEL2,ui:d});return d},{requires:["component","./base","./filtermenuRender"]});
KISSY.add("menu/filtermenuRender",function(g,a,e,c){var d=a.all;return e.define(c,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var b=c.prototype.getContentElement.call(this),a=this.get("filterWrap");a||this.set("filterWrap",a=d("<div class='"+this.getCssClassWithPrefix("menu-filter")+"'/>").appendTo(b));this.get("labelEl")||this.set("labelEl",d("<div class='"+this.getCssClassWithPrefix("menu-filter-label")+
"'/>").appendTo(a));this.get("filterInput")||this.set("filterInput",d("<input autocomplete='off'/>").appendTo(a));this.get("menuContent")||this.set("menuContent",d("<div class='"+this.getCssClassWithPrefix("menu-content")+"'/>").appendTo(b))},_uiSetLabel:function(b){this.get("labelEl").html(b)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(b){return b.one("."+this.getCssClassWithPrefix("menu-filter")).one("."+this.getCssClassWithPrefix("menu-filter-label"))},filterWrap:function(b){return b.one("."+
this.getCssClassWithPrefix("menu-filter"))},menuContent:function(b){return b.one("."+this.getCssClassWithPrefix("menu-content"))},filterInput:function(b){return b.one("."+this.getCssClassWithPrefix("menu-filter")).one("input")}}},"Menu_FilterMenu_Render")},{requires:["node","component","./menuRender"]});KISSY.add("menu",function(g,a,e,c,d,b,f,j,k,h,l,i){a.Render=e;a.Item=c;c.Render=d;a.SubMenu=b;b.Render=f;a.Separator=j;a.PopupMenu=h;h.Render=l;a.FilterMenu=i;return a},{requires:"menu/base,menu/menuRender,menu/menuitem,menu/menuitemRender,menu/submenu,menu/submenuRender,menu/separator,menu/separatorRender,menu/popupmenu,menu/popupmenuRender,menu/filtermenu".split(",")});
KISSY.add("menu/menuRender",function(g,a,e){return e.define(e.Render,{renderUI:function(){var a=this.get("el");a.attr("role","menu").attr("aria-haspopup",!0);a.attr("id")||a.attr("id",g.guid("ks-menu"))},_uiSetActiveItem:function(a){var d=this.get("el");a?(a=a.get("el").attr("id"),d.attr("aria-activedescendant",a)):d.attr("aria-activedescendant","")},containsElement:function(a){var d=this.get("el");return d[0]===a||d.contains(a)}},{ATTRS:{activeItem:{}}},"Menu_Render")},{requires:["ua","component"]});
KISSY.add("menu/menuitem",function(g,a,e){var c=g.all,d=a.define(a.Controller,{handleMouseEnter:function(b){if(d.superclass.handleMouseEnter.call(this,b))return!0;this.get("parent").set("highlightedItem",this)},handleMouseLeave:function(b){if(d.superclass.handleMouseLeave.call(this,b))return!0;this.get("parent").set("highlightedItem",null)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.get("checkable")&&this.set("checked",!this.get("checked"));this.get("parent").fire("click",
{target:this});return!0},_uiSetHighlighted:function(b){if(b){var b=this.get("el"),a=b.parent(function(b){return"visible"!=c(b).css("overflow")},this.get("parent").get("el").parent());a&&b.scrollIntoView(a,void 0,void 0,!0)}},containsElement:function(b){return this.get("view")&&this.get("view").containsElement(b)}},{ATTRS:{focusable:{value:!1},visibleMode:{value:"display"},handleMouseEvents:{value:!1},selectable:{view:!0},checkable:{view:!0},value:{},checked:{view:!0},selected:{view:!0},content:{getter:function(){return this.get("html")},
setter:function(b){return this.set("html",b)}}},HTML_PARSER:{selectable:function(b){var a=this.getCssClassWithPrefix("menuitem-selectable");return b.hasClass(a)}}},"Menu_Item");d.DefaultRender=e;a.UIStore.setUIConstructorByCssClass("menuitem",{priority:a.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["component","./menuitemRender"]});
KISSY.add("menu/menuitemRender",function(g,a,e){return e.define(e.Render,{_uiSetChecked:function(a){var d=this.get("el"),b=this.getComponentCssClassWithState("-checked");d[a?"addClass":"removeClass"](b)},_uiSetSelected:function(a){var d=this.get("el"),b=this.getComponentCssClassWithState("-selected");d[a?"addClass":"removeClass"](b)},_uiSetSelectable:function(a){this.get("el").attr("role",a?"menuitemradio":"menuitem")},_uiSetCheckable:function(c){if(c){var d=this.get("el"),b=this.getCssClassWithPrefix("menuitem-checkbox"),
f=d.one("."+b);f||(f=(new a("<div class='"+b+"'/>")).prependTo(d),f.unselectable())}this.get("el").attr("role",c?"menuitemcheckbox":"menuitem")},containsElement:function(a){var d=this.get("el");return d[0]==a||d.contains(a)}},{ATTRS:{elAttrs:{valueFn:function(){return{role:"menuitem",id:g.guid("ks-menuitem")}}},selected:{},checked:{}}},"Menu_Item_Render")},{requires:["node","component"]});
KISSY.add("menu/popupmenu",function(g,a,e,c){function d(a){var b=a.get("parent"),i;b&&b.get("menu")==a&&(i=b.get("parent"));return i}function b(a){return(a=d(a))&&a.get(f)?a:0}var f="autoHideOnMouseLeave",j=a.UIBase,k=a.define(e,[j.ContentBox,j.Position,j.Align],{_clearLeaveHideTimers:function(){var a,b,i;if(this.get(f)){if(a=this._leaveHideTimer)clearTimeout(a),this._leaveHideTimer=0;var c=this.get("children");for(a=0;a<c.length;a++)b=c[a],(i=b.get("menu"))&&!g.isFunction(i)&&i.get(f)&&i._clearLeaveHideTimers()}},
handleMouseLeave:function(){var a=this,c;a.get(f)&&(a._leaveHideTimer=setTimeout(function(){a.hide();var b=a.get("parent"),c;b&&(c=d(a))&&c.get("highlightedItem")===b&&c.set("highlightedItem",null)},a.get("autoHideDelay")),(c=b(a))&&c.handleMouseLeave())},handleMouseEnter:function(){if(this.get(f)){var a=b(this);a&&a.handleMouseEnter();this._clearLeaveHideTimers()}},handleBlur:function(){k.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},visibleMode:{value:"visibility"},
autoHideOnMouseLeave:{},autoHideDelay:{value:0.1}},DefaultRender:c},"Menu_PopupMenu");a.UIStore.setUIConstructorByCssClass("popupmenu",{priority:a.UIStore.PRIORITY.LEVEL2,ui:k});return k},{requires:["component","./base","./popupmenuRender"]});KISSY.add("menu/popupmenuRender",function(g,a,e,c){g=e.UIBase;return e.define(c,[g.ContentBox.Render,g.Position.Render,6===a.ie?g.Shim.Render:null],"Menu_PopupMenu_Render")},{requires:["ua","component","./menuRender"]});
KISSY.add("menu/separator",function(g,a,e){g=a.define(a.Controller,{},{ATTRS:{focusable:{value:!1},disabled:{value:!0},handleMouseEvents:{value:!1}},DefaultRender:e},"Menu_Separator");a.UIStore.setUIConstructorByCssClass("menuseparator",{priority:a.UIStore.PRIORITY.LEVEL2,ui:g});return g},{requires:["component","./separatorRender"]});KISSY.add("menu/separatorRender",function(g,a){return a.define(a.Render,{createDom:function(){this.get("el").attr("role","separator")}},"Menu_Separator_Render")},{requires:["component"]});
KISSY.add("menu/submenu",function(g,a,e,c,d){function b(b,c){var d=b.get("parent");d&&(d.on("hide",b._onParentHide,b),c.on("click",function(a){d.fire("click",{target:a.target})}),d.__bindDocClickToHide||(a.on(h,"click",j,b),d.__bindDocClickToHide=1,c.__bindDocClickToHide=1),c.on("afterActiveItemChange",function(a){d.set("activeItem",a.newVal)}));c.on("beforeHighlightedItemChange",b.onChildHighlight_,b)}function f(a,c){var d=a.get("menu");if(g.isFunction(d))if(c)d=d.call(a),a.__set("menu",d);else return null;
else d=e.Controller.create(d,a),a.__set("menu",d);d&&d.get("parent")!==a&&(d.__set("parent",a),b(a,d));return d}function j(a){var b=f(this),a=a.target,c=this.get("parent");this.get("el");c.containsElement(a)||(b&&b.hide(),this.get("parent").set("highlightedItem",null))}var k=a.KeyCodes,h=g.Env.host.document,l=e.define(c,[e.DecorateChild],{_onParentHide:function(){var a=f(this);a&&a.hide()},handleMouseEnter:function(a){if(l.superclass.handleMouseEnter.call(this,a))return!0;this.clearTimers();this.showTimer_=
g.later(this.showMenu,this.get("menuDelay"),!1,this)},showMenu:function(){var a=f(this,1);a&&(a.set("align",g.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign"))),a.render(),this.get("el").attr("aria-haspopup",a.get("el").attr("id")),a.show())},clearTimers:function(){this.dismissTimer_&&(this.dismissTimer_.cancel(),this.dismissTimer_=null);this.showTimer_&&(this.showTimer_.cancel(),this.showTimer_=null);var a=f(this);a&&a._leaveHideTimer&&(clearTimeout(a._leaveHideTimer),a._leaveHideTimer=
0)},onChildHighlight_:function(a){a.newVal&&(this.clearTimers(),this.get("parent").set("highlightedItem",this))},hideMenu:function(){var a=f(this);a&&a.hide()},performActionInternal:function(){this.clearTimers();this.showMenu();l.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(b){var c=f(this),d=c&&c.get("visible"),e=b.keyCode;if(d){if(!c.handleKeydown(b))if(e==k.LEFT)this.hideMenu(),this.get("parent").set("activeItem",this);else return}else if(e==k.RIGHT){if(this.showMenu(),
c=f(this))b=c.get("children"),b[0]&&c.set("highlightedItem",b[0])}else{if(b.keyCode==a.KeyCodes.ENTER)return this.performActionInternal(b);return}return!0},_uiSetHighlighted:function(a,b){l.superclass._uiSetHighlighted.call(this,a,b);a||(this.clearTimers(),this.dismissTimer_=g.later(this.hideMenu,this.get("menuDelay"),!1,this))},containsElement:function(a){var b=f(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("visibility","hidden");g.one(b[0].ownerDocument.body).prepend(b);
this.__set("menu",new a({srcNode:b,prefixCls:this.get("prefixCls")}))},destructor:function(){var b=this.get("parent"),c=f(this);this.clearTimers();c&&c.__bindDocClickToHide&&(c.__bindDocClickToHide=0,a.remove(h,"click",j,this));b&&b.detach("hide",this._onParentHide,this);c&&!this.get("externalSubMenu")&&c.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:!1},menuAlign:{},menu:{},decorateChildCls:{value:"popupmenu"}},DefaultRender:d},"Menu_SubMenu");e.UIStore.setUIConstructorByCssClass("submenu",
{priority:e.UIStore.PRIORITY.LEVEL2,ui:l});return l},{requires:["event","component","./menuitem","./submenuRender"]});
KISSY.add("menu/submenuRender",function(g,a,e){var c;return c=a.define(e,{renderUI:function(){this.get("el").attr("aria-haspopup","true").append(g.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetHtml:function(a){c.superclass._uiSetHtml.call(this,a);this.get("el").append(g.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},"Menu_SubMenu_Render")},{requires:["component","./menuitemRender"]});
