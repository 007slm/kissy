/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("menu/menu",function(h,f,g,e){var c;c=f.create(g.ModelControl,[f.Position,f.Align],{_bindMenuItem:function(a){var b=this;a.on("afterSelectedChange",function(d){d.newVal&&b.set("selectedItem",this)});a.on("afterHighlightedChange",function(d){d.newVal&&b.set("highlightedItem",this)});a.on("menuItemSelected",function(){b.fire("menuItemSelected")})},_uiSetSelectedItem:function(a,b){b.prevVal&&b.prevVal.set("selected",false);a.set("selected",true)},_uiSetHighlightedItem:function(a,b){b&&b.prevVal&&
b.prevVal.set("highlighted",false);a&&a.set("highlighted",true);this.get("view").set("highlightedItem",a)},_handleBlur:function(){if(c.superclass._handleBlur.call(this)===false)return false;this.set("highlightedItem",null)},_getNextEnabledHighlighted:function(a,b){var d=this.get("children");if(d.length==0)return null;if(!d[a].get("disabled"))return d[a];var i=a;for(a+=b;a!=i;){if(!d[a].get("disabled"))return d[a];a+=b;if(a==-1)a=d.length-1;else if(a==d.length)a=0}return null},_handleKeydown:function(a){if(c.superclass._handleKeydown.call(this,
a)===false)return false;var b=this.get("highlightedItem");if(b&&b._handleKeydown)if(b._handleKeydown(a)===false)return false;var d=this.get("children");if(d.length!==0)if(a.keyCode==38){if(b){b=h.indexOf(b,d);d=b==0?d.length-1:b-1;this.set("highlightedItem",this._getNextEnabledHighlighted(d,-1))}else this.set("highlightedItem",this._getNextEnabledHighlighted(d.length-1,-1));a.preventDefault();return false}else if(a.keyCode==40){if(b){b=h.indexOf(b,d);d=b==d.length-1?0:b+1;this.set("highlightedItem",
this._getNextEnabledHighlighted(d,1))}else this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));a.preventDefault();return false}},bindUI:function(){var a=this;h.each(this.get("children"),function(b){a._bindMenuItem(b)})},_uiSetFocusable:function(a){this.get("view").set("focusable",a)}},{ATTRS:{highlightedItem:{},selectedItem:{},focusable:{value:true}}});c.DefaultRender=e;return c},{requires:["uibase","component","./menurender"]});
KISSY.add("menu/menuitem",function(h,f,g,e){var c=f.create(g.ModelControl,{_uiSetHighlighted:function(a){this.get("view").set("highlighted",a)},_uiSetSelected:function(a){this.get("view").set("selected",a)},_uiSetContent:function(a){this.get("view").set("content",a)},_handleMouseEnter:function(){if(c.superclass._handleMouseEnter.call(this)===false)return false;this.set("highlighted",true)},_handleMouseLeave:function(){if(c.superclass._handleMouseLeave.call(this)===false)return false;this.set("highlighted",
false)},_handleClickInternal:function(){this.set("selected",true);this.fire("menuItemSelected")},_handleClick:function(){if(c.superclass._handleClick.call(this)===false)return false;this._handleClickInternal.apply(this,arguments)}},{ATTRS:{content:{},highlighted:{value:false},selected:{value:false}}});c.DefaultRender=e;return c},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(h,f,g){return f.create(g.Render,{renderUI:function(){this.get("el").html("<div class='"+this.get("prefixCls")+"menuitem-content'>");this.get("el").attr("role","menuitem");this.get("el").unselectable()},_uiSetContent:function(e){var c=this.get("el").children("div");c.item(c.length-1).html(e)},_uiSetDisabled:function(e){var c=this.get("el");e?c.addClass(this.get("prefixCls")+"menuitem-disabled"):c.removeClass(this.get("prefixCls")+"menuitem-disabled");c.attr("aria-disabled",
!!e)},_uiSetHighlighted:function(e){e?this.get("el").addClass(this.get("prefixCls")+"menuitem-highlight"):this.get("el").removeClass(this.get("prefixCls")+"menuitem-highlight")},_handleMouseDown:function(){this.get("el").addClass(this.get("prefixCls")+"menuitem-active");this.get("el").attr("aria-pressed",true)},_handleMouseUp:function(){this.get("el").removeClass(this.get("prefixCls")+"menuitem-active");this.get("el").attr("aria-pressed",false)},_handleKeydown:function(){}},{ATTRS:{elCls:{valueFn:function(){return this.get("prefixCls")+
"menuitem"}},highlighted:{},prefixCls:{value:"goog-"},content:{}},HTML_PARSER:{content:function(e){return e.html()}}})},{requires:["uibase","component"]});
KISSY.add("menu/menurender",function(h,f,g,e){return g.create(e.Render,[g.Contentbox.Render,g.Position.Render,f.ie===6?g.Shim.Render:null],{renderUI:function(){var c=this.get("el");c.attr("role","menu");c.attr("aria-haspopup",true)},_uiSetHighlightedItem:function(c){var a=this.get("el");if(c){c=c.get("view").get("el");var b=c.attr("id");b||c.attr("id",b=h.guid("ks-menuitem"));a.attr("aria-activedescendant",b)}else a.attr("aria-activedescendant"," ")},_uiSetDisabled:function(c){if(this.get("focusable"))this.get("el").attr("tabindex",
c?-1:0)},_uiSetFocusable:function(c){if(!this.get("disabled"))if(!c){this.get("el").unselectable();this.get("el").attr("onmousedown","return false;")}},_handleKeydown:function(){}},{ATTRS:{highlightedItem:{},elCls:{valueFn:function(){return this.get("prefixCls")+"menu "+this.get("prefixCls")+"menu-vertical"}},prefixCls:{value:"goog-"},focusable:{value:true}}})},{requires:["ua","uibase","component"]});
KISSY.add("menu/submenu",function(h,f,g,e){var c;c=f.create(g,{_handleMouseLeave:function(a){if(g.superclass._handleMouseLeave.call(this,a)===false)return false;var b=this.get("menu");b&&b.get("visible")&&(b.get("view").get("el").contains(a.relatedTarget)||b.get("view").get("el")[0]==a.relatedTarget[0])||this.set("highlighted",false)},_uiSetHighlighted:function(a){c.superclass._uiSetHighlighted.call(this,a);if(!a)(a=this.get("menu"))&&a.hide()},bindUI:function(){var a=this,b=a.get("parent"),d=this.get("menu");
if(b){b.on("hide",function(){a.get("menu")&&a.get("menu").hide()});d.on("menuItemSelected",function(){b.set("selectedItem",d.get("selectedItem"));b.fire("menuItemSelected")});d.get("view").on("afterHighlightedItemChange",function(i){b.get("view").set("highlightedItem",i.newVal)})}},_handleMouseEnter:function(){if(c.superclass._handleMouseEnter.call(this)===false)return false;this._showSubMenu()},_showSubMenu:function(){var a=this.get("menu");a.set("align",{node:this.get("view").get("el"),points:["tr",
"tl"]});a.render();a.show()},_hideSubMenu:function(){var a=this.get("menu");a&&a.hide()},_handleClick:function(){if(g.superclass._handleClick.call(this)===false)return false;if(arguments.length==0){var a=this.get("menu");if(a&&a.get("visible")&&a.get("highlightedItem"))return}this._handleClickInternal()},_handleKeydown:function(a){if(c.superclass._handleKeydown.call(this,a)===false)return false;if(a.keyCode==27)this._hideSubMenu();else{var b=this.get("menu");if(b&&b.get("visible"))if(b._handleKeydown(a)===
false)return false;if(a.keyCode==39&&(!b||!b.get("visible"))){this._showSubMenu();a=b.get("children");a[0]&&a[0].set("highlighted",true);return false}else if(a.keyCode==37&&b&&b.get("visible")){this._hideSubMenu();return false}}}},{ATTRS:{menu:{setter:function(a){a.set("focusable",false)}}}});c.DefaultRender=e;return c},{requires:["uibase","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(h,f,g){return f.create(g,{renderUI:function(){this.get("el").addClass(this.get("prefixCls")+"submenu")},_uiSetContent:function(e){this.get("el").one("."+this.get("prefixCls")+"menuitem-content").html(e+h.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},{})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(h,f,g,e,c,a,b){f.Render=g;f.Item=e;f.Item.Render=c;f.SubMenu=a;a.Render=b;return f},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender"]});
