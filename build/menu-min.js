/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 29 12:06
*/
KISSY.add("menu/base",function(f,e,g,b){function a(){this.set("highlightedItem",void 0)}var d=e.KeyCodes,c=g.Container.extend({_uiSetHighlightedItem:function(a,h){var d=h&&h.prevVal;d&&d.set("highlighted",!1);a&&a.set("highlighted",!0);this.set("activeItem",a)},handleBlur:function(a){c.superclass.handleBlur.call(this,a);this.set("highlightedItem",void 0)},_getNextEnabledHighlighted:function(a,h){var d=this.get("children"),b=d.length,i=a;do{var c=d[a];if(!c.get("disabled")&&!1!==c.get("visible"))return d[a];
a=(a+h+b)%b}while(a!=i)},handleKeydown:function(a){if(this.handleKeyEventInternal(a))return a.halt(),!0},handleKeyEventInternal:function(a){var h=this.get("highlightedItem");if(h&&h.handleKeydown(a))return!0;var b=this.get("children"),c=b.length;if(0!==c){switch(a.keyCode){case d.ESC:return;case d.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case d.END:this.set("highlightedItem",this._getNextEnabledHighlighted(c-1,-1));break;case d.UP:h?(a=f.indexOf(h,b),c=(a-1+c)%c):
c-=1;this.set("highlightedItem",this._getNextEnabledHighlighted(c,-1));break;case d.DOWN:h?(a=f.indexOf(h,b),c=(a+1+c)%c):c=0;this.set("highlightedItem",this._getNextEnabledHighlighted(c,1));break;default:return}return!0}},bindUI:function(){this.on("hide",a,this)},containsElement:function(a){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(a))return!0;for(var d=this.get("children"),c=0,b=d.length;c<b;c++){var i=d[c];if("function"==typeof i.containsElement&&
i.containsElement(a))return!0}return!1}},{ATTRS:{visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:!0}},DefaultRender:b},{xclass:"menu",priority:10});return c},{requires:["event","component","./menuRender","./submenu"]});
KISSY.add("menu/filtermenu",function(f,e,g){var b=e.extend({bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleMouseEnter:function(){b.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a=this.get("view").get("filterInput"),d=this.get("highlightedItem");this.set("filterStr",a.val());(!d||!d.get("visible"))&&this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},_uiSetFilterStr:function(a){this.filterItems(a)},
filterItems:function(a){var d=this.get("view"),c=d.get("labelEl"),d=d.get("filterInput");c[a?"hide":"show"]();if(this.get("allowMultiple")){var c=[],b;b=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var h=[];b&&(h=b[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(c=[],b&&(c=h,b=h[h.length-1],(h=(h=this.get("highlightedItem"))&&h.get("html"))&&-1<h.indexOf(b)&&b&&(c[c.length-1]=h),d.val(c.join(",")+",")),a=""):(b&&(a=b[2]||""),c=h);this.get("enteredItems").length!=c.length&&this.set("enteredItems",c)}var d=
this.get("children"),e=a&&RegExp(a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),g=this.getCssClassWithPrefix("menuitem-hit");f.each(d,function(i){var b=i.get("html");a?-1<b.indexOf(a)?(i.set("visible",!0),i.get("el").html(b.replace(e,function(a){return"<span class='"+g+"'>"+a+"</span>"}))):i.set("visible",!1):(i.get("el").html(b),i.set("visible",!0))})},decorateInternal:function(a){this.set("el",a);this.decorateChildren(a.one("."+this.getCssClassWithPrefix("menu-content")))},
reset:function(){var a=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{label:{view:!0},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1}},DefaultRender:g},{xclass:"filtermenu",priority:20});return b},{requires:["./base","./filtermenuRender"]});
KISSY.add("menu/filtermenuRender",function(f,e,g){var b=e.all;return g.extend({getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var a=g.prototype.getContentElement.call(this),d=this.get("filterWrap");d||this.set("filterWrap",d=b("<div class='"+this.getCssClassWithPrefix("menu-filter")+"'/>").appendTo(a));this.get("labelEl")||this.set("labelEl",b("<div class='"+this.getCssClassWithPrefix("menu-filter-label")+
"'/>").appendTo(d));this.get("filterInput")||this.set("filterInput",b("<input autocomplete='off'/>").appendTo(d));this.get("menuContent")||this.set("menuContent",b("<div class='"+this.getCssClassWithPrefix("menu-content")+"'/>").appendTo(a))},_uiSetLabel:function(a){this.get("labelEl").html(a)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(a){return a.one("."+this.getCssClassWithPrefix("menu-filter")).one("."+this.getCssClassWithPrefix("menu-filter-label"))},filterWrap:function(a){return a.one("."+
this.getCssClassWithPrefix("menu-filter"))},menuContent:function(a){return a.one("."+this.getCssClassWithPrefix("menu-content"))},filterInput:function(a){return a.one("."+this.getCssClassWithPrefix("menu-filter")).one("input")}}})},{requires:["node","./menuRender"]});KISSY.add("menu",function(f,e,g,b,a,d,c,j,h,l,k,i){e.Render=g;e.Item=b;b.Render=a;e.SubMenu=d;d.Render=c;e.Separator=j;e.PopupMenu=l;l.Render=k;e.FilterMenu=i;return e},{requires:"menu/base,menu/menuRender,menu/menuitem,menu/menuitemRender,menu/submenu,menu/submenuRender,menu/separator,menu/separatorRender,menu/popupmenu,menu/popupmenuRender,menu/filtermenu".split(",")});
KISSY.add("menu/menuRender",function(f,e,g){return g.Render.extend({renderUI:function(){var b=this.get("el");b.attr("role","menu").attr("aria-haspopup",!0);b.attr("id")||b.attr("id",f.guid("ks-menu"))},_uiSetActiveItem:function(b){var a=this.get("el");b?(b=b.get("el").attr("id"),a.attr("aria-activedescendant",b)):a.attr("aria-activedescendant","")},containsElement:function(b){var a=this.get("el");return a[0]===b||a.contains(b)}},{ATTRS:{activeItem:{}}})},{requires:["ua","component"]});
KISSY.add("menu/menuitem",function(f,e,g){var b=f.all,a=e.Controller.extend({handleMouseEnter:function(b){if(a.superclass.handleMouseEnter.call(this,b))return!0;this.get("parent").set("highlightedItem",this)},handleMouseLeave:function(b){if(a.superclass.handleMouseLeave.call(this,b))return!0;this.get("parent").set("highlightedItem",null)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.get("checkable")&&this.set("checked",!this.get("checked"));this.get("parent").fire("click",
{target:this});return!0},_uiSetHighlighted:function(a){if(a){var a=this.get("el"),c=a.parent(function(a){return"visible"!=b(a).css("overflow")},this.get("parent").get("el").parent());c&&a.scrollIntoView(c,void 0,void 0,!0)}},containsElement:function(a){return this.get("view")&&this.get("view").containsElement(a)}},{ATTRS:{focusable:{value:!1},visibleMode:{value:"display"},handleMouseEvents:{value:!1},selectable:{view:!0},checkable:{view:!0},value:{},checked:{view:!0},selected:{view:!0},content:{getter:function(){return this.get("html")},
setter:function(a){return this.set("html",a)}}},HTML_PARSER:{selectable:function(a){var b=this.getCssClassWithPrefix("menuitem-selectable");return a.hasClass(b)}},DefaultRender:g},{xclass:"menuitem",priority:10});return a},{requires:["component","./menuitemRender"]});
KISSY.add("menu/menuitemRender",function(f,e,g){return g.Render.extend({_uiSetChecked:function(b){var a=this.get("el"),d=this.getComponentCssClassWithState("-checked");a[b?"addClass":"removeClass"](d)},_uiSetSelected:function(b){var a=this.get("el"),d=this.getComponentCssClassWithState("-selected");a[b?"addClass":"removeClass"](d)},_uiSetSelectable:function(b){this.get("el").attr("role",b?"menuitemradio":"menuitem")},_uiSetCheckable:function(b){if(b){var a=this.get("el"),d=this.getCssClassWithPrefix("menuitem-checkbox"),
c=a.one("."+d);c||(c=(new e("<div class='"+d+"'/>")).prependTo(a),c.unselectable())}this.get("el").attr("role",b?"menuitemcheckbox":"menuitem")},containsElement:function(b){var a=this.get("el");return a[0]==b||a.contains(b)}},{ATTRS:{elAttrs:{valueFn:function(){return{role:"menuitem",id:f.guid("ks-menuitem")}}},selected:{},checked:{}}})},{requires:["node","component"]});
KISSY.add("menu/popupmenu",function(f,e,g,b){function a(a){var b=a.get("parent"),c;b&&b.get("menu")==a&&(c=b.get("parent"));return c}function d(b){return(b=a(b))&&b.get(c)?b:0}var c="autoHideOnMouseLeave",e=e.UIBase,j=g.extend([e.ContentBox,e.Position,e.Align],{_clearLeaveHideTimers:function(){var a,b,d;if(this.get(c)){if(a=this._leaveHideTimer)clearTimeout(a),this._leaveHideTimer=0;var i=this.get("children");for(a=0;a<i.length;a++)b=i[a],(d=b.get("menu"))&&!f.isFunction(d)&&d.get(c)&&d._clearLeaveHideTimers()}},
handleMouseLeave:function(){var b=this,e;b.get(c)&&(b._leaveHideTimer=setTimeout(function(){b.hide();var c=b.get("parent"),i;c&&(i=a(b))&&i.get("highlightedItem")===c&&i.set("highlightedItem",null)},b.get("autoHideDelay")),(e=d(b))&&e.handleMouseLeave())},handleMouseEnter:function(){if(this.get(c)){var a=d(this);a&&a.handleMouseEnter();this._clearLeaveHideTimers()}},handleBlur:function(){j.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},visibleMode:{value:"visibility"},
autoHideOnMouseLeave:{},autoHideDelay:{value:0.1}},DefaultRender:b},{xclass:"popupmenu",priority:20});return j},{requires:["component","./base","./popupmenuRender"]});KISSY.add("menu/popupmenuRender",function(f,e,g,b){f=g.UIBase;return b.extend([f.ContentBox.Render,f.Position.Render,6===e.ie?f.Shim.Render:null])},{requires:["ua","component","./menuRender"]});
KISSY.add("menu/separator",function(f,e,g){return e.Controller.extend({},{ATTRS:{focusable:{value:!1},disabled:{value:!0},handleMouseEvents:{value:!1}},DefaultRender:g},{xclass:"menuseparator",priority:20})},{requires:["component","./separatorRender"]});KISSY.add("menu/separatorRender",function(f,e){return e.Render.extend({createDom:function(){this.get("el").attr("role","separator")}})},{requires:["component"]});
KISSY.add("menu/submenu",function(f,e,g,b,a){function d(a,b){var c=a.get("parent");c&&(c.on("hide",a._onParentHide,a),b.on("click",function(a){c.fire("click",{target:a.target})}),c.__bindDocClickToHide||(e.on(l,"click",j,a),c.__bindDocClickToHide=1,b.__bindDocClickToHide=1),b.on("afterActiveItemChange",function(a){c.set("activeItem",a.newVal)}));b.on("beforeHighlightedItemChange",a.onChildHighlight_,a)}function c(a,b){var c=a.get("menu");if(f.isFunction(c))if(b)c=c.call(a),a.__set("menu",c);else return null;
else c=g.create(c,a),a.__set("menu",c);c&&c.get("parent")!==a&&(c.__set("parent",a),d(a,c));return c}function j(a){var b=c(this),a=a.target,d=this.get("parent");this.get("el");d.containsElement(a)||(b&&b.hide(),this.get("parent").set("highlightedItem",null))}var h=e.KeyCodes,l=f.Env.host.document,k=b.extend([g.DecorateChild],{_onParentHide:function(){var a=c(this);a&&a.hide()},handleMouseEnter:function(a){if(k.superclass.handleMouseEnter.call(this,a))return!0;this.clearTimers();this.showTimer_=f.later(this.showMenu,
this.get("menuDelay"),!1,this)},showMenu:function(){var a=c(this,1);a&&(a.set("align",f.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign"))),a.render(),this.get("el").attr("aria-haspopup",a.get("el").attr("id")),a.show())},clearTimers:function(){this.dismissTimer_&&(this.dismissTimer_.cancel(),this.dismissTimer_=null);this.showTimer_&&(this.showTimer_.cancel(),this.showTimer_=null);var a=c(this);a&&a._leaveHideTimer&&(clearTimeout(a._leaveHideTimer),a._leaveHideTimer=0)},onChildHighlight_:function(a){a.newVal&&
(this.clearTimers(),this.get("parent").set("highlightedItem",this))},hideMenu:function(){var a=c(this);a&&a.hide()},performActionInternal:function(){this.clearTimers();this.showMenu();k.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(a){var b=c(this),d=b&&b.get("visible"),f=a.keyCode;if(d){if(!b.handleKeydown(a))if(f==h.LEFT)this.hideMenu(),this.get("parent").set("activeItem",this);else return}else if(f==h.RIGHT){if(this.showMenu(),b=c(this))a=b.get("children"),a[0]&&
b.set("highlightedItem",a[0])}else{if(a.keyCode==e.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},_uiSetHighlighted:function(a,b){k.superclass._uiSetHighlighted.call(this,a,b);a||(this.clearTimers(),this.dismissTimer_=f.later(this.hideMenu,this.get("menuDelay"),!1,this))},containsElement:function(a){var b=c(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("visibility","hidden");f.one(b[0].ownerDocument.body).prepend(b);this.__set("menu",new a({srcNode:b,
prefixCls:this.get("prefixCls")}))},destructor:function(){var a=this.get("parent"),b=c(this);this.clearTimers();b&&b.__bindDocClickToHide&&(b.__bindDocClickToHide=0,e.remove(l,"click",j,this));a&&a.detach("hide",this._onParentHide,this);b&&!this.get("externalSubMenu")&&b.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:!1},menuAlign:{},menu:{},decorateChildCls:{value:"popupmenu"}},DefaultRender:a},{xclass:"submenu",priority:20});return k},{requires:["event","component","./menuitem",
"./submenuRender"]});KISSY.add("menu/submenuRender",function(f,e){var g;return g=e.extend({renderUI:function(){this.get("el").attr("aria-haspopup","true").append(f.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetHtml:function(b){g.superclass._uiSetHtml.call(this,b);this.get("el").append(f.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["./menuitemRender"]});
