/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Feb 10 15:00
*/
KISSY.add("menu/base",function(m,i,j,n,f){function d(){this.set("highlightedItem",undefined)}var a=i.KeyCodes,e=j.create(n.Container,{_uiSetHighlightedItem:function(g,c){var h=c&&c.prevVal;h&&h.set("highlighted",false);g&&g.set("highlighted",true);this.set("activeItem",g)},_handleBlur:function(g){e.superclass._handleBlur.call(this,g);this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(g,c){var h=this.get("children"),l=h.length,b=g;do{var k=h[g];if(!k.get("disabled")&&k.get("visible")!==
false)return h[g];g=(g+c+l)%l}while(g!=b)},_handleKeydown:function(g){if(this._handleKeyEventInternal(g)){g.halt();return true}},_handleKeyEventInternal:function(g){var c=this.get("highlightedItem");if(c&&c._handleKeydown(g))return true;var h=this.get("children"),l=h.length;if(l!==0){switch(g.keyCode){case a.ESC:return;case a.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case a.END:this.set("highlightedItem",this._getNextEnabledHighlighted(l-1,-1));break;case a.UP:if(c){g=
m.indexOf(c,h);l=(g-1+l)%l}else l=l-1;this.set("highlightedItem",this._getNextEnabledHighlighted(l,-1));break;case a.DOWN:if(c){g=m.indexOf(c,h);l=(g+1+l)%l}else l=0;this.set("highlightedItem",this._getNextEnabledHighlighted(l,1));break;default:return}return true}},bindUI:function(){this.on("hide",d,this)},containsElement:function(g){if(this.get("visible")===false||!this.get("view"))return false;if(this.get("view").containsElement(g))return true;for(var c=this.get("children"),h=0,l=c.length;h<l;h++){var b=
c[h];if(typeof b.containsElement=="function"&&b.containsElement(g))return true}return false}},{ATTRS:{focusable:{value:true},visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:true}},DefaultRender:f});n.UIStore.setUIByClass("menu",{priority:n.UIStore.PRIORITY.LEVEL1,ui:e});return e},{requires:["event","uibase","component","./menurender","./submenu"]});
KISSY.add("menu/delmenuitem",function(m,i,j,n,f,d){function a(c){var h=c.get("parent");if(h.fire("beforeDelete",{target:c})!==false){h.removeChild(c,true);h.set("highlightedItem",null);h.fire("delete",{target:c})}}var e=i.all;m=d.CLS;var g=d.DEL_CLS;j=j.create(f,{_performInternal:function(c){if(e(c.target).hasClass(this.getCls(g))){a(this);return true}return f.prototype._performInternal.call(this,c)},_handleKeydown:function(c){if(c.keyCode===i.KeyCodes.D){a(this);return true}}},{ATTRS:{delTooltip:{view:true}},
DefaultRender:d});n.UIStore.setUIByClass(m,{priority:n.UIStore.PRIORITY.LEVEL4,ui:j});return j},{requires:["node","uibase","component","./menuitem","./delmenuitemrender"]});
KISSY.add("menu/delmenuitemrender",function(m,i,j,n,f){function d(e){e.get("contentEl").append(m.substitute(a,{prefixCls:e.get("prefixCls"),tooltip:e.get("delTooltip")}))}var a='<span class="{prefixCls}menuitem-delete" title="{tooltip}">X</span>';return j.create(f,{createDom:function(){d(this)},_uiSetContent:function(e){f.prototype._uiSetContent.call(this,e);d(this)},_uiSetDelTooltip:function(){this._uiSetContent(this.get("content"))}},{ATTRS:{delTooltip:{}},HTML_PARSER:{delEl:function(e){return e.one(this.getCls("menuitem-delete"))}},
CLS:"menuitem-deletable",DEL_CLS:"menuitem-delete"})},{requires:["node","uibase","component","./menuitemrender"]});
KISSY.add("menu/filtermenu",function(m,i,j,n,f){var d=i.create(n,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},_handleMouseEnter:function(){d.superclass._handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a=this.get("view").get("filterInput"),e=this.get("highlightedItem");this.set("filterStr",a.val());if(!e||!e.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},
_uiSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var e=this.get("view"),g=e.get("labelEl");e=e.get("filterInput");g[a?"hide":"show"]();if(this.get("allowMultiple")){g=[];var c;c=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var h=[];if(c)h=c[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(a)){g=[];if(c){g=h;c=h[h.length-1];if((h=(h=this.get("highlightedItem"))&&h.get("content"))&&h.indexOf(c)>-1&&c)g[g.length-1]=h;e.val(g.join(",")+",")}a=""}else{if(c)a=c[2]||"";g=h}this.get("enteredItems").length!=
g.length&&this.set("enteredItems",g)}e=this.get("children");var l=a&&RegExp(a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),b=this.getCls("menuitem-hit");m.each(e,function(k){var o=k.get("content");if(a)if(o.indexOf(a)>-1){k.set("visible",true);k.get("contentEl").html(o.replace(l,function(p){return"<span class='"+b+"'>"+p+"</span>"}))}else k.set("visible",false);else{k.get("contentEl").html(o);k.set("visible",true)}})},decorateInternal:function(a){this.set("el",a);
this.decorateChildren(a.one("."+this.getCls("menu-content")))},reset:function(){var a=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:f});j.UIStore.setUIByClass("filtermenu",{priority:j.UIStore.PRIORITY.LEVEL2,ui:d});return d},{requires:["uibase",
"component","./base","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(m,i,j,n){var f=i.all;return j.create(n,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var d=n.prototype.getContentElement.call(this),a=this.get("filterWrap");a||this.set("filterWrap",a=f("<div class='"+this.getCls("menu-filter")+"'/>").appendTo(d));this.get("labelEl")||this.set("labelEl",f("<div class='"+this.getCls("menu-filter-label")+"'/>").appendTo(a));this.get("filterInput")||
this.set("filterInput",f("<input autocomplete='off'/>").appendTo(a));this.get("menuContent")||this.set("menuContent",f("<div class='"+this.getCls("menu-content")+"'/>").appendTo(d))},_uiSetLabel:function(d){this.get("labelEl").html(d)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(d){return d.one("."+this.getCls("menu-filter")).one("."+this.getCls("menu-filter-label"))},filterWrap:function(d){return d.one("."+this.getCls("menu-filter"))},menuContent:function(d){return d.one("."+this.getCls("menu-content"))},
filterInput:function(d){return d.one("."+this.getCls("menu-filter")).one("input")}}})},{requires:["node","uibase","./menurender"]});
KISSY.add("menu",function(m,i,j,n,f,d,a,e,g,c,h,l){i.Render=j;i.Item=n;i.Item.Render=f;i.SubMenu=d;d.Render=a;i.Separator=e;i.PopupMenu=c;i.FilterMenu=h;i.DelMenuItem=l;return i},{requires:["menu/base","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/filtermenu","menu/delmenuitem","menu/delmenuitemrender"]});
KISSY.add("menu/menuitem",function(m,i,j,n){var f=m.all,d=i.create(j.ModelControl,[i.ContentBox],{_handleMouseEnter:function(a){if(d.superclass._handleMouseEnter.call(this,a))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(a){if(d.superclass._handleMouseLeave.call(this,a))return true;this.get("parent").set("highlightedItem",undefined)},_performInternal:function(){this.get("selectable")&&this.set("selected",true);this.get("checkable")&&this.set("checked",!this.get("checked"));
this.get("parent").fire("click",{target:this});return true},_uiSetChecked:function(a){this._forwardSetAttrToView("checked",a)},_uiSetSelected:function(a){this._forwardSetAttrToView("selected",a)},_uiSetHighlighted:function(a){d.superclass._uiSetHighlighted.apply(this,arguments);if(a){var e=this.get("el"),g=e.parent(function(c){return f(c).css("overflow")!="visible"},this.get("parent").get("el").parent());g&&e.scrollIntoView(g,undefined,undefined,true)}},containsElement:function(a){return this.get("view")&&
this.get("view").containsElement(a)}},{ATTRS:{focusable:{value:false},visibleMode:{value:"display"},handleMouseEvents:{value:false},selectable:{view:true},checkable:{view:true},value:{},checked:{},selected:{}},HTML_PARSER:{selectable:function(a){var e=this.getCls("menuitem-selectable");return a.hasClass(e)}}});d.DefaultRender=n;j.UIStore.setUIByClass("menuitem",{priority:j.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(m,i,j,n){return j.create(n.Render,[j.ContentBox.Render],{_setSelected:function(f,d){var a=this.get("el"),e=this._completeClasses(d,"-selected");a[f?"addClass":"removeClass"](e)},_setChecked:function(f,d){var a=this.get("el"),e=this._completeClasses(d,"-checked");a[f?"addClass":"removeClass"](e)},_uiSetSelectable:function(f){this.get("el").attr("role",f?"menuitemradio":"menuitem")},_uiSetCheckable:function(f){if(f){var d=this.get("el"),a=this.getCls("menuitem-checkbox"),
e=d.one("."+a);if(!e){e=(new i("<div class='"+a+"'/>")).prependTo(d);e.unselectable()}}this.get("el").attr("role",f?"menuitemcheckbox":"menuitem")},containsElement:function(f){var d=this.get("el");return d[0]==f||d.contains(f)}},{ATTRS:{contentElCls:{valueFn:function(){return this.getCls("menuitem-content")}},elAttrs:{valueFn:function(){return{role:"menuitem",id:m.guid("ks-menuitem")}}},selected:{},checked:{}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(m,i,j,n){return j.create(n.Render,[j.ContentBox.Render],{renderUI:function(){var f=this.get("el");f.attr("role","menu").attr("aria-haspopup",true);f.attr("id")||f.attr("id",m.guid("ks-menu"))},_uiSetActiveItem:function(f){var d=this.get("el");if(f){f=f.get("el").attr("id");d.attr("aria-activedescendant",f)}else d.attr("aria-activedescendant","")},containsElement:function(f){var d=this.get("el");return d[0]===f||d.contains(f)}},{ATTRS:{activeItem:{}}})},{requires:["ua",
"uibase","component"]});
KISSY.add("menu/popupmenu",function(m,i,j,n,f){function d(c){var h=c.get("parent"),l;if(h&&h.get("menu")==c)l=h.get("parent");return l}function a(c){if((c=d(c))&&c.get(e))return c;return 0}var e="autoHideOnMouseLeave",g=i.create(n,[i.Position,i.Align],{_clearLeaveHideTimers:function(){var c,h,l;if(this.get(e)){if(c=this._leaveHideTimer){clearTimeout(c);this._leaveHideTimer=0}var b=this.get("children");for(c=0;c<b.length;c++){h=b[c];if((l=h.get("menu"))&&!m.isFunction(l)&&l.get(e))l._clearLeaveHideTimers()}}},_handleMouseLeave:function(){var c=
this,h;if(c.get(e)){c._leaveHideTimer=setTimeout(function(){c.hide();var l=c.get("parent"),b;if(l)(b=d(c))&&b.get("highlightedItem")===l&&b.set("highlightedItem",null)},c.get("autoHideDelay"));(h=a(c))&&h._handleMouseLeave()}},_handleMouseEnter:function(){if(this.get(e)){var c=a(this);c&&c._handleMouseEnter();this._clearLeaveHideTimers()}},_handleBlur:function(){g.superclass._handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"},autoHideOnMouseLeave:{},
autoHideDelay:{value:100}},DefaultRender:f});j.UIStore.setUIByClass("popupmenu",{priority:j.UIStore.PRIORITY.LEVEL2,ui:g});return g},{requires:["uibase","component","./base","./popupmenurender"]});KISSY.add("menu/popupmenurender",function(m,i,j,n){return j.create(n,[j.Position.Render,i.ie===6?j.Shim.Render:null])},{requires:["ua","uibase","./menurender"]});
KISSY.add("menu/separator",function(m,i,j,n){m=i.create(j.ModelControl,{},{ATTRS:{focusable:{value:false},disabled:{value:true},handleMouseEvents:{value:false}},DefaultRender:n});j.UIStore.setUIByClass("menuseparator",{priority:j.UIStore.PRIORITY.LEVEL2,ui:m});return m},{requires:["uibase","component","./separatorrender"]});KISSY.add("menu/separatorrender",function(m,i,j){return i.create(j.Render,{createDom:function(){this.get("el").attr("role","separator")}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(m,i,j,n,f,d){function a(b,k){var o=b.get("parent");if(o){o.on("hide",b._onParentHide,b);k.on("click",function(p){o.fire("click",{target:p.target})});if(!o.__bindDocClickToHide){i.on(h,"click",g,b);o.__bindDocClickToHide=1;k.__bindDocClickToHide=1}k.on("afterActiveItemChange",function(p){o.set("activeItem",p.newVal)})}k.on("beforeHighlightedItemChange",b.onChildHighlight_,b)}function e(b,k){var o=b.get("menu");if(m.isFunction(o))if(k){o=o.call(b);b.__set("menu",o)}else return null;
if(o&&o.get("parent")!==b){o.__set("parent",b);a(b,o)}return o}function g(b){var k=e(this);b=b.target;var o=this.get("parent");this.get("el");if(!o.containsElement(b)){k&&k.hide();this.get("parent").set("highlightedItem",null)}}var c=i.KeyCodes,h=document,l=j.create(f,[n.DecorateChild],{_onParentHide:function(){var b=e(this);b&&b.hide()},_handleMouseEnter:function(b){if(l.superclass._handleMouseEnter.call(this,b))return true;this.clearTimers();this.showTimer_=m.later(this.showMenu,this.get("menuDelay"),
false,this)},showMenu:function(){var b=e(this,1);if(b){b.set("align",m.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign")));b.render();this.get("el").attr("aria-haspopup",b.get("el").attr("id"));b.show()}},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}var b=e(this);if(b&&b._leaveHideTimer){clearTimeout(b._leaveHideTimer);b._leaveHideTimer=0}},onChildHighlight_:function(b){if(b.newVal){this.clearTimers();
this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var b=e(this);b&&b.hide()},_performInternal:function(){this.clearTimers();this.showMenu();l.superclass._performInternal.apply(this,arguments)},_handleKeydown:function(b){var k=e(this),o=k&&k.get("visible"),p=b.keyCode;if(o){if(!k._handleKeydown(b))if(p==c.LEFT){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(p==c.RIGHT){this.showMenu();if(k=e(this)){b=k.get("children");b[0]&&k.set("highlightedItem",
b[0])}}else if(b.keyCode==i.KeyCodes.ENTER)return this._performInternal(b);else return;return true},_uiSetHighlighted:function(b,k){l.superclass._uiSetHighlighted.call(this,b,k);if(!b){this.clearTimers();this.dismissTimer_=m.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(b){var k=e(this);return k&&k.containsElement(b)},decorateChildrenInternal:function(b,k,o){k.css("visibility","hidden");m.one(k[0].ownerDocument.body).prepend(k);this.__set("menu",new b({srcNode:k,
prefixCls:o}))},destructor:function(){var b=this.get("parent"),k=e(this);this.clearTimers();if(k&&k.__bindDocClickToHide){k.__bindDocClickToHide=0;i.remove(h,"click",g,this)}b&&b.detach("hide",this._onParentHide,this);k&&!this.get("externalSubMenu")&&k.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:false},menuAlign:{},menu:{},decorateChildCls:{value:"popupmenu"}},DefaultRender:d});n.UIStore.setUIByClass("submenu",{priority:n.UIStore.PRIORITY.LEVEL2,ui:l});return l},{requires:["event",
"uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(m,i,j){var n;return n=i.create(j,{renderUI:function(){var f=this.get("el"),d=this.get("contentEl");f.attr("aria-haspopup","true");d.append(m.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetContent:function(f){n.superclass._uiSetContent.call(this,f);this.get("contentEl").append(m.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
