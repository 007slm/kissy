/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Mar 12 13:48
*/
KISSY.add("menu/base",function(h,b,e,g,c){function a(a){var c=a.newVal;a.target!=this&&this.setInternal("activeItem",c);this.get("view").set("activeItem",c)}var f=b.KeyCodes,d=e.Container.extend({isMenu:1,_onSetHighlightedItem:function(a,c){var f;a&&(f=c.prevVal)&&f.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}});this.set("activeItem",a)},_onSetVisible:function(a,c){d.superclass._onSetVisible.apply(this,arguments);var f;!a&&(f=this.get("highlightedItem"))&&f.set("highlighted",!1)},bindUI:function(){this.on("afterActiveItemChange",
a,this)},getRootMenu:function(){return this},handleMouseEnter:function(){d.superclass.handleMouseEnter.apply(this,arguments);var a=this.getRootMenu();a&&a._popupAutoHideTimer&&(clearTimeout(a._popupAutoHideTimer),a._popupAutoHideTimer=null);this.get("focusable")&&this.set("focused",!0)},handleBlur:function(a){d.superclass.handleBlur.call(this,a);var c;(c=this.get("highlightedItem"))&&c.set("highlighted",!1)},_getNextEnabledHighlighted:function(a,f){var d=this.get("children"),e=d.length,i=a;do{var n=
d[a];if(!n.get("disabled")&&!1!==n.get("visible"))return d[a];a=(a+f+e)%e}while(a!=i);return c},handleKeyEventInternal:function(a){var d=this.get("highlightedItem");if(d&&d.handleKeydown(a))return!0;var e=this.get("children"),b=e.length;if(0===b)return c;var i;switch(a.keyCode){case f.ESC:(d=this.get("highlightedItem"))&&d.set("highlighted",!1);break;case f.HOME:i=this._getNextEnabledHighlighted(0,1);break;case f.END:i=this._getNextEnabledHighlighted(b-1,-1);break;case f.UP:d?(a=h.indexOf(d,e),b=
(a-1+b)%b):b-=1;i=this._getNextEnabledHighlighted(b,-1);break;case f.DOWN:d?(a=h.indexOf(d,e),b=(a+1+b)%b):b=0,i=this._getNextEnabledHighlighted(b,1)}return i?(i.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):c},containsElement:function(a){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(a))return!0;for(var c=this.get("children"),f=0,d=c.length;f<d;f++){var i=c[f];if(i.containsElement&&i.containsElement(a))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},
activeItem:{value:null},xrender:{value:g},defaultChildXClass:{value:"menuitem"}}},{xclass:"menu",priority:10});return d},{requires:["event","component/base","./menu-render"]});
KISSY.add("menu/filtermenu-render",function(h,b,e){var g=b.all;return e.extend({getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var c=this.get("prefixCls"),a=this.get("el"),f=this.get("filterWrap");f||this.set("filterWrap",f=g("<div class='"+c+"menu-filter'/>").appendTo(a,void 0));this.get("labelEl")||this.set("labelEl",g("<div class='"+c+"menu-filter-label'/>").appendTo(f,void 0));this.get("filterInput")||
this.set("filterInput",g("<input autocomplete='off'/>").appendTo(f,void 0));this.get("menuContent")||this.set("menuContent",g("<div class='"+c+"menu-content'/>").appendTo(a,void 0))},_onSetLabel:function(c){this.get("labelEl").html(c)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(c){return c.one("."+this.get("prefixCls")+"menu-filter").one("."+this.get("prefixCls")+"menu-filter-label")},filterWrap:function(c){return c.one("."+this.get("prefixCls")+"menu-filter")},menuContent:function(c){return c.one("."+
this.get("prefixCls")+"menu-content")},filterInput:function(c){return c.one("."+this.get("prefixCls")+"menu-filter").one("input")}}})},{requires:["node","./menu-render"]});
KISSY.add("menu/filtermenu",function(h,b,e,g){var c=e.extend([b.DecorateChild],{bindUI:function(){this.get("view").get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnter:function(){c.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.get("view").get("filterInput");var c=this.get("highlightedItem");this.set("filterStr",a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&
c)c.set("highlighted",!1);else if(a&&(!c||!c.get("visible")))(c=this._getNextEnabledHighlighted(0,1))&&c.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var c=this.get("prefixCls"),d=this.get("view"),b=d.get("labelEl"),d=d.get("filterInput");b[a?"hide":"show"]();if(this.get("allowMultiple")){var b=[],e;e=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var g=[];e&&(g=e[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(b=[],e&&(b=g,e=g[g.length-1],(g=(g=this.get("highlightedItem"))&&
g.get("content"))&&-1<g.indexOf(e)&&e&&(b[b.length-1]=g),d.val(b.join(",")+",")),a=""):(e&&(a=e[2]||""),b=g);this.get("enteredItems").length!=b.length&&this.set("enteredItems",b)}var d=this.get("children"),l=a&&RegExp(h.escapeRegExp(a),"ig");h.each(d,function(i){var b=i.get("content");a?-1<b.indexOf(a)?(i.set("visible",!0),i.get("el").html(b.replace(l,function(a){return"<span class='"+c+"menuitem-hit'>"+a+"</span>"}))):i.set("visible",!1):(i.get("el").html(b),i.set("visible",!0))})},reset:function(){var a=
this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{allowTextSelection:{value:!0},label:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"menu-content"}},xrender:{value:g}}},{xclass:"filter-menu",priority:20});return c},{requires:["component/base","./base","./filtermenu-render"]});
KISSY.add("menu/menu-render",function(h,b){return b.Render.extend({renderUI:function(){var b=this.get("el");b.attr("role","menu").attr("aria-haspopup",!0);b.attr("id")||b.attr("id",h.guid("ks-menu"))},_onSetActiveItem:function(b){var g=this.get("el");b?(b=b.get("el").attr("id"),g.attr("aria-activedescendant",b)):g.attr("aria-activedescendant","")},containsElement:function(b){var g=this.get("el");return g[0]===b||g.contains(b)}},{ATTRS:{activeItem:{}}})},{requires:["component/base"]});
KISSY.add("menu",function(h,b,e,g,c,a,f,d,j,k){b.Render=e;b.Item=g;g.Render=c;b.SubMenu=a;a.Render=f;b.PopupMenu=d;d.Render=j;b.FilterMenu=k;return b},{requires:"menu/base,menu/menu-render,menu/menuitem,menu/menuitem-render,menu/submenu,menu/submenu-render,menu/popupmenu,menu/popupmenu-render,menu/filtermenu".split(",")});
KISSY.add("menu/menuitem-render",function(h,b,e,g){return e.Render.extend({createDom:function(){this.get("el").attr({role:"menuitem",id:h.guid("ks-menuitem")})},_onSetChecked:function(b){var a=this.get("el"),f=this.getCssClassWithState("checked");a[b?"addClass":"removeClass"](f)},_onSetSelected:function(b){var a=this.get("el"),f=this.getCssClassWithState("selected");a[b?"addClass":"removeClass"](f)},_onSetSelectable:function(b){this.get("el").attr("role",b?"menuitemradio":"menuitem")},_onSetCheckable:function(c){if(c){var a=
this.get("el"),f=this.get("prefixCls"),d=a.one("."+f+"menuitem-checkbox");d||(d=(new b("<div class='"+f+"menuitem-checkbox'/>")).prependTo(a),d.unselectable(g))}this.get("el").attr("role",c?"menuitemcheckbox":"menuitem")},containsElement:function(b){var a=this.get("el");return a&&(a[0]==b||a.contains(b))}},{ATTRS:{checkable:{},selected:{},checked:{}},HTML_PARSER:{selectable:function(b){var a=this.getCssClassWithPrefix("menuitem-selectable");return b.hasClass(a)},checkable:function(b){var a=this.getCssClassWithPrefix("menuitem-checkable");
return b.hasClass(a)}}})},{requires:["node","component/base"]});
KISSY.add("menu/menuitem",function(h,b,e){var g=h.all,c=b.Controller.extend({isMenuItem:1,handleMouseDown:function(a){c.superclass.handleMouseDown.call(this,a);this.set("highlighted",!0)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.get("checkable")&&this.set("checked",!this.get("checked"));this.fire("click");return!0},_onSetHighlighted:function(a,b){if(!b||!b.byPassSetHighlightedItem)this.get("parent").set("highlightedItem",a?this:null);if(a){var c=this.get("el"),
e=c.parent(function(a){return"visible"!=g(a).css("overflow")},this.get("parent").get("el").parent());e&&c.scrollIntoView(e,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.get("view")&&this.get("view").containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},checkable:{view:1},value:{},checked:{view:1},selected:{view:1},xrender:{value:e}}},{xclass:"menuitem",priority:10});return c},{requires:["component/base",
"./menuitem-render"]});KISSY.add("menu/popupmenu-render",function(h,b,e){return e.extend([b.ContentBox.Render,b.Position.Render,6===h.UA.ie?b.Shim.Render:null])},{requires:["component/extension","./menu-render"]});
KISSY.add("menu/popupmenu",function(h,b,e,g){var c=e.extend([b.ContentBox,b.Position,b.Align],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeave:function(a){c.superclass.handleMouseLeave.apply(this,arguments);var b=this.get("parent");b&&b.isSubMenu&&b.clearSubMenuTimers();if(this.get("autoHideOnMouseLeave")){var d=this.getRootMenu();d&&(clearTimeout(d._popupAutoHideTimer),d._popupAutoHideTimer=setTimeout(function(){var a;
(a=d.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlur:function(){c.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},xrender:{value:g}}},{xclass:"popupmenu",priority:20});return c},{requires:["component/extension","./base","./popupmenu-render"]});
KISSY.add("menu/submenu-render",function(h,b){return b.extend({createDom:function(){this.get("el").attr("aria-haspopup","true").append(h.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},{ATTRS:{arrowEl:{},contentEl:{valueFn:function(){return h.all(h.substitute('<span class="{prefixCls}menuitem-content"></span>',{prefixCls:this.get("prefixCls")}))}}},HTML_PARSER:{contentEl:function(b){return b.children("."+this.get("prefixCls")+"menuitem-content")}}})},
{requires:["./menuitem-render"]});
KISSY.add("menu/submenu",function(h,b,e,g,c){function a(a){a.target!==this&&a.target.isMenuItem&&a.newVal&&(f(this),a=this.get("parent").get("activeItem"),this.set("highlighted",!0),this.get("parent").set("activeItem",a))}function f(a){var b;if(b=a.dismissTimer_)b.cancel(),a.dismissTimer_=null;if(b=a.showTimer_)b.cancel(),a.showTimer_=null}function d(a,b){var c=a.get("menu");if(c&&!c.isController)if(b)c=e.create(c,a),a.setInternal("menu",c);else return null;return c}function j(){var a,b,c=d(this,
1);c&&(a=this.get("el"),b=c.get("align"),delete b.node,b=h.clone(b),b.node=a,b.points=b.points||["tr","tl"],c.set("align",b),c.show(),a.attr("aria-haspopup",c.get("el").attr("id")))}function k(){var a=d(this);a&&a.hide()}var m=b.KeyCodes,l=g.extend([e.DecorateChild],{isSubMenu:1,clearSubMenuTimers:function(){f(this)},bindUI:function(){this.on("afterHighlightedChange",a,this)},handleMouseLeave:function(){this.set("highlighted",!1,{data:{fromMouse:1}});f(this);var a=d(this);a&&a.get("visible")&&(this.dismissTimer_=
h.later(k,1E3*this.get("menuDelay"),!1,this))},handleMouseEnter:function(){this.set("highlighted",!0,{data:{fromMouse:1}});f(this);var a=d(this);if(!a||!a.get("visible"))this.showTimer_=h.later(j,1E3*this.get("menuDelay"),!1,this)},_onSetHighlighted:function(a,b){b&&(l.superclass._onSetHighlighted.apply(this,arguments),b.fromMouse||(a&&!b.fromKeyboard?j.call(this):a||k.call(this)))},performActionInternal:function(){j.call(this);l.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(a){var c=
d(this),e=c&&c.get("visible"),f=a.keyCode;if(e){if(!c.handleKeydown(a))if(f==m.LEFT)k.call(this),this.get("parent").set("activeItem",this);else return}else if(f==m.RIGHT){if(j.call(this),c=d(this))a=c.get("children"),a[0]&&a[0].set("highlighted",!0,{data:{fromKeyboard:1}})}else{if(a.keyCode==b.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},containsElement:function(a){var b=d(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("visibility","hidden");
h.one(b[0].ownerDocument.body).prepend(b);this.setInternal("menu",new a({srcNode:b,prefixCls:this.get("prefixCls")}))},destructor:function(){var a=d(this);f(this);a&&a.destroy&&a.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{setter:function(a){a&&a.isController&&a.setInternal("parent",this)}},defaultChildXClass:{value:"popupmenu"},decorateChildCls:{valueFn:function(){return this.get("prefixCls")+"popupmenu"}},xrender:{value:c}}},{xclass:"submenu",priority:20});return l},{requires:["event","component/base",
"./menuitem","./submenu-render"]});
