/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Oct 31 21:53
*/
KISSY.add("menu/delmenuitem",function(j,i,h,l,f,d){function c(e){var b=e.get("parent");if(b.fire("beforeDelete",{target:e})!==false){b.removeChild(e,true);b.set("highlightedItem",null);b.fire("delete",{target:e})}}var a=i.all;j=d.CLS;var g=d.DEL_CLS;h=h.create(f,{_performInternal:function(e){if(a(e.target).hasClass(this.getCls(g))){c(this);return true}return f.prototype._performInternal.call(this,e)},_handleKeydown:function(e){if(e.keyCode===i.KeyCodes.D){c(this);return true}}},{ATTRS:{delTooltip:{view:true}},
DefaultRender:d});l.UIStore.setUIByClass(j,{priority:l.UIStore.PRIORITY.LEVEL4,ui:h});return h},{requires:["node","uibase","component","./menuitem","./delmenuitemrender"]});
KISSY.add("menu/delmenuitemrender",function(j,i,h,l,f){function d(a){a.get("contentEl").append(j.substitute(c,{prefixCls:a.get("prefixCls"),tooltip:a.get("delTooltip")}))}var c='<span class="{prefixCls}menuitem-delete" title="{tooltip}">X</span>';return h.create(f,{createDom:function(){d(this)},_uiSetContent:function(a){f.prototype._uiSetContent.call(this,a);d(this)},_uiSetDelTooltip:function(){this._uiSetContent(this.get("content"))}},{ATTRS:{delTooltip:{}},HTML_PARSER:{delEl:function(a){return a.one(this.getCls("menuitem-delete"))}},
CLS:"menuitem-deletable",DEL_CLS:"menuitem-delete"})},{requires:["node","uibase","component","./menuitemrender"]});
KISSY.add("menu/filtermenu",function(j,i,h,l,f){var d=i.create(l,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},_handleMouseEnter:function(){d.superclass._handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var c=this.get("view").get("filterInput"),a=this.get("highlightedItem");this.set("filterStr",c.val());if(!a||!a.get("visible"))this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},
_uiSetFilterStr:function(c){this.filterItems(c)},filterItems:function(c){var a=this.get("view"),g=a.get("labelEl");a=a.get("filterInput");g[c?"hide":"show"]();if(this.get("allowMultiple")){g=[];var e;e=c.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var b=[];if(e)b=e[1].split(/[,\uff0c]/);if(/[,\uff0c]$/.test(c)){g=[];if(e){g=b;e=b[b.length-1];if((b=(b=this.get("highlightedItem"))&&b.get("content"))&&b.indexOf(e)>-1&&e)g[g.length-1]=b;a.val(g.join(",")+",")}c=""}else{if(e)c=e[2]||"";g=b}this.get("enteredItems").length!=g.length&&
this.set("enteredItems",g)}a=this.get("children");var k=c&&RegExp(c.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),m=this.getCls("menuitem-hit");j.each(a,function(n){var o=n.get("content");if(c)if(o.indexOf(c)>-1){n.set("visible",true);n.get("contentEl").html(o.replace(k,function(p){return"<span class='"+m+"'>"+p+"</span>"}))}else n.set("visible",false);else{n.get("contentEl").html(o);n.set("visible",true)}})},decorateInternal:function(c){this.set("el",c);this.decorateChildren(c.one("."+
this.getCls("menu-content")))},reset:function(){var c=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(c=c&&c.get("filterInput"))&&c.val("")},destructor:function(){var c=this.get("view");(c=c&&c.get("filterInput"))&&c.detach()}},{ATTRS:{label:{view:true},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:false}},DefaultRender:f});h.UIStore.setUIByClass("filtermenu",{priority:h.UIStore.PRIORITY.LEVEL2,ui:d});return d},{requires:["uibase","component","./menu","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(j,i,h,l){var f=i.all;return h.create(l,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var d=l.prototype.getContentElement.call(this),c=this.get("filterWrap");c||this.set("filterWrap",c=f("<div class='"+this.getCls("menu-filter")+"'/>").appendTo(d));this.get("labelEl")||this.set("labelEl",f("<div class='"+this.getCls("menu-filter-label")+"'/>").appendTo(c));this.get("filterInput")||
this.set("filterInput",f("<input autocomplete='off'/>").appendTo(c));this.get("menuContent")||this.set("menuContent",f("<div class='"+this.getCls("menu-content")+"'/>").appendTo(d))},_uiSetLabel:function(d){this.get("labelEl").html(d)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(d){return d.one("."+this.getCls("menu-filter")).one("."+this.getCls("menu-filter-label"))},filterWrap:function(d){return d.one("."+this.getCls("menu-filter"))},menuContent:function(d){return d.one("."+this.getCls("menu-content"))},
filterInput:function(d){return d.one("."+this.getCls("menu-filter")).one("input")}}})},{requires:["node","uibase","./menurender"]});
KISSY.add("menu/menu",function(j,i,h,l,f){var d=i.KeyCodes,c=h.create(l.Container,{_uiSetHighlightedItem:function(a,g){var e=g&&g.prevVal;e&&e.set("highlighted",false);a&&a.set("highlighted",true);this.set("activeItem",a)},_handleBlur:function(a){c.superclass._handleBlur.call(this,a);this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(a,g){var e=this.get("children"),b=e.length,k=a;do{var m=e[a];if(!m.get("disabled")&&m.get("visible")!==false)return e[a];a=(a+g+b)%b}while(a!=
k)},_handleKeydown:function(a){if(this._handleKeyEventInternal(a)){a.halt();return true}},_handleKeyEventInternal:function(a){var g=this.get("highlightedItem");if(g&&g._handleKeydown(a))return true;var e=this.get("children"),b=e.length;if(b!==0){switch(a.keyCode){case d.ESC:return;case d.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case d.END:this.set("highlightedItem",this._getNextEnabledHighlighted(b-1,-1));break;case d.UP:if(g){a=j.indexOf(g,e);b=(a-1+b)%b}else b=
b-1;this.set("highlightedItem",this._getNextEnabledHighlighted(b,-1));break;case d.DOWN:if(g){a=j.indexOf(g,e);b=(a+1+b)%b}else b=0;this.set("highlightedItem",this._getNextEnabledHighlighted(b,1));break;default:return}return true}},bindUI:function(){var a=this;a.on("hide",function(){a.set("highlightedItem",undefined)})},containsElement:function(a){if(this.get("view").containsElement(a))return true;for(var g=this.get("children"),e=0,b=g.length;e<b;e++){var k=g[e];if(typeof k.containsElement=="function"&&
k.containsElement(a))return true}return false}},{ATTRS:{focusable:{value:true},visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:true}},DefaultRender:f});l.UIStore.setUIByClass("menu",{priority:l.UIStore.PRIORITY.LEVEL1,ui:c});return c},{requires:["event","uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(j,i,h,l){var f=j.all,d=i.create(h.ModelControl,[i.Contentbox],{_handleMouseEnter:function(c){if(d.superclass._handleMouseEnter.call(this,c))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(c){if(d.superclass._handleMouseLeave.call(this,c))return true;this.get("parent").set("highlightedItem",undefined)},_performInternal:function(){this.get("selectable")&&this.set("selected",true);this.get("checkable")&&this.set("checked",!this.get("checked"));
this.get("parent").fire("click",{target:this});return true},_uiSetChecked:function(c){this._forwardSetAttrToView("checked",c)},_uiSetSelected:function(c){this._forwardSetAttrToView("selected",c)},_uiSetHighlighted:function(c){d.superclass._uiSetHighlighted.apply(this,arguments);if(c){var a=this.get("el"),g=a.parent(function(e){return f(e).css("overflow")!="visible"},this.get("parent").get("el").parent());g&&a.scrollIntoView(g,undefined,undefined,true)}},containsElement:function(c){return this.get("view")&&
this.get("view").containsElement(c)}},{ATTRS:{focusable:{value:false},visibleMode:{value:"display"},handleMouseEvents:{value:false},selectable:{view:true},checkable:{view:true},value:{},checked:{},selected:{}},HTML_PARSER:{selectable:function(c){var a=this.getCls("menuitem-selectable");return c.hasClass(a)}}});d.DefaultRender=l;h.UIStore.setUIByClass("menuitem",{priority:h.UIStore.PRIORITY.LEVEL1,ui:d});return d},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(j,i,h,l){return h.create(l.Render,[h.Contentbox.Render],{renderUI:function(){var f=this.get("el");f.attr("role","menuitem");this.get("contentEl").addClass(this.getCls("menuitem-content"));f.attr("id")||f.attr("id",j.guid("ks-menuitem"))},_setSelected:function(f,d){var c=this.get("el"),a=this._completeClasses(d,"-selected");c[f?"addClass":"removeClass"](a)},_setChecked:function(f,d){var c=this.get("el"),a=this._completeClasses(d,"-checked");c[f?"addClass":"removeClass"](a)},
_uiSetSelectable:function(f){this.get("el").attr("role",f?"menuitemradio":"menuitem")},_uiSetCheckable:function(f){if(f){var d=this.get("el"),c=this.getCls("menuitem-checkbox"),a=d.one("."+c);if(!a){a=(new i("<div class='"+c+"'/>")).prependTo(d);a.unselectable()}}this.get("el").attr("role",f?"menuitemcheckbox":"menuitem")},containsElement:function(f){var d=this.get("el");return d[0]==f||d.contains(f)}},{ATTRS:{selected:{},checked:{}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(j,i,h,l){return h.create(l.Render,[h.Contentbox.Render],{renderUI:function(){var f=this.get("el");f.attr("role","menu").attr("aria-haspopup",true);f.attr("id")||f.attr("id",j.guid("ks-menu"))},_uiSetActiveItem:function(f){var d=this.get("el");if(f){f=f.get("el").attr("id");d.attr("aria-activedescendant",f)}else d.attr("aria-activedescendant","")},containsElement:function(f){var d=this.get("el");return d[0]===f||d.contains(f)}},{ATTRS:{activeItem:{}}})},{requires:["ua",
"uibase","component"]});
KISSY.add("menu/popupmenu",function(j,i,h,l,f){function d(a){var g=a.get("parent"),e;if(g)if(g.get("menu")===a)e=g.get("parent");if(e.get(c))return e;return 0}var c="autoHideOnMouseLeave";j=i.create(l,[i.Position,i.Align],{_clearLeaveHideTimers:function(){var a,g,e;if(this.get(c)){if(a=this._leaveHideTimer){clearTimeout(a);this._leaveHideTimer=0}var b=this.get("children");for(a=0;a<b.length;a++){g=b[a];if((e=g.get("menu"))&&e.get(c))e._clearLeaveHideTimers()}}},_handleMouseLeave:function(){var a=this;
if(a.get(c))a._leaveHideTimer=setTimeout(function(){for(var g=a,e=a;e;){g=e;e=d(g);if(!e)break}g.hide()},a.get("autoHideDelay"))},_handleMouseEnter:function(){var a=d(this);a?a._clearLeaveHideTimers():this._clearLeaveHideTimers()}},{ATTRS:{focusable:{value:false},visibleMode:{value:"visibility"},autoHideOnMouseLeave:{},autoHideDelay:{value:100}},DefaultRender:f});h.UIStore.setUIByClass("popupmenu",{priority:h.UIStore.PRIORITY.LEVEL2,ui:j});return j},{requires:["uibase","component","./menu","./popupmenurender"]});
KISSY.add("menu/popupmenurender",function(j,i,h,l){return h.create(l,[h.Position.Render,i.ie===6?h.Shim.Render:null])},{requires:["ua","uibase","./menurender"]});KISSY.add("menu/separator",function(j,i,h,l){j=i.create(h.ModelControl,{},{ATTRS:{focusable:{value:false},disabled:{value:true},handleMouseEvents:{value:false}},DefaultRender:l});h.UIStore.setUIByClass("menuseparator",{priority:h.UIStore.PRIORITY.LEVEL2,ui:j});return j},{requires:["uibase","component","./separatorrender"]});
KISSY.add("menu/separatorrender",function(j,i,h){return i.create(h.Render,{createDom:function(){this.get("el").attr("role","separator")}})},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(j,i,h,l,f,d){function c(b){var k=this.get("menu");k.containsElement(b.target)||k.hide()}var a=i.KeyCodes,g=document,e=h.create(f,[l.DecorateChild],{_onParentHide:function(){this.get("menu")&&this.get("menu").hide()},bindUI:function(){var b=this.get("parent"),k=this.get("menu");if(b){b.on("hide",this._onParentHide,this);k.on("click",function(m){b.fire("click",{target:m.target})});if(!b.__bindDocClickToHide){i.on(g,"click",c,this);k.__bindDocClickToHide=1}k.on("afterActiveItemChange",
function(m){b.set("activeItem",m.newVal)})}k.on("beforeHighlightedItemChange",this.onChildHighlight_,this)},_handleMouseEnter:function(b){if(e.superclass._handleMouseEnter.call(this,b))return true;this.clearTimers();this.showTimer_=j.later(this.showMenu,this.get("menuDelay"),false,this)},showMenu:function(){var b=this.get("menu");b.set("align",j.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign")));b.render();this.get("el").attr("aria-haspopup",b.get("el").attr("id"));b.show()},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();
this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}},onChildHighlight_:function(b){if(b.newVal)if(this.get("menu").get("parent")==this){this.clearTimers();this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var b=this.get("menu");b&&b.hide()},_performInternal:function(){this.clearTimers();this.showMenu()},_handleKeydown:function(b){var k=this.get("menu"),m=k&&k.get("visible"),n=b.keyCode;if(m){if(!k._handleKeydown(b))if(n==a.LEFT){this.hideMenu();
this.get("parent").set("activeItem",this)}else return}else if(n==a.RIGHT){this.showMenu();b=k.get("children");b[0]&&k.set("highlightedItem",b[0])}else return;return true},_uiSetHighlighted:function(b,k){e.superclass._uiSetHighlighted.call(this,b,k);if(!b){this.dismissTimer_&&this.dismissTimer_.cancel();this.dismissTimer_=j.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(b){var k=this.get("menu");return k&&k.containsElement(b)},decorateChildrenInternal:function(b,k,
m){k.css("visibility","hidden");j.one(k[0].ownerDocument.body).prepend(k);this.set("menu",new b({srcNode:k,prefixCls:m}))},destructor:function(){var b=this.get("parent"),k=this.get("menu");this.clearTimers();i.remove(g,"click",c,this);b&&b.detach("hide",this._onParentHide,this);!this.get("externalSubMenu")&&k&&k.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:false},menuAlign:{},menu:{setter:function(b){b.set("parent",this)}},decorateChildCls:{value:"popupmenu"}},DefaultRender:d});
l.UIStore.setUIByClass("submenu",{priority:l.UIStore.PRIORITY.LEVEL2,ui:e});return e},{requires:["event","uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(j,i,h){var l;return l=i.create(h,{renderUI:function(){var f=this.get("el"),d=this.get("contentEl");f.attr("aria-haspopup","true");d.append(j.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetContent:function(f){l.superclass._uiSetContent.call(this,f);this.get("contentEl").append(j.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(j,i,h,l,f,d,c,a,g,e,b,k){i.Render=h;i.Item=l;i.Item.Render=f;i.SubMenu=d;d.Render=c;i.Separator=a;i.PopupMenu=e;i.FilterMenu=b;i.DelMenuItem=k;return i},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender","menu/separator","menu/separatorrender","menu/popupmenu","menu/filtermenu","menu/delmenuitem","menu/delmenuitemrender"]});
