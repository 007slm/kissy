/*
Copyright 2011, KISSY UI Library v1.1.8dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("switchable",function(c,j){function i(a,b){b=b||{};if(!("markupType"in b))if(b.panelCls)b.markupType=1;else if(b.panels)b.markupType=2;b=c.merge(i.Config,b);this.container=c.get(a);this.config=b;this.activeIndex=b.activeIndex;this._init()}var l=c.DOM,g=c.Event;i.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,
activeTriggerCls:"ks-active",steps:1,viewSize:[]};i.Plugins=[];c.augment(i,c.EventTarget,{_init:function(){var a=this,b=a.config;a._parseMarkup();b.switchTo&&a.switchTo(b.switchTo);b.hasTriggers&&a._bindTriggers();c.each(i.Plugins,function(d){d.init&&d.init(a)});a.fire("init")},_parseMarkup:function(){var a=this.container,b=this.config,d,f=[],h=[];switch(b.markupType){case 0:if(d=c.get("."+b.navCls,a))f=l.children(d);d=c.get("."+b.contentCls,a);h=l.children(d);break;case 1:f=c.query("."+b.triggerCls,
a);h=c.query("."+b.panelCls,a);break;case 2:f=b.triggers;h=b.panels;break}a=h.length;this.length=a/b.steps;if(b.hasTriggers&&a>0&&f.length===0)f=this._generateTriggersMarkup(this.length);this.triggers=c.makeArray(f);this.panels=c.makeArray(h);this.content=d||h[0].parentNode},_generateTriggersMarkup:function(a){var b=this.config,d=l.create("<ul>"),f,h;d.className=b.navCls;for(h=0;h<a;h++){f=l.create("<li>");if(h===this.activeIndex)f.className=b.activeTriggerCls;f.innerHTML=h+1;d.appendChild(f)}this.container.appendChild(d);
return l.children(d)},_bindTriggers:function(){var a=this,b=a.config,d=a.triggers,f,h,e=d.length;for(h=0;h<e;h++)(function(k){f=d[k];g.on(f,"click",function(){a._onFocusTrigger(k)});if(b.triggerType==="mouse"){g.on(f,"mouseenter",function(){a._onMouseEnterTrigger(k)});g.on(f,"mouseleave",function(){a._onMouseLeaveTrigger(k)})}})(h)},_onFocusTrigger:function(a){if(this._triggerIsValid(a)){this._cancelSwitchTimer();this.switchTo(a)}},_onMouseEnterTrigger:function(a){var b=this;if(b._triggerIsValid(a))b.switchTimer=
c.later(function(){b.switchTo(a)},b.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(a){return this.activeIndex!==a},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=j}},switchTo:function(a,b){var d=this.config,f=this.triggers,h=this.panels,e=this.activeIndex,k=d.steps,p=e*k,s=a*k;if(!this._triggerIsValid(a))return this;if(this.fire("beforeSwitch",{toIndex:a})===false)return this;if(d.hasTriggers)this._switchTrigger(e>
-1?f[e]:null,f[a]);if(b===j)b=a>e?"forward":"backward";this._switchView(h.slice(p,p+k),h.slice(s,s+k),a,b);this.activeIndex=a;return this},_switchTrigger:function(a,b){var d=this.config.activeTriggerCls;a&&l.removeClass(a,d);l.addClass(b,d)},_switchView:function(a,b,d){l.css(a,"display","none");l.css(b,"display","block");this._fireOnSwitch(d)},_fireOnSwitch:function(a){this.fire("switch",{currentIndex:a})},prev:function(){var a=this.activeIndex;this.switchTo(a>0?a-1:this.length-1,"backward")},next:function(){var a=
this.activeIndex;this.switchTo(a<this.length-1?a+1:0,"forward")}});c.Switchable=i},{requires:["core"]});
KISSY.add("autoplay",function(c,j){var i=c.Event,l=c.Switchable;c.mix(l.Config,{autoplay:false,interval:5,pauseOnHover:true});l.Plugins.push({name:"autoplay",init:function(g){function a(){f=c.later(function(){g.paused||g.switchTo(g.activeIndex<g.length-1?g.activeIndex+1:0,"forward")},d,true)}var b=g.config,d=b.interval*1E3,f;if(b.autoplay){if(b.pauseOnHover){i.on(g.container,"mouseenter",function(){g.stop();g.paused=true});i.on(g.container,"mouseleave",function(){g.paused=false;a()})}a();g.stop=function(){if(f){f.cancel();
f=j}}}}})},{host:"switchable"});
KISSY.add("effect",function(c,j){var i=c.DOM,l=c.Anim,g=c.Switchable,a;c.mix(g.Config,{effect:"none",duration:0.5,easing:"easeNone",nativeAnim:true});g.Effects={none:function(b,d,f){i.css(b,"display","none");i.css(d,"display","block");f()},fade:function(b,d,f){b.length!==1&&c.error("fade effect only supports steps == 1.");var h=this,e=h.config,k=b[0],p=d[0];h.anim&&h.anim.stop(true);i.css(p,"opacity",1);h.anim=(new l(k,{opacity:0},e.duration,e.easing,function(){h.anim=j;i.css(p,"z-index",9);i.css(k,
"z-index",1);f()},e.nativeAnim)).run()},scroll:function(b,d,f,h){var e=this;b=e.config;d=b.effect==="scrollx";var k={};k[d?"left":"top"]=-(e.viewSize[d?0:1]*h)+"px";e.anim&&e.anim.stop();e.anim=(new l(e.content,k,b.duration,b.easing,function(){e.anim=j;f()},b.nativeAnim)).run()}};a=g.Effects;a.scrollx=a.scrolly=a.scroll;g.Plugins.push({name:"effect",init:function(b){var d=b.config,f=d.effect,h=b.panels,e=b.content,k=d.steps,p=b.activeIndex,s=h.length;b.viewSize=[d.viewSize[0]||h[0].offsetWidth*k,
d.viewSize[1]||h[0].offsetHeight*k];if(f!=="none"){c.each(h,function(q){i.css(q,"display","block")});switch(f){case "scrollx":case "scrolly":i.css(e,"position","absolute");i.css(e.parentNode,"position","relative");if(f==="scrollx"){i.css(h,"float","left");i.width(e,b.viewSize[0]*(s/k))}break;case "fade":var m=p*k,r=m+k-1,n;c.each(h,function(q,t){n=t>=m&&t<=r;i.css(q,{opacity:n?1:0,position:"absolute",zIndex:n?9:1})});break}}}});c.augment(g,{_switchView:function(b,d,f,h){var e=this,k=e.config.effect;
(c.isFunction(k)?k:a[k]).call(e,b,d,function(){e._fireOnSwitch(f)},f,h)}})},{host:"switchable"});
KISSY.add("circular",function(c,j){function i(n,q,t,u,w){var o=this;n=o.config;q=o.length;var x=o.activeIndex,v=n.scrollType===m,y=v?f:h,z=o.viewSize[v?0:1];v=-z*u;var B={},C,A=w===s;if(C=A&&x===0&&u===q-1||w===p&&x===q-1&&u===0)v=l.call(o,o.panels,u,A,y,z);B[y]=v+k;o.anim&&o.anim.stop();o.anim=(new c.Anim(o.content,B,n.duration,n.easing,function(){C&&g.call(o,o.panels,u,A,y,z);o.anim=j;t()},n.nativeAnim)).run()}function l(n,q,t,u,w){var o=this.config.steps;q=this.length;var x=t?q-1:0,v=(x+1)*o;for(o=
x*o;o<v;o++){a.css(n[o],b,d);a.css(n[o],u,(t?-1:1)*w*q)}return t?w:-w*q}function g(n,q,t,u,w){var o=this.config.steps;q=this.length;var x=t?q-1:0,v=(x+1)*o;for(o=x*o;o<v;o++){a.css(n[o],b,e);a.css(n[o],u,e)}a.css(this.content,u,t?-w*(q-1):e)}var a=c.DOM,b="position",d="relative",f="left",h="top",e="",k="px",p="forward",s="backward",m="scrollx",r=c.Switchable;c.mix(r.Config,{circular:false});r.Plugins.push({name:"circular",init:function(n){n=n.config;if(n.circular&&(n.effect===m||n.effect==="scrolly")){n.scrollType=
n.effect;n.effect=i}}})},{host:"switchable"});
KISSY.add("lazyload",function(c){var j=c.DOM,i="beforeSwitch",l="img-src",g="area-data",a={},b=c.Switchable;a[l]="data-ks-lazyload-custom";a[g]="ks-datalazyload-custom";c.mix(b.Config,{lazyDataType:g});b.Plugins.push({name:"lazyload",init:function(d){function f(m){var r=k.steps;m=m.toIndex*r;e.loadCustomLazyData(d.panels.slice(m,m+r),p);h()&&d.detach(i,f)}function h(){var m,r,n,q=p===l;if(m=q?"img":p===g?"textarea":""){m=c.query(m,d.container);r=0;for(n=m.length;r<n;r++)if(q?j.attr(m[r],s):j.hasClass(m[r],
s))return false}return true}var e=c.DataLazyload,k=d.config,p=k.lazyDataType,s=a[p];!e||!p||!s||d.on(i,f)}})},{host:"switchable"});KISSY.add("autorender",function(c){c.Switchable.autoRender=function(j,i){j="."+(j||"KS_Widget");c.query(j,i).each(function(l){var g=l.getAttribute("data-widget-type"),a;if(g&&"Switchable Tabs Slide Carousel Accordion".indexOf(g)>-1)try{if(a=l.getAttribute("data-widget-config"))a=a.replace(/'/g,'"');new c[g](l,c.JSON.parse(a))}catch(b){}})}},{host:"switchable"});
KISSY.add("tabs",function(c){function j(i,l){if(!(this instanceof j))return new j(i,l);j.superclass.constructor.call(this,i,l)}c.extend(j,c.Switchable);c.Tabs=j},{host:"switchable"});KISSY.add("slide",function(c){function j(l,g){if(!(this instanceof j))return new j(l,g);j.superclass.constructor.call(this,l,c.merge(i,g))}var i={autoplay:true,circular:true};c.extend(j,c.Switchable);c.Slide=j},{host:"switchable"});
KISSY.add("carousel",function(c,j){function i(e,k){var p=this;if(!(p instanceof i))return new i(e,k);p.on("init",function(){l(p)});i.superclass.constructor.call(p,e,c.merge(h,k))}function l(e){var k=e.config,p=k.disableBtnCls,s=false;c.each(["prev","next"],function(m){var r=e[m+"Btn"]=c.get(b+k[m+"BtnCls"],e.container);a.on(r,"click",function(n){n.preventDefault();s||g.hasClass(r,p)||e[m]()})});if(!k.circular){e.on("beforeSwitch",function(){s=true});e.on("switch",function(m){m=m.currentIndex;m=m===
0?e[d]:m===e.length-1?e[f]:j;g.removeClass([e[d],e[f]],p);m&&g.addClass(m,p);s=false})}a.on(e.panels,"click focus",function(){e.fire("itemSelected",{item:this})})}var g=c.DOM,a=c.Event,b=".",d="prevBtn",f="nextBtn",h={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};c.extend(i,c.Switchable);c.Carousel=i},{host:"switchable"});
KISSY.add("accordion",function(c){function j(g,a){if(!(this instanceof j))return new j(g,a);j.superclass.constructor.call(this,g,c.merge(l,a));if(this.config.multiple)this._switchTrigger=function(){}}var i=c.DOM,l={markupType:1,triggerType:"click",multiple:false};c.extend(j,c.Switchable);c.Accordion=j;c.augment(j,{_triggerIsValid:function(g){return this.activeIndex!==g||this.config.multiple},_switchView:function(g,a,b){var d=this.config,f=a[0];if(d.multiple){i.toggleClass(this.triggers[b],d.activeTriggerCls);
i.css(f,"display",f.style.display=="none"?"block":"none");this._fireOnSwitch(b)}else j.superclass._switchView.call(this,g,a,b)}})},{host:"switchable"});
