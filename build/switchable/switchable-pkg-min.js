/*
Copyright 2010, KISSY UI Library v1.1.0pre
MIT Licensed
build time: ${build.time}
*/
KISSY.add("switchable",function(c,k){function g(b,a){a=a||{};if(!("markupType"in a))if(a.panelCls)a.markupType=1;else if(a.panels)a.markupType=2;a=c.merge(g.Config,a);this.container=c.get(b);this.config=a;this.activeIndex=a.activeIndex;this._init()}var l=c.DOM,h=c.Event;g.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,
activeTriggerCls:"ks-active",steps:1,viewSize:[]};g.Plugins=[];c.augment(g,c.EventTarget,{_init:function(){var b=this,a=b.config;if(b.fire("beforeInit")!==false){b._parseMarkup();a.hasTriggers&&b._bindTriggers();c.each(g.Plugins,function(d){d.init&&d.init(b)});b.fire("init")}},_parseMarkup:function(){var b=this.container,a=this.config,d,i=[],f=[];switch(a.markupType){case 0:if(d=c.get("."+a.navCls,b))i=l.children(d);d=c.get("."+a.contentCls,b);f=l.children(d);break;case 1:i=c.query("."+a.triggerCls,
b);f=c.query("."+a.panelCls,b);break;case 2:i=a.triggers;f=a.panels;break}b=f.length;this.length=b/a.steps;if(a.hasTriggers&&b>0&&i.length===0)i=this._generateTriggersMarkup(this.length);this.triggers=c.makeArray(i);this.panels=c.makeArray(f);this.content=d||f[0].parentNode},_generateTriggersMarkup:function(b){var a=this.config,d=l.create("<ul>"),i,f;d.className=a.navCls;for(f=0;f<b;f++){i=l.create("<li>");if(f===this.activeIndex)i.className=a.activeTriggerCls;i.innerHTML=f+1;d.appendChild(i)}this.container.appendChild(d);
return l.children(d)},_bindTriggers:function(){var b=this,a=b.config,d=b.triggers,i,f,e=d.length;for(f=0;f<e;f++)(function(j){i=d[j];h.on(i,"click focus",function(){b._onFocusTrigger(j)});if(a.triggerType==="mouse"){h.on(i,"mouseenter",function(){b._onMouseEnterTrigger(j)});h.on(i,"mouseleave",function(){b._onMouseLeaveTrigger(j)})}})(f)},_onFocusTrigger:function(b){if(this._triggerIsValid()){this._cancelSwitchTimer();this.switchTo(b)}},_onMouseEnterTrigger:function(b){var a=this;if(a._triggerIsValid())a.switchTimer=
c.later(function(){a.switchTo(b)},a.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(b){return this.activeIndex!==b},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=k}},switchTo:function(b,a){var d=this.config,i=this.triggers,f=this.panels,e=this.activeIndex,j=d.steps,o=e*j,p=b*j;if(!this._triggerIsValid())return this;if(this.fire("beforeSwitch",{toIndex:b})===false)return this;if(d.hasTriggers)this._switchTrigger(e>
-1?i[e]:null,i[b]);if(a===k)a=b>e?"forward":"backward";this._switchView(f.slice(o,o+j),f.slice(p,p+j),b,a);this.activeIndex=b;return this},_switchTrigger:function(b,a){var d=this.config.activeTriggerCls;b&&l.removeClass(b,d);l.addClass(a,d)},_switchView:function(b,a,d){l.css(b,"display","none");l.css(a,"display","block");this._fireOnSwitch(d)},_fireOnSwitch:function(b){this.fire("switch",{currentIndex:b})},prev:function(){var b=this.activeIndex;this.switchTo(b>0?b-1:this.length-1,"backward")},next:function(){var b=
this.activeIndex;this.switchTo(b<this.length-1?b+1:0,"forward")}});c.Switchable=g});
KISSY.add("switchable-autoplay",function(c,k){var g=c.Event,l=c.Switchable;c.mix(l.Config,{autoplay:false,interval:5,pauseOnHover:true});l.Plugins.push({name:"autoplay",init:function(h){var b=h.config,a=b.interval*1E3,d;if(b.autoplay){if(b.pauseOnHover){g.on(h.container,"mouseenter",function(){if(d){d.cancel();d=k}h.paused=true});g.on(h.container,"mouseleave",function(){d=c.later(function(){h.paused=false;d=k},a)})}h.autoplayTimer=c.later(function(){h.paused||h.switchTo(h.activeIndex<h.length-1?h.activeIndex+
1:0,"forward")},a,true)}}})});
KISSY.add("switchable-effect",function(c,k){var g=c.DOM,l=c.Anim,h=c.Switchable,b;c.mix(h.Config,{effect:"none",duration:0.5,easing:"easeNone"});h.Effects={none:function(a,d,i){g.css(a,"display","none");g.css(d,"display","block");i()},fade:function(a,d,i){a.length!==1&&c.error("fade effect only supports steps == 1.");var f=this,e=f.config,j=a[0],o=d[0];f.anim&&f.anim.stop(true);g.css(o,"opacity",1);f.anim=(new l(j,{opacity:0},e.duration,e.easing,function(){f.anim=k;g.css(o,"z-index",9);g.css(j,"z-index",
1);i()})).run()},scroll:function(a,d,i,f){var e=this;a=e.config;d=a.effect==="scrollx";var j={};j[d?"left":"top"]=-(e.viewSize[d?0:1]*f)+"px";e.anim&&e.anim.stop();e.anim=(new l(e.content,j,a.duration,a.easing,function(){e.anim=k;i()})).run()}};b=h.Effects;b.scrollx=b.scrolly=b.scroll;h.Plugins.push({name:"effect",init:function(a){var d=a.config,i=d.effect,f=a.panels,e=a.content,j=d.steps,o=a.activeIndex,p=f.length;a.viewSize=[d.viewSize[0]||f[0].offsetWidth*j,d.viewSize[1]||f[0].offsetHeight*j];
if(i!=="none"){c.each(f,function(s){g.css(s,"display","block")});switch(i){case "scrollx":case "scrolly":g.css(e,"position","absolute");g.css(e.parentNode,"position","relative");if(i==="scrollx"){g.css(f,"float","left");g.width(e,a.viewSize[0]*(p/j))}break;case "fade":var q=o*j,r=q+j-1,n;c.each(f,function(s,t){n=t>=q&&t<=r;g.css(s,{opacity:n?1:0,position:"absolute",zIndex:n?9:1})});break}}}});c.augment(h,{_switchView:function(a,d,i,f){var e=this,j=e.config.effect;(c.isFunction(j)?j:b[j]).call(e,a,
d,function(){e._fireOnSwitch(i)},i,f)}})});
KISSY.add("switchable-circular",function(c,k){function g(n,s,t,u,w){var m=this;n=m.config;s=m.length;var x=m.activeIndex,v=n.scrollType===q,y=v?i:f,z=m.viewSize[v?0:1];v=-z*u;var B={},C,A=w===p;if(C=A&&x===0&&u===s-1||w===o&&x===s-1&&u===0)v=l.call(m,m.panels,u,A,y,z);B[y]=v+j;m.anim&&m.anim.stop();m.anim=(new c.Anim(m.content,B,n.duration,n.easing,function(){C&&h.call(m,m.panels,u,A,y,z);m.anim=k;t()})).run()}function l(n,s,t,u,w){var m=this.config.steps;s=this.length;var x=t?s-1:0,v=(x+1)*m;for(m=
x*m;m<v;m++){b.css(n[m],a,d);b.css(n[m],u,(t?-1:1)*w*s)}return t?w:-w*s}function h(n,s,t,u,w){var m=this.config.steps;s=this.length;var x=t?s-1:0,v=(x+1)*m;for(m=x*m;m<v;m++){b.css(n[m],a,e);b.css(n[m],u,e)}b.css(this.content,u,t?-w*(s-1):e)}var b=c.DOM,a="position",d="relative",i="left",f="top",e="",j="px",o="forward",p="backward",q="scrollx",r=c.Switchable;c.mix(r.Config,{circular:false});r.Plugins.push({name:"circular",init:function(n){n=n.config;if(n.circular&&(n.effect===q||n.effect==="scrolly")){n.scrollType=
n.effect;n.effect=g}}})});
KISSY.add("switchable-lazyload",function(c){var k=c.DOM,g="beforeSwitch",l="img-src",h="area-data",b={},a=c.Switchable;b[l]="data-ks-lazyload-custom";b[h]="ks-datalazyload-custom";c.mix(a.Config,{lazyDataType:h});a.Plugins.push({name:"lazyload",init:function(d){function i(q){var r=j.steps;q=q.toIndex*r;e.loadCustomLazyData(d.panels.slice(q,q+r),o);f()&&d.detach(g,i)}function f(){var q,r,n,s=o===l;if(q=s?"img":o===h?"textarea":""){q=c.query(q,d.container);r=0;for(n=q.length;r<n;r++)if(s?k.attr(q[r],
p):k.hasClass(q[r],p))return false}return true}var e=c.DataLazyload,j=d.config,o=j.lazyDataType,p=b[o];!e||!o||!p||d.on(g,i)}})});
KISSY.add("switchable-countdown",function(c,k){var g=c.DOM,l=c.Event,h=c.Anim,b=c.Switchable;c.mix(b.Config,{countdown:false,countdownStyle:"width: 0"});b.Plugins.push({name:"countdown",init:function(a){function d(r){i();p=(new h(j[r],o,e-1)).run()}function i(){if(p){p.stop();p=k}if(q){q.stop();q=k}}var f=a.config,e=f.interval,j=[],o=f.countdownStyle,p,q;if(!(!f.autoplay||!f.hasTriggers||!f.countdown)){c.each(a.triggers,function(r,n){r.innerHTML='<div class="ks-switchable-trigger-mask"></div><div class="ks-switchable-trigger-content">'+
r.innerHTML+"</div>";j[n]=r.firstChild});f.pauseOnHover&&l.on(a.container,"mouseenter",function(){i();q=(new h(j[a.activeIndex],o,e/10,"easeOut")).run()});a.on("beforeSwitch",function(r){i();g.removeAttr(j[a.activeIndex],"style");a.paused&&g.css(j[r.toIndex],"visibility","hidden")});a.on("switch",function(r){a.paused||d(r.currentIndex)});d(a.activeIndex)}}})});
KISSY.add("switchable-autorender",function(c){c.Switchable.autoRender=function(k,g,l){g="."+(g||"KS_");l=l||"data-ks-switchable";c.each(["Switchable","Tabs","Slide","Carousel","Accordion"],function(h){c.each(c.query(g+h,k),function(b){try{var a=b.getAttribute(l);if(a)a=a.replace(/'/g,'"');new c[h](b,c.JSON.parse(a))}catch(d){c.log("Switchable.autoRender: "+d,"warn")}})})}});
KISSY.add("tabs",function(c){function k(g,l){if(!(this instanceof k))return new k(g,l);k.superclass.constructor.call(this,g,l)}c.extend(k,c.Switchable);c.Tabs=k});KISSY.add("slide",function(c){function k(l,h){if(!(this instanceof k))return new k(l,h);k.superclass.constructor.call(this,l,c.merge(g,h))}var g={autoplay:true,circular:true};c.extend(k,c.Switchable);c.Slide=k});
KISSY.add("carousel",function(c,k){function g(e,j){var o=this;if(!(o instanceof g))return new g(e,j);o.on("init",function(){l(o)});g.superclass.constructor.call(o,e,c.merge(f,j))}function l(e){var j=e.config,o=j.disableBtnCls;c.each(["prev","next"],function(p){var q=e[p+"Btn"]=c.get(a+j[p+"BtnCls"],e.container);b.on(q,"click",function(r){r.preventDefault();h.hasClass(q,o)||e[p]()})});j.circular||e.on("switch",function(p){p=p.currentIndex;p=p===0?e[d]:p===e.length-1?e[i]:k;h.removeClass([e[d],e[i]],
o);p&&h.addClass(p,o)});b.on(e.panels,"click focus",function(){e.fire("itemSelected",{item:this})})}var h=c.DOM,b=c.Event,a=".",d="prevBtn",i="nextBtn",f={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};c.extend(g,c.Switchable);c.Carousel=g});
KISSY.add("accordion",function(c){function k(h,b){if(!(this instanceof k))return new k(h,b);k.superclass.constructor.call(this,h,c.merge(l,b))}var g=c.DOM,l={markupType:1,triggerType:"click",multiple:false};c.extend(k,c.Switchable);c.Accordion=k;c.augment(k,{_triggerIsValid:function(h){return this.activeIndex!==h||this.config.multiple},_switchView:function(h,b,a){var d=this.config,i=b[0];if(d.multiple){g.toggleClass(this.triggers[a],d.activeTriggerCls);g.css(i,"display",i.style.display=="none"?"block":
"none");this._fireOnSwitch(a)}else k.superclass._switchView.call(this,h,b,a)}})});
