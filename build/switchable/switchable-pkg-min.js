/*
Copyright 2010, KISSY UI Library v1.1.0
MIT Licensed
build time: Aug 5 16:06
*/
KISSY.add("switchable",function(c,k){function h(b,a){a=a||{};if(!("markupType"in a))if(a.panelCls)a.markupType=1;else if(a.panels)a.markupType=2;a=c.merge(h.Config,a);this.container=c.get(b);this.config=a;this.activeIndex=a.activeIndex;this._init()}var l=c.DOM,i=c.Event;h.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,
activeTriggerCls:"ks-active",steps:1,viewSize:[]};h.Plugins=[];c.augment(h,c.EventTarget,{_init:function(){var b=this,a=b.config;if(b.fire("beforeInit")!==false){b._parseMarkup();a.hasTriggers&&b._bindTriggers();c.each(h.Plugins,function(d){d.init&&d.init(b)});b.fire("init")}},_parseMarkup:function(){var b=this.container,a=this.config,d,e=[],f=[];switch(a.markupType){case 0:if(d=c.get("."+a.navCls,b))e=l.children(d);d=c.get("."+a.contentCls,b);f=l.children(d);break;case 1:e=c.query("."+a.triggerCls,
b);f=c.query("."+a.panelCls,b);break;case 2:e=a.triggers;f=a.panels;break}b=f.length;this.length=b/a.steps;if(a.hasTriggers&&b>0&&e.length===0)e=this._generateTriggersMarkup(this.length);this.triggers=c.makeArray(e);this.panels=c.makeArray(f);this.content=d||f[0].parentNode},_generateTriggersMarkup:function(b){var a=this.config,d=l.create("<ul>"),e,f;d.className=a.navCls;for(f=0;f<b;f++){e=l.create("<li>");if(f===this.activeIndex)e.className=a.activeTriggerCls;e.innerHTML=f+1;d.appendChild(e)}this.container.appendChild(d);
return l.children(d)},_bindTriggers:function(){var b=this,a=b.config,d=b.triggers,e,f,g=d.length;for(f=0;f<g;f++)(function(j){e=d[j];i.on(e,"click focus",function(){b._onFocusTrigger(j)});if(a.triggerType==="mouse"){i.on(e,"mouseenter",function(){b._onMouseEnterTrigger(j)});i.on(e,"mouseleave",function(){b._onMouseLeaveTrigger(j)})}})(f)},_onFocusTrigger:function(b){if(this._triggerIsValid()){this._cancelSwitchTimer();this.switchTo(b)}},_onMouseEnterTrigger:function(b){var a=this;if(a._triggerIsValid())a.switchTimer=
c.later(function(){a.switchTo(b)},a.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(b){return this.activeIndex!==b},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=k}},switchTo:function(b,a){var d=this.config,e=this.triggers,f=this.panels,g=this.activeIndex,j=d.steps,o=g*j,q=b*j;if(!this._triggerIsValid())return this;if(this.fire("beforeSwitch",{toIndex:b})===false)return this;if(d.hasTriggers)this._switchTrigger(g>
-1?e[g]:null,e[b]);if(a===k)a=b>g?"forward":"backward";this._switchView(f.slice(o,o+j),f.slice(q,q+j),b,a);this.activeIndex=b;return this},_switchTrigger:function(b,a){var d=this.config.activeTriggerCls;b&&l.removeClass(b,d);l.addClass(a,d)},_switchView:function(b,a,d){l.css(b,"display","none");l.css(a,"display","block");this._fireOnSwitch(d)},_fireOnSwitch:function(b){this.fire("switch",{currentIndex:b})},prev:function(){var b=this.activeIndex;this.switchTo(b>0?b-1:this.length-1,"backward")},next:function(){var b=
this.activeIndex;this.switchTo(b<this.length-1?b+1:0,"forward")}});c.Switchable=h});
KISSY.add("switchable-autoplay",function(c,k){var h=c.Event,l=c.Switchable;c.mix(l.Config,{autoplay:false,interval:5,pauseOnHover:true});l.Plugins.push({name:"autoplay",init:function(i){function b(){e=c.later(function(){i.paused||i.switchTo(i.activeIndex<i.length-1?i.activeIndex+1:0,"forward")},d,true)}var a=i.config,d=a.interval*1E3,e;if(a.autoplay){if(a.pauseOnHover){h.on(i.container,"mouseenter",function(){if(e){e.cancel();e=k}i.paused=true});h.on(i.container,"mouseleave",function(){i.paused=false;
b()})}b()}}})});
KISSY.add("switchable-effect",function(c,k){var h=c.DOM,l=c.Anim,i=c.Switchable,b;c.mix(i.Config,{effect:"none",duration:0.5,easing:"easeNone"});i.Effects={none:function(a,d,e){h.css(a,"display","none");h.css(d,"display","block");e()},fade:function(a,d,e){a.length!==1&&c.error("fade effect only supports steps == 1.");var f=this,g=f.config,j=a[0],o=d[0];f.anim&&f.anim.stop(true);h.css(o,"opacity",1);f.anim=(new l(j,{opacity:0},g.duration,g.easing,function(){f.anim=k;h.css(o,"z-index",9);h.css(j,"z-index",
1);e()})).run()},scroll:function(a,d,e,f){var g=this;a=g.config;d=a.effect==="scrollx";var j={};j[d?"left":"top"]=-(g.viewSize[d?0:1]*f)+"px";g.anim&&g.anim.stop();g.anim=(new l(g.content,j,a.duration,a.easing,function(){g.anim=k;e()})).run()}};b=i.Effects;b.scrollx=b.scrolly=b.scroll;i.Plugins.push({name:"effect",init:function(a){var d=a.config,e=d.effect,f=a.panels,g=a.content,j=d.steps,o=a.activeIndex,q=f.length;a.viewSize=[d.viewSize[0]||f[0].offsetWidth*j,d.viewSize[1]||f[0].offsetHeight*j];
if(e!=="none"){c.each(f,function(s){h.css(s,"display","block")});switch(e){case "scrollx":case "scrolly":h.css(g,"position","absolute");h.css(g.parentNode,"position","relative");if(e==="scrollx"){h.css(f,"float","left");h.width(g,a.viewSize[0]*(q/j))}break;case "fade":var p=o*j,r=p+j-1,n;c.each(f,function(s,t){n=t>=p&&t<=r;h.css(s,{opacity:n?1:0,position:"absolute",zIndex:n?9:1})});break}}}});c.augment(i,{_switchView:function(a,d,e,f){var g=this,j=g.config.effect;(c.isFunction(j)?j:b[j]).call(g,a,
d,function(){g._fireOnSwitch(e)},e,f)}})});
KISSY.add("switchable-circular",function(c,k){function h(n,s,t,u,w){var m=this;n=m.config;s=m.length;var x=m.activeIndex,v=n.scrollType===p,y=v?e:f,z=m.viewSize[v?0:1];v=-z*u;var B={},C,A=w===q;if(C=A&&x===0&&u===s-1||w===o&&x===s-1&&u===0)v=l.call(m,m.panels,u,A,y,z);B[y]=v+j;m.anim&&m.anim.stop();m.anim=(new c.Anim(m.content,B,n.duration,n.easing,function(){C&&i.call(m,m.panels,u,A,y,z);m.anim=k;t()})).run()}function l(n,s,t,u,w){var m=this.config.steps;s=this.length;var x=t?s-1:0,v=(x+1)*m;for(m=
x*m;m<v;m++){b.css(n[m],a,d);b.css(n[m],u,(t?-1:1)*w*s)}return t?w:-w*s}function i(n,s,t,u,w){var m=this.config.steps;s=this.length;var x=t?s-1:0,v=(x+1)*m;for(m=x*m;m<v;m++){b.css(n[m],a,g);b.css(n[m],u,g)}b.css(this.content,u,t?-w*(s-1):g)}var b=c.DOM,a="position",d="relative",e="left",f="top",g="",j="px",o="forward",q="backward",p="scrollx",r=c.Switchable;c.mix(r.Config,{circular:false});r.Plugins.push({name:"circular",init:function(n){n=n.config;if(n.circular&&(n.effect===p||n.effect==="scrolly")){n.scrollType=
n.effect;n.effect=h}}})});
KISSY.add("switchable-lazyload",function(c){var k=c.DOM,h="beforeSwitch",l="img-src",i="area-data",b={},a=c.Switchable;b[l]="data-ks-lazyload-custom";b[i]="ks-datalazyload-custom";c.mix(a.Config,{lazyDataType:i});a.Plugins.push({name:"lazyload",init:function(d){function e(p){var r=j.steps;p=p.toIndex*r;g.loadCustomLazyData(d.panels.slice(p,p+r),o);f()&&d.detach(h,e)}function f(){var p,r,n,s=o===l;if(p=s?"img":o===i?"textarea":""){p=c.query(p,d.container);r=0;for(n=p.length;r<n;r++)if(s?k.attr(p[r],
q):k.hasClass(p[r],q))return false}return true}var g=c.DataLazyload,j=d.config,o=j.lazyDataType,q=b[o];!g||!o||!q||d.on(h,e)}})});
KISSY.add("switchable-countdown",function(c,k){var h=c.DOM,l=c.Event,i=c.Anim,b=c.Switchable;c.mix(b.Config,{countdown:false,countdownFromStyle:"",countdownToStyle:"width: 0"});b.Plugins.push({name:"countdown",init:function(a){function d(){e();p=(new i(j[a.activeIndex],q,g-0.5)).run()}function e(){if(p){p.stop();p=k}}var f=a.config,g=f.interval,j=[],o=f.countdownFromStyle,q=f.countdownToStyle,p;if(!(!f.autoplay||!f.hasTriggers||!f.countdown)){c.each(a.triggers,function(r,n){r.innerHTML='<div class="ks-switchable-trigger-mask"></div><div class="ks-switchable-trigger-content">'+
r.innerHTML+"</div>";j[n]=r.firstChild});if(f.pauseOnHover){l.on(a.container,"mouseenter",function(){e();var r=j[a.activeIndex];if(o)p=(new i(r,o,0.2,"easeOut")).run();else h.removeAttr(r,"style")});l.on(a.container,"mouseleave",function(){e();h.removeAttr(j[a.activeIndex],"style");c.later(d,200)})}a.on("beforeSwitch",function(){e();h.removeAttr(j[a.activeIndex],"style")});a.on("switch",function(){a.paused||d()});d(a.activeIndex)}}})});
KISSY.add("switchable-autorender",function(c){c.Switchable.autoRender=function(k,h,l){h="."+(h||"KS_");l=l||"data-ks-switchable";c.each(["Switchable","Tabs","Slide","Carousel","Accordion"],function(i){c.each(c.query(h+i,k),function(b){try{var a=b.getAttribute(l);if(a)a=a.replace(/'/g,'"');new c[i](b,c.JSON.parse(a))}catch(d){c.log("Switchable.autoRender: "+d,"warn")}})})}});
KISSY.add("tabs",function(c){function k(h,l){if(!(this instanceof k))return new k(h,l);k.superclass.constructor.call(this,h,l)}c.extend(k,c.Switchable);c.Tabs=k});KISSY.add("slide",function(c){function k(l,i){if(!(this instanceof k))return new k(l,i);k.superclass.constructor.call(this,l,c.merge(h,i))}var h={autoplay:true,circular:true};c.extend(k,c.Switchable);c.Slide=k});
KISSY.add("carousel",function(c,k){function h(g,j){var o=this;if(!(o instanceof h))return new h(g,j);o.on("init",function(){l(o)});h.superclass.constructor.call(o,g,c.merge(f,j))}function l(g){var j=g.config,o=j.disableBtnCls;c.each(["prev","next"],function(q){var p=g[q+"Btn"]=c.get(a+j[q+"BtnCls"],g.container);b.on(p,"click",function(r){r.preventDefault();i.hasClass(p,o)||g[q]()})});j.circular||g.on("switch",function(q){q=q.currentIndex;q=q===0?g[d]:q===g.length-1?g[e]:k;i.removeClass([g[d],g[e]],
o);q&&i.addClass(q,o)});b.on(g.panels,"click focus",function(){g.fire("itemSelected",{item:this})})}var i=c.DOM,b=c.Event,a=".",d="prevBtn",e="nextBtn",f={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};c.extend(h,c.Switchable);c.Carousel=h});
KISSY.add("accordion",function(c){function k(i,b){if(!(this instanceof k))return new k(i,b);k.superclass.constructor.call(this,i,c.merge(l,b))}var h=c.DOM,l={markupType:1,triggerType:"click",multiple:false};c.extend(k,c.Switchable);c.Accordion=k;c.augment(k,{_triggerIsValid:function(i){return this.activeIndex!==i||this.config.multiple},_switchView:function(i,b,a){var d=this.config,e=b[0];if(d.multiple){h.toggleClass(this.triggers[a],d.activeTriggerCls);h.css(e,"display",e.style.display=="none"?"block":
"none");this._fireOnSwitch(a)}else k.superclass._switchView.call(this,i,b,a)}})});
