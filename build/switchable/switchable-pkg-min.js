/*
Copyright 2010, KISSY UI Library v1.1.0
MIT Licensed
build time: Aug 2 22:52
*/
KISSY.add("switchable",function(c,k){function h(b,a){a=a||{};if(!("markupType"in a))if(a.panelCls)a.markupType=1;else if(a.panels)a.markupType=2;a=c.merge(h.Config,a);this.container=c.get(b);this.config=a;this.activeIndex=a.activeIndex;this._init()}var l=c.DOM,i=c.Event;h.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:0,
activeTriggerCls:"ks-active",steps:1,viewSize:[]};h.Plugins=[];c.augment(h,c.EventTarget,{_init:function(){var b=this,a=b.config;if(b.fire("beforeInit")!==false){b._parseMarkup();a.hasTriggers&&b._bindTriggers();c.each(h.Plugins,function(d){d.init&&d.init(b)});b.fire("init")}},_parseMarkup:function(){var b=this.container,a=this.config,d,e=[],f=[];switch(a.markupType){case 0:if(d=c.get("."+a.navCls,b))e=l.children(d);d=c.get("."+a.contentCls,b);f=l.children(d);break;case 1:e=c.query("."+a.triggerCls,
b);f=c.query("."+a.panelCls,b);break;case 2:e=a.triggers;f=a.panels;break}b=f.length;this.length=b/a.steps;if(a.hasTriggers&&b>0&&e.length===0)e=this._generateTriggersMarkup(this.length);this.triggers=c.makeArray(e);this.panels=c.makeArray(f);this.content=d||f[0].parentNode},_generateTriggersMarkup:function(b){var a=this.config,d=l.create("<ul>"),e,f;d.className=a.navCls;for(f=0;f<b;f++){e=l.create("<li>");if(f===this.activeIndex)e.className=a.activeTriggerCls;e.innerHTML=f+1;d.appendChild(e)}this.container.appendChild(d);
return l.children(d)},_bindTriggers:function(){var b=this,a=b.config,d=b.triggers,e,f,g=d.length;for(f=0;f<g;f++)(function(j){e=d[j];i.on(e,"click focus",function(){b._onFocusTrigger(j)});if(a.triggerType==="mouse"){i.on(e,"mouseenter",function(){b._onMouseEnterTrigger(j)});i.on(e,"mouseleave",function(){b._onMouseLeaveTrigger(j)})}})(f)},_onFocusTrigger:function(b){if(this._triggerIsValid()){this._cancelSwitchTimer();this.switchTo(b)}},_onMouseEnterTrigger:function(b){var a=this;if(a._triggerIsValid())a.switchTimer=
c.later(function(){a.switchTo(b)},a.config.delay*1E3)},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(b){return this.activeIndex!==b},_cancelSwitchTimer:function(){if(this.switchTimer){this.switchTimer.cancel();this.switchTimer=k}},switchTo:function(b,a){var d=this.config,e=this.triggers,f=this.panels,g=this.activeIndex,j=d.steps,p=g*j,r=b*j;if(!this._triggerIsValid())return this;if(this.fire("beforeSwitch",{toIndex:b})===false)return this;if(d.hasTriggers)this._switchTrigger(g>
-1?e[g]:null,e[b]);if(a===k)a=b>g?"forward":"backward";this._switchView(f.slice(p,p+j),f.slice(r,r+j),b,a);this.activeIndex=b;return this},_switchTrigger:function(b,a){var d=this.config.activeTriggerCls;b&&l.removeClass(b,d);l.addClass(a,d)},_switchView:function(b,a,d){l.css(b,"display","none");l.css(a,"display","block");this._fireOnSwitch(d)},_fireOnSwitch:function(b){this.fire("switch",{currentIndex:b})},prev:function(){var b=this.activeIndex;this.switchTo(b>0?b-1:this.length-1,"backward")},next:function(){var b=
this.activeIndex;this.switchTo(b<this.length-1?b+1:0,"forward")}});c.Switchable=h});
KISSY.add("switchable-autoplay",function(c,k){var h=c.Event,l=c.Switchable;c.mix(l.Config,{autoplay:false,interval:5,pauseOnHover:true});l.Plugins.push({name:"autoplay",init:function(i){function b(){e=c.later(function(){i.paused||i.switchTo(i.activeIndex<i.length-1?i.activeIndex+1:0,"forward")},d,true)}var a=i.config,d=a.interval*1E3,e;if(a.autoplay){if(a.pauseOnHover){h.on(i.container,"mouseenter",function(){if(e){e.cancel();e=k}i.paused=true});h.on(i.container,"mouseleave",function(){i.paused=false;
b()})}b()}}})});
KISSY.add("switchable-effect",function(c,k){var h=c.DOM,l=c.Anim,i=c.Switchable,b;c.mix(i.Config,{effect:"none",duration:0.5,easing:"easeNone"});i.Effects={none:function(a,d,e){h.css(a,"display","none");h.css(d,"display","block");e()},fade:function(a,d,e){a.length!==1&&c.error("fade effect only supports steps == 1.");var f=this,g=f.config,j=a[0],p=d[0];f.anim&&f.anim.stop(true);h.css(p,"opacity",1);f.anim=(new l(j,{opacity:0},g.duration,g.easing,function(){f.anim=k;h.css(p,"z-index",9);h.css(j,"z-index",
1);e()})).run()},scroll:function(a,d,e,f){var g=this;a=g.config;d=a.effect==="scrollx";var j={};j[d?"left":"top"]=-(g.viewSize[d?0:1]*f)+"px";g.anim&&g.anim.stop();g.anim=(new l(g.content,j,a.duration,a.easing,function(){g.anim=k;e()})).run()}};b=i.Effects;b.scrollx=b.scrolly=b.scroll;i.Plugins.push({name:"effect",init:function(a){var d=a.config,e=d.effect,f=a.panels,g=a.content,j=d.steps,p=a.activeIndex,r=f.length;a.viewSize=[d.viewSize[0]||f[0].offsetWidth*j,d.viewSize[1]||f[0].offsetHeight*j];
if(e!=="none"){c.each(f,function(s){h.css(s,"display","block")});switch(e){case "scrollx":case "scrolly":h.css(g,"position","absolute");h.css(g.parentNode,"position","relative");if(e==="scrollx"){h.css(f,"float","left");h.width(g,a.viewSize[0]*(r/j))}break;case "fade":var q=p*j,n=q+j-1,o;c.each(f,function(s,t){o=t>=q&&t<=n;h.css(s,{opacity:o?1:0,position:"absolute",zIndex:o?9:1})});break}}}});c.augment(i,{_switchView:function(a,d,e,f){var g=this,j=g.config.effect;(c.isFunction(j)?j:b[j]).call(g,a,
d,function(){g._fireOnSwitch(e)},e,f)}})});
KISSY.add("switchable-circular",function(c,k){function h(o,s,t,u,w){var m=this;o=m.config;s=m.length;var x=m.activeIndex,v=o.scrollType===q,y=v?e:f,z=m.viewSize[v?0:1];v=-z*u;var B={},C,A=w===r;if(C=A&&x===0&&u===s-1||w===p&&x===s-1&&u===0)v=l.call(m,m.panels,u,A,y,z);B[y]=v+j;m.anim&&m.anim.stop();m.anim=(new c.Anim(m.content,B,o.duration,o.easing,function(){C&&i.call(m,m.panels,u,A,y,z);m.anim=k;t()})).run()}function l(o,s,t,u,w){var m=this.config.steps;s=this.length;var x=t?s-1:0,v=(x+1)*m;for(m=
x*m;m<v;m++){b.css(o[m],a,d);b.css(o[m],u,(t?-1:1)*w*s)}return t?w:-w*s}function i(o,s,t,u,w){var m=this.config.steps;s=this.length;var x=t?s-1:0,v=(x+1)*m;for(m=x*m;m<v;m++){b.css(o[m],a,g);b.css(o[m],u,g)}b.css(this.content,u,t?-w*(s-1):g)}var b=c.DOM,a="position",d="relative",e="left",f="top",g="",j="px",p="forward",r="backward",q="scrollx",n=c.Switchable;c.mix(n.Config,{circular:false});n.Plugins.push({name:"circular",init:function(o){o=o.config;if(o.circular&&(o.effect===q||o.effect==="scrolly")){o.scrollType=
o.effect;o.effect=h}}})});
KISSY.add("switchable-lazyload",function(c){var k=c.DOM,h="beforeSwitch",l="img-src",i="area-data",b={},a=c.Switchable;b[l]="data-ks-lazyload-custom";b[i]="ks-datalazyload-custom";c.mix(a.Config,{lazyDataType:i});a.Plugins.push({name:"lazyload",init:function(d){function e(q){var n=j.steps;q=q.toIndex*n;g.loadCustomLazyData(d.panels.slice(q,q+n),p);f()&&d.detach(h,e)}function f(){var q,n,o,s=p===l;if(q=s?"img":p===i?"textarea":""){q=c.query(q,d.container);n=0;for(o=q.length;n<o;n++)if(s?k.attr(q[n],
r):k.hasClass(q[n],r))return false}return true}var g=c.DataLazyload,j=d.config,p=j.lazyDataType,r=b[p];!g||!p||!r||d.on(h,e)}})});
KISSY.add("switchable-countdown",function(c,k){var h=c.DOM,l=c.Event,i=c.Anim,b=c.Switchable;c.mix(b.Config,{countdown:false,countdownFromStyle:"",countdownToStyle:"width: 0"});b.Plugins.push({name:"countdown",init:function(a){function d(n){if(n===k)n=a.activeIndex;e();q=(new i(j[n],r,g-0.5)).run()}function e(){if(q){q.stop();q=k}}var f=a.config,g=f.interval,j=[],p=f.countdownFromStyle,r=f.countdownToStyle,q;if(!(!f.autoplay||!f.hasTriggers||!f.countdown)){c.each(a.triggers,function(n,o){n.innerHTML=
'<div class="ks-switchable-trigger-mask"></div><div class="ks-switchable-trigger-content">'+n.innerHTML+"</div>";j[o]=n.firstChild});if(f.pauseOnHover){l.on(a.container,"mouseenter",function(){e();var n=j[a.activeIndex];if(p)q=(new i(n,p,0.2,"easeOut")).run();else h.removeAttr(n,"style")});l.on(a.container,"mouseleave",function(){e();h.removeAttr(j[a.activeIndex],"style");setTimeout(function(){d()},200)})}a.on("beforeSwitch",function(){e();h.removeAttr(j[a.activeIndex],"style")});a.on("switch",function(n){a.paused||
d(n.currentIndex)});d()}}})});KISSY.add("switchable-autorender",function(c){c.Switchable.autoRender=function(k,h,l){h="."+(h||"KS_");l=l||"data-ks-switchable";c.each(["Switchable","Tabs","Slide","Carousel","Accordion"],function(i){c.each(c.query(h+i,k),function(b){try{var a=b.getAttribute(l);if(a)a=a.replace(/'/g,'"');new c[i](b,c.JSON.parse(a))}catch(d){c.log("Switchable.autoRender: "+d,"warn")}})})}});
KISSY.add("tabs",function(c){function k(h,l){if(!(this instanceof k))return new k(h,l);k.superclass.constructor.call(this,h,l)}c.extend(k,c.Switchable);c.Tabs=k});KISSY.add("slide",function(c){function k(l,i){if(!(this instanceof k))return new k(l,i);k.superclass.constructor.call(this,l,c.merge(h,i))}var h={autoplay:true,circular:true};c.extend(k,c.Switchable);c.Slide=k});
KISSY.add("carousel",function(c,k){function h(g,j){var p=this;if(!(p instanceof h))return new h(g,j);p.on("init",function(){l(p)});h.superclass.constructor.call(p,g,c.merge(f,j))}function l(g){var j=g.config,p=j.disableBtnCls;c.each(["prev","next"],function(r){var q=g[r+"Btn"]=c.get(a+j[r+"BtnCls"],g.container);b.on(q,"click",function(n){n.preventDefault();i.hasClass(q,p)||g[r]()})});j.circular||g.on("switch",function(r){r=r.currentIndex;r=r===0?g[d]:r===g.length-1?g[e]:k;i.removeClass([g[d],g[e]],
p);r&&i.addClass(r,p)});b.on(g.panels,"click focus",function(){g.fire("itemSelected",{item:this})})}var i=c.DOM,b=c.Event,a=".",d="prevBtn",e="nextBtn",f={circular:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};c.extend(h,c.Switchable);c.Carousel=h});
KISSY.add("accordion",function(c){function k(i,b){if(!(this instanceof k))return new k(i,b);k.superclass.constructor.call(this,i,c.merge(l,b))}var h=c.DOM,l={markupType:1,triggerType:"click",multiple:false};c.extend(k,c.Switchable);c.Accordion=k;c.augment(k,{_triggerIsValid:function(i){return this.activeIndex!==i||this.config.multiple},_switchView:function(i,b,a){var d=this.config,e=b[0];if(d.multiple){h.toggleClass(this.triggers[a],d.activeTriggerCls);h.css(e,"display",e.style.display=="none"?"block":
"none");this._fireOnSwitch(a)}else k.superclass._switchView.call(this,i,b,a)}})});
