/*
Copyright 2010, KISSY UI Library v1.1.4
MIT Licensed
build time: Sep 14 22:46
*/
KISSY.add("date",function(f){function i(a){var b=null;if(b instanceof Date)return b;else b=new Date(a);return b instanceof Date&&b!="Invalid Date"&&!isNaN(b)?b:null}var l=function(){var a=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c=function(e,h){e=String(e);for(h=h||2;e.length<h;)e="0"+e;return e},g={"default":"ddd mmm dd yyyy HH:MM:ss",
shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLangDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",
localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},j={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October",
"November","December"]};return function(e,h,o){if(arguments.length==1&&Object.prototype.toString.call(e)=="[object String]"&&!/\d/.test(e)){h=e;e=undefined}e=e?new Date(e):new Date;if(isNaN(e))throw SyntaxError("invalid date");h=String(g[h]||h||g["default"]);if(h.slice(0,4)=="UTC:"){h=h.slice(4);o=true}var k=o?"getUTC":"get",n=e[k+"Date"](),r=e[k+"Day"](),p=e[k+"Month"](),t=e[k+"FullYear"](),m=e[k+"Hours"](),u=e[k+"Minutes"](),v=e[k+"Seconds"]();k=e[k+"Milliseconds"]();var s=o?0:e.getTimezoneOffset(),
w={d:n,dd:c(n),ddd:j.dayNames[r],dddd:j.dayNames[r+7],w:j.dayNames[r+14],m:p+1,mm:c(p+1),mmm:j.monthNames[p],mmmm:j.monthNames[p+12],yy:String(t).slice(2),yyyy:t,h:m%12||12,hh:c(m%12||12),H:m,HH:c(m),M:u,MM:c(u),s:v,ss:c(v),l:c(k,3),L:c(k>99?Math.round(k/10):k),t:m<12?"a":"p",tt:m<12?"am":"pm",T:m<12?"A":"P",TT:m<12?"AM":"PM",Z:o?"UTC":(String(e).match(b)||[""]).pop().replace(d,""),o:(s>0?"-":"+")+c(Math.floor(Math.abs(s)/60)*100+Math.abs(s)%60,4),S:["th","st","nd","rd"][n%10>3?0:(n%100-n%10!=10)*
n%10]};return h.replace(a,function(q){return q in w?w[q]:q.slice(1,q.length-1)})}}();f.Date={format:function(a,b,d){return l(a,b,d)},parse:function(a){return i(a)}}});
KISSY.add("calendar",function(f,i){function l(a,b){this._init(a,b)}f.augment(l,{_init:function(a,b){this.id=this.C_Id=a;this._buildParam(b);if(this.popup){this.trigger=f.one("#"+a);this.C_Id="C_"+Math.random().toString().replace(/.\./i,"");this.con=f.Node('<div id="'+this.C_Id+'"></div>');f.one("body").append(this.con);this.con.css({top:"0px",position:"absolute",background:"white",visibility:"hidden"})}else this.con=f.one("#"+a);a=new Function;f.augment(a,f.EventTarget);a=new a;f.mix(this,a);this.render();
this._buildEvent();return this},render:function(a){var b=0,d,c;a=a||{};this._parseParam(a);this.ca=[];this.con.addClass("ks-cal-call ks-clearfix multi-"+this.pages);this.con.html("");b=0;for(c=[this.year,this.month];b<this.pages;b++){if(b==0)a=true;else{a=false;c=this._computeNextMonth(c)}d=b==this.pages-1;this.ca.push(new this.Page({year:c[0],month:c[1],prev_arrow:a,next_arrow:d,showTime:this.showTime},this));this.ca[b].render()}return this},_showdate:function(a,b){a=new Date(b-0+a*864E5);a=a.getFullYear()+
"/"+(a.getMonth()+1)+"/"+a.getDate();return new Date(a)},_buildEvent:function(){var a=this;if(!a.popup)return this;for(var b=0;b<a.EV.length;b++)a.EV[b]!==i&&a.EV[b].detach();a.EV[0]=f.one("body").on("click",function(d){d.target=f.Node(d.target);if(d.target.attr("id")!=a.C_Id)if(!((d.target.hasClass("next")||d.target.hasClass("prev"))&&d.target[0].tagName=="A"))if(d.target.attr("id")!=a.id)f.DOM.contains(f.one("#"+a.C_Id),d.target)||a.hide()});for(b=0;b<a.triggerType.length;b++)a.EV[1]=f.one("#"+
a.id).on(a.triggerType[b],function(d){d.target=f.Node(d.target);d.preventDefault();var c=a.triggerType;if(f.inArray("click",c)&&f.inArray("focus",c))d.type=="focus"&&a.toggle();else if(f.inArray("click",c)&&!f.inArray("focus",c))d.type=="click"&&a.toggle();else!f.inArray("click",c)&&f.inArray("focus",c)?setTimeout(function(){a.toggle()},170):a.toggle()});return this},toggle:function(){this.con.css("visibility")=="hidden"?this.show():this.hide()},show:function(){this.con.css("visibility","");var a=
this.trigger.offset().left,b=this.trigger[0].offsetHeight||this.trigger.height();b=this.trigger.offset().top+b;this.con.css("left",a.toString()+"px");this.con.css("top",b.toString()+"px");return this},hide:function(){this.con.css("visibility","hidden");return this},_buildParam:function(a){function b(j,e){var h=a[e];d[e]=h===i||h==null?j:h}var d=this;if(a===i||a==null)a={};f.each({date:new Date,startDay:0,pages:1,closable:false,rangeSelect:false,minDate:false,maxDate:false,multiSelect:false,navigator:true,
arrow_left:false,arrow_right:false,popup:false,showTime:false,triggerType:["click"]},b);b(d.date,"selected");if(a.startDay)d.startDay=(7-a.startDay)%7;if(a.range!==i&&a.range!=null){var c=d._showdate(1,new Date(a.range.start.getFullYear()+"/"+(a.range.start.getMonth()+1)+"/"+a.range.start.getDate())),g=d._showdate(1,new Date(a.range.end.getFullYear()+"/"+(a.range.end.getMonth()+1)+"/"+a.range.end.getDate()));d.range={start:c,end:g}}else d.range={start:null,end:null};d.EV=[];return this},_parseParam:function(a){var b;
if(a===i||a==null)a={};for(b in a)this[b]=a[b];this._handleDate();return this},_templetShow:function(a,b){var d,c,g,j;if(b instanceof Array){d="";for(c=0;c<b.length;c++)d+=arguments.callee(a,b[c]);a=d}else{d=a.match(/{\$(.*?)}/g);if(b!==i&&d!=null){c=0;for(g=d.length;c<g;c++){j=d[c].replace(/({\$)|}/g,"");j=b[j]!==i?b[j]:"";a=a.replace(d[c],j)}}}return a},_handleDate:function(){var a=this.date;this.weekday=a.getDay()+1;this.day=a.getDate();this.month=a.getMonth();this.year=a.getFullYear();return this},
_getHeadStr:function(a,b){return a.toString()+"\u5e74"+(Number(b)+1).toString()+"\u6708"},_monthAdd:function(){if(this.month==11){this.year++;this.month=0}else this.month++;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/"+this.day.toString());return this},_monthMinus:function(){if(this.month==0){this.year--;this.month=11}else this.month--;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/"+this.day.toString());return this},_computeNextMonth:function(a){var b=
a[0];a=a[1];if(a==11){b++;a=0}else a++;return[b,a]},_handleOffset:function(){var a=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],b=this.startDay,d="";d=[];for(var c=0;c<7;c++)d[c]={day:a[(c-b+7)%7]};d=this._templetShow("<span>{$day}</span>",d);return{day_html:d}},_handleRange:function(a){if(this.range.start==null&&this.range.end==null||this.range.start!=null&&this.range.end!=null){this.range.start=a;this.range.end=null;this.render()}else if(this.range.start!=null&&this.range.end==
null){this.range.end=a;if(this.range.start.getTime()>this.range.end.getTime()){a=this.range.start;this.range.start=this.range.end;this.range.end=a}this.fire("rangeSelect",this.range);this.render()}return this}});f.Calendar=l},{requires:["core"]});
KISSY.add("calendar-page",function(f){f.augment(f.Calendar,{Page:function(i,l){this.fathor=l;this.month=Number(i.month);this.year=Number(i.year);this.prev_arrow=i.prev_arrow;this.next_arrow=i.next_arrow;this.timmer=this.node=null;this.id="";this.EV=[];this.html=['<div class="ks-cal-box" id="{$id}"><div class="ks-cal-hd"><a href="javascript:void(0);" class="prev {$prev}"><</a><a href="javascript:void(0);" class="title">{$title}</a><a href="javascript:void(0);" class="next {$next}">></a></div><div class="ks-cal-bd"><div class="whd">',
l._handleOffset().day_html,'</div><div class="dbd ks-clearfix">{$ds}</div></div><div class="ks-setime hidden"></div><div class="ks-cal-ft {$showtime}"><div class="ks-cal-time">\u65f6\u95f4\uff1a00:00 \t&hearts;</div></div><div class="ks-selectime hidden"><!--\u7528\u4ee5\u5b58\u653e\u70b9\u9009\u65f6\u95f4\u7684\u4e00\u4e9b\u5173\u952e\u503c--\></div></div><!--#ks-cal-box--\>'].join("");this.nav_html='<p>\u6708<select value="{$the_month}"><option class="m1" value="1">01</option><option class="m2" value="2">02</option><option class="m3" value="3">03</option><option class="m4" value="4">04</option><option class="m5" value="5">05</option><option class="m6" value="6">06</option><option class="m7" value="7">07</option><option class="m8" value="8">08</option><option class="m9" value="9">09</option><option class="m10" value="10">10</option><option class="m11" value="11">11</option><option class="m12" value="12">12</option></select></p><p>\u5e74<input type="text" value="{$the_year}" onfocus="this.select()"/></p><p><button class="ok">\u786e\u5b9a</button><button class="cancel">\u53d6\u6d88</button></p>';
this.Verify=function(){return{isDay:function(a){if(!/\d+/i.test(a))return false;a=Number(a);return!(a<1||a>31)},isYear:function(a){if(!/\d+/i.test(a))return false;a=Number(a);return!(a<100||a>1E4)},isMonth:function(a){if(!/\d+/i.test(a))return false;a=Number(a);return!(a<1||a>12)}}};this._renderUI=function(){var a={};this.HTML="";a.prev="";a.next="";a.title="";a.ds="";if(!this.prev_arrow)a.prev="hidden";if(!this.next_arrow)a.next="hidden";if(!this.fathor.showtime)a.showtime="hidden";a.id=this.id=
"ks-cal-"+Math.random().toString().replace(/.\./i,"");a.title=this.fathor._getHeadStr(this.year,this.month);this.createDS();a.ds=this.ds;this.fathor.con.append(this.fathor._templetShow(this.html,a));this.node=f.one("#"+this.id);if(this.fathor.showTime){a=this.node.one(".ks-cal-ft");a.removeClass("hidden");this.timmer=new this.fathor.TimeSelector(a,this.fathor)}return this};this._buildEvent=function(){var a=this,b,d=f.one("#"+a.id);for(b=0;b<a.EV.length;b++)typeof a.EV[b]!="undefined"&&a.EV[b].detach();
a.EV[0]=d.one("div.dbd").on("click",function(c){c.preventDefault();c.target=f.Node(c.target);if(!c.target.hasClass("null"))if(!c.target.hasClass("disabled")){c=Number(c.target.html());var g=new Date;g.setDate(c);g.setMonth(a.month);g.setYear(a.year);a.fathor.dt_date=g;a.fathor.fire("select",{date:g});a.fathor.popup&&a.fathor.closable&&a.fathor.hide();a.fathor.rangeSelect&&a.fathor._handleRange(g);a.fathor.render({selected:g})}});a.EV[1]=d.one("a.prev").on("click",function(c){c.preventDefault();a.fathor._monthMinus().render();
a.fathor.fire("monthChange",{date:new Date(a.fathor.year+"/"+(a.fathor.month+1)+"/01")})});a.EV[2]=d.one("a.next").on("click",function(c){c.preventDefault();a.fathor._monthAdd().render();a.fathor.fire("monthChange",{date:new Date(a.fathor.year+"/"+(a.fathor.month+1)+"/01")})});if(a.fathor.navigator){a.EV[3]=d.one("a.title").on("click",function(c){try{a.timmer.hidePopup();c.preventDefault()}catch(g){}c.target=f.Node(c.target);c=d.one(".ks-setime");c.html("");var j=a.fathor._templetShow(a.nav_html,
{the_month:a.month+1,the_year:a.year});c.html(j);c.removeClass("hidden");d.one("input").on("keydown",function(e){e.target=f.Node(e.target);if(e.keyCode==38){e.target.val(Number(e.target.val())+1);e.target[0].select()}if(e.keyCode==40){e.target.val(Number(e.target.val())-1);e.target[0].select()}if(e.keyCode==13){e=d.one(".ks-setime").one("select").val();var h=d.one(".ks-setime").one("input").val();d.one(".ks-setime").addClass("hidden");if(a.Verify().isYear(h))if(a.Verify().isMonth(e)){a.fathor.render({date:new Date(h+
"/"+e+"/01")});a.fathor.fire("monthChange",{date:new Date(h+"/"+e+"/01")})}}})});a.EV[4]=d.one(".ks-setime").on("click",function(c){c.preventDefault();c.target=f.Node(c.target);if(c.target.hasClass("ok")){c=d.one(".ks-setime").one("select").val();var g=d.one(".ks-setime").one("input").val();d.one(".ks-setime").addClass("hidden");if(a.Verify().isYear(g))if(a.Verify().isMonth(c)){a.fathor.render({date:new Date(g+"/"+c+"/01")});a.fathor.fire("monthChange",{date:new Date(g+"/"+c+"/01")})}}else c.target.hasClass("cancel")&&
d.one(".ks-setime").addClass("hidden")})}return this};this._getNode=function(){return this.node};this._getNumOfDays=function(a,b){return 32-(new Date(a,b-1,32)).getDate()};this.createDS=function(){var a="",b=((new Date(this.year+"/"+(this.month+1)+"/01")).getDay()+this.fathor.startDay+7)%7,d=this._getNumOfDays(this.year,this.month+1)+b,c,g;for(c=0;c<d;c++){g=/532/.test(f.UA.webkit)?new Date(this.year+"/"+Number(this.month+1)+"/"+(c+1-b).toString()):new Date(this.year+"/"+Number(this.month+1)+"/"+
(c+2-b).toString());var j=new Date(this.year+"/"+Number(this.month+1)+"/"+(c+1-b).toString());a+=c<b?'<a href="javascript:void(0);" class="null">0</a>':this.fathor.minDate instanceof Date&&(new Date(this.year+"/"+(this.month+1)+"/"+(c+2-b))).getTime()<this.fathor.minDate.getTime()+1?'<a href="javascript:void(0);" class="disabled">'+(c-b+1)+"</a>":this.fathor.maxDate instanceof Date&&(new Date(this.year+"/"+(this.month+1)+"/"+(c+1-b))).getTime()>this.fathor.maxDate.getTime()?'<a href="javascript:void(0);" class="disabled">'+
(c-b+1)+"</a>":this.fathor.range.start!=null&&this.fathor.range.end!=null&&g.getTime()>=this.fathor.range.start.getTime()&&j.getTime()<this.fathor.range.end.getTime()?c==b+(new Date).getDate()-1&&(new Date).getFullYear()==this.year&&(new Date).getMonth()==this.month?'<a href="javascript:void(0);" class="range today">'+(c-b+1)+"</a>":'<a href="javascript:void(0);" class="range">'+(c-b+1)+"</a>":c==b+(new Date).getDate()-1&&(new Date).getFullYear()==this.year&&(new Date).getMonth()==this.month?'<a href="javascript:void(0);" class="today">'+
(c-b+1)+"</a>":c==b+this.fathor.selected.getDate()-1&&this.month==this.fathor.selected.getMonth()&&this.year==this.fathor.selected.getFullYear()?'<a href="javascript:void(0);" class="selected">'+(c-b+1)+"</a>":'<a href="javascript:void(0);">'+(c-b+1)+"</a>"}if(d%7!=0)for(c=0;c<7-d%7;c++)a+='<a href="javascript:void(0);" class="null">0</a>';this.ds=a;return this};this.render=function(){this._renderUI();this._buildEvent();return this}}})},{host:"calendar"});
KISSY.add("calendar-time",function(f){f.augment(f.Calendar,{TimeSelector:function(i,l){this.fathor=l;this.fcon=i.parent(".ks-cal-box");this.popupannel=this.fcon.one(".ks-selectime");if(typeof l._time=="undefined")l._time=new Date;this.time=l._time;this.status="s";this.ctime=f.Node('<div class="ks-cal-time">\u65f6\u95f4\uff1a<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--\><div class="cta"><button class="u"></button><button class="d"></button></div><!--arrow}}--\></div>');
this.button=f.Node('<button class="ct-ok">\u786e\u5b9a</button>');this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];this.m_a=["00","10","20","30","40","50"];this.s_a=["00","10","20","30","40","50"];this.parseSubHtml=function(a){for(var b="",d=0;d<a.length;d++)b+='<a href="javascript:void(0);" class="item">'+a[d]+"</a>";b+='<a href="javascript:void(0);" class="x">x</a>';return b};this.showPopup=function(a){this.popupannel.html(a);
this.popupannel.removeClass("hidden");a=this.status;this.ctime.all("span").removeClass("on");switch(a){case "h":this.ctime.all(".h").addClass("on");break;case "m":this.ctime.all(".m").addClass("on");break;case "s":this.ctime.all(".s").addClass("on");break}};this.hidePopup=function(){this.popupannel.addClass("hidden")};this.render=function(){var a=this.get("h"),b=this.get("m"),d=this.get("s");this.fathor._time=this.time;this.ctime.all(".h").html(a);this.ctime.all(".m").html(b);this.ctime.all(".s").html(d);
return this};this.set=function(a,b){b=Number(b);switch(a){case "h":this.time.setHours(b);break;case "m":this.time.setMinutes(b);break;case "s":this.time.setSeconds(b);break}this.render()};this.get=function(a){var b=this.time;switch(a){case "h":return b.getHours();case "m":return b.getMinutes();case "s":return b.getSeconds()}};this.add=function(){var a=this.status,b=this.get(a);b++;this.set(a,b)};this.minus=function(){var a=this.status,b=this.get(a);b--;this.set(a,b)};this._init=function(){var a=this;
i.html("").append(a.ctime);i.append(a.button);a.render();a.popupannel.on("click",function(b){b=f.Node(b.target);if(b.hasClass("x"))a.hidePopup();else if(b.hasClass("item")){b=Number(b.html());a.set(a.status,b);a.hidePopup()}});a.button.on("click",function(){var b=typeof a.fathor.dt_date=="undefined"?a.fathor.date:a.fathor.dt_date;b.setHours(a.get("h"));b.setMinutes(a.get("m"));b.setSeconds(a.get("s"));a.fathor.fire("timeSelect",{date:b});a.fathor.popup&&a.fathor.closable&&a.fathor.hide()});a.ctime.on("keyup",
function(b){if(b.keyCode==38||b.keyCode==37){b.preventDefault();a.add()}if(b.keyCode==40||b.keyCode==39){b.preventDefault();a.minus()}});a.ctime.one(".u").on("click",function(){a.hidePopup();a.add()});a.ctime.one(".d").on("click",function(){a.hidePopup();a.minus()});a.ctime.one(".h").on("click",function(){var b=a.parseSubHtml(a.h_a);a.status="h";a.showPopup(b)});a.ctime.one(".m").on("click",function(){var b=a.parseSubHtml(a.m_a);a.status="m";a.showPopup(b)});a.ctime.one(".s").on("click",function(){var b=
a.parseSubHtml(a.s_a);a.status="s";a.showPopup(b)})};this._init()}})},{host:"calendar"});
