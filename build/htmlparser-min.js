/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Sep 28 14:48
*/
KISSY.add("htmlparser/Parser",function(b,c,f,j,a,h,k,l){function e(d,i){this.originalHtml=d=b.trim(d);d=/^(<!doctype|<html|<body)/i.test(d)?"<document>"+d+"</document>":"<body>"+d+"</body>";this.lexer=new h(d);this.opts=i||{}}function g(d){var i=q(d,"body",3);if(i){var d=i.parentNode,e=d.childNodes,a=b.indexOf(i,e);if(a!=e.length-1){e=e.slice(a+1,e.length);for(a=0;a<e.length;a++)d.removeChild(e[a]),"body"==e[a].tagName?b.each(e[a].childNodes,function(d){i.appendChild(d)}):i.appendChild(e[a])}}return i}
function d(d){var i=d.childNodes,e,a,b=c.p,h=0;for(a=0;a<i.length;a++)if(e=i[a],3==e.nodeType||1==e.nodeType&&b[e.nodeName]){h=1;break}if(h){var h=[],q=new f;q.nodeName=q.tagName="p";for(a=0;a<i.length;a++)e=i[a],3==e.nodeType||1==e.nodeType&&b[e.nodeName]?q.appendChild(e):(q.childNodes.length&&(h.push(q),q=q.clone()),h.push(e));q.childNodes.length&&h.push(q);d.empty();for(a=0;a<h.length;a++)d.appendChild(h[a])}}function q(d,i,e){if(0===e)return 0;b.isNumber(e)&&e--;var a=d.childNodes;if(a)for(var h=
0;h<a.length;h++){if(a[h].tagName===i)return a[h];if(d=q(a[h],i,e))return d}return 0}function i(d){for(var i=[].concat(d.childNodes),a=0;a<i.length;a++)if("html"==i[a].nodeName){for(var e=i[a],h=0;h<a;h++)3==i[h].nodeType&&!b.trim(i[h].toHtml())&&d.removeChild(i[h]);for(;e.firstChild&&3==e.firstChild.nodeType&&!b.trim(e.firstChild.toHtml());)e.removeChild(e.firstChild);break}}e.prototype={elements:function(){var a,e,h=this.lexer,q=this.opts;e=a=h.nextNode();"document"!=a.tagName&&(e=new k,e.appendChild(a));
e.nodeType=9;l.getScanner("div").scan(a,h,q);(a=g(e))&&q.autoParagraph&&d(a);i(e);var q=this.originalHtml,c=new j;e=/^(<!doctype|<html|<body)/i.test(q)?e.childNodes:a.childNodes;b.each(e,function(d){c.appendChild(d)});return c},parse:function(){return this.elements()}};return e},{requires:"./dtd,./nodes/Tag,./nodes/Fragment,./lexer/Cursor,./lexer/Lexer,./nodes/Document,./Scanner".split(",")});
KISSY.add("htmlparser/Scanner",function(b,c,f){return{getScanner:function(b){return f[b]||c}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(b){return b.replace(/[\s\xa0]+/g," ")},isLetter:function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b},isValidAttributeNameStartChar:function(b){return!this.isWhitespace(b)&&'"'!=b&&"'"!=b&&">"!=b&&"<"!=b&&"/"!=b&&"="!=b},isWhitespace:function(b){return/^[\s\xa0]$/.test(b)}}});
KISSY.add("htmlparser/dtd",function(b){var b=b.merge,c={isindex:1,fieldset:1},f={input:1,button:1,select:1,textarea:1,label:1},j=b({a:1},f),a=b({iframe:1},j),h={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},k={ins:1,del:1,script:1,style:1},l=b({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},k),e=b({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},l),g=b({p:1},e),f=b({iframe:1},e,f),e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},d=b({a:1},f),q={tr:1},i={"#text":1},r=b({param:1},e),n=b({form:1},c,a,h,g),o={li:1},m={base:1,link:1,meta:1,title:1},s=b(m,{style:1,script:1}),t={head:1,body:1},p={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},b={$nonBodyContent:b({html:1},t,m),$block:p,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:d,$body:b({script:1,style:1},
p),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:t,head:s,style:i,body:n,base:{},link:{},meta:{},title:i,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:n,td:n,br:{},th:n,center:n,kbd:d,button:b(g,h),basefont:{},h5:d,h4:d,samp:d,h6:d,ol:o,h1:d,h3:d,option:i,h2:d,form:b(c,a,h,g),select:{optgroup:1,option:1},font:d,ins:d,menu:o,abbr:d,label:d,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:d,script:i,tfoot:q,cite:d,
li:n,input:{},iframe:n,strong:d,textarea:i,noframes:n,big:d,small:d,span:d,hr:{},dt:d,sub:d,optgroup:{option:1},param:{},bdo:d,"var":d,div:n,object:r,sup:d,dd:n,strike:d,area:{},dir:o,map:b({area:1,form:1,p:1},c,k,h),applet:r,dl:{dt:1,dd:1},del:d,isindex:{},fieldset:b({legend:1},e),thead:q,ul:o,acronym:d,b:d,a:f,blockquote:n,caption:d,i:d,u:d,tbody:q,s:d,address:b(a,g),tt:d,legend:d,q:d,pre:b(l,j),p:d,em:d,dfn:d},j="article,figure,nav,aside,section,footer".split(","),u;for(u in b)for(var v in b[u])if("div"==
v)for(c=0;c<j.length;c++)b[u][j[c]]=b[u][v];for(c=0;c<j.length;c++)b[j[c]]=b.div;b.$empty["!doctype"]=1;return b});KISSY.add("htmlparser",function(b,c,f,j,a,h,k,l,e,g,d,q,i){return{CData:e,Comment:g,Node:d,Tag:q,Text:i,Lexer:f,Parser:j,BasicWriter:a,BeautifyWriter:h,MinifyWriter:k,Filter:l,DTD:c,serialize:function(d,e){var i=new a;d.writeHtml(i,e);return i.getHtml()},parse:function(d){return(new j(d)).parse()}}},{requires:"htmlparser/dtd,htmlparser/lexer/Lexer,htmlparser/Parser,htmlparser/writer/basic,htmlparser/writer/beautify,htmlparser/writer/minify,htmlparser/writer/filter,htmlparser/nodes/CData,htmlparser/nodes/Comment,htmlparser/nodes/Node,htmlparser/nodes/Tag,htmlparser/nodes/Text".split(",")});
KISSY.add("htmlparser/lexer/Cursor",function(){function b(b){this.position=b||0}b.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return b});
KISSY.add("htmlparser/lexer/Index",function(){function b(){this.lineCursors=[]}function c(b,a){for(var h=0;h<b.length;h++)if(b[h].position===a.position)return h;return-1}function f(b,a){for(var h=0;h<b.length&&!(b[h].position>a.position);h++);return h}b.prototype={add:function(b){-1==c(this.lineCursors,b)&&this.lineCursors.splice(f(this.lineCursors,b),0,b)},remove:function(b){var a=this.lineCursors,b=c(this.lineCursors,b);-1!=b&&a.splice(b,1)},row:function(b){return f(this.lineCursors,b)-1},col:function(b){var a=
f(this.lineCursors,b)-1;return b.position-this.lineCursors[a]}};return b});
KISSY.add("htmlparser/lexer/Lexer",function(b,c,f,j,a,h,k,l,e){function g(d){this.page=new f(d);this.cursor=new c;this.nodeFactory=this}g.prototype={setPosition:function(d){this.cursor.position=d},getPosition:function(){return this.cursor.position},nextNode:function(d){var e,i,a=this.cursor,b=this.page;e=a.position;i=b.getChar(a);switch(i){case -1:d=null;break;case "<":i=b.getChar(a);-1==i?d=this.makeString(e,a.position):"/"==i||h.isLetter(i)?(b.ungetChar(a),d=this.parseTag(e)):"!"==i||"?"==i?(i=
b.getChar(a),-1==i?d=this.makeString(e,a.position):">"==i?d=this.makeComment(e,a.position):(b.ungetChar(a),"-"==i?d=this.parseComment(e,d):(b.ungetChar(a),d=this.parseTag(e)))):(b.ungetChar(a),d=this.parseString(e,d));break;default:b.ungetChar(a),d=this.parseString(e,d)}return d},makeComment:function(d,e){var a;a=e-d;if(0!=a){if(2>a)return this.makeString(d,e);a=this.nodeFactory.createCommentNode(this.page,d,e)}else a=null;return a},makeString:function(d,a){var e=null;0<a-d&&(e=this.nodeFactory.createStringNode(this.page,
d,a));return e},makeCData:function(d,a){var e=null;0<a-d&&(e=this.nodeFactory.createCDataNode(this.page,d,a));return e},makeTag:function(d,a,e){var b;b=a-d;if(0!=b){if(2>b)return this.makeString(d,a);d=this.nodeFactory.createTagNode(this.page,d,a,e)}else d=null;return d},createTagNode:function(d,a,e,b){return new l(d,a,e,b)},createStringNode:function(d,a,e){return new j(d,a,e)},createCDataNode:function(d,e,i){return new a(d,e,i)},createCommentNode:function(d,a,i){return new e(d,a,i)},parseTag:function(d){var a,
e=[],b=[],g,j=this.page,m=0,c=this.cursor;for(e[0]=c.position;!a;)switch(e[m+1]=c.position,g=j.getChar(c),m){case 0:if(-1==g||">"==g||"<"==g)"<"==g&&(j.ungetChar(c),e[m+1]=c.position),a=!0;else if("/"==g||h.isValidAttributeNameStartChar(g))m=1;break;case 1:-1==g||">"==g||"<"==g?("<"==g&&(j.ungetChar(c),e[m+1]=c.getPosition),this.standalone(b,e),a=!0):h.isWhitespace(g)?(e[6]=e[2],m=6):"="==g&&(m=2);break;case 2:-1==g||">"==g?(this.standalone(b,e),a=!0):"'"==g?(m=4,e[4]=e[3]):'"'==g?(m=5,e[5]=e[3]):
h.isWhitespace(g)||(m=3);break;case 3:-1==g||">"==g?(this.naked(b,e),a=!0):h.isWhitespace(g)&&(this.naked(b,e),e[0]=e[4],m=0);break;case 4:-1==g?(this.single_quote(b,e),a=!0):"'"==g&&(this.single_quote(b,e),e[0]=e[5]+1,m=0);break;case 5:-1==g?(this.double_quote(b,e),a=!0):'"'==g&&(this.double_quote(b,e),e[0]=e[6]+1,m=0);break;case 6:-1==g?(this.standalone(b,e),e[0]=e[6],j.ungetChar(c),m=0):h.isWhitespace(g)||("="==g?(e[2]=e[6],e[3]=e[7],m=2):(this.standalone(b,e),e[0]=e[6],j.ungetChar(c),m=0));break;
default:throw Error("how ** did we get in state "+m);}return this.makeTag(d,c.position,b)},parseComment:function(d,e){var a,b,g=this.page,j=this.cursor,c;a=!1;for(c=0;!a;)if(b=g.getChar(j),-1==b)a=!0;else switch(c){case 0:">"==b&&(a=!0);if("-"==b)c=1;else return this.parseString(d,e);break;case 1:if("-"==b)b=g.getChar(j),-1==b?a=!0:">"==b?a=!0:(g.ungetChar(j),c=2);else return this.parseString(d,e);break;case 2:if("-"==b)c=3;else if(-1==b)return this.parseString(d,e);break;case 3:c="-"==b?4:2;break;
case 4:">"==b?a=!0:h.isWhitespace(b)||(c=2);break;default:throw Error("how ** did we get in state "+c);}return this.makeComment(d,j.position)},parseString:function(e,a){for(var b=0,g,c=this.page,j=this.cursor,f=0;!b;)if(g=c.getChar(j),-1==g)b=1;else if(a&&0==f&&("'"==g||'"'==g))f=g;else if(a&&0!=f&&"\\"==g)g=c.getChar(j),-1!=g&&"\\"!=g&&g!=f&&c.ungetChar(j);else if(a&&g==f)f=0;else if(a&&0==f&&"/"==g)if(g=c.getChar(j),-1==g)b=1;else if("/"==g){do g=c.getChar(j);while(-1!=g&&"\n"!=g)}else if("*"==
g){do{do g=c.getChar(j);while(-1!=g&&"*"!=g);g=c.getChar(j);"*"==g&&c.ungetChar(j)}while(-1!=g&&"/"!=g)}else c.ungetChar(j);else if(0==f&&"<"==g)if(g=c.getChar(j),-1==g)b=1;else{if("/"==g||h.isLetter(g)||"!"==g||"?"==g)b=1,c.ungetChar(j);c.ungetChar(j)}return this.makeString(e,j.position)},parseCDATA:function(e,a){var b,g,c,j,f,l,k=this.cursor,p=this.page;b=k.position;g=0;c=!1;j="";for(l=!1;!c;)switch(f=p.getChar(k),g){case 0:switch(f){case -1:c=!0;break;case "'":e&&!l&&(""==j?j="'":"'"==j&&(j=""));
break;case '"':e&&!l&&(""==j?j='"':'"'==j&&(j=""));break;case "\\":e&&""!=j&&(f=p.getChar(k),-1==f?c=!0:"\\"!=f&&f!=j&&p.ungetChar(k));break;case "/":if(e&&""==j)if(f=p.getChar(k),-1==f)c=!0;else if("/"==f)l=!0;else if("*"==f){do{do f=p.getChar(k);while(-1!=f&&"*"!=f);f=p.getChar(k);"*"==f&&p.ungetChar(k)}while(-1!=f&&"/"!=f)}else p.ungetChar(k);break;case "\n":l=!1;break;case "<":e?""==j&&(g=1):g=1}break;case 1:switch(f){case -1:c=!0;break;case "/":g=!a||p.getText(k.position,k.position+a.length)===
a&&!p.getText(k.position+a.length,k.position+a.length+1).match(/\w/)?2:0;break;case "!":f=p.getChar(k);-1==f?c=!0:"-"==f?(f=p.getChar(k),-1==f?c=!0:g="-"==f?3:0):g=0;break;default:g=0}break;case 2:l=!1;-1==f?c=!0:h.isLetter(f)?(c=!0,p.ungetChar(k),p.ungetChar(k),p.ungetChar(k)):g=0;break;case 3:l=!1;-1==f?c=!0:"-"==f&&(f=p.getChar(k),-1==f?c=!0:"-"==f?(f=p.getChar(k),-1==f?c=!0:">"==f?g=0:(p.ungetChar(k),p.ungetChar(k))):p.ungetChar(k));break;default:throw Error("unexpected "+g);}return this.makeCData(b,
k.position)},single_quote:function(e,a){var b=this.page;e.push(new k(b.getText(a[1],a[2]),"=",b.getText(a[4]+1,a[5]),"'"))},double_quote:function(e,a){var b=this.page;e.push(new k(b.getText(a[1],a[2]),"=",b.getText(a[5]+1,a[6]),'"'))},standalone:function(e,a){e.push(new k(this.page.getText(a[1],a[2])))},naked:function(e,a){var b=this.page;e.push(new k(b.getText(a[1],a[2]),"=",b.getText(a[3],a[4])))}};return g},{requires:"./Cursor,./Page,../nodes/Text,../nodes/CData,../Utils,../nodes/Attribute,../nodes/Tag,../nodes/Comment".split(",")});
KISSY.add("htmlparser/lexer/Page",function(b,c){function f(b){this.source=b;this.lineIndex=new c}f.prototype={getChar:function(b){var a=this.source,h=b.position;if(h>=a.length)return-1;var c=a.charAt(h);b.advance();"\r"===c&&(c="\n",h=b.position,"\n"===a.charAt(h)&&b.advance());"\n"===c&&this.lineIndex.add(b);return c},ungetChar:function(b){var a=this.source;b.retreat();var h=b.position,c=a.charAt(h);"\n"===c&&0!=h&&(c=a.charAt(h-1),"\r"===c&&b.retreat())},getText:function(b,a){return this.source.slice(b,
a)},row:function(b){return this.lineIndex.row(b)},col:function(b){return this.lineIndex.col(b)}};return f},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(b){function c(b,c,a,h){this.nodeType=2;this.name=b;this.assignMent=c;this.value=a;this.quote=h}b.augment(c,{clone:function(){var f=new c;b.mix(f,this);return f},equals:function(b){return this.name==b.name&&this.value==b.value&&this.nodeType==b.nodeType}});c.prototype.clone=function(){var f=new c;b.mix(f,this);return f};return c});
KISSY.add("htmlparser/nodes/CData",function(b,c){function f(){f.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}b.extend(f,c,{writeHtml:function(b,a){var h;if(!a||!1!==(h=a.onCData(this)))h&&this!==h?h.writeHtml(b,a):b.cdata(this.toHtml())}});return f},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(b,c){function f(){f.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}b.extend(f,c,{writeHtml:function(b,a){var h;if(!a||!1!==(h=a.onComment(this)))h&&this!==h?h.writeHtml(b,a):b.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var b=c.superclass.toHtml.apply(this,arguments);return b.substring(4,b.length-3)}});return f},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Document",function(b,c){function f(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}b.extend(f,c,{writeHtml:function(b,a){this.__filter=a;this._writeChildrenHtml(b)}});return f},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Fragment",function(b,c){function f(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}b.extend(f,c,{writeHtml:function(b,a){this.__filter=a;this.isChildrenFiltered=0;if(a)a.onFragment(this);this._writeChildrenHtml(b)}});return f},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(b){function c(b){var a=0;b.replace(/\n/g,function(){a++});return a}function f(f,a,h){this.parentNode=null;this.page=f;this.startPosition=a;this.endPosition=h;this.nextSibling=this.previousSibling=this.nodeName=null;f&&(this.startLine=c(this.page.getText(0,a)),this.endLine=c(this.page.getText(0,h)));b.Config.debug&&(this.toHtmlContent=this.toHtml())}f.prototype={toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,
this.endPosition)},toString:function(){var b=[];b.push(this.nodeName+"  [ "+this.startPosition+"|"+this.startLine+" : "+this.endPosition+"|"+this.endLine+" ]\n");b.push(this.toHtml());return b.join("")}};return f});
KISSY.add("htmlparser/nodes/Tag",function(b,c,f,j){function a(e,a,d){e.nodeName=e.tagName=a.toLowerCase();e._updateSelfClosed();b.each(d,function(a,b){e.setAttribute(b,a)})}function h(e,g,d,c){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=c||[];this.nodeType=1;if(b.isString(e))a.apply(null,[this].concat(b.makeArray(arguments)));else{h.superclass.constructor.apply(this,arguments);c=this.attributes;c[0]&&(this.nodeName=c[0].name.toLowerCase(),this.tagName=this.nodeName.replace(/\//,
""),this._updateSelfClosed(),c.splice(0,1));var f=c[c.length-1];if(f=!(!f||!/\/$/.test(f.name)))c.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||f}this.closedEndPosition=this.closedStartPosition=-1}function k(e){var a=e.childNodes;e.firstChild=a[0];e.lastChild=a[a.length-1];1<=a.length&&(a[0].nextSibling=a[0].nextSibling=null,a[0].parentNode=e);if(1<a.length){for(var b=0;b<a.length-1;b++)a[b].nextSibling=a[b+1],a[b+1].previousSibling=a[b],a[b+1].parentNode=e;a[a.length-1].nextSibling=
null}}function l(a,b){for(var d=0;d<a.length;d++)if(a[d].name==b)return a[d];return null}b.extend(h,c,{_updateSelfClosed:function(){this.isSelfClosed=!!j.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var a=new h,g=[];b.each(this.attributes,function(a){g.push(a.clone())});b.mix(a,{childNodes:[],firstChild:null,lastChild:null,attributes:g,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,
closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return a},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!=a.nodeName||this.nodeType!=a.nodeType||this.attributes.length!=a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(a){this.childNodes.push(a);
k(this)},replace:function(a){var c=a.parentNode.childNodes,d=b.indexOf(a,c);c[d]=this;k(a.parentNode)},replaceChild:function(a,c){var d=this.childNodes,h=b.indexOf(c,d);d[h]=a;k(this)},prepend:function(a){this.childNodes.unshift(a);k(this)},insertBefore:function(a){var c=a.parentNode.childNodes,d=b.indexOf(a,c);c.splice(d,0,this);k(a.parentNode)},insertAfter:function(a){var c=a.parentNode.childNodes,d=b.indexOf(a,c);d==c.length-1?a.parentNode.appendChild(this):this.insertBefore(a.parentNode.childNodes[[d+
1]])},empty:function(){this.childNodes=[];k(this)},removeChild:function(a){var c=a.parentNode.childNodes,d=b.indexOf(a,c);c.splice(d,1);k(a.parentNode)},getAttribute:function(a){return(a=l(this.attributes,a))&&a.value},setAttribute:function(a,b){var d=l(this.attributes,a);d?d.value=b:this.attributes.push(new f(a,"=",b,'"'))},removeAttribute:function(a){(a=l(this.attributes,a))&&this.attributes.splice(b.indexOf(a,this.attributes),1)},filterChildren:function(){var a=this;if(!a.isChildrenFiltered){var c=
new (b.require("htmlparser/writer/basic"));a._writeChildrenHtml(c);c=(new (b.require("htmlparser/Parser"))(c.getHtml())).parse().childNodes;a.empty();b.each(c,function(b){a.appendChild(b)});a.isChildrenFiltered=1}},writeHtml:function(a,b){var d=this,c;c=d.tagName;if("!doctype"==c)a.append(this.toHtml()+"\n");else{d.__filter=b;d.isChildrenFiltered=0;if(b){if(!(c=b.onTagName(c)))return;d.tagName=c;c=b.onTag(d);if(!1===c)return;c&&(d=c);if(1!==d.nodeType){d.writeHtml(a,b);return}if(!d.tagName){d._writeChildrenHtml(a);
return}}a.openTag(d);for(var h=d.attributes,f=0;f<h.length;f++){var j=h[f];c=j.name;if(b){if(!(c=b.onAttributeName(c,d)))continue;j.name=c;if(!1===b.onAttribute(j,d))continue}a.attribute(j,d)}a.openTagClose(d);d.isSelfClosed||(d._writeChildrenHtml(a),a.closeTag(d))}},_writeChildrenHtml:function(a){var c=this.isChildrenFiltered?0:this.__filter;b.each(this.childNodes,function(b){b.writeHtml(a,c)})}});return h},{requires:["./Node","./Attribute","../dtd"]});
KISSY.add("htmlparser/nodes/Text",function(b,c){function f(c){b.isString(c)?(this.nodeValue=c,f.superclass.constructor.apply(this,[null,-1,-1])):(f.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}b.extend(f,c,{writeHtml:function(b,a){var c;if(!a||!1!==(c=a.onText(this)))c&&this!==c?c.writeHtml(b,a):b.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:f.superclass.toHtml.apply(this,arguments)}});return f},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(b,c,f){var f=c.parseCDATA(f.quoteSmart,b.nodeName),j=c.getPosition(),a=c.nextNode();a&&(1!=a.nodeType||!(a.isEndTag()&&a.tagName==b.tagName))&&c.setPosition(j);b.closed=!0;f&&b.appendChild(f)}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(b,c,f,j){var b={scan:function(a,b,f){f=f||{};f.quoteSmart=1;c.scan(a,b,f);f.quoteSmart=0}},a;for(a in f.$cdata)j[a]=b;return b},{requires:["./CdataScanner","../dtd","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(b,c,f,j){function a(e,g){function d(){l.childNodes.length&&(l.insertAfter(n),n=l,l=e.clone())}e.closed=1;if(!g.fixByDtd)return 0;var j=1,i=[].concat(e.childNodes);b.each(i,function(a){if(!h(e,a))return j=0,!1});if(j)return 0;for(var l=e.clone(),n=e,o=[],m=0;m<i.length;m++){var s=i[m];if(h(l,s))l.appendChild(s);else if(1==s.nodeType){var t=s.tagName;if(c.$listItem[t]){d();var s=k[s.tagName],p=new f;for(p.nodeName=p.tagName=s;m<i.length;){if(i[m].tagName==
t)p.appendChild(i[m]);else if((3!=i[m].nodeType||b.trim(i[m].toHtml()))&&3==i[m].nodeType)break;m++}p.insertAfter(n);n=p;m--}else d(),s.equals(l)?(s.insertAfter(n),n=s):h(s,l)?(l=e.clone(),b.each(s.childNodes,function(a){l.appendChild(a)}),s.empty(),s.insertAfter(n),n=s,s.appendChild(l),o.push(l),l=e.clone()):(s.insertAfter(n),n=s)}}l.childNodes.length&&l.insertAfter(n);e.parentNode.removeChild(e);b.each(o,function(b){a(b,g)});return 1}function h(a,b){return 9==a.nodeType||8==b.nodeType?1:!!c[a.tagName][b.tagName||
b.nodeName]}var k={li:"ul",dt:"dl",dd:"dl"},l={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(b,c,d){function h(c,f){for(n=c;n>f;n--){var g=o[n];o[n-1].appendChild(g);a(g,d)}b=o[f];o.length=f}function f(a){var b=0,d;if(d=l[a.tagName]){for(var c=o.length-1,e=o[c];e&&!(e.tagName in d);){if(e.tagName==a.tagName){b=1;break}c--;e=o[c]}b&&h(o.length-1,c-1)}return b}var k,n,o;o=d.stack=d.stack||[];do{if(k=c.nextNode())if(1===k.nodeType)if(k.isEndTag()&&k.tagName==
b.tagName)k=null;else if(k.isEndTag()){if(k.isEndTag()){var m=-1;for(n=o.length-1;0<=n;n--)if(o[n].tagName===k.tagName){m=n;break}-1!=m&&(o[o.length-1].appendChild(b),a(b,d),h(o.length-1,m),k=null)}}else j[k.tagName]?(j[k.tagName].scan(k,c,d),b.appendChild(k)):k.isSelfClosed?b.appendChild(k):(o.push(b),f(k)&&o.push(b),b=k);else b.appendChild(k);null==k&&0<o.length&&(k=o[o.length-1],j[k.tagName]?k=null:(o.length-=1,k.appendChild(b),a(b,d),b=k))}while(k);a(b,d)}}},{requires:["../dtd","../nodes/Tag",
"./SpecialScanners"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(b,c,f){return f.textarea={scan:function(b,a,h){h=h||{};c.scan(b,a,h)}}},{requires:["./CdataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function b(){this.output=[]}b.prototype={append:function(){for(var b=this.output,f=arguments,j,a=0;a<f.length;a++)if(j=f[a],1<j.length)for(var h=0;h<j.length;h++)b.push(j.charAt(h));else b.push(j);return this},openTag:function(b){this.append("<",b.tagName)},openTagClose:function(b){b.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(b){this.append("</",b.tagName,">")},attribute:function(b){this.append(" ",b.name,'="',(""+(b.value||
b.name)).replace(/"/g,"&quote;"),'"')},text:function(b){this.append(b)},cdata:function(b){this.append(b)},comment:function(b){this.append("<\!--"+b+"--\>")},getHtml:function(){return this.output.join("")}};return b});
KISSY.add("htmlparser/writer/beautify",function(b,c,f,j){function a(){a.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var c in b.merge(f.$nonBodyContent,f.$block,f.$listItem,f.$tableContent,{select:1,script:1,style:1}))this.setRules(c,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}b.extend(a,c,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(a,c){this.rules[a]||(this.rules[a]=
{});b.mix(this.rules[a],c)},openTag:function(b){var c=this.rules[b.tagName]||{};this.allowIndent?this.indentation():c.breakBeforeOpen&&(this.lineBreak(),this.indentation());a.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,c=this.rules[b]||{};a.isSelfClosed?this.append(" />"):(this.append(">"),c.allowIndent&&this.indentLevel++);c.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(b){var c=b.tagName,f=this.rules[c]||{};f.allowIndent&&this.indentLevel--;
this.allowIndent?this.indentation():f.breakBeforeClose&&(this.lineBreak(),this.indentation());a.superclass.closeTag.apply(this,arguments);"pre"===c&&(this.inPre=0);f.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=j.collapseWhitespace(a));this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(a){this.allowIndent&&this.indentation();this.append(b.trim(a))}});return a},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(b){function c(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function f(a,c){for(var f=0;a&&f<a.length;f++)b.each(a[f].value,function(a){c=c.replace(a[0],a[1])});return c}function j(a,b,c,f){for(var e=0;a&&e<a.length;e++){var g;if(!1===(g=a[e].value.apply(null,b)))return!1;if(f&&g&&g!=f)return this.onNode(g)}return c}c.prototype={addRules:function(a,b){var b=b||10,c;for(c in a)if(a.hasOwnProperty(c)){var f=
this[c];if(f){var e;a:{for(e=0;f&&e<f.length;e++)if(f[e].priority>b)break a;e=f.length}f.splice(e,0,{value:a[c],priority:b})}}},onTagName:function(a){return f(this.tagNames,a)},onAttributeName:function(a){return f(this.attributeNames,a)},onText:function(a){return j.call(this,this.text,[a.toHtml(),a],a,a)},onCData:function(a){return j.call(this,this.cdata,[a.toHtml(),a],a,a)},onAttribute:function(a,b){var c;a:{c=this.attributes;for(var f=0;c&&f<c.length;f++){var e=c[f].value,g,d=a.name;if(e[d]&&!1===
(g=e[d].call(null,a.value,b))){c=g;break a}"string"==typeof g&&(a.value=g)}c=a}return c},onComment:function(a){return j.call(this,this.comment,[a.toHtml(),a],a,a)},onNode:function(a){var b=a.nodeType;if(1===b)return this.onTag(a);if(3===b)return this.onText(a);if(8===b)return this.onComment(a)},onFragment:function(a){return j.call(this,this.root,[a],a,a)},onTag:function(a){for(var b=["^",a.tagName,"$"],c=this.tags,f,e=0;e<b.length;e++)for(var g=b[e],d=0;d<c.length;d++)if(f=c[d].value,f[g]){if(!1===
(f=f[g](a)))return!1;if(f&&f!=a)return this.onNode(f);if(!a.tagName)return a}return a}};return c});
KISSY.add("htmlparser/writer/minify",function(b,c,f){function j(){j.superclass.constructor.apply(this,arguments);this.inPre=0}var a=b.trim,h=f.collapseWhitespace,k=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");b.extend(j,c,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),j.superclass.comment.call(this,a))},openTag:function(a){"pre"==
a.tagName&&(this.inPre=1);j.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);j.superclass.closeTag.apply(this,arguments)},cdata:function(b){b=a(b).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");j.superclass.cdata.call(this,b)},attribute:function(b,c){var f=b.name,d,j=b.value||"";d=b.name;if(!(d=!a(b.value||"")?"input"===
c&&"value"===d||k.test(d):0)){d=c.nodeName;var i=b.name,r=b.value||"",r=a(r.toLowerCase());d="script"===d&&"language"===i&&"javascript"===r||"form"===d&&"method"===i&&"get"===r||"input"===d&&"type"===i&&"text"===r||"script"===d&&"type"===i&&"text/javascript"===r||"style"===d&&"type"===i&&"text/css"===r||"area"===d&&"shape"===i&&"rect"===r}if(!d)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(f))this.append(" ",f);else{d=c.nodeName;i=
b.name;r=b.value||"";/^on[a-z]+/.test(i)?r=a(r).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===i?r=h(a(r)):/^(?:a|area|link|base)$/.test(d)&&"href"===i||"img"===d&&/^(?:src|longdesc|usemap)$/.test(i)||"object"===d&&/^(?:classid|codebase|data|usemap)$/.test(i)||"q"===d&&"cite"===i||"blockquote"===d&&"cite"===i||("ins"===d||"del"===d)&&"cite"===i||"form"===d&&"action"===i||"input"===d&&("src"===i||"usemap"===i)||"head"===d&&"profile"===i||"script"===d&&("src"===i||"for"===
i)||/^(?:a|area|object|button)$/.test(d)&&"tabindex"===i||"input"===d&&("maxlength"===i||"tabindex"===i)||"select"===d&&("size"===i||"tabindex"===i)||"textarea"===d&&/^(?:rows|cols|tabindex)$/.test(i)||"colgroup"===d&&"span"===i||"col"===d&&"span"===i||("th"===d||"td"==d)&&("rowspan"===i||"colspan"===i)?r=a(r):"style"===i&&(r=a(r).replace(/[\s\xa0]*;[\s\xa0]*$/,""));d=(""+r).replace(/"/g,"&quote;");if(!j||/[ "'=<>`]/.test(j))d='"'+d+'"';this.append(" ",f,"=",d)}},text:function(a){this.inPre||(a=h(a));
this.append(a)}});return j},{requires:["./basic","../Utils"]});
