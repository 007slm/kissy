/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: Jun 25 23:37
*/
KISSY.add("htmlparser/Parser",function(a,j,i,d,b,f,k,n){function h(c,g){this.originalHtml=c=a.trim(c);c=/^(<!doctype|<html|<body)/i.test(c)?"<document>"+c+"</document>":"<body>"+c+"</body>";this.lexer=new f(c);this.opts=g||{}}function l(c){var g=q(c,"body",3);if(g){var c=g.parentNode,e=c.childNodes,h=a.indexOf(g,e);if(h!=e.length-1){e=e.slice(h+1,e.length);for(h=0;h<e.length;h++)c.removeChild(e[h]),"body"==e[h].tagName?a.each(e[h].childNodes,function(c){g.appendChild(c)}):g.appendChild(e[h])}}return g}
function g(c){var g=c.childNodes,e,h,q=j.p,b=0;for(h=0;h<g.length;h++)if(e=g[h],3==e.nodeType||1==e.nodeType&&q[e.nodeName]){b=1;break}if(b){var b=[],f=new i;f.nodeName=f.tagName="p";for(h=0;h<g.length;h++)e=g[h],3==e.nodeType||1==e.nodeType&&q[e.nodeName]?f.appendChild(e):(f.childNodes.length&&(b.push(f),f=f.clone()),b.push(e));f.childNodes.length&&b.push(f);c.empty();for(h=0;h<b.length;h++)c.appendChild(b[h])}}function q(c,g,e){if(0===e)return 0;a.isNumber(e)&&e--;var h=c.childNodes;if(h)for(var b=
0;b<h.length;b++){if(h[b].tagName===g)return h[b];if(c=q(h[b],g,e))return c}return 0}function e(g){for(var e=[].concat(g.childNodes),h=0;h<e.length;h++)if("html"==e[h].nodeName){for(var b=e[h],f=0;f<h;f++)3==e[f].nodeType&&!a.trim(e[f].toHtml())&&g.removeChild(e[f]);for(;b.firstChild&&3==b.firstChild.nodeType&&!a.trim(b.firstChild.toHtml());)b.removeChild(b.firstChild);break}}h.prototype={elements:function(){var c,h,b=this.lexer,f=this.opts;h=c=b.nextNode();"document"!=c.tagName&&(h=new k,h.appendChild(c));
h.nodeType=9;n.getScanner("div").scan(c,b,f);(c=l(h))&&f.autoParagraph&&g(c);e(h);var f=this.originalHtml,q=new d;h=/^(<!doctype|<html|<body)/i.test(f)?h.childNodes:c.childNodes;a.each(h,function(g){q.appendChild(g)});return q},parse:function(){return this.elements()}};return h},{requires:"./dtd,./nodes/Tag,./nodes/Fragment,./lexer/Cursor,./lexer/Lexer,./nodes/Document,./Scanner".split(",")});
KISSY.add("htmlparser/Scanner",function(a,j,i){return{getScanner:function(a){return i[a]||j}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(a){return a.replace(/[\s\xa0]+/g," ")},isLetter:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a},isValidAttributeNameStartChar:function(a){return!this.isWhitespace(a)&&'"'!=a&&"'"!=a&&">"!=a&&"<"!=a&&"/"!=a&&"="!=a},isWhitespace:function(a){return/^[\s\xa0]$/.test(a)}}});
KISSY.add("htmlparser/dtd",function(a){var a=a.merge,j={isindex:1,fieldset:1},i={input:1,button:1,select:1,textarea:1,label:1},d=a({a:1},i),b=a({iframe:1},d),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},k={ins:1,del:1,script:1,style:1},n=a({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},k),h=a({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},n),l=a({p:1},h),i=a({iframe:1},h,i),h={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},g=a({a:1},i),q={tr:1},e={"#text":1},c=a({param:1},h),m=a({form:1},j,b,f,l),s={li:1},p={base:1,link:1,meta:1,title:1},o=a(p,{style:1,script:1}),t={head:1,body:1},r={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},a={$nonBodyContent:a({html:1},t,p),$block:r,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:g,$body:a({script:1,style:1},
r),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:t,head:o,style:e,body:m,base:{},link:{},meta:{},title:e,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:m,td:m,br:{},th:m,center:m,kbd:g,button:a(l,f),basefont:{},h5:g,h4:g,samp:g,h6:g,ol:s,h1:g,h3:g,option:e,h2:g,form:a(j,b,f,l),select:{optgroup:1,option:1},font:g,ins:g,menu:s,abbr:g,label:g,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:g,script:e,tfoot:q,cite:g,
li:m,input:{},iframe:m,strong:g,textarea:e,noframes:m,big:g,small:g,span:g,hr:{},dt:g,sub:g,optgroup:{option:1},param:{},bdo:g,"var":g,div:m,object:c,sup:g,dd:m,strike:g,area:{},dir:s,map:a({area:1,form:1,p:1},j,k,f),applet:c,dl:{dt:1,dd:1},del:g,isindex:{},fieldset:a({legend:1},h),thead:q,ul:s,acronym:g,b:g,a:i,blockquote:m,caption:g,i:g,u:g,tbody:q,s:g,address:a(b,l),tt:g,legend:g,q:g,pre:a(n,d),p:g,em:g,dfn:g},d="article,figure,nav,aside,section,footer".split(","),u;for(u in a)for(var v in a[u])if("div"==
v)for(j=0;j<d.length;j++)a[u][d[j]]=a[u][v];for(j=0;j<d.length;j++)a[d[j]]=a.div;a.$empty["!doctype"]=1;return a});KISSY.add("htmlparser",function(a,j,i,d,b,f,k,n,h,l,g,q,e){return{CData:h,Comment:l,Node:g,Tag:q,Text:e,Lexer:i,Parser:d,BasicWriter:b,BeautifyWriter:f,MinifyWriter:k,Filter:n,DTD:j,serialize:function(g){var e=new b;g.writeHtml(e);return e.getHtml()},parse:function(g){return(new d(g)).parse()}}},{requires:"htmlparser/dtd,htmlparser/lexer/Lexer,htmlparser/Parser,htmlparser/writer/basic,htmlparser/writer/beautify,htmlparser/writer/minify,htmlparser/writer/filter,htmlparser/nodes/CData,htmlparser/nodes/Comment,htmlparser/nodes/Node,htmlparser/nodes/Tag,htmlparser/nodes/Text".split(",")});
KISSY.add("htmlparser/lexer/Cursor",function(){function a(a){this.position=a||0}a.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return a});
KISSY.add("htmlparser/lexer/Index",function(){function a(){this.lineCursors=[]}function j(a,b){for(var f=0;f<a.length;f++)if(a[f].position===b.position)return f;return-1}function i(a,b){for(var f=0;f<a.length&&!(a[f].position>b.position);f++);return f}a.prototype={add:function(a){-1==j(this.lineCursors,a)&&this.lineCursors.splice(i(this.lineCursors,a),0,a)},remove:function(a){var b=this.lineCursors,a=j(this.lineCursors,a);-1!=a&&b.splice(a,1)},row:function(a){return i(this.lineCursors,a)-1},col:function(a){var b=
i(this.lineCursors,a)-1;return a.position-this.lineCursors[b]}};return a});
KISSY.add("htmlparser/lexer/Lexer",function(a,j,i,d,b,f,k,n,h){function l(g){this.page=new i(g);this.cursor=new j;this.nodeFactory=this}l.prototype={setPosition:function(g){this.cursor.position=g},getPosition:function(){return this.cursor.position},nextNode:function(g){var h,e,c=this.cursor,b=this.page;h=c.position;e=b.getChar(c);switch(e){case -1:g=null;break;case "<":e=b.getChar(c);-1==e?g=this.makeString(h,c.position):"/"==e||f.isLetter(e)?(b.ungetChar(c),g=this.parseTag(h)):"!"==e||"?"==e?(e=
b.getChar(c),-1==e?g=this.makeString(h,c.position):">"==e?g=this.makeComment(h,c.position):(b.ungetChar(c),"-"==e?g=this.parseComment(h,g):(b.ungetChar(c),g=this.parseTag(h)))):(b.ungetChar(c),g=this.parseString(h,g));break;default:b.ungetChar(c),g=this.parseString(h,g)}return g},makeComment:function(g,h){var e;e=h-g;if(0!=e){if(2>e)return this.makeString(g,h);e=this.nodeFactory.createCommentNode(this.page,g,h)}else e=null;return e},makeString:function(g,h){var e=null;0<h-g&&(e=this.nodeFactory.createStringNode(this.page,
g,h));return e},makeCData:function(g,h){var e=null;0<h-g&&(e=this.nodeFactory.createCDataNode(this.page,g,h));return e},makeTag:function(g,h,e){var c;c=h-g;if(0!=c){if(2>c)return this.makeString(g,h);g=this.nodeFactory.createTagNode(this.page,g,h,e)}else g=null;return g},createTagNode:function(g,h,e,c){return new n(g,h,e,c)},createStringNode:function(g,h,e){return new d(g,h,e)},createCDataNode:function(h,f,e){return new b(h,f,e)},createCommentNode:function(g,b,e){return new h(g,b,e)},parseTag:function(h){var b,
e=[],c=[],a,l=this.page,d=0,j=this.cursor;for(e[0]=j.position;!b;)switch(e[d+1]=j.position,a=l.getChar(j),d){case 0:if(-1==a||">"==a||"<"==a)"<"==a&&(l.ungetChar(j),e[d+1]=j.position),b=!0;else if("/"==a||f.isValidAttributeNameStartChar(a))d=1;break;case 1:-1==a||">"==a||"<"==a?("<"==a&&(l.ungetChar(j),e[d+1]=j.getPosition),this.standalone(c,e),b=!0):f.isWhitespace(a)?(e[6]=e[2],d=6):"="==a&&(d=2);break;case 2:-1==a||">"==a?(this.standalone(c,e),b=!0):"'"==a?(d=4,e[4]=e[3]):'"'==a?(d=5,e[5]=e[3]):
f.isWhitespace(a)||(d=3);break;case 3:-1==a||">"==a?(this.naked(c,e),b=!0):f.isWhitespace(a)&&(this.naked(c,e),e[0]=e[4],d=0);break;case 4:-1==a?(this.single_quote(c,e),b=!0):"'"==a&&(this.single_quote(c,e),e[0]=e[5]+1,d=0);break;case 5:-1==a?(this.double_quote(c,e),b=!0):'"'==a&&(this.double_quote(c,e),e[0]=e[6]+1,d=0);break;case 6:-1==a?(this.standalone(c,e),e[0]=e[6],l.ungetChar(j),d=0):f.isWhitespace(a)||("="==a?(e[2]=e[6],e[3]=e[7],d=2):(this.standalone(c,e),e[0]=e[6],l.ungetChar(j),d=0));break;
default:throw Error("how ** did we get in state "+d);}return this.makeTag(h,j.position,c)},parseComment:function(h,a){var e,c,b=this.page,l=this.cursor,d;e=!1;for(d=0;!e;)if(c=b.getChar(l),-1==c)e=!0;else switch(d){case 0:">"==c&&(e=!0);if("-"==c)d=1;else return this.parseString(h,a);break;case 1:if("-"==c)c=b.getChar(l),-1==c?e=!0:">"==c?e=!0:(b.ungetChar(l),d=2);else return this.parseString(h,a);break;case 2:if("-"==c)d=3;else if(-1==c)return this.parseString(h,a);break;case 3:d="-"==c?4:2;break;
case 4:">"==c?e=!0:f.isWhitespace(c)||(d=2);break;default:throw Error("how ** did we get in state "+d);}return this.makeComment(h,l.position)},parseString:function(h,a){for(var e=0,c,b=this.page,l=this.cursor,d=0;!e;)if(c=b.getChar(l),-1==c)e=1;else if(a&&0==d&&("'"==c||'"'==c))d=c;else if(a&&0!=d&&"\\"==c)c=b.getChar(l),-1!=c&&"\\"!=c&&c!=d&&b.ungetChar(l);else if(a&&c==d)d=0;else if(a&&0==d&&"/"==c)if(c=b.getChar(l),-1==c)e=1;else if("/"==c){do c=b.getChar(l);while(-1!=c&&"\n"!=c)}else if("*"==
c){do{do c=b.getChar(l);while(-1!=c&&"*"!=c);c=b.getChar(l);"*"==c&&b.ungetChar(l)}while(-1!=c&&"/"!=c)}else b.ungetChar(l);else if(0==d&&"<"==c)if(c=b.getChar(l),-1==c)e=1;else{if("/"==c||f.isLetter(c)||"!"==c||"?"==c)e=1,b.ungetChar(l);b.ungetChar(l)}return this.makeString(h,l.position)},parseCDATA:function(h,b){var e,c,a,l,d,j,i=this.cursor,k=this.page;e=i.position;c=0;a=!1;l="";for(j=!1;!a;)switch(d=k.getChar(i),c){case 0:switch(d){case -1:a=!0;break;case "'":h&&!j&&(""==l?l="'":"'"==l&&(l=""));
break;case '"':h&&!j&&(""==l?l='"':'"'==l&&(l=""));break;case "\\":h&&""!=l&&(d=k.getChar(i),-1==d?a=!0:"\\"!=d&&d!=l&&k.ungetChar(i));break;case "/":if(h&&""==l)if(d=k.getChar(i),-1==d)a=!0;else if("/"==d)j=!0;else if("*"==d){do{do d=k.getChar(i);while(-1!=d&&"*"!=d);d=k.getChar(i);"*"==d&&k.ungetChar(i)}while(-1!=d&&"/"!=d)}else k.ungetChar(i);break;case "\n":j=!1;break;case "<":h?""==l&&(c=1):c=1}break;case 1:switch(d){case -1:a=!0;break;case "/":c=!b||k.getText(i.position,i.position+b.length)===
b&&!k.getText(i.position+b.length,i.position+b.length+1).match(/\w/)?2:0;break;case "!":d=k.getChar(i);-1==d?a=!0:"-"==d?(d=k.getChar(i),-1==d?a=!0:c="-"==d?3:0):c=0;break;default:c=0}break;case 2:j=!1;-1==d?a=!0:f.isLetter(d)?(a=!0,k.ungetChar(i),k.ungetChar(i),k.ungetChar(i)):c=0;break;case 3:j=!1;-1==d?a=!0:"-"==d&&(d=k.getChar(i),-1==d?a=!0:"-"==d?(d=k.getChar(i),-1==d?a=!0:">"==d?c=0:(k.ungetChar(i),k.ungetChar(i))):k.ungetChar(i));break;default:throw Error("unexpected "+c);}return this.makeCData(e,
i.position)},single_quote:function(h,a){var b=this.page;h.push(new k(b.getText(a[1],a[2]),"=",b.getText(a[4]+1,a[5]),"'"))},double_quote:function(h,a){var b=this.page;h.push(new k(b.getText(a[1],a[2]),"=",b.getText(a[5]+1,a[6]),'"'))},standalone:function(h,a){h.push(new k(this.page.getText(a[1],a[2])))},naked:function(h,a){var b=this.page;h.push(new k(b.getText(a[1],a[2]),"=",b.getText(a[3],a[4])))}};return l},{requires:"./Cursor,./Page,../nodes/Text,../nodes/CData,../Utils,../nodes/Attribute,../nodes/Tag,../nodes/Comment".split(",")});
KISSY.add("htmlparser/lexer/Page",function(a,j){function i(a){this.source=a;this.lineIndex=new j}i.prototype={getChar:function(a){var b=this.source,f=a.position;if(f>=b.length)return-1;var i=b.charAt(f);a.advance();"\r"===i&&(i="\n",f=a.position,"\n"===b.charAt(f)&&a.advance());"\n"===i&&this.lineIndex.add(a);return i},ungetChar:function(a){var b=this.source;a.retreat();var f=a.position,i=b.charAt(f);"\n"===i&&0!=f&&(i=b.charAt(f-1),"\r"===i&&a.retreat())},getText:function(a,b){return this.source.slice(a,
b)},row:function(a){return this.lineIndex.row(a)},col:function(a){return this.lineIndex.col(a)}};return i},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(a){function j(a,d,b,f){this.nodeType=2;this.name=a;this.assignMent=d;this.value=b;this.quote=f}a.augment(j,{clone:function(){var i=new j;a.mix(i,this);return i},equals:function(a){return this.name==a.name&&this.value==a.value&&this.nodeType==a.nodeType}});j.prototype.clone=function(){var i=new j;a.mix(i,this);return i};return j});
KISSY.add("htmlparser/nodes/CData",function(a,j){function i(){i.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}a.extend(i,j,{writeHtml:function(a,b){var f;if(!b||!1!==(f=b.onCData(this)))f&&this!==f?f.writeHtml(a,b):a.cdata(this.toHtml())}});return i},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(a,j){function i(){i.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}a.extend(i,j,{writeHtml:function(a,b){var f;if(!b||!1!==(f=b.onComment(this)))f&&this!==f?f.writeHtml(a,b):a.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var a=j.superclass.toHtml.apply(this,arguments);return a.substring(4,a.length-3)}});return i},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Document",function(a,j){function i(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}a.extend(i,j,{writeHtml:function(a,b){this.__filter=b;this._writeChildrenHtml(a)}});return i},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Fragment",function(a,j){function i(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}a.extend(i,j,{writeHtml:function(a,b){this.__filter=b;this.isChildrenFiltered=0;if(b)b.onFragment(this);this._writeChildrenHtml(a)}});return i},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(a){function j(a){var b=0;a.replace(/\n/g,function(){b++});return b}function i(d,b,f){this.parentNode=null;this.page=d;this.startPosition=b;this.endPosition=f;this.nextSibling=this.previousSibling=this.nodeName=null;d&&(this.startLine=j(this.page.getText(0,b)),this.endLine=j(this.page.getText(0,f)));a.Config.debug&&(this.toHtmlContent=this.toHtml())}i.prototype={toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,
this.endPosition)},toString:function(){var a=[];a.push(this.nodeName+"  [ "+this.startPosition+"|"+this.startLine+" : "+this.endPosition+"|"+this.endLine+" ]\n");a.push(this.toHtml());return a.join("")}};return i});
KISSY.add("htmlparser/nodes/Tag",function(a,j,i,d){function b(h,b,g){h.nodeName=h.tagName=b.toLowerCase();h._updateSelfClosed();a.each(g,function(a,b){h.setAttribute(b,a)})}function f(h,l,g,d){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=d||[];this.nodeType=1;if(a.isString(h))f.superclass.constructor.apply(this),b.apply(null,[this].concat(a.makeArray(arguments)));else{f.superclass.constructor.apply(this,arguments);d=this.attributes;d[0]&&(this.nodeName=d[0].name.toLowerCase(),
this.tagName=this.nodeName.replace(/\//,""),this._updateSelfClosed(),d.splice(0,1));var e=d[d.length-1];if(e=!(!e||!/\/$/.test(e.name)))d.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||e}this.closedEndPosition=this.closedStartPosition=-1}function k(a){var b=a.childNodes;a.firstChild=b[0];a.lastChild=b[b.length-1];1<=b.length&&(b[0].nextSibling=b[0].nextSibling=null,b[0].parentNode=a);if(1<b.length){for(var g=0;g<b.length-1;g++)b[g].nextSibling=b[g+1],b[g+1].previousSibling=b[g],b[g+1].parentNode=
a;b[b.length-1].nextSibling=null}}function n(a,b){for(var g=0;g<a.length;g++)if(a[g].name==b)return a[g];return null}a.extend(f,j,{_updateSelfClosed:function(){this.isSelfClosed=!!d.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var b=new f,l=[];a.each(this.attributes,function(a){l.push(a.clone())});a.mix(b,{childNodes:[],firstChild:null,lastChild:null,attributes:l,nodeType:this.nodeType,nodeName:this.nodeName,
tagName:this.tagName,isSelfClosed:this.isSelfClosed,closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return b},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!=a.nodeName||this.nodeType!=a.nodeType||this.attributes.length!=a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},
appendChild:function(a){this.childNodes.push(a);k(this)},replace:function(b){var f=b.parentNode.childNodes,g=a.indexOf(b,f);f[g]=this;k(b.parentNode)},prepend:function(a){this.childNodes.unshift(a);k(this)},insertBefore:function(b){var f=b.parentNode.childNodes,g=a.indexOf(b,f);f.splice(g,0,this);k(b.parentNode)},insertAfter:function(b){var f=b.parentNode.childNodes,g=a.indexOf(b,f);g==f.length-1?b.parentNode.appendChild(this):this.insertBefore(b.parentNode.childNodes[[g+1]])},empty:function(){this.childNodes=
[];k(this)},removeChild:function(b){var f=b.parentNode.childNodes,g=a.indexOf(b,f);f.splice(g,1);k(b.parentNode)},getAttribute:function(a){return(a=n(this.attributes,a))&&a.value},setAttribute:function(a,b){var g=n(this.attributes,a);g?g.value=b:this.attributes.push(new i(a,"=",b,'"'))},removeAttribute:function(b){(b=n(this.attributes,b))&&this.attributes.splice(a.indexOf(b,this.attributes),1)},filterChildren:function(){var b=this;if(!b.isChildrenFiltered){var f=new (a.require("htmlparser/writer/basic"));
b._writeChildrenHtml(f);f=(new (a.require("htmlparser/Parser"))(f.getHtml())).parse().childNodes;b.empty();a.each(f,function(a){b.appendChild(a)});b.isChildrenFiltered=1}},writeHtml:function(a,b){var g=this,f;f=g.tagName;if("!doctype"==f)a.append(this.toHtml()+"\n");else{g.__filter=b;g.isChildrenFiltered=0;if(b){if(!(f=b.onTagName(f)))return;g.tagName=f;f=b.onTag(g);if(!1===f)return;f&&(g=f);if(1!==g.nodeType){g.writeHtml(a,b);return}if(!g.tagName){g._writeChildrenHtml(a);return}}a.openTag(g);for(var e=
g.attributes,c=0;c<e.length;c++){var d=e[c];f=d.name;if(b){if(!(f=b.onAttributeName(f,g)))continue;d.name=f;if(!1===b.onAttribute(d,g))continue}a.attribute(d,g)}a.openTagClose(g);g.isSelfClosed||(g._writeChildrenHtml(a),a.closeTag(g))}},_writeChildrenHtml:function(b){var f=this.isChildrenFiltered?0:this.__filter;a.each(this.childNodes,function(a){a.writeHtml(b,f)})}});return f},{requires:["./Node","./Attribute","../dtd"]});
KISSY.add("htmlparser/nodes/Text",function(a,j){function i(d){a.isString(d)?(this.nodeValue=d,i.superclass.constructor.apply(this,[null,-1,-1])):(i.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}a.extend(i,j,{writeHtml:function(a,b){var f;if(!b||!1!==(f=b.onText(this)))f&&this!==f?f.writeHtml(a,b):a.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:i.superclass.toHtml.apply(this,arguments)}});return i},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(a,j,i){var i=j.parseCDATA(i.quoteSmart,a.nodeName),d=j.getPosition(),b=j.nextNode();b&&(1!=b.nodeType||!(b.isEndTag()&&b.tagName==a.tagName))&&j.setPosition(d);a.closed=!0;i&&a.appendChild(i)}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(a,j,i,d){var a={scan:function(a,b,d){d=d||{};d.quoteSmart=1;j.scan(a,b,d);d.quoteSmart=0}},b;for(b in i.$cdata)d[b]=a;return a},{requires:["./CdataScanner","../dtd","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(a,j,i,d){function b(h,d){function g(){c.childNodes.length&&(c.insertAfter(m),m=c,c=h.clone())}h.closed=1;if(!d.fixByDtd)return 0;var n=1,e=[].concat(h.childNodes);a.each(e,function(a){if(!f(h,a))return n=0,!1});if(n)return 0;for(var c=h.clone(),m=h,s=[],p=0;p<e.length;p++){var o=e[p];if(f(c,o))c.appendChild(o);else if(1==o.nodeType){var t=o.tagName;if(j.$listItem[t]){g();var o=k[o.tagName],r=new i;for(r.nodeName=r.tagName=o;p<e.length;){if(e[p].tagName==
t)r.appendChild(e[p]);else if((3!=e[p].nodeType||a.trim(e[p].toHtml()))&&3==e[p].nodeType)break;p++}r.insertAfter(m);m=r;p--}else g(),o.equals(c)?(o.insertAfter(m),m=o):f(o,c)?(c=h.clone(),a.each(o.childNodes,function(a){c.appendChild(a)}),o.empty(),o.insertAfter(m),m=o,o.appendChild(c),s.push(c),c=h.clone()):(o.insertAfter(m),m=o)}}c.childNodes.length&&c.insertAfter(m);h.parentNode.removeChild(h);a.each(s,function(a){b(a,d)});return 1}function f(a,b){return 9==a.nodeType||8==b.nodeType?1:!!j[a.tagName][b.tagName||
b.nodeName]}var k={li:"ul",dt:"dl",dd:"dl"},n={dd:"dl",dt:"dl",li:"ul",option:"select",optgroup:"select"};return{scan:function(a,f,g){function i(c,f){for(j=c;j>f;j--){var e=k[j];k[j-1].appendChild(e);b(e,g)}a=k[f];k.length=f}function e(a){var b=0,c;if(c=n[a.tagName]){for(var f=k.length-1,e=k[f];e&&e.tagName!=c;){if(e.tagName==a.tagName){b=1;break}f--;e=k[f]}b&&i(k.length-1,f-1)}return b}var c,j,k;k=g.stack=g.stack||[];do{if(c=f.nextNode())if(1===c.nodeType)if(c.isEndTag()&&c.tagName==a.tagName)c=
null;else if(c.isEndTag()){if(c.isEndTag()){var p=-1;for(j=k.length-1;0<=j;j--)if(k[j].tagName===c.tagName){p=j;break}-1!=p&&(k[k.length-1].appendChild(a),b(a,g),i(k.length-1,p),c=null)}}else d[c.tagName]?(d[c.tagName].scan(c,f,g),a.appendChild(c)):c.isSelfClosed?a.appendChild(c):(k.push(a),e(c)&&k.push(a),a=c);else a.appendChild(c);null==c&&0<k.length&&(c=k[k.length-1],d[c.tagName]?c=null:(k.length-=1,c.appendChild(a),b(a,g),a=c))}while(c);b(a,g)}}},{requires:["../dtd","../nodes/Tag","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/TextareaScanner",function(a,j,i){return i.textarea={scan:function(a,b,f){f=f||{};j.scan(a,b,f)}}},{requires:["./CdataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function a(){this.output=[]}a.prototype={append:function(){for(var a=this.output,i=arguments,d,b=0;b<i.length;b++)if(d=i[b],1<d.length)for(var f=0;f<d.length;f++)a.push(d.charAt(f));else a.push(d);return this},openTag:function(a){this.append("<",a.tagName)},openTagClose:function(a){a.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(a){this.append("</",a.tagName,">")},attribute:function(a){this.append(" ",a.name,'="',(a.value||a.name).replace(/"/g,
"&quote;"),'"')},text:function(a){this.append(a)},cdata:function(a){this.append(a)},comment:function(a){this.append("<\!--"+a+"--\>")},getHtml:function(){return this.output.join("")}};return a});
KISSY.add("htmlparser/writer/beautify",function(a,j,i,d){function b(){b.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var f in a.merge(i.$nonBodyContent,i.$block,i.$listItem,i.$tableContent,{select:1,script:1,style:1}))this.setRules(f,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}a.extend(b,j,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(b,d){this.rules[b]||(this.rules[b]=
{});a.mix(this.rules[b],d)},openTag:function(a){var d=this.rules[a.tagName]||{};this.allowIndent?this.indentation():d.breakBeforeOpen&&(this.lineBreak(),this.indentation());b.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,d=this.rules[b]||{};a.isSelfClosed?this.append(" />"):(this.append(">"),d.allowIndent&&this.indentLevel++);d.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(a){var d=a.tagName,i=this.rules[d]||{};i.allowIndent&&this.indentLevel--;
this.allowIndent?this.indentation():i.breakBeforeClose&&(this.lineBreak(),this.indentation());b.superclass.closeTag.apply(this,arguments);"pre"===d&&(this.inPre=0);i.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=d.collapseWhitespace(a));this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(b){this.allowIndent&&this.indentation();this.append(a.trim(b))}});return b},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(a){function j(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function i(b,f){for(var d=0;b&&d<b.length;d++)a.each(b[d].value,function(a){f=f.replace(a[0],a[1])});return f}function d(a,f,d,i){for(var h=0;a&&h<a.length;h++){var j;if(!1===(j=a[h].value.apply(null,f)))return!1;if(i&&j&&j!=i)return this.onNode(j)}return d}j.prototype={addRules:function(a,f){var f=f||10,d;for(d in a)if(a.hasOwnProperty(d)){var i=
this[d];if(i){var h;a:{for(h=0;i&&h<i.length;h++)if(i[h].priority>f)break a;h=i.length}i.splice(h,0,{value:a[d],priority:f})}}},onTagName:function(a){return i(this.tagNames,a)},onAttributeName:function(a){return i(this.attributeNames,a)},onText:function(a){return d.call(this,this.text,[a.toHtml(),a],a,a)},onCData:function(a){return d.call(this,this.cdata,[a.toHtml(),a],a,a)},onAttribute:function(a,f){var d;a:{d=this.attributes;for(var i=0;d&&i<d.length;i++){var h=d[i].value,j=a.name;if(h[j]&&!1===
h[j].call(null,a.value,f)){d=!1;break a}}d=a}return d},onComment:function(a){return d.call(this,this.comment,[a.toHtml(),a],a,a)},onNode:function(a){var f=a.nodeType;if(1===f)return this.onTag(a);if(3===f)return this.onText(a);if(8===f)return this.onComment(a)},onFragment:function(a){return d.call(this,this.root,[a],a,a)},onTag:function(a){for(var f=["^",a.tagName,"$"],d=this.tags,i,h=0;h<f.length;h++)for(var j=f[h],g=0;g<d.length;g++)if(i=d[g].value,i[j]){if(!1===(i=i[j](a)))return!1;if(i&&i!=a)return this.onNode(i);
if(!a.tagName)return a}return a}};return j});
KISSY.add("htmlparser/writer/minify",function(a,j,i){function d(a){return a.replace(/"/g,"&quote;")}function b(a,b){var d=a.nodeName,e=b.name,c=b.value||"";/^on[a-z]+/.test(e)?c=k(c).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===e?c=n(k(c)):/^(?:a|area|link|base)$/.test(d)&&"href"===e||"img"===d&&/^(?:src|longdesc|usemap)$/.test(e)||"object"===d&&/^(?:classid|codebase|data|usemap)$/.test(e)||"q"===d&&"cite"===e||"blockquote"===d&&"cite"===e||("ins"===d||"del"===d)&&"cite"===
e||"form"===d&&"action"===e||"input"===d&&("src"===e||"usemap"===e)||"head"===d&&"profile"===e||"script"===d&&("src"===e||"for"===e)||/^(?:a|area|object|button)$/.test(d)&&"tabindex"===e||"input"===d&&("maxlength"===e||"tabindex"===e)||"select"===d&&("size"===e||"tabindex"===e)||"textarea"===d&&/^(?:rows|cols|tabindex)$/.test(e)||"colgroup"===d&&"span"===e||"col"===d&&"span"===e||("th"===d||"td"==d)&&("rowspan"===e||"colspan"===e)?c=k(c):"style"===e&&(c=k(c).replace(/[\s\xa0]*;[\s\xa0]*$/,""));return c}
function f(){f.superclass.constructor.apply(this,arguments);this.inPre=0}var k=a.trim,n=i.collapseWhitespace,h=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");a.extend(f,j,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),f.superclass.comment.call(this,a))},openTag:function(a){"pre"==a.tagName&&(this.inPre=1);f.superclass.openTag.apply(this,
arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);f.superclass.closeTag.apply(this,arguments)},cdata:function(a){a=k(a).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");f.superclass.cdata.call(this,a)},attribute:function(a,g){var f=a.name,e=a.value||"",c;c=a.name;if(c=!(!k(a.value||"")&&("input"===g&&"value"===c||h.test(c)))){c=g.nodeName;var i=a.name,
j=a.value||"",j=k(j.toLowerCase());c=!("script"===c&&"language"===i&&"javascript"===j||"form"===c&&"method"===i&&"get"===j||"input"===c&&"type"===i&&"text"===j||"script"===c&&"type"===i&&"text/javascript"===j||"style"===c&&"type"===i&&"text/css"===j||"area"===c&&"shape"===i&&"rect"===j)}c&&(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(f)?this.append(" ",f):!/[ "'=<>`]/.test(e)?this.append(" ",f,"=",d(b(g,a))):this.append(" ",f,'="',d(b(g,
a)),'"'))},text:function(a){this.inPre||this.append(n(a))}});return f},{requires:["./basic","../Utils"]});
