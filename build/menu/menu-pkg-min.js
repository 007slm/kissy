/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("menu/menu",function(h,f,g,e){var b;b=f.create(g.Container,[f.Position,f.Align],{_uiSetHighlightedItem:function(c,a){var d=a&&a.prevVal;d&&d.set("highlighted",false);c&&c.set("highlighted",true);this.set("activeItem",c)},_handleBlur:function(){if(b.superclass._handleBlur.call(this)===false)return false;this.set("highlightedItem",null)},_getNextEnabledHighlighted:function(c,a){var d=this.get("children");if(d.length==0)return null;if(!d[c].get("disabled"))return d[c];var i=c;for(c+=a;c!=i;){if(!d[c].get("disabled"))return d[c];
c+=a;if(c==-1)c=d.length-1;else if(c==d.length)c=0}return null},_handleClick:function(c){if(b.superclass._handleClick.call(this,c)===false)return false;var a=this.get("highlightedItem");if(a)if(a._handleClick(c)===false)return false},_handleKeydown:function(c){if(b.superclass._handleKeydown.call(this,c)===false)return false;var a=this.get("highlightedItem");if(a)if(a._handleKeydown(c)===false)return false;var d=this.get("children");if(d.length!==0)if(c.keyCode==38){if(a){a=h.indexOf(a,d);d=a==0?d.length-
1:a-1;this.set("highlightedItem",this._getNextEnabledHighlighted(d,-1))}else this.set("highlightedItem",this._getNextEnabledHighlighted(d.length-1,-1));c.preventDefault();return false}else if(c.keyCode==40){if(a){a=h.indexOf(a,d);d=a==d.length-1?0:a+1;this.set("highlightedItem",this._getNextEnabledHighlighted(d,1))}else this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));c.preventDefault();return false}},bindUI:function(){var c=this;c.on("hide",function(){c.set("highlightedItem",null)})}},
{ATTRS:{highlightedItem:{},activeItem:{view:true}}});b.DefaultRender=e;return b},{requires:["uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(h,f,g,e){var b=f.create(g.ModelControl,{_handleMouseEnter:function(){if(b.superclass._handleMouseEnter.call(this)===false)return false;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(){if(b.superclass._handleMouseLeave.call(this)===false)return false;this.get("parent").set("highlightedItem",null)},_handleClick:function(){if(b.superclass._handleClick.call(this)===false)return false;this.get("selectable")&&this.set("selected",true);this.get("checkable")&&
this.set("checked",!this.get("checked"));this.get("parent").fire("click",{target:this})}},{ATTRS:{handleMouseEvents:{value:false},supportFocused:{value:false},selectable:{value:false,view:true},checkable:{value:false,view:true},content:{view:true,valueFn:function(){return this.get("view")&&this.get("view").get("content")}},value:{},highlighted:{view:true,value:false},checked:{value:false,view:true},selected:{view:true,value:false}}});b.DefaultRender=e;return b},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(h,f,g){function e(b,c){return h.substitute(c,{prefixCls:b.get("prefixCls")})}return f.create(g.Render,{renderUI:function(){var b=this.get("el");b.addClass(e(this,"{prefixCls}menuitem")).html("<div class='"+e(this,"{prefixCls}menuitem-content")+"'>").attr("role","menuitem").unselectable();b.attr("id")||b.attr("id",h.guid("ks-menuitem"))},_uiSetContent:function(b){var c=this.get("el").children("div");c.item(c.length-1).html(b)},_uiSetDisabled:function(b){var c=
this.get("el").attr("aria-disabled",!!b);b?c.addClass(e(this,"{prefixCls}menuitem-disabled")):c.removeClass(e(this,"{prefixCls}menuitem-disabled"))},_uiSetHighlighted:function(b){b?this.get("el").addClass(e(this,"{prefixCls}menuitem-highlight")):this.get("el").removeClass(e(this,"{prefixCls}menuitem-highlight"))},_uiSetSelected:function(b){this.get("el")[b?"addClass":"removeClass"](e(this,"{prefixCls}menuitem-selected"))},_uiSetChecked:function(b){this.get("el")[b?"addClass":"removeClass"](e(this,
"{prefixCls}menuitem-checked"))},_uiSetSelectable:function(b){this.get("el").attr("role",b?"menuitemradio":"menuitem")},_uiSetCheckable:function(b){this.get("el").attr("role",b?"menuitemcheckbox":"menuitem")},_handleMouseDown:function(){this.get("el").addClass(e(this,"{prefixCls}menuitem-active"));this.get("el").attr("aria-pressed",true)},_handleMouseUp:function(){this.get("el").removeClass(e(this,"{prefixCls}menuitem-active"));this.get("el").attr("aria-pressed",false)}},{ATTRS:{highlighted:{},selected:{},
content:{}},HTML_PARSER:{content:function(b){return b.html()}}})},{requires:["uibase","component"]});
KISSY.add("menu/menurender",function(h,f,g,e){return g.create(e.Render,[g.Contentbox.Render,g.Position.Render,f.ie===6?g.Shim.Render:null],{renderUI:function(){var b=this.get("el");b.addClass(h.substitute("{prefixCls}menu  {prefixCls}menu-vertical",{prefixCls:this.get("prefixCls")})).attr("role","menu").attr("aria-haspopup",true).unselectable();f.ie||b.attr("onmousedown","return false;");b.attr("id")||b.attr("id",h.guid("ks-menu"))},_uiSetActiveItem:function(b){var c=this.get("el");if(b){b=b.get("view").get("el").attr("id");
c.attr("aria-activedescendant",b)}else c.attr("aria-activedescendant","")}},{ATTRS:{highlightedItem:{},activeItem:{}}})},{requires:["ua","uibase","component"]});
KISSY.add("menu/submenu",function(h,f,g,e,b){var c;c=f.create(e,{_handleMouseLeave:function(a){if(e.superclass._handleMouseLeave.call(this,a)===false)return false;var d=this.get("menu");a=h.one(a.relatedTarget)[0];if(!(d&&d.get("visible")&&(d.get("view").get("el").contains(a)||d.get("view").get("el")[0]==a))){this.get("parent").set("highlightedItem",null);this.hideMenu()}},_uiSetHighlighted:function(a){this.get("view").set("highlighted",a);a||this.hideMenu()},bindUI:function(){var a=this,d=a.get("parent"),
i=this.get("menu");if(d){d.on("hide",function(){a.get("menu")&&a.get("menu").hide()});i.on("click",function(j){d.fire("click",{target:j.target})});i.on("afterActiveItemChange",function(j){d.set("activeItem",j.newVal)})}},_handleMouseEnter:function(){if(c.superclass._handleMouseEnter.call(this)===false)return false;this.showMenu()},showMenu:function(){var a=this.get("menu");a.set("align",{node:this.get("view").get("el"),points:["tr","tl"]});a.render();this.get("view").get("el").attr("aria-haspopup",
a.get("view").get("el").attr("id"));a.show()},hideMenu:function(){var a=this.get("menu");a&&a.hide()},_handleClick:function(a){var d=this.get("menu");return d&&d.get("visible")&&d._handleClick(a)},_handleKeydown:function(a){if(c.superclass._handleKeydown.call(this,a)===false)return false;var d=this.get("menu");if(a.keyCode==27)this.hideMenu();else{if(d&&d.get("visible"))if(d._handleKeydown(a)===false)return false;if(a.keyCode==39&&(!d||!d.get("visible"))){this.showMenu();a=d.get("children");a[0]&&
d.set("highlightedItem",a[0]);return false}else if(a.keyCode==37&&d&&d.get("visible")){this.hideMenu();this.get("parent").set("activeItem",this);return false}}}},{ATTRS:{menu:{}}});c.DefaultRender=b;return c},{requires:["uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(h,f,g){return f.create(g,{renderUI:function(){this.get("el").addClass(this.get("prefixCls")+"submenu");this.get("el").attr("aria-haspopup","true")},_uiSetContent:function(e){this.get("el").one("."+this.get("prefixCls")+"menuitem-content").html(e+h.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(h,f,g,e,b,c,a){f.Render=g;f.Item=e;f.Item.Render=b;f.SubMenu=c;c.Render=a;return f},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender"]});
