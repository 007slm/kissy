/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: ${build.time}
*/
KISSY.add("menu/menu",function(g,f,h,i){var d;d=f.create(h.Container,[f.Position,f.Align],{_uiSetHighlightedItem:function(a,b){var c=b&&b.prevVal;c&&c.set("highlighted",false);a&&a.set("highlighted",true);this.set("activeItem",a)},_handleBlur:function(a){if(d.superclass._handleBlur.call(this,a))return true;this.set("highlightedItem",undefined)},_getNextEnabledHighlighted:function(a,b){var c=this.get("children"),e=c.length,j=a;do{if(!c[a].get("disabled"))return c[a];a=(a+b+e)%e}while(a!=j)},_handleClick:function(a){if(d.superclass._handleClick.call(this,
a))return true;var b=this.get("highlightedItem");if(b&&b._handleClick(a))return true},_handleKeydown:function(a){if(this._handleKeydownInternal(a)){a.halt();return true}},_handleKeydownInternal:function(a){if(d.superclass._handleKeydown.call(this,a))return true;var b=this.get("highlightedItem");if(b&&b._handleKeydown(a))return true;var c=this.get("children"),e=c.length;if(e!=0){switch(a.keyCode){case 27:return;case 36:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case 35:this.set("highlightedItem",
this._getNextEnabledHighlighted(e-1,-1));break;case 38:if(b){a=g.indexOf(b,c);e=(a-1+e)%e}else e=e-1;this.set("highlightedItem",this._getNextEnabledHighlighted(e,-1));break;case 40:if(b){a=g.indexOf(b,c);e=(a+1+e)%e}else e=0;this.set("highlightedItem",this._getNextEnabledHighlighted(e,1));break;default:return}return true}},bindUI:function(){var a=this;a.on("hide",function(){a.set("highlightedItem",undefined)})},containsElement:function(a){if(this.get("view").containsElement(a))return true;for(var b=
this.get("children"),c=0,e=b.length;c<e;c++){var j=b[c];if(typeof j.containsElement=="function"&&j.containsElement(a))return true}return false}},{ATTRS:{highlightedItem:{},activeItem:{view:true}}});d.DefaultRender=i;return d},{requires:["uibase","component","./menurender","./submenu"]});
KISSY.add("menu/menuitem",function(g,f,h,i){var d=f.create(h.ModelControl,{_handleMouseEnter:function(a){if(d.superclass._handleMouseEnter.call(this,a))return true;this.get("parent").set("highlightedItem",this)},_handleMouseLeave:function(a){if(d.superclass._handleMouseLeave.call(this,a))return true;this.get("parent").set("highlightedItem",undefined)},_handleClick:function(a){if(d.superclass._handleClick.call(this,a))return true;this.get("selectable")&&this.set("selected",true);this.get("checkable")&&
this.set("checked",!this.get("checked"));this.get("parent").fire("click",{target:this})},_uiSetHighlighted:function(a){this.get("view").set("highlighted",a);if(a){var b=this.get("el");a=this.get("parent").get("el");var c=b.offset().top;b=b[0].offsetHeight;var e=a.offset().top,j=a[0].offsetHeight;if(c-e>=j)a[0].scrollTop+=c-e+b-j;else if(c-e<0)a[0].scrollTop+=c-e}},containsElement:function(a){return this.get("view").containsElement(a)}},{ATTRS:{handleMouseEvents:{value:false},supportFocused:{value:false},
selectable:{view:true},checkable:{view:true},content:{view:true,valueFn:function(){return this.get("view")&&this.get("view").get("content")}},value:{},highlighted:{view:true},checked:{view:true},selected:{view:true}}});d.DefaultRender=i;return d},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(g,f,h,i){function d(a,b){return g.substitute(b,{prefixCls:a.get("prefixCls")})}return h.create(i.Render,{renderUI:function(){},createDom:function(){var a=this.get("el");a.addClass(d(this,"{prefixCls}menuitem")).html("<div class='"+d(this,"{prefixCls}menuitem-content")+"'>").attr("role","menuitem");a.attr("id")||a.attr("id",g.guid("ks-menuitem"))},_uiSetContent:function(a){var b=this.get("el").children("div");b.item(b.length-1).html(a)},_uiSetDisabled:function(a){var b=
this.get("el").attr("aria-disabled",!!a);a?b.addClass(d(this,"{prefixCls}menuitem-disabled")):b.removeClass(d(this,"{prefixCls}menuitem-disabled"))},_uiSetHighlighted:function(a){a?this.get("el").addClass(d(this,"{prefixCls}menuitem-highlight")):this.get("el").removeClass(d(this,"{prefixCls}menuitem-highlight"))},_uiSetSelected:function(a){this.get("el")[a?"addClass":"removeClass"](d(this,"{prefixCls}menuitem-selected"))},_uiSetChecked:function(a){this.get("el")[a?"addClass":"removeClass"](d(this,
"{prefixCls}menuitem-checked"));if(a){a=this.get("el");var b=g.substitute("{prefixCls}menuitem-checkbox",{prefixCls:this.get("prefixCls")}),c=a.one("."+b);if(!c){c=(new f("<div class='"+b+"'/>")).prependTo(a);c.unselectable()}}},_uiSetSelectable:function(a){this.get("el").attr("role",a?"menuitemradio":"menuitem")},_uiSetCheckable:function(a){this.get("el").attr("role",a?"menuitemcheckbox":"menuitem")},_handleMouseDown:function(){this.get("el").addClass(d(this,"{prefixCls}menuitem-active"));this.get("el").attr("aria-pressed",
true)},_handleMouseUp:function(){this.get("el").removeClass(d(this,"{prefixCls}menuitem-active"));this.get("el").attr("aria-pressed",false)},containsElement:function(a){var b=this.get("el");return b[0]==a||b.contains(a)}},{ATTRS:{highlighted:{},selected:{},content:{},checked:{}},HTML_PARSER:{content:function(a){return a.html()}}})},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(g,f,h,i){return h.create(i.Render,[h.Contentbox.Render,h.Position.Render,f.ie===6?h.Shim.Render:null],{renderUI:function(){var d=this.get("el");d.addClass(g.substitute("{prefixCls}menu  {prefixCls}menu-vertical",{prefixCls:this.get("prefixCls")})).attr("role","menu").attr("aria-haspopup",true);f.ie||d.attr("onmousedown","return false;");d.attr("id")||d.attr("id",g.guid("ks-menu"))},_uiSetActiveItem:function(d){var a=this.get("el");if(d){d=d.get("view").get("el").attr("id");
a.attr("aria-activedescendant",d)}else a.attr("aria-activedescendant","")},containsElement:function(d){var a=this.get("el");return a[0]===d||a.contains(d)}},{ATTRS:{highlightedItem:{},activeItem:{}}})},{requires:["ua","uibase","component"]});
KISSY.add("menu/submenu",function(g,f,h,i,d){var a;a=f.create(i,{_onParentHide:function(){this.get("menu")&&this.get("menu").hide()},bindUI:function(){var b=this.get("parent"),c=this.get("menu");if(b){b.on("hide",this._onParentHide,this);c.on("click",function(e){b.fire("click",{target:e.target})});c.on("afterActiveItemChange",function(e){b.set("activeItem",e.newVal)})}c.on("beforeHighlightedItemChange",this.onChildHighlight_,this)},_handleMouseEnter:function(b){if(a.superclass._handleMouseEnter.call(this,
b))return true;this.clearTimers();this.showTimer_=g.later(this.showMenu,this.get("menuDelay"),false,this)},showMenu:function(){var b=this.get("menu");b.set("align",{node:this.get("view").get("el"),points:["tr","tl"]});b.render();this.get("view").get("el").attr("aria-haspopup",b.get("view").get("el").attr("id"));b.show()},clearTimers:function(){if(this.dismissTimer_){this.dismissTimer_.cancel();this.dismissTimer_=null}if(this.showTimer_){this.showTimer_.cancel();this.showTimer_=null}},onChildHighlight_:function(b){if(b.newVal)if(this.get("menu").get("parent")==
this){this.clearTimers();this.get("parent").set("highlightedItem",this)}},hideMenu:function(){var b=this.get("menu");b&&b.hide()},_handleClick:function(b){this.showMenu();return this.get("menu")._handleClick(b)},_handleKeydown:function(b){if(a.superclass._handleKeydown.call(this,b))return true;var c=this.get("menu"),e=c&&c.get("visible"),j=b.keyCode;if(e){if(!c._handleKeydown(b))if(j==37){this.hideMenu();this.get("parent").set("activeItem",this)}else return}else if(j==39){this.showMenu();b=c.get("children");
b[0]&&c.set("highlightedItem",b[0])}else return;return true},_uiSetHighlighted:function(b,c){a.superclass._uiSetHighlighted.call(this,b,c);if(!b){this.dismissTimer_&&this.dismissTimer_.cancel();this.dismissTimer_=g.later(this.hideMenu,this.get("menuDelay"),false,this)}},containsElement:function(b){var c=this.get("menu");return c&&c.containsElement(b)},destructor:function(){var b=this.get("parent"),c=this.get("menu");this.clearTimers();b&&b.detach("hide",this._onParentHide,this);c&&c.destroy()}},{ATTRS:{menuDelay:{value:300},
menu:{setter:function(b){b.set("parent",this)}}}});a.DefaultRender=d;return a},{requires:["uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(g,f,h){return f.create(h,{renderUI:function(){this.get("el").addClass(this.get("prefixCls")+"submenu");this.get("el").attr("aria-haspopup","true")},_uiSetContent:function(i){this.get("el").one("."+this.get("prefixCls")+"menuitem-content").html(i+g.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}})},{requires:["uibase","./menuitemrender"]});
KISSY.add("menu",function(g,f,h,i,d,a,b){f.Render=h;f.Item=i;f.Item.Render=d;f.SubMenu=a;a.Render=b;return f},{requires:["menu/menu","menu/menurender","menu/menuitem","menu/menuitemrender","menu/submenu","menu/submenurender"]});
